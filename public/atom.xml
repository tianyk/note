<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Kekeçš„ä¸ªäººç½‘ç«™</title>
  
  <subtitle>æœ‰æ¢¦å°±å»å®ç°</subtitle>
  <link href="https://kekek.cc/atom.xml" rel="self"/>
  
  <link href="https://kekek.cc/"/>
  <updated>2026-02-12T03:48:27.341Z</updated>
  <id>https://kekek.cc/</id>
  
  <author>
    <name>tyk</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Headscale æç®€éƒ¨ç½²æŒ‡å—</title>
    <link href="https://kekek.cc/post/deploy-headscale.html"/>
    <id>https://kekek.cc/post/deploy-headscale.html</id>
    <published>2026-02-11T16:00:00.000Z</published>
    <updated>2026-02-12T03:48:27.341Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0-æ¶æ„ä¸ç«¯å£è§„åˆ’ï¼ˆå…ˆæŠŠç«¯å£å®šæ­»ï¼‰"><a href="#0-æ¶æ„ä¸ç«¯å£è§„åˆ’ï¼ˆå…ˆæŠŠç«¯å£å®šæ­»ï¼‰" class="headerlink" title="0. æ¶æ„ä¸ç«¯å£è§„åˆ’ï¼ˆå…ˆæŠŠç«¯å£å®šæ­»ï¼‰"></a>0. æ¶æ„ä¸ç«¯å£è§„åˆ’ï¼ˆå…ˆæŠŠç«¯å£å®šæ­»ï¼‰</h2><table><thead><tr><th align="left">æœåŠ¡</th><th align="left">åè®®&#x2F;ç«¯å£</th><th align="left">è¯´æ˜</th><th align="left">è°è®¿é—®è°</th></tr></thead><tbody><tr><td align="left"><strong>HTTPS</strong></td><td align="left"><code>TCP/443</code></td><td align="left">Headscale æ§åˆ¶é¢ + DERPï¼ˆç»åä»£ï¼Œå« Upgradeï¼‰</td><td align="left">å…¬ç½‘ â†’ Nginx&#x2F;OpenResty</td></tr><tr><td align="left"><strong>STUN</strong></td><td align="left"><code>UDP/3478</code></td><td align="left">å†…ç½® STUNï¼ˆæ‰“æ´å…³é”®ï¼‰</td><td align="left">å…¬ç½‘ â†’ Headscaleï¼ˆç›´è¿åˆ°æœåŠ¡å™¨ï¼‰</td></tr><tr><td align="left"><strong>Local</strong></td><td align="left"><code>TCP/3477</code></td><td align="left">Headscale æœ¬ä½“ï¼ˆä»…æœ¬æœºç›‘å¬ï¼‰</td><td align="left">Nginx&#x2F;OpenResty â†’ Headscale</td></tr></tbody></table><p>å…³é”®ç‚¹ï¼š</p><ul><li><strong><code>3478</code> å¿…é¡»æ”¾è¡Œ UDPï¼ˆä¸æ˜¯ TCPï¼‰</strong>ï¼šå¾ˆå¤šäº‘å®‰å…¨ç»„ TCP&#x2F;UDP åˆ†å¼€é€‰ï¼Œåˆ«é€‰é”™ã€‚</li><li><strong>ä¸è¦å¯¹å…¬ç½‘æš´éœ² <code>3477</code></strong>ï¼šåªç›‘å¬ <code>127.0.0.1</code>ï¼Œç”±åä»£ç»Ÿä¸€å‡ºå…¥å£ã€‚</li></ul><hr><h2 id="1-å‰ç½®å‡†å¤‡ï¼ˆæ›¿æ¢å ä½ç¬¦ï¼‰"><a href="#1-å‰ç½®å‡†å¤‡ï¼ˆæ›¿æ¢å ä½ç¬¦ï¼‰" class="headerlink" title="1. å‰ç½®å‡†å¤‡ï¼ˆæ›¿æ¢å ä½ç¬¦ï¼‰"></a>1. å‰ç½®å‡†å¤‡ï¼ˆæ›¿æ¢å ä½ç¬¦ï¼‰</h2><p>æŠŠä¸‹é¢å ä½ç¬¦æ›¿æ¢æˆä½ çš„å€¼ï¼š</p><ul><li><code>hs.example.com</code>ï¼šä½ çš„æ§åˆ¶é¢åŸŸåï¼ˆå¿…é¡» HTTPS å¯è®¿é—®ï¼‰</li><li><code>SERVER_PUBLIC_IP</code>ï¼šæœåŠ¡å™¨å…¬ç½‘ IPv4</li><li><code>REGION_CODE</code>ï¼šè‡ªå»º DERP codeï¼ˆå»ºè®®å°å†™ï¼Œä¾‹å¦‚ <code>myderp</code>ï¼‰</li></ul><p>å‡†å¤‡é¡¹ï¼š</p><ul><li>ä¸€å° Linux æœåŠ¡å™¨ï¼ˆæœ‰å…¬ç½‘ IPv4ï¼‰</li><li>ä¸€ä¸ªåŸŸå A è®°å½•æŒ‡å‘ <code>SERVER_PUBLIC_IP</code></li><li>å·²æœ‰è¯ä¹¦ï¼ˆæˆ–ä½ èƒ½è‡ªå·±æå®š ACME ç”³è¯·ï¼›æœ¬æ–‡ä¸å±•å¼€ï¼‰</li><li>Nginx æˆ– OpenResty å·²å®‰è£…</li></ul><hr><h2 id="2-å®‰è£…-Headscaleï¼ˆäºŒè¿›åˆ¶ï¼‰"><a href="#2-å®‰è£…-Headscaleï¼ˆäºŒè¿›åˆ¶ï¼‰" class="headerlink" title="2. å®‰è£… Headscaleï¼ˆäºŒè¿›åˆ¶ï¼‰"></a>2. å®‰è£… Headscaleï¼ˆäºŒè¿›åˆ¶ï¼‰</h2><p>ä» <code>juanfont/headscale</code> çš„ Releases ä¸‹è½½ä¸ä½ æœºå™¨æ¶æ„åŒ¹é…çš„äºŒè¿›åˆ¶ï¼š</p><ul><li><a href="https://github.com/juanfont/headscale/releases"><code>juanfont/headscale</code> Releases</a></li></ul><p>å®‰è£…åˆ° <code>/usr/local/bin/headscale</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> ./headscale /usr/local/bin/headscale</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> 0755 /usr/local/bin/headscale</span><br><span class="line">/usr/local/bin/headscale version</span><br></pre></td></tr></table></figure><blockquote><p>å°å‘ï¼šå¦‚æœé‡åˆ° <code>sudo headscale: command not found</code>ï¼Œå¤šåŠæ˜¯ <code>sudo</code> çš„ <code>secure_path</code> ä¸å« <code>/usr/local/bin</code>ã€‚æœ¬æ–‡åç»­ç»Ÿä¸€ç”¨ç»å¯¹è·¯å¾„ï¼š<code>sudo /usr/local/bin/headscale ...</code></p></blockquote><hr><h2 id="3-ç”Ÿæˆå¿…é¡»å¯†é’¥ï¼ˆv0-28-å¸¸è§å¼ºåˆ¶é¡¹ï¼‰"><a href="#3-ç”Ÿæˆå¿…é¡»å¯†é’¥ï¼ˆv0-28-å¸¸è§å¼ºåˆ¶é¡¹ï¼‰" class="headerlink" title="3. ç”Ÿæˆå¿…é¡»å¯†é’¥ï¼ˆv0.28+ å¸¸è§å¼ºåˆ¶é¡¹ï¼‰"></a>3. ç”Ÿæˆå¿…é¡»å¯†é’¥ï¼ˆv0.28+ å¸¸è§å¼ºåˆ¶é¡¹ï¼‰</h2><p>åˆ›å»ºç›®å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/headscale /var/lib/headscale</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> 700 /var/lib/headscale</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆ Noise ç§é’¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale generate private-key \</span><br><span class="line">  | <span class="built_in">sudo</span> <span class="built_in">tee</span> /var/lib/headscale/noise_private.key &gt;/dev/null</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> 600 /var/lib/headscale/noise_private.key</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šè¿™é‡Œç”¨ <code>tee</code> æ˜¯ä¸ºäº†è§£å†³â€œ<code>sudo</code> + é‡å®šå‘â€æƒé™é—®é¢˜ï¼ˆ<code>sudo cmd &gt; file</code> çš„é‡å®šå‘ä¸åœ¨ sudo æƒé™é‡Œæ‰§è¡Œï¼‰ã€‚<br>å¦å¤–ï¼Œå†…å®¹é€šå¸¸å¸¦ <code>privkey:</code> å‰ç¼€ï¼Œåˆ«æ‰‹åŠ¨åˆ ï¼Œå¦åˆ™å¯èƒ½æŠ¥ â€œexpected type prefix privkey:â€ã€‚</p></blockquote><hr><h2 id="4-å†™å…¥-Headscale-é…ç½®ï¼ˆæœ€å°å¯ç”¨æ¨¡æ¿ï¼‰"><a href="#4-å†™å…¥-Headscale-é…ç½®ï¼ˆæœ€å°å¯ç”¨æ¨¡æ¿ï¼‰" class="headerlink" title="4. å†™å…¥ Headscale é…ç½®ï¼ˆæœ€å°å¯ç”¨æ¨¡æ¿ï¼‰"></a>4. å†™å…¥ Headscale é…ç½®ï¼ˆæœ€å°å¯ç”¨æ¨¡æ¿ï¼‰</h2><p>ä¿å­˜ä¸ºï¼š<code>/etc/headscale/config.yaml</code></p><blockquote><p>è¯´æ˜ï¼šå…ˆ<strong>å…³é—­ DNS&#x2F;MagicDNS</strong>ï¼Œå‡å°‘å¿…å¡«é¡¹è€¦åˆï¼›è·‘é€šåå†æŒ‰ã€Œè¿›é˜¶ã€ç« èŠ‚å¼€å¯ã€‚</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/headscale/config.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¿…é¡»æ›¿æ¢ï¼šä½ çš„æ§åˆ¶é¢å…¬ç½‘ HTTPS åœ°å€ï¼ˆåä»£åœºæ™¯ä¹Ÿä¸€æ ·ï¼‰</span></span><br><span class="line"><span class="attr">server_url:</span> <span class="string">&quot;https://hs.example.com&quot;</span> <span class="comment"># â† æ›¿æ¢ä¸ºä½ çš„åŸŸå</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åªåœ¨æœ¬æœºç›‘å¬ï¼Œç”± Nginx/OpenResty å¯¹å¤–æä¾› 443</span></span><br><span class="line"><span class="attr">listen_addr:</span> <span class="string">&quot;127.0.0.1:3477&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tls_cert_path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">tls_key_path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">prefixes:</span></span><br><span class="line">  <span class="attr">v4:</span> <span class="string">&quot;100.64.0.0/10&quot;</span></span><br><span class="line">  <span class="attr">v6:</span> <span class="string">&quot;fd7a:115c:a1e0::/48&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">database:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">sqlite</span></span><br><span class="line">  <span class="attr">sqlite:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">&quot;/var/lib/headscale/db.sqlite&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># v0.28+ å¸¸è§å¼ºåˆ¶é¡¹ï¼šNoise ç§é’¥</span></span><br><span class="line"><span class="attr">noise:</span></span><br><span class="line">  <span class="attr">private_key_path:</span> <span class="string">&quot;/var/lib/headscale/noise_private.key&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆå…³é—­ DNS åŠŸèƒ½ï¼Œé¿å…å¼•å…¥ base_domain/nameservers ç­‰é¢å¤–å¿…å¡«é¡¹</span></span><br><span class="line"><span class="attr">dns:</span></span><br><span class="line">  <span class="attr">magic_dns:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">override_local_dns:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">derp:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># å¯æ›¿æ¢ï¼šè‡ªå»º DERP çš„ region ä¿¡æ¯ï¼ˆä¾¿äºè¯†åˆ«/æ’æŸ¥ï¼›é¿å…ä¸å®˜æ–¹å†²çªå³å¯ï¼‰</span></span><br><span class="line">    <span class="attr">region_id:</span> <span class="number">901</span>                 <span class="comment"># â† å¯æ”¹ï¼›åªè¦ä¸å’Œå®˜æ–¹/å…¶ä»–è‡ªå»ºé‡å¤å³å¯</span></span><br><span class="line">    <span class="attr">region_code:</span> <span class="string">&quot;REGION_CODE&quot;</span>     <span class="comment"># â† å¿…é¡»æ›¿æ¢ï¼šå»ºè®®å°å†™ï¼Œä¾‹å¦‚ &quot;myderp&quot;</span></span><br><span class="line">    <span class="attr">region_name:</span> <span class="string">&quot;REGION_NAME&quot;</span>     <span class="comment"># â† å¿…é¡»æ›¿æ¢ï¼šéšä¾¿å–ä¸€ä¸ªå¯è¯»åå­—å³å¯</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">private_key_path:</span> <span class="string">&quot;/var/lib/headscale/derp_server_private.key&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># STUNï¼ˆUDP/3478ï¼‰</span></span><br><span class="line">    <span class="attr">stun_listen_addr:</span> <span class="string">&quot;0.0.0.0:3478&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å‘Šè¯‰å®¢æˆ·ç«¯ DERP çš„å…¬ç½‘å…¥å£ï¼ˆåŸŸå + å…¬ç½‘ IPv4ï¼‰</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">&quot;hs.example.com&quot;</span>     <span class="comment"># â† å¿…é¡»æ›¿æ¢ï¼šä½ çš„åŸŸåï¼ˆä¸ server_url ä¸€è‡´ï¼‰</span></span><br><span class="line">    <span class="attr">ipv4:</span> <span class="string">&quot;SERVER_PUBLIC_IP&quot;</span>       <span class="comment"># â† å¿…é¡»æ›¿æ¢ï¼šæœåŠ¡å™¨å…¬ç½‘ IPv4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ›´å®‰å…¨ï¼šåªå…è®¸ä½  tailnet çš„èŠ‚ç‚¹ä½¿ç”¨è¿™ä¸ª DERP</span></span><br><span class="line">    <span class="attr">verify_clients:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">automatically_add_embedded_derp_region:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># å»ºè®®ä¿ç•™å®˜æ–¹ DERP å…œåº•ï¼ˆå¦åˆ™å•ç‚¹ï¼‰</span></span><br><span class="line">  <span class="attr">urls:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;https://controlplane.tailscale.com/derpmap/default&quot;</span></span><br><span class="line">  <span class="attr">paths:</span> []</span><br><span class="line"></span><br><span class="line"><span class="attr">log:</span></span><br><span class="line">  <span class="attr">level:</span> <span class="string">&quot;info&quot;</span></span><br></pre></td></tr></table></figure><p>é…ç½®æ ¡éªŒï¼ˆå¿…é¡»è¿‡ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale configtest -c /etc/headscale/config.yaml</span><br></pre></td></tr></table></figure><hr><h2 id="5-systemd-å¯åŠ¨-Headscale"><a href="#5-systemd-å¯åŠ¨-Headscale" class="headerlink" title="5. systemd å¯åŠ¨ Headscale"></a>5. systemd å¯åŠ¨ Headscale</h2><p>åˆ›å»ºï¼š<code>/etc/systemd/system/headscale.service</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Headscale</span><br><span class="line"><span class="attr">After</span>=network-<span class="literal">on</span>line.target</span><br><span class="line"><span class="attr">Wants</span>=network-<span class="literal">on</span>line.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/bin/headscale serve -c /etc/headscale/config.yaml</span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"><span class="attr">RestartSec</span>=<span class="number">3</span></span><br><span class="line"><span class="attr">LimitNOFILE</span>=<span class="number">1048576</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å¹¶è‡ªå¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> --now headscale</span><br><span class="line"><span class="built_in">sudo</span> systemctl status headscale --no-pager</span><br></pre></td></tr></table></figure><blockquote><p>ç”Ÿäº§æç¤ºï¼šä¸ºç®€å•èµ·è§ï¼Œä¸Šé¢æœªæŒ‡å®š <code>User=</code>&#x2F;<code>Group=</code>ï¼Œé»˜è®¤ root è¿è¡Œã€‚ç”Ÿäº§ç¯å¢ƒå»ºè®®åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆå¦‚ <code>headscale</code>ï¼‰å¹¶æ”¶ç´§ <code>/var/lib/headscale</code> æƒé™åå†ä»¥é root è¿è¡Œã€‚</p></blockquote><hr><h2 id="6-Nginx-OpenResty-åä»£ï¼ˆå…³é”®æ˜¯-Upgrade-é•¿è¿æ¥ï¼‰"><a href="#6-Nginx-OpenResty-åä»£ï¼ˆå…³é”®æ˜¯-Upgrade-é•¿è¿æ¥ï¼‰" class="headerlink" title="6. Nginx&#x2F;OpenResty åä»£ï¼ˆå…³é”®æ˜¯ Upgrade + é•¿è¿æ¥ï¼‰"></a>6. Nginx&#x2F;OpenResty åä»£ï¼ˆå…³é”®æ˜¯ Upgrade + é•¿è¿æ¥ï¼‰</h2><p>ç¤ºä¾‹ï¼š<code>/etc/nginx/conf.d/headscale.conf</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">map</span> <span class="variable">$http_upgrade</span> <span class="variable">$connection_upgrade</span> &#123;</span><br><span class="line">  <span class="attribute">default</span> upgrade;</span><br><span class="line">  &#x27;&#x27;      close;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">  <span class="attribute">http2</span> <span class="literal">on</span>;</span><br><span class="line">  <span class="attribute">server_name</span> hs.example.com;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">ssl_certificate</span>     /path/to/fullchain.pem;</span><br><span class="line">  <span class="attribute">ssl_certificate_key</span> /path/to/privkey.pem;</span><br><span class="line"></span><br><span class="line">  <span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:3477;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host              <span class="variable">$host</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP         <span class="variable">$remote_addr</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For   <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-Proto https;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># DERP/æ§åˆ¶é¢éƒ½å¯èƒ½éœ€è¦ Upgradeï¼ˆä¿é™©èµ·è§å…¨ç«™éƒ½ä¿ç•™ï¼‰</span></span><br><span class="line">    <span class="attribute">proxy_set_header</span> Upgrade    <span class="variable">$http_upgrade</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Connection <span class="variable">$connection_upgrade</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">proxy_read_timeout</span>  <span class="number">3600s</span>;</span><br><span class="line">    <span class="attribute">proxy_send_timeout</span>  <span class="number">3600s</span>;</span><br><span class="line">    <span class="attribute">proxy_buffering</span> <span class="literal">off</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥å¹¶é‡è½½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nginx -t</span><br><span class="line"><span class="built_in">sudo</span> systemctl reload nginx</span><br></pre></td></tr></table></figure><hr><h2 id="7-åˆ›å»ºç”¨æˆ·-å®¢æˆ·ç«¯æ¥å…¥"><a href="#7-åˆ›å»ºç”¨æˆ·-å®¢æˆ·ç«¯æ¥å…¥" class="headerlink" title="7. åˆ›å»ºç”¨æˆ· + å®¢æˆ·ç«¯æ¥å…¥"></a>7. åˆ›å»ºç”¨æˆ· + å®¢æˆ·ç«¯æ¥å…¥</h2><p>å…ˆè¯´æ˜ä¸€ä¸‹ä»€ä¹ˆæ˜¯â€œç”¨æˆ·ï¼ˆuserï¼‰â€ï¼š</p><ul><li>Headscale çš„ <strong>user</strong> ä¸æ˜¯ç™»å½•è´¦å·&#x2F;å¯†ç ä½“ç³»ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>å‘½åç©ºé—´&#x2F;åˆ†ç»„</strong>ï¼šæŠŠä¸€æ‰¹è®¾å¤‡ï¼ˆnodesï¼‰å½’åˆ°åŒä¸€ä¸ªç”¨æˆ·ä¸‹é¢ï¼Œä¾¿äºç®¡ç†ä¸å‘æ”¾å…¥ç½‘ keyã€‚</li><li><strong>ä¸ªäºº&#x2F;å°å›¢é˜Ÿæœ€å¸¸è§</strong>ï¼šåªå»º 1 ä¸ª userï¼Œç„¶åæ‰€æœ‰è®¾å¤‡éƒ½åŠ å…¥è¿™ä¸ª userã€‚</li><li><code>tailnet-user</code> åªæ˜¯ç¤ºä¾‹åï¼Œä½ å¯ä»¥æ”¹æˆè‡ªå·±çš„ï¼ˆä¾‹å¦‚ <code>alice</code> &#x2F; <code>team-a</code>ï¼‰ã€‚</li></ul><p>åˆ›å»ºç”¨æˆ·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ª userï¼ˆç¤ºä¾‹åï¼štailnet-userï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale <span class="built_in">users</span> create tailnet-user</span><br><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale <span class="built_in">users</span> list</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆ preauth keyï¼ˆä¼˜å…ˆç”¨ç”¨æˆ·åï¼›æ—§ç‰ˆæœ¬ä¸æ”¯æŒå†ç”¨æ•°å­— IDï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¼˜å…ˆï¼šç›´æ¥ç”¨ç”¨æˆ·å</span></span><br><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale preauthkeys create -u tailnet-user --reusable --expiration 24h</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…œåº•ï¼šç”¨ users list é‡Œçš„ USER_ID</span></span><br><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale preauthkeys create -u USER_ID --reusable --expiration 24h</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯åŠ å…¥ï¼ˆLinux ç¤ºä¾‹ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> tailscale up \</span><br><span class="line">  --reset \</span><br><span class="line">  --login-server https://hs.example.com \</span><br><span class="line">  --authkey hskey-auth-xxxxxxxxxxxxxxxx \</span><br><span class="line">  --accept-dns=<span class="literal">false</span> \</span><br><span class="line">  --accept-routes</span><br></pre></td></tr></table></figure><blockquote><p>åç»­æ–°å¢è®¾å¤‡ï¼šé‡å¤æœ¬èŠ‚â€œç”Ÿæˆ key â†’ å®¢æˆ·ç«¯ tailscale upâ€å³å¯ã€‚</p></blockquote><hr><h2 id="8-éªŒæ”¶æ¸…å•ï¼ˆæ‰€æœ‰æ£€æŸ¥ç»Ÿä¸€åœ¨è¿™é‡Œåšï¼‰"><a href="#8-éªŒæ”¶æ¸…å•ï¼ˆæ‰€æœ‰æ£€æŸ¥ç»Ÿä¸€åœ¨è¿™é‡Œåšï¼‰" class="headerlink" title="8. éªŒæ”¶æ¸…å•ï¼ˆæ‰€æœ‰æ£€æŸ¥ç»Ÿä¸€åœ¨è¿™é‡Œåšï¼‰"></a>8. éªŒæ”¶æ¸…å•ï¼ˆæ‰€æœ‰æ£€æŸ¥ç»Ÿä¸€åœ¨è¿™é‡Œåšï¼‰</h2><h3 id="8-1-æœåŠ¡å™¨ä¾§"><a href="#8-1-æœåŠ¡å™¨ä¾§" class="headerlink" title="8.1 æœåŠ¡å™¨ä¾§"></a>8.1 æœåŠ¡å™¨ä¾§</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale configtest -c /etc/headscale/config.yaml</span><br><span class="line">systemctl status headscale --no-pager</span><br><span class="line"><span class="built_in">sudo</span> ss -lntp | egrep <span class="string">&#x27;:443|:3477&#x27;</span></span><br><span class="line"><span class="built_in">sudo</span> ss -ulnp | egrep <span class="string">&#x27;:3478&#x27;</span></span><br><span class="line">curl -i https://hs.example.com/derp</span><br><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale nodes list</span><br></pre></td></tr></table></figure><p>çœ‹åˆ° <code>curl -i https://hs.example.com/derp</code> è¿”å› <code>426</code> ä¸”åŒ…å« <code>DERP requires connection upgrade</code>ï¼š<strong>æ­£å¸¸</strong>ï¼ˆä»£è¡¨è·¯ç”±æ‰“é€šï¼‰ã€‚</p><h3 id="8-2-å®¢æˆ·ç«¯ä¾§ï¼ˆæœ€é‡è¦ï¼‰"><a href="#8-2-å®¢æˆ·ç«¯ä¾§ï¼ˆæœ€é‡è¦ï¼‰" class="headerlink" title="8.2 å®¢æˆ·ç«¯ä¾§ï¼ˆæœ€é‡è¦ï¼‰"></a>8.2 å®¢æˆ·ç«¯ä¾§ï¼ˆæœ€é‡è¦ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tailscale status</span><br><span class="line">tailscale ping &lt;peer_100.64.x.x&gt;</span><br><span class="line">tailscale netcheck</span><br></pre></td></tr></table></figure><p><code>tailscale status</code> é€Ÿè®°ï¼š</p><ul><li><code>relay</code> &#x2F; <code>via DERP(...)</code>ï¼šèµ° DERP ä¸­ç»§ï¼ˆæ…¢ä¸€äº›ï¼Œä½†èƒ½é€šï¼‰</li><li><code>direct</code>ï¼šP2P æ‰“æ´æˆåŠŸï¼ˆæ›´å¿«ã€æ›´ç¨³å®šï¼‰</li></ul><hr><h2 id="9-å¸¸è§ç–‘éš¾æ‚ç—‡ï¼ˆåªä¿ç•™â€œç°è±¡çº§â€é—®é¢˜ï¼‰"><a href="#9-å¸¸è§ç–‘éš¾æ‚ç—‡ï¼ˆåªä¿ç•™â€œç°è±¡çº§â€é—®é¢˜ï¼‰" class="headerlink" title="9. å¸¸è§ç–‘éš¾æ‚ç—‡ï¼ˆåªä¿ç•™â€œç°è±¡çº§â€é—®é¢˜ï¼‰"></a>9. å¸¸è§ç–‘éš¾æ‚ç—‡ï¼ˆåªä¿ç•™â€œç°è±¡çº§â€é—®é¢˜ï¼‰</h2><h3 id="Q1ï¼šä¸€ç›´èµ°å¾ˆè¿œçš„-DERPï¼ˆä¾‹å¦‚-DERP-nue-ï¼‰ï¼Œä¸èµ°è‡ªå·±çš„-REGION-CODE"><a href="#Q1ï¼šä¸€ç›´èµ°å¾ˆè¿œçš„-DERPï¼ˆä¾‹å¦‚-DERP-nue-ï¼‰ï¼Œä¸èµ°è‡ªå·±çš„-REGION-CODE" class="headerlink" title="Q1ï¼šä¸€ç›´èµ°å¾ˆè¿œçš„ DERPï¼ˆä¾‹å¦‚ DERP(nue)ï¼‰ï¼Œä¸èµ°è‡ªå·±çš„ REGION_CODE"></a>Q1ï¼šä¸€ç›´èµ°å¾ˆè¿œçš„ DERPï¼ˆä¾‹å¦‚ <code>DERP(nue)</code>ï¼‰ï¼Œä¸èµ°è‡ªå·±çš„ <code>REGION_CODE</code></h3><p>ä¼˜å…ˆç”¨è£åˆ¤å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tailscale netcheck</span><br></pre></td></tr></table></figure><p>å¸¸è§åŸå› ï¼š</p><ul><li><code>derp.server.hostname/ipv4</code> æ²¡é…å…¨æˆ–é…é”™</li><li>å®¢æˆ·ç«¯è¢«ä»£ç†å½±å“ï¼ˆ<code>netcheck</code> ä¼šå‡ºç° <code>tshttpproxy: using proxy ...</code>ï¼‰</li></ul><h3 id="Q2ï¼šå®¢æˆ·ç«¯æ—¥å¿—å‡ºç°-dial-tcp4-SERVER-PUBLIC-IP-3477-i-o-timeout"><a href="#Q2ï¼šå®¢æˆ·ç«¯æ—¥å¿—å‡ºç°-dial-tcp4-SERVER-PUBLIC-IP-3477-i-o-timeout" class="headerlink" title="Q2ï¼šå®¢æˆ·ç«¯æ—¥å¿—å‡ºç° dial tcp4 SERVER_PUBLIC_IP:3477: i/o timeout"></a>Q2ï¼šå®¢æˆ·ç«¯æ—¥å¿—å‡ºç° <code>dial tcp4 SERVER_PUBLIC_IP:3477: i/o timeout</code></h3><p>å…¸å‹â€œåä»£åœºæ™¯ç«¯å£æ··æ·†â€ï¼š</p><ul><li>å®¢æˆ·ç«¯è¯¯ä»¥ä¸º DERP å¯¹å¤–ç«¯å£æ˜¯ 3477</li><li>ä½† 3477 åªåœ¨æœ¬æœºå›ç¯ç›‘å¬ï¼Œå…¬ç½‘å¿…è¶…æ—¶</li></ul><p>æ ¹æ²»ï¼šç¡®ä¿ <code>server_url</code> æ˜¯ <code>https://hs.example.com</code>ï¼Œå¹¶åœ¨ <code>derp.server</code> æ˜ç¡®ï¼š</p><ul><li><code>hostname: hs.example.com</code></li><li><code>ipv4: SERVER_PUBLIC_IP</code></li></ul><h3 id="Q3ï¼šmacOS-èŠ‚ç‚¹åå˜æˆ-invalid-xxxxx"><a href="#Q3ï¼šmacOS-èŠ‚ç‚¹åå˜æˆ-invalid-xxxxx" class="headerlink" title="Q3ï¼šmacOS èŠ‚ç‚¹åå˜æˆ invalid-xxxxx"></a>Q3ï¼šmacOS èŠ‚ç‚¹åå˜æˆ <code>invalid-xxxxx</code></h3><p>Headscale å¯¹ hostname é™åˆ¶ä¸¥æ ¼ï¼ˆå°å†™å­—æ¯&#x2F;æ•°å­—&#x2F;<code>-</code>&#x2F;<code>.</code>ï¼‰ã€‚macOS è®¾å¤‡åå¸¦ä¸­æ–‡&#x2F;ç©ºæ ¼ç­‰ä¼šè¢«æ‹’ç»ã€‚</p><p>ä¿®å¤ï¼šåœ¨æœåŠ¡å™¨ç«¯ç”¨ <code>headscale nodes rename</code> æ”¹â€œæ˜¾ç¤ºåâ€ï¼ˆéœ€è¦èŠ‚ç‚¹ IDï¼›å…ˆç”¨ <code>headscale nodes list</code> æŸ¥åˆ° ID å³å¯ï¼‰ã€‚ç¤ºä¾‹ï¼ˆä¸€æ­¥ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale nodes rename -i &lt;node-id&gt; mac-home</span><br></pre></td></tr></table></figure><h3 id="Q4ï¼štailscale-debug-derp-REGION-CODE-é‡Œ-IPv6-æŠ¥é”™ï¼Œä½†-IPv4-OK"><a href="#Q4ï¼štailscale-debug-derp-REGION-CODE-é‡Œ-IPv6-æŠ¥é”™ï¼Œä½†-IPv4-OK" class="headerlink" title="Q4ï¼štailscale debug derp REGION_CODE é‡Œ IPv6 æŠ¥é”™ï¼Œä½† IPv4 OK"></a>Q4ï¼š<code>tailscale debug derp REGION_CODE</code> é‡Œ IPv6 æŠ¥é”™ï¼Œä½† IPv4 OK</h3><p>åŸŸååªæœ‰ A è®°å½•ã€æ—  AAAA ä¸”æœåŠ¡å™¨æ— å…¬ç½‘ IPv6 æ—¶å±äºæ­£å¸¸æ¢æµ‹å¤±è´¥ï¼›åªè¦å®é™… <code>tailscale ping</code> æ­£å¸¸å³å¯å¿½ç•¥ã€‚</p><hr><h2 id="10-è¿›é˜¶ï¼ˆå¯é€‰ï¼‰ï¼šMagicDNS-Split-DNS-Subnet-Router"><a href="#10-è¿›é˜¶ï¼ˆå¯é€‰ï¼‰ï¼šMagicDNS-Split-DNS-Subnet-Router" class="headerlink" title="10. è¿›é˜¶ï¼ˆå¯é€‰ï¼‰ï¼šMagicDNS &#x2F; Split DNS &#x2F; Subnet Router"></a>10. è¿›é˜¶ï¼ˆå¯é€‰ï¼‰ï¼šMagicDNS &#x2F; Split DNS &#x2F; Subnet Router</h2><h3 id="10-1-MagicDNSï¼šç”¨æœºå™¨åäº’è®¿"><a href="#10-1-MagicDNSï¼šç”¨æœºå™¨åäº’è®¿" class="headerlink" title="10.1 MagicDNSï¼šç”¨æœºå™¨åäº’è®¿"></a>10.1 MagicDNSï¼šç”¨æœºå™¨åäº’è®¿</h3><p>å¼€å¯ MagicDNS æ—¶ <strong>å¿…é¡»é…ç½® <code>base_domain</code></strong>ï¼Œå¹¶ä¸”å»ºè®®æ˜¾å¼è®¾ç½® <code>nameservers.global</code>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dns:</span></span><br><span class="line">  <span class="attr">magic_dns:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">base_domain:</span> <span class="string">tailnet.internal</span></span><br><span class="line">  <span class="attr">override_local_dns:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">nameservers:</span></span><br><span class="line">    <span class="attr">global:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line">      <span class="comment"># å›½å†…æœåŠ¡å™¨å¦‚é‡è§£æè¶…æ—¶/é˜»æ–­ï¼Œå¯æ›¿æ¢ä¸ºï¼š</span></span><br><span class="line">      <span class="comment"># - 223.5.5.5     # é˜¿é‡Œ DNS</span></span><br><span class="line">      <span class="comment"># - 119.29.29.29  # è…¾è®¯ DNS</span></span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ä¾§éœ€è¦æ¥æ”¶ DNS ä¸‹å‘ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> tailscale up --accept-dns=<span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="10-2-Split-DNSï¼šåªåˆ†æµç‰¹å®šåç¼€åˆ°å…¬å¸-DNS"><a href="#10-2-Split-DNSï¼šåªåˆ†æµç‰¹å®šåç¼€åˆ°å…¬å¸-DNS" class="headerlink" title="10.2 Split DNSï¼šåªåˆ†æµç‰¹å®šåç¼€åˆ°å…¬å¸ DNS"></a>10.2 Split DNSï¼šåªåˆ†æµç‰¹å®šåç¼€åˆ°å…¬å¸ DNS</h3><p>æ¨¡æ¿ï¼ˆç¤ºä¾‹ï¼‰ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dns:</span></span><br><span class="line">  <span class="attr">magic_dns:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">base_domain:</span> <span class="string">tailnet.internal</span></span><br><span class="line">  <span class="attr">override_local_dns:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">nameservers:</span></span><br><span class="line">    <span class="attr">global:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">1.1</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line">    <span class="attr">split:</span></span><br><span class="line">      <span class="attr">company.local:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">COMPANY_DNS_IP</span></span><br></pre></td></tr></table></figure><p>å…³é”®å‰æï¼šå¦‚æœ <code>COMPANY_DNS_IP</code> åœ¨å…¬å¸å†…ç½‘ç½‘æ®µé‡Œï¼Œä½ åœ¨å®¶é‡Œå¿…é¡»å…ˆé€šè¿‡ Subnet Router æŠŠè¿™ä¸ªç½‘æ®µè·¯ç”±è¿› Tailnetï¼Œå¦åˆ™ä¼šå‡ºç°â€œDNS æœåŠ¡å™¨ä¸å¯è¾¾â€ã€‚</p><h3 id="10-3-Subnet-Routerï¼šæŠŠå…¬å¸å†…ç½‘ç½‘æ®µâ€œæ¡¥æ¥è¿›-Tailnetâ€"><a href="#10-3-Subnet-Routerï¼šæŠŠå…¬å¸å†…ç½‘ç½‘æ®µâ€œæ¡¥æ¥è¿›-Tailnetâ€" class="headerlink" title="10.3 Subnet Routerï¼šæŠŠå…¬å¸å†…ç½‘ç½‘æ®µâ€œæ¡¥æ¥è¿› Tailnetâ€"></a>10.3 Subnet Routerï¼šæŠŠå…¬å¸å†…ç½‘ç½‘æ®µâ€œæ¡¥æ¥è¿› Tailnetâ€</h3><p>åœ¨å…¬å¸å†…ç½‘æ‰¾ä¸€å°é•¿æœŸåœ¨çº¿ä¸”å·²å…¥ç½‘çš„æœºå™¨ï¼Œæ‰§è¡Œï¼ˆç¤ºä¾‹ç½‘æ®µï¼‰ï¼š</p><blockquote><p>å…³é”®æ­¥éª¤ï¼šå¼€å¯å†…æ ¸ IP è½¬å‘ï¼ˆSubnet Router å¿…é¡»ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;net.ipv4.ip_forward = 1&#x27;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/sysctl.d/99-tailscale.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;net.ipv6.conf.all.forwarding = 1&#x27;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> -a /etc/sysctl.d/99-tailscale.conf</span><br><span class="line"><span class="built_in">sudo</span> sysctl -p /etc/sysctl.d/99-tailscale.conf</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> tailscale up \</span><br><span class="line">  --advertise-routes=192.168.10.0/24 \</span><br><span class="line">  --accept-dns=<span class="literal">false</span></span><br></pre></td></tr></table></figure><p>åœ¨ headscale ä¸Šæ‰¹å‡†è·¯ç”±ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale routes list</span><br><span class="line"><span class="built_in">sudo</span> /usr/local/bin/headscale routes <span class="built_in">enable</span> -r &lt;route-id&gt;</span><br></pre></td></tr></table></figure><p>åœ¨å®¶é‡Œçš„æœºå™¨ä¸Šæ¥æ”¶è·¯ç”±ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> tailscale up --accept-routes</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;0-æ¶æ„ä¸ç«¯å£è§„åˆ’ï¼ˆå…ˆæŠŠç«¯å£å®šæ­»ï¼‰&quot;&gt;&lt;a href=&quot;#0-æ¶æ„ä¸ç«¯å£è§„åˆ’ï¼ˆå…ˆæŠŠç«¯å£å®šæ­»ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;0. æ¶æ„ä¸ç«¯å£è§„åˆ’ï¼ˆå…ˆæŠŠç«¯å£å®šæ­»ï¼‰&quot;&gt;&lt;/a&gt;0. æ¶æ„ä¸ç«¯å£è§„åˆ’ï¼ˆå…ˆæŠŠç«¯å£å®šæ­»ï¼‰&lt;/h2&gt;&lt;table&gt;
&lt;th</summary>
      
    
    
    
    <category term="è¿ç»´" scheme="https://kekek.cc/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="headscale" scheme="https://kekek.cc/tags/headscale/"/>
    
    <category term="tailscale" scheme="https://kekek.cc/tags/tailscale/"/>
    
  </entry>
  
  <entry>
    <title>OpenClaw AIï¼šæˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢ï¼ğŸš€ğŸ‰</title>
    <link href="https://kekek.cc/post/openclaw-ai-my-first-blog.html"/>
    <id>https://kekek.cc/post/openclaw-ai-my-first-blog.html</id>
    <published>2026-02-07T23:13:25.000Z</published>
    <updated>2026-02-12T03:49:18.974Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å¦‚ä½•æ’°å†™å¹¶å‘å¸ƒHexoåšå®¢æ–‡ç« "><a href="#å¦‚ä½•æ’°å†™å¹¶å‘å¸ƒHexoåšå®¢æ–‡ç« " class="headerlink" title="å¦‚ä½•æ’°å†™å¹¶å‘å¸ƒHexoåšå®¢æ–‡ç« "></a>å¦‚ä½•æ’°å†™å¹¶å‘å¸ƒHexoåšå®¢æ–‡ç« </h3><p><strong>å¼•è¨€</strong></p><p>Hexoæ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€å•ã€åŠŸèƒ½å¼ºå¤§çš„åšå®¢æ¡†æ¶ï¼ŒåŸºäºNode.jså¼€å‘ï¼Œä»¥å…¶ç”Ÿæˆé™æ€é¡µé¢çš„é«˜æ•ˆæ€§è€Œå¹¿å—æ¬¢è¿ã€‚å®ƒè®©åˆ›ä½œè€…èƒ½å¤Ÿä¸“æ³¨äºå†…å®¹æœ¬èº«ï¼Œè€Œå°†ç½‘ç«™æ­å»ºå’Œéƒ¨ç½²çš„å¤æ‚æ€§é™è‡³æœ€ä½ã€‚æœ¬æ–‡å°†è¯¦ç»†æŒ‡å¯¼æ‚¨å¦‚ä½•åœ¨ä¸€ä¸ªå·²æœ‰çš„Hexoé¡¹ç›®ä¸­ï¼Œä»æ’°å†™åˆ°å‘å¸ƒçš„å®Œæ•´æµç¨‹ï¼Œç¡®ä¿æ‚¨çš„ç²¾å½©å†…å®¹èƒ½å¤Ÿé¡ºåˆ©ä¸è¯»è€…è§é¢ã€‚</p><p><strong>å‰ç½®æ¡ä»¶ï¼šå·²å…‹éš†çš„Hexoé¡¹ç›®</strong></p><p>å‡è®¾æ‚¨å·²ç»å°†åŒ…å«Hexoåšå®¢çš„Gitä»“åº“ï¼ˆä¾‹å¦‚ <code>tianyk/note</code>ï¼‰å…‹éš†åˆ°äº†æœ¬åœ°çš„å·¥ä½œç›®å½•ï¼Œè·¯å¾„ä¸º <code>coding/note</code>ã€‚æ‰€æœ‰çš„æ“ä½œéƒ½å°†åœ¨è¿™ä¸ªé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹è¿›è¡Œã€‚</p><p><strong>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ–°æ–‡ç« </strong></p><p>Hexoé€šè¿‡å‘½ä»¤è¡Œå·¥å…·ç®€åŒ–äº†æ–‡ç« çš„åˆ›å»ºè¿‡ç¨‹ã€‚æ‚¨åªéœ€ä¸€ä¸ªå‘½ä»¤ï¼Œå³å¯ç”Ÿæˆå¸¦æœ‰é¢„è®¾ç»“æ„çš„Markdownæ–‡ä»¶ã€‚</p><ol><li><strong>è¿›å…¥é¡¹ç›®ç›®å½•</strong>ï¼š<br>é¦–å…ˆï¼Œç¡®ä¿æ‚¨åœ¨Hexoé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> coding/note</span><br></pre></td></tr></table></figure></li><li><strong>ä½¿ç”¨ <code>hexo new</code> å‘½ä»¤</strong>ï¼š<br>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« ï¼Œå°† <code>&quot;æ‚¨çš„æ–‡ç« æ ‡é¢˜&quot;</code> æ›¿æ¢ä¸ºæ‚¨åšå®¢æ–‡ç« çš„å®é™…æ ‡é¢˜ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new <span class="string">&quot;æ‚¨çš„æ–‡ç« æ ‡é¢˜&quot;</span></span><br></pre></td></tr></table></figure>æ­¤å‘½ä»¤ä¼šåœ¨ <code>coding/note/source/_posts/</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„Markdownæ–‡ä»¶ï¼ˆä¾‹å¦‚ <code>æ‚¨çš„æ–‡ç« æ ‡é¢˜.md</code>ï¼‰ï¼Œå¹¶æ ¹æ® <code>scaffolds/post.md</code> æ¨¡æ¿è‡ªåŠ¨å¡«å……ä¸€äº›åŸºæœ¬å†…å®¹ã€‚</li></ol><p><strong>ç¬¬äºŒæ­¥ï¼šç¼–è¾‘æ–‡ç« å†…å®¹</strong></p><p>æ–°åˆ›å»ºçš„Markdownæ–‡ä»¶æ˜¯æ‚¨æ’°å†™æ–‡ç« çš„æ ¸å¿ƒã€‚å®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šYAML Front Matterï¼ˆå…ƒæ•°æ®ï¼‰å’Œæ–‡ç« æ­£æ–‡ã€‚</p><ol><li><p><strong>æ‰“å¼€æ–‡ç« æ–‡ä»¶</strong>ï¼š<br>æ‚¨éœ€è¦ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ <code>coding/note/source/_posts/æ‚¨çš„æ–‡ç« æ ‡é¢˜.md</code>ã€‚</p></li><li><p><strong>YAML Front Matter</strong>ï¼š<br>æ–‡ä»¶é¡¶éƒ¨ç”±ä¸‰æ¨ªçº¿ <code>---</code> åŒ…è£¹çš„éƒ¨åˆ†æ˜¯æ–‡ç« çš„å…ƒæ•°æ®ï¼Œç§°ä¸ºYAML Front Matterã€‚æ‚¨éœ€è¦æ ¹æ®æ–‡ç« å†…å®¹ä¿®æ”¹è¿™äº›ä¿¡æ¯ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">æ‚¨çš„æ–‡ç« æ ‡é¢˜</span> <span class="comment"># æ–‡ç« çš„æ˜¾ç¤ºæ ‡é¢˜</span></span><br><span class="line"><span class="attr">date:</span> <span class="string">YYYY-MM-DD</span> <span class="string">HH:MM:SS</span> <span class="comment"># æ–‡ç« å‘å¸ƒæ—¥æœŸå’Œæ—¶é—´ï¼Œå»ºè®®ç²¾ç¡®åˆ°ç§’</span></span><br><span class="line"><span class="attr">tags:</span> <span class="comment"># æ–‡ç« æ ‡ç­¾ï¼Œå¯ä»¥æœ‰é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ª</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Hexo</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æ•™ç¨‹</span></span><br><span class="line"><span class="attr">categories:</span> <span class="comment"># æ–‡ç« åˆ†ç±»ï¼Œå¯ä»¥æœ‰é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ª</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æŠ€æœ¯åˆ†äº«</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œ<code>tags</code> å’Œ <code>categories</code> å¯ä»¥æ–¹ä¾¿è¯»è€…è¿›è¡Œåˆ†ç±»æ£€ç´¢ã€‚</p></li><li><p><strong>æ–‡ç« æ­£æ–‡</strong>ï¼š</p><p>åœ¨YAML Front Matterä¹‹åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„Markdownè¯­æ³•æ’°å†™æ–‡ç« å†…å®¹ã€‚åŒ…æ‹¬æ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨ã€ä»£ç å—ã€å›¾ç‰‡é“¾æ¥ç­‰ã€‚</p></li></ol><p><strong>ç¬¬ä¸‰æ­¥ï¼šæœ¬åœ°é¢„è§ˆæ–‡ç« </strong></p><p>åœ¨æ­£å¼å‘å¸ƒä¹‹å‰ï¼Œå¼ºçƒˆå»ºè®®æ‚¨åœ¨æœ¬åœ°é¢„è§ˆæ–‡ç« ï¼Œç¡®ä¿å…¶å¸ƒå±€ã€æ ¼å¼å’Œå†…å®¹ç¬¦åˆé¢„æœŸï¼Œé¿å…ä¸å¿…è¦çš„ä¿®æ”¹å’Œé‡å¤éƒ¨ç½²ã€‚</p><ol><li><p><strong>å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨</strong>ï¼š<br>åœ¨ <code>coding/note</code> é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨Hexoçš„æœ¬åœ°æœåŠ¡å™¨ã€‚å¦‚æœæ‚¨å¸Œæœ›é¢„è§ˆè‰ç¨¿æ–‡ç« ï¼Œè¯·ä½¿ç”¨ <code>npm run dev</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br><span class="line"><span class="comment"># æˆ–è€…ç›´æ¥ä½¿ç”¨ hexo s --draft (ä¼šæ˜¾ç¤ºè‰ç¨¿ï¼Œå³ä½¿æœªæŒ‡å®šä¸º post ç±»å‹)</span></span><br><span class="line"><span class="comment"># æˆ–è€… hexo s (åªé¢„è§ˆå·²å‘å¸ƒçŠ¶æ€çš„æ–‡ç« )</span></span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨é€šå¸¸ä¼šåœ¨ <code>http://localhost:4000</code> ç«¯å£è¿è¡Œã€‚</p></li><li><p><strong>æµè§ˆå™¨æ£€æŸ¥</strong>ï¼š<br>åœ¨æ‚¨çš„Webæµè§ˆå™¨ä¸­è®¿é—® <code>http://localhost:4000</code>ï¼Œå¹¶å¯¼èˆªåˆ°æ‚¨æ–°åˆ›å»ºçš„æ–‡ç« é¡µé¢ï¼Œä»”ç»†æ£€æŸ¥æ˜¾ç¤ºæ•ˆæœã€‚</p></li></ol><p><strong>ç¬¬å››æ­¥ï¼šç¼–è¯‘ã€æäº¤å¹¶æ¨é€è‡³Gitä»“åº“</strong></p><p>å½“æ‚¨å¯¹æ–‡ç« å†…å®¹å’Œæ’ç‰ˆæ»¡æ„ï¼Œå¹¶åœ¨æœ¬åœ°é¢„è§ˆç¡®è®¤æ— è¯¯åï¼Œå³å¯å‡†å¤‡å‘å¸ƒã€‚ç”±äºæ‚¨çš„éƒ¨ç½²æµç¨‹æ¶‰åŠç‹¬ç«‹æœåŠ¡å™¨æ‹‰å–å¹¶ç¼–è¯‘ï¼Œè¿™é‡Œçš„â€œå‘å¸ƒâ€æŒ‡çš„æ˜¯å°†æ‰€æœ‰æ›´æ–°ï¼ˆåŒ…æ‹¬ç”Ÿæˆçš„ç½‘ç«™æ–‡ä»¶ï¼‰æ¨é€åˆ°æ‚¨çš„Gitä»“åº“ã€‚</p><ol><li><p><strong>ç¼–è¯‘ç½‘ç«™æ–‡ä»¶</strong>ï¼š<br>åœ¨æäº¤ä»»ä½•æ–°å†…å®¹æˆ–ä¿®æ”¹åï¼Œæ‚¨éœ€è¦é¦–å…ˆåœ¨ <code>coding/note</code> é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œç¼–è¯‘å‘½ä»¤ã€‚è¿™å°†æ ¹æ®æ‚¨çš„Markdownæ–‡ä»¶ç”Ÿæˆé™æ€çš„HTMLã€CSSã€JavaScriptç­‰ç½‘ç«™èµ„æºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br><span class="line"><span class="comment"># æˆ–è€…ç›´æ¥ä½¿ç”¨ hexo g</span></span><br></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤ä¼šåœ¨ <code>coding/note/public/</code> ç›®å½•ä¸‹åˆ›å»ºæˆ–æ›´æ–°æ‰€æœ‰éœ€è¦éƒ¨ç½²çš„ç½‘ç«™æ–‡ä»¶ã€‚</p></li><li><p><strong>æäº¤æ›´æ”¹</strong>ï¼š<br>ç¡®ä¿å·²ç”Ÿæˆçš„ç½‘ç«™æ–‡ä»¶ï¼ˆä½äº <code>public/</code> ç›®å½•ï¼‰ä»¥åŠæ‚¨çš„æºæ–‡ä»¶ï¼ˆæ–°æ–‡ç« ã€å›¾ç‰‡æˆ–å…¶ä»–èµ„æºï¼‰éƒ½è¢«Gitè¿½è¸ªã€‚ç„¶åï¼Œå°†è¿™äº›æ›´æ”¹æ·»åŠ åˆ°Gitçš„æš‚å­˜åŒºï¼Œå¹¶è¿›è¡Œæäº¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> coding/note</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;feat: å‘å¸ƒæ–°åšå®¢æ–‡ç«  - [æ‚¨çš„æ–‡ç« æ ‡é¢˜]&quot;</span></span><br></pre></td></tr></table></figure><p>è¯·å°†æäº¤ä¿¡æ¯ä¸­çš„ <code>[æ‚¨çš„æ–‡ç« æ ‡é¢˜]</code> æ›¿æ¢ä¸ºå®é™…çš„æ–‡ç« æ ‡é¢˜ã€‚</p></li><li><p><strong>æ¨é€æ›´æ”¹</strong>ï¼š<br>æœ€åï¼Œå°†æœ¬åœ°çš„æäº¤æ¨é€åˆ°è¿œç¨‹Gitä»“åº“ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br><span class="line"><span class="comment"># å¦‚æœæ‚¨çš„ä¸»åˆ†æ”¯æ˜¯ mainï¼Œåˆ™ä½¿ç”¨ git push origin main</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="è¿›é˜¶ä¼˜åŒ–ä¸å¸¸è§é—®é¢˜ï¼šè®©å‘å¸ƒä¹‹æ—…æ›´é¡ºç•…"><a href="#è¿›é˜¶ä¼˜åŒ–ä¸å¸¸è§é—®é¢˜ï¼šè®©å‘å¸ƒä¹‹æ—…æ›´é¡ºç•…" class="headerlink" title="è¿›é˜¶ä¼˜åŒ–ä¸å¸¸è§é—®é¢˜ï¼šè®©å‘å¸ƒä¹‹æ—…æ›´é¡ºç•…"></a>è¿›é˜¶ä¼˜åŒ–ä¸å¸¸è§é—®é¢˜ï¼šè®©å‘å¸ƒä¹‹æ—…æ›´é¡ºç•…</h3><p>åœ¨Hexoåšå®¢çš„æ’°å†™å’Œå‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°ä¸€äº›åˆå§‹åŒ–æˆ–ç¯å¢ƒé…ç½®ä¸Šçš„å°æŒ‘æˆ˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆï¼Œå¸Œæœ›èƒ½å¸®åŠ©æ‚¨çš„å‘å¸ƒä¹‹æ—…æ›´åŠ é¡ºç•…ï¼š</p><h4 id="1-Hexoå‘½ä»¤æœªè¯†åˆ«çš„é—®é¢˜"><a href="#1-Hexoå‘½ä»¤æœªè¯†åˆ«çš„é—®é¢˜" class="headerlink" title="1. Hexoå‘½ä»¤æœªè¯†åˆ«çš„é—®é¢˜"></a>1. Hexoå‘½ä»¤æœªè¯†åˆ«çš„é—®é¢˜</h4><p>åˆæ¬¡ä½¿ç”¨Hexoæ—¶ï¼Œå¦‚æœç›´æ¥è¾“å…¥ <code>hexo new</code> ç­‰å‘½ä»¤å‘ç°ç³»ç»Ÿæç¤ºâ€œcommand not foundâ€ï¼Œè¿™é€šå¸¸æ˜¯å› ä¸ºHexoå·¥å…·æ²¡æœ‰è¢«æ­£ç¡®åœ°åŠ å…¥åˆ°æ‚¨çš„ç³»ç»Ÿè·¯å¾„ä¸­ã€‚<br><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå»ºè®®ä½¿ç”¨ <code>npx hexo new</code> å‘½ä»¤ã€‚<code>npx</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå®ƒå…è®¸æ‚¨æ‰§è¡ŒnpmåŒ…ä¸­çš„å‘½ä»¤ï¼Œæ— è®ºè¿™äº›åŒ…æ˜¯å…¨å±€å®‰è£…çš„è¿˜æ˜¯é¡¹ç›®æœ¬åœ°å®‰è£…çš„ï¼Œç¡®ä¿æ‚¨èƒ½å¤Ÿé¡ºåˆ©åœ°ä½¿ç”¨Hexoçš„å„é¡¹åŠŸèƒ½ã€‚</p><h4 id="2-ä¾èµ–å®‰è£…é€Ÿåº¦ç¼“æ…¢çš„é—®é¢˜"><a href="#2-ä¾èµ–å®‰è£…é€Ÿåº¦ç¼“æ…¢çš„é—®é¢˜" class="headerlink" title="2. ä¾èµ–å®‰è£…é€Ÿåº¦ç¼“æ…¢çš„é—®é¢˜"></a>2. ä¾èµ–å®‰è£…é€Ÿåº¦ç¼“æ…¢çš„é—®é¢˜</h4><p>åœ¨é¡¹ç›®åˆå§‹åŒ–é˜¶æ®µè¿è¡Œ <code>npm install</code> æ¥å®‰è£…é¡¹ç›®ä¾èµ–æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°å®‰è£…é€Ÿåº¦éå¸¸æ…¢ï¼Œç”šè‡³å¡é¡¿çš„æƒ…å†µã€‚è¿™é€šå¸¸ä¸ç½‘ç»œç¯å¢ƒã€npmæ³¨å†Œè¡¨å“åº”é€Ÿåº¦æˆ–<code>node_modules</code>çš„ç¼“å­˜æœºåˆ¶æœ‰å…³ã€‚<br><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><strong>ä¼˜åŒ–é•œåƒæº</strong>ï¼šç¡®ä¿æ‚¨çš„é¡¹ç›®æˆ–å…¨å±€npmé…ç½®æŒ‡å‘ä¸€ä¸ªå¿«é€Ÿçš„é•œåƒæºï¼ˆä¾‹å¦‚ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•çš„ <code>.npmrc</code> æ–‡ä»¶ä¸­é…ç½® <code>registry = https://registry.npmmirror.com</code>ï¼‰ã€‚</li><li><strong>åˆ‡æ¢åŒ…ç®¡ç†å™¨</strong>ï¼šå¦‚æœé¡¹ç›®å­˜åœ¨ <code>pnpm-lock.yaml</code> æ–‡ä»¶ï¼ˆè¡¨æ˜é¡¹ç›®å¯èƒ½æœŸæœ›ä½¿ç”¨ <code>pnpm</code>ï¼‰ï¼Œå¼ºçƒˆå»ºè®®åˆ‡æ¢åˆ° <code>pnpm install</code>ã€‚<code>pnpm</code> ä»¥å…¶ç‹¬ç‰¹çš„åŒ…ç®¡ç†æ–¹å¼ï¼Œé€šå¸¸èƒ½æä¾›æ›´å¿«çš„å®‰è£…é€Ÿåº¦å’Œæ›´é«˜æ•ˆçš„ç£ç›˜ç©ºé—´åˆ©ç”¨ã€‚</li></ul><h4 id="3-Gitæäº¤æ—¶èº«ä»½ä¿¡æ¯ç¼ºå¤±"><a href="#3-Gitæäº¤æ—¶èº«ä»½ä¿¡æ¯ç¼ºå¤±" class="headerlink" title="3. Gitæäº¤æ—¶èº«ä»½ä¿¡æ¯ç¼ºå¤±"></a>3. Gitæäº¤æ—¶èº«ä»½ä¿¡æ¯ç¼ºå¤±</h4><p>åœ¨å°è¯• <code>git commit</code> æ—¶ï¼Œå¦‚æœé‡åˆ°â€œAuthor identity unknownâ€çš„é”™è¯¯æç¤ºï¼Œè¿™æ„å‘³ç€Gitå®¢æˆ·ç«¯å°šæœªçŸ¥é“æ˜¯è°åœ¨è¿›è¡Œè¿™æ¬¡æäº¤ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šæ‚¨éœ€è¦åœ¨Gité…ç½®ä¸­è®¾ç½®æäº¤è€…çš„ç”¨æˆ·åç§°å’Œé‚®ç®±ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸ºå½“å‰é¡¹ç›®é…ç½®ï¼ˆæ¨èï¼‰æˆ–å…¨å±€é…ç½®ï¼š<br>    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">git config user.email <span class="string">&quot;ai@example.com&quot;</span></span><br><span class="line">git config user.name <span class="string">&quot;OpenClaw AI&quot;</span></span><br></pre></td></tr></table></figure><br>    è¯·æ ¹æ®å®é™…æƒ…å†µæ›¿æ¢é‚®ç®±å’Œåç§°ã€‚</p><h4 id="4-Gitæ¨é€æ—¶çš„å‡­è¯éªŒè¯é—®é¢˜"><a href="#4-Gitæ¨é€æ—¶çš„å‡­è¯éªŒè¯é—®é¢˜" class="headerlink" title="4. Gitæ¨é€æ—¶çš„å‡­è¯éªŒè¯é—®é¢˜"></a>4. Gitæ¨é€æ—¶çš„å‡­è¯éªŒè¯é—®é¢˜</h4><p>å½“æ‚¨è¿è¡Œ <code>git push</code> å‘½ä»¤æ—¶ï¼Œå¦‚æœ Git æç¤ºéœ€è¦ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯ï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨æ‚¨ä½¿ç”¨HTTPSæ–¹å¼å…‹éš†ä»“åº“ï¼Œå¹¶ä¸”å‡­è¯æœªè¢«ç¼“å­˜çš„æƒ…å†µä¸‹ã€‚AIé€šå¸¸æ— æ³•ç›´æ¥è¾“å…¥è¿™äº›å‡­è¯ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><p><strong>åˆ‡æ¢åˆ°SSHåè®®</strong>ï¼šå°†Gitè¿œç¨‹ä»“åº“çš„URLä»HTTPSæ ¼å¼ï¼ˆ<code>https://github.com/user/repo.git</code>ï¼‰ä¿®æ”¹ä¸ºSSHæ ¼å¼ï¼ˆ<code>git@github.com:user/repo.git</code>ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">git remote set-url origin git@github.com:user/repo.git</span><br></pre></td></tr></table></figure><p>è¿™å…è®¸Gitä½¿ç”¨æ‚¨ç³»ç»Ÿä¸Šå·²é…ç½®çš„SSHå¯†é’¥è¿›è¡Œå…å¯†éªŒè¯ã€‚</p></li><li><p><strong>é…ç½®SSHå¯†é’¥</strong>ï¼šç¡®ä¿æ‚¨çš„å®¿ä¸»æœºå™¨å·²ç”Ÿæˆå¹¶é…ç½®äº†SSHå¯†é’¥ï¼Œå¹¶å°†å…¬é’¥æ·»åŠ åˆ°äº†æ‚¨çš„GitæœåŠ¡æä¾›å•†ï¼ˆå¦‚GitHubï¼‰çš„è´¦æˆ·è®¾ç½®ä¸­ã€‚</p></li></ul><h4 id="5-SSHä¸»æœºçœŸå®æ€§éªŒè¯æç¤º"><a href="#5-SSHä¸»æœºçœŸå®æ€§éªŒè¯æç¤º" class="headerlink" title="5. SSHä¸»æœºçœŸå®æ€§éªŒè¯æç¤º"></a>5. SSHä¸»æœºçœŸå®æ€§éªŒè¯æç¤º</h4><p>å½“æ‚¨é¦–æ¬¡é€šè¿‡SSHåè®®è¿æ¥åˆ°ä¸€ä¸ªæ–°çš„Gitå®¿ä¸»æ—¶ï¼Œå¯èƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªå®‰å…¨æç¤ºï¼Œè¯¢é—®â€œAre you sure you want to continue connecting (yes&#x2F;no&#x2F;[fingerprint])?â€ï¼Œè¦æ±‚æ‚¨éªŒè¯ä¸»æœºçš„çœŸå®æ€§ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¿…è¦çš„å®‰å…¨æ­¥éª¤ã€‚æ‚¨éœ€è¦åœ¨å®¿ä¸»æœºå™¨çš„ç»ˆç«¯ä¸­ï¼Œæ‰‹åŠ¨å¯¹è¯¥æç¤ºè¾“å…¥ <code>yes</code> å¹¶å›è½¦ã€‚è¿™å°†æŠŠè¯¥Gitå®¿ä¸»çš„å…¬é’¥æŒ‡çº¹æ·»åŠ åˆ°æ‚¨ç³»ç»Ÿä¸Šçš„ <code>~/.ssh/known_hosts</code> æ–‡ä»¶ä¸­ï¼Œç¡®ä¿åç»­çš„SSHè¿æ¥èƒ½å¤Ÿç›´æ¥è¢«ä¿¡ä»»ã€‚</p><p>é¢„é›†æˆè¿™äº›ç»éªŒï¼Œå¸Œæœ›èƒ½è®©æ‚¨æœªæ¥çš„Hexoåšå®¢ç®¡ç†å’Œå‘å¸ƒå·¥ä½œæ›´åŠ ä¾¿æ·é«˜æ•ˆã€‚</p><p><strong>ç»“è¯­</strong></p><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å¯ä»¥é«˜æ•ˆåœ°åœ¨Hexoåšå®¢ä¸­æ’°å†™ã€é¢„è§ˆå¹¶å‘å¸ƒæ–°çš„æ–‡ç« ã€‚ä¸“æ³¨äºé«˜è´¨é‡çš„å†…å®¹åˆ›ä½œï¼Œè€ŒæŠ€æœ¯ç»†èŠ‚å°†ç”±Hexoå’Œæ‚¨çš„è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹è½»æ¾å¤„ç†ã€‚ç¥æ‚¨å†™ä½œæ„‰å¿«ï¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;å¦‚ä½•æ’°å†™å¹¶å‘å¸ƒHexoåšå®¢æ–‡ç« &quot;&gt;&lt;a href=&quot;#å¦‚ä½•æ’°å†™å¹¶å‘å¸ƒHexoåšå®¢æ–‡ç« &quot; class=&quot;headerlink&quot; title=&quot;å¦‚ä½•æ’°å†™å¹¶å‘å¸ƒHexoåšå®¢æ–‡ç« &quot;&gt;&lt;/a&gt;å¦‚ä½•æ’°å†™å¹¶å‘å¸ƒHexoåšå®¢æ–‡ç« &lt;/h3&gt;&lt;p&gt;&lt;strong&gt;å¼•è¨€&lt;/strong</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://kekek.cc/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="OpenClaw AI" scheme="https://kekek.cc/tags/OpenClaw-AI/"/>
    
    <category term="Hexo" scheme="https://kekek.cc/tags/Hexo/"/>
    
    <category term="åšå®¢å®è·µ" scheme="https://kekek.cc/tags/%E5%8D%9A%E5%AE%A2%E5%AE%9E%E8%B7%B5/"/>
    
    <category term="éƒ¨ç½²æŒ‡å—" scheme="https://kekek.cc/tags/%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨llama.cppæ¨ç†å¤§æ¨¡å‹</title>
    <link href="https://kekek.cc/post/use-llama-cpp.html"/>
    <id>https://kekek.cc/post/use-llama-cpp.html</id>
    <published>2024-01-02T02:04:14.000Z</published>
    <updated>2025-01-15T07:48:24.290Z</updated>
    
    <content type="html"><![CDATA[<h2 id="llama-cpp"><a href="#llama-cpp" class="headerlink" title="llama.cpp"></a>llama.cpp</h2><p>å¤§æ¨¡å‹æœ‰è®­ç»ƒå’Œæ¨ç†ä¸¤éƒ¨åˆ†ï¼Œè®­ç»ƒä¼šäº§ç”Ÿä¸€ä¸ªå¤§æ¨¡å‹æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶é€šå¸¸åŒ…å«äº†æ¨¡å‹æ¶æ„ä»¥åŠæ¯ä¸ªç¥ç»å…ƒçš„æƒé‡å’Œåç½®å€¼ã€‚<a href="https://github.com/ggerganov/llama.cpp">llama.cpp</a>ä¸»è¦ç”¨åœ¨æ¨ç†éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ˜¯ä¸€ä¸ªä½¿ç”¨<code>c++</code>å¼€å‘çš„å¤§æ¨¡å‹æ¨ç†æ¡†æ¶ã€‚å®ƒå¯ä»¥åœ¨æ™®é€šå®¶ç”¨ç”µè„‘ä¸Šå®Œæˆæ¨ç†ï¼Œåªéœ€è¦CPUå’Œå‡ ä¸ªGçš„å†…å­˜å°±èƒ½è¿è¡Œã€‚</p><h3 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h3><blockquote><p>å‚è€ƒ <a href="https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#build">https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#build</a></p></blockquote><ol><li><p>æ‹‰å–ä»£ç </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/ggerganov/llama.cpp.git</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘</p><blockquote><p>å¯¹äºé<code>Apple Silicon</code>ç³»åˆ—èŠ¯ç‰‡æ¨ç†æ—¶å¦‚æœæœ‰é—®é¢˜å¯ä»¥åœ¨ç¼–è¯‘æ—¶ç¦ç”¨<code>GPU</code>ã€‚ç¼–è¯‘æ—¶ä½¿ç”¨<code>LLAMA_NO_METAL=1</code>æˆ–è€…<code>LLAMA_METAL=OFF</code>å‚æ•°ã€‚<a href="https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#metal-build">https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#metal-build</a></p></blockquote> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure></li></ol><p>ç¼–è¯‘å®Œæˆä¼šå‚æ•°<code>mian</code>å’Œ<code>quantize</code>æ–‡ä»¶ï¼Œå‰è€…ç”¨æ¥è¿è¡Œå¤§æ¨¡å‹æ¨ç†ï¼Œåè€…ç”¨æ¥æ¨¡å‹å‘é‡åŒ–å¤„ç†ã€‚</p><h3 id="æ¨¡å‹è½¬æ¢"><a href="#æ¨¡å‹è½¬æ¢" class="headerlink" title="æ¨¡å‹è½¬æ¢"></a>æ¨¡å‹è½¬æ¢</h3><p>ä¸€èˆ¬å¤§æ¨¡å‹æ–‡ä»¶éƒ½æ‰˜ç®¡åœ¨<a href="https://huggingface.co/">Hugging Face</a>ä¸Šé¢ã€‚ä¸€èˆ¬æƒ…å†µä¸‹<code>llama.cpp</code>ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™äº›å¤§æ¨¡å‹è¿›è¡Œæ¨ç†ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹è¿™äº›æ¨¡å‹è¿›è¡Œè½¬æ¢ï¼Œè½¬ä¸º<code>ggml</code>æ ¼å¼ã€‚æ”¯æŒè½¬æ¢çš„å¤§æ¨¡å‹åˆ—è¡¨å‚è€ƒå®˜æ–¹<a href="https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#description">README</a>å›½äº§å¤§æ¨¡å‹ç™¾å·ã€åƒé—®ç­‰éƒ½æ”¯æŒè½¬ä¸º<code>ggml</code>æ ¼å¼ã€‚</p><p>è½¬æ¢ä½¿ç”¨<code>llama.cpp</code>é¡¹ç›®å†…çš„<code>convert.py</code>æˆ–è€…<code>convert-hf-to-gguf.py</code>å¤„ç†ï¼Œè¯¦ç»†æ­¥éª¤å‚è€ƒ <a href="https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#prepare-data--run">https://github.com/ggerganov/llama.cpp?tab=readme-ov-file#prepare-data--run</a>ã€‚è¿™é‡Œå¯¹Pythonç‰ˆæœ¬æœ‰ä¸€å®šçš„è¦æ±‚ï¼Œæ¨¡å—çš„ä¾èµ–åœ¨<code>requirements.txt</code>å’Œ<code>requirements</code>ç›®å½•ä¸‹ã€‚</p><p>ä¸€èˆ¬æƒ…å†µå…ˆä½¿ç”¨<code>convert.py</code>è½¬æ¢ï¼Œå¦‚æœè½¬æ¢å¤±è´¥åœ¨ä½¿ç”¨<code>convert-hf-to-gguf.py</code>å°è¯•å¤„ç†ã€‚æ³¨æ„ï¼Œä½¿ç”¨<code>convert-hf-to-gguf.py</code>æ—¶éœ€è¦æˆ‘ä»¬å®‰è£…é¢å¤–çš„ä¾èµ–ï¼Œä¾èµ–åˆ—è¡¨åœ¨<code>requirements/requirements-convert-hf-to-gguf.txt</code>ã€‚</p><p>è½¬æ¢åçš„æ¨¡å‹æˆ‘ä»¬éœ€è¦è¿›è¡Œå‘é‡åŒ–ï¼Œä½¿ç”¨<code>./quantize</code>å¯¹è½¬æ¢åçš„æ¨¡å‹è¿›è¡Œå‘é‡åŒ–ã€‚å‘é‡åŒ–åçš„æ¨¡å‹å°±å¯ä»¥è¿›è¡Œæ¨ç†äº†ã€‚</p><h3 id="å’Œllama-cppç±»ä¼¼çš„å·¥å…·"><a href="#å’Œllama-cppç±»ä¼¼çš„å·¥å…·" class="headerlink" title="å’Œllama.cppç±»ä¼¼çš„å·¥å…·"></a>å’Œllama.cppç±»ä¼¼çš„å·¥å…·</h3><ul><li><p><a href="https://github.com/li-plus/chatglm.cpp">chatglm.cpp</a></p><p>  ä¸€ä¸ªç”¨äº<a href="https://github.com/THUDM/ChatGLM3">ChatGLM</a>å¤§æ¨¡å‹æ¨ç†æ¡†æ¶</p></li><li><p><a href="https://github.com/SJTU-IPADS/PowerInfer">PowerInfer</a></p><ul><li>ä¸€ä¸ªå¯ä»¥åœ¨æ¶ˆè´¹çº§GPUè¿è¡Œçš„å¤§æ¨¡å‹æ¨ç†æ¡†æ¶</li></ul></li></ul><h3 id="Hugging-Face-é•œåƒ"><a href="#Hugging-Face-é•œåƒ" class="headerlink" title="Hugging Face é•œåƒ"></a>Hugging Face é•œåƒ</h3><ul><li><p><a href="https://www.modelscope.cn/models">modelscope</a></p><p>  å¯ä»¥ç›´æ¥ä½¿ç”¨<code>git clone</code>æ‹‰å–å¤§æ¨¡å‹ã€‚æ³¨æ„ï¼Œéœ€è¦å®‰è£…<a href="https://git-lfs.com/">LFS</a></p></li><li><p><a href="https://hf-mirror.com/">hf-mirror</a></p><p>  é…ç½®é•œåƒåå¯ä»¥ä½¿ç”¨<code>huggingface</code>å®˜æ–¹å‘½ä»¤è¡Œ<code>huggingface-cli</code>å·¥å…·ä¸‹è½½æ¨¡å‹æ–‡ä»¶</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HF_ENDPOINT=https://hf-mirror.com</span><br></pre></td></tr></table></figure></li></ul><h3 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h3><ul><li><p>B<br>  å¤§æ¨¡å‹æƒé‡å‚æ•°å•ä½ï¼Œ1Bè¡¨ç¤ºåäº¿ã€‚ä¾‹å¦‚æœ‰<code>7B</code>ã€<code>14B</code>è¡¨ç¤ºå‚æ•°æœ‰70äº¿å’Œ140äº¿ï¼Œå‚æ•°è¶Šå¤§æ¨ç†æ—¶è€—è´¹çš„èµ„æºè¶Šå¤š</p></li><li><p>FP16ã€int8ã€int4</p><p>  FP16ã€int8ã€int4 ç­‰é€šå¸¸æŒ‡çš„æ˜¯æ¨¡å‹æƒé‡ã€æ¿€æ´»å€¼æˆ–æ¢¯åº¦çš„æ•°å€¼è¡¨ç¤ºæ–¹å¼ï¼Œè¡¨ç¤ºæ•°å€¼ç²¾åº¦ã€‚</p><p>  FP16 æŒ‡çš„æ˜¯ 16 ä½æµ®ç‚¹æ•°ï¼ˆå³åŠç²¾åº¦æµ®ç‚¹æ•°ï¼‰ï¼Œæ¯ä¸ªæ•°å€¼å ç”¨ 2 å­—èŠ‚ã€‚</p><p>  int8 æŒ‡çš„æ˜¯ 8 ä½æ•´æ•°ï¼Œæ¯ä¸ªæ•°å€¼å ç”¨ 1 å­—èŠ‚ã€‚</p><p>  1Bçš„FP16ç²¾åº¦çš„å¤§æ¨¡å‹ä¸º<code>1000,000,000</code> * 2Byte â‰ˆ 2GBï¼Œ1Bçš„int8ç²¾åº¦çš„å¤§æ¨¡å‹ä¸º<code>1000,000,000</code> * 1Byte â‰ˆ 1GB</p></li><li><p>Quantization (é‡åŒ–)</p><p>  <code>é‡åŒ–</code> æ˜¯ä¸€ç§é€šè¿‡é™ä½æ•°å€¼è¡¨ç¤ºç²¾åº¦ï¼ˆå¦‚å°† FP32 é™ä¸º int8ï¼‰çš„æŠ€æœ¯ï¼Œä»¥å‡å°‘å†…å­˜å’Œè®¡ç®—èµ„æºçš„æ¶ˆè€—ã€‚</p><p>  é‡åŒ–åçš„æ¨¡å‹å¯ä»¥åœ¨å†…å­˜å ç”¨å’Œè®¡ç®—å¤æ‚åº¦æ–¹é¢æ›´é«˜æ•ˆï¼Œå°¤å…¶æ˜¯åœ¨æ¨ç†é˜¶æ®µæ˜¾è‘—æé«˜é€Ÿåº¦ã€‚</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;llama-cpp&quot;&gt;&lt;a href=&quot;#llama-cpp&quot; class=&quot;headerlink&quot; title=&quot;llama.cpp&quot;&gt;&lt;/a&gt;llama.cpp&lt;/h2&gt;&lt;p&gt;å¤§æ¨¡å‹æœ‰è®­ç»ƒå’Œæ¨ç†ä¸¤éƒ¨åˆ†ï¼Œè®­ç»ƒä¼šäº§ç”Ÿä¸€ä¸ªå¤§æ¨¡å‹æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶é€šå¸¸åŒ…å«äº†æ¨¡å‹æ¶æ„ä»¥åŠæ¯</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Golangçš„å¹¶å‘å®‰å…¨</title>
    <link href="https://kekek.cc/post/go-sync.html"/>
    <id>https://kekek.cc/post/go-sync.html</id>
    <published>2021-08-27T02:45:57.000Z</published>
    <updated>2022-10-13T10:56:46.623Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Golangçš„å¹¶å‘å®‰å…¨"><a href="#Golangçš„å¹¶å‘å®‰å…¨" class="headerlink" title="Golangçš„å¹¶å‘å®‰å…¨"></a>Golangçš„å¹¶å‘å®‰å…¨</h2><p>åœ¨æœ‰å¤šä¸ª<code>goroutines</code>åŒæ—¶è®¿é—®å¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ª<code>goroutines</code>åœ¨ä¿®æ”¹æ•°æ®çš„æƒ…å†µä¸‹å°±ä¼šå­˜åœ¨å¹¶å‘é—®é¢˜ã€‚Golangå¤„ç†å¹¶å‘å®‰å…¨æœ‰é”å’Œ<code>channel</code>ä¸¤ç§æ–¹æ¡ˆï¼Œå‰è€…é€šè¿‡åŠ é”æ–¹å¼ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªæ“ä½œåœ¨è®¿é—®æ•°æ®ï¼Œåè€…æ˜¯å°†æ“ä½œä¸²è¡ŒåŒ–æ¥æ¥å®ç°åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ“ä½œè®¿é—®æ•°æ®ã€‚è¿™ä¸¤ç§æ–¹æ³•éƒ½æ˜¯åœ¨é€šè¿‡çº¦æŸå¹¶å‘è®¿é—®&#x2F;ä¿®æ”¹æ•°æ®æ¥è§£å†³å¹¶å‘å®‰å…¨é—®é¢˜ã€‚</p><p>åœ¨<code>Golang</code>å®˜ç½‘æœ‰ä¸€æ®µå…³äºå¹¶å‘å®‰å…¨çš„å»ºè®®ï¼š</p><blockquote><p><a href="https://golang.org/ref/mem#tmp_1">Advice</a></p><p>Programs that modify data being simultaneously accessed by multiple goroutines must serialize such access.<br>To serialize access, protect the data with channel operations or other synchronization primitives such as those in the sync and sync&#x2F;atomic packages.<br>If you must read the rest of this document to understand the behavior of your program, you are being too clever.<br>Donâ€™t be clever.</p></blockquote><p>ä¸‹é¢æˆ‘å°†ä»å®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„é˜Ÿåˆ—æ¥ä»‹ç»<code>Golang</code>é‡Œé¢çš„å¹¶å‘å·¥å…·ã€‚</p><h3 id="å¹¶å‘å®‰å…¨çš„é˜Ÿåˆ—"><a href="#å¹¶å‘å®‰å…¨çš„é˜Ÿåˆ—" class="headerlink" title="å¹¶å‘å®‰å…¨çš„é˜Ÿåˆ—"></a>å¹¶å‘å®‰å…¨çš„é˜Ÿåˆ—</h3><p>ä¸€ä¸ªç®€å•çš„é˜Ÿåˆ—æœ€å°‘æœ‰<code>Add</code>å’Œ<code>Pop</code>ä¸¤ä¸ªæ“ä½œï¼Œé˜Ÿåˆ—å†…éƒ¨ä¸€èˆ¬é€šè¿‡åˆ—è¡¨æˆ–è€…é“¾è¡¨æ¥å­˜æ”¾æ•°æ®ã€‚è¿™ä¸¤ä¸ªæ“ä½œéƒ½æ˜¯å¯¹åº•å±‚çš„åˆ—è¡¨æˆ–è€…é“¾è¡¨çš„å†™æ“ä½œã€‚åº•å±‚çš„åˆ—è¡¨å’Œé“¾è¡¨å¹¶ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œåœ¨å¤šä¸ª<code>goroutines</code>åœ¨åŒæ—¶<code>Add</code>æˆ–<code>Pop</code>æ—¶å°±ä¼šæœ‰å¹¶å‘é—®é¢˜ã€‚</p><p>è¦å®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„é˜Ÿåˆ—ï¼Œå°±è¦åœ¨<code>Add</code>å’Œ<code>Pop</code>æ“ä½œåŠ é”ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Queue <span class="keyword">struct</span> &#123;</span><br><span class="line">    elements []<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    lock *sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Pop() (ele <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">    q.lock.Lock()</span><br><span class="line">    <span class="keyword">defer</span> q.lock.Unlock()</span><br><span class="line"></span><br><span class="line">    ele = q.elements[q.Size()<span class="number">-1</span>]</span><br><span class="line">    q.elements = q.elements[:q.Size()<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Add(ele <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">    q.lock.Lock()</span><br><span class="line">    <span class="keyword">defer</span> q.lock.Unlock()</span><br><span class="line"></span><br><span class="line">    q.elements = <span class="built_in">append</span>(q.elements, ele)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€ƒè™‘åˆ°ç°å®çš„æƒ…å†µï¼Œæˆ‘ä»¬é˜Ÿåˆ—çš„å®¹é‡ä¸èƒ½æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼Œè¿™ä¼šæœ‰å†…å­˜æ–¹é¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¦é™åˆ¶é˜Ÿåˆ—çš„å®¹é‡ã€‚é˜Ÿåˆ—ç©ºçš„æ—¶å€™<code>Pop</code>æ—¶æˆ‘ä»¬è¦é˜»å¡ç›´åˆ°æœ‰å€¼ï¼Œé˜Ÿåˆ—æ»¡æ—¶æˆ‘ä»¬<code>Add</code>è¦é˜»å¡åˆ°é˜Ÿåˆ—ä¸æ»¡ï¼Œè¿™ç§æƒ…å†µå°±éœ€è¦<code>sync.Cond</code>æ¥é˜»å¡ã€‚å®ƒå’ŒJavaä¸­çš„<code>å†…ç½®æ¡ä»¶é˜Ÿåˆ—</code>ç±»ä¼¼ï¼Œå¯ä»¥ä½¿å½“å‰<code>goroutine</code>åœ¨æŸä¸ªçŠ¶æ€ä¸Šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è¿™ä¸ªçŠ¶æ€è¢«æ¿€æ´»ã€‚</p><table><thead><tr><th>Java</th><th>Golang</th></tr></thead><tbody><tr><td>wait</td><td>Wait</td></tr><tr><td>notify</td><td>Signal</td></tr><tr><td>notifyAll</td><td>Broadcast</td></tr></tbody></table><p>æˆ‘ä»¬éœ€è¦ä¸¤ä¸ª<code>sync.Cond</code>æ¡ä»¶æ¥åˆ†åˆ«è¡¨ç¤ºé˜Ÿåˆ—ä¸ºç©ºå’Œé˜Ÿåˆ—æ»¡ä¸¤ç§çŠ¶æ€ï¼Œè¿™ä¸¤ä¸ª<code>sync.Cond</code>å†…éƒ¨è¦ä½¿ç”¨åŒä¸€æŠŠé”ç”¨åœ¨æ“ä½œ<code>Add</code>å’Œ<code>Pop</code>æ¥é¿å…å¹¶å‘é—®é¢˜ã€‚</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> Queue <span class="keyword">struct</span> &#123;</span><br><span class="line">    elements []<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    capacity <span class="type">int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—æœªç©ºæ¡ä»¶é˜Ÿåˆ—</span></span><br><span class="line">    notEmptyCond *sync.Cond</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—æœªæ»¡æ¡ä»¶é˜Ÿåˆ—</span></span><br><span class="line">    notFullCond *sync.Cond</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Size() <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(q.elements)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> isFull() <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> q.Size() &gt;= q.capacity</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> isEmpty() <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> q.Size() == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Pop() (ele <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">    q.notEmptyCond.L.Lock()</span><br><span class="line">    <span class="keyword">defer</span> q.notEmptyCond.L.Unlock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> q.isEmpty() &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœé˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œå°±åœ¨ `notEmptyCond` æ¡ä»¶ä¸Šç­‰å¾… </span></span><br><span class="line">        <span class="comment">// Wait å†…éƒ¨ä¼šå…ˆé‡Šæ”¾é”ï¼Œç­‰åˆ°æ”¶åˆ°æ»¡è¶³ä¿¡å·æ—¶å°†é‡æ–°å°è¯•è·å¾—é”</span></span><br><span class="line">        q.notEmptyCond.Wait()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ele = q.elements[q.Size()<span class="number">-1</span>]</span><br><span class="line">    q.elements = q.elements[:q.Size()<span class="number">-1</span>]</span><br><span class="line">    <span class="comment">// æ­¤æ—¶é˜Ÿåˆ—ä¸­å·²ç» Pop ä¸€ä¸ªå€¼ï¼Œä¸å†æ»¡ã€‚å‘é€`notFullCond`ä¿¡å·æ¿€æ´»å†æ­¤æ¡ä»¶ `Wait` çš„æ“ä½œ</span></span><br><span class="line">    q.notFullCond.Signal()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Add(ele <span class="keyword">interface</span>&#123;&#125;) (err <span class="type">error</span>) &#123;</span><br><span class="line">    q.notEmptyCond.L.Lock()</span><br><span class="line">    <span class="keyword">defer</span> q.notEmptyCond.L.Unlock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> q.isFull() &#123;</span><br><span class="line">       q.notFullCond.Wait()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    q.elements = <span class="built_in">append</span>(q.elements, ele)</span><br><span class="line">    <span class="comment">// æ­¤æ—¶é˜Ÿåˆ—ä¸­å·²ç»æœ‰å€¼ï¼Œå‘é€é˜Ÿåˆ—ä¸ä¸ºç©ºçš„ä¿¡å·æ¿€æ´»å†æ­¤æ¡ä»¶ `Wait` çš„æ“ä½œ</span></span><br><span class="line">    q.notEmptyCond.Signal()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewQueue</span><span class="params">(capacity <span class="type">int</span>)</span></span> *Queue &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨åŒä¸€æŠŠé”</span></span><br><span class="line">    <span class="keyword">var</span> lock sync.Mutex</span><br><span class="line">    notEmptyCond := sync.NewCond(&amp;lock)</span><br><span class="line">    notFullCond := sync.NewCond(&amp;lock)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &amp;Queue&#123;</span><br><span class="line">        elements: <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="number">0</span>, capacity),</span><br><span class="line">        capacity: capacity,</span><br><span class="line"></span><br><span class="line">        notEmptyCond: notEmptyCond,</span><br><span class="line">        notFullCond:  notFullCond,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Cond.Wait()</code>åœ¨æ²¡æœ‰æ”¶åˆ°æ¡ä»¶æ»¡è¶³ä¿¡å·æ—¶ä¼šä¸€ç›´é˜»å¡ï¼Œæœ‰æ—¶ä¼šå‡ºç°çˆ¶<code>goroutine</code>å¼‚å¸¸é€€å‡ºæ—¶å­<code>goroutine</code>è¿˜åœ¨ç­‰å¾…çš„æƒ…å†µã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestQueue_Add</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    queue := NewQueue(<span class="number">10</span>)</span><br><span class="line">     <span class="comment">// ç³»ç»Ÿå½“å‰`goroutine`æ•°é‡</span></span><br><span class="line">    expectedNumGoroutine := runtime.NumGoroutine()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–°èµ·ä¸€ä¸ªåç¨‹ `Pop`ï¼Œç”±äºé˜Ÿåˆ—æ­¤æ—¶ä¸ºç©ºã€‚`Pop` æ“ä½œæ°¸è¿œä¸ä¼šè¿”å›</span></span><br><span class="line">    <span class="comment">// chanelè¦æœ‰ç¼“å†²åŒºï¼Œå¦‚æœçˆ¶`goroutine`æå‰é€€å‡ºï¼Œchanelæ— æ¥æ”¶è€…æ—¶ã€‚done &lt;- ele ä¼šé˜»å¡ï¼Œæ­¤`goroutine`å°†ä¸èƒ½é€€å‡ºï¼Œé€ æˆ goroutine leakã€‚</span></span><br><span class="line">    done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœçˆ¶`goroutine`æ­¤æ—¶å·²ç»é€€å‡ºï¼Œè¿™æ—¶`Pop`å‡ºæ¥çš„æ¶ˆæ¯å°†ä¸¢å¤±</span></span><br><span class="line">        ele, _ := queue.Pop()</span><br><span class="line">        done &lt;- ele</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(<span class="number">100</span> * time.Millisecond):</span><br><span class="line">        <span class="comment">// parent goroutine exit</span></span><br><span class="line">        <span class="comment">// ç”±äºPopæ“ä½œæ­¤æ—¶è¿˜æ²¡è¿”å›ï¼Œå®é™…åç¨‹æ•°é‡+1</span></span><br><span class="line">        assert.Equal(t, expectedNumGoroutine+<span class="number">1</span>, runtime.NumGoroutine())</span><br><span class="line">    <span class="keyword">case</span> &lt;-done:</span><br><span class="line">        assert.Equal(t, expectedNumGoroutine, runtime.NumGoroutine())</span><br><span class="line">    &#125;</span><br><span class="line">    queue.Add(<span class="number">1</span>)</span><br><span class="line">    time.Sleep(time.Millisecond)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™æ¡æ¶ˆæ¯å¯èƒ½ä¼šåœ¨çˆ¶`goroutine`é€€å‡ºåæ‰è¿”å›</span></span><br><span class="line">    assert.Equal(t, <span class="number">1</span>, &lt;-done)</span><br><span class="line">    assert.Equal(t, <span class="number">0</span>, queue.Size())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦è§£å†³ä¸Šé¢é—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨æ¥<code>Context</code>æ¥å–æ¶ˆå­<code>goroutine</code>ã€‚ä¸‹é¢æ˜¯å®Œæ•´çš„ä¾‹å­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;context&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/pkg/errors&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// waitWithCancel å¯å–æ¶ˆçš„ Wait</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">waitWithCancel</span><span class="params">(ctx context.Context, cond *sync.Cond)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ctx.Done() != <span class="literal">nil</span> &#123;</span><br><span class="line">        done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            cond.Wait()</span><br><span class="line">            <span class="built_in">close</span>(done)</span><br><span class="line">        &#125;()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">            <span class="keyword">return</span> errors.Wrap(ctx.Err(), <span class="string">&quot;cancel wait&quot;</span>)</span><br><span class="line">        <span class="keyword">case</span> &lt;-done:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        cond.Wait()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Queue <span class="keyword">struct</span> &#123;</span><br><span class="line">    elements []<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    capacity <span class="type">int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—æœªç©ºæ¡ä»¶é˜Ÿåˆ—</span></span><br><span class="line">    notEmptyCond *sync.Cond</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—æœªæ»¡æ¡ä»¶é˜Ÿåˆ—</span></span><br><span class="line">    notFullCond *sync.Cond</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Size() <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(q.elements)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> isFull() <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> q.Size() &gt;= q.capacity</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> isEmpty() <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> q.Size() == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pop</span></span><br><span class="line"><span class="comment">// å¯ä»¥ä½¿ç”¨ `Context` æ¥ç»ˆæ­¢ Wait é˜»å¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Pop(ctx context.Context) (ele <span class="keyword">interface</span>&#123;&#125;, err <span class="type">error</span>) &#123;</span><br><span class="line">    q.notEmptyCond.L.Lock()</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// Wait å†…éƒ¨å·²ç»é‡Šæ”¾äº†é”ï¼Œé¿å… `unlock of unlocked mutex` é”™è¯¯</span></span><br><span class="line">        <span class="keyword">if</span> originalErr := errors.Cause(err);</span><br><span class="line">            originalErr != context.DeadlineExceeded &amp;&amp; originalErr != context.Canceled &#123;</span><br><span class="line">            q.notEmptyCond.L.Unlock()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> q.isEmpty() &#123;</span><br><span class="line">        err = waitWithCancel(ctx, q.notEmptyCond)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ele = q.elements[q.Size()<span class="number">-1</span>]</span><br><span class="line">    q.elements = q.elements[:q.Size()<span class="number">-1</span>]</span><br><span class="line">    <span class="comment">// æ­¤æ—¶é˜Ÿåˆ—ä¸­å·²ç» Pop ä¸€ä¸ªå€¼ï¼Œä¸å†æ»¡ã€‚å‘é€é˜Ÿåˆ—ä¸ä¸ºæ»¡çš„ä¿¡å·æ¿€æ´»å†æ­¤æ¡ä»¶ `Wait` çš„æ“ä½œ</span></span><br><span class="line">    q.notFullCond.Signal()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add</span></span><br><span class="line"><span class="comment">// å¯ä»¥ä½¿ç”¨ `Context` æ¥ç»ˆæ­¢ Wait é˜»å¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span></span> Add(ctx context.Context, ele <span class="keyword">interface</span>&#123;&#125;) (err <span class="type">error</span>) &#123;</span><br><span class="line">    q.notEmptyCond.L.Lock()</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">       <span class="comment">// Wait å†…éƒ¨å·²ç»é‡Šæ”¾äº†é”ï¼Œé¿å… `unlock of unlocked mutex` é”™è¯¯</span></span><br><span class="line">       <span class="keyword">if</span> originalErr := errors.Cause(err);</span><br><span class="line">           originalErr != context.DeadlineExceeded &amp;&amp; originalErr != context.Canceled &#123;</span><br><span class="line">           q.notEmptyCond.L.Unlock()</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> q.isFull() &#123;</span><br><span class="line">       err = waitWithCancel(ctx, q.notFullCond)</span><br><span class="line">       <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">           <span class="keyword">return</span></span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    q.elements = <span class="built_in">append</span>(q.elements, ele)</span><br><span class="line">    <span class="comment">// æ­¤æ—¶é˜Ÿåˆ—ä¸­å·²ç»æœ‰å€¼ï¼Œå‘é€é˜Ÿåˆ—ä¸ä¸ºç©ºçš„ä¿¡å·æ¿€æ´»å†æ­¤æ¡ä»¶ `Wait` çš„æ“ä½œ</span></span><br><span class="line">    q.notEmptyCond.Signal()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewQueue</span><span class="params">(capacity <span class="type">int</span>)</span></span> *Queue &#123;</span><br><span class="line">    <span class="keyword">var</span> lock sync.Mutex</span><br><span class="line">    notEmptyCond := sync.NewCond(&amp;lock)</span><br><span class="line">    notFullCond := sync.NewCond(&amp;lock)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &amp;Queue&#123;</span><br><span class="line">        elements: <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="number">0</span>, capacity),</span><br><span class="line">        capacity: capacity,</span><br><span class="line"></span><br><span class="line">        notEmptyCond: notEmptyCond,</span><br><span class="line">        notFullCond:  notFullCond,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestQueue_Add</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    queue := NewQueue(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 100æ¯«ç§’ç§’åè¶…æ—¶å–æ¶ˆ</span></span><br><span class="line">    ctx, cancel := context.WithTimeout(context.Background(), <span class="number">100</span> * time.Millisecond)</span><br><span class="line">    <span class="keyword">defer</span> cancel()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        _, err := queue.Pop(ctx)</span><br><span class="line">        <span class="comment">// è¶…æ—¶å–æ¶ˆ</span></span><br><span class="line">        assert.Equal(t, context.DeadlineExceeded, errors.Cause(err))</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å»¶è¿Ÿç›´åˆ°`Pop`è¶…æ—¶å–æ¶ˆ</span></span><br><span class="line">    time.Sleep(<span class="number">200</span> * time.Millisecond)</span><br><span class="line">    queue.Add(context.Background(), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    assert.Equal(t, <span class="number">1</span>, queue.Size())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://kekek.cc/post/java.util.concurrent.html#%E5%86%85%E7%BD%AE%E6%9D%A1%E4%BB%B6%E9%98%9F%E5%88%97">Javaå¹¶å‘ç¼–ç¨‹ å†…ç½®æ¡ä»¶é˜Ÿåˆ—</a></li><li><a href="https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-context/">Go è¯­è¨€è®¾è®¡ä¸å®ç° 6.1 ä¸Šä¸‹æ–‡ Context</a></li><li><a href="https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-sync-primitives/">Go è¯­è¨€è®¾è®¡ä¸å®ç° 6.2 åŒæ­¥åŸè¯­ä¸é”</a></li><li><a href="https://medium.com/codex/implmenting-timeout-in-golang-ee2bc4aa6ae4">Implementing Timeout in Golang</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Golangçš„å¹¶å‘å®‰å…¨&quot;&gt;&lt;a href=&quot;#Golangçš„å¹¶å‘å®‰å…¨&quot; class=&quot;headerlink&quot; title=&quot;Golangçš„å¹¶å‘å®‰å…¨&quot;&gt;&lt;/a&gt;Golangçš„å¹¶å‘å®‰å…¨&lt;/h2&gt;&lt;p&gt;åœ¨æœ‰å¤šä¸ª&lt;code&gt;goroutines&lt;/code&gt;åŒæ—¶è®¿é—®å¹¶ä¸”è‡³</summary>
      
    
    
    
    
    <category term="queue" scheme="https://kekek.cc/tags/queue/"/>
    
    <category term="golang" scheme="https://kekek.cc/tags/golang/"/>
    
    <category term="å¹¶å‘" scheme="https://kekek.cc/tags/%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>timemachine-exclusion</title>
    <link href="https://kekek.cc/post/timemachine-exclusion.html"/>
    <id>https://kekek.cc/post/timemachine-exclusion.html</id>
    <published>2021-02-19T03:29:14.000Z</published>
    <updated>2021-11-20T00:17:47.720Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Time-Machine-æ‰¹é‡æ’é™¤æ–‡ä»¶"><a href="#Time-Machine-æ‰¹é‡æ’é™¤æ–‡ä»¶" class="headerlink" title="Time Machine æ‰¹é‡æ’é™¤æ–‡ä»¶"></a>Time Machine æ‰¹é‡æ’é™¤æ–‡ä»¶</h2><ol><li><p>æ‰¹é‡æ’é™¤æ–‡ä»¶</p><p> timemachine ä¸æ”¯æŒé€šé…ç¬¦åŒ¹é…æ’é™¤ï¼Œéœ€è¦æ·»åŠ å¤šæ¡è§„åˆ™æ¥æ’é™¤ã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ’é™¤æ‰€æœ‰çš„ `node_modules` æ–‡ä»¶å¤¹</span></span><br><span class="line">find . -maxdepth 3 -<span class="built_in">type</span> d -name <span class="string">&#x27;node_modules&#x27;</span> | xargs -n 1 tmutil addexclusion</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’é™¤æ‰€æœ‰çš„ `.git` ç›®å½•</span></span><br><span class="line">find . -maxdepth 3 -<span class="built_in">type</span> d -name <span class="string">&#x27;.git&#x27;</span> | xargs -n 1 tmutil addexclusion</span><br></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥æ–‡ä»¶æ˜¯å¦è¢«æ’é™¤ </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -exec tmutil isexcluded &#123;&#125; + | grep -F &quot;[Excluded]&quot; | sed -E &#x27;s/^\[Excluded\][[:space:]]*//&#x27;</span><br></pre></td></tr></table></figure></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ol><li><a href="https://gist.github.com/peterdemartini/4c918635208943e7a042ff5ffa789fc1">Exclude node_modules in timemachine</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Time-Machine-æ‰¹é‡æ’é™¤æ–‡ä»¶&quot;&gt;&lt;a href=&quot;#Time-Machine-æ‰¹é‡æ’é™¤æ–‡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;Time Machine æ‰¹é‡æ’é™¤æ–‡ä»¶&quot;&gt;&lt;/a&gt;Time Machine æ‰¹é‡æ’é™¤æ–‡ä»¶&lt;/h2&gt;&lt;ol&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>mysql-login-path</title>
    <link href="https://kekek.cc/post/mysql-login-path.html"/>
    <id>https://kekek.cc/post/mysql-login-path.html</id>
    <published>2020-09-28T06:26:16.000Z</published>
    <updated>2021-11-20T00:17:47.704Z</updated>
    
    <content type="html"><![CDATA[<h2 id="login-path"><a href="#login-path" class="headerlink" title="login-path"></a>login-path</h2><p><code>login-path</code> é€‰é¡¹èƒ½å®ç°å¿«æ·ç™»å½•MySQLæœåŠ¡å™¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ¯æ¬¡éƒ½è¾“å…¥ç”¨æˆ·åã€hostã€å¯†ç ç­‰ç™»å½•è®¤è¯ä¿¡æ¯ï¼Œæ˜¯ä¸€ç§å³å®‰å…¨åˆéå†çš„æ–¹æ³•ã€‚</p><p>ä½¿ç”¨ <code>mysql_config_editor</code> å·¥å…·å°†ç™»å½•MySQLæœåŠ¡çš„è®¤è¯ä¿¡æ¯åŠ å¯†ä¿å­˜åœ¨ <code>.mylogin.cnf</code> æ–‡ä»¶ï¼ˆé»˜è®¤ä½äºç”¨æˆ·ä¸»ç›®å½•ï¼‰ã€‚ä¹‹å MySQL å®¢æˆ·ç«¯å·¥å…·å¯é€šè¿‡è¯»å–è¯¥åŠ å¯†æ–‡ä»¶è¿æ¥ MySQLï¼Œé¿å…é‡å¤è¾“å…¥ç™»å½•ä¿¡æ¯å’Œæ•æ„Ÿä¿¡æ¯æš´éœ²ã€‚</p><h3 id="é…ç½®-login-path"><a href="#é…ç½®-login-path" class="headerlink" title="é…ç½® login-path"></a>é…ç½® login-path</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_config_editor <span class="built_in">set</span> --login-path=dev --user=dev --host=172.26.8.143 --password</span><br></pre></td></tr></table></figure><p>å¯ä»¥é…ç½®å¤šä¸ªç™»å½•ä¿¡æ¯ã€‚<code>login-path</code>å¯ä»¥çœ‹åšç™»å½•ä¿¡æ¯çš„åˆ«åï¼Œæ–¹ä¾¿ä½¿ç”¨æ—¶å¼•ç”¨ã€‚æ›´è¯¦ç»†çš„é…ç½®ä¿¡æ¯æŸ¥çœ‹ <code>mysql_config_editor set --help</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_config_editor <span class="built_in">set</span> --login-path=<span class="built_in">test</span> --user=<span class="built_in">test</span> --host=172.26.8.144 --password</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆé…ç½®äº†ä¸€ä¸ª <code>login-path</code> ä¸º <code>test</code> çš„ç™»å½•ä¿¡æ¯ã€‚</p><h3 id="æŸ¥çœ‹é…ç½®è¿‡çš„ç™»å½•ä¿¡æ¯"><a href="#æŸ¥çœ‹é…ç½®è¿‡çš„ç™»å½•ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹é…ç½®è¿‡çš„ç™»å½•ä¿¡æ¯"></a>æŸ¥çœ‹é…ç½®è¿‡çš„ç™»å½•ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_config_editor print --all</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dev]</span></span><br><span class="line"><span class="attr">user</span> = dev</span><br><span class="line"><span class="attr">password</span> = *****</span><br><span class="line"><span class="attr">host</span> = <span class="number">172.26</span>.<span class="number">8.143</span></span><br><span class="line"><span class="section">[test]</span></span><br><span class="line"><span class="attr">user</span> = test</span><br><span class="line"><span class="attr">password</span> = *****</span><br><span class="line"><span class="attr">host</span> = <span class="number">172.26</span>.<span class="number">8.144</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-login-path-ç™»å½•"><a href="#ä½¿ç”¨-login-path-ç™»å½•" class="headerlink" title="ä½¿ç”¨ login-path ç™»å½•"></a>ä½¿ç”¨ <code>login-path</code> ç™»å½•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql --login-path=dev</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤-login-path"><a href="#åˆ é™¤-login-path" class="headerlink" title="åˆ é™¤ login-path"></a>åˆ é™¤ <code>login-path</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_config_editor remove --login-path=dev</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.cnblogs.com/David-domain/p/11176474.html">MySQL login-path æœ¬åœ°å¿«æ·ç™»å½•</a></li><li><a href="https://dev.mysql.com/doc/refman/5.7/en/mysql-config-editor.html">MySQL Configuration Utility</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;login-path&quot;&gt;&lt;a href=&quot;#login-path&quot; class=&quot;headerlink&quot; title=&quot;login-path&quot;&gt;&lt;/a&gt;login-path&lt;/h2&gt;&lt;p&gt;&lt;code&gt;login-path&lt;/code&gt; é€‰é¡¹èƒ½å®ç°å¿«æ·ç™»å½•MySQL</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>system-time</title>
    <link href="https://kekek.cc/post/system-time.html"/>
    <id>https://kekek.cc/post/system-time.html</id>
    <published>2020-08-07T08:20:03.000Z</published>
    <updated>2020-08-19T02:30:07.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è®¡ç®—æœºç³»ç»Ÿæ—¶é—´"><a href="#è®¡ç®—æœºç³»ç»Ÿæ—¶é—´" class="headerlink" title="è®¡ç®—æœºç³»ç»Ÿæ—¶é—´"></a>è®¡ç®—æœºç³»ç»Ÿæ—¶é—´</h2><p>æˆ‘ä»¬å¸¸è¯´çš„è®¡ç®—æœºç³»ç»Ÿï¼ˆç±»Unixç³»ç»Ÿï¼‰æ—¶é—´æ˜¯ä¸€ä¸ªç›¸å¯¹å€¼ï¼Œå®ƒè¡¨ç¤ºè·ç¦»<code>1970å¹´1æœˆ1æ—¥00:00:00</code>è¿‡å»çš„ç§’æ•°ã€‚</p><p>æ—¶é—´é€šå¸¸åœ¨ç¨‹åºä¸­æœ‰æ—¶é—´æˆ³å’Œæ—¥æœŸå­—ç¬¦ä¸²ä¸¤ç§è¡¨ç°å½¢å¼ã€‚ä½†æ˜¯åœ¨è®¡ç®—æœºä¸­å…¶å®åªæœ‰ä¸€ç§ï¼Œå°±æ˜¯æ—¶é—´æˆ³ã€‚ä½¿ç”¨æ—¶é—´æˆ³æ˜¯æ°¸è¿œä¸ä¼šå‡ºé—®é¢˜ï¼Œä½†æ˜¯ä½¿ç”¨æ—¥æœŸå­—ç¬¦ä¸²æŸäº›æ—¶å€™å°±ä¼šå‡ºç°é—®é¢˜ã€‚å‡ºç°é—®é¢˜çš„åŸå› ä¸€èˆ¬å°±æ˜¯å› ä¸ºçœç•¥äº†æ—¶åŒºã€‚</p><h3 id="æ—¶åŒº"><a href="#æ—¶åŒº" class="headerlink" title="æ—¶åŒº"></a>æ—¶åŒº</h3><p>æˆ‘ä»¬ç”Ÿæ´»ä¸­å¸¸å¸¸ç”¨æ—¥æœŸå­—ç¬¦ä¸²æ¥è¡¨ç¤ºæ—¶é—´ï¼Œå¦‚ä¸‹ï¼š</p><iframe scrolling="no" width="100%" height="300" src="https://jsfiddle.net/pLxr4mqt/embedded/result/light/" frameborder="0" loading="lazy" allowfullscreen="allowfullscreen"></iframe><p>å¯èƒ½æœ‰äº›äººåœ¨ç¨‹åºä¸­ä¹Ÿä¼šä½¿ç”¨æ—¥æœŸå­—ç¬¦ä¸²æ¥åˆå§‹åŒ–æ—¥æœŸï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&#x27;2020-08-07 18:21:33&#x27;</span>);</span><br></pre></td></tr></table></figure><p>å¾ˆå¤šæƒ…å†µä¸‹è¿™æ ·éƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦ç”¨æˆ·åˆ†å¸ƒåœ¨ä¸åŒæ—¶åŒºæˆ–ä¿®æ”¹ç³»ç»Ÿæ—¶åŒºæ—¶å°±ä¼šå‡ºç°é—®é¢˜ã€‚ä¸Šé¢çš„æ—¥æœŸå­—ç¬¦ä¸²å…¶å®éšå«äº†ä¸€ä¸ªæ¡ä»¶<code>æ—¶åŒº</code>ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”Ÿæ´»ä¸­å¸¸è¯´â€œä»Šå¤©ä¸‹åˆäº”ç‚¹è§ä¸ªé¢â€è¿™é‡Œéšå«çš„æ¡ä»¶å°±æ˜¯å¤§å®¶éƒ½åœ¨ä¸œå…«åŒºã€‚</p><p>åœ¨ä¸œå…«åŒºï¼ˆåŒ—äº¬æ—¶é—´ï¼‰æ—¶ï¼Œä¸Šé¢çš„æ—¶é—´ç­‰ä»·äºè¿™ä¸ªå½¢å¼ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&#x27;2020-08-07T18:21:33+08:00&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨ä¸œä¹åŒºï¼ˆä¸œäº¬æ—¶é—´ï¼‰å®ƒç­‰ä»·äºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&#x27;2020-08-07T18:21:33+09:00&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæ—¶é—´å¹¶ä¸æ˜¯åŒä¸€ä¸ªæ—¥æœŸã€‚è¿™å°±æ˜¯æ—¥æœŸå­—ç¬¦ä¸²åœ¨å¤¸æ—¶åŒºå‡ºç°é—®é¢˜çš„åŸå› ã€‚</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥é¿å…ä½¿ç”¨ç®€å•å­—ç¬¦ä¸²æ ¼å¼<code>YYYY-MM-DD HH:mm:ss</code>è¡¨ç¤ºæ—¥æœŸï¼Œè¿™æ˜¯éå¸¸å±é™©çš„ã€‚å¦‚æœè¦ä½¿ç”¨å­—ç¬¦ä¸²æ¥å­˜å‚¨å’Œåˆå§‹åŒ–æ—¥æœŸåº”è¯¥åŠ ä¸Šæ—¶åŒºï¼Œä½¿ç”¨<code>ISO 8601</code>æ ¼å¼çš„å­—ç¬¦ä¸²<code>YYYY-MM-DDTHH:mm:ss.sssZ</code>ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.wikiwand.com/zh-hans/ISO_8601">ISO 8601</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString">toISOString</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;è®¡ç®—æœºç³»ç»Ÿæ—¶é—´&quot;&gt;&lt;a href=&quot;#è®¡ç®—æœºç³»ç»Ÿæ—¶é—´&quot; class=&quot;headerlink&quot; title=&quot;è®¡ç®—æœºç³»ç»Ÿæ—¶é—´&quot;&gt;&lt;/a&gt;è®¡ç®—æœºç³»ç»Ÿæ—¶é—´&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬å¸¸è¯´çš„è®¡ç®—æœºç³»ç»Ÿï¼ˆç±»Unixç³»ç»Ÿï¼‰æ—¶é—´æ˜¯ä¸€ä¸ªç›¸å¯¹å€¼ï¼Œå®ƒè¡¨ç¤ºè·ç¦»&lt;code&gt;1970å¹´1æœˆ1æ—¥00</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Babel Webpack</title>
    <link href="https://kekek.cc/post/babel-with-webpack.html"/>
    <id>https://kekek.cc/post/babel-with-webpack.html</id>
    <published>2020-02-21T02:53:27.000Z</published>
    <updated>2021-11-20T00:17:47.667Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Babel-Webpack"><a href="#Babel-Webpack" class="headerlink" title="Babel Webpack"></a>Babel Webpack</h2><h3 id="babel-preset-env"><a href="#babel-preset-env" class="headerlink" title="@babel&#x2F;preset-env"></a>@babel&#x2F;preset-env</h3><p>ç”¨æ¥å–ä»£ä»¥å‰çš„ <code>es2016</code>ã€<code>es2017</code>ã€<code>stage-x</code> ç­‰ç­‰ <code>preset</code>ã€å®ƒæ˜¯ä¸€ä¸ªåˆé›†ï¼ŒåŒ…å«å·²ç»æˆä¸ºæ ‡å‡†çš„ææ¡ˆã€‚å®ƒçš„<code>useBuiltIns</code>èƒ½é…ç½®å¦‚ä½•å¤„ç†<code>polyfill</code>ï¼Œç°åœ¨å·²ç»ä¸åœ¨æ¨èä½¿ç”¨<code>@babel/polyfill</code>ã€‚ä¸€èˆ¬çš„é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="string">&quot;@babel/preset-env&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="string">&quot;chrome &gt;= 58&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="string">&quot;iOS &gt;= 9&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="string">&quot;Android &gt;= 5&quot;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;useBuiltIns&quot;</span><span class="punctuation">:</span> <span class="string">&quot;usage&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;corejs&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul><li><p><code>useBuiltIns</code> ç”¨æ¥æŒ‡å®š <code>polyfill</code> å¦‚ä½•å¤„ç†ï¼Œé…åˆ <code>core-js</code>ä½¿ç”¨ï¼ˆæ¨èä½¿ç”¨<code>core-js@3</code>ï¼‰æœ‰ä»¥ä¸‹ä¸‰ä¸ªå–å€¼ï¼š</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = &#123; <span class="attr">name</span>: <span class="string">&#x27;Ming&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> bar = &#123; <span class="attr">address</span>: <span class="string">&#x27;Beijing&#x27;</span>, <span class="attr">age</span>: <span class="string">&#x27;18&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(foo, bar);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br></pre></td></tr></table></figure><ul><li><p>usage:ï¼ˆæ¨èï¼‰ä¼šæŒ‰éœ€å¼•å…¥ <code>polyfill</code></p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;core-js/modules/es.array.iterator&quot;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;core-js/modules/es.map&quot;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;core-js/modules/es.object.assign&quot;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;core-js/modules/es.object.to-string&quot;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;core-js/modules/es.string.iterator&quot;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;core-js/modules/web.dom-collections.iterator&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;Ming&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line"><span class="attr">address</span>: <span class="string">&#x27;Beijing&#x27;</span>,</span><br><span class="line"><span class="attr">age</span>: <span class="string">&#x27;18&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(a, b);</span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br></pre></td></tr></table></figure></li><li><p>entry: ä¼šå¼•å…¥å…¨éƒ¨ <code>polyfill</code></p><blockquote><p><del>æä¸æ¸…æ¥šç»“æœä¸ºä»€ä¹ˆå’Œ <code>false</code> ä¸€æ ·ï¼Œæ‰“å¼€ <code>debug</code> é€‰é¡¹åä¼šæœ‰å¦‚ä¸‹æç¤º<code>Import of core-js was not found.</code></del></p></blockquote><blockquote><p>æ›´æ–°ï¼šéœ€è¦åœ¨ä»£ç ä¸­æ‰‹åŠ¨å¼•å…¥ <code>import &#39;core-js&#39;</code>ï¼Œç»“æœä¼šåŠ è½½éå¸¸å¤šçš„<code>polyfill</code>ã€‚</p></blockquote>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;Ming&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line"><span class="attr">address</span>: <span class="string">&#x27;Beijing&#x27;</span>,</span><br><span class="line"><span class="attr">age</span>: <span class="string">&#x27;18&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(foo, bar);</span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br></pre></td></tr></table></figure></li><li><p>false: ä¸å¼•å…¥ <code>polyfill</code></p><blockquote><p><code>debug</code> æç¤º <code>Using polyfills: No polyfills were added, since the *useBuiltIns* option was not set.</code> </p></blockquote>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;Ming&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line"><span class="attr">address</span>: <span class="string">&#x27;Beijing&#x27;</span>,</span><br><span class="line"><span class="attr">age</span>: <span class="string">&#x27;18&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(foo, bar);</span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>targets</code> é€‰é¡¹ç”¨æ¥é…ç½®é…ç½®å…¼å®¹èŒƒå›´ï¼Œè¯­æ³•å‚è€ƒ <a href="https://github.com/browserslist/browserslist">browserslist</a></p></li><li><p><code>exclude</code> å’Œ <code>include</code> ç”¨æ¥æ’æŸ¥å’Œå¼ºåˆ¶å¼•å…¥æŸäº›<code>ployfill</code>ï¼Œä¾‹å¦‚ä¸‹ä¾‹ï¼š</p><blockquote><p>æµ‹è¯•ä¸­å‘ç°è®¾ç½® <code>&quot;in P clude&quot;: [&quot;es.set&quot;]</code> å¹¶æœªç”Ÿæ•ˆ </p></blockquote><p>  è®¾ç½® <code>&quot;exclude&quot;: [&quot;es.object.assign&quot;]</code>ï¼Œå³ä½¿æˆ‘ä»¬ä»£ç ä¸­ç”¨åˆ°äº†<code>Object.assign</code>æ–¹æ³•ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨å¼•å…¥è¿™ä¸ª<code>polyfill</code>ã€‚</p></li></ul><h3 id="babel-plugin-transform-runtime"><a href="#babel-plugin-transform-runtime" class="headerlink" title="@babel&#x2F;plugin-transform-runtime"></a>@babel&#x2F;plugin-transform-runtime</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="string">&quot;@babel/preset-env&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="string">&quot;chrome &gt;= 58&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="string">&quot;iOS &gt;= 9&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="string">&quot;Android &gt;= 5&quot;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;useBuiltIns&quot;</span><span class="punctuation">:</span> <span class="string">&quot;usage&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;plugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;corejs&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦ï¼Œéœ€è¦é…ç½® <code>@babel/runtime</code>ï¼ˆä¸æ˜¯<strong>å¼€å‘ä¾èµ–</strong>ï¼‰ ä¸€èµ·ä½¿ç”¨ã€‚ä½¿ç”¨äº†è¿™ä¸ªåèƒ½å¤ç”¨ä¸€äº›<code>helpers</code>ä»£ç ï¼Œèƒ½é¿å…æ±¡æŸ“å…¨å±€ã€‚ä¸‹é¢æ˜¯æ‰“å¼€ä½¿ç”¨è¿™ä¸ªæ’ä»¶åçš„è½¬ä¹‰ä»£ç ï¼š</p><p>æˆ‘ä»¬çœ‹åˆ° <code>Map</code> å’Œ <code>Object.assign</code> ä¸åœ¨æ˜¯å…¨å±€çš„äº†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _interopRequireDefault = <span class="built_in">require</span>(<span class="string">&quot;@babel/runtime-corejs3/helpers/interopRequireDefault&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> _map = <span class="title function_">_interopRequireDefault</span>(<span class="built_in">require</span>(<span class="string">&quot;@babel/runtime-corejs3/core-js-stable/map&quot;</span>));</span><br><span class="line"><span class="keyword">var</span> _assign = <span class="title function_">_interopRequireDefault</span>(<span class="built_in">require</span>(<span class="string">&quot;@babel/runtime-corejs3/core-js-stable/object/assign&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Ming&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line">  <span class="attr">address</span>: <span class="string">&#x27;Beijing&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="string">&#x27;18&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line">(<span class="number">0</span>, _assign.<span class="property">default</span>)(foo, bar);</span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> _map.<span class="title function_">default</span>();</span><br></pre></td></tr></table></figure><h3 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h3><ul><li>é…åˆ<code>webpack</code>çš„ <code>splitChunks</code> å°† <code>polyfill</code> æ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line"><span class="attr">splitChunks</span>: &#123;</span><br><span class="line"><span class="comment">// cacheGroups æŒ‡å®šæ‹†åˆ†è§„åˆ™ é»˜è®¤çš„æ‹†åˆ†è§„åˆ™å¦‚ä¸‹ &lt;https://webpack.js.org/plugins/split-chunks-plugin/#optimizationsplitchunks&gt;</span></span><br><span class="line"><span class="attr">cacheGroups</span>: &#123;</span><br><span class="line"><span class="attr">polyfill</span>: &#123;</span><br><span class="line"><span class="comment">// ä¸€ä¸ªæ­£åˆ™åŒ¹é…é‚£äº›ä»£ç é€‚ç”¨è¿™ä¸ªè§„åˆ™</span></span><br><span class="line"><span class="attr">test</span>: <span class="regexp">/core-js/</span>, </span><br><span class="line"><span class="comment">// è¡¨ç¤ºä»å“ªäº›chunksé‡Œé¢æŠ½å–ä»£ç ï¼Œé™¤äº†ä¸‰ä¸ªå¯é€‰å­—ç¬¦ä¸²å€¼ initialã€asyncã€all ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å‡½æ•°æ¥è¿‡æ»¤æ‰€éœ€çš„ chunks</span></span><br><span class="line"><span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span> </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.babeljs.cn/docs/babel-preset-env">@babel&#x2F;preset-env</a></li><li><a href="https://www.babeljs.cn/docs/babel-polyfill">@babel&#x2F;polyfill</a></li><li><a href="https://www.babeljs.cn/docs/babel-plugin-transform-runtime">@babel&#x2F;plugin-transform-runtime</a></li><li><a href="https://webpack.js.org/plugins/split-chunks-plugin/#splitchunkschunks">SplitChunksPlugin</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Babel-Webpack&quot;&gt;&lt;a href=&quot;#Babel-Webpack&quot; class=&quot;headerlink&quot; title=&quot;Babel Webpack&quot;&gt;&lt;/a&gt;Babel Webpack&lt;/h2&gt;&lt;h3 id=&quot;babel-preset-env&quot;&gt;&lt;a </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>jq</title>
    <link href="https://kekek.cc/post/jq.html"/>
    <id>https://kekek.cc/post/jq.html</id>
    <published>2019-06-21T11:14:31.000Z</published>
    <updated>2021-11-20T00:17:47.690Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JQ"><a href="#JQ" class="headerlink" title="JQ"></a>JQ</h2><p>jq æ˜¯ä¸ªéå¸¸å¼ºå¤§çš„å¤„ç† JSON æ•°æ®çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><ul><li><p>Linux</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install jq</span><br></pre></td></tr></table></figure></li><li><p>macOS</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install jq</span><br></pre></td></tr></table></figure></li></ul><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><blockquote><p>æ³¨æ„ï¼šç¤ºä¾‹æ•°æ®ä¸æ˜¯ä¸€æ®µjsonæ•°æ®ï¼Œå®ƒçš„æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€æ¡jsonæ•°æ®ã€‚æ¯ä¸€è¡Œéƒ½ä¼šå¤„ç†ä¸€æ¬¡ã€‚</p></blockquote><ol><li>æ ¼å¼åŒ–</li></ol><blockquote><p>è¿™é‡Œçš„ <code>.</code> è¡¨ç¤ºå½“å‰JSONå¯¹è±¡</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://kekek.cc/static/jq.json | jq .</span><br></pre></td></tr></table></figure><ol start="2"><li>æŸ¥è¯¢</li></ol><blockquote><p>æŸ¥è¯¢ <code>remote_addr</code> ä¸º <code>187.141.142.230</code> çš„ç”¨æˆ·</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://kekek.cc/static/jq.json | jq <span class="string">&#x27;select (.[&quot;remote_addr&quot;] == &quot;187.141.142.230&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p><code>select(boolean_expression)</code> ä¸ºæŸ¥è¯¢è¯­å¥ï¼Œ<code>.[&quot;remote_addr&quot;]</code> è¡¨ç¤ºå–å¯¹è±¡çš„<code>remote_addr</code>å±æ€§ï¼ˆé™¤äº†å¯ä»¥ç”¨<code>.[]</code>å–å€¼è¿˜å¯ä»¥ç›´æ¥<code>.</code>å–å€¼ï¼Œå‰è€…å¯ä»¥å¤„ç†ç‰¹æ®Šå­—ç¬¦çš„æƒ…å†µï¼‰ã€‚ <code>==</code> è¡¨ç¤ºç­‰äºã€‚</p><blockquote><p>æŸ¥è¯¢ <code>method</code> ä¸º <code>GET</code> çš„è¯·æ±‚ï¼Œå¹¶ä¸”<code>status</code> ä¸º <code>200</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://kekek.cc/static/jq.json | jq <span class="string">&#x27;select (.[&quot;method&quot;] == &quot;GET&quot; and .status == 200)&#x27;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>ç®¡é“</li></ol><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">AccessLog</span> &#123;</span><br><span class="line"><span class="attr">ip</span>: <span class="built_in">string</span>;</span><br><span class="line"><span class="attr">method</span>: <span class="built_in">string</span>;</span><br><span class="line"><span class="attr">url</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://kekek.cc/static/jq.json | jq <span class="string">&#x27;. | &#123;ip: .[&quot;remote_addr&quot;], method: .method, url: .[&quot;request_uri&quot;]&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº†ç®¡é“ç¬¦ <code>|</code> å¯ä»¥å¤šæ¬¡å¤„ç†ç»“æœ</p><ol start="4"><li>è¾“å‡ºcsvæ ¼å¼</li></ol><blockquote><p>csv çš„è¾“å…¥è¦æ±‚å¿…é¡»æ˜¯ä¸€ä¸ªæ•°ç»„</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://kekek.cc/static/jq.json | jq <span class="string">&#x27;. | [.[&quot;remote_addr&quot;], .method, .status]] | @csv&#x27;</span></span><br></pre></td></tr></table></figure><ol start="5"><li>æ•°ç»„</li></ol><p><code>.[]</code> è¡¨ç¤ºå–æ•´ä¸ªæ•°ç»„ï¼Œä¸€èˆ¬é…åˆç®¡é“ç¬¦å·ä¸€èµ·ä½¿ç”¨ <code>.[] | {ip: .[&quot;remote_addr&quot;], method: .method, url: .[&quot;request_uri&quot;]}</code></p><p><code>.[0]</code> è¡¨ç¤ºå–æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ </p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://stedolan.github.io/jq/tutorial/">Tutorial</a></li><li><a href="https://stedolan.github.io/jq/manual/">jq Manual</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;JQ&quot;&gt;&lt;a href=&quot;#JQ&quot; class=&quot;headerlink&quot; title=&quot;JQ&quot;&gt;&lt;/a&gt;JQ&lt;/h2&gt;&lt;p&gt;jq æ˜¯ä¸ªéå¸¸å¼ºå¤§çš„å¤„ç† JSON æ•°æ®çš„å‘½ä»¤è¡Œå·¥å…·ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;heade</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>å¯¹5Gçš„ä¸€äº›çœ‹æ³•</title>
    <link href="https://kekek.cc/post/5G.html"/>
    <id>https://kekek.cc/post/5G.html</id>
    <published>2019-06-07T10:05:51.000Z</published>
    <updated>2021-11-20T00:17:47.663Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¯¹5Gçš„ä¸€äº›çœ‹æ³•"><a href="#å¯¹5Gçš„ä¸€äº›çœ‹æ³•" class="headerlink" title="å¯¹5Gçš„ä¸€äº›çœ‹æ³•"></a>å¯¹5Gçš„ä¸€äº›çœ‹æ³•</h2><p>5Gï¼ˆ5th-Generationï¼‰æ˜¯ç¬¬äº”ä»£<strong>ç§»åŠ¨</strong>é€šä¿¡æŠ€æœ¯çš„æ„æ€ï¼Œç›¸æ¯”4Gå®ƒæœ‰æ›´ä½çš„å»¶æ—¶å’Œæ›´å¿«çš„é€Ÿåº¦ã€‚</p><ol><li><p>ä½å»¶æ—¶</p><p> æˆ‘ä»¬å¸¸å¬åˆ°5Gå¯ä»¥æŠŠå»¶æ—¶é™ä½åˆ°<code>1ms</code>ï¼Œè¿™å¥è¯å¾ˆæœ‰è¯¯å¯¼æ€§ã€‚ä¼šè®©å¤§éƒ¨åˆ†äººè§‰å¾—ç«¯åˆ°ç«¯çš„å»¶è¿Ÿåœ¨5Gæ—¶ä»£åªæœ‰<code>1ms</code>äº†ï¼Œè¿™å…¶å®æ˜¯ä¸å‡†ç¡®çš„ã€‚è¿™ä¸ª<code>1ms</code>å…¶å®æŒ‡çš„æ˜¯ä»è®¾å¤‡åˆ°<code>5G</code>åŸºç«™çš„å»¶æ—¶ï¼Œå¹¶ä¸æ˜¯ç«¯åˆ°ç«¯çš„å»¶æ—¶ã€‚æ¢ä¸ªè§’åº¦æƒ³ï¼Œ<code>5G</code>åŸºç«™è¿˜æ˜¯è¦é€šè¿‡å…‰çº¤ç½‘ç»œæ¥å…¥äº’è”ç½‘çš„ï¼Œé‚£ä¹ˆå®ƒå°±ä¸å¯èƒ½æ¯”å…‰çº¤å»¶æ—¶æ›´ä½äº†ã€‚ç°åœ¨å…‰çº¤ç½‘ç»œçš„å»¶æ—¶é€šå¸¸è¿œè¿œå¤§äº<code>1ms</code>ï¼Œè¿™ä¸»è¦å–å†³äºè·ç¦»ã€‚</p></li><li><p>æ›´å¿«çš„é€Ÿåº¦</p><p> ç§»åŠ¨ç½‘ç»œé€Ÿåº¦æ¯ä¸€ä»£éƒ½æ¯”ä¸Šä¸€ä»£æœ‰å¾ˆå¤§çš„æå‡ã€‚æœ€æ–°åœ¨ç½‘ç»œä¸Šçœ‹åˆ°çš„ä¸€äº›æµ‹è¯•ï¼Œåœ¨<code>5G</code>ç½‘ç»œä¸­ä¸‹è½½é€Ÿåº¦èƒ½åˆ°è¾¾<code>900Mbps</code>ï¼Œçº¦ä¸º<code>110MB/s</code>å·¦å³ã€‚</p></li></ol><h3 id="5Gå¸¦æ¥çš„å½±å“"><a href="#5Gå¸¦æ¥çš„å½±å“" class="headerlink" title="5Gå¸¦æ¥çš„å½±å“"></a>5Gå¸¦æ¥çš„å½±å“</h3><p>æˆ‘ä»¬å…ˆçœ‹ä¸‹ç½‘ä¸Šå¸¸è¯´çš„5Gå¯¹æœªæ¥ç”Ÿæ´»çš„å½±å“ï¼Œæ¥ä¸€ä¸€åˆ†æä¸€ä¸‹ã€‚</p><ol><li><p>ä¸‡ç‰©äº’è”</p><p> æˆ‘è§‰å¾—è¿™ä¸»è¦è¿™ä¸»è¦å¾—ç›Šäº5Gåæ•´ä½“å¸¦å®½çš„æå‡ï¼Œå„ç§è®¾å¤‡è¦ä¼ è¾“å¤§é‡çš„æ•°æ®ã€‚ä½å»¶æ—¶å¯¹äºè¿™æ–¹é¢çš„æå‡å¹¶ä¸ä¼šæ˜æ˜¾ã€‚ä¼´éšç€ä¸‡ç‰©äº’è”IPV6å¯èƒ½ä¼šè¿æ¥å‘å±•ã€‚ç°æœ‰ç½‘ç»œç¯å¢ƒä¸‹æˆ‘ä»¬é€šè¿‡<code>NAT</code>æŠ€æœ¯ç¼“è§£äº†<code>IPV4</code>ä¸å¤Ÿç”¨çš„é—®é¢˜ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†<code>IPV6</code>è¿™ä¹ˆå¤šå¹´æ¥å‘å±•ååˆ†ç¼“æ…¢ã€‚åœ¨<code>5G</code>æ—¶ä»£å¯èƒ½ä¼šæœ‰æ›´å¤šçš„è®¾å¤‡ï¼Œä¼ æ„Ÿå™¨é€šè¿‡<code>5G</code>ç½‘ç»œæ¥å…¥äº’è”ç½‘ï¼Œé‚£å°±éœ€è¦å¤§é‡IPäº†ã€‚</p></li><li><p>è‡ªåŠ¨é©¾é©¶</p><p> <code>5G</code>å¯¹äºè‡ªåŠ¨é©¾é©¶çš„å½±å“å¯èƒ½ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œè‡ªåŠ¨é©¾é©¶å¹¶ä¸æ˜¯å°†æ•°æ®ä¼ è¾“åˆ°æœåŠ¡å™¨è®¡ç®—çš„ï¼Œå®ƒæ˜¯æœ¬åœ°è®¡ç®—çš„ã€‚è‡ªåŠ¨é©¾é©¶æ›´å¤§çš„éš¾ç‚¹å¯èƒ½è¿˜æ˜¯ç°æœ‰é“è·¯è§„åˆ™éƒ½æ˜¯ä¸ºæœ‰äººé©¾é©¶è®¾è®¡çš„ï¼Œè‡ªåŠ¨é©¾é©¶åªèƒ½å»é€‚åº”ç°æœ‰è§„åˆ™ã€‚æœ‰äº†æ›´é«˜çš„ç½‘é€Ÿï¼Œåœ¨é“è·¯ä¸Šåœç•™ä¸€ä¸ªå¤šå°æ—¶ä¸‹è½½æ›´æ–°åŒ…çš„å°´å°¬æƒ…å†µèµ·ç ä¸ä¼šå†å‡ºç°äº†â•®(â•¯_â•°)â•­ ä½†æ˜¯å¦‚æœæ±½è½¦é—´ä»¥åè¦äº’ç›¸é€šä¿¡ï¼Œé‚£ä¹ˆä½å»¶æ—¶æŠ€æœ¯å¯èƒ½ä¼šæœ‰å¸®åŠ©ã€‚</p></li><li><p>è¿œç¨‹åŒ»ç–—</p><p> æˆ‘è§‰å¾—<code>5G</code>å¯¹äºè¿œç¨‹åŒ»ç–—çš„å½±å“æˆ‘è§‰å¾—æå…¶æœ‰é™ã€‚è¿œç¨‹åŒ»ç–—éå¸¸ä¾èµ–äºä½å»¶æ—¶ï¼Œä½†æ˜¯5Gåœ¨ä½å»¶æ—¶å’Œç¨³å®šæ€§æ–¹é¢éƒ½ä¸ä¼šæ¯”ç›´æ¥ä½¿ç”¨å…‰çº¤ç½‘ç»œæ›´å¥½ã€‚æ‰‹æœ¯è®¾å¤‡å®Œå…¨å¯ä»¥æ¥å…¥ç°æœ‰å…‰çº¤ç½‘ç»œï¼Œé€šè¿‡5Gæ¥å…¥å®Œå…¨æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚æœ‰äººè¯´å¯¹äºåè¿œåœ°åŒºå…‰çº¤ä¸å¥½é“ºè®¾ï¼Œè¿™æ—¶å€™ä½¿ç”¨5Gå°±å¾ˆæ–¹ä¾¿äº†ã€‚è¿™ç§è§‚ç‚¹å…¶å®ä¹Ÿæœ‰é—®é¢˜ï¼Œ5Gç½‘ç»œçš„è¦†ç›–éå¸¸å°ã€‚åªæœ‰å‡ ç™¾ç±³ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬èƒ½æœç´¢åˆ°5Gä¿¡å·çš„åœ°æ–¹éƒ½æœ€è¿‘çš„å…‰çº¤ç½‘ç»œä¹Ÿåªæœ‰å‡ ç™¾ç±³ã€‚</p></li><li><p>äº‘</p><p> äº‘å­˜å‚¨ä¼šè¿æ¥å¤§å‘å±•ã€‚<code>5G</code>æ—¶ä»£å¦‚æœæˆ‘ä»¬ä¸‹è½½é€Ÿåº¦èƒ½è¾¾åˆ°<code>100+MB/s</code>ï¼Œ<code>iCloud</code>ç±»çš„æœåŠ¡å°†ä¼šè¿æ¥æ›´å¤§å‘å±•ã€‚æˆ‘ä»¬çš„è®¾å¤‡å®Œå…¨æ²¡å¿…è¦å¾ˆå¤§çš„å­˜å‚¨äº†ï¼Œæˆ‘ä»¬ä¸éœ€è¦æŠŠæ•°æ®éƒ½å­˜åœ¨æœ¬åœ°ã€‚128Gã€256Gç”šè‡³æ›´å¤§å®¹é‡çš„æ‰‹æœºå¯èƒ½ä¼šå¾ˆå°‘äº†ã€‚</p><p> äº‘æ“ä½œç³»ç»Ÿã€äº‘æ¸¸æˆå¯èƒ½ä¼šè¿æ¥å‘å±•çš„æœºä¼šã€‚å¯¹äºå»¶æ—¶ä¸é«˜çš„æ“ä½œå®Œå…¨å¯ä»¥å†äº‘æœåŠ¡å™¨ä¸Šå®Œæˆï¼Œæˆ‘ä»¬çš„è®¾å¤‡ä¸åœ¨éœ€è¦å¼ºå¤§çš„ç¡¬ä»¶ã€‚Chromebookç±»ä¼¼çš„è®¾å¤‡å’ŒGoogle Stadiaç±»ä¼¼çš„äº‘æ¸¸æˆå¹³å°å¯èƒ½ä¼šæœ‰æ›´å¤šã€‚</p></li></ol><p>æˆ‘è§‰å¾—5Gå¯¹æˆ‘ä»¬å½±å“æœ€å¤§çš„è¿˜æ˜¯æ›´å¿«çš„ç½‘é€Ÿï¼Œè¿™å°†æå¤§æå‡æ•ˆç‡ï¼Œä¸ºæˆ‘ä»¬ç”Ÿæ´»å¸¦æ¥æ›´å¤šçš„ä¾¿åˆ©ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å¯¹5Gçš„ä¸€äº›çœ‹æ³•&quot;&gt;&lt;a href=&quot;#å¯¹5Gçš„ä¸€äº›çœ‹æ³•&quot; class=&quot;headerlink&quot; title=&quot;å¯¹5Gçš„ä¸€äº›çœ‹æ³•&quot;&gt;&lt;/a&gt;å¯¹5Gçš„ä¸€äº›çœ‹æ³•&lt;/h2&gt;&lt;p&gt;5Gï¼ˆ5th-Generationï¼‰æ˜¯ç¬¬äº”ä»£&lt;strong&gt;ç§»åŠ¨&lt;/strong&gt;é€šä¿¡æŠ€æœ¯çš„</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>å®¶ç”¨NASæ­å»º</title>
    <link href="https://kekek.cc/post/network-attached-storage.html"/>
    <id>https://kekek.cc/post/network-attached-storage.html</id>
    <published>2019-05-25T14:53:15.000Z</published>
    <updated>2021-11-20T00:17:47.706Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®¶ç”¨NASæ­å»º"><a href="#å®¶ç”¨NASæ­å»º" class="headerlink" title="å®¶ç”¨NASæ­å»º"></a>å®¶ç”¨NASæ­å»º</h2><p>æ‰‹é‡Œæœ‰ä¸€ä¸ªæ ‘è“æ´¾ï¼Œåˆšå¥½æœ‰å‡ å¼ é—²ç½®çš„SDå¡ã€‚é—²æ¥æ²¡äº‹æ­å»ºä¸ª<code>NAS</code>ï¼ˆNetwork Attached Storageï¼‰æœåŠ¡ã€‚ä½¿ç”¨æ ‘è“æ´¾æ­å»º<code>NAS</code>æœåŠ¡ä¼˜ç‚¹å°±æ˜¯çœç”µï¼Œç¼ºç‚¹æ˜¯ç½‘å¡æœ‰ç‚¹å·®ã€‚</p><h3 id="éƒ¨ç½²åŠé…ç½®"><a href="#éƒ¨ç½²åŠé…ç½®" class="headerlink" title="éƒ¨ç½²åŠé…ç½®"></a>éƒ¨ç½²åŠé…ç½®</h3><ol><li><p>å®‰è£…<code>samba</code></p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">apt-get install samba samba-common-bin</span></span><br></pre></td></tr></table></figure></li><li><p>é…ç½®</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim /etc/samba/smb.conf</span></span><br></pre></td></tr></table></figure><p> æ‰¾åˆ°<code>Share Definitions</code>éƒ¨åˆ†åœ¨åé¢é…ç½®å…±äº«ç›®å½•</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># [å…±äº«å] </span><br><span class="line">[ytdl]</span><br><span class="line">    comment = share # å…±äº«æè¿°</span><br><span class="line">    path = /data/share/  # å…±äº«ç›®å½•</span><br><span class="line">    valid users = pi # å…è®¸è®¿é—®è¯¥å…±äº«çš„ç”¨æˆ· å¤šä¸ªç”¨æˆ·é€—å·åˆ†éš”</span><br><span class="line">    browseable = yes # è¯¥æŒ‡å®šå…±äº«ç›®å½•å¯æµè§ˆ</span><br><span class="line">    public = no # å…è®¸guestç”¨æˆ·è®¿é—®</span><br><span class="line">    writable = yes # å…è®¸å¯å†™</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®å®Œæˆé‡å¯æœåŠ¡å™¨å³å¯</p></blockquote></li><li><p>æ·»åŠ ç”¨æˆ·</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ smbpasswd -a [user]</span><br></pre></td></tr></table></figure><blockquote><p>æ ¹æ®æç¤ºè¾“å…¥å¯†ç å³å¯</p></blockquote></li><li><p>å¯åŠ¨å’Œåœæ­¢</p><ul><li>å¯åŠ¨ï¼š&#x2F;etc&#x2F;init.d&#x2F;samba restart</li><li>åœæ­¢ï¼š&#x2F;etc&#x2F;init.d&#x2F;samba stop</li><li>é‡å¯ï¼š&#x2F;etc&#x2F;init.d&#x2F;samba restart</li><li>é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼š&#x2F;etc&#x2F;init.d&#x2F;samba reload</li></ul></li></ol><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.jianshu.com/p/ead92b06318e">åœ¨æ ‘è“æ´¾ä¸Šå®‰è£…Sambaå®ç°æ ‘è“æ´¾ä¸Windowsé—´çš„æ–‡ä»¶å…±äº«</a></li><li><a href="https://blog.csdn.net/weixin_40806910/article/details/81917077">Linux sambaçš„é…ç½®å’Œä½¿ç”¨</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å®¶ç”¨NASæ­å»º&quot;&gt;&lt;a href=&quot;#å®¶ç”¨NASæ­å»º&quot; class=&quot;headerlink&quot; title=&quot;å®¶ç”¨NASæ­å»º&quot;&gt;&lt;/a&gt;å®¶ç”¨NASæ­å»º&lt;/h2&gt;&lt;p&gt;æ‰‹é‡Œæœ‰ä¸€ä¸ªæ ‘è“æ´¾ï¼Œåˆšå¥½æœ‰å‡ å¼ é—²ç½®çš„SDå¡ã€‚é—²æ¥æ²¡äº‹æ­å»ºä¸ª&lt;code&gt;NAS&lt;/code&gt;ï¼ˆNetwo</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>åœ¨å®¶åº­å®½å¸¦éƒ¨ç½²WebæœåŠ¡å™¨</title>
    <link href="https://kekek.cc/post/deploy-web-server-on-home-broadband.html"/>
    <id>https://kekek.cc/post/deploy-web-server-on-home-broadband.html</id>
    <published>2018-09-10T09:35:57.000Z</published>
    <updated>2021-11-20T00:17:47.672Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åœ¨å®¶åº­å®½å¸¦éƒ¨ç½²WebæœåŠ¡å™¨"><a href="#åœ¨å®¶åº­å®½å¸¦éƒ¨ç½²WebæœåŠ¡å™¨" class="headerlink" title="åœ¨å®¶åº­å®½å¸¦éƒ¨ç½²WebæœåŠ¡å™¨"></a>åœ¨å®¶åº­å®½å¸¦éƒ¨ç½²WebæœåŠ¡å™¨</h2><h3 id="ç«¯å£æ˜ å°„"><a href="#ç«¯å£æ˜ å°„" class="headerlink" title="ç«¯å£æ˜ å°„"></a>ç«¯å£æ˜ å°„</h3><p>å±€åŸŸç½‘åˆ°å…¬ç½‘è¦ç»è¿‡ä¸€å±‚netåœ°å€è½¬æ¢ï¼Œåœ¨è·¯ç”±å™¨ä¸­æœ‰ä¸€å¼ è¡¨è®°å½•ç€ï¼š</p><table><thead><tr><th>å†…ç½‘ç«¯å£</th><th>æœåŠ¡å™¨IP</th><th>æœåŠ¡å™¨ç«¯å£</th></tr></thead><tbody><tr><td>80</td><td>192.168.1.10</td><td>80</td></tr></tbody></table><p>æˆ‘ä»¬è¦æ­å»ºWebæœåŠ¡å™¨å°±éœ€è¦æŠŠ80ç«¯å£é…ç½®åˆ°è¿™å¼ è¡¨ä¸­ï¼Œ</p><blockquote><p>æ³¨æ„ï¼šåŒ—äº¬åœ°åŒºå®¶åº­å®½å¸¦80ç«¯å£è¢«å°ï¼Œå¯ä»¥ä½¿ç”¨HTTPS443ç«¯å£ã€‚</p></blockquote><p>éšç€è¿™äº›å¹´å®½å¸¦æé€Ÿä»¥åŠå„ç§ç›´æ’­ç±»çš„éœ€æ±‚ç°åœ¨å®¶åº­å®½å¸¦ä¸Šè¡Œé€Ÿåº¦å·²ç»ä¸æ˜¯é—®é¢˜ã€‚</p><h3 id="åŠ¨æ€åŸŸåè§£æ"><a href="#åŠ¨æ€åŸŸåè§£æ" class="headerlink" title="åŠ¨æ€åŸŸåè§£æ"></a>åŠ¨æ€åŸŸåè§£æ</h3><p>å®¶åº­å®½å¸¦æœ‰ä¸ªç‰¹ç‚¹ä¸æ˜¯å›ºå®šIPï¼Œæ¯æ¬¡é‡æ–°æ‹¨å·å°±ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„IPã€‚è¿™å°±è¦ä½¿ç”¨åŠ¨æ€åŸŸåè§£ææœåŠ¡äº†ï¼ŒåƒèŠ±ç”Ÿå£³ä¹‹ç±»çš„è½¯ä»¶ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åŸºäºé˜¿é‡Œäº‘æä¾›çš„<a href="https://help.aliyun.com/document_detail/29739.html">DNS API</a>è‡ªå·±æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼š</p><figure class="highlight js"><figcaption><span>ddns.js</span><a href="/downloads/code/ddns.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">&#x27;https&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stringCompare = <span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">localeCompare</span>;</span><br><span class="line"><span class="keyword">const</span> padStart = <span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">padStart</span>;</span><br><span class="line"><span class="keyword">const</span> padEnd = <span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">padEnd</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// accesskeys è®¿é—®&lt;https://ram.console.aliyun.com/#/user/list&gt;ç”³è¯·</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ACCESS_KEY_ID</span> = <span class="string">&#x27;YOUR_ACCESS_KEY_ID&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ACCESS_KEY_SECRET</span> = <span class="string">&#x27;YOUR_ACCESS_KEY_SECRET&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¯”è¾ƒå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * String.prototype.localeCompare ç®—æ³•æœ‰é—®é¢˜ AA &gt; Aa </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} <span class="variable">str1</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} <span class="variable">str2</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">compareString</span>(<span class="params">str1, str2</span>) {</span><br><span class="line">    <span class="keyword">const</span> len1 = str1.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">const</span> len2 = str2.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">const</span> lim = <span class="title class_">Math</span>.<span class="title function_">min</span>(len1, len2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> str1codes = str1.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">map</span>(<span class="function"><span class="params">char</span> =&gt;</span> char.<span class="title function_">codePointAt</span>(<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">const</span> str2codes = str2.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">map</span>(<span class="function"><span class="params">char</span> =&gt;</span> char.<span class="title function_">codePointAt</span>(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> k = <span class="number">0</span>, c1, c2;</span><br><span class="line">    <span class="keyword">while</span> (k &lt; lim) {</span><br><span class="line">        c1 = str1codes[k];</span><br><span class="line">        c2 = str2codes[k];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (c1 !== c2) {</span><br><span class="line">            <span class="keyword">return</span> c1 - c2;</span><br><span class="line">        }</span><br><span class="line">        k++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> len1 - len2;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sha1</span>(<span class="params">str, key</span>) {</span><br><span class="line">    <span class="keyword">return</span> crypto.<span class="title function_">createHmac</span>(<span class="string">&#x27;sha1&#x27;</span>, key)</span><br><span class="line">        .<span class="title function_">update</span>(str)</span><br><span class="line">        .<span class="title function_">digest</span>()</span><br><span class="line">        .<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–æ—¶é—´å­—ç¬¦ä¸² YYYY-MM-DDTHH:mm:ssZ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} <span class="variable">date</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">utcDateFormat</span>(<span class="params">time</span>) {</span><br><span class="line">    <span class="comment">// YYYY-MM-DDTHH:mm:ss.sssZ include milliseconds</span></span><br><span class="line">    <span class="comment">// return time.toISOString().match(/^(\d{4}\-\d{2}\-\d{2}T\d{2}:\d{2}:\d{2})/)[1] + &#x27;Z&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> year = time.<span class="title function_">getUTCFullYear</span>();</span><br><span class="line">    <span class="keyword">const</span> month = padStart.<span class="title function_">call</span>(time.<span class="title function_">getUTCMonth</span>() + <span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> date = padStart.<span class="title function_">call</span>(time.<span class="title function_">getUTCDate</span>(), <span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> hours = padStart.<span class="title function_">call</span>(time.<span class="title function_">getUTCHours</span>(), <span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> minutes = padStart.<span class="title function_">call</span>(time.<span class="title function_">getUTCMinutes</span>(), <span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> secounds = padStart.<span class="title function_">call</span>(time.<span class="title function_">getUTCSeconds</span>(), <span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">${year}</span>-<span class="subst">${month}</span>-<span class="subst">${date}</span>T<span class="subst">${hours}</span>:<span class="subst">${minutes}</span>:<span class="subst">${secounds}</span>Z`</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å­—ç¬¦ä¸²ç¼–ç ï¼ˆé˜¿é‡Œè§„åˆ™ï¼‰</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * è§„åˆ™ï¼š&lt;https://help.aliyun.com/document_detail/29747.html&gt; 1.b</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} <span class="variable">str</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">percentEncode</span>(<span class="params">str</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">encodeURIComponent</span>(str).<span class="title function_">replace</span>(<span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;%20&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;%2A&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;%7E&#x27;</span>, <span class="string">&#x27;~&#x27;</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HTTPs GET</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} {<span class="type"> url, timeout = 5000, json = true </span>}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> query è¯·æ±‚å‚æ•°å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> json å¦‚æœä¸ºtrueå¹¶ä¸”content-typeä¸ºapplication/jsonçš„æƒ…å†µä¸‹ä¼šååºåˆ—åŒ–</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> å¦‚æœå“åº”ç ä¸º4xxæˆ–è€…5xxå“åº”ä¼šä½œä¸ºé”™è¯¯æŠ›å‡º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">{ url: uri, query = {}, timeout = <span class="number">5000</span>, json = <span class="literal">true</span> }</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">        <span class="comment">// åˆå¹¶query</span></span><br><span class="line">        <span class="keyword">const</span> urlObject = url.<span class="title function_">parse</span>(uri, <span class="literal">true</span>);</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">assign</span>(urlObject.<span class="property">query</span>, query);</span><br><span class="line">        urlObject.<span class="property">search</span> = <span class="literal">null</span>;</span><br><span class="line">        uri = url.<span class="title function_">format</span>(urlObject);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// support HTTPs</span></span><br><span class="line">        <span class="keyword">let</span> protocol;</span><br><span class="line">        <span class="keyword">if</span> (urlObject.<span class="property">protocol</span> === <span class="string">&#x27;https:&#x27;</span>) protocol = https;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (urlObject.<span class="property">protocol</span> === <span class="string">&#x27;http:&#x27;</span>) protocol = http;</span><br><span class="line">        <span class="keyword">else</span> { <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`unsupported protocol [<span class="subst">${urlObject.protocol}</span>]`</span>) };</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> req = protocol.<span class="title function_">get</span>(uri)</span><br><span class="line">        req.<span class="built_in">setTimeout</span>(timeout);</span><br><span class="line">        req.<span class="title function_">on</span>(<span class="string">&#x27;timeout&#x27;</span>, <span class="function">() =&gt;</span> req.<span class="title function_">abort</span>());</span><br><span class="line"></span><br><span class="line">        req.<span class="title function_">on</span>(<span class="string">&#x27;response&#x27;</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> {</span><br><span class="line">            res.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> { statusCode, headers } = res;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> rawData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            res.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> { rawData += chunk; });</span><br><span class="line">            res.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">                <span class="keyword">let</span> data = rawData;</span><br><span class="line">                <span class="keyword">if</span> (json &amp;&amp; -<span class="number">1</span> !== headers[<span class="string">&#x27;content-type&#x27;</span>].<span class="title function_">indexOf</span>(<span class="string">&#x27;application/json&#x27;</span>)) {</span><br><span class="line">                    data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(rawData);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (statusCode &gt;= <span class="number">400</span>) {</span><br><span class="line">                    <span class="title function_">reject</span>(data);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="title function_">resolve</span>(data);</span><br><span class="line">                }</span><br><span class="line">            });</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        req.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, reject);</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">timeout</span>(<span class="params">time</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> {</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">            <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;operation timed out&#x27;</span>));</span><br><span class="line">        }, time);</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢æœ¬æœºå…¬ç½‘IP</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">findMyIP</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">const</span> rawData = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">race</span>([</span><br><span class="line">        <span class="title function_">request</span>({ <span class="attr">url</span>: <span class="string">&#x27;http://myip.ipip.net&#x27;</span>, <span class="attr">json</span>: <span class="literal">false</span> }),</span><br><span class="line">        <span class="comment">// request({ url: &#x27;http://ipinfo.io&#x27;, json: false }),</span></span><br><span class="line">        <span class="title function_">request</span>({ <span class="attr">url</span>: <span class="string">&#x27;https://api.ipify.org&#x27;</span>, <span class="attr">json</span>: <span class="literal">false</span> })</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> match = rawData.<span class="title function_">match</span>(<span class="regexp">/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})/</span>);</span><br><span class="line">    <span class="keyword">if</span> (!match) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`æ— æ³•è§£æIPã€‚<span class="subst">${rawData}</span>`</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> match[<span class="number">1</span>];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿæˆå…¬å…±å‚æ•°</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * å‚è€ƒï¼š&lt;https://help.aliyun.com/document_detail/29745.html&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} {<span class="type"> accessKeyId, format = &#x27;JSON&#x27;, signatureNonce = Math.random(), timestamp = utcDateFormat(new Date()) </span>}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generatePublicParams</span>(<span class="params">{ accessKeyId, format = <span class="string">&#x27;JSON&#x27;</span>, signatureNonce = <span class="built_in">Math</span>.random(), timestamp = utcDateFormat(<span class="keyword">new</span> <span class="built_in">Date</span>()) }</span>) {</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        <span class="string">&#x27;AccessKeyId&#x27;</span>: accessKeyId,</span><br><span class="line">        <span class="string">&#x27;Format&#x27;</span>: format,</span><br><span class="line">        <span class="string">&#x27;Version&#x27;</span>: <span class="string">&#x27;2015-01-09&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SignatureMethod&#x27;</span>: <span class="string">&#x27;HMAC-SHA1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SignatureNonce&#x27;</span>: signatureNonce,</span><br><span class="line">        <span class="string">&#x27;SignatureVersion&#x27;</span>: <span class="string">&#x27;1.0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Timestamp&#x27;</span>: timestamp</span><br><span class="line">    };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç­¾å</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * è§„åˆ™ï¼š&lt;https://help.aliyun.com/document_detail/29747.html&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} {<span class="type"> params, accesskeySecret </span>}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sign</span>(<span class="params">{ params, accesskeySecret }</span>) {</span><br><span class="line">    <span class="keyword">const</span> query = <span class="title class_">Object</span>.<span class="title function_">entries</span>(params)</span><br><span class="line">        .<span class="title function_">sort</span>(<span class="function">(<span class="params">param1, param2</span>) =&gt;</span> <span class="title function_">compareString</span>(param1[<span class="number">0</span>], param2[<span class="number">0</span>]))</span><br><span class="line">        .<span class="title function_">map</span>(<span class="function">(<span class="params">[key, val]</span>) =&gt;</span> [<span class="title function_">percentEncode</span>(key), <span class="title function_">percentEncode</span>(val)])</span><br><span class="line">        .<span class="title function_">map</span>(<span class="function"><span class="params">param</span> =&gt;</span> param.<span class="title function_">join</span>(<span class="string">&#x27;=&#x27;</span>))</span><br><span class="line">        .<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> stringToSign = <span class="string">&#x27;GET&amp;&#x27;</span> + <span class="title function_">percentEncode</span>(<span class="string">&#x27;/&#x27;</span>) + <span class="string">&#x27;&amp;&#x27;</span> + <span class="title function_">percentEncode</span>(query);</span><br><span class="line">    <span class="keyword">const</span> signStr = <span class="title function_">sha1</span>(stringToSign, <span class="string">`<span class="subst">${accesskeySecret}</span>&amp;`</span>);</span><br><span class="line">    <span class="keyword">return</span> signStr;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯·æ±‚æ¥å£</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} {<span class="type"> params, accessKeyId, accesskeySecret </span>}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">callApi</span>(<span class="params">{ params, accessKeyId, accesskeySecret }</span>) {</span><br><span class="line">    <span class="comment">// ç­¾å</span></span><br><span class="line">    <span class="keyword">const</span> signStr = <span class="title function_">sign</span>({ params, accesskeySecret });</span><br><span class="line">    params[<span class="string">&#x27;Signature&#x27;</span>] = signStr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">request</span>({ <span class="attr">url</span>: <span class="string">&#x27;https://alidns.aliyuncs.com/&#x27;</span>, <span class="attr">query</span>: params });</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–è§£æè®°å½•åˆ—è¡¨</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å‚è€ƒï¼š&lt;https://help.aliyun.com/document_detail/29776.html&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} {<span class="type"> domainName, rrKeyWord, pageNumber = 1, pageSize = 20, typeKeyWord = &#x27;A&#x27;, accessKeyId = ACCESS_KEY_ID, accesskeySecret = ACCESS_KEY_SECRET </span>}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">describeDomainRecords</span>(<span class="params">{ domainName, rrKeyWord, pageNumber = <span class="number">1</span>, pageSize = <span class="number">20</span>, typeKeyWord = <span class="string">&#x27;A&#x27;</span>, accessKeyId = ACCESS_KEY_ID, accesskeySecret = ACCESS_KEY_SECRET }</span>) {</span><br><span class="line">    <span class="keyword">const</span> params = {</span><br><span class="line">        <span class="string">&#x27;Action&#x27;</span>: <span class="string">&#x27;DescribeDomainRecords&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DomainName&#x27;</span>: domainName,</span><br><span class="line">        <span class="string">&#x27;PageNumber&#x27;</span>: pageNumber,</span><br><span class="line">        <span class="string">&#x27;PageSize&#x27;</span>: pageSize,</span><br><span class="line">        <span class="string">&#x27;RRKeyWord&#x27;</span>: rrKeyWord,</span><br><span class="line">        <span class="string">&#x27;TypeKeyWord&#x27;</span>: typeKeyWord</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(params, <span class="title function_">generatePublicParams</span>({ accessKeyId }));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> resp = <span class="keyword">await</span> <span class="title function_">callApi</span>({ params, accessKeyId, accesskeySecret });</span><br><span class="line">    <span class="keyword">return</span> resp;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿®æ”¹è§£æè®°å½•</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * å‚è€ƒï¼š&lt;https://help.aliyun.com/document_detail/29774.html&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> {<span class="type">*</span>} {<span class="type"> recordId, rr, value, type = &#x27;A&#x27;, ttl = 600, line = &#x27;default&#x27;, accessKeyId = ACCESS_KEY_ID, accesskeySecret = ACCESS_KEY_SECRET </span>}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ttl åŸºç¡€ç‰ˆæœ€å°600ç§’</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">updateDomainRecord</span>(<span class="params">{ recordId, rr, value, type = <span class="string">&#x27;A&#x27;</span>, ttl = <span class="number">600</span>, line = <span class="string">&#x27;default&#x27;</span>, accessKeyId = ACCESS_KEY_ID, accesskeySecret = ACCESS_KEY_SECRET }</span>) {</span><br><span class="line">    <span class="keyword">const</span> params = {</span><br><span class="line">        <span class="string">&#x27;Action&#x27;</span>: <span class="string">&#x27;UpdateDomainRecord&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;RecordId&#x27;</span>: recordId,</span><br><span class="line">        <span class="string">&#x27;RR&#x27;</span>: rr,</span><br><span class="line">        <span class="string">&#x27;Type&#x27;</span>: type,</span><br><span class="line">        <span class="string">&#x27;Value&#x27;</span>: value,</span><br><span class="line">        <span class="string">&#x27;TTL&#x27;</span>: ttl,</span><br><span class="line">        <span class="string">&#x27;Line&#x27;</span>: line</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(params, <span class="title function_">generatePublicParams</span>({ accessKeyId }));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> resp = <span class="keyword">await</span> <span class="title function_">callApi</span>({ params, accessKeyId, accesskeySecret });</span><br><span class="line">    <span class="keyword">return</span> resp;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// findMyIP().then(console.log).catch(console.error);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// describeDomainRecords({ domainName: &#x27;kekek.cc&#x27;, rrKeyWord: &#x27;www&#x27; }).then((recoder) =&gt; {</span></span><br><span class="line"><span class="comment">//     console.log(JSON.stringify(recoder, null, 2))</span></span><br><span class="line"><span class="comment">// }).catch(console.error)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// updateDomainRecord({ recordId: &#x27;3535020439014400&#x27;, rr: &#x27;www&#x27;, value: &#x27;202.106.0.21&#x27; }).then(console.log).catch(console.error)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ========================================&gt;</span></span><br><span class="line"></span><br><span class="line">(<span class="title function_">async</span> () =&gt; {</span><br><span class="line">    <span class="comment">// è¦æ›´æ–°çš„åŸŸå</span></span><br><span class="line">    <span class="keyword">let</span> records = [];</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        records = <span class="built_in">require</span>(<span class="string">&#x27;./domains.json&#x27;</span>);</span><br><span class="line">    } <span class="keyword">catch</span> (ignored) {</span><br><span class="line">        records = [</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">domainName</span>: <span class="string">&#x27;kekek.cc&#x27;</span>,</span><br><span class="line">                <span class="attr">rrKeyWord</span>: <span class="string">&#x27;www&#x27;</span></span><br><span class="line">            },</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">domainName</span>: <span class="string">&#x27;kekek.cc&#x27;</span>,</span><br><span class="line">                <span class="attr">rrKeyWord</span>: <span class="string">&#x27;@&#x27;</span></span><br><span class="line">            }</span><br><span class="line">        ];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> myip = <span class="keyword">await</span> <span class="title function_">findMyIP</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> record <span class="keyword">of</span> records) {</span><br><span class="line">        <span class="keyword">const</span> recordDetails = <span class="keyword">await</span> <span class="title function_">describeDomainRecords</span>(record);</span><br><span class="line">        <span class="keyword">const</span> recordDetail = recordDetails.<span class="property">DomainRecords</span>.<span class="property">Record</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">_record</span> =&gt;</span> _record.<span class="property">RR</span> === record.<span class="property">rrKeyWord</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (recordDetail &amp;&amp; recordDetail[<span class="string">&#x27;Value&#x27;</span>] !== myip) {</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[update] domainName: %s, rr: %s, before: %s, after: %s&#x27;</span>, record.<span class="property">domainName</span>, record.<span class="property">rrKeyWord</span>, recordDetail[<span class="string">&#x27;Value&#x27;</span>], myip);</span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">updateDomainRecord</span>({ <span class="attr">recordId</span>: recordDetail[<span class="string">&#x27;RecordId&#x27;</span>], <span class="attr">rr</span>: record.<span class="property">rrKeyWord</span>, <span class="attr">value</span>: myip, <span class="attr">ttl</span>: record.<span class="property">ttl</span> });</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">})().<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Date</span>())).<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">error</span>)</span><br></pre></td></tr></table></figure><p>ç¼ºé™·ï¼šDNSæ˜¯æœ‰ç¼“å­˜çš„ï¼Œæ›´æ–°äº†æ–°çš„è§£æåä¸èƒ½ç«‹å³ç”Ÿæ•ˆã€‚è¿™æ ·ç½‘ç«™ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…ä¸å¯ç”¨ã€‚</p><blockquote><p>ç¼“å­˜çš„é—®é¢˜å¯ä»¥é€šè¿‡è´­ä¹°DNSvipæœåŠ¡å®ç°æœ€ä½1ç§’çš„ç¼“å­˜ã€‚</p></blockquote><h3 id="è®¾å¤‡"><a href="#è®¾å¤‡" class="headerlink" title="è®¾å¤‡"></a>è®¾å¤‡</h3><p>æ—§ç”µè„‘æˆ–è€…æ ‘è“æ´¾</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;åœ¨å®¶åº­å®½å¸¦éƒ¨ç½²WebæœåŠ¡å™¨&quot;&gt;&lt;a href=&quot;#åœ¨å®¶åº­å®½å¸¦éƒ¨ç½²WebæœåŠ¡å™¨&quot; class=&quot;headerlink&quot; title=&quot;åœ¨å®¶åº­å®½å¸¦éƒ¨ç½²WebæœåŠ¡å™¨&quot;&gt;&lt;/a&gt;åœ¨å®¶åº­å®½å¸¦éƒ¨ç½²WebæœåŠ¡å™¨&lt;/h2&gt;&lt;h3 id=&quot;ç«¯å£æ˜ å°„&quot;&gt;&lt;a href=&quot;#ç«¯å£æ˜ å°„&quot;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Systemd</title>
    <link href="https://kekek.cc/post/systemd.html"/>
    <id>https://kekek.cc/post/systemd.html</id>
    <published>2018-09-10T05:34:06.000Z</published>
    <updated>2021-11-20T00:17:47.719Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Systemd"><a href="#Systemd" class="headerlink" title="Systemd"></a>Systemd</h2><h3 id="åˆ›å»ºæœåŠ¡"><a href="#åˆ›å»ºæœåŠ¡" class="headerlink" title="åˆ›å»ºæœåŠ¡"></a>åˆ›å»ºæœåŠ¡</h3><p>vim &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;nginx.service</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=The NGINX HTTP and reverse proxy server</span><br><span class="line">After=syslog.target network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/var/run/nginx.pid</span><br><span class="line">ExecStartPre=/usr/sbin/nginx -t</span><br><span class="line">ExecStart=/usr/sbin/nginx</span><br><span class="line">ExecReload=/usr/sbin/nginx -s reload</span><br><span class="line">ExecStop=/bin/kill -s QUIT $MAINPID</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–æ—¶è‡ªåŠ¨å¯åŠ¨æœåŠ¡"><a href="#åˆå§‹åŒ–æ—¶è‡ªåŠ¨å¯åŠ¨æœåŠ¡" class="headerlink" title="åˆå§‹åŒ–æ—¶è‡ªåŠ¨å¯åŠ¨æœåŠ¡"></a>åˆå§‹åŒ–æ—¶è‡ªåŠ¨å¯åŠ¨æœåŠ¡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /lib/systemd/system/nginx.service  /etc/systemd/system/multi-user.target.wants/nginx.service</span><br></pre></td></tr></table></figure><p>æˆ–è€… </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure><h3 id="åˆ·æ–°é…ç½®"><a href="#åˆ·æ–°é…ç½®" class="headerlink" title="åˆ·æ–°é…ç½®"></a>åˆ·æ–°é…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨ã€é‡å¯ã€åœæ­¢"><a href="#å¯åŠ¨ã€é‡å¯ã€åœæ­¢" class="headerlink" title="å¯åŠ¨ã€é‡å¯ã€åœæ­¢"></a>å¯åŠ¨ã€é‡å¯ã€åœæ­¢</h3><ol><li><p>å¯åŠ¨nginx</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl start nginx</span><br></pre></td></tr></table></figure></li><li><p>é‡å¯nginx</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl restart nginx</span><br></pre></td></tr></table></figure></li><li><p>åœæ­¢nginx</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl stop nginx</span><br></pre></td></tr></table></figure></li></ol><h3 id="å¼€æœºå¯åŠ¨"><a href="#å¼€æœºå¯åŠ¨" class="headerlink" title="å¼€æœºå¯åŠ¨"></a>å¼€æœºå¯åŠ¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹çŠ¶æ€"><a href="#æŸ¥çœ‹çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹çŠ¶æ€"></a>æŸ¥çœ‹çŠ¶æ€</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status nginx</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://blog.csdn.net/chwshuang/article/details/68489968">systemctlç®¡ç†Rediså¯åŠ¨ã€åœæ­¢ã€å¼€æœºå¯åŠ¨</a></li><li><a href="https://www.nginx.com/resources/wiki/start/topics/examples/systemd/">NGINX systemd service file</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Systemd&quot;&gt;&lt;a href=&quot;#Systemd&quot; class=&quot;headerlink&quot; title=&quot;Systemd&quot;&gt;&lt;/a&gt;Systemd&lt;/h2&gt;&lt;h3 id=&quot;åˆ›å»ºæœåŠ¡&quot;&gt;&lt;a href=&quot;#åˆ›å»ºæœåŠ¡&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    
    <category term="systemctl" scheme="https://kekek.cc/tags/systemctl/"/>
    
  </entry>
  
  <entry>
    <title>console.logçš„å»¶è¿Ÿè®¡ç®—</title>
    <link href="https://kekek.cc/post/lazy-evaluation-of-console-log.html"/>
    <id>https://kekek.cc/post/lazy-evaluation-of-console-log.html</id>
    <published>2018-08-29T02:52:23.000Z</published>
    <updated>2021-11-20T00:17:47.692Z</updated>
    
    <content type="html"><![CDATA[<h2 id="console-logçš„å»¶è¿Ÿè®¡ç®—"><a href="#console-logçš„å»¶è¿Ÿè®¡ç®—" class="headerlink" title="console.logçš„å»¶è¿Ÿè®¡ç®—"></a>console.logçš„å»¶è¿Ÿè®¡ç®—</h2><p>æˆ‘ä»¬è°ƒè¯•JavaScriptæ—¶ç»å¸¸ä¼šç”¨åˆ°<code>console.log</code>æ‰“å°ï¼Œä½†æ˜¯<code>console.log</code>æ‰“å°å¯¹è±¡æ—¶ä¸é‚£ä¹ˆå‡†ç¡®ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">&#x27;Ming&#x27;</span> &#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user);</span><br><span class="line">user.<span class="property">name</span> = <span class="string">&#x27;Lee&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/images/console-log-lazy-evaluation.jpeg"></p><p><code>user.name</code>çš„åˆå§‹å€¼ä¸º<code>Ming</code>ï¼Œæ‰“å°<code>user</code>çœ‹åˆ°çš„<code>name</code>å€¼ä¹Ÿæ˜¯<code>Ming</code>ã€‚ç´§æ¥ç€ä¿®æ”¹<code>user.name</code>å€¼ä¸º<code>Lee</code>ï¼Œç„¶åå†æš‚å¼€å‰é¢æ‰“å°<code>user</code>å¯¹è±¡å°±çœ‹åˆ°<code>name</code>å€¼å˜æˆäº†<code>Lee</code>ã€‚</p><p>è¿™ä¸ªå±•å¼€çœ‹åˆ°çš„å€¼æ˜¯Chromeä¸ºäº†ä¼˜åŒ–<code>console.log</code>è¿›è¡Œçš„å»¶è¿Ÿè®¡ç®—ï¼Œæˆ‘ä»¬çœ‹åˆ°å¯¹è±¡å±•å¼€åçš„å€¼æ˜¯åœ¨å±•å¼€æ—¶å®æ—¶è®¡ç®—çš„ã€‚å¦‚æœç•™æ„åœ¨å±•å¼€å¯¹è±¡æ—¶ä¼šæœ‰ä¸€ä¸ªæç¤º<code>Value below was evaluated just now.</code>ã€‚</p><p>ä¸ºäº†é¿å…ä¸Šè¿°é—®é¢˜åœ¨æ‰“å°å¯¹è±¡æ—¶å¯ä»¥å°†å¯¹è±¡åºåˆ—åŒ–ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user, <span class="literal">null</span>, <span class="number">2</span>)); <span class="comment">// æ ¼å¼åŒ–</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;console-logçš„å»¶è¿Ÿè®¡ç®—&quot;&gt;&lt;a href=&quot;#console-logçš„å»¶è¿Ÿè®¡ç®—&quot; class=&quot;headerlink&quot; title=&quot;console.logçš„å»¶è¿Ÿè®¡ç®—&quot;&gt;&lt;/a&gt;console.logçš„å»¶è¿Ÿè®¡ç®—&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬è°ƒè¯•JavaScript</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>HTTPä»£ç†æœåŠ¡å™¨</title>
    <link href="https://kekek.cc/post/http-proxy.html"/>
    <id>https://kekek.cc/post/http-proxy.html</id>
    <published>2018-08-24T08:22:30.000Z</published>
    <updated>2021-11-20T00:17:47.679Z</updated>
    
    <content type="html"><![CDATA[<h2 id="HTTPä»£ç†æœåŠ¡å™¨"><a href="#HTTPä»£ç†æœåŠ¡å™¨" class="headerlink" title="HTTPä»£ç†æœåŠ¡å™¨"></a>HTTPä»£ç†æœåŠ¡å™¨</h2><p>ç§‘å­¦ä¸Šç½‘å’Œè°ƒè¯•ç½‘ç«™æ—¶ç»å¸¸ä¼šç”¨åˆ°ä»£ç†æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä»£ç†æœåŠ¡å™¨æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿä»£ç†æœåŠ¡å™¨å’ŒwebæœåŠ¡å™¨æœ¬èº«æ²¡æœ‰å¤ªå¤šå·®åˆ«ï¼Œå¦‚æœæ˜¯èµ°ä»£ç†è¯·æ±‚æµè§ˆå™¨ä¼šæŠŠè¯·æ±‚å‘é€åˆ°ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶ä¸”è¯·æ±‚æŠ¥æ–‡ä¸­ä½¿ç”¨<strong>å®Œæ•´URI</strong>ï¼ˆå‚è€ƒä¸‹å›¾ä¸­a&#x2F;bï¼‰ã€‚</p><p><img src="/images/http-proxy.png"></p><p>ä½¿ç”¨telnetæ¨¡æ‹Ÿæ™®é€šè¯·æ±‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ telnet css.kekek.cc 80</span><br><span class="line">Trying 47.94.202.145...</span><br><span class="line">Connected to css.kekek.cc.</span><br><span class="line">Escape character is &#x27;^]&#x27;.</span><br><span class="line">GET / HTTP/1.0</span><br><span class="line">host: css.kekek.cc</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: openresty</span><br><span class="line">Date: Fri, 24 Aug 2018 08:48:31 GMT</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line">Content-Length: 3876</span><br><span class="line">Last-Modified: Thu, 03 May 2018 13:28:06 GMT</span><br><span class="line">Connection: close</span><br><span class="line">ETag: &quot;5aeb0e66-f24&quot;</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨telnetæ¨¡æ‹Ÿæ˜¾ç¤ºä»£ç†è¯·æ±‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ telnet proxy.kekek.cc 1337</span><br><span class="line">Trying 39.106.12.213...</span><br><span class="line">Connected to proxy.kekek.cc.</span><br><span class="line">Escape character is &#x27;^]&#x27;.</span><br><span class="line">GET http://css.kekek.cc/ HTTP/1.0</span><br><span class="line">host: css.kekek.cc</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">server: openresty</span><br><span class="line">date: Fri, 24 Aug 2018 08:50:21 GMT</span><br><span class="line">content-type: text/html; charset=UTF-8</span><br><span class="line">content-length: 3876</span><br><span class="line">last-modified: Thu, 03 May 2018 13:28:06 GMT</span><br><span class="line">connection: close</span><br><span class="line">etag: &quot;5aeb0e66-f24&quot;</span><br><span class="line">accept-ranges: bytes</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>HTTPSæ¨¡å¼ä¸‹çš„ä»£ç†å’ŒHTTPæ–¹å¼ä¼šæœ‰æ‰€ä¸åŒï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•è§£æHTTPSè¯·æ±‚ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µåªèƒ½ä½¿ç”¨é€ä¼ çš„æ–¹å¼ï¼Œåœ¨tcpå±‚ç›´æ¥å°†è¯·æ±‚è½¬å‘åˆ°ç›®æ ‡æœåŠ¡å™¨å³å¯ã€‚</p><h3 id="PAC"><a href="#PAC" class="headerlink" title="PAC"></a>PAC</h3><p>ç°ä»£æµè§ˆå™¨å‡ ä¹éƒ½æ”¯æŒ Proxy Auto-Configuration ï¼ˆPACï¼‰ï¼Œè¿™ä¸ªå¯ä»¥è®©æˆ‘ä»¬æ›´çµæ´»çš„ä½¿ç”¨ä»£ç†ã€‚æ¯”å¦‚å…¬å¸ç½‘ç«™ä½¿ç”¨ä»£ç†å…¶å®ƒç½‘ç«™ä¸èµ°ä»£ç†ï¼Œæœ‰äº†PACè¿™éƒ½å¯ä»¥åšåˆ°ã€‚PACæ˜¯ä¸€ä¸ªJavaScriptæ–‡ä»¶ï¼ŒMIMEä¸º<code>application/x-ns-proxy-autoconfig</code>ã€‚æ¯ä¸ªPACæ–‡ä»¶å¿…é¡»æœ‰ä¸€ä¸ªåä¸º<code>FindProxyForURL(url,host)</code>çš„å‡½æ•°ï¼Œç”¨æ¥è®¡ç®—è®¿é—®URIæ—¶ä½¿ç”¨çš„ä»£ç†æœåŠ¡å™¨ã€‚å‡½æ•°è¿”å›å€¼æ ¼å¼å¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>FindProxyForURLçš„è¿”å›å€¼</th><th>æã€€ã€€è¿°</th></tr></thead><tbody><tr><td>DIRECT</td><td>ä¸ç»è¿‡ä»»ä½•ä»£ç†ï¼Œç›´æ¥è¿›è¡Œè¿æ¥</td></tr><tr><td>PROXY host:port</td><td>åº”è¯¥ä½¿ç”¨æŒ‡å®šçš„ä»£ç†</td></tr><tr><td>SOCKS host:port</td><td>åº”è¯¥ä½¿ç”¨æŒ‡å®šçš„ SOCKS æœåŠ¡å™¨</td></tr></tbody></table><p>ç¤ºä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Proxy Auto-Configuration (PAC) file</span></span><br><span class="line"><span class="keyword">var</span> proxy = <span class="string">&quot;PROXY proxy.kekek.cc:1337; DIRECT;&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> direct = <span class="string">&#x27;DIRECT;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">FindProxyForURL</span>(<span class="params">url, host</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/\.google\.com$/</span>.<span class="title function_">test</span>(host)) &#123;</span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> direct;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨<a href="https://github.com/manugarg/pacparser">pacparser</a>æ¥æµ‹è¯•æˆ‘ä»¬çš„PACæ–‡ä»¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install pacparser</span><br></pre></td></tr></table></figure><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p><a href="https://github.com/tianyk/http-proxy">GitHub</a></p><figure class="highlight javascript"><figcaption><span>proxy.js</span><a href="/downloads/code/autogeneration/proxy.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2018-08-24 17:20:00</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">1337</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">HOST</span> = process.<span class="property">env</span>.<span class="property">HOST</span> || <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MY_IP</span> = <span class="string">&#x27;0.0.0.0&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SERVER_TIMEOUT</span> = <span class="number">2</span> * <span class="number">60</span> * <span class="number">1000</span>; <span class="comment">// 2mins</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SEND_TIMEOUT</span>  = <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROXY_TIMEOUT</span> = <span class="number">60</span> * <span class="number">1000</span>; <span class="comment">// 1mins</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ª HTTP ä»£ç†æœåŠ¡å™¨</span></span><br><span class="line"><span class="keyword">const</span> proxy = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line">proxy.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">cReq, cRes</span>) =&gt;</span> {</span><br><span class="line">    <span class="keyword">const</span> cUrl = cReq.<span class="property">url</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(cUrl);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»£ç†æ¨¡å¼</span></span><br><span class="line">    <span class="keyword">if</span> (cUrl.<span class="title function_">startsWith</span>(<span class="string">&#x27;http&#x27;</span>)) {</span><br><span class="line">        <span class="keyword">const</span> { method, headers } = cReq;</span><br><span class="line">        <span class="keyword">const</span> { hostname, port = <span class="number">80</span>, path } = url.<span class="title function_">parse</span>(cReq.<span class="property">url</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// via</span></span><br><span class="line">        <span class="keyword">let</span> via = headers[<span class="string">&#x27;via&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (via) {</span><br><span class="line">            via = via += <span class="string">&#x27;, 1.1 proxy.kekek.cc (KEKE-Proxy)&#x27;</span>;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            via = <span class="string">&#x27;1.1 proxy.kekek.cc (KEKE-Proxy)&#x27;</span>;</span><br><span class="line">        }</span><br><span class="line">        headers[<span class="string">&#x27;via&#x27;</span>] = via;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// x-forward-for</span></span><br><span class="line">        <span class="keyword">let</span> ips = headers[<span class="string">&#x27;x-forward-for&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (ips) {</span><br><span class="line">            ips += <span class="string">`, <span class="subst">${MY_IP}</span>`</span>;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            ips = <span class="variable constant_">MY_IP</span>;</span><br><span class="line">        }</span><br><span class="line">        headers[<span class="string">&#x27;x-forward-for&#x27;</span>] = ips;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Max-Forwards</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æœåŠ¡å™¨å“åº”è¶…æ—¶</span></span><br><span class="line">        <span class="comment">// cRes.setTimeout(SEND_TIMEOUT, () =&gt; {</span></span><br><span class="line">        <span class="comment">//     cRes.writeHead(504, { &#x27;content-type&#x27;: &#x27;text/plain&#x27; });</span></span><br><span class="line">        <span class="comment">//     cRes.end(&#x27;Send Timeout&#x27;);</span></span><br><span class="line">        <span class="comment">// });</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// &lt;http.ClientRequest&gt;</span></span><br><span class="line">        <span class="keyword">const</span> pReq = http.<span class="title function_">request</span>({ hostname, port, path, method, headers });</span><br><span class="line">        pReq</span><br><span class="line">            .<span class="built_in">setTimeout</span>(<span class="variable constant_">PROXY_TIMEOUT</span>)</span><br><span class="line">            .<span class="title function_">on</span>(<span class="string">&#x27;response&#x27;</span>, <span class="function">(<span class="params">pRes</span>) =&gt;</span> {</span><br><span class="line">                <span class="comment">// &lt;http.IncomingMessage&gt;</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[response] [proxy] <span class="subst">${cUrl}</span>`</span>);</span><br><span class="line"></span><br><span class="line">                cRes.<span class="title function_">writeHead</span>(pRes.<span class="property">statusCode</span>, pRes.<span class="property">headers</span>);</span><br><span class="line">                pRes.<span class="title function_">pipe</span>(cRes);</span><br><span class="line">            })</span><br><span class="line">            .<span class="title function_">on</span>(<span class="string">&#x27;timeout&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">                <span class="comment">// ä»£ç†è¯·æ±‚è¶…æ—¶</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[timeout] [proxy-req] <span class="subst">${cUrl}</span>`</span>);</span><br><span class="line">                pReq.<span class="title function_">abort</span>();</span><br><span class="line">            })</span><br><span class="line">            .<span class="title function_">on</span>(<span class="string">&#x27;abort&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[abort] [proxy-req] <span class="subst">${cUrl}</span>`</span>);</span><br><span class="line">            })</span><br><span class="line">            .<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[close] [proxy-req] <span class="subst">${cUrl}</span>`</span>);</span><br><span class="line">            })</span><br><span class="line">            .<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[error] [proxy-req] <span class="subst">${cUrl}</span> \r\n<span class="subst">${err.stack}</span>`</span>);</span><br><span class="line">                cRes.<span class="title function_">writeHead</span>(<span class="number">500</span>, { <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span> });</span><br><span class="line">                cRes.<span class="title function_">end</span>(<span class="string">`Proxy Error: <span class="subst">${err.code || err.message || err.name}</span>`</span>);</span><br><span class="line">            });</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯·æ±‚é‡å®šå‘</span></span><br><span class="line">        cReq.<span class="title function_">pipe</span>(pReq);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®¢æˆ·ç«¯ä¸­æ­¢</span></span><br><span class="line">        cReq.<span class="title function_">on</span>(<span class="string">&#x27;aborted&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[aborted] [client] <span class="subst">${cUrl}</span>`</span>);</span><br><span class="line">            <span class="comment">// ä¸­æ­¢ä»£ç†</span></span><br><span class="line">            pReq.<span class="title function_">abort</span>();</span><br><span class="line">        });</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// http-server</span></span><br><span class="line">        <span class="keyword">if</span> (cUrl === <span class="string">&#x27;/proxy.pac&#x27;</span>) {</span><br><span class="line">            cRes.<span class="title function_">setHeader</span>(<span class="string">&#x27;content-type&#x27;</span>, <span class="string">&#x27;application/x-ns-proxy-autoconfig&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> pac = <span class="string">`// Proxy Auto-Configuration (PAC) file</span></span><br><span class="line"><span class="string">// https://developer.mozilla.org/en-US/docs/Web/HTTP/Proxy_servers_and_tunneling/Proxy_Auto-Configuration_(PAC)_file</span></span><br><span class="line"><span class="string">// DIRECT        ä¸ç»è¿‡ä»»ä½•ä»£ç†ï¼Œç›´æ¥è¿›è¡Œè¿æ¥</span></span><br><span class="line"><span class="string">// PROXY host:portåº”è¯¥ä½¿ç”¨æŒ‡å®šçš„ä»£ç†</span></span><br><span class="line"><span class="string">// SOCKS host:portåº”è¯¥ä½¿ç”¨æŒ‡å®šçš„ SOCKS æœåŠ¡å™¨</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var proxy = &quot;PROXY proxy.kekek.cc:1337; DIRECT;&quot;;</span></span><br><span class="line"><span class="string">var direct = &#x27;DIRECT;&#x27;;</span></span><br><span class="line"><span class="string">function FindProxyForURL(url, host){</span></span><br><span class="line"><span class="string">    if (/\.\kekek\.cc$/.test(host)) {</span></span><br><span class="line"><span class="string">        return proxy;</span></span><br><span class="line"><span class="string">    } else {</span></span><br><span class="line"><span class="string">        return direct;</span></span><br><span class="line"><span class="string">    }</span></span><br><span class="line"><span class="string">}`</span>;</span><br><span class="line"></span><br><span class="line">            cRes.<span class="title function_">end</span>(pac);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            cRes.<span class="title function_">setHeader</span>(<span class="string">&#x27;content-type&#x27;</span>, <span class="string">&#x27;text/plain&#x27;</span>);</span><br><span class="line">            cRes.<span class="title function_">end</span>(<span class="string">&#x27;proxy: proxy.kekek.cc\r\nport: 1337\r\npac: http://proxy.kekek.cc:1337/proxy.pac&#x27;</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// https</span></span><br><span class="line">proxy.<span class="title function_">on</span>(<span class="string">&#x27;connect&#x27;</span>, <span class="function">(<span class="params">req, cltSocket, head</span>) =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">url</span>, head.<span class="property">length</span>)</span><br><span class="line">    <span class="comment">// è¿æ¥åˆ°ä¸€ä¸ªæœåŠ¡å™¨</span></span><br><span class="line">    <span class="keyword">const</span> { port, hostname } = url.<span class="title function_">parse</span>(<span class="string">`http://<span class="subst">${req.url}</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> srvSocket = net.<span class="title function_">connect</span>(port, hostname);</span><br><span class="line"></span><br><span class="line">    srvSocket.<span class="title function_">on</span>(<span class="string">&#x27;connect&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">        cltSocket.<span class="title function_">write</span>(<span class="string">&#x27;HTTP/1.1 200 Connection Established\r\n&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;Proxy-agent: Node.js-Proxy\r\n&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;\r\n&#x27;</span>);</span><br><span class="line">        srvSocket.<span class="title function_">write</span>(head);</span><br><span class="line">        <span class="comment">// è¿æ¥ç®¡é“</span></span><br><span class="line">        srvSocket.<span class="title function_">pipe</span>(cltSocket);</span><br><span class="line">        cltSocket.<span class="title function_">pipe</span>(srvSocket);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="comment">// srvSocket.on(&#x27;end&#x27;, () =&gt; {</span></span><br><span class="line">    <span class="comment">//     // è¿œç¨‹æœåŠ¡å™¨æ–­å¼€</span></span><br><span class="line">    <span class="comment">//     console.log(`[end] ${req.url}`);</span></span><br><span class="line">    <span class="comment">//     cltSocket.end();</span></span><br><span class="line">    <span class="comment">// });</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// srvSocket.on(&#x27;timeout&#x27;, () =&gt; {</span></span><br><span class="line">    <span class="comment">//     console.log(`[timeout] ${req.url}`);</span></span><br><span class="line">    <span class="comment">//     srvSocket.end();</span></span><br><span class="line">    <span class="comment">//     cltSocket.end();</span></span><br><span class="line">    <span class="comment">// });</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// srvSocket.on(&#x27;close&#x27;, (hasError) =&gt; {</span></span><br><span class="line">    <span class="comment">//     // è¿œç¨‹æœåŠ¡å™¨å®Œå…¨æ–­å¼€</span></span><br><span class="line">    <span class="comment">//     console.log(`[close] ${req.url} ${hasError}`);</span></span><br><span class="line">    <span class="comment">// });</span></span><br><span class="line"></span><br><span class="line">    srvSocket.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">        <span class="comment">// è¿œç¨‹æœåŠ¡å™¨æŠ¥é”™</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[error] <span class="subst">${req.url}</span> \r\n<span class="subst">${err.stack}</span>`</span>);</span><br><span class="line">        <span class="keyword">const</span> error = <span class="string">`Proxy Error: <span class="subst">${err.code || err.message || err.name}</span>`</span></span><br><span class="line">        cltSocket.<span class="title function_">end</span>(<span class="string">`HTTP/1.1 500 Internal Server Error\r\ncontent-type:text/plain\r\ncontent-length:<span class="subst">${err.length}</span>\r\n\r\n<span class="subst">${error}</span>`</span>);</span><br><span class="line">    });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">proxy.<span class="title function_">on</span>(<span class="string">&#x27;listening&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Proxy-Server running on http://<span class="subst">${HOST}</span>:<span class="subst">${PORT}</span>`</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»£ç†æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ</span></span><br><span class="line">proxy.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="variable constant_">HOST</span>);</span><br></pre></td></tr></table></figure><h3 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://book.douban.com/subject/10746113/">HTTPæƒå¨æŒ‡å—-ç¬¬å…­ç«  ä»£ç†</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Proxy_servers_and_tunneling/Proxy_Auto-Configuration_(PAC)_file">Proxy Auto-Configuration (PAC) file</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;HTTPä»£ç†æœåŠ¡å™¨&quot;&gt;&lt;a href=&quot;#HTTPä»£ç†æœåŠ¡å™¨&quot; class=&quot;headerlink&quot; title=&quot;HTTPä»£ç†æœåŠ¡å™¨&quot;&gt;&lt;/a&gt;HTTPä»£ç†æœåŠ¡å™¨&lt;/h2&gt;&lt;p&gt;ç§‘å­¦ä¸Šç½‘å’Œè°ƒè¯•ç½‘ç«™æ—¶ç»å¸¸ä¼šç”¨åˆ°ä»£ç†æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä»£ç†æœåŠ¡å™¨æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿä»£ç†æœåŠ¡å™¨å’Œ</summary>
      
    
    
    
    
    <category term="http" scheme="https://kekek.cc/tags/http/"/>
    
    <category term="proxy" scheme="https://kekek.cc/tags/proxy/"/>
    
  </entry>
  
  <entry>
    <title>EchoæœåŠ¡</title>
    <link href="https://kekek.cc/post/echo-server.html"/>
    <id>https://kekek.cc/post/echo-server.html</id>
    <published>2018-08-17T07:58:34.000Z</published>
    <updated>2021-11-20T00:17:47.674Z</updated>
    
    <content type="html"><![CDATA[<h2 id="EchoæœåŠ¡"><a href="#EchoæœåŠ¡" class="headerlink" title="EchoæœåŠ¡"></a>EchoæœåŠ¡</h2><p>æœ‰äº›æƒ…å†µä¸‹è°ƒè¯•ç½‘ç»œå®¢æˆ·ç«¯ç¨‹åºæ—¶ä¼šéœ€è¦ä¸€ä¸ªæœåŠ¡å™¨é…åˆæµ‹è¯•ï¼Œè¿™æ—¶EchoæœåŠ¡å°±æ¯”è¾ƒé€‚åˆã€‚å®ƒèƒ½å……å½“ä¸€ä¸ªSocketæœåŠ¡å™¨ï¼Œå¹¶ä¸”ä¼šæŠŠæˆ‘ä»¬ä¼ è¿‡å»çš„å€¼è¿”å›æ¥ã€‚</p><p>æˆ‘ä»¬ä»¥<code>\n</code>æˆ–<code>\r\n</code>ä½œä¸ºç½‘ç»œåŒ…çš„åˆ†éš”ç¬¦ã€‚</p><figure class="highlight javascript"><figcaption><span>echo.js</span><a href="/downloads/code/autogeneration/echo.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">7000</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">HOST</span> = <span class="string">&#x27;0.0.0.0&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">LF</span> = <span class="string">&#x27;\n&#x27;</span>.<span class="title function_">charCodeAt</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CR</span> = <span class="string">&#x27;\r&#x27;</span>.<span class="title function_">charCodeAt</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MAX_LENGTH</span> = <span class="number">128</span>; </span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">STRIP_DELIMITER</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">findEndOfLine</span>(<span class="params">buffer</span>) {</span><br><span class="line">    <span class="keyword">let</span> i = buffer.<span class="title function_">indexOf</span>(<span class="variable constant_">LF</span>);</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; buffer[i - <span class="number">1</span>] === <span class="variable constant_">CR</span>) {</span><br><span class="line">        i--;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fail</span>(<span class="params">socket, length</span>) {</span><br><span class="line">    <span class="keyword">if</span> (socket.<span class="property">writable</span>) {</span><br><span class="line">        socket.<span class="title function_">end</span>(<span class="string">`frame length <span class="subst">${length}</span> exceeds the allowed maximum <span class="subst">${MAX_LENGTH}</span>`</span>);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        socket.<span class="title function_">end</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = net.<span class="title function_">createServer</span>();</span><br><span class="line"><span class="comment">// æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">server.<span class="property">maxConnections</span> = <span class="number">10240</span>;</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`æ–°çš„å®¢æˆ·ç«¯åŠ å…¥ï¼š<span class="subst">${socket.remoteAddress}</span>:<span class="subst">${socket.remotePort}</span>`</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®ç¼–ç  å¦åˆ™ä¸ºBuffer</span></span><br><span class="line">    <span class="comment">// socket.setEncoding(&#x27;utf8&#x27;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯ç”¨é•¿è¿æ¥ï¼Œæ¯100æ¯«ç§’æ£€æµ‹ä¸€æ¬¡æ˜¯å¦æ–­å¼€</span></span><br><span class="line">    <span class="comment">// socket.setKeepAlive(true, 100);</span></span><br><span class="line"></span><br><span class="line">    socket.<span class="built_in">setTimeout</span>(<span class="number">5000</span>); <span class="comment">// 5s</span></span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&#x27;timeout&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="comment">// timeoutå¹¶ä¸ä¼šæ–­å¼€è¿æ¥ï¼Œéœ€è¦æ‰‹åŠ¨æ–­å¼€</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¶…æ—¶æ–­å¼€&#x27;</span>);</span><br><span class="line">        socket.<span class="title function_">end</span>();</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶çš„å­—èŠ‚æ•°é‡ï¼ˆç´¯è®¡ï¼‰</span></span><br><span class="line">    <span class="comment">// socket.bytesRead</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> readBuffer = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">0</span>);</span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> {</span><br><span class="line">        readBuffer = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([readBuffer, data]);</span><br><span class="line">        <span class="keyword">const</span> eol = <span class="title function_">findEndOfLine</span>(readBuffer);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (eol &gt;= <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">let</span> frame;</span><br><span class="line">            <span class="keyword">const</span> delimLength = readBuffer[eol] === <span class="variable constant_">CR</span> ? <span class="number">2</span> : <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">const</span> length = eol + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (length &gt; <span class="variable constant_">MAX_LENGTH</span>) {</span><br><span class="line">                <span class="title function_">fail</span>(socket, length);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable constant_">STRIP_DELIMITER</span>) {</span><br><span class="line">                frame = readBuffer.<span class="title function_">slice</span>(<span class="number">0</span>, eol);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                frame = readBuffer.<span class="title function_">slice</span>(<span class="number">0</span>, eol + delimLength);</span><br><span class="line">            }</span><br><span class="line">            readBuffer = readBuffer.<span class="title function_">slice</span>(eol + delimLength + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (socket.<span class="property">writable</span>) socket.<span class="title function_">write</span>(frame);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">const</span> length = readBuffer.<span class="property">length</span>;</span><br><span class="line">            <span class="keyword">if</span> (length &gt; <span class="variable constant_">MAX_LENGTH</span>) {</span><br><span class="line">                <span class="title function_">fail</span>(socket, length);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">        <span class="comment">// å½“é”™è¯¯å‘ç”Ÿæ—¶è§¦å‘ã€‚&#x27;close&#x27; äº‹ä»¶ä¹Ÿä¼šç´§æ¥ç€è¯¥äº‹ä»¶è¢«è§¦å‘ã€‚</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`å®¢æˆ·ç«¯é”™è¯¯ï¼š<span class="subst">${err.name}</span>\n<span class="subst">${err.stack}</span>`</span>);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`å®¢æˆ·ç«¯æ–­å¼€ï¼š<span class="subst">${socket.remoteAddress}</span>:<span class="subst">${socket.remotePort}</span>`</span>);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    socket.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="comment">// å®¢æˆ·ç«¯æ–­å¼€FIN</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;FIN&#x27;</span>);</span><br><span class="line">    });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`æœåŠ¡å™¨é”™è¯¯ï¼š<span class="subst">${err.name}</span>\n<span class="subst">${err.stack}</span>`</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æœåŠ¡åœæ­¢&#x27;</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;listening&#x27;</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server listen on <span class="subst">${HOST}</span>:<span class="subst">${PORT}</span>`</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="variable constant_">HOST</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">    server.<span class="title function_">getConnections</span>(<span class="function">(<span class="params">err, connections</span>) =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (!err) {</span><br><span class="line">            <span class="keyword">const</span> now = (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">toUTCString</span>();</span><br><span class="line">            <span class="keyword">const</span> memoryUsage = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(process.<span class="title function_">memoryUsage</span>());</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[<span class="subst">${now}</span>] è¿æ¥æ•°ä¸ºï¼š<span class="subst">${connections}</span>ï¼Œæœ€å¤§è¿æ¥æ•°ä¸ºï¼š<span class="subst">${server.maxConnections}</span>ï¼Œå†…å­˜ä½¿ç”¨ï¼š<span class="subst">${memoryUsage}</span>`</span>);</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line">}, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;uncaughtException&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`uncaughtExceptionï¼š<span class="subst">${err.name}</span>\n<span class="subst">${err.stack}</span>`</span>);</span><br><span class="line">    process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">});</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ulimit -n 10240</span><br><span class="line">nohup node echo.js &gt;/var/log/echo.log 2&gt;&amp;1 &amp; </span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet echo.kekek.cc 7000</span><br></pre></td></tr></table></figure><p><a href="https://github.com/tianyk/echo.git">Github</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;EchoæœåŠ¡&quot;&gt;&lt;a href=&quot;#EchoæœåŠ¡&quot; class=&quot;headerlink&quot; title=&quot;EchoæœåŠ¡&quot;&gt;&lt;/a&gt;EchoæœåŠ¡&lt;/h2&gt;&lt;p&gt;æœ‰äº›æƒ…å†µä¸‹è°ƒè¯•ç½‘ç»œå®¢æˆ·ç«¯ç¨‹åºæ—¶ä¼šéœ€è¦ä¸€ä¸ªæœåŠ¡å™¨é…åˆæµ‹è¯•ï¼Œè¿™æ—¶EchoæœåŠ¡å°±æ¯”è¾ƒé€‚åˆã€‚å®ƒèƒ½å……å½“ä¸€ä¸ªSocket</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ES6ç®­å¤´å‡½æ•°ä¸­çš„this</title>
    <link href="https://kekek.cc/post/arrow-this.html"/>
    <id>https://kekek.cc/post/arrow-this.html</id>
    <published>2018-08-02T06:38:53.000Z</published>
    <updated>2021-11-20T00:17:47.666Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ES6ç®­å¤´å‡½æ•°ä¸­çš„this"><a href="#ES6ç®­å¤´å‡½æ•°ä¸­çš„this" class="headerlink" title="ES6ç®­å¤´å‡½æ•°ä¸­çš„this"></a>ES6ç®­å¤´å‡½æ•°ä¸­çš„this</h2><p>ES6 å¼€å§‹å¼•å…¥äº†ç®­å¤´å‡½æ•°ï¼Œè®©ä»£ç çœ‹èµ·æ¥æ›´ç®€æ´äº†ã€‚ä½†æ˜¯ç®­å¤´å‡½æ•°ä¼ ç»Ÿå‡½æ•°ä¸ä»…ä»…æ˜¯å†™æ³•ä¸Šçš„ä¸åŒï¼Œåœ¨<code>this</code>å’Œ<code>arguments</code>çš„å¤„ç†æ–¹å¼ä¹Ÿæœ‰ç€å¾ˆå¤§çš„åŒºåˆ«ã€‚</p><h3 id="thisæ˜¯å±€éƒ¨çš„"><a href="#thisæ˜¯å±€éƒ¨çš„" class="headerlink" title="thisæ˜¯å±€éƒ¨çš„"></a>thisæ˜¯å±€éƒ¨çš„</h3><p>åœ¨ç®­å¤´å‡½æ•°ä¸­<code>this</code>æ˜¯<strong>å±€éƒ¨çš„</strong>ï¼Œå®ƒè·Ÿå…¶å®ƒå±€éƒ¨å˜é‡çš„å¸¸è§„å¤„ç†æ˜¯ä¸€è‡´çš„ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">outer</span> (<span class="params">age</span>) &#123;</span><br><span class="line">    (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>, age);</span><br><span class="line">        &#125;)();</span><br><span class="line">    &#125;)();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">outer.<span class="title function_">bind</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;å°æ˜&#x27;</span>&#125;)(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// =&gt; å°æ˜ 10</span></span><br></pre></td></tr></table></figure><p>è¿™ä¾‹å­ä¸­æˆ‘ä»¬å‡½æ•°å…±æœ‰ä¸‰å±‚åµŒå¥—ï¼Œé‡Œé¢æ˜¯ä¸¤å±‚ç®­å¤´å‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨æœ€é‡Œå±‚ç®­å¤´å‡½æ•°å†…éƒ¨å¼•ç”¨äº†<code>this</code>å’Œä¸€ä¸ªå±€éƒ¨å˜é‡<code>age</code>ã€‚å¯¹å±€å±€éƒ¨å˜é‡<code>age</code>çš„æŸ¥æ‰¾è§„åˆ™æˆ‘ä»¬å¾ˆæ¸…æ¥šï¼Œå…ˆåœ¨å½“å‰ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰å°±å»çˆ¶ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œä¸€ç›´åˆ°æœ€é¡¶å±‚ï¼ˆwindowã€globalï¼‰ã€‚åœ¨ç®­å¤´å‡½æ•°ä¸­å¯¹<code>this</code>çš„æŸ¥æ‰¾è§„åˆ™å’Œ<code>age</code>æ˜¯ä¸€æ ·çš„ï¼Œç®­å¤´å‡½æ•°æœ¬èº«å¹¶æ²¡æœ‰ä¸€ä¸ªè‡ªå·±çš„<code>this</code>ï¼Œå®ƒè¦ä¸€ç›´å¾€ä¸Šå±‚æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°<code>this</code>ä¸ºæ­¢ã€‚</p><p>åŒæ ·ï¼Œå¯¹äº<code>arguments</code>çš„å¤„ç†ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ç®­å¤´å‡½æ•°æœ¬èº«æ˜¯æ²¡æœ‰<code>arguments</code>å˜é‡çš„ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>ç®­å¤´å‡½æ•°è™½ç„¶å†™èµ·æ¥æ›´åŠ ç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ä¸åŠ åŒºåˆ†çš„åœ¨ä»»ä½•åœ°æ–¹éƒ½ç”¨ç®­å¤´å‡½æ•°æ›¿ä»£ä¼ ç»Ÿå‡½æ•°ï¼Œç‰¹åˆ«æ˜¯åœ¨å‡½æ•°å†…éƒ¨æ¶‰åŠ<code>this</code>ç»‘å®šæ—¶ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sayName</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    fn.<span class="title function_">bind</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;å°æ˜&#x27;</span> &#125;)();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sayName</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;My name is&#x27;</span>, <span class="variable language_">this</span>.<span class="property">name</span>); &#125;);</span><br><span class="line"><span class="comment">// =&gt; My name is å°æ˜</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯å†™æ³•</span></span><br><span class="line"><span class="title function_">sayName</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;My name is&#x27;</span>, <span class="variable language_">this</span>.<span class="property">name</span>));</span><br><span class="line"><span class="comment">// =&gt; My name is </span></span><br></pre></td></tr></table></figure><p>ä¹Ÿæ­£æ˜¯è¿™ä¸ªåŸå› <a href="https://github.com/koajs/koa/tree/v1.x">Koa 1.x</a>ä¸­æˆ‘ä»¬å¯ä»¥ä¸­é—´ä»¶ä¸­ä½¿ç”¨<code>this</code>å¼•ç”¨åˆ°<code>context</code>ï¼Œè€Œåœ¨<a href="https://github.com/koajs/koa/tree/2.0.0">Koa 2.x</a>ä¸­éœ€è¦å°†<code>context</code>ä½œä¸ºå‚æ•°ä¼ åˆ°ä¸­é—´ä»¶å†…éƒ¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// koa1.x</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> *(next) &#123;</span><br><span class="line">    <span class="keyword">var</span> start = <span class="keyword">new</span> <span class="title class_">Date</span>;</span><br><span class="line">    <span class="keyword">yield</span> next;</span><br><span class="line">    <span class="keyword">var</span> ms = <span class="keyword">new</span> <span class="title class_">Date</span> - start;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;%s %s - %s&#x27;</span>, <span class="variable language_">this</span>.<span class="property">method</span>, <span class="variable language_">this</span>.<span class="property">url</span>, ms);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// koa 2.x</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> start = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">    <span class="keyword">const</span> ms = <span class="title class_">Date</span>.<span class="title function_">now</span>() - start;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;ctx.method&#125;</span> <span class="subst">$&#123;ctx.url&#125;</span> - <span class="subst">$&#123;ms&#125;</span>ms`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.cnblogs.com/vajoy/p/4902935.html">ES6 ç®­å¤´å‡½æ•°ä¸­çš„ thisï¼Ÿä½ å¯èƒ½æƒ³å¤šäº†</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ES6ç®­å¤´å‡½æ•°ä¸­çš„this&quot;&gt;&lt;a href=&quot;#ES6ç®­å¤´å‡½æ•°ä¸­çš„this&quot; class=&quot;headerlink&quot; title=&quot;ES6ç®­å¤´å‡½æ•°ä¸­çš„this&quot;&gt;&lt;/a&gt;ES6ç®­å¤´å‡½æ•°ä¸­çš„this&lt;/h2&gt;&lt;p&gt;ES6 å¼€å§‹å¼•å…¥äº†ç®­å¤´å‡½æ•°ï¼Œè®©ä»£ç çœ‹èµ·æ¥æ›´ç®€æ´äº†ã€‚ä½†</summary>
      
    
    
    
    
    <category term="es6" scheme="https://kekek.cc/tags/es6/"/>
    
    <category term="arrow-function" scheme="https://kekek.cc/tags/arrow-function/"/>
    
  </entry>
  
  <entry>
    <title>Nginxæ—¥å¿—é…ç½®ä¸åˆ‡å‰²</title>
    <link href="https://kekek.cc/post/nginx-log.html"/>
    <id>https://kekek.cc/post/nginx-log.html</id>
    <published>2018-07-07T02:37:30.000Z</published>
    <updated>2020-08-07T03:52:24.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nginxæ—¥å¿—é…ç½®ä¸åˆ‡å‰²"><a href="#Nginxæ—¥å¿—é…ç½®ä¸åˆ‡å‰²" class="headerlink" title="Nginxæ—¥å¿—é…ç½®ä¸åˆ‡å‰²"></a>Nginxæ—¥å¿—é…ç½®ä¸åˆ‡å‰²</h2><p>Nginx æ—¥å¿—é…ç½®éå¸¸ç®€å•ï¼Œé¦–å…ˆä½¿ç”¨<code>log_format</code>æŒ‡ä»¤é…ç½®ä¸€ä¸ªæ ¼å¼ã€‚ç„¶åä½¿ç”¨ <code>access_log</code>ï¼ˆè®¿é—®æ—¥å¿—ï¼‰ã€<code>error_log</code>ï¼ˆé”™è¯¯æ—¥å¿—ï¼‰æŒ‡ä»¤å¼€å¯å³å¯ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment"># æ—¥å¿—æ ¼å¼ ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ ¼å¼åå­—ï¼Œå¯ä»¥é…ç½®å¤šä¸ªformatï¼ˆè¿™é‡Œçš„æ—¥å¿—æ ¼å¼åä¸º `main`ï¼‰ã€‚åé¢ access_log æŒ‡ä»¤ä½¿ç”¨å“ªä¸ªæ ¼å¼å°±å†™è¿™ä¸ªæ ¼å¼çš„åå­—ã€‚</span></span><br><span class="line">    <span class="attribute">log_format</span> main <span class="string">&#x27;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] &#x27;</span></span><br><span class="line">                       <span class="string">&#x27;&quot;<span class="variable">$request</span>&quot; <span class="variable">$status</span> <span class="variable">$bytes_sent</span> &#x27;</span></span><br><span class="line">                       <span class="string">&#x27;&quot;<span class="variable">$http_referer</span>&quot; &quot;<span class="variable">$http_user_agent</span>&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/access.log main;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…æ¯ä¸ªè™šæ‹Ÿä¸»æœºé…ç½®å•ç‹¬çš„æ—¥å¿—æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/<span class="variable">$host</span>/access.log main;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶æ—¥å¿—"><a href="#æ¡ä»¶æ—¥å¿—" class="headerlink" title="æ¡ä»¶æ—¥å¿—"></a>æ¡ä»¶æ—¥å¿—</h3><p>æˆ‘ä»¬æœ‰ä¸€ä¸ªå¿ƒè·³æ£€æµ‹çš„æœåŠ¡ï¼Œå®šæœŸä¼šå‘æœåŠ¡å™¨å‘è¯·æ±‚ã€‚è¿™ä¸ªè¯·æ±‚æ¯å¤©ä¼šå‘å¾ˆå¤šæ¬¡ï¼Œè¿™ä¸ªè¯·æ±‚çš„æ—¥å¿—ä¹Ÿæ˜¯éå¸¸å¤šçš„ã€‚è¿™ä¸ªæ—¥å¿—æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œå¯ä»¥æŠŠå®ƒå¿½ç•¥æ‰ã€‚</p><p>ç¬¬ä¸€ç§æ–¹æ³•å°±æ˜¯é…ç½®ä¸€ä¸ªlocationåŒ¹é…åˆ°è¿™ä¸ªå¿ƒè·³æ£€æµ‹æ¥å£å°†æ—¥å¿—å…³æ‰ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> = /_heartbeat &#123;</span><br><span class="line">    <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://myserver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ–¹æ³•ä¸æ˜¯å¾ˆçµæ´»ï¼Œæˆ‘ä»¬è¦é‡å¤é…ç½®ã€‚æœ‰æ²¡æœ‰åŠæ³•åªé…ç½®ä¸€å¤„å°±èƒ½åšåˆ°å‘¢ï¼ŸæŸ¥çœ‹Nginxæ–‡æ¡£ï¼Œå‘ç°æœ‰ä¸€ä¸ªæ¡ä»¶æ—¥å¿—é…ç½®ç¤ºä¾‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">map</span> <span class="variable">$uri</span> <span class="variable">$loggable</span> &#123;</span><br><span class="line">        <span class="comment"># å¯ä»¥ä½¿ç”¨æ­£åˆ™</span></span><br><span class="line">        ~\.(jpg|png|gif|webp)$   0; <span class="comment"># ä¸è®°å½•å›¾ç‰‡</span></span><br><span class="line">        /<span class="attribute">_heartbeat</span>              <span class="number">0</span>; <span class="comment"># ä¸è®°å½•å¿ƒè·³æ£€æµ‹</span></span><br><span class="line">        <span class="attribute">default</span>                  <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/access.log main if=<span class="variable">$loggable</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ—¥å¿—åˆ‡å‰²"><a href="#æ—¥å¿—åˆ‡å‰²" class="headerlink" title="æ—¥å¿—åˆ‡å‰²"></a>æ—¥å¿—åˆ‡å‰²</h3><p>å½“ Nginx æ¥æ”¶åˆ° <code>USR1</code> æ—¶ä¼šé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv /var/log/nginx/access.log /var/log/nginx/access.log-20180706</span><br><span class="line">kill -USR1 `cat /var/run/nginx.pid`</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ–¹æ¡ˆå¾ˆä¸çµæ´»ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨crontabæˆ–è€…<a href="https://github.com/logrotate/logrotate">logrotate</a>æ¥åšåˆ°è‡ªåŠ¨åŒ–ã€‚</p><ol><li><p>crontab </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">0 0 * * * æ¯å¤©é›¶ç‚¹æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">LOG_PATH=/var/log/nginx</span><br><span class="line">DATE=`date -d &quot;yesterday&quot; +%Y%m%d`</span><br><span class="line">PID=`cat /var/run/nginx.pid`</span><br><span class="line"></span><br><span class="line">cd $LOG_PATH</span><br><span class="line"></span><br><span class="line">mv access.log access.log-$DATE &amp;&amp; zip -mq access.log-$DATE.zip access.log-$DATE</span><br><span class="line">kill -USR1 $PID</span><br></pre></td></tr></table></figure></li><li><p>logrotate</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/var/log/nginx/*.log &#123;</span><br><span class="line">    daily</span><br><span class="line">    dateext</span><br><span class="line">    rotate 30</span><br><span class="line">    compress</span><br><span class="line">    delaycompress</span><br><span class="line">    notifempty</span><br><span class="line">    sharedscripts</span><br><span class="line">    postrotate</span><br><span class="line">        if [ -f /var/run/nginx.pid ]; then</span><br><span class="line">            kill -USR1 `cat /var/run/nginx.pid`</span><br><span class="line">        fi</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>ç¬¬ä¸€è¡Œè¦å¤„ç†çš„æ—¥å¿—ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ã€‚åé¢<code>{}</code>åŒ…è£¹æ—¥å¿—åˆ‡å‰²çš„é…ç½®é¡¹ã€‚</li><li>dailyï¼šè¡¨ç¤ºæ¯å¤©æ‰§è¡Œä¸€æ¬¡ï¼Œç±»ä¼¼çš„é…ç½®è¿˜æœ‰weekly,monthlyæ¯å‘¨å’Œæ¯æœˆã€‚</li><li>dateextï¼šæ–‡ä»¶åç¼€ä½¿ç”¨æ—¥æœŸå‘½åã€‚</li><li>rotate 30ï¼šä¿ç•™æœ€è¿‘30å¤©çš„æ—¥å¿—ã€‚</li><li>compressï¼šå¯¹æ—¥å¿—è¿›è¡Œå‹ç¼©ã€‚</li><li>delaycompressï¼šå»¶è¿Ÿå‹ç¼©ï¼Œåˆ†å‰²å®Œæˆåå»¶è¿Ÿä¸€å¤©å‹ç¼©æ­¤æ—¥å¿—ã€‚</li><li>notifemptyï¼šå¿½ç•¥ç©ºæ—¥å¿—ã€‚</li><li>sharedscriptsï¼šæ‰§è¡Œè„šæœ¬ã€‚</li><li>postrotateï¼šæ—¥å¿—è¢«åˆ‡å‰²åæ‰§è¡Œçš„è„šæœ¬ï¼Œå¯¹åº”çš„<code>prerotate</code>è¡¨ç¤ºåœ¨åˆ‡å‰²å‰æ‰§è¡Œçš„è„šæœ¬ã€‚</li><li>endscriptï¼šæ ‡è®°è„šæœ¬ç»“æŸã€‚</li><li>æµ‹è¯•ä¸€ä¸‹è„šæœ¬ï¼š<code>logrotate -d /etc/logrotate.d/nginx</code>ã€‚</li><li>æ‰§è¡Œåé¢çš„å‘½ä»¤èƒ½ç«‹å³çœ‹åˆ°æ•ˆæœï¼š<code>logrotate -vf /etc/logrotate.d/nginx</code>ã€‚</li></ul></blockquote></li></ol><h3 id="è¾“å‡ºJSONæ ¼å¼çš„æ—¥å¿—"><a href="#è¾“å‡ºJSONæ ¼å¼çš„æ—¥å¿—" class="headerlink" title="è¾“å‡ºJSONæ ¼å¼çš„æ—¥å¿—"></a>è¾“å‡ºJSONæ ¼å¼çš„æ—¥å¿—</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">log_format json escape=json &#x27;&#123;&#x27;</span><br><span class="line">    &#x27;&quot;remote_addr&quot;: &quot;$remote_addr&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;x_forwarded_for&quot;:  &quot;$http_x_forwarded_for&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;time_iso8601&quot;: &quot;$time_iso8601&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;host&quot;: &quot;$host&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;method&quot;: &quot;$request_method&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;request_uri&quot;: &quot;$request_uri&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;status&quot;: $status,&#x27;</span><br><span class="line">    &#x27;&quot;http_referer&quot;:  &quot;$http_referer&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;body_bytes_sent&quot;: &quot;$body_bytes_sent&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;http_user_agent&quot;: &quot;$http_user_agent&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;request_time&quot;: &quot;$request_time&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;upstream_addr&quot;: &quot;$upstream_addr&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;upstream_response_time&quot;: &quot;$upstream_response_time&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;x_request_id&quot;: &quot;$upstream_http_x_request_id&quot;,&#x27;</span><br><span class="line">    &#x27;&quot;x_response_time&quot;: &quot;$upstream_http_x_response_time&quot;&#x27;</span><br><span class="line">&#x27;&#125;&#x27;;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="http://nginx.org/en/docs/http/ngx_http_log_module.html">Module ngx_http_log_module</a></li><li><a href="https://linux.cn/article-8227-1.html">é…ç½® logrotate çš„ç»ˆææŒ‡å¯¼</a></li><li><a href="http://nginx.org/en/docs/http/ngx_http_log_module.html#log_format">log_format</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Nginxæ—¥å¿—é…ç½®ä¸åˆ‡å‰²&quot;&gt;&lt;a href=&quot;#Nginxæ—¥å¿—é…ç½®ä¸åˆ‡å‰²&quot; class=&quot;headerlink&quot; title=&quot;Nginxæ—¥å¿—é…ç½®ä¸åˆ‡å‰²&quot;&gt;&lt;/a&gt;Nginxæ—¥å¿—é…ç½®ä¸åˆ‡å‰²&lt;/h2&gt;&lt;p&gt;Nginx æ—¥å¿—é…ç½®éå¸¸ç®€å•ï¼Œé¦–å…ˆä½¿ç”¨&lt;code&gt;log_f</summary>
      
    
    
    
    <category term="nginx" scheme="https://kekek.cc/categories/nginx/"/>
    
    
    <category term="nginx" scheme="https://kekek.cc/tags/nginx/"/>
    
    <category term="log" scheme="https://kekek.cc/tags/log/"/>
    
    <category term="logrotate" scheme="https://kekek.cc/tags/logrotate/"/>
    
  </entry>
  
  <entry>
    <title>éƒ¨ç½²å…¨çƒCDNç½‘ç»œ</title>
    <link href="https://kekek.cc/post/global-cdn.html"/>
    <id>https://kekek.cc/post/global-cdn.html</id>
    <published>2018-07-04T14:49:21.000Z</published>
    <updated>2021-11-20T00:17:47.677Z</updated>
    
    <content type="html"><![CDATA[<h2 id="éƒ¨ç½²å…¨çƒCDNç½‘ç»œ"><a href="#éƒ¨ç½²å…¨çƒCDNç½‘ç»œ" class="headerlink" title="éƒ¨ç½²å…¨çƒCDNç½‘ç»œ"></a>éƒ¨ç½²å…¨çƒCDNç½‘ç»œ</h2><p>æˆ‘ä»¬ç°åœ¨é™¤äº†å¤§é™†çš„è¿˜æœ‰ç¾å›½åŠä¸œå—äºšçš„ç”¨æˆ·ï¼Œåœ¨å›½å†…å¯ä»¥ä½¿ç”¨<a href="https://www.aliyun.com/product/cdn">é˜¿é‡Œ</a>æˆ–è€…<a href="https://cloud.tencent.com/product/cdn">è…¾è®¯</a>çš„CDNæœåŠ¡ã€‚ä½†æ˜¯ä¸Šé¢ä¸¤å®¶åœ¨å›½å¤–çš„èŠ‚ç‚¹ä¸æ˜¯å¾ˆå¤šï¼Œè€Œå›½å¤–å‚å•†æœ‰<a href="https://aws.amazon.com/cloudfront/">Amazon CloudFront</a>å’Œ<a href="https://www.cloudflare.com/">Cloudflare</a>åœ¨å¤§é™†åœ°åŒºçš„æœåŠ¡åˆä¸å¥½ã€‚é‚£æœ‰æ²¡æœ‰åŠæ³•è®©ä¸€ä¸ªåŸŸåå¤§é™†ç”¨æˆ·ä½¿ç”¨é˜¿é‡Œçš„æœåŠ¡ï¼Œå›½å¤–çš„ç”¨æˆ·æ˜¯ç”¨CloudFrontæœåŠ¡å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œæˆ‘ä»¬çŸ¥é“ç°åœ¨ä¸»æµçš„CDNéƒ½æ˜¯é‡‡ç”¨CNAMEçš„å½¢å¼é…ç½®DNSã€‚CNAMEçš„æ ¸å¿ƒå°±æ˜¯æ™ºèƒ½DNSï¼Œé‚£æˆ‘ä»¬å¦‚æœæ­å»ºä¸€ä¸ªDNSè®©å®ƒç»™å›½å†…å¤–ç”¨æˆ·è¿”å›ä¸åŒçš„CNAMEä¸å°±è§£å†³äº†å—ï¼Œä¹Ÿå°±æ˜¯CDNçš„DNSã€‚æ‰€å¹¸ï¼Œä¸ç”¨æˆ‘ä»¬éº»çƒ¦è‡ªå·±å»æ­å»ºè¿™ä¸ªæ™ºèƒ½DNSï¼Œç°åœ¨åƒé˜¿é‡Œçš„äº‘DNSå’ŒDNSPodéƒ½æä¾›äº†æ¯”æˆ‘ä»¬éœ€æ±‚æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚ä¸‹é¢æ˜¯å…·ä½“ç½‘ç»œæ‹“æ‰‘å›¾ï¼š</p><p><img src="/images/global-dns.png" alt="æš‚ç¼º"></p><h3 id="å…·ä½“æ“ä½œ"><a href="#å…·ä½“æ“ä½œ" class="headerlink" title="å…·ä½“æ“ä½œ"></a>å…·ä½“æ“ä½œ</h3><blockquote><p>ç”±äºæš‚æ—¶æ²¡æœ‰Amazon CloudFrontå’ŒCloudflareè´¦å·ï¼Œå›½å¤–CDNæˆ‘å°±ç”¨è…¾è®¯CDNæ¨¡æ‹Ÿäº†ã€‚å®é™…æ“ä½œæ—¶å°†è…¾è®¯CDNæ¢æˆAmazon CloudFrontæˆ–Cloudflareå³å¯ã€‚</p></blockquote><ol><li><p>é¦–å…ˆåˆ†åˆ«åœ¨é˜¿é‡ŒCDNå’Œè…¾è®¯CDNå¼€å¯æœåŠ¡</p><p> é˜¿é‡ŒCDNï¼šs.kekek.cc.w.kunlunar.com.<br> <img src="/images/cdn-cn-kekek.png" alt="é˜¿é‡ŒCDN"></p><p> è…¾è®¯CDNï¼šs.kekek.cc.cdn.dnsv1.com.<br> <img src="/images/cdn-world-kekek.png" alt="è…¾è®¯CDN"></p></li><li><p>ä¸ºåŸŸåé…ç½®æ™ºèƒ½DNS</p><p> å¢ƒå¤–æœåŠ¡é…ç½®ä¸ºè…¾è®¯DNSçš„CNAMEï¼Œé»˜è®¤çº¿è·¯ï¼ˆå¢ƒå†…ï¼‰é…ç½®ä¸ºé˜¿é‡ŒCDNçš„CNANMEã€‚<br> <img src="/images/dns-kekek.png"></p></li></ol><p>ä¸‹é¢æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹çº¿è·¯ï¼š</p><ol><li>114dns</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ dig @114.114.114.114 s.kekek.cc CNAME</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; @114.114.114.114 s.kekek.cc CNAME</span><br><span class="line">; (1 server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 41126</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;s.kekek.cc.INCNAME</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">s.kekek.cc.600INCNAMEs.kekek.cc.w.kunlunar.com.</span><br><span class="line"></span><br><span class="line">;; Query time: 2735 msec</span><br><span class="line">;; SERVER: 114.114.114.114#53(114.114.114.114)</span><br><span class="line">;; WHEN: Wed Jul 04 23:28:47 CST 2018</span><br><span class="line">;; MSG SIZE  rcvd: 67</span><br></pre></td></tr></table></figure><ol start="2"><li><p>Cloudflare DNS</p><blockquote><p>ä½¿ç”¨ 1.1.1.1 DNSç›¸å½“äºæ¨¡æ‹Ÿç”¨æˆ·åœ¨å¢ƒå¤–è¿›è¡ŒDNSæŸ¥è¯¢ã€‚</p></blockquote> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ dig @1.1.1.1 s.kekek.cc CNAME</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; @1.1.1.1 s.kekek.cc CNAME</span><br><span class="line">; (1 server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 5551</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 1452</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;s.kekek.cc.INCNAME</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">s.kekek.cc.345INCNAMEs.kekek.cc.cdn.dnsv1.com.</span><br><span class="line"></span><br><span class="line">;; Query time: 320 msec</span><br><span class="line">;; SERVER: 1.1.1.1#53(1.1.1.1)</span><br><span class="line">;; WHEN: Wed Jul 04 23:27:39 CST 2018</span><br><span class="line">;; MSG SIZE  rcvd: 77</span><br></pre></td></tr></table></figure></li></ol><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆ‘ä»¬ä½¿ç”¨114DNSæ—¶ï¼Œè¿”å›çš„CNAMEä¸º<code>s.kekek.cc.w.kunlunar.com.</code>ï¼Œå¯¹åº”çš„å°±æ˜¯æˆ‘ä»¬é…ç½®çš„é˜¿é‡ŒCDNã€‚ä½¿ç”¨Cloudflare DNSæ˜¯æ¨¡æ‹Ÿæµ·å¤–ç”¨æˆ·å¾—åˆ°çš„CNAMEæ˜¯<code>s.kekek.cc.cdn.dnsv1.com.</code>ï¼Œè¿™ä¸ªåˆšå¥½æ˜¯æˆ‘ä»¬è…¾è®¯çš„CDNã€‚</p><p>ç°åœ¨æˆ‘ä»¬å¢ƒå†…ç”¨æˆ·è®¿é—®<a href="http://ss.kekek.cc/">s.kekek.cc</a>æ—¶å°±å¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„CDNæä¾›åŠ é€Ÿäº†ï¼Œå¢ƒå¤–ç”¨æˆ·è®¿é—®æ—¶å°±å¯ä»¥ç”±è…¾è®¯CDNæä¾›åŠ é€ŸæœåŠ¡äº†ã€‚</p><h3 id="å›½å†…å¤–æºç«™é—®é¢˜"><a href="#å›½å†…å¤–æºç«™é—®é¢˜" class="headerlink" title="å›½å†…å¤–æºç«™é—®é¢˜"></a>å›½å†…å¤–æºç«™é—®é¢˜</h3><p>å¯¹äºå›½å†…å¤–æ˜¯å¦æ˜¯ç”¨åŒä¸€ä¸ªæºç«™ï¼Œä¸¤è€…éƒ½å¯ã€‚å¯ä»¥æ ¹æ®å®é™…æƒ…å†µå»æµ‹è¯•å“ªç§æ›´ç¬¦åˆè‡ªèº«ä¸šåŠ¡ï¼Œä»æ´›æ‰çŸ¶åˆ°ä¸Šæµ·çš„æœ€å°å»¶è¿Ÿåœ¨<code>180ms</code>å·¦å³ï¼Œä¹Ÿå°±æ˜¯è¯´å¢ƒå¤–ç”¨æˆ·è®¿é—®é¦–æ¬¡åŠ è½½çš„æ–°èµ„æºæ—¶ä¼šå‡ºç°æ¯”è¾ƒä¸¥é‡çš„å»¶è¿Ÿã€‚å¦‚æœå¯¹é¦–æ¬¡åŠ è½½å»¶è¿Ÿå¤ªåœ¨æ„å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæºç«™ï¼Œå¦‚æœ<strong>é¢‘ç¹</strong>å›æºå¯è€ƒè™‘å¢ƒå†…å¢ƒå¤–ä½¿ç”¨ä¸åŒçš„æºç«™ã€‚</p><p>ä½¿ç”¨ä¸åŒæºç«™æ—¶å¯ä»¥é‡‡ç”¨ä¸»åŠ¨æ–‡ä»¶åŒæ­¥ã€<a href="nginx-proxy-cache.html">Nginxä»£ç†ç¼“å­˜</a>ç­‰æ–¹æ¡ˆåŒæ­¥ä¸¤ä¸ªæºç«™èµ„æºã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;éƒ¨ç½²å…¨çƒCDNç½‘ç»œ&quot;&gt;&lt;a href=&quot;#éƒ¨ç½²å…¨çƒCDNç½‘ç»œ&quot; class=&quot;headerlink&quot; title=&quot;éƒ¨ç½²å…¨çƒCDNç½‘ç»œ&quot;&gt;&lt;/a&gt;éƒ¨ç½²å…¨çƒCDNç½‘ç»œ&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬ç°åœ¨é™¤äº†å¤§é™†çš„è¿˜æœ‰ç¾å›½åŠä¸œå—äºšçš„ç”¨æˆ·ï¼Œåœ¨å›½å†…å¯ä»¥ä½¿ç”¨&lt;a href=&quot;https</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>LRCæ’­æ”¾å™¨</title>
    <link href="https://kekek.cc/post/lrc-player.html"/>
    <id>https://kekek.cc/post/lrc-player.html</id>
    <published>2018-06-28T05:24:16.000Z</published>
    <updated>2021-11-20T00:17:47.701Z</updated>
    
    <content type="html"><![CDATA[<h2 id="LRCæ’­æ”¾å™¨"><a href="#LRCæ’­æ”¾å™¨" class="headerlink" title="LRCæ’­æ”¾å™¨"></a>LRCæ’­æ”¾å™¨</h2><iframe scrolling="no" width="100%" height="300" src="https://jsfiddle.net/ac35otdk/embedded/result,html,js,css/light/" frameborder="0" loading="lazy" allowfullscreen="allowfullscreen"></iframe><figure class="highlight js"><figcaption><span>lrc_player.js</span><a href="/downloads/code/lrc_player.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">toSecond</span>(<span class="params">time</span>) {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">`1970-01-01T<span class="subst">${time}</span>Z`</span>).<span class="title function_">getTime</span>() / <span class="number">1000</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ’­æ”¾æ­Œè¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  {<span class="type"> </span></span></span><br><span class="line"><span class="type"><span class="comment"> *              lyrics, æ­Œè¯ï¼Œæ ¼å¼ä¸ºäºŒç»´æ•°ç»„ã€‚e.g. [ [&#x27;00:00:00.40&#x27;, &#x27;å‘¨æ°ä¼¦ - ç­‰ä½ ä¸‹è¯¾ (with æ¨ç‘ä»£)&#x27;], [&#x27;00:00:03.94&#x27;, &#x27;è¯ï¼šå‘¨æ°ä¼¦&#x27;], [&#x27;00:00:05.21&#x27;, &#x27;æ›²ï¼šå‘¨æ°ä¼¦&#x27;] ]</span></span></span><br><span class="line"><span class="type"><span class="comment"> *              seek  = &#x27;00:00:00&#x27;, å¼€å§‹æ—¶é—´</span></span></span><br><span class="line"><span class="type"><span class="comment"> *              print = (lyric) =&gt; console.log(lyric), æ­Œè¯å›è°ƒ</span></span></span><br><span class="line"><span class="type"><span class="comment"> *              interval = 50 åˆ·æ–°æ£€æµ‹é—´éš” ms</span></span></span><br><span class="line"><span class="type"><span class="comment"> *          </span>}</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">play</span>(<span class="params">{ lyrics, seek = <span class="string">&#x27;00:00:00&#x27;</span>, print = (lyric) =&gt; <span class="variable language_">console</span>.log(lyric), interval = <span class="number">50</span> }</span>) {</span><br><span class="line">    seek = <span class="title function_">toSecond</span>(seek);</span><br><span class="line">    lyrics = lyrics.<span class="title function_">map</span>(<span class="function"><span class="params">lyric</span> =&gt;</span> [<span class="title function_">toSecond</span>(lyric[<span class="number">0</span>]), lyric[<span class="number">1</span>]]).<span class="title function_">sort</span>(<span class="function">(<span class="params">lyric1, lyric2</span>) =&gt;</span> lyric1[<span class="number">0</span>] - lyric2[<span class="number">0</span>]).<span class="title function_">filter</span>(<span class="function"><span class="params">lyric</span> =&gt;</span> lyric[<span class="number">0</span>] &gt;= seek);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// setIntervalå’ŒsetTimeoutåœ¨æµè§ˆå™¨çª—å£éæ¿€æ´»çš„çŠ¶æ€ä¸‹ä¼šåœæ­¢å·¥ä½œæˆ–è€…ä»¥ææ…¢çš„é€Ÿåº¦å·¥ä½œ</span></span><br><span class="line">    <span class="comment">// å¯ä»¥ä½¿ç”¨ Web Worker è§£å†³æˆ–è€… requestAnimationFrame è§£å†³[æ›´æ–°ï¼šç»è¿‡æµ‹è¯•çª—å£å¤„äºéæ¿€æ´»çŠ¶æ€ä¸‹ requestAnimationFrame ä¹Ÿä¼šåœæ­¢å·¥ä½œ]</span></span><br><span class="line">    <span class="comment">// [RAF replacements for setTimeout and setInterval](https://bl.ocks.org/joyrexus/7304146)</span></span><br><span class="line">    <span class="comment">// @see https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame</span></span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (lyrics.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">clearInterval</span>(timer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// seek ä¹‹å‰çš„å…¨éƒ¨æ˜¾ç¤º </span></span><br><span class="line">        <span class="keyword">while</span> (lyrics.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; lyrics[<span class="number">0</span>][<span class="number">0</span>] &lt;= seek) <span class="title function_">print</span>(lyrics.<span class="title function_">shift</span>()[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        seek += (interval / <span class="number">1000</span>);</span><br><span class="line">    }, interval);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> timer;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><ul><li><input checked="" disabled="" type="checkbox"> ä½¿ç”¨RAFæ¨¡æ‹ŸsetInterval</li><li><input checked="" disabled="" type="checkbox"> å°è£…ä¸ºå¯¹è±¡ï¼Œæ”¯æŒplayã€pauseã€resumeã€seekã€resetç­‰åŠŸèƒ½</li></ul><figure class="highlight js"><figcaption><span>lrc_player_class.js</span><a href="/downloads/code/lrc_player_class.js">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LRCPlayer</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">{ lyrics, print = (lyric) =&gt; <span class="variable language_">console</span>.log(lyric), done = () =&gt; { }, interval = <span class="number">50</span> }</span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lyrics</span> = lyrics;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">print</span> = print;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">done</span> = done;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">interval</span> = interval;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">seek</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_timer</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;INIT&#x27;</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ’­æ”¾ï¼ˆæ”¯æŒseekï¼‰</span></span><br><span class="line">    <span class="title function_">play</span>(<span class="params">seek = <span class="string">&#x27;00:00:00&#x27;</span></span>) {</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;PLAY&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> !== <span class="string">&#x27;PAUSE&#x27;</span>) {</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">seek</span> = <span class="title function_">toSecond</span>(seek);</span><br><span class="line">        }</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;PLAY&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> lyrics = <span class="variable language_">this</span>.<span class="property">lyrics</span>.<span class="title function_">map</span>(<span class="function"><span class="params">lyric</span> =&gt;</span> [<span class="title function_">toSecond</span>(lyric[<span class="number">0</span>]), lyric[<span class="number">1</span>]]).<span class="title function_">sort</span>(<span class="function">(<span class="params">lyric1, lyric2</span>) =&gt;</span> lyric1[<span class="number">0</span>] - lyric2[<span class="number">0</span>]).<span class="title function_">filter</span>(<span class="function"><span class="params">lyric</span> =&gt;</span> lyric[<span class="number">0</span>] &gt;= <span class="variable language_">this</span>.<span class="property">seek</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_timer</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">            <span class="keyword">if</span> (lyrics.<span class="property">length</span> === <span class="number">0</span>) {</span><br><span class="line">                <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">_timer</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">done</span>();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// seek ä¹‹å‰çš„å…¨éƒ¨æ˜¾ç¤º</span></span><br><span class="line">            <span class="keyword">while</span> (lyrics.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; lyrics[<span class="number">0</span>][<span class="number">0</span>] &lt;= <span class="variable language_">this</span>.<span class="property">seek</span>) <span class="variable language_">this</span>.<span class="title function_">print</span>(lyrics.<span class="title function_">shift</span>()[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">seek</span> += (<span class="variable language_">this</span>.<span class="property">interval</span> / <span class="number">1000</span>);</span><br><span class="line">        }, <span class="variable language_">this</span>.<span class="property">interval</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æš‚åœ</span></span><br><span class="line">    <span class="title function_">pause</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;PAUSE&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;PAUSE&#x27;</span>;</span><br><span class="line">        <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">_timer</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»§ç»­æ’­æ”¾</span></span><br><span class="line">    <span class="title function_">resume</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&#x27;PAUSE&#x27;</span>) <span class="variable language_">this</span>.<span class="title function_">play</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡æ–°å¼€å§‹</span></span><br><span class="line">    <span class="title function_">reset</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">pause</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;INIT&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">play</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://bl.ocks.org/joyrexus/7304146">RAF replacements for setTimeout and setInterval</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame">requestAnimationFrame</a></li><li><a href="https://dev.opera.com/articles/better-performance-with-requestanimationframe/">Better Performance With requestAnimationFrame</a></li><li><a href="https://stackoverflow.com/a/16033979/4942848">How do browsers pause&#x2F;change Javascript when tab or window is not active?</a></li><li><a href="https://css-tricks.com/using-requestanimationframe/">Using requestAnimationFrame</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;LRCæ’­æ”¾å™¨&quot;&gt;&lt;a href=&quot;#LRCæ’­æ”¾å™¨&quot; class=&quot;headerlink&quot; title=&quot;LRCæ’­æ”¾å™¨&quot;&gt;&lt;/a&gt;LRCæ’­æ”¾å™¨&lt;/h2&gt;&lt;iframe scrolling=&quot;no&quot; width=&quot;100%&quot; height=&quot;300&quot; src=&quot;htt</summary>
      
    
    
    
    
  </entry>
  
</feed>
