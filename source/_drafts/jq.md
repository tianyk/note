---
title: jq
author: tyk
date: 2019-06-21 19:14:31
tags:
---


```
jq -r 'select (.["$type"] == "page:load" and .["$$version"] == "1.0.6") | [."$country", ."$os", ."$lesson", ."$page", ."perf.load0"] | @csv' report.log.[0-9]
```

```
cat report.log.* | jq 'select (.["$type"] == "page:load" and has("load0")) | [."$country", ."$os", .courseId, .load0] | join(",")' > ../load.csv
```

```
courses="180516264,181196498,181251167,180418124,181321440,181349226,181370760,180947360,181488341,181502029,181501467,181513781,181523510,181489707,181317830,181502595,181550350,181455735,181526121,181559975,181427842,181477810,180953687,181563329,181561457,181602559,181523917,181578519,181610245,181525356,181623404,181623840,181463065,181464937,181512249,181584350,181599828,181611284,181559412,181572162,181647719,181648393,181679254,181530167,181558815,181641903,181682504,180115838,181207703,181623549,181623553,181634754,181684777,181729916,181504277,181521832,181643884,181696049,181704944,181615409,181470609,181593103,181797509,181492843,181476562,181811501,181734196,181458070,180087275,181343057,181781484,181390053,181822257,181830098,181849954,181852983,181577878,181782851,181823920,181463027,181727582,181773417,181790487,181816746,181746600,181824562,181862534,181864279,181650354,180535291,181322414,181512301,181586259,181806734,181867931,181873645,180678146,181596475,181674051,181561715,181726322,181740006,181814524,181491318,181476694,181875843,181458071,181755633,181812014,180215099,181960169,181777189,181465120,181696050,181910327,181954774,180477369,181316999,181592424,181883972,181901873,181911260,181952060,181254945,181510472,181592488,181695311,181796155,181807281,181898143,181903341,180620323,181779509,181957562,181965118,181597356,181879688,181957743,181772611"
country="菲律宾"
os="Windows"

awk -v country=$country -v courses=$courses -F "," '{  if ($1 == country && match(courses, $3) && length($3) > 2) { if ($4 < 1000) items["<1s"] += 1; else if ($4 < 2000) items["<2s"] += 1; else if ($4 < 3000) items["<3s"] += 1; else if ($4 < 4000) items["<4s"] += 1; else if ($4 < 5000) items["<5s"] += 1; else items[">5s"] += 1; } } END { for (item in items) { print item, items[item]}}' load.csv

awk -v os=$os -v country=$country -v courses=$courses -F "," '{  if ($1 == country && match(courses, $3) && length($3) > 2 && $2 == os) { if ($4 < 1000) items["<1s"] += 1; else if ($4 < 2000) items["<2s"] += 1; else if ($4 < 3000) items["<3s"] += 1; else if ($4 < 4000) items["<4s"] += 1; else if ($4 < 5000) items["<5s"] += 1; else items[">5s"] += 1; } } END { for (item in items) { print item, items[item]}}' load.csv
```